var __assign=this&&this.__assign||function(){__assign=Object.assign||function(d){for(var h,g=1,a=arguments.length;g<a;g++){h=arguments[g];for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(d[e]=h[e])}return d};return __assign.apply(this,arguments)},Communicator;
(function(d){(function(h){var g=function(){function a(a){this.name=a;this.nodeChannels=[];this.cameraChannels=[];this.pivotPoints=new Map}a.prototype.createNodeChannel=function(a,c,b,f){a=new h.NodeChannel(a,c,b,f);this._registerNodeChannel(a);return a};a.prototype._registerNodeChannel=function(a){this.nodeChannels.push(a)};a.prototype.createCameraChannel=function(a,c,b){a=new h.CameraChannel(a,c,b);this._registerCameraChannel(a);return a};a.prototype._registerCameraChannel=function(a){this.cameraChannels.push(a)};
a.prototype.deleteChannel=function(a){for(var c=0;c<this.nodeChannels.length;c++)if(this.nodeChannels[c]===a){this.nodeChannels.splice(c,1);return}for(c=0;c<this.cameraChannels.length;c++)if(this.cameraChannels[c]===a){this.cameraChannels.splice(c,1);break}};a.prototype._gatherForExport=function(a){for(var c=0,b=this.nodeChannels;c<b.length;c++){var f=b[c];f._gatherForExport(a)}c=0;for(b=this.cameraChannels;c<b.length;c++)f=b[c],f._gatherForExport(a)};a.prototype._export=function(a){var c=this,b=
[],f={};""!==this.name&&(f.name=this.name);var k={},e=function(b){if(0!==c[b].length){for(var f=[],e=0,d=c[b];e<d.length;e++)f.push(d[e]._export(a));k[b]=f}};this.pivotPoints.forEach(function(c,f){b.push({node:f,point:c})});0!==b.length&&(f.pivotPoints=b);e("nodeChannels");e("cameraChannels");return __assign({},f,k)};a._import=function(e,c){var b=new a(c.name||"");if(void 0!==c.nodeChannels)for(var f=0,k=c.nodeChannels;f<k.length;f++){var l=k[f];b._registerNodeChannel(h.NodeChannel._import(e,l))}if(void 0!==
c.cameraChannels)for(f=0,k=c.cameraChannels;f<k.length;f++)l=k[f],b._registerCameraChannel(h.CameraChannel._import(e,l));if(void 0!==c.pivotPoints)for(e=0,c=c.pivotPoints;e<c.length;e++)l=c[e],f=d.Point3.fromJson(l.point),b.pivotPoints.set(l.node,f);return b};return a}();h.Animation=g})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(c){c[c.Translation=0]="Translation";c[c.Rotation=1]="Rotation";c[c.Scale=2]="Scale";c[c.Opacity=3]="Opacity";c[c.Visibility=4]="Visibility";c[c.Color=5]="Color";c[c.ColorMap=6]="ColorMap"})(g=h.NodeProperty||(h.NodeProperty={}));var a=function(){function c(b,c,k,a){this.name=b;this.nodeId=c;this.property=k;this.sampler=a;switch(this.property){case g.Translation:case g.Scale:case g.Color:if(a.buffer.keyType!==h.KeyType.Vec3)throw Error("Key type mismatch. Expected Vec3");
break;case g.Rotation:if(a.buffer.keyType!==h.KeyType.Quat)throw Error("Key type mismatch. Expected Quat");break;case g.Opacity:case g.Visibility:case g.ColorMap:if(a.buffer.keyType!==h.KeyType.Scalar)throw Error("Key type mismatch. Expected Scalar");}}c.prototype._getValue=function(b,c){switch(this.property){case g.Translation:this.sampler.interpolateVec3(b,c.translate);c.flags|=h.Internal.NodeValuesFlags.Transform;break;case g.Rotation:this.sampler.interpolateQuat(b,c.rotation);c.flags|=h.Internal.NodeValuesFlags.Transform;
break;case g.Scale:this.sampler.interpolateVec3(b,c.scale);c.flags|=h.Internal.NodeValuesFlags.Transform;break;case g.Opacity:c.opacity=this.sampler.interpolateScalar(b);c.flags|=h.Internal.NodeValuesFlags.Opacity;break;case g.Visibility:c.visibility=this.sampler.interpolateScalar(b);c.flags|=h.Internal.NodeValuesFlags.Visibility;break;case g.Color:this.sampler.interpolateVec3(b,c.color);c.flags|=h.Internal.NodeValuesFlags.Color;break;case g.ColorMap:b=this.sampler.interpolateScalar(b),b=this._getColorFromMap(b),
null!==b&&(c.color.set(b.r,b.g,b.b),c.flags|=h.Internal.NodeValuesFlags.Color)}};c.prototype._getColorFromMap=function(b){if(void 0===this.colorMap)return null;0>b&&(b=0);1<b&&(b=1);for(var c=0;c<this.colorMap.length-1;){var k=this.colorMap[c].position,a=this.colorMap[c].color,e=this.colorMap[c+1].position,g=this.colorMap[c+1].color;if(b<=k)return a;if(b<=e)return b=(b-k)/(e-k),new d.Color((1-b)*a.r+b*g.r,(1-b)*a.g+b*g.g,(1-b)*a.b+b*g.b);if(b>=e&&c===this.colorMap.length-2)return g;++c}return null};
c.prototype._gatherForExport=function(b){void 0!==this.colorMap&&b.colorMaps.add(this.colorMap);b.samplers.add(this.sampler);this.sampler._gatherForExport(b)};c.prototype._export=function(b){var c={};""!==this.name&&(c.name=this.name);void 0!==this.colorMap&&(c.colorMap=b.colorMaps.getIndex(this.colorMap));return __assign({nodeId:this.nodeId,property:g[this.property],sampler:b.samplers.getIndex(this.sampler)},c)};c._import=function(b,f){var k=new c(f.name||"",f.nodeId,g[f.property],b.samplers[f.sampler]);
void 0!==f.colorMap&&(k.colorMap=b.colorMaps[f.colorMap]);return k};return c}();h.NodeChannel=a;var e;(function(c){c[c.Position=0]="Position";c[c.Target=1]="Target";c[c.Up=2]="Up";c[c.Width=3]="Width";c[c.Height=4]="Height"})(e=h.CameraProperty||(h.CameraProperty={}));a=function(){function c(b,c,k){this.name=b;this.property=c;this.sampler=k;switch(this.property){case e.Position:case e.Target:case e.Up:if(k.buffer.keyType!==h.KeyType.Vec3)throw Error("Key type mismatch. Expected Vec3");break;case e.Width:case e.Height:if(k.buffer.keyType!==
h.KeyType.Scalar)throw Error("Key type mismatch. Expected Scalar");}}c.prototype._getValue=function(b,c){switch(this.property){case e.Position:null===c.position&&(c.position=new d.Point3(0,0,0));this.sampler.interpolateVec3(b,c.position);break;case e.Target:null===c.target&&(c.target=new d.Point3(0,0,-1));this.sampler.interpolateVec3(b,c.target);break;case e.Up:null===c.up&&(c.up=new d.Point3(0,1,0));this.sampler.interpolateVec3(b,c.up);break;case e.Width:c.width=this.sampler.interpolateScalar(b);
break;case e.Height:c.height=this.sampler.interpolateScalar(b)}};c.prototype._gatherForExport=function(b){b.samplers.add(this.sampler);this.sampler._gatherForExport(b)};c.prototype._export=function(b){var c={};""!==this.name&&(c.name=this.name);return __assign({property:e[this.property],sampler:b.samplers.getIndex(this.sampler)},c)};c._import=function(b,f){return new c(f.name||"",e[f.property],b.samplers[f.sampler])};return c}();h.CameraChannel=a})(d.Animation||(d.Animation={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){function g(a){for(var c=[],b=0;b<a.length;b++){var f=a[b];c.push([f.position,f.color.r,f.color.g,f.color.b])}return c}function a(a){for(var c=[],b=0;b<a.length;b++){var f=a[b];c.push({position:f[0],color:new d.Color(f[1],f[2],f[3])})}return c}h.exportAnimations=function(a){for(var c=new h.Internal.ExportContext,b=0;b<a.length;b++){var f=a[b];f._gatherForExport(c)}b={};if(!c.buffers.isEmpty()){b.buffers=[];f=0;for(var k=c.buffers.toArray();f<k.length;f++)b.buffers.push(k[f]._export())}if(!c.samplers.isEmpty())for(b.samplers=[],
f=0,k=c.samplers.toArray();f<k.length;f++)b.samplers.push(k[f]._export(c));if(!c.colorMaps.isEmpty())for(b.colorMaps=[],f=0,k=c.colorMaps.toArray();f<k.length;f++)b.colorMaps.push(g(k[f]));if(0!==a.length)for(b.animations=[],k=0;k<a.length;k++)f=a[k],b.animations.push(f._export(c));return __assign({},b)};h.importAnimations=function(e){var c=new h.Internal.ImportContext;if(void 0!==e.buffers)for(var b=0,f=e.buffers;b<f.length;b++)c.buffers.push(h.KeyframeBuffer._import(f[b]));if(void 0!==e.samplers)for(b=
0,f=e.samplers;b<f.length;b++)c.samplers.push(h.Sampler._import(c,f[b]));if(void 0!==e.colorMaps)for(b=0,f=e.colorMaps;b<f.length;b++)c.colorMaps.push(a(f[b]));b=[];if(void 0!==e.animations)for(f=0,e=e.animations;f<e.length;f++)b.push(h.Animation._import(c,e[f]));return b}})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){return function(){this.buffers=new e;this.samplers=new e;this.colorMaps=new e}}();g.ExportContext=a;a=function(){return function(){this.buffers=[];this.samplers=[];this.colorMaps=[]}}();g.ImportContext=a;var e=function(){function c(){this.map=new Map}c.prototype.add=function(b){this.map.has(b)||this.map.set(b,this.map.size)};c.prototype.getIndex=function(b){b=this.map.get(b);if(void 0===b)throw new d.InternalLogicError;return b};c.prototype.toArray=
function(){var b=[];this.map.forEach(function(c,a){b[c]=a});return b};c.prototype.isEmpty=function(){return 0===this.map.size};return c}();g.IndexedSet=e})(h.Internal||(h.Internal={}))})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g;(function(a){a[a.Scalar=1]="Scalar";a[a.Vec3=3]="Vec3";a[a.Quat=4]="Quat"})(g=d.KeyType||(d.KeyType={}));var a=function(){function a(c){this.keyType=c;this.times=[];this.values=[];this.tangents=[];this._hasTangents=null;this.keyOffset=c}a.prototype._validateKey=function(c){if(this.keyType!==c)throw Error("Cannot add keyframe of type: "+g[c]+" to buffer of type: "+g[this.keyType]);};a.prototype._validateTangents=function(c){if(null===this._hasTangents)this._hasTangents=
c;else if(this._hasTangents!==c)throw Error("Cannot add keyframe with"+(c?"":"out")+" tangents to buffer with"+(c?"out":"")+" tangents");};a.prototype._findIndexFromTime=function(c){for(var b=0;b<this.times.length;b++)if(this.times[b]>=c)return b;return this.times.length};a.prototype.getKeyframeIndex=function(c){return this.times.indexOf(c)};a.prototype.deleteKeyframe=function(c){this.times.splice(c,1);this.tangents.splice(c*this.keyOffset*2,2*this.keyOffset);this.values.splice(c*this.keyOffset,this.keyOffset)};
a.prototype.insertScalarKeyframe=function(c,b,f,a){this._validateKey(g.Scalar);var k=this._findIndexFromTime(c);this.times.splice(k,0,c);this.values.splice(k,0,b);void 0!==f&&void 0!==a?(this._validateTangents(!0),this.tangents.splice(2*k,0,f,a)):this._validateTangents(!1);return k};a.prototype.updateScalarKeyframe=function(c,b,f,a,e){this.values[c]=f;this.times[c]=b;void 0!==a&&void 0!==e&&(this.tangents[2*c]=a,this.tangents[2*c+1]=e)};a.prototype.insertVec3Keyframe=function(c,b,f,a,e,d,m,p,q,h){this._validateKey(g.Vec3);
var k=this._findIndexFromTime(c);this.times.splice(k,0,c);this.values.splice(k*this.keyOffset,0,b,f,a);void 0!==e&&void 0!==d&&void 0!==m&&void 0!==p&&void 0!==q&&void 0!==h?(this._validateTangents(!0),this.tangents.splice(k*this.keyOffset*2,0,e,d,m,p,q,h)):this._validateTangents(!1);return k};a.prototype.updateVec3Keyframe=function(c,b,f,a,e,d,g,p,q,h,t){this.times[c]=b;this.values[c*this.keyOffset]=f;this.values[c*this.keyOffset+1]=a;this.values[c*this.keyOffset+2]=e;void 0!==d&&void 0!==g&&void 0!==
p&&void 0!==q&&void 0!==h&&void 0!==t?(this._validateTangents(!0),this.tangents.splice(c*this.keyOffset*2,0,d,g,p,q,h,t),this.tangents[c*this.keyOffset*2]=d,this.tangents[c*this.keyOffset*2+1]=g,this.tangents[c*this.keyOffset*2+2]=p,this.tangents[c*this.keyOffset*2+3]=q,this.tangents[c*this.keyOffset*2+4]=h,this.tangents[c*this.keyOffset*2+5]=t):this._validateTangents(!1);return c};a.prototype.insertQuatKeyframe=function(c,b,f,a,e,d,m,p,q,h,t,u,w){this._validateKey(g.Quat);var k=this._findIndexFromTime(c);
this.times.splice(k,0,c);this.values.splice(k*this.keyOffset,0,b,f,a,e);void 0!==d&&void 0!==m&&void 0!==p&&void 0!==q&&void 0!==h&&void 0!==t&&void 0!==u&&void 0!==w?(this._validateTangents(!0),this.tangents.splice(k*this.keyOffset*2,0,d,m,p,q,h,t,u,w)):this._validateTangents(!1)};a.prototype.updateQuatKeyframe=function(c,b,f,a,e,d,g,p,q,h,t,u,w,v){this.times[c]=b;this.values[c*this.keyOffset]=f;this.values[c*this.keyOffset+1]=a;this.values[c*this.keyOffset+2]=e;this.values[c*this.keyOffset+3]=d;
void 0!==g&&void 0!==p&&void 0!==q&&void 0!==h&&void 0!==t&&void 0!==u&&void 0!==w&&void 0!==v?(this._validateTangents(!0),this.tangents.splice(c*this.keyOffset*2,0,g,p,q,t,u,w),this.tangents[c*this.keyOffset*2]=g,this.tangents[c*this.keyOffset*2+1]=p,this.tangents[c*this.keyOffset*2+2]=q,this.tangents[c*this.keyOffset*2+3]=v,this.tangents[c*this.keyOffset*2+4]=t,this.tangents[c*this.keyOffset*2+5]=u,this.tangents[c*this.keyOffset*2+6]=w,this.tangents[c*this.keyOffset*2+7]=v):this._validateTangents(!1)};
a.prototype._export=function(){var c={};0!==this.tangents.length&&(c.tangents=this.tangents.slice());return __assign({keyType:g[this.keyType],times:this.times.slice(),values:this.values.slice()},c)};a._import=function(c){var b=new a(g[c.keyType]);b.times=c.times.slice();b.values=c.values.slice();void 0!==c.tangents&&(b.tangents=c.tangents.slice());return b};return a}();d.KeyframeBuffer=a})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){var c=this;this._viewer=a;this._players=[];this._intervalHandle=null;this._batch=new d.BatchedValues;this._viewer.setCallbacks({assemblyTreeReady:function(){c.setTickInterval(50)}})}a.prototype.createPlayer=function(a){a=new d.Player(this._viewer,a);this._players.push(a);return a};a.prototype.removePlayerByIndex=function(a){if(a>=this._players.length)return!1;this._players.splice(a,1);return!0};a.prototype.removePlayer=function(a){for(var c=
0;c<this._players.length;c++)if(this._players[c]===a)return this._players.splice(c,1),!0;return!1};a.prototype.clear=function(){this._players=[]};a.prototype._tick=function(){if(0!==this._players.length){this._batch.clear();for(var a=!1,c=performance.now(),b=0,f=this._players;b<f.length;b++)f[b]._tick(c,this._batch)&&(a=!0);a&&(this._viewer.pauseRendering(),this._batch.apply(this._viewer),this._viewer.resumeRendering())}};a.prototype._shutdown=function(){null!==this._intervalHandle&&clearInterval(this._intervalHandle)};
a.prototype.setTickInterval=function(a){var c=this;this._intervalHandle&&clearInterval(this._intervalHandle);this._intervalHandle=setInterval(function(){c._tick()},a)};return a}();d.Manager=g})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(a){a[a.Stopped=0]="Stopped";a[a.Playing=1]="Playing";a[a.Paused=2]="Paused";a[a.Complete=3]="Complete"})(g=h.PlayerState||(h.PlayerState={}));var a=function(){function a(c,b){this._viewer=c;this.animation=b;this._nodeValues=new Map;this._disabledChannels=new Set;this._lastUpdate=this._currentTime=0;this.speed=1;this._animationTime=0;this._state=g.Stopped;this._loopCount=this.loop=0;this.onComplete=null;this.nodeIdOffset=0;this.reload()}a.prototype.setChannelEnabled=
function(c,b){b?this._disabledChannels.delete(c):this._disabledChannels.add(c)};a.prototype.reload=function(){this._nodeValues.clear();for(var c=this._animationTime=0,b=this.animation.nodeChannels;c<b.length;c++){var f=b[c],a=f.sampler.buffer.times.length;if(0!==a){if(!this._nodeValues.has(f.nodeId)){var e=new h.Internal.NodeValues(f.nodeId);e.pivotPoint=this.animation.pivotPoints.get(f.nodeId);this._nodeValues.set(f.nodeId,e)}this._animationTime=Math.max(this._animationTime,f.sampler.buffer.times[a-
1])}}c=0;for(b=this.animation.cameraChannels;c<b.length;c++)f=b[c],a=f.sampler.buffer.times.length,0!==a&&(this._animationTime=Math.max(this._animationTime,f.sampler.buffer.times[a-1]))};a.prototype._tick=function(c,b){if(this._state!==g.Playing)return!1;this._tickTime((c-this._lastUpdate)/1E3,b);this._lastUpdate=c;return!0};a.prototype._tickTime=function(c,b){if(this._state!==g.Playing)return!1;this._currentTime+=c*this.speed;c=0>this._currentTime;var f=this._currentTime>this._animationTime;if(c||
f)if(0>this.loop||this.loop>this._loopCount)this._loopCount+=1,this._currentTime=c?this._animationTime:0,this.evaluate(this._currentTime,b);else{if(this._currentTime=this._animationTime,this.evaluate(this._currentTime,b),this._state=g.Complete,this._loopCount=0,this.onComplete)this.onComplete()}else this.evaluate(this._currentTime,b);return!0};a.prototype.play=function(){this._state!==g.Playing&&(this._state===g.Complete&&(this._currentTime=0),this._lastUpdate=performance.now(),this._state=g.Playing)};
a.prototype.pause=function(){this._state===g.Playing&&(this._state=g.Paused)};a.prototype.stop=function(){this._state=g.Stopped;this.setTime(0)};a.prototype.setTime=function(c){var b=new h.BatchedValues;this._currentTime=Math.min(c,this._animationTime);this.evaluate(this._currentTime,b);b.apply(this._viewer)};a.prototype.evaluate=function(c,b){var f=this;void 0===b&&(b=new h.BatchedValues);for(var a=0,e=this.animation.nodeChannels;a<e.length;a++){var n=e[a],g=this._nodeValues.get(n.nodeId);void 0===
g||this._disabledChannels.has(n)||n._getValue(c,g)}this._nodeValues.forEach(function(c){if(void 0===b)throw new d.InternalLogicError;var a=c.nodeId+f.nodeIdOffset;(c.flags&h.Internal.NodeValuesFlags.Transform)===h.Internal.NodeValuesFlags.Transform&&(c.updateMatrix(),b.node.matrixNodeIds.push(a),b.node.matrices.push(c.matrix));(c.flags&h.Internal.NodeValuesFlags.Opacity)===h.Internal.NodeValuesFlags.Opacity&&b.node.opacities.set(a,c.opacity);(c.flags&h.Internal.NodeValuesFlags.Visibility)===h.Internal.NodeValuesFlags.Visibility&&
(0!==c.visibility?b.node.visibilityOn.push(a):b.node.visibilityOff.push(a));(c.flags&h.Internal.NodeValuesFlags.Color)===h.Internal.NodeValuesFlags.Color&&b.node.colors.set(a,new d.Color(c.color.x,c.color.y,c.color.z));c.flags=h.Internal.NodeValuesFlags.None});a=0;for(e=this.animation.cameraChannels;a<e.length;a++)n=e[a],0<n.sampler.buffer.times.length&&!this._disabledChannels.has(n)&&n._getValue(c,b.camera);return b};a.prototype.getState=function(){return this._state};a.prototype.getCurrentTime=
function(){return this._currentTime};a.prototype.getAnimationTime=function(){return this._animationTime};a.LoopIndefinitely=-1;return a}();h.Player=a})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,e,c){this.x=a;this.y=e;this.z=c}d.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};d.prototype.set=function(a,e,c){this.x=a;this.y=e;this.z=c;return this};d.prototype.toArray=function(a){a[0]=this.x;a[1]=this.y;a[2]=this.z};d.prototype.fromArray=function(a){this.x=a[0];this.y=a[1];this.z=a[2];return this};d.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};d.prototype.subtract=function(a){this.x-=a.x;this.y-=
a.y;this.z-=a.z;return this};d.prototype.copy=function(){return new d(this.x,this.y,this.z)};d.fromJson=function(a){return new d(a.x,a.y,a.z)};d.construct=function(a){return d.fromJson(a)};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{x:this.x,y:this.y,z:this.z}};d.prototype.forJson=function(){return this.toJson()};d.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z};d.prototype.equalsWithTolerance=function(a,e){return this.x-
a.x<e&&this.x-a.x>-e&&this.y-a.y<e&&this.y-a.y>-e&&this.z-a.z<e&&this.z-a.z>-e};d.prototype.isAxis=function(){return 1===Math.abs(this.x)&&0===this.y&&0===this.z||0===this.x&&1===Math.abs(this.y)&&0===this.z||0===this.x&&0===this.y&&1===Math.abs(this.z)};d.prototype.length=function(){return Math.sqrt(this.squaredLength())};d.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y+this.z*this.z};d.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};d.prototype.normalize=
function(){return this.scale(1/this.length())};d.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};d.zero=function(){return new d(0,0,0)};d.add=function(a,e){return new d(a.x+e.x,a.y+e.y,a.z+e.z)};d.subtract=function(a,e){return new d(a.x-e.x,a.y-e.y,a.z-e.z)};d.dot=function(a,e){return a.x*e.x+a.y*e.y+a.z*e.z};d.cross=function(a,e){return new d(a.y*e.z-a.z*e.y,a.z*e.x-a.x*e.z,a.x*e.y-a.y*e.x)};d.distance=function(a,e){return d.subtract(e,a).length()};d.scale=function(a,
e){return a.copy().scale(e)};d.createFromArray=function(a){return new d(a[0],a[1],a[2])};return d}();d.Point3=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this.loadIdentity()}g.prototype.loadIdentity=function(){this.m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};g.prototype.isIdentity=function(){var a=this.m;return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&0===a[12]&&0===a[13]&&0===a[14]&&1===a[15]};g.prototype.equals=function(a){for(var e=0;16>e;++e)if(this.m[e]!==a.m[e])return!1;return!0};g.prototype.equalsWithTolerance=function(a,
e){e=Math.abs(e);for(var c=0;16>c;++c)if(Math.abs(this.m[c]-a.m[c])>e)return!1;return!0};g.prototype.setScaleComponent=function(a,e,c){this.m[0]=a;this.m[5]=e;this.m[10]=c;return this};g.prototype.setTranslationComponent=function(a,e,c){this.m[12]=a;this.m[13]=e;this.m[14]=c;return this};g.prototype.copy=function(){var a=new g;a.m=this.m.slice();return a};g.prototype.assign=function(a){for(var e=0;e<a.m.length;e++)this.m[e]=a.m[e];return this};g.prototype.scale=function(a){return this.multiplyByScalar(a)};
g.prototype.multiplyByScalar=function(a){for(var e=0;16>e;e++)this.m[e]*=a;return this};g.prototype.transform=function(a,e){if(void 0===e)return e=d.Point3.zero(),this.transform(a,e),e;e.set(a.x*this.m[0]+a.y*this.m[4]+a.z*this.m[8]+this.m[12],a.x*this.m[1]+a.y*this.m[5]+a.z*this.m[9]+this.m[13],a.x*this.m[2]+a.y*this.m[6]+a.z*this.m[10]+this.m[14])};g.prototype.transform4=function(a,e){if(void 0===e)return e=d.Point4.zero(),this.transform4(a,e),e;e.set(a.x*this.m[0]+a.y*this.m[4]+a.z*this.m[8]+this.m[12]*
a.w,a.x*this.m[1]+a.y*this.m[5]+a.z*this.m[9]+this.m[13]*a.w,a.x*this.m[2]+a.y*this.m[6]+a.z*this.m[10]+this.m[14]*a.w,a.x*this.m[3]+a.y*this.m[7]+a.z*this.m[11]+this.m[15]*a.w)};g.prototype.transformArray=function(a,e){for(var c=0;c<a.length;c++){var b=a[c];b=new d.Point3(b.x*this.m[0]+b.y*this.m[4]+b.z*this.m[8]+this.m[12],b.x*this.m[1]+b.y*this.m[5]+b.z*this.m[9]+this.m[13],b.x*this.m[2]+b.y*this.m[6]+b.z*this.m[10]+this.m[14]);e[c]=b}};g.prototype.transformBox=function(a){if(a.isDegenerate())return d.Box.invalid();
a=a.getCorners();for(var e=0;e<a.length;e++){var c=a[e];this.transform(c,c)}e=new d.Box(a[0],a[0]);for(var b=1;b<a.length;++b)c=a[b],e.addPoint(c);return e};g.prototype.transpose=function(){var a=this.m[1];this.m[1]=this.m[4];this.m[4]=a;a=this.m[2];this.m[2]=this.m[8];this.m[8]=a;a=this.m[3];this.m[3]=this.m[12];this.m[12]=a;a=this.m[6];this.m[6]=this.m[9];this.m[9]=a;a=this.m[7];this.m[7]=this.m[13];this.m[13]=a;a=this.m[11];this.m[11]=this.m[14];this.m[14]=a;return this};g.createFromArray=function(a){var e=
new g;e.m=a.slice();return e};g.createFromOffAxisRotation=function(a,e){var c=Math.PI/180*e;e=Math.sin(c);c=Math.cos(c);var b=new g;a=a.copy().normalize();var f=1-c,k=f*a.x*a.y,d=f*a.x*a.z,n=f*a.y*a.z;b.m[0]=f*a.x*a.x+c;b.m[1]=e*a.z+k;b.m[2]=d-e*a.y;b.m[3]=0;b.m[4]=k-e*a.z;b.m[5]=f*a.y*a.y+c;b.m[6]=e*a.x+n;b.m[7]=0;b.m[8]=e*a.y+d;b.m[9]=n-e*a.x;b.m[10]=f*a.z*a.z+c;b.m[11]=0;b.m[12]=0;b.m[13]=0;b.m[14]=0;b.m[15]=1;return b};g.createFromBasis=function(a,e,c){var b=new g;b.m[0]=a.x;b.m[1]=a.y;b.m[2]=
a.z;b.m[4]=e.x;b.m[5]=e.y;b.m[6]=e.z;b.m[8]=c.x;b.m[9]=c.y;b.m[10]=c.z;return b};g.multiply=function(a,e){var c=new g;c.m[0]=a.m[0]*e.m[0]+a.m[1]*e.m[4]+a.m[2]*e.m[8]+a.m[3]*e.m[12];c.m[1]=a.m[0]*e.m[1]+a.m[1]*e.m[5]+a.m[2]*e.m[9]+a.m[3]*e.m[13];c.m[2]=a.m[0]*e.m[2]+a.m[1]*e.m[6]+a.m[2]*e.m[10]+a.m[3]*e.m[14];c.m[3]=a.m[0]*e.m[3]+a.m[1]*e.m[7]+a.m[2]*e.m[11]+a.m[3]*e.m[15];c.m[4]=a.m[4]*e.m[0]+a.m[5]*e.m[4]+a.m[6]*e.m[8]+a.m[7]*e.m[12];c.m[5]=a.m[4]*e.m[1]+a.m[5]*e.m[5]+a.m[6]*e.m[9]+a.m[7]*e.m[13];
c.m[6]=a.m[4]*e.m[2]+a.m[5]*e.m[6]+a.m[6]*e.m[10]+a.m[7]*e.m[14];c.m[7]=a.m[4]*e.m[3]+a.m[5]*e.m[7]+a.m[6]*e.m[11]+a.m[7]*e.m[15];c.m[8]=a.m[8]*e.m[0]+a.m[9]*e.m[4]+a.m[10]*e.m[8]+a.m[11]*e.m[12];c.m[9]=a.m[8]*e.m[1]+a.m[9]*e.m[5]+a.m[10]*e.m[9]+a.m[11]*e.m[13];c.m[10]=a.m[8]*e.m[2]+a.m[9]*e.m[6]+a.m[10]*e.m[10]+a.m[11]*e.m[14];c.m[11]=a.m[8]*e.m[3]+a.m[9]*e.m[7]+a.m[10]*e.m[11]+a.m[11]*e.m[15];c.m[12]=a.m[12]*e.m[0]+a.m[13]*e.m[4]+a.m[14]*e.m[8]+a.m[15]*e.m[12];c.m[13]=a.m[12]*e.m[1]+a.m[13]*e.m[5]+
a.m[14]*e.m[9]+a.m[15]*e.m[13];c.m[14]=a.m[12]*e.m[2]+a.m[13]*e.m[6]+a.m[14]*e.m[10]+a.m[15]*e.m[14];c.m[15]=a.m[12]*e.m[3]+a.m[13]*e.m[7]+a.m[14]*e.m[11]+a.m[15]*e.m[15];return c};g.prototype.inverseAndDeterminant=function(){var a=this.m[4]*this.m[9]-this.m[5]*this.m[8],e=this.m[4]*this.m[10]-this.m[6]*this.m[8],c=this.m[4]*this.m[11]-this.m[7]*this.m[8],b=this.m[4]*this.m[13]-this.m[5]*this.m[12],f=this.m[4]*this.m[14]-this.m[6]*this.m[12],k=this.m[4]*this.m[15]-this.m[7]*this.m[12],d=this.m[5]*
this.m[10]-this.m[6]*this.m[9],n=this.m[5]*this.m[11]-this.m[7]*this.m[9],m=this.m[5]*this.m[14]-this.m[6]*this.m[13],p=this.m[5]*this.m[15]-this.m[7]*this.m[13],q=this.m[6]*this.m[11]-this.m[7]*this.m[10],h=this.m[6]*this.m[15]-this.m[7]*this.m[14],t=this.m[8]*this.m[13]-this.m[9]*this.m[12],u=this.m[8]*this.m[14]-this.m[10]*this.m[12],w=this.m[8]*this.m[15]-this.m[11]*this.m[12],v=this.m[9]*this.m[14]-this.m[10]*this.m[13],y=this.m[9]*this.m[15]-this.m[11]*this.m[13],x=this.m[10]*this.m[15]-this.m[11]*
this.m[14],z=new g;z.m[0]=this.m[5]*x-this.m[6]*y+this.m[7]*v;z.m[1]=this.m[2]*y-this.m[3]*v-this.m[1]*x;z.m[2]=this.m[1]*h-this.m[2]*p+this.m[3]*m;z.m[3]=this.m[2]*n-this.m[3]*d-this.m[1]*q;z.m[4]=this.m[6]*w-this.m[7]*u-this.m[4]*x;z.m[5]=this.m[0]*x-this.m[2]*w+this.m[3]*u;z.m[6]=this.m[2]*k-this.m[3]*f-this.m[0]*h;z.m[7]=this.m[0]*q-this.m[2]*c+this.m[3]*e;z.m[8]=this.m[4]*y-this.m[5]*w+this.m[7]*t;z.m[9]=this.m[1]*w-this.m[3]*t-this.m[0]*y;z.m[10]=this.m[0]*p-this.m[1]*k+this.m[3]*b;z.m[11]=
this.m[1]*c-this.m[3]*a-this.m[0]*n;z.m[12]=this.m[5]*u-this.m[6]*t-this.m[4]*v;z.m[13]=this.m[0]*v-this.m[1]*u+this.m[2]*t;z.m[14]=this.m[1]*f-this.m[2]*b-this.m[0]*m;z.m[15]=this.m[0]*d-this.m[1]*e+this.m[2]*a;a=this.m[0]*z.m[0]-this.m[1]*-z.m[4]+this.m[2]*z.m[8]-this.m[3]*-z.m[12];if(0===a)return[null,0];z.multiplyByScalar(1/a);return[z,a]};g.inverse=function(a){return a.inverseAndDeterminant()[0]};g.prototype.upperLeft3x3Determinant=function(){return this.m[0]*(this.m[5]*this.m[10]-this.m[9]*
this.m[6])-this.m[4]*(this.m[1]*this.m[10]-this.m[9]*this.m[2])+this.m[8]*(this.m[1]*this.m[6]-this.m[5]*this.m[2])};g.prototype.normalMatrix=function(){var a=this.copy().setTranslationComponent(0,0,0).inverseAndDeterminant()[0];return a?a.transpose():null};g.prototype.toJson=function(){return this.m.slice()};g.prototype.forJson=function(){return this.toJson()};g.fromJson=function(a){return g.createFromArray(a)};g.construct=function(a){return g.fromJson(a)};g.toMatrix12=function(a){return[a[0],a[1],
a[2],a[4],a[5],a[6],a[8],a[9],a[10],a[12],a[13],a[14]]};g.xAxisRotation=function(a){var e=new g,c=d.Util.degreesToRadians(a);a=Math.cos(c);c=Math.sin(c);e.m[5]=a;e.m[6]=-c;e.m[9]=c;e.m[10]=a;return e};g.yAxisRotation=function(a){var e=new g,c=d.Util.degreesToRadians(a);a=Math.cos(c);c=Math.sin(c);e.m[0]=a;e.m[2]=c;e.m[8]=-c;e.m[10]=a;return e};g.zAxisRotation=function(a){var e=new g,c=d.Util.degreesToRadians(a);a=Math.cos(c);c=Math.sin(c);e.m[0]=a;e.m[1]=-c;e.m[4]=c;e.m[5]=a;return e};return g}();
d.Matrix=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e,c,b){this.x=a;this.y=e;this.z=c;this.w=b}g.prototype.set=function(a,e,c,b){this.x=a;this.y=e;this.z=c;this.w=b};g.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};g.prototype.copy=function(){return new g(this.x,this.y,this.z,this.w)};g.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w};g.prototype.equalsWithTolerance=function(a,e){return this.x-a.x<e&&this.x-a.x>-e&&this.y-a.y<e&&this.y-
a.y>-e&&this.z-a.z<e&&this.z-a.z>-e&&this.w-a.w<e&&this.w-a.w>-e};g.prototype.fromArray=function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this};g.prototype.toArray=function(a){a[0]=this.x;a[1]=this.y;a[2]=this.z;a[3]=this.w;return this};g.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this};g.prototype.magnitudeSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};g.prototype.magnitude=function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w)};g.prototype.normalize=function(){var a=this.magnitude();this.x/=a;this.y/=a;this.z/=a;this.w/=a};g.add=function(a,e){return new g(a.x+e.x,a.y+e.y,a.z+e.z,a.w+e.w)};g.subtract=function(a,e){return new g(a.x-e.x,a.y-e.y,a.z-e.z,a.w-e.w)};g.Identity=function(){return g.identity()};g.identity=function(){return new g(0,0,0,1)};g.toMatrix=function(a){var e=a.x*a.x+a.y*a.y+a.z*a.z+a.w*a.w;e=2/e;var c=a.x*e,b=a.y*e,f=a.z*e;e=a.w*c;var k=a.w*b,l=a.w*f;c*=
a.x;var n=a.x*b,g=a.x*f;b*=a.y;var p=a.y*f;a=a.z*f;f=new d.Matrix;f.m[0]=1-(b+a);f.m[1]=n+l;f.m[2]=g-k;f.m[3]=0;f.m[4]=n-l;f.m[5]=1-(c+a);f.m[6]=p+e;f.m[7]=0;f.m[8]=g+k;f.m[9]=p-e;f.m[10]=1-(c+b);f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;return f};g.createFromMatrix=function(a){var e=[],c=a.m[0]+a.m[5]+a.m[10];if(0<c){var b=Math.sqrt(c+1);e[3]=.5*b;b=.5/b;e[0]=b*(a.m[6]-a.m[9]);e[1]=b*(a.m[8]-a.m[2]);e[2]=b*(a.m[1]-a.m[4])}else{c=0;a.m[5]>a.m[0]&&(c=1);a.m[10]>a.m[4*c+c]&&(c=2);b=[1,2,0];
var f=b[c],k=b[f];b=Math.sqrt(a.m[4*c+c]-(a.m[4*f+f]+a.m[4*k+k])+1);e[c]=.5*b;b=.5/b;e[3]=b*(a.m[4*f+k]-a.m[4*k+f]);e[f]=b*(a.m[4*c+f]+a.m[4*f+c]);e[k]=b*(a.m[4*c+k]+a.m[4*k+c])}return g.identity().fromArray(e)};g.interpolate=function(a,e,c){var b=[],f=[],k=[];a.toArray(b);e.toArray(f);a=b[0]*f[0]+b[1]*f[1]+b[2]*f[2]+b[3]*f[3];if(1+a>g._epsilon){if(1-a>g._epsilon){e=g._arccos(a);var d=1/Math.sin(e);a=d*Math.sin((1-c)*e);c=d*Math.sin(c*e)}else a=1-c;for(e=0;4>e;++e)k[e]=a*b[e]+c*f[e]}else for(k[0]=
-b[1],k[1]=b[0],k[2]=-b[3],k[3]=b[2],a=Math.sin(.5*Math.PI*(1-c)),c=Math.sin(.5*Math.PI*c),e=0;3>e;++e)k[e]=a*b[e]+c*k[e];return g.identity().fromArray(k)};g._arccos=function(a){return-1>a?Math.PI:1<a?0:Math.acos(a)};g._epsilon=1E-5;return g}();d.Quaternion=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(a){a[a.Constant=0]="Constant";a[a.Linear=1]="Linear";a[a.CubicSpline=2]="CubicSpline"})(g=h.InterpolationType||(h.InterpolationType={}));var a=function(){function a(c,b){this.buffer=c;this.interpolationType=b}a.prototype._getNextKeyframeIndex=function(c){for(var b=0;b<this.buffer.times.length;b+=1)if(this.buffer.times[b]>c)return b;return this.buffer.times.length};a.prototype.interpolateQuat=function(c,b){var f=this._getNextKeyframeIndex(c);if(0===f)this._setQuatFromKeyframeIndex(0,
b);else if(f===this.buffer.times.length)this._setQuatFromKeyframeIndex(f-1,b);else switch(this.interpolationType){case g.Constant:this._setQuatFromKeyframeIndex(f-1,b);break;case g.Linear:this.interpolateQuatSlerp(f-1,f,c,b);break;case g.CubicSpline:this.interpolateQuatCubicSpline(f-1,f,c,b)}};a.prototype.interpolateVec3=function(c,b){var f=this._getNextKeyframeIndex(c);if(0===f)this._setVecFromKeyframeIndex(0,b);else if(f===this.buffer.times.length)this._setVecFromKeyframeIndex(f-1,b);else switch(this.interpolationType){case g.Constant:this._setVecFromKeyframeIndex(f-
1,b);break;case g.Linear:this.interpolateVec3Linear(f-1,f,c,b);break;case g.CubicSpline:this.interpolateVec3CubicSpline(f-1,f,c,b)}};a.prototype.interpolateScalar=function(c){var b=this._getNextKeyframeIndex(c);if(0===b)return this.buffer.values[0];if(b===this.buffer.times.length)return this.buffer.values[b-1];switch(this.interpolationType){case g.Constant:return this.buffer.values[b-1];case g.Linear:return this.interpolateScalarLinear(b-1,b,c);case g.CubicSpline:return this.interpolateScalarCubicSpline(b-
1,b,c)}};a.prototype.interpolateScalarLinear=function(c,b,f){var a=this.buffer.values[c];return a+(f-this.buffer.times[c])/(this.buffer.times[b]-this.buffer.times[c])*(this.buffer.values[b]-a)};a.prototype.interpolateQuatSlerp=function(c,b,f,k){f=(f-this.buffer.times[c])/(this.buffer.times[b]-this.buffer.times[c]);this._setQuatFromKeyframeIndex(c,a.q0);this._setQuatFromKeyframeIndex(b,a.q1);k.assign(d.Quaternion.interpolate(a.q0,a.q1,f))};a._interpVec3=function(c,b,f,a){b.subtract(c);b.scale(f);b.add(c);
a.assign(b)};a.prototype.interpolateVec3Linear=function(c,b,f,k){f=(f-this.buffer.times[c])/(this.buffer.times[b]-this.buffer.times[c]);this._setVecFromKeyframeIndex(c,a.v0);this._setVecFromKeyframeIndex(b,a.v1);a._interpVec3(a.v0,a.v1,f,k)};a.prototype._interpCubicSpline=function(c,b,f,a,d){var k=Math.pow(c,2),e=Math.pow(c,3);return(2*e-3*k+1)*b+(e-2*k+c)*a+(-2*e+3*k)*f+(e-k)*d};a.prototype.interpolateScalarCubicSpline=function(c,b,f){var a=this.buffer.times[b]-this.buffer.times[c];f=(f-this.buffer.times[c])/
a;var d=this.buffer.values[c],e=this.buffer.values[b],g=0,p=0;0!==this.buffer.tangents.length&&(g=this.buffer.tangents[c]*a,p=this.buffer.tangents[b]*a);return this._interpCubicSpline(f,d,e,g,p)};a.prototype.interpolateVec3CubicSpline=function(c,b,f,k){var d=this.buffer.times[b]-this.buffer.times[c];f=(f-this.buffer.times[c])/d;this._setVecFromKeyframeIndex(c,a.v0);this._setVecFromKeyframeIndex(b,a.v1);this._setVecTanFromKeyframeIndex(c,a.v2);this._setVecTanFromKeyframeIndex(b,a.v3);a.v2.scale(d);
a.v3.scale(d);k.set(this._interpCubicSpline(f,a.v0.x,a.v1.x,a.v2.x,a.v3.x),this._interpCubicSpline(f,a.v0.y,a.v1.y,a.v2.y,a.v3.y),this._interpCubicSpline(f,a.v0.z,a.v1.z,a.v2.z,a.v3.z))};a.prototype.interpolateQuatCubicSpline=function(c,b,f,k){var d=this.buffer.times[b]-this.buffer.times[c];f=(f-this.buffer.times[c])/d;this._setQuatFromKeyframeIndex(c,a.q0);this._setQuatFromKeyframeIndex(b,a.q1);this._setQuatTanFromKeyframeIndex(c,a.q2);this._setQuatTanFromKeyframeIndex(b,a.q3);a.q4.set(a.q2.x*d,
a.q2.y*d,a.q2.z*d,a.q2.w*d);a.q5.set(a.q3.x*d,a.q3.y*d,a.q3.z*d,a.q3.w*d);k.set(this._interpCubicSpline(f,a.q0.x,a.q1.x,a.q4.x,a.q5.x),this._interpCubicSpline(f,a.q0.y,a.q1.y,a.q4.y,a.q5.y),this._interpCubicSpline(f,a.q0.z,a.q1.z,a.q4.z,a.q5.z),this._interpCubicSpline(f,a.q0.w,a.q1.w,a.q4.w,a.q5.w));k.normalize()};a.prototype._setVecFromKeyframeIndex=function(c,b){c*=3;b.set(this.buffer.values[c],this.buffer.values[c+1],this.buffer.values[c+2])};a.prototype._setVecTanFromKeyframeIndex=function(c,
b){0===this.buffer.tangents.length?b.set(0,0,0):(c*=3,b.set(this.buffer.tangents[c],this.buffer.tangents[c+1],this.buffer.tangents[c+2]))};a.prototype._setQuatFromKeyframeIndex=function(c,b){c*=4;b.set(this.buffer.values[c],this.buffer.values[c+1],this.buffer.values[c+2],this.buffer.values[c+3])};a.prototype._setQuatTanFromKeyframeIndex=function(c,b){0===this.buffer.tangents.length?b.set(0,0,0,1):(c*=4,b.set(this.buffer.tangents[c],this.buffer.tangents[c+1],this.buffer.tangents[c+2],this.buffer.tangents[c+
3]))};a.prototype._gatherForExport=function(c){c.buffers.add(this.buffer)};a.prototype._export=function(c){return{buffer:c.buffers.getIndex(this.buffer),interpolationType:g[this.interpolationType]}};a._import=function(c,b){return new a(c.buffers[b.buffer],g[b.interpolationType])};a.q0=d.Quaternion.identity();a.q1=d.Quaternion.identity();a.q2=d.Quaternion.identity();a.q3=d.Quaternion.identity();a.q4=d.Quaternion.identity();a.q5=d.Quaternion.identity();a.v0=d.Point3.zero();a.v1=d.Point3.zero();a.v2=
d.Point3.zero();a.v3=d.Point3.zero();return a}();h.Sampler=a})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){function a(a,c,b,f){var k=new d.KeyframeBuffer(b===d.CameraProperty.Width||b===d.CameraProperty.Height?d.KeyType.Scalar:d.KeyType.Vec3);f=new d.Sampler(k,f);return a.createCameraChannel(c,b,f)}g.createCameraChannels=function(e,c,b){var f=[];f.push(a(e,c+"-Position",d.CameraProperty.Position,b));f.push(a(e,c+"-Target",d.CameraProperty.Target,b));f.push(a(e,c+"-Up",d.CameraProperty.Up,b));f.push(a(e,c+"-Width",d.CameraProperty.Width,b));f.push(a(e,c+"-Height",
d.CameraProperty.Height,b));return f};g.keyframeCamera=function(a,c,b){var f=c.getPosition();b.cameraChannels[0].sampler.buffer.insertVec3Keyframe(a,f.x,f.y,f.z);f=c.getTarget();b.cameraChannels[1].sampler.buffer.insertVec3Keyframe(a,f.x,f.y,f.z);f=c.getUp();b.cameraChannels[2].sampler.buffer.insertVec3Keyframe(a,f.x,f.y,f.z);b.cameraChannels[3].sampler.buffer.insertScalarKeyframe(a,c.getWidth());b.cameraChannels[4].sampler.buffer.insertScalarKeyframe(a,c.getHeight())}})(d.Util||(d.Util={}))})(d.Animation||
(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a;(function(c){c[c.None=0]="None";c[c.Transform=1]="Transform";c[c.Opacity=2]="Opacity";c[c.Visibility=4]="Visibility";c[c.Color=8]="Color"})(a=g.NodeValuesFlags||(g.NodeValuesFlags={}));var e=function(){function c(b){this.nodeId=b;this.translate=d.Point3.zero();this.rotation=d.Quaternion.identity();this.scale=new d.Point3(1,1,1);this.color=new d.Point3(1,1,1);this.pivotPoint=null;this.visibility=this.opacity=1;this.matrix=new d.Matrix;this.flags=a.None}
c.prototype.updateMatrix=function(){this.pivotPoint?this._updateMatrixWithOrigin():this._updateMatrix()};c.prototype._updateMatrixWithOrigin=function(){var b=this.rotation.x,c=this.rotation.y,a=this.rotation.z,d=this.rotation.w,e=b+b,g=c+c,p=a+a,q=b*e,h=b*g,t=b*p;b=c*g;c*=p;var u=a*p;e*=d;var w=d*g,v=d*p,y=this.scale.x,x=this.scale.y,z=this.scale.z;d=this.pivotPoint.x;p=this.pivotPoint.y;g=this.pivotPoint.z;a=(1-(b+u))*y;var A=(h+v)*y;y*=t-w;h=(h-v)*x;u=(1-(q+u))*x;x*=c+e;t=(t+w)*z;c=(c-e)*z;q=(1-
(q+b))*z;this.matrix.m[0]=a;this.matrix.m[1]=A;this.matrix.m[2]=y;this.matrix.m[3]=0;this.matrix.m[4]=h;this.matrix.m[5]=u;this.matrix.m[6]=x;this.matrix.m[7]=0;this.matrix.m[8]=t;this.matrix.m[9]=c;this.matrix.m[10]=q;this.matrix.m[11]=0;this.matrix.m[12]=this.translate.x+d-(a*d+h*p+t*g);this.matrix.m[13]=this.translate.y+p-(A*d+u*p+c*g);this.matrix.m[14]=this.translate.z+g-(y*d+x*p+q*g);this.matrix.m[15]=1};c.prototype._updateMatrix=function(){var b=this.rotation.x,c=this.rotation.y,a=this.rotation.z,
d=this.rotation.w,e=b+b,g=c+c,p=a+a,q=b*e,h=b*g;b*=p;var t=c*g;c*=p;a*=p;e*=d;g*=d;d*=p;p=this.scale.x;var u=this.scale.y,w=this.scale.z;this.matrix.m[0]=(1-(t+a))*p;this.matrix.m[1]=(h+d)*p;this.matrix.m[2]=(b-g)*p;this.matrix.m[3]=0;this.matrix.m[4]=(h-d)*u;this.matrix.m[5]=(1-(q+a))*u;this.matrix.m[6]=(c+e)*u;this.matrix.m[7]=0;this.matrix.m[8]=(b+g)*w;this.matrix.m[9]=(c-e)*w;this.matrix.m[10]=(1-(q+t))*w;this.matrix.m[11]=0;this.matrix.m[12]=this.translate.x;this.matrix.m[13]=this.translate.y;
this.matrix.m[14]=this.translate.z;this.matrix.m[15]=1};return c}();g.NodeValues=e})(h.Internal||(h.Internal={}))})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function c(){this.height=this.width=this.up=this.target=this.position=null}c.prototype.clear=function(){this.height=this.width=this.up=this.target=this.position=null};c.prototype.apply=function(b){var c=!1;null!==this.position&&(b.setPosition(this.position),c=!0);null!==this.target&&(b.setTarget(this.target),c=!0);null!==this.up&&(b.setUp(this.up),c=!0);null!==this.width&&(b.setWidth(this.width),c=!0);null!==this.height&&(b.setHeight(this.height),c=!0);return c};
return c}();d.BatchedCameraValues=g;var a=function(){function c(){this.opacities=new Map;this.colors=new Map;this.matrixNodeIds=[];this.matrices=[];this.visibilityOn=[];this.visibilityOff=[]}c.prototype.clear=function(){this.opacities.clear();this.colors.clear();this.matrixNodeIds=[];this.matrices=[];this.visibilityOn=[];this.visibilityOff=[]};c.prototype.apply=function(b){b=b.model;0<this.opacities.size&&b.setNodesOpacities(this.opacities);0<this.colors.size&&b.setNodesColors(this.colors);0<this.matrixNodeIds.length&&
b._setNodesMatrices(this.matrixNodeIds,this.matrices);0<this.visibilityOn.length&&b.setNodesVisibility(this.visibilityOn,!0);0<this.visibilityOff.length&&b.setNodesVisibility(this.visibilityOff,!1)};return c}();d.BatchedNodeValues=a;var e=function(){function c(){this.node=new a;this.camera=new g}c.prototype.clear=function(){this.node.clear();this.camera.clear()};c.prototype.apply=function(b){this.node.apply(b);b=b.view;var c=b.getCamera();this.camera.apply(c)&&b.setCamera(c)};return c}();d.BatchedValues=
e})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
var __awaiter=this&&this.__awaiter||function(d,h,g,a){return new (g||(g=Promise))(function(e,c){function b(b){try{k(a.next(b))}catch(n){c(n)}}function f(b){try{k(a["throw"](b))}catch(n){c(n)}}function k(c){c.done?e(c.value):(new g(function(b){b(c.value)})).then(b,f)}k((a=a.apply(d,h||[])).next())})},__generator=this&&this.__generator||function(d,h){function g(b){return function(c){return a([b,c])}}function a(a){if(c)throw new TypeError("Generator is already executing.");for(;e;)try{if(c=1,b&&(f=a[0]&
2?b["return"]:a[0]?b["throw"]||((f=b["return"])&&f.call(b),0):b.next)&&!(f=f.call(b,a[1])).done)return f;if(b=0,f)a=[a[0]&2,f.value];switch(a[0]){case 0:case 1:f=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++;b=a[1];a=[0];continue;case 7:a=e.ops.pop();e.trys.pop();continue;default:if(!(f=e.trys,f=0<f.length&&f[f.length-1])&&(6===a[0]||2===a[0])){e=0;continue}if(3===a[0]&&(!f||a[1]>f[0]&&a[1]<f[3]))e.label=a[1];else if(6===a[0]&&e.label<f[1])e.label=f[1],f=a;else if(f&&e.label<
f[2])e.label=f[2],e.ops.push(a);else{f[2]&&e.ops.pop();e.trys.pop();continue}}a=h.call(d,e)}catch(n){a=[6,n],b=0}finally{c=f=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var e={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},c,b,f,k;return k={next:g(0),"throw":g(1),"return":g(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k};
(function(d){var h;(function(a){a[a.Unknown=0]="Unknown";a[a.v1_0=1]="v1_0";a[a.v2_0=2]="v2_0";a[a.v2_1=3]="v2_1"})(h=d.BCFVersion||(d.BCFVersion={}));(function(a){a[a.Unknown=0]="Unknown";a[a.TopicFolder=1]="TopicFolder";a[a.Version=2]="Version";a[a.Markup=3]="Markup";a[a.Snapshot=4]="Snapshot";a[a.Viewpoint=5]="Viewpoint";a[a.Schema=6]="Schema";a[a.Project=7]="Project"})(d.BCFFileType||(d.BCFFileType={}));var g=function(){function a(a,c){this._version=h.Unknown;this._topicsMap=new Map;this._bcfFileName=
a;this._id=c}a.prototype.exportBCF=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this.toBcfZipBlob().then(function(b){var c=document.createElement("a"),k=URL.createObjectURL(b);c.href=k;c.download=a+".bcf";document.body.appendChild(c);c.click();setTimeout(function(){document.body.removeChild(c);URL.revokeObjectURL(k)},0)})];case 1:return c.sent(),[2]}})})};a.prototype.toBcfZipBlob=function(){var a=new XMLSerializer,c=
new JSZip;c.file("bcf.version",'<?xml version="1.0" encoding="UTF-8"?><Version VersionId="2.1" xsi:noNamespaceSchemaLocation="version.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><DetailedVersion>2.1</DetailedVersion></Version>');this._topicsMap.forEach(function(b,f){var k=c.folder(f);null===k?console.error("Failed to create folder for BCF topic"):(f=a.serializeToString(b.getMarkup().export()),k.file("markup.bcf",f),b.getViewpointMap().forEach(function(b,c){b=a.serializeToString(b.export());
k.file(c,b)}),b.getSnapshotMap().forEach(function(b,c){k.file(c,b.getData())}))});return c.generateAsync({type:"blob"})};a.prototype.addTopic=function(a,c){this._topicsMap.set(a,c)};a.prototype.getTopics=function(){return this._topicsMap};a.prototype.getTopic=function(a){return this._topicsMap.get(a)||null};a.prototype.getVersion=function(){return this._version};a.prototype.setVersion=function(a){this._version=a};a.prototype.getFilename=function(){return this._bcfFileName};a.prototype.getId=function(){return this._id};
return a}();d.BCFData=g})(Communicator||(Communicator={}));
(function(d){function h(b,c,f){void 0!==f&&null!==f&&b.setAttribute(c,f)}function g(b,c,f,a){b=b.createElement(f);b.innerHTML=a;c.appendChild(b)}function a(b,c,f,a){void 0!==a&&null!==a&&g(b,c,f,a)}function e(b){return void 0===b||null===b?null:b.toISOString()}function c(b){return void 0===b||null===b?null:b.toString()}function b(b){return void 0===b||null===b?null:b?"true":"false"}var f=function(){function b(b,c,f,a,k,d){this._ifcProject=b;this._ifcSpatialStructureElement=c;this._isExternal=f;this._filename=
a;this._date=k;this._reference=d}b.prototype.getIfcProject=function(){return this._ifcProject||null};b.prototype.getIfcSpacialStructureElement=function(){return this._ifcSpatialStructureElement||null};b.prototype.getIsExternal=function(){return this._isExternal||null};b.prototype.getBimFilename=function(){return this._filename||null};b.prototype.getBimDate=function(){return this._date||null};b.prototype.getReference=function(){return this._reference||null};return b}();d.BCFMarkupHeaderFile=f;var k=
function(){function b(b,c,f,a){this._index=this._snapshotFilename=this._viewpointFilename=void 0;this._guid=b;this._viewpointFilename=c;this._snapshotFilename=f;void 0!==a&&(this._index=parseInt(a,10))}b.prototype.getGuid=function(){return this._guid};b.prototype.getViewpointFilename=function(){return this._viewpointFilename||null};b.prototype.getSnapshotFilename=function(){return this._snapshotFilename||null};b.prototype.getIndex=function(){return this._index||null};return b}();d.BCFMarkupViewpoint=
k;var l=function(){function b(b,c,f,a,k,d,e){this._guid=b;this._date=c;this._author=f;this._text=a;this._viewpointGuid=k;this._modifiedDate=d;this._modifiedAuthor=e}b.prototype.getId=function(){return this._guid};b.prototype.getDate=function(){return this._date};b.prototype.setDate=function(b){this._date=b};b.prototype.getAuthor=function(){return this._author};b.prototype.setAuthor=function(b){this._author=b};b.prototype.getText=function(){return this._text};b.prototype.setText=function(b){this._text=
b};b.prototype.getViewpointGuid=function(){return this._viewpointGuid||null};b.prototype.setViewpointGuid=function(b){this._viewpointGuid=null!==b?b:void 0};b.prototype.getModifiedDate=function(){return this._modifiedDate||null};b.prototype.setModifiedDate=function(b){this._modifiedDate=null!==b?b:void 0};b.prototype.getModifiedAuthor=function(){return this._modifiedAuthor||null};b.prototype.setModifiedAuthor=function(b){this._modifiedAuthor=null!==b?b:void 0};return b}();d.BCFComment=l;var n=function(){function n(b,
c,f){this._markupHeaderFiles=[];this._topic={guid:"",title:"",creationDate:new Date,creationAuthor:""};this._comments=new Map;this._viewpoints=new Map;this._filename=b;this._bcfTopic=f;this._parseDocument(c)}n.prototype._parseDocument=function(b){if(null!==b)for(b=b.documentElement.firstElementChild;null!==b;){var c=b.localName;if(null===c)break;switch(c){case "Header":this._parseHeader(b);break;case "Topic":this._parseTopic(b);break;case "Comment":this._parseComment(b);break;case "Viewpoints":this._parseViewpoint(b)}b=
b.nextElementSibling}};n.prototype._exportHeader=function(c){var f=c.createElement("Header");h(f,"ProjectGuid",this._projectGuid);this._markupHeaderFiles.forEach(function(k){var d=c.createElement("File");h(d,"IfcProject",k.getIfcProject());h(d,"IfcSpatialStructureElement",k.getIfcSpacialStructureElement());h(d,"isExternal",b(k.getIsExternal()));a(c,d,"Filename",k.getBimFilename());a(c,d,"Date",e(k.getBimDate()));a(c,d,"Reference",k.getReference());f.appendChild(d)});return f};n.prototype._exportTopicData=
function(b){var f=b.createElement("Topic");f.setAttribute("Guid",this._topic.guid);h(f,"TopicType",this._topic.topicType);h(f,"TopicStatus",this._topic.topicStatus);g(b,f,"Title",this._topic.title);g(b,f,"CreationDate",this._topic.creationDate.toISOString());g(b,f,"CreationAuthor",this._topic.creationAuthor);a(b,f,"ReferenceLink",this._topic.referenceLink);a(b,f,"Priority",this._topic.priority);a(b,f,"Index",c(this._topic.index));a(b,f,"ModifiedDate",e(this._topic.modifiedDate));a(b,f,"ModifiedAuthor",
this._topic.modifiedAuthor);a(b,f,"DueDate",e(this._topic.dueDate));a(b,f,"AssignedTo",this._topic.assignedTo);a(b,f,"Description",this._topic.description);a(b,f,"Stage",this._topic.stage);if(this._topic.labels){var k=b.createElement("Labels");this._topic.labels.forEach(function(c){g(b,k,"Label",c)});f.appendChild(k)}return f};n.prototype._exportBimSnippet=function(c,f){var k=c.createElement("BimSnippet");k.setAttribute("SnippetType",f.snippetType);h(k,"isExternal",b(f.isExternal));g(c,k,"Reference",
f.reference);a(c,k,"ReferenceSchema",f.referenceSchema);return k};n.prototype._exportDocumentReference=function(c,f){var k=c.createElement("DocumentReference");h(k,"Guid",f.guid);h(k,"isExternal",b(f.isExternal));a(c,k,"ReferencedDocument",f.referencedDocument);a(c,k,"Description",f.description);return k};n.prototype._exportRelatedTopic=function(b,c){b=b.createElement("RelatedTopic");b.setAttribute("Guid",c.guid);return b};n.prototype._exportTopic=function(b){var c=this,f=this._exportTopicData(b);
this._topic.bimSnippets&&this._topic.bimSnippets.forEach(function(a){f.appendChild(c._exportBimSnippet(b,a))});this._topic.documentReferences&&this._topic.documentReferences.forEach(function(a){f.appendChild(c._exportDocumentReference(b,a))});this._topic.relatedTopics&&this._topic.relatedTopics.forEach(function(a){f.appendChild(c._exportRelatedTopic(b,a))});return f};n.prototype._exportComment=function(b,c){var f=b.createElement("Comment");f.setAttribute("Guid",c.getId());g(b,f,"Date",c.getDate().toISOString());
g(b,f,"Author",c.getAuthor());g(b,f,"Comment",c.getText());a(b,f,"ModifiedDate",e(c.getModifiedDate()));a(b,f,"ModifiedAuthor",c.getModifiedAuthor());if(c=c.getViewpointGuid())b=b.createElement("Viewpoint"),b.setAttribute("Guid",c),f.appendChild(b);return f};n.prototype._exportViewpoint=function(b,f){var k=b.createElement("Viewpoints");k.setAttribute("Guid",f.getGuid());a(b,k,"Viewpoint",f.getViewpointFilename());a(b,k,"Snapshot",f.getSnapshotFilename());a(b,k,"Index",c(f.getIndex()));return k};n.prototype.export=
function(){var b=this,c=document.implementation.createDocument("","",null),f=c.createElement("Markup");f.appendChild(this._exportHeader(c));f.appendChild(this._exportTopic(c));this._comments.forEach(function(a){f.appendChild(b._exportComment(c,a))});this._viewpoints.forEach(function(a){f.appendChild(b._exportViewpoint(c,a))});c.appendChild(f);return c};n.prototype.getIfcProject=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIfcProject()||void 0};n.prototype.getIfcSpacialStructureElement=
function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIfcSpacialStructureElement()||void 0};n.prototype.getIsExternal=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIsExternal()||void 0};n.prototype.getBimFilename=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getBimFilename()||void 0};n.prototype.getBimDate=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getBimDate()||void 0};n.prototype.getReference=function(){var b=this._markupHeaderFiles[0];
if(void 0!==b)return b.getReference()||void 0};n.prototype.getProjectGuid=function(){return this._projectGuid||null};n.prototype.getMarkupHeaderFiles=function(){return this._markupHeaderFiles};n.prototype.getFilename=function(){return this._filename};n.prototype.getTopicId=function(){return this._topic.guid};n.prototype.setTopicId=function(b){this._topic.guid=b};n.prototype.getTopicType=function(){return this._topic.topicType||null};n.prototype.setTopicType=function(b){this._topic.topicType=null!==
b?b:void 0};n.prototype.getTopicStatus=function(){return this._topic.topicStatus||null};n.prototype.setTopicStatus=function(b){this._topic.topicStatus=null!==b?b:void 0};n.prototype.getTopicTitle=function(){return this._topic.title};n.prototype.setTopicTitle=function(b){this._topic.title=b};n.prototype.getTopicCreationDate=function(){return this._topic.creationDate};n.prototype.setTopicCreationDate=function(b){this._topic.creationDate=b};n.prototype.getTopicCreationAuthor=function(){return this._topic.creationAuthor};
n.prototype.setTopicCreationAuthor=function(b){this._topic.creationAuthor=b};n.prototype.getTopicReferenceLink=function(){return this._topic.referenceLink||null};n.prototype.setTopicReferenceLink=function(b){this._topic.referenceLink=null===b?void 0:b};n.prototype.getTopicPriority=function(){return this._topic.priority||null};n.prototype.setTopicPriority=function(b){this._topic.priority=null===b?void 0:b};n.prototype.getTopicIndex=function(){return this._topic.index||null};n.prototype.setTopicIndex=
function(b){this._topic.index=null===b?void 0:b};n.prototype.getTopicLabels=function(){return void 0===this._topic.labels?[]:this._topic.labels.slice()};n.prototype.setTopicLabels=function(b){this._topic.labels=b.slice()};n.prototype.getTopicModifiedDate=function(){return this._topic.modifiedDate||null};n.prototype.setTopicModifiedDate=function(b){this._topic.modifiedDate=null===b?void 0:b};n.prototype.getTopicModifiedAuthor=function(){return this._topic.modifiedAuthor||null};n.prototype.setTopicModifiedAuthor=
function(b){this._topic.modifiedAuthor=null===b?void 0:b};n.prototype.getTopicDueDate=function(){return this._topic.dueDate||null};n.prototype.setTopicDueDate=function(b){this._topic.dueDate=null===b?void 0:b};n.prototype.getTopicAssignedTo=function(){return this._topic.assignedTo||null};n.prototype.setTopicAssignedTo=function(b){this._topic.assignedTo=null===b?void 0:b};n.prototype.getTopicDescription=function(){return this._topic.description||null};n.prototype.setTopicDescription=function(b){this._topic.description=
null===b?void 0:b};n.prototype.getTopicStage=function(){return this._topic.stage||null};n.prototype.setTopicState=function(b){this._topic.stage=null===b?void 0:b};n.prototype.getComments=function(){return this._comments};n.prototype.addComment=function(b,c,f,a,k,e){var n=d.UUID.create();b=new l(n,b,c,f,a,k,e);this._comments.set(n,b);return b};n.prototype.updateComment=function(b){var c=b.getId();this._comments.set(c,b)};n.prototype.deleteComment=function(b){this._comments.delete(b)};n.prototype.getViewpoints=
function(){return this._viewpoints};n.prototype._addFile=function(b){var c=this._getElementAttributes(b),a=this._getChildData(b);b=a.get("Date");b=void 0===b?void 0:new Date(b);var k=a.get("Filename");a=a.get("Reference");var d=c.get("IfcProject"),e=c.get("IfcSpatialStructureElement");c="true"===c.get("isExternal");this._markupHeaderFiles.push(new f(d,e,c,k,b,a))};n.prototype._parseHeader=function(b){var c=this._getElementAttributes(b).get("ProjectGuid");void 0!==c&&(this._projectGuid=c);b=b.firstElementChild;
null!==b&&this._addFile(b)};n.prototype._parseTopic=function(b){var c=this._getElementAttributes(b),f=c.get("Guid");if(void 0!==f&&(this._topic.guid=f,this._topic.topicType=c.get("TopicType")||c.get("Status"),this._topic.topicStatus=c.get("TopicStatus")||c.get("VerbalStatus"),b=b.firstElementChild,null!==b))for(;null!==b;){var a=b.localName;if(null===a)break;c=this._getChildData(b);f=this._getElementAttributes(b);switch(a){case "BimSnippet":void 0===this._topic.bimSnippets&&(this._topic.bimSnippets=
[]);a=c.get("Reference");var k=f.get("SnippetType");void 0!==a&&void 0!==k&&(a={snippetType:k,reference:a},f.get("isExternal")&&(a.isExternal="true"===f.get("isExternal")),c.get("ReferenceSchema")&&(a.referenceSchema=c.get("ReferenceSchema")),this._topic.bimSnippets.push(a));break;case "DocumentReference":void 0===this._topic.documentReferences&&(this._topic.documentReferences=[]);f={};c.get("Guid")&&(f.guid=c.get("Guid"));c.get("isExternal")&&(f.isExternal="true"===c.get("isExternal"));c.get("Description")&&
(f.description=c.get("Description"));c.get("ReferencedDocument")&&(f.referencedDocument=c.get("ReferencedDocument"));this._topic.documentReferences.push(f);break;case "RelatedTopic":void 0===this._topic.relatedTopics&&(this._topic.relatedTopics=[]);c=c.get("Guid");void 0!==c&&this._topic.relatedTopics.push({guid:c});break;case "ReferenceLink":b.textContent&&(this._topic.referenceLink=b.textContent);break;case "Title":b.textContent&&(this._topic.title=b.textContent);break;case "Priority":b.textContent&&
(this._topic.priority=b.textContent);break;case "Index":b.textContent&&(this._topic.index=parseInt(b.textContent,10));break;case "Labels":c=b.firstChild;if(!c)break;void 0===this._topic.labels&&(this._topic.labels=[]);for(;c;)c.textContent&&this._topic.labels.push(c.textContent),c=c.nextSibling;break;case "CreationDate":b.textContent&&(this._topic.creationDate=new Date(b.textContent));break;case "CreationAuthor":b.textContent&&(this._topic.creationAuthor=b.textContent);break;case "ModifiedDate":b.textContent&&
(this._topic.modifiedDate=new Date(b.textContent));break;case "ModifiedAuthor":b.textContent&&(this._topic.modifiedAuthor=b.textContent);break;case "DueDate":b.textContent&&(this._topic.dueDate=new Date(b.textContent));break;case "AssignedTo":b.textContent&&(this._topic.assignedTo=b.textContent);break;case "Description":b.textContent&&(this._topic.description=b.textContent);break;case "Stage":b.textContent&&(this._topic.stage=b.textContent)}b=b.nextElementSibling}};n.prototype._parseComment=function(b){var c=
new Date,f="",a="",k,d=this._getElementAttributes(b).get("Guid");if(d){b=b.firstElementChild;if(null!==b)for(;null!==b;){var e=b.localName;if(null===e)break;switch(e){case "Date":b.textContent&&(c=new Date(b.textContent));break;case "Author":b.textContent&&(f=b.textContent);break;case "Comment":b.textContent&&(a=b.textContent);break;case "Viewpoint":var n=this._getElementAttributes(b).get("Guid");break;case "ModifiedDate":b.textContent&&(k=new Date(b.textContent));break;case "ModifiedAuthor":if(b.textContent)var g=
b.textContent}b=b.nextElementSibling}c=new l(d,c,f,a,n,k,g);this._comments.set(d,c)}};n.prototype._parseViewpoint=function(b){var c=this._getElementAttributes(b).get("Guid");if(void 0!==c){var f=this._getChildData(b);b=f.get("Viewpoint");var a=f.get("Snapshot");f=f.get("Index");this.addViewpoint(c,b,a,f)}};n.prototype.addViewpoint=function(b,c,f,a){this._viewpoints.set(b,new k(b,c,f,a))};n.prototype._getChildData=function(b){var c=new Map;for(b=b.firstElementChild;null!==b;){var f=b.localName,a=null;
null===b.firstElementChild&&(a=b.textContent);null!==f&&null!==a&&c.set(f,a);b=b.nextElementSibling}return c};n.prototype._getElementAttributes=function(b){b=b.attributes;for(var c=new Map,f=0;f<b.length;++f){var a=b[f];c.set(a.name,a.value)}return c};return n}();d.BCFMarkup=n})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d){this._filename=a;this._data=d}d.createFromImage=function(a,e){e=d.snapshotDataFromImage(e);return new d(a,e)};d.prototype.getFilename=function(){return this._filename};d.prototype.getData=function(){return this._data};d.prototype.getUrl=function(){var a=new Blob([this._data],{type:"image/png"});return URL.createObjectURL(a,{oneTimeOnly:!0})};d.snapshotDataFromImage=function(a){return d._convertDataURIToBinary(a.src)};d._convertDataURIToBinary=function(a){var d=
a.indexOf(";base64,")+8;a=window.atob(a.substring(d));d=new Uint8Array(a.length);for(var c=0;c<a.length;c++){var b=a[c].charCodeAt(0);d[c]=b}return d};return d}();d.BCFSnapshot=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,d,c,b){this._viewpointMap=new Map;this._snapshotMap=new Map;this._viewer=b;this._topicId=c;this._bcfDataId=a;this._bcfFilename=d}g.createTopic=function(a,e,c,b,f){void 0===f&&(f=null);return __awaiter(this,void 0,void 0,function(){var k,l,n,m,p,q,h,t,u;return __generator(this,function(r){switch(r.label){case 0:return k=d.UUID.create(),l=new g(e,c,k,a),n=l.addMarkup("markup.bcf",null),n.setTopicTitle(b),n.setTopicId(k),m="viewpoint.bcfv",[4,d.BCFViewpoint.createViewpoint(a,
m,f)];case 1:return p=r.sent(),l.setViewpoint(m,p),q="snapshot.png",(t=null!==f?f.getSnapshotImage():null)?[3,3]:[4,a.takeSnapshot()];case 2:t=r.sent(),r.label=3;case 3:return h=t,u=d.BCFSnapshot.createFromImage(q,h),l.setSnapshot(q,u),[2,l]}})})};g.prototype.getTopicId=function(){return this._topicId};g.prototype.addMarkup=function(a,e){return this._markup=new d.BCFMarkup(a,e,this)};g.prototype.getMarkup=function(){return this._markup};g.prototype.addViewpoint=function(a,e,c,b,f){e=new d.BCFViewpoint(a,
e,c,b,f,this._viewer);this.setViewpoint(a,e);return e};g.prototype.setViewpoint=function(a,d){this._viewpointMap.set(a,d)};g.prototype.getViewpointMap=function(){return this._viewpointMap};g.prototype.getViewpoint=function(a){return this._viewpointMap.get(a)||null};g.prototype.addSnapshot=function(a,e){e=new d.BCFSnapshot(a,e);this.setSnapshot(a,e)};g.prototype.setSnapshot=function(a,d){this._snapshotMap.set(a,d)};g.prototype.getSnapshotMap=function(){return this._snapshotMap};g.prototype.getSnapshot=
function(a){return this._snapshotMap.get(this._massageSnapshotFilename(a))||null};g.prototype._massageSnapshotFilename=function(a){if("viewpoint.bcfv"===a)return"snapshot.png";var d=a.split(".");return"bcfv"===d[1]?d[0]+".png":a};return g}();d.BCFTopic=h})(Communicator||(Communicator={}));
(function(d){function h(b){return b?"true":"false"}function g(b,c){b=b.createElement("Component");void 0!==c.ifcGuid&&b.setAttribute("IfcGuid",c.ifcGuid);void 0!==c.originatingSystem&&b.setAttribute("OriginatingSystem",c.originatingSystem);void 0!==c.authoringToolId&&b.setAttribute("AuthoringToolId",c.authoringToolId.toString());return b}function a(b){return 1===b.length?"0"+b:b}function e(b,c){c=c?a(Math.round(c).toString(16)):"";var f=a(Math.round(b.r).toString(16)),k=a(Math.round(b.g).toString(16));
b=a(Math.round(b.b).toString(16));return""+c+f+k+b}function c(b,c,a){var f=b.createElement("X"),k=b.createElement("Y");b=b.createElement("Z");f.innerHTML=a.x.toString();k.innerHTML=a.y.toString();b.innerHTML=a.z.toString();c.appendChild(f);c.appendChild(k);c.appendChild(b)}var b=function(){function b(b,c,f,a,e,g){this._version=d.BCFVersion.Unknown;this._components={};this._lines=[];this._clippingPlanes=[];this._viewer=g;this._filename=b;this._version=f;this._modelBounding=a;this._unitScale=1E3/e;
this._parseDocument(c)}b.createViewpoint=function(c,f,a){void 0===a&&(a=null);return __awaiter(this,void 0,void 0,function(){var k,e,l,n,g,h,w,v,y,x,z,A,C,B,D,F,E,G,H,I,K,J,L,N,M,Q,O,P;return __generator(this,function(m){switch(m.label){case 0:return k=function(b){var c=[];b.forEach(function(b){for(var f=null;null!==b&&null===f;)f=e.getNodeGenericId(b),b=e.getNodeParent(b);c.push(f)});console.assert(b.length===c.length);return c},e=c.model,l=e.getAbsoluteRootNode(),[4,e.getVisibilityState(l)];case 1:return n=
m.sent(),[4,e.getNodeColorMap(l,d.ElementType.Faces)];case 2:return g=m.sent(),[4,e.getModelBounding(!0,!1)];case 3:h=m.sent(),w=e.getNodeUnitMultiplier(l),v=new b(f,null,d.BCFVersion.v2_1,h,w,c),y=n.defaultVisibility,v.setDefaultVisibility(y),x=n.visibilityExceptions,z=[],x.forEach(function(b){z.push(b)}),A=[],C=k(z),B=0,m.label=4;case 4:if(!(B<C.length))return[3,9];D=C[B];F=void 0;F=null!==D?e.getNodeIdsByGenericIds([D]):[z[B]];E=0;G=F;m.label=5;case 5:if(!(E<G.length))return[3,8];H=G[E];return[4,
e.getVisibilityState(H)];case 6:I=m.sent(),K={genericId:D,nodeId:H},y?0===I.visibilityExceptions.size&&A.push(K):0!==I.visibilityExceptions.size?A.push(K):I.defaultVisibility&&A.push(K),m.label=7;case 7:return E++,[3,5];case 8:return B++,[3,4];case 9:v.setVisibilityExceptionNodes(A);J=c.selectionManager.getResults();L=J.map(function(b){return b.getNodeId()});N=k(L);M=[];for(B=0;B<L.length;B++)Q={genericId:N[B],nodeId:L[B]},M.push(Q);v.setSelectionNodes(M);O=new Map;0<g.size&&g.forEach(function(b,
c){var f=e.getNodeParent(c);if(null!==f){f=e.getNodeGenericId(f);var a=O.get(b);void 0===a&&(a=new Set,O.set(b,a));a.add({genericId:f,nodeId:c})}});v.setColorNodes(O);v.setCamera(c.view.getCamera());null!==a&&(P=b._markupRedlineToBcf(a.getMarkup(),c.view),v.setLines(P));return[2,v]}})})};b._markupRedlineToBcf=function(b,c){var f=function(b){b=c.projectPoint(b);return c.unprojectPoint(d.Point2.fromPoint3(b),0)},a=function(b,c,f){for(var a=2*Math.PI/f,k=[],e=0;e<=f;e++){var l=e*a;k.push(new d.Point2(b.x+
Math.cos(l)*c,b.y+Math.sin(l)*c))}return k},k=function(b){for(var c=0;c<b.length-1;++c){var f=b[c],a=b[c+1];null!==f&&null!==a&&(f=[f.copy().scale(.001),a.copy().scale(.001)],l.push(f))}},e=function(b){for(var c=0;c<b.length;++c){var f=b[c],a=b[(c+1)%b.length];null!==f&&null!==a&&(f=[f.copy().scale(.001),a.copy().scale(.001)],l.push(f))}},l=[];b.forEach(function(b){if(b instanceof d.Markup.Redline.RedlinePolyline){var l=b.getPoints().map(f);k(l)}else if(b instanceof d.Markup.Redline.RedlineCircle){l=
b.getCenter();var n=b.getRadiusPoint();b=d.Point2.fromPoint3(c.projectPoint(l));l=d.Point2.fromPoint3(c.projectPoint(n));l=d.Point2.subtract(l,b).length();l=a(b,l,40).map(function(b){return c.unprojectPoint(b,0)});e(l)}else b instanceof d.Markup.Redline.RedlineRectangle&&(l=b.getPoint1(),n=b.getPoint2(),b=d.Point2.fromPoint3(c.projectPoint(l)),n=d.Point2.fromPoint3(c.projectPoint(n)),l=[],l.push(c.unprojectPoint(b,0)),l.push(c.unprojectPoint(new d.Point2(b.x,n.y),0)),l.push(c.unprojectPoint(n,0)),
l.push(c.unprojectPoint(new d.Point2(n.x,b.y),0)),e(l))});return l};b.prototype._parseDocument=function(b){if(null!==b){b=b.documentElement;var c=b.attributes.getNamedItem("Guid");null!==c&&(this._viewpointGuid=c.value);for(b=b.firstElementChild;null!==b;){c=b.localName;if(null===c)break;switch(c){case "Components":this._version>=d.BCFVersion.v2_1?this._parseComponents(b):this._parseComponentsV2_0(b);break;case "OrthogonalCamera":this._parseOrthogonalCamera(b);break;case "PerspectiveCamera":this._parsePerspectiveCamera(b);
break;case "Lines":this._parseLines(b);break;case "ClippingPlanes":this._parseClippingPlanes(b)}b=b.nextElementSibling}}};b.prototype._exportComponents=function(b){var c=b.createElement("Components"),f=b.createElement("ViewSetupHints"),a=this._components.viewSetupHints;a&&(c.setAttribute("SpacesVisible",h(a.spacesVisible)),c.setAttribute("SpaceBoundariesVisible",h(a.spaceBoundariesVisible)),c.setAttribute("OpeningsVisible",h(a.openingsVisible)));c.appendChild(f);var k=b.createElement("Selection");
(f=this._components.selection)&&f.forEach(function(c){k.appendChild(g(b,c))});c.appendChild(k);f=b.createElement("Visibility");a=this._components.defaultVisibility;var d=this._components.visibilityExceptions;if(void 0!==a&&void 0!==d){f.setAttribute("DefaultVisibility",h(a));var r=b.createElement("Exceptions");d.forEach(function(c){r.appendChild(g(b,c))});f.appendChild(r)}c.appendChild(f);var t=b.createElement("Coloring");(f=this._components.coloring)&&f.forEach(function(c){var f=b.createElement("Color");
f.setAttribute("Color",e(c.color,c.alpha));c.components.forEach(function(c){f.appendChild(g(b,c))});t.appendChild(f)});c.appendChild(t);return c};b.prototype._exportOrthogonalCamera=function(b,f){var a=b.createElement("OrthogonalCamera"),k=b.createElement("CameraViewPoint"),d=b.createElement("CameraDirection"),e=b.createElement("CameraUpVector");c(b,k,f.cameraViewPoint);c(b,d,f.cameraDirection);c(b,e,f.cameraUpVector);b=b.createElement("ViewToWorldScale");b.innerHTML=f.viewToWorldScale.toString();
a.appendChild(k);a.appendChild(d);a.appendChild(e);a.appendChild(b);return a};b.prototype._exportPerspectiveCamera=function(b,f){var a=b.createElement("PerspectiveCamera"),k=b.createElement("CameraViewPoint"),d=b.createElement("CameraDirection"),e=b.createElement("CameraUpVector");c(b,k,f.cameraViewPoint);c(b,d,f.cameraDirection);c(b,e,f.cameraUpVector);b=b.createElement("FieldOfView");b.innerHTML=f.fieldOfView.toString();a.appendChild(k);a.appendChild(d);a.appendChild(e);a.appendChild(b);return a};
b.prototype._exportLines=function(b){var f=b.createElement("Lines");this._lines.forEach(function(a){var k=b.createElement("Line"),d=b.createElement("StartPoint"),e=b.createElement("EndPoint");c(b,d,a.startPoint);c(b,e,a.endPoint);k.appendChild(d);k.appendChild(e);f.appendChild(k)});return f};b.prototype._exportClippingPlanes=function(b){var f=b.createElement("ClippingPlanes");this._clippingPlanes.forEach(function(a){var k=b.createElement("ClippingPlane"),d=b.createElement("Location"),e=b.createElement("Direction");
c(b,d,a.location);c(b,e,a.direction);k.appendChild(d);k.appendChild(e);f.appendChild(k)});return f};b.prototype.export=function(){var b=document.implementation.createDocument("","",null),c=b.createElement("VisualizationInfo");c.appendChild(this._exportComponents(b));void 0!==this._viewpointGuid&&c.setAttribute("Guid",this._viewpointGuid);this._orthogonalCamera?c.appendChild(this._exportOrthogonalCamera(b,this._orthogonalCamera)):this._perspectiveCamera&&c.appendChild(this._exportPerspectiveCamera(b,
this._perspectiveCamera));0<this._lines.length&&c.appendChild(this._exportLines(b));0<this._clippingPlanes.length&&c.appendChild(this._exportClippingPlanes(b));b.appendChild(c);return b};b.prototype.activate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._activateCamera()];case 1:return b.sent(),[4,this._activateComponentsVisibility()];case 2:return b.sent(),[4,this._activateMarkup()];case 3:return b.sent(),[4,this._activateCuttingPlanes()];
case 4:return b.sent(),this._activateSelected(),[4,this._activateColors()];case 5:return b.sent(),[2]}})})};b.prototype._activateCamera=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return b=this.getCamera(),null===b?[3,2]:[4,this._viewer.view._setCameraPromise(b,800)];case 1:c.sent(),c.label=2;case 2:return[2]}})})};b.prototype._activateComponentsVisibility=function(){return __awaiter(this,void 0,void 0,function(){var b,
c,f;return __generator(this,function(a){switch(a.label){case 0:return b=this._viewer.model,c=this._getDefaultVisibility(),f=this.getVisibilityExceptionNodes(),f.length?[4,b.setNodesVisibility([-2],c)]:[3,3];case 1:return a.sent(),[4,b.setNodesVisibility(f,!c)];case 2:return a.sent(),[3,5];case 3:return[4,b.reset()];case 4:a.sent(),a.label=5;case 5:return[2]}})})};b.prototype._activateMarkup=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,a,e;return __generator(this,function(k){switch(k.label){case 0:return b=
this._viewer.lineManager,[4,b.removeAllLines()];case 1:k.sent();c=[];for(f=0;f<this._lines.length;++f)a=this._lines[f],e=new d.Markup.Line.LineMarkup(this._viewer,a.startPoint.copy().scale(1E3),a.endPoint.copy().scale(1E3)),c.push(b.addLine(e));return[4,Promise.all(c)];case 2:return k.sent(),[2]}})})};b.prototype._activateCuttingPlanes=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,a,e,g,h,t,u,w;return __generator(this,function(k){switch(k.label){case 0:return b=this._viewer.model,
[4,b.getModelBounding(!0,!1)];case 1:return c=k.sent(),f=this._viewer.cuttingManager,[4,f.clearAllCuttingSections()];case 2:k.sent(),a=0,k.label=3;case 3:if(!(a<this._clippingPlanes.length))return[3,7];e=f.getCuttingSection(a);return[4,e.clear()];case 4:return k.sent(),g=this._clippingPlanes[a],h=g.location.copy().scale(1E3),t=g.direction.normalize(),u=d.Plane.createFromPointAndNormal(h,t),w=f.createReferenceGeometryFromFaceNormal(t,h,c),[4,e.addPlane(u,w)];case 5:k.sent(),k.label=6;case 6:return++a,
[3,3];case 7:return[4,f.activateCuttingSections()];case 8:return k.sent(),[2]}})})};b.prototype._activateSelected=function(){var b=this,c=this._getNodeIdsFromComponents(this._components.selection);this._viewer.selectionManager.clear();c.forEach(function(c){b._viewer.selectionManager.selectNode(c,d.SelectionMode.Add)})};b.prototype._activateColors=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,a,d,e;return __generator(this,function(k){switch(k.label){case 0:b=this._viewer.model;
c=b.getAbsoluteRootNode();b.unsetNodesFaceColor([c]);b.unsetNodesLineColor([c]);if(void 0===this._components.coloring)return[3,2];f=new Map;a=function(b){var c=d._components.coloring[b];d._getNodeIdsFromComponents(c.components).forEach(function(b){f.set(b,c.color)})};d=this;for(e=0;e<this._components.coloring.length;++e)a(e);return[4,this._viewer.model.setNodesColors(f)];case 1:k.sent(),k.label=2;case 2:return[2]}})})};b.prototype.getFilename=function(){return this._filename};b.prototype.getViewpointGuid=
function(){return this._viewpointGuid||null};b.prototype._fromBCFPerspectiveCamera=function(b,c){var f=new d.Camera;f.setProjection(d.Projection.Perspective);var a=b.cameraViewPoint.copy().scale(this._unitScale);c=b.cameraDirection.copy().normalize().scale(c);c=d.Point3.add(a,c);var k=b.cameraUpVector.copy().normalize();f.setPosition(a);f.setTarget(c);f.setUp(k);b=d.Util.degreesToRadians(b.fieldOfView);b=Math.tan(b/2);b*=2*d.Point3.subtract(f.getTarget(),f.getPosition()).length();f.setWidth(b);f.setHeight(b);
return f};b.prototype._fromBCFOrthogonalCamera=function(b,c){var f=new d.Camera;f.setProjection(d.Projection.Orthographic);var a=b.cameraViewPoint.copy().scale(this._unitScale);c=b.cameraDirection.copy().normalize().scale(c);c=d.Point3.add(a,c);var k=b.cameraUpVector.copy().normalize();f.setPosition(a);f.setTarget(c);f.setUp(k);b=b.viewToWorldScale*this._unitScale*2;f.setWidth(b);f.setHeight(b);return f};b.prototype.getCamera=function(){var b=this._modelBounding.extents().length();return this._perspectiveCamera?
this._fromBCFPerspectiveCamera(this._perspectiveCamera,b/40):this._orthogonalCamera?this._fromBCFOrthogonalCamera(this._orthogonalCamera,b):null};b.prototype.setCamera=function(b){b.getProjection()===d.Projection.Perspective?(this._perspectiveCamera=this._toBCFPerspectiveCamera(b),this._orthogonalCamera=void 0):(this._orthogonalCamera=this._toBCFOrthogonalCamera(b),this._perspectiveCamera=void 0)};b.prototype._toBCFOrthogonalCamera=function(b){var c=b.getPosition(),f=b.getTarget();f=d.Point3.subtract(f,
c).normalize();var a=b.getUp().normalize();c=c.copy().scale(1/this._unitScale);b=b.getWidth()/(2*this._unitScale);return{cameraDirection:f,cameraUpVector:a,cameraViewPoint:c,viewToWorldScale:b}};b.prototype._toBCFPerspectiveCamera=function(b){var c=b.getPosition(),f=b.getTarget();f=d.Point3.subtract(f,c).normalize();var a=b.getUp().normalize();c=c.copy().scale(1/this._unitScale);var k=b.getWidth();b=d.Point3.subtract(b.getTarget(),b.getPosition()).length();b=d.Util.radiansToDegrees(2*Math.atan(k/
(2*b)));return{cameraDirection:f,cameraUpVector:a,cameraViewPoint:c,fieldOfView:b}};b.prototype.setDefaultVisibility=function(b){this._components.defaultVisibility=b};b.prototype._getDefaultVisibility=function(){return void 0!==this._components.defaultVisibility?this._components.defaultVisibility:!0};b.prototype.setVisibilityExceptions=function(b){var c=this;b=b.map(function(b){var f=c._viewer.model.getNodeIdsByGenericIds([b]);return{ifcGuid:b,authoringToolId:0!==f.length?f[0]:void 0,originatingSystem:"HOOPS Communicator"}});
this._components.visibilityExceptions=b};b.prototype.setVisibilityExceptionNodes=function(b){b=b.map(function(b){return{ifcGuid:null!==b.genericId?b.genericId:void 0,authoringToolId:b.nodeId,originatingSystem:"HOOPS Communicator"}});this._components.visibilityExceptions=b};b.prototype.getVisibilityExceptions=function(){return this._getGenericIdsFromComponents(this._components.visibilityExceptions)};b.prototype.getVisibilityExceptionNodes=function(){return this._getNodeIdsFromComponents(this._components.visibilityExceptions)};
b.prototype.setColors=function(b){var c=this,f=[];b.forEach(function(b,a){var k=[];b.forEach(function(b){var f=c._viewer.model.getNodeIdsByGenericIds([b]);k.push({ifcGuid:b,authoringToolId:0!==f.length?f[0]:void 0,originatingSystem:"HOOPS Communicator"})});f.push({color:a,components:k})});this._components.coloring=f};b.prototype.setColorNodes=function(b){var c=[];b.forEach(function(b,f){var a=[];b.forEach(function(b){a.push({ifcGuid:null!==b.genericId?b.genericId:void 0,authoringToolId:b.nodeId,originatingSystem:"HOOPS Communicator"})});
c.push({color:f,components:a})});this._components.coloring=c};b.prototype.getColors=function(){var b=new Map,c=this._components.coloring;void 0!==c&&c.forEach(function(c){var f=c.color.copy(),a=new Set;c.components.map(function(b){void 0!==b.ifcGuid&&a.add(b.ifcGuid)});b.set(f,a)});return b};b.prototype.getColorsToNodes=function(){var b=new Map,c=this._components.coloring;void 0!==c&&c.forEach(function(c){var f=c.color.copy(),a=new Set;c.components.map(function(b){void 0!==b.authoringToolId&&"HOOPS Communicator"===
b.originatingSystem&&a.add(b.authoringToolId)});b.set(f,a)});return b};b.prototype.setLines=function(b){var c=this;this._lines=[];b.forEach(function(b){b={startPoint:b[0].copy(),endPoint:b[1].copy()};c._lines.push(b)})};b.prototype.getLines=function(){var b=[];this._lines.forEach(function(c){b.push([c.startPoint.copy(),c.endPoint.copy()])});return b};b.prototype.setClippingPlanes=function(b){var c=this;this._clippingPlanes=[];b.forEach(function(b){b={location:b[0].copy(),direction:b[1].copy()};c._clippingPlanes.push(b)})};
b.prototype.getClippingPlanes=function(){var b=[];this._clippingPlanes.forEach(function(c){b.push([c.location.copy(),c.direction.copy()])});return b};b.prototype.setSelection=function(b){var c=this;b=b.map(function(b){var f=c._viewer.model.getNodeIdsByGenericIds([b]);return{ifcGuid:b,authoringToolId:0!==f.length?f[0]:void 0,originatingSystem:"HOOPS Communicator"}});this._components.selection=b};b.prototype.setSelectionNodes=function(b){b=b.map(function(b){return{ifcGuid:null!==b.genericId?b.genericId:
void 0,authoringToolId:b.nodeId,originatingSystem:"HOOPS Communicator"}});this._components.selection=b};b.prototype.getSelection=function(){var b=[],c=this._components.selection;void 0!==c&&c.forEach(function(c){c.ifcGuid&&b.push(c.ifcGuid)});return b};b.prototype.getSelectionNodes=function(){var b=[],c=this._components.selection;void 0!==c&&c.forEach(function(c){void 0!==c.authoringToolId&&"HOOPS Communicator"===c.originatingSystem&&b.push(c.authoringToolId)});return b};b.prototype._getGenericIdsFromComponents=
function(b){if(!b)return[];for(var c=[],f=0;f<b.length;++f){var a=b[f];void 0!==a.ifcGuid&&c.push(a.ifcGuid)}return c};b.prototype._getNodeIdsFromComponents=function(b){if(!b)return[];for(var c=new Set,f=[],a=0;a<b.length;++a){var k=b[a];void 0!==k.authoringToolId&&"HOOPS Communicator"===k.originatingSystem?c.add(k.authoringToolId):void 0!==k.ifcGuid&&f.push(k.ifcGuid)}b=0;for(f=this._viewer.model.getNodeIdsByGenericIds(f);b<f.length;b++)c.add(f[b]);return Array.from(c)};b.prototype._parseComponentsV2_0=
function(b){console.assert(this._version<=d.BCFVersion.v2_0);var c=[],f=[],a=[],k=!0;for(b=b.firstElementChild;null!==b;){var e=b.localName;if(null===e)break;switch(e){case "Component":var g=b.attributes,h=g.getNamedItem("IfcGuid");e=g.getNamedItem("Selected");var u=g.getNamedItem("Visible");g=g.getNamedItem("Color");null!==h&&h.value&&(h={ifcGuid:h.value},null!==e&&"true"===e.value&&c.push(h),k=!1,null!==u&&"false"===u.value||f.push(h),null!==g&&g.value&&a.push(this._colorFromArgb(g.value,[h])))}b=
b.nextElementSibling}this._components={defaultVisibility:k,selection:c,visibilityExceptions:f,coloring:a}};b.prototype._parseComponents=function(b){console.assert(this._version>=d.BCFVersion.v2_1);b=b.firstElementChild;for(var c={spacesVisible:!1,spaceBoundariesVisible:!1,openingsVisible:!1},f=[],a=!0,k=[],e=[];null!==b;){var g=b.localName;if(null===g)break;var h=b.attributes;switch(g){case "ViewSetupHints":g=h.getNamedItem("SpacesVisible");var u=h.getNamedItem("SpaceBoundariesVisible");h=h.getNamedItem("OpeningsVisible");
null!==g&&(c.spacesVisible="true"===g.value);null!==u&&(c.spaceBoundariesVisible="true"===u.value);null!==h&&(c.openingsVisible="true"===h.value);break;case "Selection":f=this._getComponents(b);break;case "Visibility":(h=h.getNamedItem("DefaultVisibility"))&&(a="true"===h.value);h=b.firstElementChild;null!==h&&(k=this._getComponents(h));break;case "Coloring":e=this._getColoring(b)}b=b.nextElementSibling}this._components={viewSetupHints:c,selection:f,defaultVisibility:a,visibilityExceptions:k,coloring:e}};
b.prototype._getCameraData=function(b){var c=[];for(b=b.firstElementChild;null!==b;)switch(b.nodeName){case "FieldOfView":case "ViewToWorldScale":b=b.textContent;null!==b&&c.push(parseFloat(b));b=null;break;default:c.push(this._getPoint(b)),b=b.nextElementSibling}return c};b.prototype._parseOrthogonalCamera=function(b){b=this._getCameraData(b);4===b.length&&(this._orthogonalCamera={cameraViewPoint:b[0],cameraDirection:b[1],cameraUpVector:b[2],viewToWorldScale:b[3]})};b.prototype._parsePerspectiveCamera=
function(b){b=this._getCameraData(b);4===b.length&&(this._perspectiveCamera={cameraViewPoint:b[0],cameraDirection:b[1],cameraUpVector:b[2],fieldOfView:b[3]})};b.prototype._parseLines=function(b){for(b=b.firstElementChild;null!==b;)this._lines.push(this._getLine(b)),b=b.nextElementSibling};b.prototype._parseClippingPlanes=function(b){for(b=b.firstElementChild;null!==b;)this._clippingPlanes.push(this._getClippingPlane(b)),b=b.nextElementSibling};b.prototype._getClippingPlane=function(b){b=b.firstElementChild;
var c=d.Point3.zero(),f=d.Point3.zero();null!==b&&(c=this._getPoint(b),b=b.nextElementSibling,null!==b&&(f=this._getPoint(b)));return{location:c,direction:f}};b.prototype._getLine=function(b){b=b.firstElementChild;var c=d.Point3.zero(),f=d.Point3.zero();null!==b&&(c=this._getPoint(b),b=b.nextElementSibling,null!==b&&(f=this._getPoint(b)));return{startPoint:c,endPoint:f}};b.prototype._getPoint=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var f=b.firstChild;null!==f&&c.push(parseFloat(f.wholeText));
b=b.nextElementSibling}console.assert(3===c.length);return new d.Point3(c[0],c[1],c[2])};b.prototype._colorFromArgb=function(b,c){c={color:d.Color.black(),components:c};for(var f=[],a=0;a<b.length;a+=2){var k=b.substr(a,2);f.push(parseInt(k,16))}3===f.length?c.color.set(f[0],f[1],f[2]):4===f.length&&(c.alpha=f[0],c.color.set(f[1],f[2],f[3]));return c};b.prototype._getColoring=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var f=b.attributes.getNamedItem("Color"),a=this._getComponents(b);
f&&a.length&&c.push(this._colorFromArgb(f.value,a));b=b.nextElementSibling}return c};b.prototype._getComponents=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var f=b.attributes,a=f.getNamedItem("IfcGuid"),k=f.getNamedItem("OriginatingSystem");f=f.getNamedItem("AuthoringToolId");null!==a&&(a={ifcGuid:a.value},null!==k&&(a.originatingSystem=k.value),null!==f&&(a.authoringToolId=parseInt(f.value,10)),c.push(a));b=b.nextElementSibling}return c};return b}();d.BCFViewpoint=b})(Communicator||
(Communicator={}));
(function(d){var h=function(){function d(a,d,c){this.r=a;this.g=d;this.b=c}d.prototype.assign=function(a){this.set(a.r,a.g,a.b);return this};d.prototype.copy=function(){return new d(this.r,this.g,this.b)};d.prototype.equals=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b};d.prototype.set=function(a,d,c){this.r=a;this.g=d;this.b=c};d.prototype.setFromFloat=function(a,d,c){this.r=Math.round(255*a);this.g=Math.round(255*d);this.b=Math.round(255*c)};d.prototype.fromFloatArray=function(a){return this.setFromFloat(a[0],
a[1],a[2])};d.prototype.getFloatArray=function(){return[this.r/255,this.g/255,this.b/255]};d.prototype.toFloatArray=function(a){a[0]=this.r/255;a[1]=this.g/255;a[2]=this.b/255};d.fromJson=function(a){return new d(a.r,a.g,a.b)};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{r:this.r,g:this.g,b:this.b}};d.prototype.forJson=function(){return this.toJson()};d.createFromFloat=function(a,e,c){var b=d.black();b.setFromFloat(a,e,c);return b};d.createFromFloatArray=
function(a){var e=d.black();e.fromFloatArray(a);return e};d.red=function(){return new d(255,0,0)};d.green=function(){return new d(0,255,0)};d.blue=function(){return new d(0,0,255)};d.yellow=function(){return new d(255,255,0)};d.white=function(){return new d(255,255,255)};d.black=function(){return new d(0,0,0)};return d}();d.Color=h;h=function(){return function(d,a){this.top=d;this.bottom=a}}();d.VerticalGradient=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){var e=this;this._position=new d.OverlayUnitPoint(0,d.OverlayUnit.Pixels,0,d.OverlayUnit.Pixels);this._viewportSize=new d.OverlayUnitPoint(1,d.OverlayUnit.ProportionOfOtherDimension,.2,d.OverlayUnit.ProportionOfCanvas);this._anchor=d.OverlayAnchor.LowerLeftCorner;this._instanceKeys=[];this._enabled=!1;this._sceneReadyCompleted=d.Util.OpenPromise.create();this._geometryCreated=!1;this._viewer=a;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(e,
void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._createViewport(),this._updateVisibility(),[4,this._createGeometry()];case 1:return c.sent(),this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(e,void 0,void 0,function(){var c,b,f,a,d;return __generator(this,function(k){switch(k.label){case 0:return[4,this._sceneReadyCompleted];case 1:k.sent();c=this._viewer.model;b=0;for(f=this._instanceKeys;b<f.length;b++)a=
f[b],d=c._getNodeFromInstanceInc(!0,0,a,!0),c._preventNodeDeletion(d);return[2]}})})},_firstAttachment:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._onCameraUpdate()];case 1:return c.sent(),this._updateVisibility(),[2]}})})},overlayViewportSet:function(c){c===d.BuiltinOverlayIndex.AxisTriad&&e._onViewportSet()}})}g.prototype.setAxisColor=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f;return __generator(this,
function(k){switch(k.label){case 0:return[4,this._sceneReadyCompleted];case 1:k.sent();switch(a){case d.Axis.X:c=this._instanceKeys[0];b=this._instanceKeys[3];break;case d.Axis.Y:c=this._instanceKeys[1];b=this._instanceKeys[4];break;case d.Axis.Z:c=this._instanceKeys[2];b=this._instanceKeys[5];break;default:return[2]}f=this._getScEngine();f.setPartColor([0,c],d.ElementType.Faces,e);f.setPartColor([0,b],d.ElementType.Lines,e);return[2]}})})};g.prototype.setAnchor=function(a){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return this._anchor=a,[4,this._sceneReadyCompleted];case 1:return d.sent(),[2,this._updateViewport()]}})})};g.prototype.getAnchor=function(){return this._anchor};g.prototype.enable=function(){this._enabled=!0;this._updateVisibility();return Promise.resolve()};g.prototype.disable=function(){this._enabled=!1;this._updateVisibility();return Promise.resolve()};g.prototype._updateVisibility=function(){this._enabled?this._showOverlay():
this._hideOverlay()};g.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.AxisTriad,!1)};g.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.AxisTriad,!0)};g.prototype.getEnabled=function(){return this._enabled};g.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.AxisTriad};g.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.AxisTriad,this._anchor,
this._position.x,d.OverlayUnit.Pixels,this._position.y,d.OverlayUnit.Pixels,this._viewportSize.x,this._viewportSize.xUnit,this._viewportSize.y,this._viewportSize.yUnit)};g.prototype._createViewport=function(){var a=this._viewer.overlayManager;this._updateViewport();var e=new d.Camera;e.setPosition(new d.Point3(0,0,10));e.setTarget(d.Point3.zero());e.setUp(new d.Point3(0,1,0));e.setWidth(g._fieldSize);e.setHeight(g._fieldSize);e.setProjection(d.Projection.Orthographic);a.setCamera(d.BuiltinOverlayIndex.AxisTriad,
e)};g.prototype._onViewportSet=function(){var a=this._viewer.overlayManager,e=a._getViewportPosition(d.BuiltinOverlayIndex.AxisTriad),c=a._getViewportSize(d.BuiltinOverlayIndex.AxisTriad);a=a.getViewportAnchor(d.BuiltinOverlayIndex.AxisTriad);null!==e&&null!==c&&null!==a&&(this._position=e,this._viewportSize=c,this._anchor=a)};g.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b,f,k,l;return __generator(this,function(n){switch(n.label){case 0:if(this._geometryCreated)return[2];
a=[this._createAxis(g._xRotMatrix,0,g._xColor),this._createAxis(g._yRotMatrix,1,g._yColor),this._createAxis(g._zRotMatrix,2,g._zColor),this._createAxisLabel(d.Axis.X,g._xColor,3),this._createAxisLabel(d.Axis.Y,g._yColor,4),this._createAxisLabel(d.Axis.Z,g._zColor,5)];return[4,Promise.all(a)];case 1:e=n.sent();this._onCameraUpdate();c=[];b=0;for(f=e;b<f.length;b++)k=f[b],c.push(0,k);l=this._getScEngine();l.setPartVisibility(c,!0,!0);this._createGeomCallbacks();this._geometryCreated=!0;return[2]}})})};
g.prototype._createGeomCallbacks=function(){var a=this;this._viewer.setCallbacks({camera:function(){a._onCameraUpdate()}})};g.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};g.prototype.insideOverlay=function(a){var d=this._viewer.overlayManager._toPixelPoint(this._viewportSize),c=this._getOverlayOffset();return a.x>=c.x&&a.y>=c.y&&a.x<=c.x+d.x&&a.y<=c.y+d.y};g.prototype._getOverlayOffset=function(){var a=this._viewer.overlayManager._toPixelPoint(this._viewportSize);return this._viewer.overlayManager._getOverlayOffset(this._anchor,
a)};g.prototype._getViewportSize=function(){return this._viewportSize};g.prototype._getViewportPixelSize=function(){return this._viewer.overlayManager._toPixelPoint(this._viewportSize)};g.prototype.getSelectionAxis=function(a){console.assert(this._enabled);if(null===a||!a.isFaceSelection()||a.overlayIndex()!==d.BuiltinOverlayIndex.AxisTriad)return null;var e=this._viewer.model;a=a.getNodeId();e=e._gatherInstanceIncsFromNodeIds([a],1);if(2!==e.length||0!==e[0])return null;e=e[1];for(a=0;a<this._instanceKeys.length;++a)if(this._instanceKeys[a]===
e)switch(a%3){case 0:return d.Axis.X;case 1:return d.Axis.Y;case 2:return d.Axis.Z}return null};g.prototype.onClickSelection=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,k,l,n,g;return __generator(this,function(m){switch(m.label){case 0:e=this.getSelectionAxis(a);if(null===e)return[2];c=this._viewer.model;b=this._viewer.view;switch(e){case d.Axis.X:f=34;break;case d.Axis.Y:f=68;break;case d.Axis.Z:f=24}return[4,c.getModelBounding(!0,!1)];case 1:return k=m.sent(),l=b.getCamera(),
n=this._alignedFitBounding(f,!1,!1,k),l.equals(n)&&(n=this._alignedFitBounding(f,!0,!1,k)),[4,b._setCameraPromise(n,d.DefaultTransitionDuration)];case 2:return m.sent(),g=this._viewer.model.getAbsoluteRootNode(),0===this._viewer.model.getNodeChildren(g).length?[2,this._viewer._getScEngine().markCameraAsEmpty()]:[2]}})})};g.prototype._getScEngine=function(){return this._viewer._getScEngine()};g.prototype._createInstance=function(a,e,c,b,f,k){return __awaiter(this,void 0,void 0,function(){var l,n,g,
p,q;return __generator(this,function(m){switch(m.label){case 0:return[4,this._viewer.model.createMesh(a)];case 1:return l=m.sent(),n=new d.MeshInstanceData(l),n.setCreationFlags(k|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.Invisible),n.setOverlayIndex(d.BuiltinOverlayIndex.AxisTriad),n.setFaceColor(c),n.setLineColor(b),n.setMatrix(f),g=this._getScEngine(),[4,g.createMeshInstance(n)];case 2:return p=
m.sent(),q=p[1],this._instanceKeys[e]=q,[2,q]}})})};g.prototype._createAxis=function(a,e,c){var b=d.Util.generateConeCylinderMeshData(.2,20,2,.4,.5,.1);return this._createInstance(b,e,c,d.Color.black(),a,d.MeshInstanceCreationFlags.None)};g.prototype._createAxisLabel=function(a,e,c){var b=new d.MeshData;b.setFaceWinding(d.FaceWinding.Clockwise);var f=new d.Matrix;a===d.Axis.X?(b.addPolyline([.15,.25,0,-.15,-.25,0]),b.addPolyline([-.15,.25,0,.15,-.25,0]),f.setTranslationComponent(3.1,0,0)):a===d.Axis.Y?
(b.addPolyline([-.15,.25,0,0,0,0]),b.addPolyline([0,0,0,.15,.25,0]),b.addPolyline([0,0,0,0,-.3125,0]),f.setTranslationComponent(0,3.1,0)):a===d.Axis.Z&&(b.addPolyline([-.15,.25,0,.15,.25,0]),b.addPolyline([.15,.25,0,-.15,-.25,0]),b.addPolyline([-.15,-.25,0,.15,-.25,0]),f.setTranslationComponent(0,0,3.1));return this._createInstance(b,c,d.Color.black(),e,f,d.MeshInstanceCreationFlags.ScreenOriented)};g.prototype._onCameraUpdate=function(){var a=new d.Camera,e=this._viewer.view.getCamera();a.setPosition(e.getPosition().subtract(e.getTarget()).normalize());
a.setTarget(d.Point3.zero());a.setUp(e.getUp());a.setProjection(d.Projection.Orthographic);a.setWidth(g._fieldSize);a.setHeight(g._fieldSize);this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.AxisTriad,a)};g.prototype._alignedFitBounding=function(a,e,c,b){var f=d.Point3.subtract(b.max,b.min).length();b=d.Point3.add(d.Point3.scale(b.min,.5),d.Point3.scale(b.max,.5));var k=new d.Point3(b.x,b.y,b.z+f);k=d.Point3.subtract(b,k);var l=-k.length();c=c?-1:1;0===a?(a=new d.Point3(0,c,0),e&&k.negate()):
(e&&(l=-l),0!==(a&2)?k=new d.Point3(l,0,0):0!==(a&4)?k=new d.Point3(0,l,0):(console.assert(0!==(a&8)),k=new d.Point3(0,0,l)),0!==(a&16)?a=new d.Point3(c,0,0):0!==(a&32)?a=new d.Point3(0,c,0):(console.assert(0!==(a&64)),a=new d.Point3(0,0,c)));e=d.Point3.subtract(b,k);c=this._viewer.view.getCamera();return d.Camera.create(e,b,a,c.getProjection(),f,f,c.getNearLimit())};g._xRotMatrix=d.Matrix.createFromOffAxisRotation(new d.Point3(0,0,1),-90);g._yRotMatrix=new d.Matrix;g._zRotMatrix=d.Matrix.createFromOffAxisRotation(new d.Point3(1,
0,0),90);g._xColor=new d.Color(168,56,59);g._yColor=new d.Color(96,166,50);g._zColor=new d.Color(41,81,185);g._fieldSize=8;return g}();d.AxisTriad=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){this._id=0;this._bcfMap=new Map;this._viewer=a}g.prototype._getId=function(){return++this._id};g.prototype.getBCFMap=function(){return this._bcfMap};g.prototype.getBCFData=function(a){return this._bcfMap.get(a)||null};g.prototype.removeBCFData=function(a){this._bcfMap.delete(a);this._viewer.trigger("bcfRemoved",a)};g.prototype.createBCFData=function(a){var e=this._getId();a=new d.BCFData(a,e);this._bcfMap.set(e,a);this._viewer.trigger("bcfLoaded",a.getId(),
a.getFilename());return a};g.prototype.addBCFFromFile=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:return e=this._getId(),c=new d.BCFData(a,e),this._bcfMap.set(e,c),[4,new JSZip.external.Promise(function(b,c){JSZipUtils.getBinaryContent(a,function(f,a){f?c(f):b(a)})})];case 1:return b=f.sent(),[4,this._loadBCFData(b,c)];case 2:return f.sent(),[2]}})})};g.prototype.addBCFFromBuffer=function(a,e){return __awaiter(this,
void 0,void 0,function(){var c,b;return __generator(this,function(f){switch(f.label){case 0:return c=this._getId(),b=new d.BCFData(e,c),this._bcfMap.set(c,b),[4,this._loadBCFData(a,b)];case 1:return f.sent(),[2]}})})};g.prototype._getVersion=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f;return __generator(this,function(k){switch(k.label){case 0:return e=a.file("bcf.version"),null!==e?[3,1]:[2,d.BCFVersion.v1_0];case 1:return[4,this._getDocument(e)];case 2:c=k.sent();b=c.documentElement;
f=b.firstElementChild;if(null!==f&&null!==f.textContent)switch(f.textContent){case "2.0 RC":return[2,d.BCFVersion.v2_0];case "2.1":return[2,d.BCFVersion.v2_1]}return[2,d.BCFVersion.Unknown]}})})};g.prototype._loadBCFData=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f,k,l,n,g,p,q,h=this;return __generator(this,function(m){switch(m.label){case 0:return c=this._viewer.model,[4,c.getModelBounding(!0,!1)];case 1:return b=m.sent(),f=c.getNodeUnitMultiplier(c.getAbsoluteRootNode()),
k=e.getId(),l=e.getFilename(),[4,JSZip.loadAsync(a)];case 2:return n=m.sent(),p=(g=e).setVersion,[4,this._getVersion(n)];case 3:return p.apply(g,[m.sent()]),q=[],n.forEach(function(c){return __awaiter(h,void 0,void 0,function(){var a,g,m,p,h,r,t,u,D,F,E,G,H,I,K,J,L;return __generator(this,function(w){switch(w.label){case 0:a=d.Util.OpenPromise.create();q.push(a);g=this._getFileType(c);if(g!==d.BCFFileType.Markup&&g!==d.BCFFileType.Snapshot&&g!==d.BCFFileType.Viewpoint)return[3,7];m=c.split("/");p=
m[0];h=m[1];r=e.getTopic(p);null===r&&(r=new d.BCFTopic(k,l,p,this._viewer),e.addTopic(p,r));if(!h.length)return[3,7];t=n.file(c);if(null===t)return[3,7];u=g;switch(u){case d.BCFFileType.Markup:return[3,1];case d.BCFFileType.Viewpoint:return[3,3];case d.BCFFileType.Snapshot:return[3,5]}return[3,7];case 1:return F=(D=r).addMarkup,E=[h],[4,this._getDocument(t)];case 2:return F.apply(D,E.concat([w.sent()])),[3,7];case 3:return H=(G=r).addViewpoint,I=[h],[4,this._getDocument(t)];case 4:return H.apply(G,
I.concat([w.sent(),e.getVersion(),b,f])),[3,7];case 5:return J=(K=r).addSnapshot,L=[h],[4,t.async("uint8array")];case 6:return J.apply(K,L.concat([w.sent()])),[3,7];case 7:return a.resolve(),[2]}})})}),[4,d.Util.waitForAll(q)];case 4:return m.sent(),this._viewer.trigger("bcfLoaded",k,l),[2]}})})};g.prototype._getDocument=function(a){return __awaiter(this,void 0,void 0,function(){var d,c,b;return __generator(this,function(f){switch(f.label){case 0:return d=new DOMParser,b=(c=d).parseFromString,[4,
a.async("text")];case 1:return[2,b.apply(c,[f.sent(),"application/xml"])]}})})};g.prototype._getFileType=function(a){if("/"===a.slice(-1))return d.BCFFileType.TopicFolder;a=a.split(".");console.assert(2===a.length);switch(a[1]){case "bcf":return d.BCFFileType.Markup;case "bcfv":return d.BCFFileType.Viewpoint;case "png":return d.BCFFileType.Snapshot;case "version":return d.BCFFileType.Version;case "xsd":return d.BCFFileType.Schema;case "bcfp":return d.BCFFileType.Project}return d.BCFFileType.Unknown};
return g}();d.BCFManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e){void 0===a&&(a=d.Point3.zero());void 0===e&&(e=d.Point3.zero());this.min=a.copy();this.max=e.copy()}g.prototype.copy=function(){return new g(this.min,this.max)};g.prototype.equals=function(a){return this.min.equals(a.min)&&this.max.equals(a.max)};g.prototype.center=function(){var a=d.Point3.add(this.min,this.max);a.scale(.5);return a};g.prototype.extents=function(){return d.Point3.subtract(this.max,this.min)};g.prototype.addBox=function(a){a.isDegenerate()||
(this.addPoint(a.min),this.addPoint(a.max))};g.prototype.addPoint=function(a){a.x<this.min.x&&(this.min.x=a.x);a.y<this.min.y&&(this.min.y=a.y);a.z<this.min.z&&(this.min.z=a.z);a.x>this.max.x&&(this.max.x=a.x);a.y>this.max.y&&(this.max.y=a.y);a.z>this.max.z&&(this.max.z=a.z)};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){return{min:this.min.toJson(),max:this.max.toJson()}};g.prototype.forJson=function(){return this.toJson()};g.fromJson=function(a){var e=d.Point3.fromJson(a.min);
a=d.Point3.fromJson(a.max);return new g(e,a)};g.construct=function(a){return g.fromJson(a)};g.prototype.getCorners=function(){var a=[];a[0]=this.min.copy();a[1]=this.min.copy();a[2]=this.min.copy();a[1].x=this.max.x;a[2].y=this.max.y;a[3]=a[2].copy();a[3].x=this.max.x;a[4]=a[0].copy();a[5]=a[1].copy();a[6]=a[2].copy();a[7]=a[3].copy();a[4].z=this.max.z;a[5].z=this.max.z;a[6].z=this.max.z;a[7].z=this.max.z;return a};g.invalid=function(){return new g(new d.Point3(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY),new d.Point3(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))};g.prototype.isDegenerate=function(){return this.min.x>this.max.x||this.min.y>this.max.y||this.min.z>this.max.z};return g}();d.Box=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){var a=this;this._aliasMap=new Map;this._callbackMap=new Map;this._activeTriggerDepth=0;this._pendingClearUnboundFilteredNames=new Set;this._aliasMap.set("sceneRendered","frameDrawn");this.bind({selectionArray:function(c){a._triggerDeprecatedSelectionCallback(c)},incrementalSelectionBatchBegin:function(){return a.unsafeTrigger("volumeSelectionBatchBegin")},incrementalSelectionBatchEnd:function(){return a.unsafeTrigger("volumeSelectionBatchEnd")},
incrementalSelectionEnd:function(){return a.unsafeTrigger("volumeSelectionEnd")},visibilityChanged:function(c,b){a.unsafeTrigger("partsVisibilityShown",c);a.unsafeTrigger("partsVisibilityHidden",b)}})}a.prototype._triggerDeprecatedSelectionCallback=function(a){if(0===a.length)this.unsafeTrigger("selection",[d.Event.NodeSelectionEvent._createNull()]);else if(100>=a.length)this.unsafeTrigger("selection",a);else{var c=0;for(a=h.chunkify(a,100);c<a.length;c++)this.unsafeTrigger("selection",a[c])}};a.prototype._filterName=
function(a){var c=this._aliasMap.get(a);return void 0===c?a:c};a.prototype.bind=function(a,c){for(var b=0,f=Object.keys(a);b<f.length;b++){var k=f[b],d=a[k];if("function"===typeof d){k=this._filterName(k);var e=this._callbackMap.get(k);void 0===e?this._callbackMap.set(k,[d]):c?e.unshift(d):e.push(d)}}};a.prototype.unbind=function(a){for(var c=0,b=Object.keys(a);c<b.length;c++){var f=b[c],k=this._filterName(f),d=this._callbackMap.get(k);if(void 0!==d){f=a[f];for(var e=0;e<d.length;e++)d[e]===f&&(d[e]=
null,this._pendingClearUnboundFilteredNames.add(k))}}this._clearUnboundCallbacks()};a.prototype._clearUnboundCallbacks=function(){var a=this;0!==this._pendingClearUnboundFilteredNames.size&&0===this._activeTriggerDepth&&(this._pendingClearUnboundFilteredNames.forEach(function(c){var b=a._callbackMap.get(c);void 0!==b&&(b=b.filter(function(b){return null!==b}),0===b.length?a._callbackMap.delete(c):a._callbackMap.set(c,b))}),this._pendingClearUnboundFilteredNames.clear())};a.prototype.promiseTrigger=
function(a,c){for(var b=[],f=2;f<arguments.length;f++)b[f-2]=arguments[f];return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(k){switch(k.label){case 0:console.assert(a!==c),k.label=1;case 1:return k.trys.push([1,3,4,5]),[4,this._unsafePromiseTrigger(a,b)];case 2:return k.sent(),[3,5];case 3:return f=k.sent(),console.error("Rejected promise in '"+a+"' callback:",f),[3,5];case 4:return null!==c&&this.unsafeTrigger(c,b),[7];case 5:return[2]}})})};a.prototype._unsafePromiseTrigger=
function(a,c){var b=this._filterName(a);b=this._callbackMap.get(b);var f=[];if(void 0!==b){++this._activeTriggerDepth;for(var k=0;k<b.length;k++){var e=b[k];if(null!==e)try{f.push(e.apply(null,c))}catch(n){console.error("Unhandled exception in '"+a+"' callback:",n)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}return d.Util.waitForAll(f)};a.prototype.trigger=function(a){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];this.unsafeTrigger(a,c)};a.prototype.unsafeTrigger=function(a,
c){var b=this._filterName(a);b=this._callbackMap.get(b);if(void 0!==b){++this._activeTriggerDepth;for(var f=0;f<b.length;f++){var k=b[f];if(null!==k)try{k.apply(null,c)}catch(l){console.error("Unhandled exception in '"+a+"' callback:",l)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}};return a}();h.CallbackManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(a){a[a.LoadModel=0]="LoadModel";a[a.CreateNode=1]="CreateNode";a[a.CreateInstance=2]="CreateInstance";a[a.CreatePmi=3]="CreatePmi"})(d.NodeSource||(d.NodeSource={}));(function(a){a[a.Desktop=0]="Desktop";a[a.Mobile=1]="Mobile"})(d.ScreenConfiguration||(d.ScreenConfiguration={}));(function(a){a[a.Faces=0]="Faces";a[a.Lines=1]="Lines";a[a.Points=2]="Points"})(d.ElementType||(d.ElementType={}));(function(a){a[a.Orthographic=0]="Orthographic";a[a.Perspective=1]="Perspective"})(d.Projection||
(d.Projection={}));(function(a){a[a.Top=0]="Top";a[a.Bottom=1]="Bottom";a[a.Left=2]="Left";a[a.Right=3]="Right";a[a.Front=4]="Front";a[a.Back=5]="Back";a[a.Iso=6]="Iso";a[a.TopRightFront=7]="TopRightFront";a[a.TopLeftFront=8]="TopLeftFront";a[a.TopLeftBack=9]="TopLeftBack";a[a.TopRightBack=10]="TopRightBack";a[a.TopBack=11]="TopBack";a[a.TopFront=12]="TopFront";a[a.TopLeft=13]="TopLeft";a[a.TopRight=14]="TopRight";a[a.BottomRightBack=15]="BottomRightBack";a[a.BottomLeftBack=16]="BottomLeftBack";a[a.BottomLeftFront=
17]="BottomLeftFront";a[a.BottomRightFront=18]="BottomRightFront";a[a.BottomFront=19]="BottomFront";a[a.BottomBack=20]="BottomBack";a[a.BottomLeft=21]="BottomLeft";a[a.BottomRight=22]="BottomRight";a[a.RightBottomBack=23]="RightBottomBack";a[a.RightBottomFront=24]="RightBottomFront";a[a.RightTopFront=25]="RightTopFront";a[a.RightTopBack=26]="RightTopBack";a[a.RightTop=27]="RightTop";a[a.RightBottom=28]="RightBottom";a[a.RightFront=29]="RightFront";a[a.RightBack=30]="RightBack";a[a.LeftBottomFront=
31]="LeftBottomFront";a[a.LeftBottomBack=32]="LeftBottomBack";a[a.LeftTopBack=33]="LeftTopBack";a[a.LeftTopFront=34]="LeftTopFront";a[a.LeftTop=35]="LeftTop";a[a.LeftBottom=36]="LeftBottom";a[a.LeftBack=37]="LeftBack";a[a.LeftFront=38]="LeftFront";a[a.FrontBottomRight=39]="FrontBottomRight";a[a.FrontTopRight=40]="FrontTopRight";a[a.FrontTopLeft=41]="FrontTopLeft";a[a.FrontBottomLeft=42]="FrontBottomLeft";a[a.FrontRight=43]="FrontRight";a[a.FrontLeft=44]="FrontLeft";a[a.FrontTop=45]="FrontTop";a[a.FrontBottom=
46]="FrontBottom";a[a.BackTopRight=47]="BackTopRight";a[a.BackBottomRight=48]="BackBottomRight";a[a.BackBottomLeft=49]="BackBottomLeft";a[a.BackTopLeft=50]="BackTopLeft";a[a.BackLeft=51]="BackLeft";a[a.BackRight=52]="BackRight";a[a.BackBottom=53]="BackBottom";a[a.BackTop=54]="BackTop"})(d.ViewOrientation||(d.ViewOrientation={}));(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z"})(d.Axis||(d.Axis={}));(function(a){a[a.None=-1]="None";a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(d.Button||
(d.Button={}));(function(a){a[a.None=0]="None";a[a.Left=1]="Left";a[a.Right=2]="Right";a[a.Middle=4]="Middle"})(d.Buttons||(d.Buttons={}));(function(a){a[a.Axis=0]="Axis";a[a.Plane=1]="Plane";a[a.ViewPlane=2]="ViewPlane";a[a.Rotate=3]="Rotate"})(d.HandleType||(d.HandleType={}));(function(a){a[a.Translate=0]="Translate";a[a.Rotate=1]="Rotate"})(d.HandleEventType||(d.HandleEventType={}));(function(a){a[a.Invalid=-1]="Invalid";a[a.None=0]="None";a[a.Navigate=1]="Navigate";a[a.Orbit=2]="Orbit";a[a.Pan=
3]="Pan";a[a.Zoom=4]="Zoom";a[a.WindowZoom=5]="WindowZoom";a[a.Walk=6]="Walk";a[a.KeyboardWalk=7]="KeyboardWalk";a[a.WalkMode=8]="WalkMode";a[a.Turntable=9]="Turntable";a[a.Select=10]="Select";a[a.AreaSelect=11]="AreaSelect";a[a.RayDrillSelect=12]="RayDrillSelect";a[a.RedlineCircle=13]="RedlineCircle";a[a.RedlineText=14]="RedlineText";a[a.RedlineRectangle=15]="RedlineRectangle";a[a.RedlinePolyline=16]="RedlinePolyline";a[a.MeasureEdgeLength=17]="MeasureEdgeLength";a[a.MeasureFaceFaceDistance=18]=
"MeasureFaceFaceDistance";a[a.MeasureLineLineAngle=19]="MeasureLineLineAngle";a[a.MeasurePointPointDistance=20]="MeasurePointPointDistance";a[a.MeasureBodyBodyDistance=21]="MeasureBodyBodyDistance";a[a.MeasureFaceFaceAngle=22]="MeasureFaceFaceAngle";a[a.MeasurePolylineDistance=23]="MeasurePolylineDistance";a[a.MeasurePolygonArea=24]="MeasurePolygonArea";a[a.Note=25]="Note";a[a.Cutting=26]="Cutting";a[a.Handle=27]="Handle";a[a.NavCube=28]="NavCube";a[a.AxisTriad=29]="AxisTriad";a[a.Floorplan=30]="Floorplan";
a[a.SpaceMouse=31]="SpaceMouse"})(d.OperatorId||(d.OperatorId={}));(function(a){a[a.MouseDown=0]="MouseDown";a[a.MouseMove=1]="MouseMove";a[a.MouseUp=2]="MouseUp";a[a.Mousewheel=3]="Mousewheel";a[a.TouchStart=4]="TouchStart";a[a.TouchMove=5]="TouchMove";a[a.TouchEnd=6]="TouchEnd";a[a.KeyDown=7]="KeyDown";a[a.KeyUp=8]="KeyUp";a[a.ViewOrientationChange=9]="ViewOrientationChange"})(d.EventType||(d.EventType={}));(function(a){a[a.None=0]="None";a[a.Shift=2]="Shift";a[a.Alt=4]="Alt";a[a.Control=8]="Control";
a[a.Command=16]="Command"})(d.KeyModifiers||(d.KeyModifiers={}));(function(a){a[a.Down=0]="Down";a[a.Up=1]="Up";a[a.Move=2]="Move";a[a.Wheel=3]="Wheel"})(d.MouseInputType||(d.MouseInputType={}));(function(a){a[a.Start=0]="Start";a[a.Move=1]="Move";a[a.End=2]="End"})(d.TouchInputType||(d.TouchInputType={}));(function(a){a[a.Down=0]="Down";a[a.Up=1]="Up"})(d.KeyInputType||(d.KeyInputType={}));(function(a){a[a.Forward=0]="Forward";a[a.Backward=1]="Backward";a[a.Left=2]="Left";a[a.Right=3]="Right";a[a.Up=
4]="Up";a[a.Down=5]="Down";a[a.RotateRight=6]="RotateRight";a[a.RotateLeft=7]="RotateLeft";a[a.TiltUp=8]="TiltUp";a[a.TiltDown=9]="TiltDown"})(d.WalkDirection||(d.WalkDirection={}));(function(a){a[a.Backspace=8]="Backspace";a[a.Shift=16]="Shift";a[a.Escape=27]="Escape";a[a.PgUp=33]="PgUp";a[a.PgDown=34]="PgDown";a[a.LeftArrow=37]="LeftArrow";a[a.UpArrow=38]="UpArrow";a[a.RightArrow=39]="RightArrow";a[a.DownArrow=40]="DownArrow";a[a.Delete=46]="Delete";a[a.a=65]="a";a[a.b=66]="b";a[a.c=67]="c";a[a.d=
68]="d";a[a.e=69]="e";a[a.f=70]="f";a[a.g=71]="g";a[a.h=72]="h";a[a.i=73]="i";a[a.j=74]="j";a[a.k=75]="k";a[a.l=76]="l";a[a.m=77]="m";a[a.n=78]="n";a[a.o=79]="o";a[a.p=80]="p";a[a.q=81]="q";a[a.r=82]="r";a[a.s=83]="s";a[a.t=84]="t";a[a.u=85]="u";a[a.v=86]="v";a[a.w=87]="w";a[a.x=88]="x";a[a.y=89]="y";a[a.z=90]="z";a[a._0=48]="_0";a[a._1=49]="_1";a[a._2=50]="_2";a[a._3=51]="_3";a[a._4=52]="_4";a[a._5=53]="_5";a[a._6=54]="_6";a[a._7=55]="_7";a[a._8=56]="_8";a[a._9=57]="_9";a[a.NumPad_0=96]="NumPad_0";
a[a.NumPad_1=97]="NumPad_1";a[a.NumPad_2=98]="NumPad_2";a[a.NumPad_3=99]="NumPad_3";a[a.NumPad_4=100]="NumPad_4";a[a.NumPad_5=101]="NumPad_5";a[a.NumPad_6=102]="NumPad_6";a[a.NumPad_7=103]="NumPad_7";a[a.NumPad_8=104]="NumPad_8";a[a.NumPad_9=105]="NumPad_9"})(d.KeyCode||(d.KeyCode={}));(function(a){a[a.None=0]="None";a[a.Face=1]="Face";a[a.Line=2]="Line";a[a.Point=4]="Point";a[a.All=7]="All"})(d.SelectionMask||(d.SelectionMask={}));(function(a){a[a.None=0]="None";a[a.Face=1]="Face";a[a.Line=2]="Line";
a[a.Point=3]="Point";a[a.Part=4]="Part"})(d.SelectionType||(d.SelectionType={}));(function(a){a[a.Set=0]="Set";a[a.Add=1]="Add";a[a.Toggle=2]="Toggle"})(d.SelectionMode||(d.SelectionMode={}));(function(a){a[a.HighlightOnly=0]="HighlightOnly";a[a.OutlineOnly=1]="OutlineOnly";a[a.HighlightAndOutline=2]="HighlightAndOutline"})(d.SelectionHighlightMode||(d.SelectionHighlightMode={}));(function(a){a[a.Info=0]="Info";a[a.Warning=1]="Warning";a[a.Error=2]="Error"})(d.InfoType||(d.InfoType={}));(function(a){a[a.Interactive=
1]="Interactive";a[a.All=2]="All";a[a.OnDemand=4]="OnDemand";a[a.Default=1]="Default"})(d.StreamingMode||(d.StreamingMode={}));(function(a){a[a.Client=0]="Client";a[a.Server=1]="Server"})(d.RendererType||(d.RendererType={}));(function(a){a[a.Wireframe=0]="Wireframe";a[a.Shaded=1]="Shaded";a[a.WireframeOnShaded=2]="WireframeOnShaded";a[a.HiddenLine=3]="HiddenLine";a[a.XRay=4]="XRay";a[a.Gooch=5]="Gooch";a[a.Toon=6]="Toon"})(d.DrawMode||(d.DrawMode={}));(function(a){a[a.Unsorted=0]="Unsorted";a[a.SingleLayer=
1]="SingleLayer"})(d.TransparencyMode||(d.TransparencyMode={}));(function(a){a[a.Unsorted=0]="Unsorted";a[a.SingleLayer=1]="SingleLayer"})(d.XRayTransparencyMode||(d.XRayTransparencyMode={}));(function(a){a[a.SMAA=0]="SMAA";a[a.None=1]="None"})(d.AntiAliasingMode||(d.AntiAliasingMode={}));(function(a){a[a.DoNotExplode=0]="DoNotExplode";a[a.DoNotCut=1]="DoNotCut";a[a.DoNotSelect=2]="DoNotSelect";a[a.SuppressCameraScale=3]="SuppressCameraScale";a[a.OverrideSceneVisibility=4]="OverrideSceneVisibility";
a[a.DoNotLight=5]="DoNotLight";a[a.DoNotOutlineHighlight=6]="DoNotOutlineHighlight";a[a.ExcludeBounding=7]="ExcludeBounding";a[a.DoNotUseVertexColors=8]="DoNotUseVertexColors";a[a.AlwaysDraw=9]="AlwaysDraw";a[a.DoNotXRay=10]="DoNotXRay";a[a.ScreenOriented=11]="ScreenOriented";a[a.ScreenSpace=12]="ScreenSpace";a[a.ScreenSpaceStretched=13]="ScreenSpaceStretched";a[a.DoNotReset=14]="DoNotReset";a[a.IgnoreExplosion=0]="IgnoreExplosion";a[a.IgnoreCutting=1]="IgnoreCutting";a[a.IgnoreSelection=2]="IgnoreSelection";
a[a.IgnoreCameraScale=3]="IgnoreCameraScale";a[a.IgnoreLighting=5]="IgnoreLighting";a[a.IgnoreOutlineHighlight=6]="IgnoreOutlineHighlight"})(d.InstanceModifier||(d.InstanceModifier={}));(function(a){a[a.None=0]="None";a[a.SuppressCameraScale=1]="SuppressCameraScale";a[a.ScreenOriented=2]="ScreenOriented";a[a.DoNotCut=4]="DoNotCut";a[a.DoNotExplode=8]="DoNotExplode";a[a.DoNotSelect=16]="DoNotSelect";a[a.DoNotLight=32]="DoNotLight";a[a.DoNotOutlineHighlight=64]="DoNotOutlineHighlight";a[a.ExcludeBounding=
128]="ExcludeBounding";a[a.DoNotUseVertexColors=256]="DoNotUseVertexColors";a[a.Invisible=512]="Invisible";a[a.DoNotXRay=1024]="DoNotXRay";a[a.AlwaysDraw=2048]="AlwaysDraw";a[a.OverrideSceneVisibility=4096]="OverrideSceneVisibility";a[a.ScreenSpace=8192]="ScreenSpace";a[a.ScreenSpaceStretched=16384]="ScreenSpaceStretched";a[a.DoNotReset=32768]="DoNotReset"})(d.MeshInstanceCreationFlags||(d.MeshInstanceCreationFlags={}));(function(a){a[a.None=0]="None";a[a.Model=1]="Model";a[a.Instance=2]="Instance";
a[a.Ejected=4]="Ejected";a[a.All=7]="All"})(d.BoundingPreviewMode||(d.BoundingPreviewMode={}));(function(a){a[a.CameraTarget=0]="CameraTarget";a[a.ModelCenter=1]="ModelCenter";a[a.OrbitTarget=2]="OrbitTarget"})(d.OrbitFallbackMode||(d.OrbitFallbackMode={}));(function(a){a[a.Mouse=0]="Mouse";a[a.Keyboard=1]="Keyboard"})(d.WalkMode||(d.WalkMode={}));(function(a){a[a.AssemblyNode=0]="AssemblyNode";a[a.PartInstance=1]="PartInstance";a[a.Part=2]="Part";a[a.BodyInstance=3]="BodyInstance";a[a.PmiBody=4]=
"PmiBody";a[a.PMIBody=4]="PMIBody";a[a.ViewFrame=5]="ViewFrame";a[a.Body=6]="Body";a[a.BrepBody=7]="BrepBody";a[a.TessBody=8]="TessBody";a[a.WireBody=9]="WireBody";a[a.PointsBody=10]="PointsBody";a[a.Pmi=11]="Pmi";a[a.PMI=11]="PMI";a[a.CadView=12]="CadView";a[a.CADView=12]="CADView";a[a.DrawingSheet=13]="DrawingSheet";a[a.Unknown=14]="Unknown"})(d.NodeType||(d.NodeType={}));var h;(function(a){a[a.Unknown=0]="Unknown";a[a.Text=1]="Text";a[a.Dimension=2]="Dimension";a[a.Arrow=3]="Arrow";a[a.Balloon=
4]="Balloon";a[a.CircleCenter=5]="CircleCenter";a[a.Coordinate=6]="Coordinate";a[a.Datum=7]="Datum";a[a.Fastener=8]="Fastener";a[a.Gdt=9]="Gdt";a[a.Locator=10]="Locator";a[a.MeasurementPoint=11]="MeasurementPoint";a[a.Roughness=12]="Roughness";a[a.Welding=13]="Welding";a[a.Table=14]="Table";a[a.Other=15]="Other";a[a.GeometricalTolerance=16]="GeometricalTolerance"})(h=d.PmiType||(d.PmiType={}));d.PMIType=h;(function(a){a[a.Unknown=0]="Unknown";a[a.DatumIdent=1]="DatumIdent";a[a.DatumTarget=2]="DatumTarget";
a[a.DimensionDistance=1]="DimensionDistance";a[a.DimensionDistanceOffset=2]="DimensionDistanceOffset";a[a.DimensionDistanceCumulate=3]="DimensionDistanceCumulate";a[a.DimensionChamfer=4]="DimensionChamfer";a[a.DimensionSlope=5]="DimensionSlope";a[a.DimensionOrdinate=6]="DimensionOrdinate";a[a.DimensionRadius=7]="DimensionRadius";a[a.DimensionRadiusTangent=8]="DimensionRadiusTangent";a[a.DimensionRadiusCylinder=9]="DimensionRadiusCylinder";a[a.DimensionRadiusEdge=10]="DimensionRadiusEdge";a[a.DimensionDiameter=
11]="DimensionDiameter";a[a.DimensionDiameterTangent=12]="DimensionDiameterTangent";a[a.DimensionDiameterCylinder=13]="DimensionDiameterCylinder";a[a.DimensionDiameterEdge=14]="DimensionDiameterEdge";a[a.DimensionDiameterCone=15]="DimensionDiameterCone";a[a.DimensionLength=16]="DimensionLength";a[a.DimensionLengthCurvilinear=17]="DimensionLengthCurvilinear";a[a.DimensionLengthCircular=18]="DimensionLengthCircular";a[a.DimensionAngle=19]="DimensionAngle";a[a.GdtFcf=1]="GdtFcf";a[a.WeldingLine=1]="WeldingLine";
a[a.WeldingSpot=2]="WeldingSpot";a[a.OtherSymbolUser=1]="OtherSymbolUser";a[a.OtherSymbolUtility=2]="OtherSymbolUtility";a[a.OtherSymbolCustom=3]="OtherSymbolCustom";a[a.OtherGeometricReference=4]="OtherGeometricReference";a[a.OtherRegion=5]="OtherRegion"})(h=d.PmiSubType||(d.PmiSubType={}));d.PMISubType=h;var g;(function(a){a[a.Unknown=-1]="Unknown";a[a.Context=1]="Context";a[a.Item=2]="Item";a[a.MultipleVertex=3]="MultipleVertex";a[a.UniqueVertex=4]="UniqueVertex";a[a.WireEdge=5]="WireEdge";a[a.Edge=
6]="Edge";a[a.CoEdge=7]="CoEdge";a[a.Loop=8]="Loop";a[a.Face=9]="Face";a[a.Shell=10]="Shell";a[a.Connex=11]="Connex";a[a.Body=12]="Body";a[a.SingleWireBody=13]="SingleWireBody";a[a.BrepData=14]="BrepData";a[a.WireBody=17]="WireBody"})(g=d.PmiTopoRef||(d.PmiTopoRef={}));d.PMITopoRef=g;(function(a){a[a.Unknown=0]="Unknown";a[a.Clockwise=1]="Clockwise";a[a.CounterClockwise=2]="CounterClockwise"})(d.FaceWinding||(d.FaceWinding={}));(function(a){a[a.UpperLeftCorner=0]="UpperLeftCorner";a[a.LowerLeftCorner=
1]="LowerLeftCorner";a[a.LowerRightCorner=2]="LowerRightCorner";a[a.UpperRightCorner=3]="UpperRightCorner";a[a.TopCenter=4]="TopCenter";a[a.LeftCenter=5]="LeftCenter";a[a.RightCenter=6]="RightCenter";a[a.BottomCenter=7]="BottomCenter";a[a.Center=8]="Center"})(d.OverlayAnchor||(d.OverlayAnchor={}));(function(a){a[a.Pixels=0]="Pixels";a[a.ProportionOfCanvas=1]="ProportionOfCanvas";a[a.ProportionOfOtherDimension=2]="ProportionOfOtherDimension"})(d.OverlayUnit||(d.OverlayUnit={}));(function(a){a[a.ScreenPixels=
0]="ScreenPixels";a[a.CSSPixels=1]="CSSPixels";a[a.World=2]="World";a[a.ProportionOfScreenWidth=3]="ProportionOfScreenWidth";a[a.ProportionOfScreenHeight=4]="ProportionOfScreenHeight";a[a.ProportionOfBoundingDiagonal=5]="ProportionOfBoundingDiagonal"})(d.PointSizeUnit||(d.PointSizeUnit={}));(function(a){a[a.Square=0]="Square";a[a.Disk=1]="Disk";a[a.Sphere=2]="Sphere"})(d.PointShape||(d.PointShape={}));h=function(){function a(){this.bodyId=d.InvalidNodeId;this.subElementType=g.Unknown;this.subElementIndex=
-1}Object.defineProperty(a.prototype,"bodyID",{get:function(){return this.bodyId},set:function(a){this.bodyId=a},enumerable:!0,configurable:!0});return a}();d.RefOnTopoItem=h;(function(a){a[a.Hidden=0]="Hidden";a[a.Shown=1]="Shown";a[a.Mixed=2]="Mixed"})(d.BranchVisibility||(d.BranchVisibility={}));(function(a){a[a.Object=0]="Object";a[a.World=1]="World"})(d.CullingVectorSpace||(d.CullingVectorSpace={}));(function(a){a[a.First=8]="First";a[a.Handles=8]="Handles";a[a.AxisTriad=9]="AxisTriad";a[a.NavCube=
10]="NavCube";a[a.Floorplan=11]="Floorplan";a[a.TestFramework=12]="TestFramework"})(d.BuiltinOverlayIndex||(d.BuiltinOverlayIndex={}));h=function(){return function(){this.pos1=d.Point3.zero();this.pos2=d.Point3.zero();this.distance=0}}();d.FaceFaceDistanceItem=h;h=function(){return function(){this.frontVector=new d.Point3(-1,0,0);this.upVector=new d.Point3(0,0,1)}}();d.ViewAxes=h;(function(a){a[a.Object=0]="Object";a[a.World=1]="World";a[a.ProportionOfScreenWidth=2]="ProportionOfScreenWidth";a[a.ProportionOfScreenHeight=
3]="ProportionOfScreenHeight"})(d.LinePatternLengthUnit||(d.LinePatternLengthUnit={}));(function(a){a[a.Selected=0]="Selected";a[a.Unselected=1]="Unselected"})(d.XRayGroup||(d.XRayGroup={}));(function(a){a[a.Pixels=0]="Pixels";a[a.ProportionOfWidth=1]="ProportionOfWidth";a[a.ProportionOfHeight=2]="ProportionOfHeight"})(d.BlurIntervalUnit||(d.BlurIntervalUnit={}));(function(a){a[a.unitUnknown=0]="unitUnknown";a[a.unitLength=1]="unitLength";a[a.unitMass=2]="unitMass";a[a.unitTime=3]="unitTime";a[a.unitElectricCurrent=
4]="unitElectricCurrent";a[a.unitThermoTemperature=5]="unitThermoTemperature";a[a.unitSubstanceAmount=6]="unitSubstanceAmount";a[a.unitLuminosityIntensity=7]="unitLuminosityIntensity";a[a.unitPlaneAngle=8]="unitPlaneAngle";a[a.unitSolidAngle=9]="unitSolidAngle";a[a.unitFrequency=10]="unitFrequency";a[a.unitForce=11]="unitForce";a[a.unitPressure=12]="unitPressure";a[a.unitEnergy=13]="unitEnergy";a[a.unitPower=14]="unitPower";a[a.unitElectricCharge=15]="unitElectricCharge";a[a.unitElectromotiveForce=
16]="unitElectromotiveForce";a[a.unitCapacitance=17]="unitCapacitance";a[a.unitElectricResistance=18]="unitElectricResistance";a[a.unitElectricConductance=19]="unitElectricConductance";a[a.unitMagneticFlux=20]="unitMagneticFlux";a[a.unitMagneticFluxDensity=21]="unitMagneticFluxDensity";a[a.unitInductance=22]="unitInductance";a[a.unitLuminousFlux=23]="unitLuminousFlux";a[a.unitIlluminance=24]="unitIlluminance";a[a.unitActivityRadionuclide=25]="unitActivityRadionuclide";a[a.unitKerma=26]="unitKerma";
a[a.unitDoseEquivalent=27]="unitDoseEquivalent";a[a.unitCatalyticActivity=28]="unitCatalyticActivity"})(d.BasicUnit||(d.BasicUnit={}));(function(a){a[a.Undefined=0]="Undefined";a[a.Int=1]="Int";a[a.Float=2]="Float";a[a.Time=3]="Time";a[a.String=4]="String";a[a.Ignored=5]="Ignored"})(d.AttributeType||(d.AttributeType={}));h=function(){return function(a,d){this.isInclusive=a;this.nodeIds=d}}();d.FilteredNodes=h;h=function(){return function(a,d){this.defaultVisibility=a;this.visibilityExceptions=d}}();
d.VisibilityState=h;h=function(){function a(){this.additionalMatrix=null;this.attachInvisibly=this.allowMissingExternalModels=!1;this.implicitlyLoadXmlExternalModels=!0;this.ignoreBimRelationships=this.ignoreGenericTypes=this.ignoreLayers=this.ignoreFilters=this.ignoreCadViews=!1;this._allowSubtreeLoadedCallback=!0}a.prototype.copy=function(){var d=new a;d.additionalMatrix=this.additionalMatrix;null!==d.additionalMatrix&&(d.additionalMatrix=d.additionalMatrix.copy());d.allowMissingExternalModels=
this.allowMissingExternalModels;d.attachInvisibly=this.attachInvisibly;d.implicitlyLoadXmlExternalModels=this.implicitlyLoadXmlExternalModels;d.ignoreCadViews=this.ignoreCadViews;d.ignoreFilters=this.ignoreFilters;d.ignoreLayers=this.ignoreLayers;d.ignoreGenericTypes=this.ignoreGenericTypes;d.ignoreBimRelationships=this.ignoreBimRelationships;d._allowSubtreeLoadedCallback=this._allowSubtreeLoadedCallback;return d};return a}();d.LoadSubtreeConfig=h;(function(a){a[a.Unknown=0]="Unknown";a[a.Catia=2]=
"Catia";a[a.CatiaV5=3]="CatiaV5";a[a.Cadds=4]="Cadds";a[a.Unigraphics=5]="Unigraphics";a[a.Parasolid=6]="Parasolid";a[a.Euclid=7]="Euclid";a[a.Iges=9]="Iges";a[a.Unisurf=10]="Unisurf";a[a.Vda=11]="Vda";a[a.Stl=12]="Stl";a[a.Wrl=13]="Wrl";a[a.Dxf=14]="Dxf";a[a.Acis=15]="Acis";a[a.ProE=16]="ProE";a[a.Step=18]="Step";a[a.Ideas=19]="Ideas";a[a.Jt=20]="Jt";a[a.Slw=22]="Slw";a[a.Cgr=23]="Cgr";a[a.Prc=24]="Prc";a[a.Xvl=25]="Xvl";a[a.Hpgl=26]="Hpgl";a[a.TopSolid=27]="TopSolid";a[a.OneSpaceDesigner=28]="OneSpaceDesigner";
a[a._3dxml=29]="_3dxml";a[a.Inventor=30]="Inventor";a[a.PostScript=31]="PostScript";a[a.Pdp=32]="Pdp";a[a.U3d=33]="U3d";a[a.Ifc=34]="Ifc";a[a.Dwg=35]="Dwg";a[a.Dwf=36]="Dwf";a[a.Se=37]="Se";a[a.Obj=38]="Obj";a[a.Kmz=39]="Kmz";a[a.Dae=40]="Dae";a[a._3ds=41]="_3ds";a[a.Rhino=43]="Rhino";a[a.Xml=44]="Xml";a[a._3mf=45]="_3mf";a[a.Scs=46]="Scs";a[a._3dHtml=47]="_3dHtml";a[a.Hsf=48]="Hsf";a[a.Gltf=49]="Gltf";a[a.Revit=50]="Revit";a[a.Fbx=51]="Fbx"})(d.FileType||(d.FileType={}));(function(a){a[a.World=0]=
"World";a[a.ProportionOfBoundingHeight=1]="ProportionOfBoundingHeight"})(d.SimpleReflectionAttenuationUnit||(d.SimpleReflectionAttenuationUnit={}));(function(a){a[a.Default=0]="Default";a[a.PerNode=1]="PerNode"})(d.TreeWalkMode||(d.TreeWalkMode={}));(function(a){a[a.NorthUp=0]="NorthUp";a[a.AvatarUp=1]="AvatarUp"})(d.FloorplanOrientation||(d.FloorplanOrientation={}));(function(a){a[a.ContainedInSpatialStructure=0]="ContainedInSpatialStructure";a[a.Aggregates=1]="Aggregates";a[a.VoidsElement=2]="VoidsElement";
a[a.FillsElement=3]="FillsElement";a[a.SpaceBoundary=4]="SpaceBoundary";a[a.ConnectsPathElements=5]="ConnectsPathElements";a[a.Undefined=6]="Undefined"})(d.RelationshipType||(d.RelationshipType={}));(function(a){a[a.FixedFramerate=0]="FixedFramerate";a[a.OcclusionCulling=1]="OcclusionCulling"})(d.DrawStrategy||(d.DrawStrategy={}))})(Communicator||(Communicator={}));
(function(d){d=d.Internal||(d.Internal={});d=d.AttachType||(d.AttachType={});d[d.Direct=0]="Direct";d[d.Indirect=1]="Indirect"})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.CameraFlags||(d.CameraFlags={});d[d.None=0]="None";d[d.Position=1]="Position";d[d.Target=2]="Target";d[d.Up=4]="Up";d[d.Width=8]="Width";d[d.Height=16]="Height";d[d.Projection=32]="Projection";d[d.NearLimit=64]="NearLimit"})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this._position=new d.Point3(0,0,1);this._target=d.Point3.zero();this._up=new d.Point3(0,1,0);this._height=this._width=0;this._projection=d.Projection.Orthographic;this._nearLimit=.01;this._cameraFlags=d.Internal.CameraFlags.None}g.prototype._clearFlags=function(){this._cameraFlags=d.Internal.CameraFlags.None};g.prototype._getFlags=function(){return this._cameraFlags};g.prototype.copy=function(){return g.create(this._position,this._target,this._up,this._projection,
this._width,this._height,this._nearLimit)};g.prototype.setPosition=function(a){this._position.assign(a);this._cameraFlags|=d.Internal.CameraFlags.Position};g.prototype.getPosition=function(){return this._position.copy()};g.prototype.setTarget=function(a){this._target.assign(a);this._cameraFlags|=d.Internal.CameraFlags.Target};g.prototype.getTarget=function(){return this._target.copy()};g.prototype.setUp=function(a){this._up.assign(a);this._cameraFlags|=d.Internal.CameraFlags.Up};g.prototype.getUp=
function(){return this._up.copy()};g.prototype.setWidth=function(a){this._width=a;this._cameraFlags|=d.Internal.CameraFlags.Width};g.prototype.getWidth=function(){return this._width};g.prototype.setHeight=function(a){this._height=a;this._cameraFlags|=d.Internal.CameraFlags.Height};g.prototype.getHeight=function(){return this._height};g.prototype.setProjection=function(a){this._projection=a;this._cameraFlags|=d.Internal.CameraFlags.Projection};g.prototype.getProjection=function(){return this._projection};
g.prototype.setNearLimit=function(a){this._nearLimit=a;this._cameraFlags|=d.Internal.CameraFlags.NearLimit};g.prototype.getNearLimit=function(){return this._nearLimit};g.prototype.equals=function(a){return this._position.equals(a._position)&&this._target.equals(a._target)&&this._up.equals(a._up)&&this._width===a._width&&this._height===a._height&&this._projection===a._projection&&this._nearLimit===a._nearLimit};g.prototype.equalsWithTolerance=function(a,d){return this._position.equalsWithTolerance(a._position,
d)&&this._target.equalsWithTolerance(a._target,d)&&this._up.equalsWithTolerance(a._up,d)&&Math.abs(this._width-a._width)<d&&Math.abs(this._height-a._height)<d&&Math.abs(this._projection-a._projection)<d&&Math.abs(this._nearLimit-a._nearLimit)<d};g.prototype.dolly=function(a){this._position.subtract(a);this._target.subtract(a)};g.prototype.getCameraPlaneIntersectionPoint=function(a,e){var c=d.Point3.subtract(this._position,this._target).normalize();c=d.Plane.createFromPointAndNormal(this._target,c);
a=e.raycastFromPoint(a);if(null===a)return null;e=d.Point3.zero();return c.intersectsRay(a,e)?e:null};g.prototype.getViewMatrix=function(a){return a._getScEngine().getViewMatrix(this)};g.prototype.getProjectionMatrix=function(a){return a._getScEngine().getProjectionMatrix(this)};g.prototype.getFullMatrix=function(a){return a._getScEngine().getFullCameraMatrix(this)};g.prototype.getMatrixFromCamera=function(){var a=d.Point3.subtract(this.getTarget(),this.getPosition()).normalize(),e=this.getUp().normalize();
e=d.Point3.cross(e,a);var c=d.Point3.cross(a,e);return d.Matrix.createFromBasis(e,c,a)};g.create=function(a,d,c,b,f,k,l){var e=new g;e._position.assign(a);e._target.assign(d);e._up.assign(c);e._projection=b;e._width=f;e._height=k;void 0!==l&&(e._nearLimit=l);return e};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){return{position:this._position.toJson(),target:this._target.toJson(),up:this._up.toJson(),width:this._width,height:this._height,projection:this._projection,
nearLimit:this._nearLimit,className:"Communicator.Camera"}};g.prototype.forJson=function(){return this.toJson()};g.fromJson=function(a){var e=d.Point3.fromJson(a.position),c=d.Point3.fromJson(a.target),b=d.Point3.fromJson(a.up);return g.create(e,c,b,a.projection,a.width,a.height,a.nearLimit)};g.construct=function(a){return g.fromJson(a)};g.prototype.transform=function(a){if(a.isIdentity())return this.copy();var e=Math.abs(this._width),c=Math.abs(this._height),b=this.getUp().normalize().scale(c);c=
d.Point3.subtract(this._position,this._target);var f=d.Point3.cross(b,c).normalize().scale(e);e=this.getTarget();f=d.Point3.add(e,f);b=d.Point3.add(e,b);var k=d.Point3.add(e,c);a.transform(e,e);a.transform(f,f);a.transform(b,b);a.transform(k,k);a=d.Point3.subtract(f,e);c=d.Point3.subtract(b,e);b=d.Point3.subtract(k,e);b=d.Point3.add(e,b);f=c.copy().normalize();a=a.length();c=c.length();0>this._width&&(a=-a);0>this._height&&(c=-c);return g.create(b,e,f,this._projection,a,c,this._nearLimit)};return g}();
d.Camera=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e,c,b){var f=this;this._cuttingSections=[];this._isInit=!1;this._standinGeometryPickable=!0;this._cappingFaceColor=d.Color.createFromFloat(.5,.5,.5);this._cappingLineColor=d.Color.createFromFloat(.5,.5,.5);this._cappingIdleCallbackEnabled=!1;this._cappingIdlePromise=null;this._conservativeIsCappingIdle=!1;this._viewer=a;this._model=e;this._callbackManager=c;this._engine=b;a.setCallbacks({cappingIdle:function(b){(f._conservativeIsCappingIdle=b)&&null!==f._cappingIdlePromise&&
(f._cappingIdlePromise.resolve(),f._cappingIdlePromise=null)},_resetAssemblyTreeBegin:function(){null!==f._cappingIdlePromise&&(f._cappingIdlePromise.reject(new d.CommunicatorError("Model became reset.")),f._cappingIdlePromise=null);return Promise.resolve()},_resetOpacity:function(){f._cuttingSections.forEach(function(b){return b.resetPlanesOpacity()})}})}g.prototype.createReferenceGeometryFromAxis=function(a,e){var c=[];switch(a){case d.Axis.X:c.push(new d.Point3(0,e.max.y,e.min.z));c.push(new d.Point3(0,
e.max.y,e.max.z));c.push(new d.Point3(0,e.min.y,e.max.z));c.push(new d.Point3(0,e.min.y,e.min.z));break;case d.Axis.Y:c.push(new d.Point3(e.min.x,0,e.min.z));c.push(new d.Point3(e.max.x,0,e.min.z));c.push(new d.Point3(e.max.x,0,e.max.z));c.push(new d.Point3(e.min.x,0,e.max.z));break;case d.Axis.Z:c.push(new d.Point3(e.min.x,e.max.y,0)),c.push(new d.Point3(e.max.x,e.max.y,0)),c.push(new d.Point3(e.max.x,e.min.y,0)),c.push(new d.Point3(e.min.x,e.min.y,0))}return c};g.prototype.createReferenceGeometryFromFaceNormal=
function(a,e,c){var b=[],f=(new d.Plane).setFromPointAndNormal(e,a).d;f=e.copy().add(d.Point3.scale(a,f));e=c.center();e=d.Point3.add(e,d.Point3.scale(a,d.Point3.dot(a,d.Point3.subtract(f,e))));c=c.extents().length()/2;f=d.Point3.subtract(e,f);var k=d.Point3.cross(a,f),l=f.copy().scale(-1),n=k.copy().scale(-1);a=d.Point3.add(f,k).normalize().scale(c).add(e);k=d.Point3.add(l,k).normalize().scale(c).add(e);l=d.Point3.add(l,n).normalize().scale(c).add(e);e=d.Point3.add(f,n).normalize().scale(c).add(e);
b.push(a);b.push(k);b.push(l);b.push(e);return b};g.prototype.activateCuttingSections=function(){for(var a=[],e=0,c=this._cuttingSections;e<c.length;e++)a.push(c[e].activate());return d.Util.waitForAll(a)};g.prototype.deactivateCuttingSections=function(a){void 0===a&&(a=!1);return a?this.clearAllCuttingSections():this.deactivateAllCuttingSections()};g.prototype.deactivateAllCuttingSections=function(){for(var a=[],e=0,c=this._cuttingSections;e<c.length;e++)a.push(c[e].deactivate());return d.Util.waitForAll(a)};
g.prototype.clearAllCuttingSections=function(){for(var a=[],e=0,c=this._cuttingSections;e<c.length;e++)a.push(c[e].clear());return d.Util.waitForAll(a)};g.prototype.setCuttingPlaneColor=function(a){for(var d=0,c=this._cuttingSections;d<c.length;d++)c[d].setColor(a);return Promise.resolve()};g.prototype.setCappingFaceColor=function(a){this._cappingFaceColor=a?a.copy():null;this._engine.setCappingFaceColor(this._cappingFaceColor);return Promise.resolve()};g.prototype.getCappingFaceColor=function(){return this._cappingFaceColor?
this._cappingFaceColor.copy():null};g.prototype.setCappingLineColor=function(a){this._cappingLineColor=a?a.copy():null;this._engine.setCappingLineColor(this._cappingLineColor);return Promise.resolve()};g.prototype.getCappingLineColor=function(){return this._cappingLineColor?this._cappingLineColor.copy():null};g.prototype.getCuttingSection=function(a){return this._isInit&&a<this._cuttingSections.length?this._cuttingSections[a]:null};g.prototype.getCuttingSectionCapacity=function(){return void 0!==
this._cuttingLimits?this._cuttingLimits.maxCuttingPlanesPerSection:0};g.prototype.getCuttingSectionCount=function(){return void 0!==this._cuttingLimits?this._cuttingLimits.maxCuttingSections:0};g.prototype.getCuttingSectionFromNodeId=function(a){if(null!==a)for(var d=0,c=this._cuttingSections;d<c.length;d++){var b=c[d];if(0<=b._getInstanceNodeIds().indexOf(a))return b}return null};g.prototype.getNodesWithCapping=function(){return __awaiter(this,void 0,void 0,function(){var a,d,c,b;return __generator(this,
function(f){switch(f.label){case 0:return[4,this._engine.getCappedInstances()];case 1:a=f.sent();d=[];for(c=0;c<a.length-1;c+=2)b=this._model._getNodeFromInstanceInc(!1,a[c],a[c+1],!1),d.push(b);return[2,d]}})})};g.prototype.setStandinGeometryPickable=function(a){this._standinGeometryPickable=a;var e=this._gatherStandinGeometryIds();this._model.setInstanceModifier(d.InstanceModifier.DoNotSelect,e,!a);return Promise.resolve()};g.prototype.getStandinGeometryPickable=function(){return this._standinGeometryPickable};
g.prototype._setStandinGeometryVisible=function(a){var d=this,c=this._gatherStandinGeometryIds(),b=this._model._gatherInstanceIncsFromNodeIds(c);this._engine.pauseRendering(function(){d._engine.setPartVisibility(b,a,!1)})};g.prototype.setCappingDelay=function(a){this._engine.setCappingDelay(a)};g.prototype.delayCapping=function(){this._engine.delayCapping()};g.prototype.enableCappingIdleCallback=function(a){a!==this._cappingIdleCallbackEnabled&&(this._cappingIdleCallbackEnabled=a,this._conservativeIsCappingIdle=
!1,a||null===this._cappingIdlePromise||(this._cappingIdlePromise.reject(new d.CommunicatorError("Capping idle callback became disabled.")),this._cappingIdlePromise=null));return this._engine.enableCappingIdleCallback(a)};g.prototype.waitForCappingIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(!this._cappingIdleCallbackEnabled)throw console.assert(null===this._cappingIdlePromise),new d.CommunicatorError("Capping idle callback is not enabled.");
if(this._conservativeIsCappingIdle)return[2];null===this._cappingIdlePromise&&(this._cappingIdlePromise=d.Util.OpenPromise.create());return[2,this._cappingIdlePromise]})})};g.prototype.setCappingGeometryVisibility=function(a){this._engine.setCappingGeometryVisibility(a);return Promise.resolve()};g.prototype.getCappingGeometryVisibility=function(){return this._engine.getCappingGeometryVisibility()};g.prototype.getActiveCuttingSectionCount=function(){var a=0;if(this._cuttingLimits)for(var d=0;d<this._cuttingLimits.maxCuttingSections;d++){var c=
this.getCuttingSection(d);null!==c&&c.isActive()&&(a+=c.getCount())}return a};g.prototype._init=function(){if(!this._isInit){this._cuttingLimits=this._engine.getCuttingSectionLimits();for(var a=0;a<this._cuttingLimits.maxCuttingSections;a++){var e=new d.CuttingSection(this._viewer,this._model,this._callbackManager,this,this._engine);this._cuttingSections.push(e)}this._isInit=!0}};g.prototype._isInitialized=function(){return this._isInit};g.prototype.refreshPlaneGeometry=function(){for(var a=[],e=
0,c=this._cuttingSections;e<c.length;e++)for(var b=c[e],f=0;f<b.getCount();f++){var k=b.getPlane(f);null!==k&&a.push(b.updatePlane(f,k,new d.Matrix,!1,!1))}return d.Util.waitForAll(a)};g.prototype.hasActiveCuttingSection=function(){if(this._cuttingLimits)for(var a=0;a<this._cuttingLimits.maxCuttingSections;a++){var d=this.getCuttingSection(a);if(null!==d&&d.isActive())return!0}return!1};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){for(var a=[],d=0;d<this._cuttingSections.length;d++)a[d]=
this._cuttingSections[d].toJson();return{cuttingSections:a,cappingGeometryVisibility:this.getCappingGeometryVisibility(),cappingFaceColor:this.getCappingFaceColor(),cappingLineColor:this.getCappingLineColor(),pickable:this.getStandinGeometryPickable()}};g.prototype.forJson=function(){return this.toJson()};g.prototype.fromJson=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,k,l;return __generator(this,function(n){switch(n.label){case 0:e=d.Internal.deepClone(a);c=[];b=e.cuttingSections;
for(f=0;f<b.length;f++)k=b[f],l=this._cuttingSections[f],c.push(l.fromJson(k));this.setStandinGeometryPickable(e.pickable);c.push(this.setCappingGeometryVisibility(e.cappingGeometryVisibility));c.push(this.setCappingFaceColor(d.Color.fromJson(e.cappingFaceColor)));c.push(this.setCappingLineColor(d.Color.fromJson(e.cappingLineColor)));return[4,Promise.all(c)];case 1:return n.sent(),this._callbackManager.trigger("cuttingSectionsLoaded"),[2]}})})};g.prototype._gatherStandinGeometryIds=function(){for(var a=
[],d=0,c=this._cuttingSections;d<c.length;d++)for(var b=0,f=c[d]._getInstanceNodeIds();b<f.length;b++)a.push(f[b]);return a};return g}();d.CuttingManager=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c,b,f,k){this._container=a;this._canvasContainerElement=c;this._markupSvgElement=b;this._redlineSvgElement=f;this._redlineElement=k}a.prototype.getCanvasContainerElement=function(){return this._canvasContainerElement};a.prototype.getMarkupSvgElement=function(){return this._markupSvgElement};a.prototype.getRedlineSvgElement=function(){return this._redlineSvgElement};a.prototype.getRedlineElement=function(){return this._redlineElement};a.prototype.shutdown=
function(){this._container.removeChild(this._markupSvgElement);this._container.removeChild(this._redlineSvgElement);this._container.removeChild(this._redlineElement);this._container.removeChild(this._canvasContainerElement)};a.createFromElement=function(e){var c=e.id;0===c.length&&(c=d.UUID.create());var b=c+"-canvas-container",f=c+"-svg",k=c+"-redline-svg";c+="-redline";var l=document.createElement("div");l.id=b;l.style.width="100%";l.style.height="100%";l.style.position="absolute";l.tabIndex=-1;
l.classList.add("webviewer-canvas");l.oncontextmenu=function(){return!1};e.appendChild(l);b=a._createSvgElement(f);e.appendChild(b);k=a._createSvgElement(k);e.appendChild(k);f=document.createElement("div");f.id=c;f.style.position="absolute";f.style.width="100%";f.style.height="100%";f.style.pointerEvents="none";e.appendChild(f);return new a(e,l,b,k,f)};a.createFromId=function(a){a=document.getElementById(a);return null===a?null:this.createFromElement(a)};a._createSvgElement=function(a){var c=document.createElementNS("http://www.w3.org/2000/svg",
"svg");c.id=a;c.style.width="100%";c.style.height="100%";c.style.position="absolute";c.style.pointerEvents="none";c.style.overflow="hidden";c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");return c};return a}();h.DomElements=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
var __extends=this&&this.__extends||function(){var d=function(h,g){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,d){a.__proto__=d}||function(a,d){for(var c in d)d.hasOwnProperty(c)&&(a[c]=d[c])};return d(h,g)};return function(h,g){function a(){this.constructor=h}d(h,g);h.prototype=null===g?Object.create(g):(a.prototype=g.prototype,new a)}}();
(function(d){var h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(Error);d.CommunicatorError=h;var g=function(a){function c(b){b=a.call(this,"Invalid index ("+b+").")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.InvalidIndexError=g;g=function(a){function c(){var b=a.call(this,"Cannot pick from outside the canvas area.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);
d.PickOutsideCanvasError=g;g=function(a){function c(){var b=a.call(this,"Selection invalidated.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.SelectionInvalidatedError=g;g=function(a){function c(){var b=a.call(this,"Internal logic error.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.InternalLogicError=g;g=function(a){function c(b){var f=a.call(this,"Invalid node ("+b+").")||this;Object.setPrototypeOf(f,c.prototype);f.nodeId=
b;return f}__extends(c,a);return c}(h);d.InvalidNodeIdError=g;g=function(a){function c(b,f){for(var k=[],e=2;e<arguments.length;e++)k[e-2]=arguments[e];k.push(f);e=[];for(var n=0;n<k.length;n++){var g=k[n];switch(g){case 0:e.push(d.NodeType.DrawingSheet,d.NodeType.PartInstance,d.NodeType.AssemblyNode);break;case 1:e.push(d.NodeType.BodyInstance);e.push(d.NodeType.PmiBody);e.push(d.NodeType.ViewFrame);break;case 2:e.push(d.NodeType.BodyInstance);break;case 3:e.push(d.NodeType.CadView);break;default:d.Util.TypeAssertNever(g)}}e.sort();
k=[];for(n=0;n<e.length;n++)k.push(d.NodeType[e[n]]);k=a.call(this,"Expected node ("+b+") to be of "+(1===k.length?"type ("+k[0]+")":"types "+k)+".")||this;Object.setPrototypeOf(k,c.prototype);k.nodeId=b;k.expectedTypes=e;return k}__extends(c,a);return c}(h);d.InvalidNodeTypeError=g;g=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.LoadError=g;var a=function(a){function c(){var b=a.call(this,"Load cancelled.")||this;Object.setPrototypeOf(b,
c.prototype);return b}__extends(c,a);return c}(g);d.LoadCancelledError=a;g=function(a){function c(b){b=a.call(this,"Missing model: '"+b+"'.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(g);d.MissingModelError=g;h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.ParseError=h;g=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);
d.AssemblyDataParseError=g;d.MetaDataParseError=g;h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.XmlParseError=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d,c){var b=this;this._explodeActive=!1;this._explodeMagnitude=0;this._model=a;this._engine=d;c.bind({_modelSwitched:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){this.stop();return[2]})})}})}d.prototype.start=function(a,d){this.getActive()&&this.stop();return this._doExplode(a,d)};d.prototype.setMagnitude=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return 0<
a&&!this._explodeActive?[4,this.start()]:[3,2];case 1:return d.sent(),[3,3];case 2:0===a&&this._explodeActive&&this.stop(),d.label=3;case 3:return this._explodeActive?(this._explodeMagnitude=a,[2,this._engine.setExplodeMagnitude(a)]):[2]}})})};d.prototype.stop=function(){this._engine.stopExplode();this._explodeMagnitude=0;this._explodeActive=!1;this._engine.setExplodeMagnitude(0);return Promise.resolve()};d.prototype.getMagnitude=function(){return this._explodeMagnitude};d.prototype.getActive=function(){return this._explodeActive};
d.prototype._doExplode=function(a,d){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(f){switch(f.label){case 0:return this._explodeActive=!0,c=void 0!==a&&0<a.length?this._model._gatherInstanceIncsFromNodeIds(a):[],d?[3,2]:[4,this._model.getModelBounding(!0,!1)];case 1:return b=f.sent(),this._engine.startExplode(c,b.center()),[3,3];case 2:this._engine.startExplode(c,d),f.label=3;case 3:return[2]}})})};return d}();d.ExplodeManager=h})(Communicator||(Communicator=
{}));
(function(d){function h(b){if(0===b.length)return new d.Matrix;if(1===b.length)return b[0];for(var c=d.Matrix.multiply(b[1],b[0]),f=2;f<b.length;++f)c=d.Matrix.multiply(b[f],c);return c}function g(b,c){return b.x>=c.min.x&&b.x<=c.max.x&&b.y>=c.min.y&&b.y<=c.max.y&&b.z>=c.min.z&&b.z<=c.max.z}function a(b,c){return b.z>=c.min.z&&b.z<=c.max.z}var e=function(){function b(){this.overlayAnchor=d.OverlayAnchor.LowerRightCorner;this.overlaySize=new d.Point2(.25,1);this.overlayWidthUnit=d.OverlayUnit.ProportionOfCanvas;this.overlayHeightUnit=
d.OverlayUnit.ProportionOfOtherDimension;this.overlayOffset=new d.Point2(0,0);this.overlayOffsetYUnit=this.overlayOffsetXUnit=d.OverlayUnit.Pixels;this.backgroundColor=d.Color.white();this.backgroundOpacity=.25;this.borderColor=d.Color.black();this.borderOpacity=1;this.avatarColor=d.Color.createFromFloat(1,0,1);this.avatarOutlineColor=d.Color.black();this.avatarScale=this.avatarOpacity=1;this.fixedAvatarScale=!0;this.overlayFeetPerPixel=.1;this.zoomLevel=1;this.autoActivate=c.BimWalk;this.floorplanOrientation=
d.FloorplanOrientation.NorthUp;this.customAvatar=null;this.trackCameraEnabled=!1}b.prototype.copy=function(){var c=new b;c.overlayAnchor=this.overlayAnchor;c.overlaySize=this.overlaySize.copy();c.overlayWidthUnit=this.overlayWidthUnit;c.overlayHeightUnit=this.overlayHeightUnit;c.overlayOffset=this.overlayOffset.copy();c.overlayOffsetXUnit=this.overlayOffsetXUnit;c.overlayOffsetYUnit=this.overlayOffsetYUnit;c.backgroundColor=this.backgroundColor.copy();c.backgroundOpacity=this.backgroundOpacity;c.borderColor=
this.borderColor.copy();c.borderOpacity=this.borderOpacity;c.avatarColor=this.avatarColor.copy();c.avatarOutlineColor=this.avatarOutlineColor.copy();c.avatarOpacity=this.avatarOpacity;c.avatarScale=this.avatarScale;c.fixedAvatarScale=this.fixedAvatarScale;c.customAvatar=this.customAvatar;c.overlayFeetPerPixel=this.overlayFeetPerPixel;c.zoomLevel=this.zoomLevel;c.trackCameraEnabled=this.trackCameraEnabled;c.autoActivate=this.autoActivate;c.floorplanOrientation=this.floorplanOrientation;return c};return b}();
d.FloorplanConfig=e;var c;(function(b){b[b.Never=0]="Never";b[b.Bim=1]="Bim";b[b.BimWalk=2]="BimWalk"})(c=d.FloorplanAutoActivation||(d.FloorplanAutoActivation={}));var b=function(){return function(b,c,f,a,d){this.floorplanNode=null;this.floorNode=b;this.bounds=c;this.slabNodes=f;this.spaceNodes=a;this.floorplanMeshCreationNodes=d}}(),f=function(){function f(b,c,f,a,k,g){var l=this;this._active="inactive";this._isCallbacksSet=this._isOverlayVisible=this._isModelLoaded=this._isSceneReady=!1;this._onCameraUpdateFunc=
this._doCameraUpdate.bind(this);this._onFrameDrawnFunc=this._onFrameDrawn.bind(this);this._currentFloorInfo=this._floorplanNode=null;this._config=new e;this._tightBoundings=this._floorLock=!1;this._genericStoreyType="IFCBUILDINGSTOREY";this._floorInfos=new Map;this._floorInfosArray=[];this._avatarNode=null;this._avatarDirty=!0;this._borderNode=null;this._borderDirty=!0;this._backgroundNode=null;this._backgroundDirty=!0;this._canvasSize=new d.Point2(1,1);this._sync=new d.Internal.PromiseQueue(1,!0);
this._setFloorplanSync=new d.Internal.SingleMostRecentPromiseQueue(!1);this._viewer=b;this._model=c;this._engine=a;this._modelStructure=k;this._overlayManager=f;this._config=g.copy();this._viewer.setCallbacks({sceneReady:function(){return __awaiter(l,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return console.assert("active"!==this._active,"Got sceneReady while Floorplan is Active"),this._isSceneReady=!0,"activating"!==this._active?[3,2]:[4,this._sync.push(function(){return b._doUpdateActivation()})];
case 1:c.sent(),c.label=2;case 2:return[2]}})})},modelSwitchStart:function(){return __awaiter(l,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return this._isModelLoaded=!1,[4,this._sync.push(function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){return[2,this._deactivate()]})})})];case 1:return c.sent(),[2]}})})},firstModelLoaded:function(b){return __awaiter(l,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._isModelLoaded=
!0,[4,this._onModelLoaded()];case 1:return b.sent(),[2]}})})},subtreeLoaded:function(b,c){return __awaiter(l,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._isModelLoaded=!0,[4,this._onModelLoaded()];case 1:return b.sent(),[2]}})})}})}f.prototype.setCustomAvatar=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._config.customAvatar===b?[2]:[4,this._doSetCustomAvatar(b)];
case 1:return c.sent(),this._avatarDirty=!0,[2,this._onConfigurationChanged()]}})})};f.prototype.setOverlaySize=function(b,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){this._config.overlaySize=b.copy();this._config.overlayWidthUnit=c;this._config.overlayHeightUnit=f;return[2,this._onConfigurationChanged()]})})};f.prototype.setOverlayAnchor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.overlayAnchor=
b;return[2,this._onConfigurationChanged()]})})};f.prototype.setOverlayOffset=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.overlayOffset=b.copy();return[2,this._onConfigurationChanged()]})})};f.prototype.setOverlayFeetPerPixel=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.overlayFeetPerPixel=b;return[2,this._onConfigurationChanged()]})})};f.prototype.setZoomLevel=function(b){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){this._config.zoomLevel=b;return[2,this._onConfigurationChanged()]})})};f.prototype.setBackgroundColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.backgroundColor=b;this._backgroundDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setBackgroundOpacity=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.backgroundOpacity=
b;this._backgroundDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setBorderColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.borderColor=b;this._borderDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setBorderOpacity=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.borderOpacity=b;this._borderDirty=!0;return[2,this._onConfigurationChanged()]})})};
f.prototype.setAvatarColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.avatarColor=b;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setAvatarOutlineColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.avatarOutlineColor=b;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setAvatarOpacity=function(b){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){this._config.avatarOpacity=b;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setAvatarScale=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.avatarScale=b;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setFixedAvatarScale=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._config.fixedAvatarScale===
b?[2]:[4,this._deleteAvatarNode()];case 1:return c.sent(),this._config.fixedAvatarScale=b,this._avatarDirty=!0,[2,this._onConfigurationChanged()]}})})};f.prototype.setTrackCameraEnabled=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.trackCameraEnabled=b;return[2,this._onConfigurationChanged()]})})};f.prototype.setFloorplanOrientation=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.floorplanOrientation=
b;return[2,this._onConfigurationChanged()]})})};f.prototype.setAutoActivate=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.autoActivate=b;return[2,this._onConfigurationChanged()]})})};f.prototype.setFloorLock=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:this._floorLock=b;if(!this.isActive()||b)return[3,2];c=this._viewer.view.getCamera().getPosition();return[4,
this._setFloorplanFromPosition(c)];case 1:f.sent(),f.label=2;case 2:return[2]}})})};f.prototype.getFloorLock=function(){return this._floorLock};f.prototype.setUseTightBoundings=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return b===this._tightBoundings?[2]:[4,this._deleteAllFloorplans()];case 1:return c.sent(),this._tightBoundings=b,this.isActive()?[4,this._onProcessIfc()]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};
f.prototype.setConfiguration=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return c=this._config.customAvatar,this._config=b.copy(),c===this._config.customAvatar?[3,2]:[4,this._doSetCustomAvatar(this._config.customAvatar)];case 1:f.sent(),f.label=2;case 2:return this._avatarDirty=this._backgroundDirty=this._borderDirty=!0,[2,this._onConfigurationChanged()]}})})};f.prototype.getConfiguration=function(){return this._config.copy()};
f.prototype.getCurrentFloorNodeId=function(){return null!==this._currentFloorInfo?this._currentFloorInfo.floorNode:null};f.prototype.getAvatarNodeId=function(){return this._avatarNode};f.prototype.insideOverlay=function(b){var c=this._getOverlaySizeInPixels(),f=this._getOverlayOffsetInPixels();return b.x>=f.x&&b.y>=f.y&&b.x<=f.x+c.x&&b.y<=f.y+c.y};f.prototype.activate=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return[4,
this._sync.push(function(){return b._activate()})];case 1:return c.sent(),[2]}})})};f.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sync.push(function(){return b._deactivate()})];case 1:return c.sent(),[2]}})})};f.prototype._deleteAvatarNode=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:if(null===this._avatarNode)return[3,
5];c.label=1;case 1:return c.trys.push([1,3,,4]),this._modelStructure.allowNodeDeletion(this._avatarNode),[4,this._model.deleteNode(this._avatarNode)];case 2:return c.sent(),[3,4];case 3:return b=c.sent(),console.log("Problem deleting existing avatar: "+b.message),[3,4];case 4:this._avatarNode=null,c.label=5;case 5:return[2]}})})};f.prototype._doSetCustomAvatar=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._deleteAvatarNode()];
case 1:return c.sent(),this._config.customAvatar=b,[2]}})})};f.prototype._onConfigurationChanged=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:this._config.zoomLevel=Math.max(.1,Math.min(10,this._config.zoomLevel));this._config.avatarScale=Math.max(.1,Math.min(10,this._config.avatarScale));this._config.backgroundOpacity=Math.max(0,Math.min(1,this._config.backgroundOpacity));this._config.borderOpacity=Math.max(0,Math.min(1,this._config.borderOpacity));
this._config.avatarOpacity=Math.max(0,Math.min(1,this._config.avatarOpacity));if(this._isModelLoaded&&"inactive"===this._active&&this._config.autoActivate===c.Bim)return[2,this._onModelLoaded()];if(!this._isOverlayVisible)return[3,2];this._isOverlayVisible=!1;return[4,this._setupOverlay()];case 1:b.sent(),b.label=2;case 2:return[2,this._doCameraUpdate()]}})})};f.prototype._setFloorplanFromPosition=function(b){return __awaiter(this,void 0,void 0,function(){var c=this;return __generator(this,function(f){return[2,
this._setFloorplanSync.push(function(){return c._doSetFloorplanFromPosition(b)})]})})};f.prototype._doSetFloorplanFromPosition=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,k,e,l,h,u,w,v=this;return __generator(this,function(n){switch(n.label){case 0:c=null;d=[];k=0;for(e=this._floorInfosArray;k<e.length;k++)l=e[k],g(b,l.bounds)&&d.push(l);h=function(c){return __awaiter(v,void 0,void 0,function(){var d,k,e,l,g,n,m,p,q,h,r,t,u,w;return __generator(this,function(v){switch(v.label){case 0:return[4,
this._performDownwardSelection(b)];case 1:d=v.sent(),k=0,e=d,v.label=2;case 2:if(!(k<e.length))return[3,6];l=e[k];g=l.getNodeId();n=this._model.getNodeParent(g);if(null===n)return[3,5];m=this._viewer.model.getNodeGenericType(n);return null===m?[3,5]:f._ifcSpaceTypes.has(m)?[4,this._viewer.model.getNodesBounding([n])]:[3,4];case 3:p=v.sent();q=a(b,p);if(!q)return[3,5];h=0;for(r=c;h<r.length;h++)if(t=r[h],-1!==t.spaceNodes.indexOf(n))return[2,t];return[3,5];case 4:if(f._ifcFloorTypes.has(m))for(u=0,
w=c;u<w.length;u++)if(t=w[u],-1!==t.slabNodes.indexOf(n))return[2,t];v.label=5;case 5:return k++,[3,2];case 6:return[2,null]}})})};return[4,h(d)];case 1:c=n.sent();if(null===c)for(u=0,w=this._floorInfosArray;u<w.length;u++)if(l=w[u],a(b,l.bounds)){c=l;break}return null!==c&&(this._currentFloorInfo=c,null===this._floorplanNode||this._floorplanNode!==c.floorplanNode)?[2,this._setFloorplanFromFloorNode(c.floorNode)]:[2]}})})};f.prototype._performDownwardSelection=function(b){return __awaiter(this,void 0,
void 0,function(){var c,f,a,k,e,l,g,h,v,y;return __generator(this,function(n){switch(n.label){case 0:return c=new d.PickConfig,c.respectVisibility=!1,c.oneEntityPerTypePerInstance=!0,f=new d.Ray(b,new d.Point3(0,0,-1)),[4,this._viewer.view.pickAllFromRay(f,c)];case 1:a=n.sent(),k=new Map,e=0,l=a,n.label=2;case 2:if(!(e<l.length))return[3,5];g=l[e];h=g.getNodeId();return[4,this._model.getNodesBounding([h])];case 3:v=n.sent(),k.set(h,v.max.z),n.label=4;case 4:return e++,[3,2];case 5:return y=function(b,
c){b=k.get(b.getNodeId());c=k.get(c.getNodeId());return void 0===b||void 0===c?-1:c-b},[2,a.sort(y)]}})})};f.prototype._activate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:if("inactive"!==this._active)return[2];this._active="activating";return[4,this._doUpdateActivation()];case 1:return b.sent(),[2]}})})};f.prototype._deactivate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:if("inactive"===
this._active)return[2];this._active="inactive";this._isCallbacksSet&&(this._isCallbacksSet=!1,this._viewer.unsetCallbacks({camera:this._onCameraUpdateFunc,frameDrawn:this._onFrameDrawnFunc,transitionEnd:this._onCameraUpdateFunc}));this._isOverlayVisible=!1;return[4,this._overlayManager.setVisibility(d.BuiltinOverlayIndex.Floorplan,this._isOverlayVisible)];case 1:return b.sent(),this._borderNode?[4,this._model.deleteNode(this._borderNode)]:[3,3];case 2:b.sent(),this._borderNode=null,b.label=3;case 3:return this._backgroundNode?
[4,this._model.deleteNode(this._backgroundNode)]:[3,5];case 4:b.sent(),this._backgroundNode=null,b.label=5;case 5:return[4,this._deleteAllFloorplans()];case 6:return b.sent(),[2]}})})};f.prototype._onModelLoaded=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sync.push(function(){return b._doOnModelLoaded()})];case 1:return c.sent(),[2]}})})};f.prototype._doOnModelLoaded=function(){return __awaiter(this,
void 0,void 0,function(){var b,f;return __generator(this,function(a){switch(a.label){case 0:return console.assert(this._isModelLoaded,"Model not loaded as expected"),(f=(b=this._model.getNodesByGenericType(this._genericStoreyType))&&0<b.size)?[3,2]:[4,this._deactivate()];case 1:return a.sent(),[2];case 2:return"inactive"===this._active?f&&this._config.autoActivate===c.Bim&&(this._active="activating"):"active"===this._active&&(this._active="activating"),"activating"!==this._active?[3,4]:[4,this._doUpdateActivation()];
case 3:a.sent(),a.label=4;case 4:return[2]}})})};f.prototype._doUpdateActivation=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:if("activating"!==this._active||!this._isSceneReady||!this._isModelLoaded)return[2];this._active="active";return this._isOverlayVisible?[3,2]:[4,this._setupOverlay()];case 1:b.sent(),b.label=2;case 2:return[4,this._onProcessIfc()];case 3:return b.sent(),this._isCallbacksSet||(this._isCallbacksSet=!0,this._viewer.setCallbacks({camera:this._onCameraUpdateFunc,
frameDrawn:this._onFrameDrawnFunc,transitionEnd:this._onCameraUpdateFunc})),[2]}})})};f.prototype._deleteAllFloorplans=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,a;return __generator(this,function(d){switch(d.label){case 0:b=this._floorInfosArray.slice(),this._floorInfos.clear(),this._floorInfosArray.length=0,this._currentFloorInfo=this._floorplanNode=null,c=0,f=b,d.label=1;case 1:if(!(c<f.length))return[3,4];a=f[c];return a.floorplanNode?[4,this._model.deleteNode(a.floorplanNode)]:
[3,3];case 2:d.sent(),d.label=3;case 3:return c++,[3,1];case 4:return[2]}})})};f.prototype._hideActiveFloorplan=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._floorplanNode?[2]:[4,this._hideOverlayNode(this._floorplanNode)];case 1:return b.sent(),this._currentFloorInfo=this._floorplanNode=null,[2]}})})};f.prototype._onProcessIfc=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return console.assert("active"===this._active),[4,this._gatherFloorInfos()];case 1:return b.sent(),[4,this._doCameraUpdate()];case 2:return b.sent(),[2]}})})};f.prototype._hasFloorInfo=function(b){return this._floorInfos.has(b)};f.prototype._getFloorInfo=function(b){b=this._floorInfos.get(b);return void 0===b?null:b};f.prototype._createFloorInfo=function(c){return __awaiter(this,void 0,void 0,function(){var a,d,k,e,l;return __generator(this,function(g){switch(g.label){case 0:return a=
[],this._gatherDescendentIfcNodes(c,f._ifcFloorTypes,a),d=[],this._gatherDescendentIfcNodes(c,f._ifcSpaceTypes,d),k=[],this._gatherDescendentIfcNodes(c,f._ifcFloorplanCreationTypes,k),0===k.length?[2,null]:[4,this._model.getNodesBounding(k,{bodyInstance:!0,pmiBody:!1,viewFrame:!1,tightBounding:this._tightBoundings})];case 1:return e=g.sent(),l=new b(c,e,a,d,k),this._floorInfos.set(c,l),this._floorInfosArray.push(l),[2,l]}})})};f.prototype._gatherFloorInfos=function(){return __awaiter(this,void 0,
void 0,function(){var b,c,a,k;return __generator(this,function(e){switch(e.label){case 0:return b=this._model.getNodesByGenericType(f._genericStoreyType),null!==b&&0!==b.size?[3,2]:[4,this._deactivate()];case 1:return e.sent(),[2];case 2:c=0,a=d.Util.setToArray(b),e.label=3;case 3:if(!(c<a.length))return[3,6];k=a[c];return this._hasFloorInfo(k)?[3,5]:[4,this._createFloorInfo(k)];case 4:e.sent(),e.label=5;case 5:return c++,[3,3];case 6:return 0!==this._floorInfos.size?[3,8]:[4,this._deactivate()];
case 7:e.sent(),e.label=8;case 8:return[2]}})})};f.prototype._gatherDescendentIfcNodes=function(b,c,f){var a=0;for(b=this._model.getNodeChildren(b);a<b.length;a++){var d=b[a],k=this._model.getNodeGenericType(d);null!==k&&c.has(k)&&f.push(d);this._gatherDescendentIfcNodes(d,c,f)}};f.prototype._createFloorplanFromFloorInfo=function(b){return __awaiter(this,void 0,void 0,function(){var c,f,a,d,k;return __generator(this,function(e){switch(e.label){case 0:return c=this._model._gatherInstanceIncsFromNodeIds(b.floorplanMeshCreationNodes),
[4,this._engine.createFloorplanMesh(c)];case 1:return f=e.sent(),a=f[0],d=f[1],k=this._modelStructure.createMeshInstance(a,d,"floorplan",null,!0,!0,!1),[2,k]}})})};f.prototype._onFrameDrawn=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:b=this._viewer.view.getCanvasSize();if(b.equals(this._canvasSize))return[3,2];this._canvasSize=b.copy();if(!this._isOverlayVisible)return[3,2];this._isOverlayVisible=!1;return[4,this._setupOverlay()];
case 1:c.sent(),c.label=2;case 2:return[2]}})})};f.prototype._doCameraUpdate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this.isActive()?this._floorLock?[3,2]:[4,this._setFloorplanFromPosition(this._viewer.view.getCamera().getPosition())]:[2];case 1:b.sent(),b.label=2;case 2:return b.trys.push([2,,4,5]),this._viewer.pauseRendering(),[4,this._updateOverlay()];case 3:return b.sent(),[3,5];case 4:return this._viewer.resumeRendering(),
[7];case 5:return[2]}})})};f.prototype.isActive=function(){return"active"===this._active};f.prototype._updateOverlay=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f;return __generator(this,function(a){switch(a.label){case 0:if(!this.isActive())return[2];b=this._viewer.view.getCamera();c=b.getPosition();f=d.Point3.subtract(b.getTarget(),c);f.z=0;f.normalize();if(isNaN(f.x)||0===f.length())f=new d.Point3(0,1,0);return[4,this._updateOverlayCamera(c,f)];case 1:return a.sent(),[4,this._updateOverlayNodes(c,
f)];case 2:return a.sent(),[2]}})})};f.prototype._updateOverlayNodes=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,k,e,l,g,n,w,v,y,x,z,A,C,B,D,F,E,G,H,I;return __generator(this,function(m){switch(m.label){case 0:return a=this._model,k=this._config,e=304.8*this._model.getNodeUnitMultiplier(this._model.getAbsoluteRootNode()),l=this._getOverlaySizeInPixels(),g=l.x/l.y,n=e*k.overlayFeetPerPixel/k.zoomLevel,w=n/g,v=n*l.x,y=v/g,k.trackCameraEnabled||(x=this._getFixedCameraSize(g),null!==
x&&(v=x.x,y=x.y)),z=(new d.Matrix).setTranslationComponent(b.x,b.y,f._avatarZ),A=e*k.avatarScale,C=(new d.Matrix).setScaleComponent(A,A,A),B=new d.Matrix,B.m[0]=c.y,B.m[1]=-c.x,B.m[2]=0,B.m[4]=c.x,B.m[5]=c.y,B.m[6]=0,B.m[8]=0,B.m[9]=0,B.m[10]=1,[4,this._viewer.model.setNodeMatrix(this._avatarNode,h([z,B,C]))];case 1:return m.sent(),this._avatarDirty&&(null===k.customAvatar&&(a.setNodesFaceColor([this._avatarNode],k.avatarColor),a.setNodesLineColor([this._avatarNode],k.avatarOutlineColor),a.setNodesOpacity([this._avatarNode],
k.avatarOpacity)),this._avatarDirty=!1),this._borderDirty&&(a.setNodesLineColor([this._borderNode],k.borderColor),a.setNodesOpacity([this._borderNode],k.borderOpacity),this._borderDirty=!1),this._backgroundDirty&&(a.setNodesFaceColor([this._backgroundNode],k.backgroundColor),a.setNodesOpacity([this._backgroundNode],k.backgroundOpacity),this._backgroundDirty=!1),D=v-n,F=y-w,E=(new d.Matrix).setScaleComponent(D,F,1),G=new d.Matrix,this._config.trackCameraEnabled||null===this._currentFloorInfo?G.setTranslationComponent(b.x,
b.y,0):(H=this._currentFloorInfo.bounds.center(),G.setTranslationComponent(H.x,H.y,0)),I=this._config.floorplanOrientation===d.FloorplanOrientation.AvatarUp?h([G,B,E]):d.Matrix.multiply(E,G),[4,this._viewer.model.setNodeMatrix(this._borderNode,I)];case 2:return m.sent(),[4,this._viewer.model.setNodeMatrix(this._backgroundNode,I)];case 3:return m.sent(),[2]}})})};f.prototype.snapAvatarToPoint=function(b){if(null!==this._currentFloorInfo&&this.insideOverlay(b))if(this._config.trackCameraEnabled)console.log("FP: snapAvatarToPoint: currently only supported when trackCameraEnabled is false");
else{var c=this._getOverlaySizeInPixels(),f=this._getOverlayOffsetInPixels(),a=new d.Point2(b.x-f.x,b.y-f.y),k=this._currentFloorInfo.bounds,e=k.extents(),l=e.x/e.y,g=c.x/c.y;b=this._viewer.view.getCamera();f=b.getPosition();var h=b.getTarget(),v=new d.Matrix;if(this._config.floorplanOrientation!==d.FloorplanOrientation.NorthUp){v=d.Point3.subtract(h,f);v=(new d.Point3(v.x,v.y,0)).normalize();var y=new d.Point3(0,1,0),x=new d.Point3(-1,0,0);x=90<d.Util.computeAngleBetweenVector(x,v)?new d.Point3(0,
0,-1):new d.Point3(0,0,1);v=d.Util.computeAngleBetweenVector(y,v);v=d.Matrix.createFromOffAxisRotation(x,v)}g>l?(c=e.y/c.y,k=new d.Point2(k.center().x-e.y/2*g,k.center().y+e.y/2)):(c=e.x/c.x,k=new d.Point2(k.center().x-e.x/2,k.center().y+e.x/2/g));c=new d.Point3(a.x*c+k.x,k.y-a.y*c,f.z);c=v.transform(c);f=d.Point3.subtract(h,f);f=d.Point3.add(c,f);b.setPosition(c);b.setTarget(f);b.setProjection(d.Projection.Perspective);this._viewer.view.setCamera(b)}};f.prototype._getOverlaySizeInPixels=function(){var b=
new d.OverlayUnitPoint(this._config.overlaySize.x,this._config.overlayWidthUnit,this._config.overlaySize.y,this._config.overlayHeightUnit);return this._viewer.overlayManager._toPixelPoint(b)};f.prototype._getOverlayOffsetInPixels=function(){var b=this._overlayManager.getViewportPixelOffsetInCanvas(d.BuiltinOverlayIndex.Floorplan);return null===b?d.Point2.zero():b};f.prototype._getFixedCameraSize=function(b){if(null!==this._currentFloorInfo){var c=this._currentFloorInfo.bounds.extents();return c.x/
c.y>b?new d.Point2(c.x,c.x/b):new d.Point2(c.y*b,c.y)}return null};f.prototype._updateOverlayCamera=function(b,c){return __awaiter(this,void 0,void 0,function(){var f,a,k,e,l,g,n,h,y,x;return __generator(this,function(m){switch(m.label){case 0:return f=this._config,a=this._getOverlaySizeInPixels(),k=a.x/a.y,e=304.8*this._model.getNodeUnitMultiplier(this._model.getAbsoluteRootNode()),l=e*f.overlayFeetPerPixel/f.zoomLevel,g=l*a.x,n=g/k,f.trackCameraEnabled||(h=this._getFixedCameraSize(k),null!==h&&
(g=h.x,n=h.y)),y=new d.Camera,y.setWidth(g),y.setHeight(n),this._config.trackCameraEnabled||null===this._currentFloorInfo?(y.setTarget(new d.Point3(b.x,b.y,0)),y.setPosition(new d.Point3(b.x,b.y,10))):(x=this._currentFloorInfo.bounds.center(),y.setTarget(new d.Point3(x.x,x.y,0)),y.setPosition(new d.Point3(x.x,x.y,10))),f.floorplanOrientation===d.FloorplanOrientation.AvatarUp?y.setUp(c):f.floorplanOrientation===d.FloorplanOrientation.NorthUp&&y.setUp(new d.Point3(0,1,0)),[4,this._overlayManager.setCamera(d.BuiltinOverlayIndex.Floorplan,
y)];case 1:return m.sent(),[2]}})})};f.prototype._setFloorplanFromFloorNode=function(b){return __awaiter(this,void 0,void 0,function(){var c,f,a,k;return __generator(this,function(e){switch(e.label){case 0:return[4,this._hideActiveFloorplan()];case 1:e.sent();if(!this._hasFloorInfo(b))return[3,2];f=this._getFloorInfo(b);return[3,4];case 2:return[4,this._createFloorInfo(b)];case 3:f=e.sent(),e.label=4;case 4:return c=f,null===c?[2]:null!==c.floorplanNode?[3,9]:[4,this._createFloorplanFromFloorInfo(c)];
case 5:return a=e.sent(),k=new d.Matrix,[4,this._model.setNodeMatrix(a,k,!0)];case 6:return e.sent(),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[a])];case 7:return e.sent(),this._floorplanNode=c.floorplanNode=a,this._currentFloorInfo=c,[4,this._showOverlayNode(a)];case 8:return e.sent(),[3,11];case 9:return this._floorplanNode=c.floorplanNode,this._currentFloorInfo=c,[4,this._showOverlayNode(c.floorplanNode)];case 10:e.sent(),e.label=11;case 11:return[4,this._updateOverlay()];
case 12:return e.sent(),[2]}})})};f.prototype._setupOverlay=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a,k,e,g;return __generator(this,function(l){switch(l.label){case 0:return b=this._config,console.assert(this.isActive()),c=this._overlayManager,this._isOverlayVisible=!0,[4,c.setViewport(d.BuiltinOverlayIndex.Floorplan,b.overlayAnchor,b.overlayOffset.x,b.overlayOffsetXUnit,b.overlayOffset.y,b.overlayOffsetYUnit,b.overlaySize.x,b.overlayWidthUnit,b.overlaySize.y,b.overlayHeightUnit)];
case 1:return l.sent(),[4,c.setVisibility(d.BuiltinOverlayIndex.Floorplan,this._isOverlayVisible)];case 2:l.sent();if(this._avatarNode)return[3,7];a=this;if(null===this._config.customAvatar)return[3,3];k=this._config.customAvatar;return[3,5];case 3:return[4,this._createAvatar()];case 4:k=l.sent(),l.label=5;case 5:return a._avatarNode=k,this._modelStructure.preventNodeDeletion(this._avatarNode),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[this._avatarNode])];case 6:l.sent(),l.label=
7;case 7:if(this._borderNode)return[3,10];e=this;return[4,this._create2dBox(!0,!1,f._borderZ)];case 8:return e._borderNode=l.sent(),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[this._borderNode])];case 9:l.sent(),this._borderDirty=!0,l.label=10;case 10:if(this._backgroundNode)return[3,13];g=this;return[4,this._create2dBox(!1,!0,f._backgroundZ)];case 11:return g._backgroundNode=l.sent(),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[this._backgroundNode])];case 12:l.sent(),
this._backgroundDirty=!0,l.label=13;case 13:return[4,this._updateOverlay()];case 14:return l.sent(),[2]}})})};f.prototype._hideOverlayNode=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return c=new d.Matrix,c.setTranslationComponent(1E30,0,0),[4,this._model.setNodeMatrix(b,c,!0)];case 1:return f.sent(),[2]}})})};f.prototype._showOverlayNode=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return[4,this._model.setNodeMatrix(b,new d.Matrix,!0)];case 1:return c.sent(),[2]}})})};f.prototype._createAvatar=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,a,k,e,g,h,w,v,y;return __generator(this,function(l){switch(l.label){case 0:return b=this._config.fixedAvatarScale?1E4:1,c=1.2/b,f=1.5/b,a=-1.1/b,k=[0,f,0,-c,-f,0,0,a,0,0,f,0,0,a,0,c,-f,0],e=[-c,-f,0,0,f,0,c,-f,0,0,a,0,-c,-f,0],g=new d.MeshData,g.setBackfacesEnabled(!1),g.addFaces(k,void 0,
void 0,void 0),g.addPolyline(e,void 0),[4,this._viewer.model.createMesh(g)];case 1:return h=l.sent(),w=new d.MeshInstanceData(h),v=(this._config.fixedAvatarScale?d.MeshInstanceCreationFlags.SuppressCameraScale:d.MeshInstanceCreationFlags.None)|d.MeshInstanceCreationFlags.ExcludeBounding,w.setCreationFlags(v),[4,this._viewer.model.createMeshInstance(w,null,!0,!0)];case 2:return y=l.sent(),[2,y]}})})};f.prototype._create2dBox=function(b,c,f){return __awaiter(this,void 0,void 0,function(){var a,k,e,
l,g,n,m;return __generator(this,function(p){switch(p.label){case 0:return a=new d.MeshData,b&&(k=[-.5,-.5,f,-.5,.5,f,.5,.5,f,.5,-.5,f,-.5,-.5,f],a.addPolyline(k,void 0)),c&&(e=[.5,-.5,f,.5,.5,f,-.5,.5,f,-.5,.5,f,-.5,-.5,f,.5,-.5,f],l=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],a.addFaces(e,l),a.setBackfacesEnabled(!1)),[4,this._viewer.model.createMesh(a)];case 1:return g=p.sent(),n=new d.MeshInstanceData(g),n.setCreationFlags(d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotReset),
[4,this._viewer.model.createMeshInstance(n,null,!0,!0)];case 2:return m=p.sent(),[2,m]}})})};f._genericStoreyType="IFCBUILDINGSTOREY";f._ifcFloorTypes=new Set(["IFCSLAB"]);f._ifcSpaceTypes=new Set(["IFCSPACE"]);f._ifcFloorplanCreationTypes=new Set(["IFCWALL","IFCWALLSTANDARDCASE","IFCCURTAINWALL","IFCSLAB","IFCCOLUMN"]);f._backgroundZ=-1;f._avatarZ=1;f._borderZ=2;return f}();d.FloorplanManager=f})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){this._obscuredLineColor=d.Color.black();this._obscuredLineOpacity=.2;this._visibleLineColor=d.Color.black();this._visibleLineOpacity=1;this._backgroundColorTop=d.Color.white();this._backgroundColorBottom=d.Color.white()}a.prototype.getObscuredLineColor=function(){return this._obscuredLineColor.copy()};a.prototype.setObscuredLineColor=function(a){this._obscuredLineColor.assign(a)};a.prototype.getObscuredLineOpacity=function(){return this._obscuredLineOpacity};
a.prototype.getObscuredLineTransparency=function(){return this.getObscuredLineOpacity()};a.prototype.setObscuredLineOpacity=function(a){0<=a&&1>=a&&(this._obscuredLineOpacity=a)};a.prototype.setObscuredLineTransparency=function(a){this.setObscuredLineOpacity(a)};a.prototype.getVisibleLineColor=function(){return this._visibleLineColor.copy()};a.prototype.setVisibleLineColor=function(a){this._visibleLineColor.assign(a)};a.prototype.getVisibleLineOpacity=function(){return this._visibleLineOpacity};a.prototype.getVisibleLineTransparency=
function(){return this.getVisibleLineOpacity()};a.prototype.setVisibleLineOpacity=function(a){0<=a&&1>=a&&(this._visibleLineOpacity=a)};a.prototype.setVisibleLineTransparency=function(a){this.setVisibleLineOpacity(a)};a.prototype.getBackgroundColor=function(){var a=null!==this._backgroundColorTop?this._backgroundColorTop.copy():null,c=null!==this._backgroundColorBottom?this._backgroundColorBottom.copy():null;return new d.VerticalGradient(a,c)};a.prototype.setBackgroundColor=function(a,c){void 0===
a&&(a=null);void 0===c&&(c=null);this._backgroundColorTop=null!==a?a.copy():null;this._backgroundColorBottom=null!==c?c.copy():null};return a}();h.HiddenLineSettings=g})(d.Settings||(d.Settings={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.isMouseEventType=function(a){switch(a){case d.EventType.MouseDown:return!0;case d.EventType.MouseMove:return!0;case d.EventType.MouseUp:return!0;case d.EventType.Mousewheel:return!0;case d.EventType.TouchStart:return!1;case d.EventType.TouchMove:return!1;case d.EventType.TouchEnd:return!1;case d.EventType.KeyDown:return!1;case d.EventType.KeyUp:return!1;case d.EventType.ViewOrientationChange:return!1}};var g=function(){function a(){this._date=new Date;this._handled=!1}
a.prototype.getHandled=function(){return this._handled};a.prototype.setHandled=function(a){this._handled=a};a.prototype.getDate=function(){return this._date};return a}();h.InputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(a){function d(c,b,f){b=a.call(this)||this;b._keyCode=c;b._eventType=f;return b}__extends(d,a);d.prototype.getKeyCode=function(){return this._keyCode};d.prototype.getEventType=function(){return this._eventType};return d}(d.InputEvent);d.KeyInputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function e(c,b){this._callbackManager=c;this._operatorManager=b;this._contextEventChecker=new a(this._callbackManager)}e.prototype.injectMouseDownEvent=function(c,b,f,a,e){c=new d.Event.MouseInputEvent(c,b,f,a,e,d.MouseInputType.Down);b=d.EventType.MouseDown;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onMouseDownEvent(c)};e.prototype.injectMouseMoveEvent=function(c,b,f,a,e){c=new d.Event.MouseInputEvent(c,
b,f,a,e,d.MouseInputType.Move);b=d.EventType.MouseMove;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectMouseUpEvent=function(c,b,f,a,e){c=new d.Event.MouseInputEvent(c,b,f,a,e,d.MouseInputType.Up);b=d.EventType.MouseUp;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onMouseUpEvent(c)};e.prototype.injectMousewheelEvent=function(c,b,f,a,e){c=new d.Event.MouseWheelInputEvent(c,
b,f,a,e,d.MouseInputType.Wheel);b=d.EventType.Mousewheel;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectKeyDownEvent=function(c,b){c=new d.Event.KeyInputEvent(c,b,d.KeyInputType.Down);b=d.EventType.KeyDown;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectKeyUpEvent=function(c,b){c=new d.Event.KeyInputEvent(c,b,d.KeyInputType.Up);b=d.EventType.KeyUp;this._callbackManager.trigger("_inputInteraction",
c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectTouchStartEvent=function(c,b,f,a){c=new d.Event.TouchInputEvent(c,b,f,a,d.TouchInputType.Start);b=d.EventType.TouchStart;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onTouchStartEvent(c)};e.prototype.injectTouchMoveEvent=function(c,b,f,a){c=new d.Event.TouchInputEvent(c,b,f,a,d.TouchInputType.Start);b=d.EventType.TouchMove;this._callbackManager.trigger("_inputInteraction",
c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onTouchMoveEvent(c)};e.prototype.injectTouchEndEvent=function(c,b,f,a){c=new d.Event.TouchInputEvent(c,b,f,a,d.TouchInputType.End);b=d.EventType.TouchEnd;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onTouchEndEvent(c)};e.prototype.injectViewOrientationChangeEvent=function(){this._operatorManager._injectViewOrientationChangeEvent()};return e}();h.EventDispatcher=
g;var a=function(){function a(c){this._contextMenuMouseButton=d.Button.Right;this._contextMenuPositionStart=d.Point2.zero();this._touchTimer=new d.Util.Timer;this._activeTouchCount=0;this._initialPosition=d.Point2.zero();this._callbackManager=c}a.prototype.onMouseDownEvent=function(c){c.getHandled()||this._contextMenuPositionStart.assign(c.getPosition())};a.prototype.onMouseUpEvent=function(c){if(!c.getHandled()){var b=c.getPosition();c.getButton()===this._contextMenuMouseButton&&this._contextMenuPositionStart.equals(b)&&
this._callbackManager.trigger("contextMenu",b,c.getModifiers())}};a.prototype.onTouchStartEvent=function(c){var b=this,f=c.getPosition().copy();0===this._activeTouchCount&&(this._initialPosition=f);++this._activeTouchCount;c.getHandled()||this._touchTimer.set(600,function(){b._callbackManager.trigger("contextMenu",f,d.KeyModifiers.None)})};a.prototype.onTouchMoveEvent=function(c){if(!this._touchTimer.isIdle(0)){c=d.Point2.subtract(this._initialPosition,c.getPosition());c=Math.abs(c.squaredLength());
var b=.02*window.outerHeight;c>b*b&&this._touchTimer.clear()}};a.prototype.onTouchEndEvent=function(c){0<this._activeTouchCount&&--this._activeTouchCount;this._touchTimer.clear()};return a}()})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d){this.x=a;this.y=d}d.prototype.assign=function(a){this.x=a.x;this.y=a.y;return this};d.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};d.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};d.prototype.scale=function(a){this.x*=a;this.y*=a;return this};d.prototype.equals=function(a){return this.x===a.x&&this.y===a.y};d.prototype.set=function(a,d){this.x=a;this.y=d;return this};d.prototype.copy=function(){return new d(this.x,
this.y)};d.prototype.length=function(){return Math.sqrt(this.squaredLength())};d.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{x:this.x,y:this.y}};d.prototype.forJson=function(){return this.toJson()};d.fromJson=function(a){return new d(a.x,a.y)};d.subtract=function(a,e){return new d(a.x-e.x,a.y-e.y)};d.add=function(a,e){return new d(a.x+e.x,a.y+e.y)};d.scale=function(a,e){return new d(a.x*
e,a.y*e)};d.distance=function(a,e){return d.subtract(e,a).length()};d.zero=function(){return new d(0,0)};d.fromPoint3=function(a){return new d(a.x,a.y)};return d}();d.Point2=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){return function(){this.top=this.left=0}}(),a=function(){function a(c,b){this._isFirefox=this._isIE=!1;this._canvas=null;this._canvasEventFunctions=new Map;this._documentEventFunctions=new Map;this._pointerEventsEnabled=!0;this._captureInput=this._dragStarted=this._eventsBound=this._processInput=!1;this._elementOffset=new g;this._pointerUp=!1;this._buttons=d.Buttons.None;this._eventDispatcher=c;this._timeoutMonitor=b;this._document=document;c=navigator.userAgent.toLowerCase();
this._isIE=0<=c.indexOf("trident")||0<=c.indexOf("edge");this._isFirefox=-1<c.indexOf("firefox")}a.prototype._tryLockEventDispatcher=function(){return a._activeEventDispatcherLocked&&a._activeEventDispatcher!==this._eventDispatcher?!1:(this._calculateElementOffset(),a._activeEventDispatcher=this._eventDispatcher,a._activeOffset=this._elementOffset,a._activeEventDispatcherLocked=!0)};a.prototype._unlockEventDispatcher=function(){a._activeEventDispatcherLocked=!1};a.prototype.shutdown=function(){this.unbindEvents()};
a.prototype.setDocument=function(c){this._unbindDocumentEvents();this._document=c;this._initDocumentEvents()};a.prototype.setOptions=function(c){c.hasOwnProperty("usePointerEvents")&&this.setPointerEventsEnabled(!!c.usePointerEvents)};a.prototype.elementResize=function(){this._calculateElementOffset()};a.prototype.setPointerEventsEnabled=function(c){this._pointerEventsEnabled=c};a.prototype.getPointerEventsEnabled=function(){return this._pointerEventsEnabled};a.prototype._browserSupportsPointerEvents=
function(){return window.hasOwnProperty("PointerEvent")};a.prototype._usePointerEvents=function(){return this._browserSupportsPointerEvents()&&this._pointerEventsEnabled&&this._isIE};a.prototype._calculateElementOffset=function(){if(null!==this._canvas){var c=this._canvas.getBoundingClientRect();this._elementOffset.left=c.left;this._elementOffset.top=c.top}};a.prototype._initDocumentEvents=function(){var c=this;this._usePointerEvents()?(this._bindDocumentEvent("pointermove",function(b){c._processDocumentPointerMove(b)}),
this._bindDocumentEvent("pointerup",function(b){c._processDocumentPointerUp(b)})):(this._bindDocumentEvent("mousemove",function(b){c._processDocumentMouseMove(b)}),this._bindDocumentEvent("mouseup",function(b){c._processDocumentMouseUp(b)}))};a.prototype._initCanvasEvents=function(){var c=this;this._usePointerEvents()?(this._bindCanvasEvent("pointerdown",function(b){c._processPointerDown(b)}),this._bindCanvasEvent("pointermove",function(b){c._processPointerMove(b)}),this._bindCanvasEvent("pointerup",
function(b){c._processPointerUp(b)}),this._bindCanvasEvent("pointerenter",function(b){c._processPointerEnter(b)}),this._bindCanvasEvent("pointerleave",function(b){c._processPointerLeave(b)})):(this._bindCanvasEvent("mousedown",function(b){c._processMouseDown(b)}),this._bindCanvasEvent("mousemove",function(b){c._processMouseMove(b)}),this._bindCanvasEvent("mouseup",function(b){c._processMouseUp(b)}),this._bindCanvasEvent("mouseenter",function(b){c._processMouseEnter(b)}),this._bindCanvasEvent("mouseleave",
function(b){c._processMouseLeave(b)}),this._bindCanvasEvent("touchstart",function(b){c._processTouchStart(b)}),this._bindCanvasEvent("touchmove",function(b){c._processTouchMove(b)}),this._bindCanvasEvent("touchend",function(b){c._processTouchEnd(b)}),this._bindCanvasEvent("touchcancel",function(b){c._processTouchEnd(b)}));this._isFirefox?this._bindCanvasEvent("DOMMouseScroll",function(b){c._processMousewheel(b)}):this._bindCanvasEvent("mousewheel",function(b){c._processMousewheel(b)});this._bindCanvasEvent("keydown",
function(b){c._processKeyDownEvent(b)});this._bindCanvasEvent("keyup",function(b){c._processKeyUpEvent(b)})};a.prototype.bindEvents=function(c){this._eventsBound||(this._canvas=c,this.elementResize(),this._processInput=!0,this._initCanvasEvents(),this._initDocumentEvents(),this._eventsBound=!0)};a.prototype._bindDocumentEvent=function(c,b){if(null!==this._document){var f=this._documentEventFunctions.get(c);void 0!==f&&this._document.removeEventListener(c,f);this._documentEventFunctions.set(c,b);this._document.addEventListener(c,
b)}};a.prototype._bindCanvasEvent=function(c,b){if(null!==this._canvas){var f=this._canvasEventFunctions.get(c);void 0!==f&&this._canvas.removeEventListener(c,f);this._canvasEventFunctions.set(c,b);this._canvas.addEventListener(c,b)}};a.prototype._unbindDocumentEvents=function(){var c=this;this._documentEventFunctions.forEach(function(b,f){c._document.removeEventListener(f,b)});this._documentEventFunctions.clear()};a.prototype._unbindCanvasEvents=function(){var c=this;null!==this._canvas&&(this._canvasEventFunctions.forEach(function(b,
f){c._canvas.removeEventListener(f,b)}),this._canvasEventFunctions.clear());console.assert(0===this._canvasEventFunctions.size)};a.prototype.unbindEvents=function(){this._unbindCanvasEvents();this._unbindDocumentEvents();this._eventsBound=this._processInput=!1;a._activeEventDispatcher===this._eventDispatcher&&this._unlockEventDispatcher()};a.prototype._convertEventCoordsToTargetCoords=function(c,b,f){void 0===f&&(f=!0);f=f&&null!==a._activeOffset?a._activeOffset:this._elementOffset;return new d.Point2(c-
f.left,b-f.top)};a.prototype.focusInput=function(c){null!==this._canvas&&(c?this._canvas.focus():this._canvas.blur())};a.prototype._setButtons=function(c){c.buttons&&(this._buttons=c.buttons)};a.prototype._processMouseDown=function(c){if(this._tryLockEventDispatcher()){switch(c.button){case 0:this._buttons|=d.Buttons.Left;break;case 1:this._buttons|=d.Buttons.Middle;break;case 2:this._buttons|=d.Buttons.Right}c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.clientX,
c.clientY),f=this._getEventModifiers(c);a._activeEventDispatcher.injectMouseDownEvent(b.x,b.y,c.button,this._buttons,f);this._dragStarted=!0}}};a.prototype._processMouseMove=function(c,b){void 0===b&&(b=!1);c.preventDefault();this._timeoutMonitor.resetTimeout();(b||this._tryLockEventDispatcher())&&this._processInput&&(b=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),c=this._getEventModifiers(c),null!==a._activeEventDispatcher&&a._activeEventDispatcher.injectMouseMoveEvent(b.x,b.y,d.Button.None,
this._buttons,c))};a.prototype._processMouseUp=function(c,b){void 0===b&&(b=!1);switch(c.button){case 0:this._buttons&=~d.Buttons.Left;break;case 1:this._buttons&=~d.Buttons.Middle;break;case 2:this._buttons&=~d.Buttons.Right}c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._tryLockEventDispatcher()&&(c.stopPropagation(),this._processInput)){var f=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),k=this._getEventModifiers(c);a._activeEventDispatcher.injectMouseUpEvent(f.x,
f.y,c.button,this._buttons,k);this._buttons===d.Buttons.None&&(this._captureInput=this._dragStarted=!1,b&&this._unlockEventDispatcher())}};a.prototype._processMousewheel=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);this._eventDispatcher.injectMousewheelEvent(b.x,b.y,this._isFirefox?0<c.detail?-1:1:0<c.wheelDelta?1:-1,this._buttons,f)}};a.prototype._processDocumentMouseMove=
function(c){this._dragStarted&&this._captureInput&&this._processMouseMove(c,!0)};a.prototype._processDocumentMouseUp=function(c){this._dragStarted&&this._captureInput&&this._processMouseUp(c,!0)};a.prototype._processMouseLeave=function(c){this._dragStarted?this._captureInput=!0:this._unlockEventDispatcher()};a.prototype._processMouseEnter=function(c){this._tryLockEventDispatcher()&&this._dragStarted&&(this._captureInput=!1)};a.prototype._isFunctionKey=function(c){return 112<=c.which&&123>=c.which};
a.prototype._processKeyDownEvent=function(c){this._isFunctionKey(c)||c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._getEventModifiers(c);this._eventDispatcher.injectKeyDownEvent(c.which,b)}};a.prototype._processKeyUpEvent=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._getEventModifiers(c);this._eventDispatcher.injectKeyUpEvent(c.which,b)}};a.prototype._processTouchStart=function(c){c.preventDefault();
this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<c.changedTouches.length;b++){var f=c.changedTouches.item(b),a=this._convertEventCoordsToTargetCoords(f.clientX,f.clientY,!1);this._eventDispatcher.injectTouchStartEvent(f.identifier,a.x,a.y,this._buttons)}};a.prototype._processTouchMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<c.changedTouches.length;b++){var f=c.changedTouches.item(b),a=this._convertEventCoordsToTargetCoords(f.clientX,
f.clientY,!1);this._eventDispatcher.injectTouchMoveEvent(f.identifier,a.x,a.y,this._buttons)}};a.prototype._processTouchEnd=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<c.changedTouches.length;b++){var f=c.changedTouches.item(b),a=this._convertEventCoordsToTargetCoords(f.clientX,f.clientY,!1);this._eventDispatcher.injectTouchEndEvent(f.identifier,a.x,a.y,this._buttons)}};a.prototype._processPointerDown=function(c){if(this._tryLockEventDispatcher()&&
(this._setButtons(c),c.preventDefault(),this._timeoutMonitor.resetTimeout(),this._processInput)){var b=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);"mouse"===c.pointerType?a._activeEventDispatcher.injectMouseDownEvent(b.x,b.y,c.button,this._buttons,f):"touch"===c.pointerType&&a._activeEventDispatcher.injectTouchStartEvent(c.pointerId,b.x,b.y,this._buttons);this._pointerUp=!1}};a.prototype._processPointerMove=function(c,b){void 0===b&&(b=!1);c.preventDefault();
this._timeoutMonitor.resetTimeout();if(b||this._tryLockEventDispatcher())if(this._setButtons(c),this._processInput){b=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY);var f=this._getEventModifiers(c);null!==a._activeEventDispatcher&&("mouse"===c.pointerType?a._activeEventDispatcher.injectMouseMoveEvent(b.x,b.y,c.button,this._buttons,f):"touch"===c.pointerType&&a._activeEventDispatcher.injectTouchMoveEvent(c.pointerId,b.x,b.y,this._buttons))}};a.prototype._processPointerUp=function(c,b){void 0===
b&&(b=!1);this._setButtons(c);c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._tryLockEventDispatcher()&&this._processInput){var f=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),k=this._getEventModifiers(c);"mouse"!==c.pointerType||this._pointerUp?"touch"===c.pointerType&&this._eventDispatcher.injectTouchEndEvent(c.pointerId,f.x,f.y,this._buttons):a._activeEventDispatcher.injectMouseUpEvent(f.x,f.y,c.button,this._buttons,k);this._buttons===d.Buttons.None&&(this._captureInput=
this._dragStarted=!1,this._pointerUp=!0,b&&this._unlockEventDispatcher())}};a.prototype._processPointerEnter=function(c){this._tryLockEventDispatcher()&&!this._pointerUp&&(this._captureInput=!1)};a.prototype._processPointerLeave=function(c){this._pointerUp?this._unlockEventDispatcher():this._captureInput=!0};a.prototype._processDocumentPointerMove=function(c){!this._pointerUp&&this._captureInput&&this._processPointerMove(c,!0)};a.prototype._processDocumentPointerUp=function(c){!this._pointerUp&&this._captureInput&&
this._processPointerUp(c,!0)};a.prototype._getEventModifiers=function(c){var b=d.KeyModifiers.None;c.altKey&&(b|=d.KeyModifiers.Alt);c.ctrlKey&&(b|=d.KeyModifiers.Control);c.shiftKey&&(b|=d.KeyModifiers.Shift);c.metaKey&&(b|=d.KeyModifiers.Command);return b};a._activeEventDispatcher=null;a._activeEventDispatcherLocked=!1;a._activeOffset=null;return a}();h.InputMonitor=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.Directional=0]="Directional"})(d.LightType||(d.LightType={}));(function(d){d[d.World=0]="World";d[d.Camera=1]="Camera"})(d.LightSpace||(d.LightSpace={}));var h=function(){return function(d,a,e,c){this.type=d;this.space=a;this.position=e;this.color=c}}();d.Light=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(){}d.prototype.exportMarkup=function(){return[]};d.prototype.loadData=function(a){a;return Promise.resolve([])};return d}();d.MarkupTypeManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(g){function a(a,c){var b=g.call(this)||this;b._markupArray=[];b._viewer=a;b._callbackManager=c;b._callbackManager.bind({modelSwitched:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.removeAllLines()];case 1:return b.sent(),[2]}})})}});return b}__extends(a,g);a.prototype.addLine=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._markupArray.push(a),
[4,a.updateLine()];case 1:return c.sent(),this._callbackManager.trigger("lineCreated",a),[2]}})})};a.prototype.removeLine=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:c=0,b.label=1;case 1:return c<this._markupArray.length?this._markupArray[c].getId()!==a.getId()?[3,3]:[4,a.removeLine()]:[3,4];case 2:b.sent(),this._markupArray.splice(c,1),this._callbackManager.trigger("lineDeleted",a),b.label=3;case 3:return c++,[3,1];case 4:return[2]}})})};
a.prototype.removeAllLines=function(){for(var a=this,c=[],b=function(b){var d=f._markupArray[b];c.push(d.removeLine().then(function(){a._callbackManager.trigger("lineDeleted",d)}));f._markupArray.splice(b,1)},f=this,k=this._markupArray.length-1;0<=k;k--)b(k);return d.Util.waitForAll(c)};a.prototype.getAllLines=function(){return this._markupArray.slice(0)};a.prototype.removeLastLine=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return 0<
this._markupArray.length?[4,this.removeLine(this._markupArray[this._markupArray.length-1])]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}})})};a.prototype.getLineByNodeId=function(a){for(var c=0,b=this._markupArray;c<b.length;c++){var f=b[c],d=f.getNodeId();if(null!==d&&d===a)return f}return null};a.prototype.exportMarkup=function(){for(var a=[],c=0,b=this._markupArray;c<b.length;c++)a.push(b[c].toJson());return a};a.prototype._handleLoadLine=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return a instanceof d.Markup.Line.LineMarkup?[4,this.addLine(a)]:[3,2];case 1:return c.sent(),this._callbackManager.trigger("lineLoaded",a),[2,!0];case 2:return[2,!1]}})})};a.prototype.loadData=function(a){for(var c=this,b=[],f=0;f<a.length;f++){var k=a[f];if(k.hasOwnProperty("className")){var e=d.Internal.classFromString(k.className);e&&(k=e.fromJson(k,this._viewer),k instanceof Promise?b.push(k.then(function(b){return c._handleLoadLine(b)})):b.push(this._handleLoadLine(k)))}}return Promise.all(b)};
return a}(d.MarkupTypeManager);d.LineManager=h})(Communicator||(Communicator={}));var __decorate=this&&this.__decorate||function(d,h,g,a){var e=arguments.length,c=3>e?h:null===a?a=Object.getOwnPropertyDescriptor(h,g):a,b;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)c=Reflect.decorate(d,h,g,a);else for(var f=d.length-1;0<=f;f--)if(b=d[f])c=(3>e?b(c):3<e?b(h,g,c):b(h,g))||c;return 3<e&&c&&Object.defineProperty(h,g,c),c};
(function(d){var h=function(){function g(a,e,c,b,f,k,l){this._markupTypeMap=new Map;this._domElements=a;this._callbackManager=b;this._viewer=l;this._sheetManager=f;this._sheetManager.setMarkupManager(this);this._noteTextManager=k;this._renderer=new d.Internal.SVG.SVGMarkupRenderer;this._itemManager=new d.Internal.MarkupItemManager(this._callbackManager,this._domElements,this._renderer);this._viewManager=new d.Internal.MarkupViewManager(this._viewer,this._itemManager,this._callbackManager,l.explodeManager,
l.cuttingManager,this._sheetManager);this._measurementManager=e;this._lineManager=c}g.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","MarkupManager",d);return b.apply(this,c)};return c};g.prototype.registerMarkupTypeManager=function(a,d){this._markupTypeMap.set(a,d)};g.prototype.createMarkupView=function(a,d,c,b,f){void 0===d&&(d=!0);void 0===c&&(c=null);void 0===b&&(b=null);void 0===
f&&(f=null);var k=this._viewer.sheetManager.getActiveSheetId();return this._viewManager.createView(a,d,k,c,b,f).getUniqueId()};g.prototype.getMarkupView=function(a){return this._viewManager.getView(a)};g.prototype.getMarkupViewKeys=function(){return this._viewManager.getViewKeys()};g.prototype.activateMarkupViewWithPromise=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._viewManager.activateView(a,
e)]})})};g.prototype.activateMarkupView=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return this._viewManager.deprecatedActivateView(a,e)};g.prototype.getActiveMarkupView=function(){return this._itemManager.getActiveView()};g.prototype.deleteMarkupView=function(a){return this._viewManager.deleteView(a)};g.prototype.registerMarkup=function(a){a=this._itemManager.registerMarkupItem(a);this.updateLater();return a};g.prototype.unregisterMarkup=function(a){this._itemManager.unregisterMarkupItem(a);
this.updateLater()};g.prototype.addMarkupElement=function(a){var e=d.UUID.create();a.id=e;this._domElements.getRedlineElement().appendChild(a);return e};g.prototype.removeMarkupElement=function(a){for(var d=this._domElements.getRedlineElement(),c=0;c<d.children.length;c++){var b=d.children.item(c);null!==b&&b.id===a&&d.removeChild(b)}};g.prototype.refreshMarkup=function(){this.updateLater()};g.prototype.updateLater=function(){this._itemManager.updateLater()};g.prototype.pickMarkupItem=function(a){return this._itemManager.pick(a)};
g.prototype.getPickTolerance=function(){return this._itemManager.getPickTolerance()};g.prototype.setPickTolerance=function(a){return this._itemManager.setPickTolerance(a)};g.prototype.selectMarkup=function(a){this._itemManager.select(a)};g.prototype.getSelectedMarkup=function(){return this._itemManager.getSelected()};g.prototype.exportMarkup=function(){var a={views:this._viewManager.exportMarkup(),notes:this._noteTextManager.exportMarkup(),measurement:this._measurementManager.exportMarkup(),lines:this._lineManager.exportMarkup()};
this._markupTypeMap.forEach(function(d,c){a[c]=d.exportMarkup()});return a};g.prototype.loadMarkupData=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){"string"===typeof a&&(a=JSON.parse(a));return[2,this._loadMarkupData(a)]})})};g.prototype._loadMarkupData=function(a){return __awaiter(this,void 0,void 0,function(){var e,c;return __generator(this,function(b){e=[];a.hasOwnProperty("views")&&(c=this._viewManager.loadData(a.views).then(d.Internal.all),e.push(c));
a.hasOwnProperty("notes")&&(c=this._noteTextManager.loadData(a.notes).then(d.Internal.all),e.push(c));a.hasOwnProperty("measurement")&&(c=this._measurementManager.loadData(a.measurement).then(d.Internal.all),e.push(c));a.hasOwnProperty("lines")&&(c=this._lineManager.loadData(a.lines).then(d.Internal.all),e.push(c));this._markupTypeMap.forEach(function(b,c){a.hasOwnProperty(c)&&(b=b.loadData(a[c]).then(d.Internal.all),e.push(b))});return[2,Promise.all(e).then(d.Internal.all)]})})};g.prototype.getRenderer=
function(){return this._renderer};g.prototype._shutdown=function(){this._itemManager.shutdown();this._renderer._clear()};g.prototype._update=function(){this._itemManager.update()};g.prototype._setActiveMarkupView=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._itemManager.setActiveView(a)]})})};g.prototype._getItemManager=function(){return this._itemManager};__decorate([g.deprecated],g.prototype,"activateMarkupView",null);return g}();d.MarkupManager=
h})(Communicator||(Communicator={}));
(function(d){var h=function(g){function a(a,c){var b=g.call(this)||this;b._markupArray=[];b._color=new d.Color(0,0,0);b._edgeColor=new d.Color(0,0,0);b._viewer=a;b._callbackManager=c;b._callbackManager.bind({modelSwitched:function(){b.removeAllMeasurements()}});return b}__extends(a,g);a.prototype.addMeasurement=function(a){this._markupArray.push(a);var c=this._viewer.markupManager.registerMarkup(a);a._setId(c);return c};a.prototype.finalizeMeasurement=function(a){this._callbackManager.trigger("measurementCreated",a)};
a.prototype.removeMeasurement=function(a){for(var c=0;c<this._markupArray.length;c++)if(this._markupArray[c]._getId()===a._getId()){this._markupArray.splice(c,1);this._viewer.markupManager.unregisterMarkup(a._getId());this._callbackManager.trigger("measurementDeleted",a);break}};a.prototype.removeAllMeasurements=function(){for(var a=this._markupArray.length-1;0<=a;a--){var c=this._markupArray[a];this._viewer.markupManager.unregisterMarkup(c._getId());this._markupArray.splice(a,1);this._callbackManager.trigger("measurementDeleted",
c)}};a.prototype.getAllMeasurements=function(){return this._markupArray.slice(0)};a.prototype.removeLastMeasurement=function(){0<this._markupArray.length&&this.removeMeasurement(this._markupArray[this._markupArray.length-1])};a.prototype.setMeasurementColor=function(a){this._color.assign(a)};a.prototype.getMeasurementColor=function(){return this._color.copy()};a.prototype.setMeasurementEdgeColor=function(a){this._edgeColor.assign(a)};a.prototype.getMeasurementEdgeColor=function(){return this._edgeColor.copy()};
a.prototype.exportMarkup=function(){for(var a=[],c=0,b=this._markupArray;c<b.length;c++){var f=b[c];null!==f&&f.isMarkupValid()&&a.push(f.toJson())}return a};a.prototype._handleLoadMeasurement=function(a){return a instanceof d.Markup.Measure.MeasureMarkup?(this.addMeasurement(a),this._callbackManager.trigger("measurementLoaded",a),!0):!1};a.prototype.loadData=function(a){for(var c=this,b=[],f=0;f<a.length;f++){var k=a[f];if(k.hasOwnProperty("className")){var e=d.Internal.classFromString(k.className);
e&&(k=e.fromJson(k,this._viewer),k instanceof Promise?b.push(k.then(function(b){return c._handleLoadMeasurement(b)})):b.push(Promise.resolve(this._handleLoadMeasurement(k))))}}return Promise.all(b)};return a}(d.MarkupTypeManager);d.MeasureManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this._faceMeshData=[];this._pointMeshData=[];this._polylineMeshData=[];this._faceWinding=d.FaceWinding.CounterClockwise;this._isManifold=this._backfacesEnabled=!1}g.prototype.addFaces=function(a,e,c,b,f){void 0===f&&(f=0);this._faceMeshData.push(new d.Internal.FaceMeshData(a,e,c,b,f))};g.prototype.addPoints=function(a,e,c){void 0===c&&(c=0);this._pointMeshData.push(new d.Internal.PointMeshData(a,e,c))};g.prototype.addPolyline=function(a,e,c){void 0===c&&
(c=0);this._polylineMeshData.push(new d.Internal.PolylineMeshData(a,e,c))};g.prototype.clear=function(){this._faceMeshData.length=0;this._pointMeshData.length=0;this._polylineMeshData.length=0};g.prototype.setFaceWinding=function(a){this._faceWinding=a};g.prototype.getFaceWinding=function(){return this._faceWinding};g.prototype.setBackfacesEnabled=function(a){this._backfacesEnabled=a};g.prototype.getBackfacesEnabled=function(){return this._backfacesEnabled};g.prototype.setManifold=function(a){this._isManifold=
a};g.prototype.isManifold=function(){return this._isManifold};g.prototype._getFaceData=function(){return this._faceMeshData};g.prototype._getPointData=function(){return this._pointMeshData};g.prototype._getPolylineData=function(){return this._polylineMeshData};return g}();d.MeshData=h;h=function(){function g(a,e,c,b,f,k,l){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=
d.MeshInstanceCreationFlags.None;this._overlayIndex=0;a&&(this._meshId=a.slice());e&&(this._matrix=e.copy());c&&(this._instanceName=c);b&&(this._faceColor=b.copy());f&&(this._lineColor=f.copy());k&&(this._pointColor=k.copy());l&&(this._creationFlags=l)}g.prototype.copy=function(){var a=new g(this.getMeshId(),this.getMatrix(),this.getInstanceName(),this.getFaceColor(),this.getLineColor(),this.getPointColor(),this.getCreationFlags());a.setPointOpacity(this.getOpacity());a.setLineOpacity(this.getLineOpacity());
a.setOpacity(this.getOpacity());a.setOverlayIndex(this.getOverlayIndex());return a};g.prototype.clear=function(){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=d.MeshInstanceCreationFlags.None;this._overlayIndex=0};g.prototype.getMeshId=function(){return null!==this._meshId?this._meshId.slice():null};g.prototype.getMeshKey=function(){return this.getMeshId()};g.prototype.setMeshId=
function(a){this._meshId=a.slice()};g.prototype.setMeshKey=function(a){this.setMeshId(a)};g.prototype.getMatrix=function(){return null!==this._matrix?this._matrix.copy():null};g.prototype.getCreationFlags=function(){return this._creationFlags};g.prototype.setCreationFlags=function(a){this._creationFlags=a};g.prototype.setMatrix=function(a){this._matrix=a.copy()};g.prototype.getInstanceName=function(){return this._instanceName};g.prototype.setInstanceName=function(a){this._instanceName=a};g.prototype.setFaceColor=
function(a){this._faceColor=a.copy()};g.prototype.getFaceColor=function(){return null!==this._faceColor?this._faceColor.copy():null};g.prototype.setLineColor=function(a){this._lineColor=a.copy()};g.prototype.getLineColor=function(){return null!==this._lineColor?this._lineColor.copy():null};g.prototype.setPointColor=function(a){this._pointColor=a.copy()};g.prototype.getPointColor=function(){return null!==this._pointColor?this._pointColor.copy():null};g.prototype.setPointOpacity=function(a){this._pointOpacity=
a};g.prototype.getPointOpacity=function(){return this._pointOpacity};g.prototype.setLineOpacity=function(a){this._lineOpacity=a};g.prototype.getLineOpacity=function(){return this._lineOpacity};g.prototype.setOpacity=function(a){this._faceOpacity=a};g.prototype.setTransparency=function(a){this._faceOpacity=a};g.prototype.getOpacity=function(){return this._faceOpacity};g.prototype.getTransparency=function(){return this._faceOpacity};g.prototype.setOverlayIndex=function(a){this._overlayIndex=a};g.prototype.getOverlayIndex=
function(){return this._overlayIndex};return g}();d.MeshInstanceData=h})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){return function(a,d,c,b,f){void 0===f&&(f=0);this.vertexData=a;this.normalData=d;this.rgba32data=c;this.uvData=b;this.bits=f}}();d.FaceMeshData=g;g=function(){return function(a,d,c){void 0===c&&(c=0);this.vertexData=a;this.rgba32data=d;this.bits=c}}();d.PolylineMeshData=g;g=function(){return function(a,d,c){void 0===c&&(c=0);this.vertexData=a;this.rgba32data=d;this.bits=c}}();d.PointMeshData=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator=
{}));(function(d){(function(d){(function(d){function a(a){console.assert(a!==d.invalidNodeId);return a>d.invalidNodeId}d.invalidNodeId=-1;d.isAuthoredId=a;d.getAuthoredId=function(d){console.assert(a(d));return d};d.getRuntimeId=function(e,c){return a(e)?d.towardInclusionContext(c).toRuntimeId(e):e}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){d.DefaultTransitionDuration=400;d.EmptyModelName="_empty";d.InvalidNodeId=d.Internal.Tree.invalidNodeId;var h=function(){function g(a,e){var c=this;this._pmiColor=d.Color.black();this._pmiColorOverride=!1;this._viewAxes=new d.ViewAxes;this._viewAxesSet=!1;this._firstModelRootId=d.InvalidNodeId;this._engine=a;this._callbackManager=e;this._callbackManager.bind({_firstModelLoaded:function(b){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(c){this._firstModelRootId=
b[0];return[2]})})},_resetAssemblyTreeBegin:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){this._viewAxes=new d.ViewAxes;this._viewAxesSet=!1;return[2]})})}})}g.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","Model",d);return b.apply(this,c)};return c};g.prototype._setModelStructure=function(a){console.assert(void 0===this._modelStructure);this._modelStructure=
a};g.prototype.getClientDimensions=function(){return this._engine.getClientDimensions()};g.prototype.setViewAxes=function(a,e){if(a.isAxis()&&e.isAxis()&&!a.equals(e))this._viewAxes.frontVector=a,this._viewAxes.upVector=e,this._callbackManager.trigger("viewAxes",a,e),this._viewAxesSet=!0;else throw new d.CommunicatorError("The upVector and frontVector must be unique, cardinal axes.");};g.prototype.viewAxesHaveBeenSet=function(){return this._viewAxesSet};g.prototype.getViewAxes=function(){return this._viewAxes};
g.prototype.getModelBounding=function(a,e,c){void 0===c&&(c=!1);return __awaiter(this,void 0,void 0,function(){var b,f,k,l;return __generator(this,function(g){switch(g.label){case 0:b=new d.Box,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._engine.getModelBounding(a,e,c)];case 2:return b=g.sent(),[3,4];case 3:return f=g.sent(),k=!1,SC.isError(f)&&(l=SC.getStateFailure(f),1===l&&(k=!0)),console.assert(k),[3,4];case 4:return[2,b]}})})};g.prototype.getLooseBounding=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(a){return[2,this._engine.getLooseBounding()]})})};g.prototype._allowNodeDeletion=function(a){return this._modelStructure.allowNodeDeletion(a)};g.prototype._preventNodeDeletion=function(a){return this._modelStructure.preventNodeDeletion(a)};g.prototype._preventMeshDeletion=function(a){console.assert(0===a[0]);return this._modelStructure.preventMeshDeletion(a[1])};g.prototype._getNodeFromInstanceInc=function(a,d,c,b){return this._modelStructure.getNodeFromInstanceInc(a,
d,c,b)};g.prototype.getNodesBounding=function(a,d){var c=7,b=!1,f=!1;void 0!==d&&(!1===d.bodyInstance&&(c&=-2),!1===d.pmiBody&&(c&=-3),!1===d.viewFrame&&(c&=-5),d.ignoreInvisible&&(b=!0),d.tightBounding&&(f=!0));return this._modelStructure.getBounding(a,c,b,f)};g.prototype.getNodeRealBounding=function(a){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){e=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(0===e.length)throw new d.CommunicatorError("Cannot get bounding of node without geometry.");
return[2,this._engine.getDrawnPartsBounding(e)]})})};g.prototype.setNodesVisibilities=function(a,e){void 0===e&&(e=null);a=d.Internal.fromIntegerMap(a);return this._modelStructure.setVisibilitiesByMap(a,null!==e?e:void 0)};g.prototype.setNodesVisibility=function(a,d,c){void 0===c&&(c=null);return this._modelStructure.setVisibilitiesByValue(a,d,c)};g.prototype.setBodyNodesVisibility=function(a,e){var c=this._modelStructure.lookupAnyTreeNode(a);if(null===c)throw new d.InvalidNodeIdError(a);var b="boolean"===
typeof e?function(b){return e}:e;return this._modelStructure.setBodyNodesVisibility(c,function(c){return b(c.getRuntimeId())})};g.prototype.resetNodesVisibility=function(){return this.isDrawing()?this._callbackManager.promiseTrigger("_resetDrawing",null):this._modelStructure.resetAllVisibilities()};g.prototype.getVisibilityState=function(a){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){e=this._modelStructure.lookupAnyTreeNode(a);if(null===e)throw new d.InvalidNodeIdError(a);
return[2,d.Internal.Tree.getVisibilityState(e)]})})};g.prototype.resetNodesTransform=function(){return this._modelStructure.resetAllTransforms()};g.prototype.reset=function(){this.resetModelOpacity();return this._modelStructure.reset()};g.prototype.clear=function(){return this._modelStructure.clear()};g.prototype.setNodesFaceColor=function(a,d){this._setNodesFaceColor(a,d);return Promise.resolve()};g.prototype.setNodesAmbientColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,
7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartAmbientColor(a,d.ElementType.Faces,e)};g.prototype.setNodesAmbientMix=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartAmbientMix(a,d.ElementType.Faces,e)};g.prototype.setNodesFaceEmissiveColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartEmissiveColor(a,
d.ElementType.Faces,e)};g.prototype.unsetNodesFaceEmissiveColor=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.unsetPartEmissiveColor(a,d.ElementType.Faces)};g.prototype.setNodesFaceSpecularColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartSpecularColor(a,d.ElementType.Faces,e)};g.prototype.unsetNodesFaceSpecularColor=
function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.unsetPartSpecularColor(a,d.ElementType.Faces)};g.prototype.setNodesFaceSpecularIntensity=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartSpecularIntensity(a,d.ElementType.Faces,e)};g.prototype.unsetNodesFaceSpecularIntensity=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,
7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.unsetPartSpecularIntensity(a,d.ElementType.Faces)};g.prototype._setNodesFaceColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartColor(a,d.ElementType.Faces,e)};g.prototype._unsetNodesColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.unsetPartColor(a,e)};
g.prototype.unsetNodesFaceColor=function(a){this._unsetNodesColor(a,d.ElementType.Faces);return Promise.resolve()};g.prototype.setNodesLineColor=function(a,d){this._setNodesLineColor(a,d);return Promise.resolve()};g.prototype._setNodesLineColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartColor(a,d.ElementType.Lines,e)};g.prototype.unsetNodesLineColor=function(a){this._unsetNodesColor(a,d.ElementType.Lines);
return Promise.resolve()};g.prototype.setNodesHighlighted=function(a,e){if(0===a.length)return Promise.resolve();a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<a.length&&this._engine.highlightParts(a,e);return Promise.resolve()};g.prototype.getNodesHighlighted=function(a){a=this._getInstanceIncsFromLeafNodes(a);return 0<a.length?this._engine.getPartHighlighted(a):Promise.resolve([])};g.prototype.setNodesColors=function(a,e,c){var b=this;
void 0===e&&(e=!1);void 0===c&&(c=!1);var f=new Set,k=new Map,l=function(c,a){c=b._modelStructure.lookupAnyTreeNode(c);if(null!==c&&(c=d.Internal.Tree.gatherInstanceIncsSync(c,7,!1,f,d.Internal.Tree.WalkRestriction.None),0<c.length)){a=(a.r<<16)+(a.g<<8)+a.b;var e=k.get(a);e?k.set(a,e.concat(c)):k.set(a,c)}};if(a instanceof Map)a.forEach(function(b,c){l(c,b)});else for(var g=0,m=Object.keys(a);g<m.length;g++){var p=parseInt(m[g],10);l(p,a[p])}k.forEach(function(f,a){a=new d.Color(a>>16,(a&65280)>>
8,a&255);b._engine.setPartColor(f,d.ElementType.Faces,a);e&&b._engine.setPartColor(f,d.ElementType.Lines,a);c&&b._engine.setPartColor(f,d.ElementType.Points,a)});return Promise.resolve()};g.prototype.getPmiTopologyReferences=function(a){var e=[],c=function(b,c,f){var a=new d.RefOnTopoItem;a.bodyId=b;a.subElementType=c;a.subElementIndex=f;return a};a=this._modelStructure.getPmiTopologyReferences(a);if(null!==a)for(var b=0;b<a.length;b++){for(var f=a[b],k=f.body.getRuntimeId(),l=0,g=f.faceIds;l<g.length;l++)e.push(c(k,
d.PmiTopoRef.Face,g[l]));l=0;for(f=f.edgeIds;l<f.length;l++)e.push(c(k,d.PmiTopoRef.Edge,f[l]))}return 0===e.length?null:e};g.prototype.getPmis=function(){return this._modelStructure.getPmis()};g.prototype.getPMIs=function(){return this.getPmis()};g.prototype.getPmiType=function(a){return this._modelStructure.getPmiType(a)};g.prototype.getPMIType=function(a){return this.getPmiType(a)};g.prototype.getPmiSubtype=function(a){return this._modelStructure.getPmiSubType(a)};g.prototype.getPMISubtype=function(a){return this.getPmiSubtype(a)};
g.prototype.setPmiColor=function(a){this._pmiColor.assign(a)};g.prototype.setPMIColor=function(a){this.setPmiColor(a)};g.prototype.getPmiColor=function(){return this._pmiColor.copy()};g.prototype.getPMIColor=function(){return this.getPmiColor()};g.prototype.setPmiColorOverride=function(a,d){(this._pmiColorOverride=a)?this._modelStructure.setPmiColor(this._pmiColor,d):this._modelStructure.resetPmiColor(d);return Promise.resolve()};g.prototype.setPMIColorOverride=function(a){return this.setPmiColorOverride(a)};
g.prototype.getPmiColorOverride=function(){return this._pmiColorOverride};g.prototype.getPMIColorOverride=function(){return this.getPmiColorOverride()};g.prototype.computeMinimumBodyBodyDistance=function(a,e){var c=this._modelStructure.lookupAnyBody(a);if(null===c)throw new d.InvalidNodeTypeError(a,1);a=this._modelStructure.lookupAnyBody(e);if(null===a)throw new d.InvalidNodeTypeError(e,1);e=c.getInstanceInc();c=a.getInstanceInc();return this._engine.computeMinimumBodyBodyDistance(e,c)};g.prototype.computeMinimumFaceFaceDistance=
function(a,e,c,b){var f=this._modelStructure.lookupAnyBody(a);if(null===f)throw new d.InvalidNodeTypeError(a,1);a=this._modelStructure.lookupAnyBody(c);if(null===a)throw new d.InvalidNodeTypeError(c,1);c=f.getInstanceInc();f=a.getInstanceInc();return this._engine.computeMininimumFaceFaceDistance([c[0],c[1]],e,[f[0],f[1]],b)};g.prototype.computeMinimumFaceRayDistance=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();return this._engine.computeMinimumFaceRayDistance(a,
e,c)};g.prototype.computeMinimumFaceLineDistance=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();return this._engine.computeMinimumFaceLineDistance(a,e,c)};g.prototype.setNodeFaceColor=function(a,d,c){this._setNodeFaceColor(a,d,c);return Promise.resolve()};g.prototype._setNodeFaceColor=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);2===a.length&&this._engine.setElementColor(a,
d.ElementType.Faces,e,1,c)};g.prototype.setNodeFaceVisibility=function(a,e,c){this._setNodeElementVisibility(a,e,c,d.ElementType.Faces)};g.prototype.clearNodeFaceVisibility=function(a){this._clearNodeElementVisibility(a,d.ElementType.Faces)};g.prototype._setNodeElementVisibility=function(a,e,c,b){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);2===a.length&&this._engine.setElementVisibility(a,b,e,1,c)};g.prototype._clearNodeElementVisibility=function(a,
e){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);2===a.length&&this._engine.clearElementVisibility(a,e)};g.prototype._unsetElementColor=function(a,d,c){0>c||(a=this._getInstanceIncFromSingleLeafNode(a),this._engine.unsetElementColor(a,d,c,1))};g.prototype.unsetNodeFaceColor=function(a,e){this._unsetElementColor(a,d.ElementType.Faces,e);return Promise.resolve()};g.prototype.setNodeFaceHighlighted=function(a,d,c){this._setNodeFaceHighlighted(a,d,c);
return Promise.resolve()};g.prototype._setNodeFaceHighlighted=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<a.length&&this._engine.highlightElements(a,d.ElementType.Faces,e,1,c)};g.prototype._getElementHighlighted=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,f;return __generator(this,function(k){switch(k.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getElementHighlighted(b,
d,c)];case 1:return f=k.sent()[0],[2,f]}})})};g.prototype.getNodeFaceHighlighted=function(a,e){return this._getElementHighlighted(a,d.ElementType.Faces,e)};g.prototype.getNodePointColor=function(a,e){return this._getNodeElementColor(a,d.ElementType.Points,e)};g.prototype.getNodeEffectivePointColor=function(a,e){return this._getNodeEffectiveElementColor(a,d.ElementType.Points,e)};g.prototype.setNodePointColor=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,
1);a=b.getInstanceInc();this._engine.setElementColor(a,d.ElementType.Points,e,1,c)};g.prototype.unsetNodePointColor=function(a,e){this._unsetElementColor(a,d.ElementType.Points,e)};g.prototype.getNodesPointColor=function(a){return this._getNodesColor(a,d.ElementType.Points)};g.prototype.getNodesEffectivePointColor=function(a){return this._getNodesEffectiveColor(a,d.ElementType.Points)};g.prototype.setNodesPointColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);
0<a.length&&this._engine.setPartColor(a,d.ElementType.Points,e)};g.prototype.unsetNodesPointColor=function(a){this._unsetNodesColor(a,d.ElementType.Points)};g.prototype.setNodeLineColor=function(a,d,c){this._setNodeLineColor(a,d,c);return Promise.resolve()};g.prototype._setNodeLineColor=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();this._engine.setElementColor(a,d.ElementType.Lines,e,1,c)};g.prototype.unsetNodeLineColor=
function(a,e){this._unsetElementColor(a,d.ElementType.Lines,e);return Promise.resolve()};g.prototype.setNodeLineVisibility=function(a,e,c){this._setNodeElementVisibility(a,e,c,d.ElementType.Lines)};g.prototype.clearNodeLineVisibility=function(a){this._clearNodeElementVisibility(a,d.ElementType.Lines)};g.prototype.setNodeLineHighlighted=function(a,d,c){this._setNodeLineHighlighted(a,d,c);return Promise.resolve()};g.prototype._setNodeLineHighlighted=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],
7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<a.length&&this._engine.highlightElements(a,d.ElementType.Lines,e,1,c)};g.prototype.getNodeLineHighlighted=function(a,e){return this._getElementHighlighted(a,d.ElementType.Lines,e)};g.prototype.setNodePointVisibility=function(a,e,c){this._setNodeElementVisibility(a,e,c,d.ElementType.Points)};g.prototype.clearNodePointVisibility=function(a){this._clearNodeElementVisibility(a,d.ElementType.Points)};g.prototype.setNodePointHighlighted=function(a,d,
c){this._setNodePointHighlighted(a,d,c);return Promise.resolve()};g.prototype._setNodePointHighlighted=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();this._engine.highlightElements(a,d.ElementType.Points,e,1,c)};g.prototype.getNodePointHighlighted=function(a,e){return this._getElementHighlighted(a,d.ElementType.Points,e)};g.prototype.resetNodesColor=function(){this._engine.resetColors();return Promise.resolve()};g.prototype.setNodesOpacity=
function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartOpacity(a,e)};g.prototype.setNodesTransparency=function(a,d){this.setNodesOpacity(a,d);return Promise.resolve()};g.prototype.getNodesHaveTransparency=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);return 0<a.length?this._engine.getPartHasTransparency(a):Promise.resolve([])};g.prototype.setNodesOpacities=
function(a){var e=this;a=d.Internal.fromIntegerMap(a);var c=new Set;a.forEach(function(b,f){f=e._modelStructure.lookupAnyTreeNode(f);null!==f&&(f=d.Internal.Tree.gatherInstanceIncsSync(f,1,!1,c,d.Internal.Tree.WalkRestriction.None),0<f.length&&e._engine.setPartOpacity(f,b))})};g.prototype.setNodesTransparencies=function(a){this.setNodesOpacities(a);return Promise.resolve()};g.prototype.resetModelOpacity=function(){this._engine.resetOpacity();this._callbackManager.trigger("_resetOpacity")};g.prototype.resetModelTransparency=
function(){this.resetModelOpacity();return Promise.resolve()};g.prototype.resetModelHighlight=function(){this._engine.clearHighlight();return Promise.resolve()};g.prototype.resetNodesOpacity=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.unsetPartOpacity(a)};g.prototype.resetNodesTransparency=function(a){this.resetNodesOpacity(a);return Promise.resolve()};g.prototype._getNodesColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,
7,d.Internal.Tree.WalkRestriction.None);return 0<a.length?this._engine.getPartColor(a,e):Promise.resolve([])};g.prototype._getNodesEffectiveColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);return 0<a.length?this._engine.getEffectivePartColor(a,e):Promise.resolve([])};g.prototype.getNodesFaceColor=function(a){return this._getNodesColor(a,d.ElementType.Faces)};g.prototype.getNodesEffectiveFaceColor=function(a){return this._getNodesEffectiveColor(a,
d.ElementType.Faces)};g.prototype.getNodesLineColor=function(a){return this._getNodesColor(a,d.ElementType.Lines)};g.prototype.getNodesEffectiveLineColor=function(a){return this._getNodesEffectiveColor(a,d.ElementType.Lines)};g.prototype.getNodeColorMap=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){c=this._modelStructure.lookupAnyTreeNode(a);if(null!==c)return[2,d.Internal.Tree.getNodeColorMap(c,this._engine,e)];throw new d.InvalidNodeIdError(a);
})})};g.prototype.getNodesOpacity=function(a){return Promise.resolve(this._getNodesOpacity(a))};g.prototype.getNodesTransparency=function(a){return this.getNodesOpacity(a)};g.prototype._getNodesOpacity=function(a){a=this._getInstanceIncsFromLeafNodes(a);return 0<a.length?this._engine.getPartOpacity(a):[]};g.prototype.getNodesEffectiveOpacity=function(a,d){return(a=this._getInstanceIncsFromLeafNodes(a))&&0<a.length?this._engine.getEffectivePartOpacity(a,d):Promise.resolve([])};g.prototype.getNodesEffectiveTransparency=
function(a,d){return this.getNodesEffectiveOpacity(a,d)};g.prototype._getNodeElementColor=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,f;return __generator(this,function(k){switch(k.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getElementColor(b,d,c)];case 1:return f=k.sent()[0],[2,f]}})})};g.prototype._getNodeEffectiveElementColor=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,f;return __generator(this,function(k){switch(k.label){case 0:return b=
this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getEffectiveElementColor(b,d,c)];case 1:return f=k.sent()[0],[2,f]}})})};g.prototype.getNodeFaceColor=function(a,e){return this._getNodeElementColor(a,d.ElementType.Faces,e)};g.prototype.getNodeEffectiveFaceColor=function(a,e){return this._getNodeEffectiveElementColor(a,d.ElementType.Faces,e)};g.prototype.getNodeLineColor=function(a,e){return this._getNodeElementColor(a,d.ElementType.Lines,e)};g.prototype.getNodeEffectiveLineColor=function(a,
e){return this._getNodeEffectiveElementColor(a,d.ElementType.Lines,e)};g.prototype.getOutOfHierarchy=function(a){return this._modelStructure.isOutOfHierarchy(a)};g.prototype.getAbsoluteRootNode=function(){return this._modelStructure.getAbsoluteRootNodeId()};g.prototype.getRootNode=function(){return this.getAbsoluteRootNode()};g.prototype.getNodeChildren=function(a,d){return this._modelStructure.getChildIds(a,d||!1)};g.prototype.getNodesInstancingSamePart=function(a){return this._modelStructure.getPartReferrers(a)};
g.prototype.getUnitMultiplier=function(){var a=this._firstModelRootId!==d.InvalidNodeId?this._firstModelRootId:this.getAbsoluteRootNode();return this.getNodeUnitMultiplier(a)};g.prototype.getNodeUnitMultiplier=function(a){return this._modelStructure.getUnit(a)};g.prototype.createCadView=function(a,d,c,b,f,k,l,g,m){b||(b=[]);f||(f=[]);k||(k=[]);l||(l=[]);void 0===g&&(g=null);void 0===m&&(m=null);a=this._modelStructure.createCadView(a,d,c,b,f,k,l,g,m);null!==a&&this._callbackManager.trigger("cadViewCreated",
a,d);return a};g.prototype.createCADView=function(a,d,c,b,f,k,l,g,m){return this.createCadView(a,d,c,b,f,k,l,g,m)};g.prototype.getCadViewMap=function(){return this._modelStructure.getCadViewMap()};g.prototype.getCadViews=function(){return d.Internal.toIntegerMap(this.getCadViewMap())};g.prototype.getCADViews=function(){return this.getCadViews()};g.prototype.activateCadView=function(a,e,c){void 0===e&&(e=d.DefaultTransitionDuration);void 0===c&&(c=!0);this.resetModelOpacity();return this._modelStructure.activateCadView(a,
e,c)};g.prototype.activateCADView=function(a,d){return this.activateCadView(a,d)};g.prototype.getCadViewPmis=function(a){return this._modelStructure.getCadViewPmis(a)};g.prototype.getCADViewPMIs=function(a){return this.getCadViewPmis(a)};g.prototype.cadConfigurationsEnabled=function(){return this._modelStructure.cadConfigurationsEnabled()};g.prototype.getCadConfigurations=function(){return this._modelStructure.getCadConfigurations()};g.prototype.getCADConfigurations=function(){return this.getCadConfigurations()};
g.prototype.getDefaultCadConfiguration=function(){return this._modelStructure.getDefaultCadConfiguration()};g.prototype.getDefaultCadView=function(){return this._modelStructure.getDefaultCadView()};g.prototype.activateDefaultCadView=function(a,e){void 0===a&&(a=d.DefaultTransitionDuration);void 0===e&&(e=!0);return this._modelStructure.activateDefaultCadView(a,e)};g.prototype.getCADDefaultConfiguration=function(){return this.getDefaultCadConfiguration()};g.prototype.getActiveCadConfiguration=function(){return this._modelStructure.getActiveCadConfiguration()};
g.prototype.getCADActiveConfiguration=function(){return this.getActiveCadConfiguration()};g.prototype.getCadViewConfiguration=function(a){return this._modelStructure.getCadViewConfiguration(a)};g.prototype.activateCadConfiguration=function(a){return this._modelStructure.activateCadConfiguration(a,!0)};g.prototype.activateCADConfiguration=function(a){return this.activateCadConfiguration(a)};g.prototype.activateDefaultCadConfiguration=function(a){void 0===a&&(a=!0);return this._modelStructure.activateDefaultCadConfiguration(a)};
g.prototype.activateCADDefaultConfiguration=function(){return this.activateDefaultCadConfiguration()};g.prototype.getPointAttributes=function(a,d){return this._modelStructure.getPointAttributes(a,d)};g.prototype.getEdgeCount=function(a){return this._modelStructure.getEdgeCount(a)};g.prototype.getEdgeAttributes=function(a,d){return this._modelStructure.getEdgeAttributes(a,d)};g.prototype.getEdgeProperty=function(a,d){return this._modelStructure.getEdgeProperty(a,d)};g.prototype.getFaceCount=function(a){return this._modelStructure.getFaceCount(a)};
g.prototype.getFaceAttributes=function(a,d){return this._modelStructure.getFaceAttributes(a,d)};g.prototype.getFaceProperty=function(a,d){return this._modelStructure.getFaceProperty(a,d)};g.prototype.setEdgeProperty=function(a,d,c){this._modelStructure.setEdgeProperty(a,d,c)};g.prototype.setFaceProperty=function(a,d,c){this._modelStructure.setFaceProperty(a,d,c)};g.prototype.getNodeMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:e=
this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(0===e.length)throw new d.CommunicatorError("Node does not refer to a mesh instance");if(2<e.length)throw new d.CommunicatorError("Node refers to multiple mesh instances");c=e;return[4,this._engine.getInstancesMeshData(c)];case 1:b=f.sent();if(4294967295===b[1])throw new d.CommunicatorError("Node has instance, but no mesh data");return[2,this._engine.getMeshData(b)]}})})};g.prototype.getNodeCappingMeshData=
function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:e=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(0===e.length)throw new d.CommunicatorError("Node does not refer to a mesh instance");if(2<e.length)throw new d.CommunicatorError("Node refers to multiple mesh instances");c=e;return[4,this._engine.getInstancesCappingMeshData(c)];case 1:return b=f.sent(),4294967295===b[1]?[2,
null]:[2,this._engine.getMeshData(b)]}})})};g.prototype.getNodesCappingMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,k,l;return __generator(this,function(g){switch(g.label){case 0:return e=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None),[4,this._engine.getInstancesCappingMeshData(e)];case 1:c=g.sent(),b=[],f=1,g.label=2;case 2:if(!(f<c.length))return[3,5];if(4294967295===c[f])return[3,4];k=[c[f-1],c[f]];return[4,this._engine.getMeshData(k)];
case 3:l=g.sent(),b.push(l),g.label=4;case 4:return f+=2,[3,2];case 5:return[2,b]}})})};g.prototype.getNodeMatrix=function(a){return this._modelStructure.getMatrix(a)};g.prototype.setNodeMatrix=function(a,d,c){void 0===c&&(c=!1);return this._modelStructure.setMatrix(a,d,c)};g.prototype._setNodesMatrices=function(a,d,c){void 0===c&&(c=!1);return this._modelStructure.setMatrices(a,d,c)};g.prototype.resetNodeMatrixToInitial=function(a){return this._modelStructure.resetToInitialMatrix(a)};g.prototype.getNodeNetMatrix=
function(a){return d.Matrix.createFromArray(this._modelStructure.getNetMatrix(a))};g.prototype.getNodeParent=function(a){return this._modelStructure.getParentId(a)};g.prototype.getNodeType=function(a){return this._modelStructure.getType(a)};g.prototype.getNodeProperties=function(a,d){void 0===d&&(d=!0);return this._modelStructure.getProperties(a,d)};g.prototype.addPropertyToNode=function(a,d,c,b){return this._modelStructure.addProperty(a,d,c,b)};g.prototype.setPhysicalProperties=function(a,d,c,b){return this._modelStructure.setPhysicalProperties(a,
d,c,b)};g.prototype.requestNodes=function(a){return this._modelStructure.requestNodes(a)};g.prototype.getNodeName=function(a){return this._modelStructure.getName(a)||null};g.prototype.getNodeExchangeId=function(a){return this._modelStructure.getNodeExchangeId(a)};g.prototype.getFilters=function(){return this._modelStructure.getFilters()};g.prototype.getFilterName=function(a){return this._modelStructure.getFilterName(a)};g.prototype.getFiltersWithNode=function(a){return this._modelStructure.getFiltersWithNode(a)};
g.prototype.getNodesFromFiltersId=function(a){return this._modelStructure.getNodesFromFilterIds(a)};g.prototype.getLayers=function(){return this._modelStructure.getLayers()};g.prototype.getUniqueLayerNames=function(){return this._modelStructure.getUniqueLayerNames()};g.prototype.getLayerName=function(a){return this._modelStructure.getLayerName(a)};g.prototype.getLayerIdsFromName=function(a){return this._modelStructure.getLayerIdsFromName(a)};g.prototype.getNodeLayerId=function(a){return this._modelStructure.getNodeLayerId(a)};
g.prototype.getNodesFromLayer=function(a,d){return this._modelStructure.getRuntimeNodesFromLayer(a,d)};g.prototype.getNodesFromLayers=function(a,d){return this._modelStructure.getRuntimeNodesFromLayers(a,d)};g.prototype.getNodesFromLayerName=function(a,d){return this._modelStructure.getRuntimeNodesFromLayerName(a,d)};g.prototype.getNodeVisibility=function(a){return this._modelStructure.isVisible(a)};g.prototype.getBranchVisibility=function(a){a=this._modelStructure.getBranchVisibility(a);if(2===a)return d.BranchVisibility.Shown;
if(1===a)return d.BranchVisibility.Hidden;console.assert(3===a);return d.BranchVisibility.Mixed};g.prototype.getDataFromIds=function(a){return this._engine.getDataFromIds(a)};g.prototype.getDataFromKeys=function(a){return this.getDataFromIds(a)};g.prototype.createMesh=function(a,d){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._engine.createMesh(a)];case 1:return c=b.sent(),d&&d.doNotDelete&&this._preventMeshDeletion(c),
[2,c]}})})};g._flatArrayToPairArray=function(a){for(var d=[],c=0;c<a.length;c+=2)d.push([a[c],a[c+1]]);return d};g._pairArrayToFlatArray=function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c];d.push(b[0],b[1])}return d};g.prototype.getMeshIds=function(a){return __awaiter(this,void 0,void 0,function(){var e,c;return __generator(this,function(b){switch(b.label){case 0:return e=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None),[4,this._engine.getInstancesMeshData(e)];
case 1:return c=b.sent(),[2,g._flatArrayToPairArray(c)]}})})};g.prototype.replaceMesh=function(a,d){return this._engine.replaceMesh(a,d)};g.prototype.createMeshInstance=function(a,d,c,b){void 0===d&&(d=null);c||(c=!1);b||(b=!1);return this._createMeshInstance(a,d,c,b)};g.prototype._createMeshInstance=function(a,e,c,b){return __awaiter(this,void 0,void 0,function(){var f,k,l,g,m,p,q,h,t,u;return __generator(this,function(n){switch(n.label){case 0:f=a.getMatrix();k=null!==f||null!==e;l=a.getCreationFlags();
c&&(l|=d.MeshInstanceCreationFlags.DoNotReset);console.assert(!e||!b,"Out of hierarchy instances should not have a parent node.");g=null===e||this.getNodeVisibility(e);m=a;if(k||!g)m=a.copy(),m.setCreationFlags(l|d.MeshInstanceCreationFlags.Invisible);return[4,this._engine.createMeshInstance(m)];case 1:p=n.sent();q=this._modelStructure.createMeshInstance(p[0],p[1],a.getInstanceName(),e,c,b,!1);if(!k&&g)return[3,3];h=f?f:new d.Matrix;return[4,this.setNodeMatrix(q,h,!0)];case 2:n.sent(),0===(l&d.MeshInstanceCreationFlags.Invisible)&&
g&&this._engine.setPartVisibility(p,!0,!0),n.label=3;case 3:return t=g,0!==(l&d.MeshInstanceCreationFlags.Invisible)&&(t=!1),u=this._modelStructure.lookupAnyTreeNode(q),null!==u&&u.setVisibility(t),null===e?[3,5]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[q],d.NodeSource.CreateInstance)];case 4:n.sent(),n.label=5;case 5:return[2,q]}})})};g.prototype.createPmiInstance=function(a,e,c,b,f){return __awaiter(this,void 0,void 0,function(){var k,l,g,m,p,q,h,t;return __generator(this,
function(n){switch(n.label){case 0:void 0===f&&(f=null);k=[];l=0;for(g=b;l<g.length;l++){m=g[l];p=this._modelStructure.lookupBodyInstance(m.bodyId);if(null===p)throw new d.InvalidNodeIdError(m.bodyId);q=d.Internal.Tree.ReferenceOnTopology.fromBodyInstance(p,m.subElementType,m.subElementIndex);k.push(q)}return[4,this._engine.createMeshInstance(a)];case 1:return h=n.sent(),t=this._modelStructure.createPmiInstance(h[0],h[1],e,c,k,a.getInstanceName(),f),null===f?[3,3]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded",
"subtreeLoaded",[t],d.NodeSource.CreatePmi)];case 2:n.sent(),n.label=3;case 3:return[2,t]}})})};g.prototype.createPMIInstance=function(a,d,c,b,f){return this.createPmiInstance(a,d,c,b,f)};g.prototype.createImage=function(a,d){return this._engine.createImage(a,d)};g.prototype.deleteImages=function(a){return this._engine.destroyImages(g._pairArrayToFlatArray(a))};g.prototype.setNodesTexture=function(a,d){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.setTexture(a,d)};g.prototype.unsetNodesTexture=
function(a){a=this._getInstanceIncsFromLeafNodes(a);this._engine.unsetTexture(a)};g.prototype.deleteMeshes=function(a){return this._engine.destroyMeshes(g._pairArrayToFlatArray(a))};g.prototype.deleteMeshInstances=function(a){var e=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None),c=[];if(0<e.length){for(var b=0;b<a.length;b++)c.push(this._modelStructure.deleteNode(a[b]));c.push(this._engine.destroyLocalInstances(e))}return d.Util.waitForAll(c)};g.prototype._obtainLoadSubtreeConfig=
function(a){if(a[0]instanceof d.LoadSubtreeConfig)var e=a[0];else e=new d.LoadSubtreeConfig,e.additionalMatrix=a[0]||null,e.allowMissingExternalModels=!!a[1];return e.copy()};g.prototype.loadSubtreeFromXmlFile=function(a,e,c){for(var b=[],f=3;f<arguments.length;f++)b[f-3]=arguments[f];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromXmlFile(a,e,c,b)};g.prototype.loadSubtreeFromXmlBuffer=function(a,e,c){for(var b=[],f=3;f<arguments.length;f++)b[f-
3]=arguments[f];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromXmlDoc(a,e,c,b)};g.prototype.loadSubtreeFromScsXmlFile=function(a,e,c){for(var b=[],f=3;f<arguments.length;f++)b[f-3]=arguments[f];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlFile(a,e,c,b)};g.prototype.loadSubtreeFromScsXmlBuffer=function(a,e,c){for(var b=[],f=3;f<arguments.length;f++)b[f-3]=arguments[f];b=this._obtainLoadSubtreeConfig(b);
c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlDoc(a,e,c,b)};g.prototype.loadSubtreeFromModel=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromStream(a,d,c)};g.prototype.loadSubtreeFromScsFile=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsFile(a,d,c)};g.prototype.loadSubtreeFromScsBuffer=
function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsBuffer(a,d,c)};g.prototype.loadSubtreeFromUrl=function(a,d){return this.loadSubtreeFromXmlFile(a,d)};g.prototype.loadSubtreeFromXML=function(a,d){return this.loadSubtreeFromXmlBuffer(a,d)};g.prototype.loadMeasurementFromJson=function(a){return this._modelStructure.loadMeasurementFromJson(a)};g.prototype.loadMeasurementFromString=function(a){return this._modelStructure.loadMeasurementFromString(a)};
g.prototype.loadMeasurementFromFile=function(a){return this._modelStructure.loadMeasurementFromFile(a)};g.prototype.switchToModel=function(a){this._callbackManager.trigger("modelLoadBegin");return this._modelStructure.switchToModel(a)};g.prototype.createNode=function(a,e,c,b,f,k){void 0===a&&(a=null);void 0===c&&(c=null);void 0===b&&(b=null);if(void 0===f||null===f)f=!0;a=this._modelStructure.createNode(a,e,c,b,f,k);null!==a&&(e=this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",
[a],d.NodeSource.CreateNode),e);return a};g.prototype.deleteNode=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return d=this._modelStructure.gatherInclusionKeysFromNodeIds([a]),[4,this._modelStructure.deleteNode(a)];case 1:return c.sent(),[4,this._engine.detachInclusions(d)];case 2:return c.sent(),this._callbackManager.trigger("subtreeDeleted",[a]),[2]}})})};g.prototype.createPart=function(a){void 0===a&&(a=null);return this._modelStructure.createPart(a)};
g.prototype.setPart=function(a,d){return void 0===a||null===a||void 0===d||null===d?!1:this._modelStructure.setPart(a,d)};g.prototype.createAndAddRepresentationItem=function(a,d){if(void 0===a||null===a)return null;void 0===d&&(d=null);return this._modelStructure.createAndAddRepItem(a,d)};g.prototype.createAndAddBody=function(a,d){return this.createAndAddRepresentationItem(a,d)};g.prototype.getLowestAvailableNodeId=function(){return this._modelStructure.getLowestAvailableNodeId()};g.prototype.getLowestAvailableNodeID=
function(){return this.getLowestAvailableNodeId()};g.prototype.setInstanceModifier=function(a,d,c){this._setInstanceModifier(a,d,c,7);return Promise.resolve()};g.prototype._setInstanceModifier=function(a,e,c,b){e=this._modelStructure.gatherInstanceIncsFromNodeIds(e,b,d.Internal.Tree.WalkRestriction.None);0<e.length&&this._engine.setInstanceModifier(a,e,c)};g.prototype.getSCInstanceKey=function(a){a=this._modelStructure.lookupBodyInstance(a);return null!==a?a.getInstanceInc():null};g.prototype.getNodeIDFromSCInstanceKey=
function(a,d){return this._modelStructure.getNodeFromInstanceInc(!1,a,d,!1)};g.prototype.getPrimaryModelKey=function(){return this._engine.getPrimaryModelKey()};g.prototype.getPrimaryModelId=function(){return this.getPrimaryModelKey()};g.prototype.getAssociatedModelKey=function(a){a=this._modelStructure.getAssociatedModelKey(a);return Promise.resolve(a)};g.prototype.hasDepthRange=function(a){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.hasDepthRange(a)};g.prototype.setDepthRange=function(a,
d,c){this._setDepthRange(a,d,c);return Promise.resolve()};g.prototype._setDepthRange=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);this._engine.setDepthRange(a,e,c)};g.prototype.unsetDepthRange=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);this._engine.unsetDepthRange(a)};g.prototype._gatherInstanceIncsFromNodeIds=function(a,e){void 0===e&&(e=7);return this._modelStructure.gatherInstanceIncsFromNodeIds(a,
e,d.Internal.Tree.WalkRestriction.None)};g.prototype._getInstanceIncsFromLeafNodes=function(a){for(var e=[],c=0;c<a.length;c++){var b=this._modelStructure.gatherInstanceIncsFromNodeIds([a[c]],7,d.Internal.Tree.WalkRestriction.None);if(2===b.length)e.push(b[0],b[1]);else throw new d.CommunicatorError("Non-leaf node encountered");}return e};g.prototype._getInstanceIncFromSingleLeafNode=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(2===
a.length)return a;throw new d.CommunicatorError("Non-leaf node encountered");};g.prototype.setMeshLevel=function(a,d){this._modelStructure.setMeshLevel(a,d);return Promise.resolve()};g.prototype.setMetallicRoughness=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);this._engine.setMetallicRoughness(a,e,c)};g.prototype.getMetallicRoughness=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);
return this._engine.getMetallicRoughness(a)};g.prototype.unsetMetallicRoughness=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);this._engine.unsetMetallicRoughness(a)};g.prototype.setEnableAutomaticUnitScaling=function(a){return this._modelStructure.setEnableAutomaticUnitScaling(a)};g.prototype.setBehaviorInitiallyHidden=function(a){return this._modelStructure.setBehaviorInitiallyHidden(a)};g.prototype.isDrawing=function(){return this._modelStructure.isACadDrawing()};
g.prototype.isMeasurable=function(){return this._modelStructure.isMeasurable()};g.prototype.isLineMeasurable=function(a,d){return this._modelStructure.isLineMeasurable(a,d)};g.prototype.isFaceMeasurable=function(a,d){return this._modelStructure.isFaceMeasurable(a,d)};g.prototype.getModelFileNameFromNode=function(a){return this._modelStructure.getModelFileNameFromNode(a)};g.prototype.getModelFileTypeFromNode=function(a){return this._modelStructure.getModelFileTypeFromNode(a)};g.prototype.getNodeGenericType=
function(a){return this._modelStructure.getNodeGenericType(a)};g.prototype.getNodeGenericId=function(a){return this._modelStructure.getNodeGenericId(a)};g.prototype.registerBimNodes=function(a,e,c){void 0===c&&(c=null);return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){b=this._modelStructure.lookupAnyTreeNode(a);if(null===b)return[2];"boolean"===typeof c&&(c=c?"TYPE":null);return[2,d.Internal.Tree.registerBimNodes(e,this._engine,this._modelStructure,b,c)]})})};
g.prototype.getGenericTypeIdMap=function(){return this._modelStructure.getGenericTypeIdMap()};g.prototype.getIfcNodeIds=function(){return this.getGenericTypeIdMap()};g.prototype.getIfcTypeByNodeId=function(a){return this._modelStructure.getNodeGenericType(a)};g.prototype.getNodesByGenericType=function(a){return this._modelStructure.getNodesByGenericType(a)};g.prototype.getNodesByIfcType=function(a){return this.getNodesByGenericType(a)};g.prototype.getGenericTypes=function(){return this._modelStructure.getGenericTypes()};
g.prototype.getIfcTypes=function(){return this.getGenericTypes()};g.prototype.hasEffectiveGenericType=function(a,d){return this._modelStructure.hasEffectiveGenericType(a,d)};g.prototype.registerIfcNodes=function(a,e){void 0===e&&(e=null);return this.registerBimNodes(a,d.Internal.Tree.ifcAttributeToBimMask,e)};g.prototype.isAnnotationView=function(a){return this._modelStructure.isAnnotationView(a)};g.prototype.isCombineStateView=function(a){return this._modelStructure.isCombineStateView(a)};g.prototype.setNodesCullingVector=
function(a,d,c,b){this._setNodesCullingVector(a,d,c,b);return Promise.resolve()};g.prototype._setNodesCullingVector=function(a,e,c,b){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);return this._engine.setCullingVector(a,e,c,b)};g.prototype.unsetNodesCullingVectors=function(a){this._unsetNodesCullingVectors(a);return Promise.resolve()};g.prototype._unsetNodesCullingVectors=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);
this._engine.unsetCullingVector(a)};g.prototype.getNodesCullingVectors=function(a){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.getCullingVector(a)};g.prototype.getNodeIdOffset=function(a){return this._modelStructure.getIdOffset(a)};g.prototype.isNodeLoaded=function(a){return this._modelStructure.isNodeLoaded(a)};g.prototype.triangulatePolygon=function(a,e){e=d.Internal.toVec3(e);return this._engine.triangulatePolygon(a,e)};g.prototype.setNodesLinePattern=function(a,d,c,b){a=this._gatherInstanceIncsFromNodeIds(a);
this._engine.setLinePattern(a,d,c,b)};g.prototype.unsetNodesLinePattern=function(a){a=this._gatherInstanceIncsFromNodeIds(a);this._engine.unsetLinePattern(a)};g.prototype._hwfAwaitAssemblyTreeReady=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c;return __generator(this,function(b){switch(b.label){case 0:a=this.getAbsoluteRootNode();e=this._modelStructure.lookupAnyTreeNode(a);if(null===e)throw new d.InternalLogicError;c=d.Internal.Tree.towardLoadContext(e);return[4,d.Internal.Tree.WalkerAsync.forceLazyPromises(c)];
case 1:return b.sent(),[4,d.Internal.Tree.markContextsLoaded([c])];case 2:return b.sent(),[2]}})})};g.prototype.getNodeUserDataIndices=function(a){return this._modelStructure.getUserDataIndices(a)};g.prototype.getNodeUserData=function(a,d){return this._modelStructure.getUserData(a,d)};g.prototype.getNodeIdsByGenericIds=function(a){for(var d=[],c=0;c<a.length;c++){var b=this._modelStructure.getNodesByGenericId(a[c]);null!==b&&b.forEach(function(b){d.push(b)})}return d};g.prototype.getNodeIdsByIfcGuids=
function(a){return this.getNodeIdsByGenericIds(a)};g.prototype._getModelStructure=function(){return this._modelStructure};g.prototype.isWithinExternalModel=function(a){return this._modelStructure.isWithinExternalModel(a)};g.prototype._firstAssemblyDataHeader=function(){return this._modelStructure.firstAssemblyDataHeader()};g.prototype.getBimIdFromNode=function(a){return this._modelStructure.getBimIdFromNode(a)};g.prototype.getBimIdsFromGenericId=function(a){var d=this,c=[];a=this._modelStructure.getNodesByGenericId(a);
null!==a&&a.forEach(function(b){b=d.getBimIdFromNode(b);null!==b&&c.push(b)});return c};g.prototype.getNodeIdFromBimId=function(a,d){return this._modelStructure.getRuntimeNodeFromBimId(a,d)};g.prototype.getGenericIdFromBimId=function(a,d){a=this._modelStructure.getRuntimeNodeFromBimId(a,d);return null!==a?this._modelStructure.getNodeGenericId(a):null};g.prototype.getRelationshipTypesFromBimId=function(a,d){var c=[],b=0;for(a=this._modelStructure.getBimIdRelationshipTypes(a,d);b<a.length;b++)c.push(a[b].type);
return c};g.prototype.getBimIdRelatedElements=function(a,d,c){var b=0;for(a=this._modelStructure.getBimIdRelationshipTypes(a,d);b<a.length;b++)if(d=a[b],d.type===c)return d.relateds;return[]};g.prototype.getBimIdRelatingElements=function(a,d,c){var b=0;for(a=this._modelStructure.getBimIdRelationshipTypes(a,d);b<a.length;b++)if(d=a[b],d.type===c)return d.relatings;return[]};g.prototype.getBimIdConnectedElements=function(a,d,c){var b=0;for(a=this._modelStructure.getBimIdRelationshipTypes(a,d);b<a.length;b++)if(d=
a[b],d.type===c)return{relateds:d.relateds,relatings:d.relatings};return{relateds:[],relatings:[]}};g.prototype.getBimInfoFromBimId=function(a,d){return this._modelStructure.getInfoOfBimId(a,d)};__decorate([g.deprecated],g.prototype,"getPMIs",null);__decorate([g.deprecated],g.prototype,"getPMIType",null);__decorate([g.deprecated],g.prototype,"getPMISubtype",null);__decorate([g.deprecated],g.prototype,"setPMIColor",null);__decorate([g.deprecated],g.prototype,"getPMIColor",null);__decorate([g.deprecated],
g.prototype,"setPMIColorOverride",null);__decorate([g.deprecated],g.prototype,"getPMIColorOverride",null);__decorate([g.deprecated],g.prototype,"setNodesTransparency",null);__decorate([g.deprecated],g.prototype,"setNodesTransparencies",null);__decorate([g.deprecated],g.prototype,"resetModelTransparency",null);__decorate([g.deprecated],g.prototype,"resetNodesTransparency",null);__decorate([g.deprecated],g.prototype,"getNodesTransparency",null);__decorate([g.deprecated],g.prototype,"getNodesEffectiveTransparency",
null);__decorate([g.deprecated],g.prototype,"getRootNode",null);__decorate([g.deprecated],g.prototype,"getUnitMultiplier",null);__decorate([g.deprecated],g.prototype,"createCADView",null);__decorate([g.deprecated],g.prototype,"getCadViews",null);__decorate([g.deprecated],g.prototype,"getCADViews",null);__decorate([g.deprecated],g.prototype,"activateCADView",null);__decorate([g.deprecated],g.prototype,"getCADViewPMIs",null);__decorate([g.deprecated],g.prototype,"getCADConfigurations",null);__decorate([g.deprecated],
g.prototype,"getCADDefaultConfiguration",null);__decorate([g.deprecated],g.prototype,"getCADActiveConfiguration",null);__decorate([g.deprecated],g.prototype,"activateCADConfiguration",null);__decorate([g.deprecated],g.prototype,"activateCADDefaultConfiguration",null);__decorate([g.deprecated],g.prototype,"getDataFromKeys",null);__decorate([g.deprecated],g.prototype,"createPMIInstance",null);__decorate([g.deprecated],g.prototype,"loadSubtreeFromUrl",null);__decorate([g.deprecated],g.prototype,"loadSubtreeFromXML",
null);__decorate([g.deprecated],g.prototype,"createAndAddBody",null);__decorate([g.deprecated],g.prototype,"getLowestAvailableNodeID",null);__decorate([g.deprecated],g.prototype,"getSCInstanceKey",null);__decorate([g.deprecated],g.prototype,"getNodeIDFromSCInstanceKey",null);__decorate([g.deprecated],g.prototype,"getPrimaryModelKey",null);__decorate([g.deprecated],g.prototype,"getPrimaryModelId",null);__decorate([g.deprecated],g.prototype,"getIfcNodeIds",null);__decorate([g.deprecated],g.prototype,
"getIfcTypeByNodeId",null);__decorate([g.deprecated],g.prototype,"getNodesByIfcType",null);__decorate([g.deprecated],g.prototype,"getIfcTypes",null);__decorate([g.deprecated],g.prototype,"getNodeIdsByIfcGuids",null);return g}();d.Model=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){var e=this;this._position=new d.OverlayUnitPoint(0,d.OverlayUnit.Pixels,0,d.OverlayUnit.Pixels);this._viewportSize=new d.OverlayUnitPoint(1,d.OverlayUnit.ProportionOfOtherDimension,.2,d.OverlayUnit.ProportionOfCanvas);this._anchor=d.OverlayAnchor.UpperRightCorner;this._dimension=3;this._fieldSize=8;this._instanceKeys=[];this._enabled=!1;this._textImageId=null;this._selectionFaceColor=new d.Color(76,186,240);this._outlineColor=new d.Color(17,94,133);this._lastSelectedNodes=
[];this._nodeIds=[];this._adjacentFaces=[];this._preserveModelUp=!0;this._cameraRotation=0;this._lastFaceIndex=this._lastCamera=this._lastOrientation=null;this._textWidths=[];this._sceneReadyCompleted=d.Util.OpenPromise.create();this._geometryCreated=this._texturesReady=!1;this._viewer=a;this._fontSize=25;this._fontInfo=this._fontSize+"px Arial";this._textureSize=512;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,
this._createViewport()];case 1:return c.sent(),this._updateVisibility(),[4,this._createGeometry()];case 2:return c.sent(),this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._sceneReadyCompleted];case 1:return c.sent(),[2,this._setTextures()]}})})},_firstAttachment:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,
this._onCameraUpdate()];case 1:return c.sent(),this._updateVisibility(),[2]}})})},camera:function(){e._onCameraUpdate()},overlayViewportSet:function(c){c===d.BuiltinOverlayIndex.NavCube&&e._onViewportSet()},transitionEnd:function(){e._onCameraUpdate()},viewAxes:function(){e._updateOrientationMatrices()},_resetOpacity:function(){e._viewer.model.setNodesOpacity(e._nodeIds.slice(1),0)},viewOrientation:function(c){e._lastOrientation=c;e._cameraRotation=0;e._lastCamera=e._viewer.view.getCamera()}})}g.prototype.setAnchor=
function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return this._anchor=a,[4,this._sceneReadyCompleted];case 1:return d.sent(),[2,this._updateViewport()]}})})};g.prototype.getAnchor=function(){return this._anchor};g.prototype.enable=function(){this._enabled=!0;this._updateVisibility();return Promise.resolve()};g.prototype.disable=function(){this._enabled=!1;this._updateVisibility();return Promise.resolve()};g.prototype.setPreserveModelUp=
function(a){this._preserveModelUp=a};g.prototype.getPreserveModelUp=function(){return this._preserveModelUp};g.prototype._updateVisibility=function(){this._enabled&&this._texturesReady?this._showOverlay():this._hideOverlay()};g.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.NavCube,!1)};g.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.NavCube,!0)};g.prototype.getEnabled=function(){return this._enabled};
g.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.NavCube};g.prototype._setTextures=function(){return __awaiter(this,void 0,void 0,function(){var a,d,c,b,f;return __generator(this,function(k){switch(k.label){case 0:if(!this._textImageId||0<this._nodeIds.length||0>=this._instanceKeys.length)return[2];a=this._viewer.model;d=0;for(c=this._instanceKeys;d<c.length;d++)b=c[d],f=a._getNodeFromInstanceInc(!0,0,b,!0),this._nodeIds.push(f),a._preventNodeDeletion(f);a.setNodesOpacity(this._nodeIds.slice(1),
0);return[4,a.setNodesTexture([this._nodeIds[0]],{imageId:this._textImageId})];case 1:return k.sent(),this._texturesReady=!0,this._updateVisibility(),[2]}})})};g.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.NavCube,this._anchor,this._position.x,d.OverlayUnit.Pixels,this._position.y,d.OverlayUnit.Pixels,this._viewportSize.x,this._viewportSize.xUnit,this._viewportSize.y,this._viewportSize.yUnit)};g.prototype._createViewport=function(){var a=this._viewer.overlayManager;
this._updateViewport();var e=new d.Camera;e.setPosition(new d.Point3(0,0,10));e.setTarget(d.Point3.zero());e.setUp(new d.Point3(0,1,0));e.setWidth(this._fieldSize);e.setHeight(this._fieldSize);e.setProjection(d.Projection.Orthographic);a.setCamera(d.BuiltinOverlayIndex.NavCube,e)};g.prototype._onViewportSet=function(){var a=this._viewer.overlayManager,e=a._getViewportPosition(d.BuiltinOverlayIndex.NavCube),c=a._getViewportSize(d.BuiltinOverlayIndex.NavCube);a=a.getViewportAnchor(d.BuiltinOverlayIndex.NavCube);
null!==e&&null!==c&&null!==a&&(this._position=e,this._viewportSize=c,this._anchor=a)};g.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b,f,k,l,g,m,p,q,h,t,u,w,v,y,x,z,A,C,B,D,F,E,G,H,I,K,J,L,N,M;return __generator(this,function(n){switch(n.label){case 0:if(this._geometryCreated)return[2];a=this._initializeTextures();e=0;c=[];c.push(this._createCube(e++,this._dimension));b=[];b.push(this._makeRotationMatrixX(-.5*Math.PI));b.push(this._makeRotationMatrixX(.5*
Math.PI));b.push(this._makeRotationMatrixY(.5*Math.PI));b.push(this._makeRotationMatrixY(-.5*Math.PI));b.push(this._makeRotationMatrixZ(.5*Math.PI));b.push(this._makeRotationMatrixZ(-.5*Math.PI));f=this._dimension/4;k=this._dimension/2;l=[];g=new d.Point3(0,0,0);m=new d.Point3(0,0,0);p=new d.Point3(0,0,0);for(q=0;q<b.length;q++)h=this._dimension,t=b[q],u=!1,q===b.length-1&&(u=!0,g.z+=this._dimension+.02),m=new d.Point3(.5*h-f,-.5*h+f,-.5*h+-.01),p=new d.Point3(m.x+f,m.y-f,m.z),c.push(this._createSelectionFace(e++,
m,p,t,u,g,l)),m=new d.Point3(-.5*h,-.5*h+f,-.5*h+-.01),p=new d.Point3(m.x+f,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,t,u,g,l)),m=new d.Point3(-.5*h,.5*h,-.5*h+-.01),p=new d.Point3(m.x+f,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,t,u,g,l)),m=new d.Point3(.5*h-f,.5*h,-.5*h+-.01),p=new d.Point3(m.x+f,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,t,u,g,l)),m=new d.Point3(-.5*h+f,.5*h,-.5*h+-.01),p=new d.Point3(m.x+k,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,t,u,g,l)),
m=new d.Point3(-.5*h+f,-.5*h+f,-.5*h+-.01),p=new d.Point3(m.x+k,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,t,u,g,l)),m=new d.Point3(-.5*h,.5*h-f,-.5*h+-.01),p=new d.Point3(m.x+f,m.y-k,m.z),c.push(this._createSelectionFace(e++,m,p,t,u,g,l)),m=new d.Point3(.5*h-f,.5*h-f,-.5*h+-.01),p=new d.Point3(m.x+f,m.y-k,m.z),c.push(this._createSelectionFace(e++,m,p,t,u,g,l)),m=new d.Point3(-.5*h+f,.5*h-f,-.5*h+-.01),p=new d.Point3(m.x+k,m.y-k,m.z),c.push(this._createSelectionFace(e++,m,p,t,u,g,l));for(w=
0;w<l.length;w++){v=Math.floor(w/9);y=[];x=l[w];for(z=0;z<x.length;z+=2)for(A=x[z],C=x[z+1],B=0;B<l.length;B++)if(D=Math.floor(B/9),D!==v)for(F=l[B],E=0;E<F.length;E+=2)G=F[E],H=F[E+1],this._isSameEdge(A,C,G,H)&&y.push(B);this._adjacentFaces.push(y)}return[4,Promise.all(c)];case 1:I=n.sent();this._updateOrientationMatrices();this._onCameraUpdate();K=[];J=0;for(L=I;J<L.length;J++)N=L[J],K.push(0,N);M=this._getScEngine();M.setPartVisibility(K,!0,!0);this._geometryCreated=!0;return[2,a]}})})};g.prototype._createTexture=
function(a,e){a=a.getImageData(0,0,e,e).data;e=new ArrayBuffer(e*e*3);e=new Uint8Array(e);for(var c=0,b=0;b<a.length;b+=4)e[c]=a[b],e[c+1]=a[b],e[c+2]=a[b],c+=3;return this._viewer.model.createImage({format:d.ImageFormat.Rgb24,data:e,width:this._textureSize,height:this._textureSize})};g.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};g.prototype.insideOverlay=function(a){var d=this._viewer.overlayManager._toPixelPoint(this._viewportSize),c=this._getOverlayOffset();return a.x>=
c.x&&a.y>=c.y&&a.x<=c.x+d.x&&a.y<=c.y+d.y};g.prototype._getOverlayOffset=function(){var a=this._viewer.overlayManager._toPixelPoint(this._viewportSize);return this._viewer.overlayManager._getOverlayOffset(this._anchor,a)};g.prototype._getViewportSize=function(){return this._viewportSize};g.prototype._getViewportPixelSize=function(){return this._viewer.overlayManager._toPixelPoint(this._viewportSize)};g.prototype._onNoSelection=function(){this._enabled&&0<this._lastSelectedNodes.length&&(this._viewer.model.setNodesOpacity(this._lastSelectedNodes,
0),this._lastSelectedNodes.length=0)};g.prototype.onClickSelection=function(a){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){switch(c.label){case 0:console.assert(this._enabled);if(null===a||!a.isFaceSelection()||a.overlayIndex()!==d.BuiltinOverlayIndex.NavCube)return this._onNoSelection(),[2];e=this._getFaceIndexFromNodeId(a.getNodeId());return e<this._nodeIds.length&&0<e?[4,this._setViewOrientation(e)]:[3,2];case 1:c.sent(),c.label=2;case 2:return[2]}})})};
g.prototype.onMoveSelection=function(a){var e=this;console.assert(this._enabled);if(null!==a&&a.isFaceSelection()&&a.overlayIndex()===d.BuiltinOverlayIndex.NavCube){var c=a.getNodeId(),b=this._getFaceIndexFromNodeId(c)-1;0<=b&&c!==this._nodeIds[0]&&this._viewer.pauseRendering(function(){var f=e._viewer.model;f.setNodesOpacity(e._lastSelectedNodes,0);e._lastSelectedNodes.length=0;e._lastSelectedNodes.push(c);console.assert(b<e._adjacentFaces.length);for(var a=0,d=e._adjacentFaces[b];a<d.length;a++){var g=
e._getNodeIdFromFaceIndex(d[a]+1);e._lastSelectedNodes.push(g)}f.setNodesOpacity(e._lastSelectedNodes,1)})}else this._onNoSelection()};g.prototype._getViewOrientationFromFaceIndex=function(a){switch(a){case 1:a=d.ViewOrientation.LeftBottomBack;break;case 2:a=d.ViewOrientation.LeftBottomFront;break;case 3:a=d.ViewOrientation.LeftTopFront;break;case 4:a=d.ViewOrientation.LeftTopBack;break;case 5:a=d.ViewOrientation.LeftTop;break;case 6:a=d.ViewOrientation.LeftBottom;break;case 7:a=d.ViewOrientation.LeftFront;
break;case 8:a=d.ViewOrientation.LeftBack;break;case 9:a=d.ViewOrientation.Left;break;case 10:a=d.ViewOrientation.RightTopBack;break;case 11:a=d.ViewOrientation.RightTopFront;break;case 12:a=d.ViewOrientation.RightBottomFront;break;case 13:a=d.ViewOrientation.RightBottomBack;break;case 14:a=d.ViewOrientation.RightBottom;break;case 15:a=d.ViewOrientation.RightTop;break;case 16:a=d.ViewOrientation.RightFront;break;case 17:a=d.ViewOrientation.RightBack;break;case 18:a=d.ViewOrientation.Right;break;case 19:a=
d.ViewOrientation.BackTopRight;break;case 20:a=d.ViewOrientation.BackBottomRight;break;case 21:a=d.ViewOrientation.BackBottomLeft;break;case 22:a=d.ViewOrientation.BackTopLeft;break;case 23:a=d.ViewOrientation.BackLeft;break;case 24:a=d.ViewOrientation.BackRight;break;case 25:a=d.ViewOrientation.BackBottom;break;case 26:a=d.ViewOrientation.BackTop;break;case 27:a=d.ViewOrientation.Back;break;case 28:a=d.ViewOrientation.FrontBottomRight;break;case 29:a=d.ViewOrientation.FrontTopRight;break;case 30:a=
d.ViewOrientation.FrontTopLeft;break;case 31:a=d.ViewOrientation.FrontBottomLeft;break;case 32:a=d.ViewOrientation.FrontLeft;break;case 33:a=d.ViewOrientation.FrontRight;break;case 34:a=d.ViewOrientation.FrontTop;break;case 35:a=d.ViewOrientation.FrontBottom;break;case 36:a=d.ViewOrientation.Front;break;case 37:a=d.ViewOrientation.BottomRightFront;break;case 38:a=d.ViewOrientation.BottomLeftFront;break;case 39:a=d.ViewOrientation.BottomLeftBack;break;case 40:a=d.ViewOrientation.BottomRightBack;break;
case 41:a=d.ViewOrientation.BottomBack;break;case 42:a=d.ViewOrientation.BottomFront;break;case 43:a=d.ViewOrientation.BottomLeft;break;case 44:a=d.ViewOrientation.BottomRight;break;case 45:a=d.ViewOrientation.Bottom;break;case 46:a=d.ViewOrientation.TopLeftBack;break;case 47:a=d.ViewOrientation.TopRightBack;break;case 48:a=d.ViewOrientation.TopRightFront;break;case 49:a=d.ViewOrientation.TopLeftFront;break;case 50:a=d.ViewOrientation.TopFront;break;case 51:a=d.ViewOrientation.TopBack;break;case 52:a=
d.ViewOrientation.TopRight;break;case 53:a=d.ViewOrientation.TopLeft;break;case 54:a=d.ViewOrientation.Top;break;default:a=d.ViewOrientation.Front}return a};g.prototype._setViewOrientation=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,k,l,g,m,p,h,r,t,u,w,v;return __generator(this,function(n){switch(n.label){case 0:return e=this._viewer.view,c=this._getViewOrientationFromFaceIndex(a),[4,e.getViewOrientationCamera(c,void 0,this._preserveModelUp)];case 1:b=n.sent();f=!1;console.assert(0<=
a-1);console.assert(a-1<this._adjacentFaces.length);k=this._adjacentFaces[a-1];l=0;for(g=k;l<g.length;l++)if(m=g[l],p=m+1,p===this._lastFaceIndex){f=!0;break}this._lastFaceIndex=a;h=null!==this._lastCamera&&this._lastCamera.equals(e.getCamera());this._cameraRotation=(r=this._lastOrientation===c||f)&&h?this._preserveModelUp?(this._cameraRotation+90)%360:90:0;this._lastOrientation=c;0<this._cameraRotation&&(t=d.Point3.subtract(b.getPosition(),b.getTarget()).normalize(),u=d.Matrix.createFromOffAxisRotation(t,
this._cameraRotation),w=b.getUp(),u.transform(w,w),b.setUp(w));return[4,e.fitWorld(d.DefaultTransitionDuration,b)];case 2:n.sent();v=this._viewer.model.getAbsoluteRootNode();if(0===this._viewer.model.getNodeChildren(v).length)return[2,this._getScEngine().markCameraAsEmpty()];this._lastCamera=e.getCamera();return[2]}})})};g.prototype._getScEngine=function(){return this._viewer._getScEngine()};g.prototype._createInstance=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f,k,l;return __generator(this,
function(g){switch(g.label){case 0:return[4,this._viewer.model.createMesh(a)];case 1:return c=g.sent(),b=new d.MeshInstanceData(c),b.setCreationFlags(d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotLight|d.MeshInstanceCreationFlags.Invisible),b.setOverlayIndex(d.BuiltinOverlayIndex.NavCube),f=this._getScEngine(),[4,f.createMeshInstance(b)];case 2:return k=g.sent(),l=k[1],this._instanceKeys[e]=
l,[2,l]}})})};g.prototype._createCube=function(a,e){for(var c=[],b=[],f=[],k=[],l=this._textWidths[0],g=0,m=this._textWidths;g<m.length;g++){var p=m[g];p>l&&(l=p)}l+=10;c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,
1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));g=22/this._textureSize;m=82/this._textureSize;g=1-g;m=1-m;var h=(l-this._textWidths[0])/2;p=-(h/this._textureSize);h=(this._textWidths[0]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(p,g));k.push(new d.Point3(-.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*
e,.5*e,.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,
-1,0));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[1])/2;p=-(h/this._textureSize);h=(this._textWidths[1]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,g));f.push(new d.Point2(h,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*
e,-.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,
0,0));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,0,0));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[2])/2;p=-(h/this._textureSize);h=(this._textWidths[2]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(p,g));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));k.push(new d.Point3(-.5*e,.5*e,-.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*
e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,
0,0));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[3])/2;p=-(h/this._textureSize);h=(this._textWidths[3]+h)/this._textureSize;f.push(new d.Point2(h,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*
e,.5*e));k.push(new d.Point3(.5*e,-.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,
0,-1));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,0,-1));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[4])/2;p=-(h/this._textureSize);h=(this._textWidths[4]+h)/this._textureSize;f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,g));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*
e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[5])/2;p=-(h/this._textureSize);h=(this._textWidths[5]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(p,
g));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));e=new d.MeshData;e.setFaceWinding(d.FaceWinding.CounterClockwise);l=[];m=[];p=[];for(g=h=0;g<c.length;g++){var r=c[g];l.push(r.x);l.push(r.y);l.push(r.z);r=b[g];m.push(r.x);m.push(r.y);m.push(r.z);r=f[g];p.push(r.x);p.push(r.y);if(18<=l.length){r=[[0,255,0,255],[0,255,0,255],[255,0,0,255],[255,0,0,255],[0,0,255,255],[0,0,255,255]][h];for(var t=[],u=0;6>u;u++)t.push(r[0]),t.push(r[1]),t.push(r[2]),t.push(r[3]);e.addFaces(l,m,new Uint8Array(t),
p);l=[];m=[];p=[];++h}}l=[];c=new Uint8Array(4*k.length);for(g=0;g<k.length;g++)b=k[g],l.push(b.x),l.push(b.y),l.push(b.z),b=4*g,c[b]=this._outlineColor.r,c[b+1]=this._outlineColor.g,c[b+2]=this._outlineColor.b,c[b+3]=255;e.addPolyline(l,c);return this._createInstance(e,a)};g.prototype._onCameraUpdate=function(){var a=new d.Camera,e=this._viewer.view.getCamera();a.setPosition(e.getPosition().subtract(e.getTarget()).normalize());a.setTarget(d.Point3.zero());a.setUp(e.getUp());a.setProjection(d.Projection.Orthographic);
a.setWidth(this._fieldSize);a.setHeight(this._fieldSize);this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.NavCube,a)};g.prototype._updateOrientationMatrices=function(){var a=this._viewer.model.getViewAxes(),e=a.upVector.copy(),c=a.frontVector.copy(),b=d.Point3.cross(e,c.copy().scale(-1));a=new d.Matrix;a.m[0]=-c.x;a.m[1]=-c.y;a.m[2]=-c.z;a.m[4]=b.x;a.m[5]=b.y;a.m[6]=b.z;a.m[8]=e.x;a.m[9]=e.y;a.m[10]=e.z;e=this._getScEngine();c=[];b=0;for(var f=this._instanceKeys;b<f.length;b++)c.push(0,
f[b]);e.setInstancesMatrix(c,a)};g.prototype._createSelectionFace=function(a,e,c,b,f,k,l){var g=new d.MeshData;g.setFaceWinding(d.FaceWinding.CounterClockwise);var m=[];this._createQuad(e,c,m,b,k,f);e=[];c=[];b=[];for(k=0;k<m.length;k++){var p=m[k];e.push(p.x);e.push(p.y);e.push(p.z);c.push(0);c.push(0);c.push(-1);b.push(this._selectionFaceColor.r);b.push(this._selectionFaceColor.g);b.push(this._selectionFaceColor.b);b.push(128)}k=[];p=[this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,
255,this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,255];g.addFaces(e,c,new Uint8Array(b));e=[];f?(e.push(m[4].x,m[4].y,m[4].z),e.push(m[5].x,m[5].y,m[5].z)):(e.push(m[0].x,m[0].y,m[0].z),e.push(m[1].x,m[1].y,m[1].z));g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];e.push(m[1].x,m[1].y,m[1].z);e.push(m[2].x,m[2].y,m[2].z);g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];
e.push(m[3].x,m[3].y,m[3].z);e.push(m[4].x,m[4].y,m[4].z);g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];f?(e.push(m[3].x,m[3].y,m[3].z),e.push(m[2].x,m[2].y,m[2].z)):(e.push(m[5].x,m[5].y,m[5].z),e.push(m[3].x,m[3].y,m[3].z));g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));l.push(k);return this._createInstance(g,a)};g.prototype._createQuad=function(a,e,c,b,f,k){void 0===k&&(k=!1);a=new d.Point3(a.x,
a.y,a.z);e=new d.Point3(e.x,e.y,e.z);f&&(a.x+=f.x,a.y+=f.y,a.z+=f.z,e.x+=f.x,e.y+=f.y,e.z+=f.z);f=c.length;var l=new d.Point3(e.x,e.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(a.x,e.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(a.x,a.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(e.x,a.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(e.x,e.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(a.x,a.y,a.z);l=b.transform(l);c.push(l);if(k)for(b=0;3>b;b++)k=f+b,a=c[f+b],a=new d.Point3(a.x,a.y,a.z),
e=f+(6-b-1),c[k].x=c[e].x,c[k].y=c[e].y,c[k].z=c[e].z,c[e].x=a.x,c[e].y=a.y,c[e].z=a.z};g.prototype._makeRotationMatrixX=function(a){var e=Math.cos(a);a=Math.sin(a);var c=new d.Matrix;c.m[5]=e;c.m[6]=-a;c.m[9]=a;c.m[10]=e;return c};g.prototype._makeRotationMatrixY=function(a){var e=Math.cos(a);a=Math.sin(a);var c=new d.Matrix;c.m[0]=e;c.m[2]=a;c.m[8]=-a;c.m[10]=e;return c};g.prototype._makeRotationMatrixZ=function(a){var e=Math.cos(a);a=Math.sin(a);var c=new d.Matrix;c.m[0]=e;c.m[1]=-a;c.m[4]=a;c.m[5]=
e;return c};g.prototype._getFaceIndexFromNodeId=function(a){for(var d=0;d<this._nodeIds.length;d++)if(this._nodeIds[d]===a)return d;return-1};g.prototype._getNodeIdFromFaceIndex=function(a){return this._nodeIds[a]};g.prototype._isSameEdge=function(a,e,c,b){var f=d.Point3.subtract(a,c).squaredLength()+d.Point3.subtract(e,b).squaredLength();a=d.Point3.subtract(e,c).squaredLength()+d.Point3.subtract(a,b).squaredLength();return.03>Math.min(f,a)};g.prototype._initializeTextures=function(){return __awaiter(this,
void 0,void 0,function(){var a,d,c,b,f,k,l;return __generator(this,function(e){switch(e.label){case 0:a=document.createElement("canvas");a.width=this._textureSize;a.height=this._textureSize;d=a.getContext("2d");c=2*(this._fontSize+5);d.beginPath();d.rect(0,0,this._textureSize,this._textureSize);d.fillStyle="gray";d.fill();d.fillStyle="black";d.font=this._fontInfo;for(b=0;b<g._faceTexts.length;b++)f=g._faceTexts[b],d.fillText(f,0,c*(b+1)),k=d.measureText(f),this._textWidths.push(k.width);return[4,
this._createTexture(d,this._textureSize)];case 1:return this._textImageId=l=e.sent(),[2]}})})};g._faceTexts="LEFT RIGHT FRONT BACK BOTTOM TOP".split(" ");return g}();d.NavCube=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){var e=this;this._operatorStack=[];this._operators=new Map;this._customOperatorIdCount=0;this._customOperatorIdIndex=1E4;this._mergeableEvents=[d.EventType.MouseMove,d.EventType.Mousewheel,d.EventType.TouchMove,d.EventType.KeyUp,d.EventType.KeyDown];this._eventSequencePromise=Promise.resolve();this._events=[];this._viewer=a;this._viewer.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(e,void 0,void 0,function(){var c,b=this;return __generator(this,
function(f){c=[];this._operators.forEach(function(f,a){f=b._deactivateOperator(a);void 0!==f&&c.push(f);f=b._activateOperator(a);void 0!==f&&c.push(f)});return[2,d.Util.waitForAll(c)]})})}})}g.prototype._shutdown=function(){for(;void 0!==this.pop(););};g.prototype._registerOperator=function(a,d){this._operators.set(a,d)};g.prototype.registerCustomOperator=function(a){var d=this._customOperatorIdIndex+this._customOperatorIdCount++;this._operators.set(d,a);return d};g.prototype.unregisterCustomOperator=
function(a){a>=this._customOperatorIdIndex&&this._operators.delete(a)};g.prototype.replaceOperator=function(a,d){d=this.getOperator(d);return null!==d?(this._operators.set(a,d),!0):!1};g.prototype.indexOf=function(a){for(var d=this.size()-1;0<=d;d--)if(this._operatorStack[d]===a)return d;return-1};g.prototype.push=function(a){return this._isValid(a)&&!this._contains(a)?(this._operatorStack.push(a),this._activateOperator(a),!0):!1};g.prototype.set=function(a,d){var c=this._operatorStack[d];return a===
c?!1:this._isValid(a)&&!this._contains(a)?(this._deactivateOperator(c),this._activateOperator(a),this._operatorStack[d]=a,!0):!1};g.prototype.pop=function(){var a=this._operatorStack.pop();void 0!==a&&this._deactivateOperator(a);return a};g.prototype.remove=function(a){var d=this.indexOf(a);-1!==d&&(this._operatorStack.splice(d,1),this._deactivateOperator(a))};g.prototype.peek=function(){return 0<this.size()?this._operatorStack[this.size()-1]:d.OperatorId.Invalid};g.prototype.clear=function(){for(var a=
this.size()-1;0<=a;a--)this.pop()};g.prototype.size=function(){return this._operatorStack.length};g.prototype.getOperator=function(a){a=this._operators.get(a);return void 0!==a?a:null};g.prototype._injectEvent=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f,k;return __generator(this,function(l){switch(l.label){case 0:c=this.size()-1,l.label=1;case 1:if(!(0<=c))return[3,40];b=this._operators.get(this._operatorStack[c]);if(void 0===b)return[3,36];l.label=2;case 2:l.trys.push([2,
35,,36]);f=e;switch(f){case d.EventType.KeyDown:return[3,3];case d.EventType.KeyUp:return[3,6];case d.EventType.MouseDown:return[3,9];case d.EventType.MouseMove:return[3,12];case d.EventType.MouseUp:return[3,15];case d.EventType.Mousewheel:return[3,18];case d.EventType.TouchStart:return[3,21];case d.EventType.TouchMove:return[3,24];case d.EventType.TouchEnd:return[3,27];case d.EventType.ViewOrientationChange:return[3,30]}return[3,33];case 3:return b.onKeyDown?[4,b.onKeyDown(a)]:[3,5];case 4:l.sent(),
l.label=5;case 5:return[3,34];case 6:return b.onKeyUp?[4,b.onKeyUp(a)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,34];case 9:return b.onMouseDown?[4,b.onMouseDown(a)]:[3,11];case 10:l.sent(),l.label=11;case 11:return[3,34];case 12:return b.onMouseMove?[4,b.onMouseMove(a)]:[3,14];case 13:l.sent(),l.label=14;case 14:return[3,34];case 15:return b.onMouseUp?[4,b.onMouseUp(a)]:[3,17];case 16:l.sent(),l.label=17;case 17:return[3,34];case 18:return b.onMousewheel?[4,b.onMousewheel(a)]:[3,20];case 19:l.sent(),
l.label=20;case 20:return[3,34];case 21:return b.onTouchStart?[4,b.onTouchStart(a)]:[3,23];case 22:l.sent(),l.label=23;case 23:return[3,34];case 24:return b.onTouchMove?[4,b.onTouchMove(a)]:[3,26];case 25:l.sent(),l.label=26;case 26:return[3,34];case 27:return b.onTouchEnd?[4,b.onTouchEnd(a)]:[3,29];case 28:l.sent(),l.label=29;case 29:return[3,34];case 30:return b.onViewOrientationChange?[4,b.onViewOrientationChange()]:[3,32];case 31:l.sent(),l.label=32;case 32:return[3,34];case 33:d.Util.TypeAssertNever(e),
l.label=34;case 34:return[3,36];case 35:return k=l.sent(),k instanceof d.PickOutsideCanvasError||console.log(k),[3,36];case 36:return a.getHandled()?e!==d.EventType.MouseUp&&e!==d.EventType.TouchEnd?[3,38]:[4,this._stopInteraction()]:[3,39];case 37:l.sent(),l.label=38;case 38:return[3,40];case 39:return c--,[3,1];case 40:return[2]}})})};g.prototype.injectEvent=function(a,d){return __awaiter(this,void 0,void 0,function(){var c=this;return __generator(this,function(b){this._addOrMergeEventToQueue(a,
d);this._eventSequencePromise=this._eventSequencePromise.then(function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._injectNextEvent()];case 1:return b.sent(),[2]}})})});return[2,this._eventSequencePromise]})})};g.prototype._addOrMergeEventToQueue=function(a,e){var c=!1;if(-1!==this._mergeableEvents.indexOf(e))for(var b=0;b<this._events.length;b++){var f=this._events[b];if(e===f.eventType&&(e!==d.EventType.KeyDown&&e!==d.EventType.KeyUp||
a.getKeyCode()===f.event.getKeyCode())&&(e!==d.EventType.TouchMove||a.getId()===f.event.getId())){f.event=a;c=!0;break}}c||this._events.push({event:a,eventType:e})};g.prototype._injectNextEvent=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return a=this._events.shift(),void 0===a?[2]:[4,this._injectEvent(a.event,a.eventType)];case 1:return d.sent(),[2]}})})};g.prototype._stopInteraction=function(){return __awaiter(this,void 0,
void 0,function(){var a,e,c,b;return __generator(this,function(f){a=[];for(e=this.size()-1;0<=e;e--)(c=this._operators.get(this._operatorStack[e]))&&c.stopInteraction&&(b=c.stopInteraction(),void 0!==b&&a.push(b));return[2,d.Util.waitForAll(a)]})})};g.prototype._injectViewOrientationChangeEvent=function(){for(var a=this.size()-1;0<=a;a--){var d=this._operators.get(this._operatorStack[a]);if(void 0!==d&&d.onViewOrientationChange)d.onViewOrientationChange()}};g.prototype._isValid=function(a){return this._operators.has(a)||
a===d.OperatorId.None};g.prototype._contains=function(a){return-1!==this.indexOf(a)};g.prototype._activateOperator=function(a){a=this._operators.get(a);if(void 0!==a&&a.onActivate)return a.onActivate()};g.prototype._deactivateOperator=function(a){a=this._operators.get(a);if(void 0!==a&&a.onDeactivate)return a.onDeactivate()};return g}();d.OperatorManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){return function(a,c,b,f){this.x=a;this.xUnit=c;this.y=b;this.yUnit=f}}();d.OverlayUnitPoint=h;var g=function(){function a(c,b,f){this._anchor=c;this._position=b;this._size=f}a.prototype.getAnchor=function(){return this._anchor};a.prototype.getPosition=function(){return this._position};a.prototype.getSize=function(){return this._size};return a}(),a=function(){function a(c,b){this._viewer=c;this._engine=b;this._viewports=[];for(c=0;c<=this.maxIndex();c++)this._viewports.push(null)}
a.prototype.maxIndex=function(){return d.BuiltinOverlayIndex.First-1};a.prototype.setViewport=function(c,b,f,a,e,n,m,p,q,r){if(0===c)throw new d.CommunicatorError("Index 0 is reserved and may not be used to specify an overlay.");if(0>c)throw new d.CommunicatorError("Invalid index "+c+" specified when setting viewport.");if(a===d.OverlayUnit.ProportionOfOtherDimension&&n===d.OverlayUnit.ProportionOfOtherDimension)throw new d.CommunicatorError("Both x and y may not be set proportional to each other");
if(p===d.OverlayUnit.ProportionOfOtherDimension&&r===d.OverlayUnit.ProportionOfOtherDimension)throw new d.CommunicatorError("Both width and height may not be set proportional to each other");this._validateUnit(f,a,"x");this._validateUnit(e,n,"y");this._validateUnit(m,p,"width");this._validateUnit(q,r,"height");var k=new h(f,a,e,n),l=new h(m,p,q,r);k=new g(b,k,l);this._viewports[c]=k;this._engine.setOverlayViewport(c,b,f,a,e,n,m,p,q,r);this._viewer._getCallbackManager().trigger("overlayViewportSet",
c);return Promise.resolve()};a.prototype._getViewportPosition=function(c){c=this._viewports[c];return null===c?null:c.getPosition()};a.prototype.getViewportPixelPosition=function(c){c=this._viewports[c];if(null===c)return null;c=c.getPosition();return this._toPixelPoint(c)};a.prototype.getViewportPixelOffsetInCanvas=function(c){var b=this.getViewportPixelPosition(c);if(null===b)return null;var f=this.getViewportPixelSize(c);if(null===f)return null;c=this.getViewportAnchor(c);if(null===c)return null;
f=this._getOverlayOffset(c,f);var a=d.Point2.add(f,b);switch(c){case d.OverlayAnchor.UpperRightCorner:case d.OverlayAnchor.RightCenter:case d.OverlayAnchor.LowerRightCorner:a.x=f.x-b.x}switch(c){case d.OverlayAnchor.LeftCenter:case d.OverlayAnchor.Center:case d.OverlayAnchor.RightCenter:case d.OverlayAnchor.LowerLeftCorner:case d.OverlayAnchor.BottomCenter:case d.OverlayAnchor.LowerRightCorner:a.y=f.y-b.y}return a};a.prototype._getViewportSize=function(c){c=this._viewports[c];return null===c?null:
c.getSize()};a.prototype.getViewportPixelSize=function(c){c=this._viewports[c];if(null===c)return null;c=c.getSize();return this._toPixelPoint(c)};a.prototype.getViewportAnchor=function(c){c=this._viewports[c];return null===c?null:c.getAnchor()};a.prototype.setVisibility=function(c,b){this._engine.setOverlayVisibility(c,b);return Promise.resolve()};a.prototype.destroy=function(c){this._engine.destroyOverlay(c);this._viewports[c]=null;return Promise.resolve()};a.prototype.addNodes=function(c,b){b=
this._viewer.model._gatherInstanceIncsFromNodeIds(b);0<b.length&&this._engine.addNodesToOverlay(b,c);return Promise.resolve()};a.prototype.setCamera=function(c,b){this._engine.setOverlayCamera(c,b);return Promise.resolve()};a.prototype._getOverlayOffset=function(c,b){var f=this._viewer.view.getCanvasSize(),a=d.Point2.zero();if(c===d.OverlayAnchor.LowerRightCorner||c===d.OverlayAnchor.UpperRightCorner||c===d.OverlayAnchor.RightCenter)a.x=f.x-b.x;else if(c===d.OverlayAnchor.Center||c===d.OverlayAnchor.TopCenter||
c===d.OverlayAnchor.BottomCenter)a.x=.5*(f.x-b.x);if(c===d.OverlayAnchor.LowerLeftCorner||c===d.OverlayAnchor.LowerRightCorner||c===d.OverlayAnchor.BottomCenter)a.y=f.y-b.y;else if(c===d.OverlayAnchor.Center||c===d.OverlayAnchor.LeftCenter||c===d.OverlayAnchor.RightCenter)a.y=.5*(f.y-b.y);return a};a.prototype._toPixelPoint=function(c){var b=this._viewer.view.getCanvasSize(),f=d.Point2.zero(),a=!1;switch(c.xUnit){case d.OverlayUnit.Pixels:f.x=c.x;break;case d.OverlayUnit.ProportionOfCanvas:f.x=b.x*
c.x;break;case d.OverlayUnit.ProportionOfOtherDimension:a=!0}switch(c.yUnit){case d.OverlayUnit.Pixels:f.y=c.y;break;case d.OverlayUnit.ProportionOfCanvas:f.y=b.y*c.y;break;case d.OverlayUnit.ProportionOfOtherDimension:f.y=f.x*c.y}a&&(f.x=c.x*f.y);return f};a.prototype._validateUnit=function(c,b,f){if(b!==d.OverlayUnit.Pixels&&(0>c||1<c))throw new d.ParseError("value for "+f+" should be between 0.0 and 1.0 when specifying non pixel value");};return a}();d.OverlayManager=a})(Communicator||(Communicator=
{}));
(function(d){(function(d){d[d.None=0]="None";d[d.Floor=1]="Floor";d[d.Wall=2]="Wall";d[d.Door=4]="Door"})(d.BimMask||(d.BimMask={}));var h=function(){function g(a){void 0===a&&(a=d.SelectionMask.Face);this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=this.forceEffectiveVisibilityMask=d.SelectionMask.None;this.restrictLinesAndPointsToSelectedFaceInstances=this.oneEntityPerTypePerInstance=this.respectDepthRange=!0;this.restrictToOverlays=this.ignoreOverlays=this.ignoreCappingGeometry=this.enableProximityFaces=
!1;this.selectionMask=a}g.prototype.copy=function(){var a=new g;d.Internal.copyOwnProperties(this,a);return a};Object.defineProperty(g.prototype,"allowFaces",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Face)},set:function(a){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Face,a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"allowLines",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Line)},set:function(a){this.selectionMask=
d.Internal.setBit(this.selectionMask,d.SelectionMask.Line,a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"allowPoints",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Point)},set:function(a){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Point,a)},enumerable:!0,configurable:!0});return g}();d.PickConfig=h;h=function(){return function(g){void 0===g&&(g=d.SelectionMask.All);this.mustBeFullyContained=!1;this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=
this.forceEffectiveVisibilityMask=d.SelectionMask.None;this.ignoreCuttingSections=this.allowPoints=this.allowLines=this.allowFaces=!0;this.ignoreUnrequestedInstances=this.onlyStreamedInstances=!1;this.allowFaces=0!==(g&d.SelectionMask.Face);this.allowLines=0!==(g&d.SelectionMask.Line);this.allowPoints=0!==(g&d.SelectionMask.Point)}}();d.IncrementalPickConfig=h})(Communicator||(Communicator={}));var SC;
(function(d){d.UnspecifiedMeasurementUnit=0;d.isError=function(d){return"object"===typeof d&&null!==d&&!0};d.getStateFailure=function(d){d=d.data;return"object"===typeof d&&null!==d&&"scStateFailure"in d?d.scStateFailure:null}})(SC||(SC={}));
(function(d){(function(h){function g(b){return null!==b?d.Color.createFromFloatArray(b):b}function a(b){return h.mapInPlace(b,g)}var e;(function(b){b[b.Add=0]="Add";b[b.Update=1]="Update"})(e||(e={}));var c=function(){return function(b){this.promise=h.OpenPromise.create();this.ids=b}}(),b=function(){function b(b,c){this._engineReadyPromise=h.OpenPromise.create();this._sessionStartedPromise=h.OpenPromise.create();this._connectionlessEmpty=!1;this._uri="ws://localhost:9999";this._streamingMode=d.StreamingMode.Default;
this._rendererType=d.RendererType.Client;this._memoryLimit=this._meshLevel=0;this._boundingPreviewMode=d.BoundingPreviewMode.All;this._streamCutoffScale=1;this._loadFinished=!1;this._statistics=new h.StatisticMap;this._cachedElementCount=this._cachedTriangleCount=null;this._windowSize=new d.Point2(0,0);this._cuttingSectionToKeyMap=new Map;this._cappingQuantizationGranularity=-1E4;this._cappingFaceColor=d.Color.createFromFloat(.5,.5,.5);this._cappingLineColor=d.Color.createFromFloat(.5,.5,.5);this._cappingNeedsUpdate=
this._cappingGeometryVisibility=!0;this._cappingDelayTimeoutId=null;this._cappingDelay=500;this._requestBatchCountByType=[];this._pendingRequestsByType=[];this._callbackManager=b;this._applyOptions(c);for(b=0;1>b;++b)this._requestBatchCountByType.push(0),this._pendingRequestsByType.push([])}b.prototype.getNetworkModelName=function(){console.assert(1===this._sessionType);if(void 0!==this._model)return this._model;throw new d.InternalLogicError;};b.prototype.logMessage=function(b){console.log(b)};b.prototype.setTimeout=
function(b,c){return setTimeout(b,c)};b.prototype.sleep=function(b){return d.Util.sleep(b)};b.prototype.getScsInfo=function(){console.assert(2===this._sessionType);return void 0!==this._buffer?this._buffer:/^wss?:\/\//i.test(this._uri)?null:this._uri};b.prototype._applyOptions=function(b){void 0!==b.empty&&(this._connectionlessEmpty=b.empty);void 0!==b.endpointUri&&(this._uri=b.endpointUri);b.model&&(this._model=b.model);void 0!==b.sessionToken&&(this._sessionToken=b.sessionToken);void 0!==b.buffer&&
(this._buffer=b.buffer);void 0!==b.streamingMode&&(this._streamingMode=b.streamingMode);void 0!==b.rendererType&&(this._rendererType=b.rendererType);void 0!==b.defaultMeshLevel&&(this._meshLevel=b.defaultMeshLevel);void 0!==b.memoryLimit&&(this._memoryLimit=b.memoryLimit);void 0!==b.boundingPreviewMode&&(this._boundingPreviewMode=b.boundingPreviewMode);void 0!==b.streamCutoffScale&&this._setStreamCutoffScale(b.streamCutoffScale)};b.prototype.start=function(b,c){var a=this;this._canvasContainer=b;
this._initOptions=c;_SC.createInstance({container:b,onReady:function(b){a._onEngineReady(b)},onError:function(b){a._callbackManager.trigger("modelLoadFailure",a._model||"","failed to load engine: "+b)},enginePath:c.enginePath});return!0};b.prototype.setPickTolerance=function(b){this._scSelectionManager.setPickTolerance(b)};b.prototype.getPickTolerance=function(){return this._scSelectionManager.getPickTolerance()};b.prototype._onEngineReady=function(b){var c=this;this._sc=b;this._sessionType=0;this._matrixCache=
new h.ScMatrixCache(this);this._scSelectionManager=new h.ScSelectionManager(this._sc);this.resize();this._callbackManager.bind({_firstBoundingReady:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){this._regenerateCapping();return[2]})})}});this._sc.setEventHandler("session_started",function(){var b=function(){c._callbackManager.unbind(a);return c._sessionStartedPromise},a={_sessionStarted:function(){return c._onSessionStarted()},_assemblyTreeReady:b,_modelSwitched:b};
c._callbackManager.bind(a);c._sessionStartedPromise.resolve(c._callbackManager.promiseTrigger("_sessionStarted",null))});this._sc.setEventHandler("announce_model",function(b,a,f){c._callbackManager.trigger("_announceModel",a,f)});this._sc.setEventHandler("first_instance",function(){c._callbackManager.trigger("_firstInstance")});this._sc.setEventHandler("inclusion",function(b,a,f,d){c._callbackManager.trigger("_inclusion",a,f,d)});this._sc.setEventHandler("remap_model",function(b,a,f,d){c._callbackManager.trigger("_remapModel",
a,f,d)});this._sc.setEventHandler("remap_inclusion",function(b,a,f,d,k){c._callbackManager.trigger("_remapInclusion",a,f,d,k)});this._sc.setEventHandler("capping_idle",function(b,a,f){c._callbackManager.trigger("cappingIdle",a,f)});this._sc.setEventHandler("stream_active",this._initOptions.streamingActivated);this._sc.setEventHandler("stream_idle",this._initOptions.streamingDeactivated);this._sc.setEventHandler("open_model_failed",function(b,a){switch(a.reason){case "UNKNOWN_MODEL":b="Unknown model";
break;case "BAD_NETWORK_VERSION":b="Client/Server network version mismatch";break;case "BAD_STREAM_VERSION":case "BAD_STORE_VERSION":b="Unsupported file version";break;default:b="Internal Error"}c._callbackManager.trigger("modelLoadFailure",c._model||"",b)});this._sc.setEventHandler("missing_model",function(b,a,f){c._callbackManager.trigger("_missingModel",a,f);c._callbackManager.trigger("missingModel",f)});this._sc.setEventHandler("bad_data",function(b,a){switch(a.type){case "TRUNCATED_BLOCK":b=
"Failed to parse truncated data block.";break;case "ZFRAME_DECOMPRESS_FAILED":b="Failed to decompress data.";break;case "UNMATCHED_CODE":b="Unknown opcode.";break;case "STORE_VERSION_MISMATCHED":b="Store version mismatched. Expected='"+(a.expected+"'.");b+=" Actual='"+a.actual+"'.";break;case "STREAM_VERSION_MISMATCHED":b="Stream version mismatched. Expected='"+(a.expected+"'.");b+=" Actual='"+a.actual+"'.";break;case "PARSE_BOUNDING_TREE_FAILED":b="Failed to parse bounding tree.";break;default:b=
"Unknown error."}c._callbackManager.trigger("modelLoadFailure",c._model||"",b)});this._sc.setEventHandler("socket_open_failed",function(){c._callbackManager.trigger("modelLoadFailure",c._model||"","WebSocket connection failed.")});this._sc.setEventHandler("post_draw",function(b,a,f,d){c._syncedCamera=f;c._statistics=a;c._initOptions.renderComplete();c._fillStatTotalCounts();b=c._fromScCamera(f);c._callbackManager.trigger("frameDrawn",b,d)});this._sc.setEventHandler("priority_meta_data_sent",function(b,
a,f){c._initOptions.priorityMetaDataSent(a,f)});this.setAllowHighDpi(!0);this._sc.setEventHandler("meta_data",function(b,a,f,d){0>a&&(a+=4294967296);c._callbackManager.trigger("_metaData",a,f,d)});this._sc.setEventHandler("draw_complete",function(){c._callbackManager.trigger("_drawComplete")});this._sc.setEventHandler("webgl_context_lost",function(){c._callbackManager.trigger("webGlContextLost")});this._sc.setEventHandler("websocket_connection_closed",function(){c._callbackManager.trigger("websocketConnectionClosed")});
this._initOptions.engineReady(this._sessionStartedPromise);this._engineReadyPromise.resolve()};b.prototype.loadFinished=function(){return this._loadFinished};b.prototype.resetCachedStatistics=function(){this._cachedTriangleCount=this._cachedElementCount=null};b.prototype.setAmbientOcclusionEnabled=function(b){this._sc.setAmbientOcclusionEnabled(b)};b.prototype.setAmbientOcclusionRadius=function(b){this._sc.setAmbientOcclusionRadius(b)};b.prototype.setLightingEnabled=function(b){this._sc.setLightingEnabled(b)};
b.prototype._fillStatTotalCounts=function(){null!==this._cachedElementCount&&null!==this._cachedTriangleCount&&(this._statistics.total_element_count=this._cachedElementCount,this._statistics.total_triangle_count=this._cachedTriangleCount)};b.prototype._updateCachedStats=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a;return __generator(this,function(f){switch(f.label){case 0:return b=this._sc.getElementCount(),c=this._sc.getTriangleCount(),[4,Promise.all([b,c])];case 1:return a=
f.sent(),this._cachedElementCount=a[0],this._cachedTriangleCount=a[1],this._fillStatTotalCounts(),[2]}})})};b.prototype._toVector3=function(b){var c=[0,0,0];b.toArray(c);return c};b.prototype.startExplode=function(b,c){this.delayCapping();this._sc.startExplode(b,this._toVector3(c))};b.prototype.setExplodeMagnitude=function(b){this._callbackManager.trigger("explode",b);this.delayCapping();this._sc.explode(b)};b.prototype.stopExplode=function(){this.delayCapping();this._sc.resetExplode()};b.prototype.getStatistics=
function(b){void 0===b&&(b=!1);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return!b||this.loadFinished()?[3,2]:[4,this._updateCachedStats()];case 1:return c.sent(),this._fillStatTotalCounts(),[2,this._statistics];case 2:return this.loadFinished()&&null===this._cachedTriangleCount?[4,this._updateCachedStats()]:[3,4];case 3:return c.sent(),this._fillStatTotalCounts(),[2,this._statistics];case 4:return this._fillStatTotalCounts(),[2,this._statistics]}})})};
b.prototype.setStreamIdleMarker=function(){return this._sc.setStreamIdleMarker()};b.prototype.hasDepthRange=function(b){return this._sc.MeshInstance.hasDepthRange(b)};b.prototype.setDepthRange=function(b,c,a){this._sc.MeshInstance.setDepthRange(b,c,a)};b.prototype.unsetDepthRange=function(b){this._sc.MeshInstance.unsetDepthRange(b)};b.prototype.setDefaultDepthRange=function(b,c){this._sc.setDefaultDepthRange(b,c)};b.prototype._getScPlaneArray=function(b){for(var c=[],a=0;a<b.getCount();a++){var f=
b.getPlane(a);if(null!==f){var d=[];f.normal.toArray(d);d[3]=f.d;c.push(d)}}return c};b.prototype.getCuttingSectionLimits=function(){return this._sc.cuttingSectionLimits()};b.prototype._addCuttingSection=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,k;return __generator(this,function(l){switch(l.label){case 0:return a=4294967295,f=this._getScPlaneArray(b),0<f.length?[4,this._sc.addCuttingSection(f)]:[3,2];case 1:a=l.sent();if(4294967295===a)throw k=c===e.Add?"add":"update",
new d.CommunicatorError("Failed to "+k+" cutting section.");l.label=2;case 2:return this._cuttingSectionToKeyMap.set(b,a),c===e.Add&&this._callbackManager.trigger("addCuttingSection",b),[2]}})})};b.prototype.addCuttingSection=function(b){return this._addCuttingSection(b,e.Add)};b.prototype.removeCuttingSection=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=this._cuttingSectionToKeyMap.get(b);if(void 0===c)return console.assert(!1),[2];this._cuttingSectionToKeyMap.delete(b);
this._callbackManager.trigger("removeCuttingSection");return 4294967295===c?[2]:[2,this._sc.removeCuttingSections([c])]})})};b.prototype.removeAllCuttingSections=function(){this._cuttingSectionToKeyMap.clear();this._callbackManager.trigger("removeCuttingSection");return this._sc.removeAllCuttingSections()};b.prototype.updateCuttingSection=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(f){c=this._cuttingSectionToKeyMap.get(b);if(void 0===c)return console.assert(!1),
[2];if(4294967295===c)return[2,this._addCuttingSection(b,e.Update)];a=this._getScPlaneArray(b);return[2,this._sc.replaceCuttingSection(a,c)]})})};b.prototype.setCappingDelay=function(b){this._cappingDelay=b};b.prototype.enableCappingIdleCallback=function(b){return this._sc.setCappingIdleHookEnabled(b)};b.prototype.getCappedInstances=function(){return this._sc.getCappedInstances()};b.prototype.delayCapping=function(){var b=this;null===this._cappingDelayTimeoutId?this._sc.pauseCapping():clearTimeout(this._cappingDelayTimeoutId);
this._cappingDelayTimeoutId=setTimeout(function(){b._cappingDelayTimeoutId=null;b._sc.resumeCapping()},this._cappingDelay)};b.prototype.setCappingGeometryVisibility=function(b){if(this._cappingGeometryVisibility!==b||this._cappingNeedsUpdate)if(null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=null),this._cappingNeedsUpdate=!1,this._cappingGeometryVisibility=b){b=null!==this._cappingLineColor?this._toRgba(this._cappingLineColor,1):[-1,-1,-1,
-1];var c=null!==this._cappingFaceColor?this._toRgba(this._cappingFaceColor,1):[-1,-1,-1,-1];this._sc.enableCapping(b,c,this._cappingQuantizationGranularity)}else this._sc.disableCapping()};b.prototype._regenerateCapping=function(){this._cappingNeedsUpdate=!0;this.setCappingGeometryVisibility(this._cappingGeometryVisibility)};b.prototype.getCappingGeometryVisibility=function(){return this._cappingGeometryVisibility};b.prototype._toRgb=function(b){var c=[0,0,0];b.toFloatArray(c);return c};b.prototype._toRgba=
function(b,c){c=[0,0,0,c];b.toFloatArray(c);return c};b.prototype.setCappingFaceColor=function(b){null===b&&null===this._cappingFaceColor||null!==b&&null!==this._cappingFaceColor&&b.equals(this._cappingFaceColor)||(this._cappingFaceColor=null!==b?b.copy():null,this._regenerateCapping())};b.prototype.setCappingLineColor=function(b){null===b&&null===this._cappingLineColor||null!==b&&null!==this._cappingLineColor&&b.equals(this._cappingLineColor)||(this._cappingLineColor=null!==b?b.copy():null,this._regenerateCapping())};
b.prototype._onSessionStarted=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this._sc.suspendDrawing(),this._sc.setDrawMode(1),this._sc.setHighlightedInstanceFilter(3),this._sc.setUnhighlightedFilter(0),this._sc.setHighlightMode(1),this._sc.setAntiAliasingMode(1),b=[],b.push(this._matrixCache.init()),this._regenerateCapping(),[4,Promise.all(b)];case 1:return c.sent(),this._initOptions.sceneReady(),this._sc.resumeDrawing(),
[2]}})})};b.prototype.isInit=function(){return void 0!==this._sc};b.prototype.setRemoteEndpoint=function(b,c){this._uri=b;this._model=c};b.prototype.getSessionType=function(){return this._sessionType};b.prototype._awaitEmptyLoad=function(){var b=this,c=h.OpenPromise.create(),a={_attached:function(f){b._callbackManager.unbind(a);0===f?c.resolve():c.reject(new d.InternalLogicError)}};this._callbackManager.bind(a);return c};b.prototype.loadEmpty=function(){return __awaiter(this,void 0,void 0,function(){var b;
return __generator(this,function(c){switch(c.label){case 0:return[4,this._engineReadyPromise];case 1:c.sent();try{if(0!==this._sessionType)throw new d.LoadError("Incompatible load types.");b=this._awaitEmptyLoad();this._sessionType=this._connectionlessEmpty||void 0!==this._buffer||void 0===this._model?this._loadEmptyScs():this._loadEmptyNetwork();return[2,b]}catch(n){throw this._callbackManager.trigger("modelLoadFailure",this._model||"",n.message),n;}}})})};b.prototype._loadEmpty=function(b){var c=
this;console.assert(void 0===b.XHRonprogress);console.assert(void 0===b.XHRonerror);console.assert(void 0===b.XHRonloadend);b.XHRonprogress=function(b){c._callbackManager.trigger("XHRonprogress",b)};b.XHRonerror=function(b){c._callbackManager.trigger("XHRonerror",b)};b.XHRonloadend=function(b,a,f){c._callbackManager.trigger("XHRonloadend",b,a,f)};return this._sc.load(b)};b.prototype._loadEmptyScs=function(){console.assert(void 0===this._model);var b={empty:!0};this._streamingMode===d.StreamingMode.OnDemand&&
(b.streamInstancesOnDemand=!0);return this._loadEmpty(b)};b.prototype._loadEmptyNetwork=function(){console.assert(void 0!==this._model);var b={model:d.EmptyModelName,uri:this._uri,serverSideRendering:this._rendererType===d.RendererType.Server,meshLevel:this._meshLevel,streamCutoffScale:this._streamCutoffScale};void 0!==this._sessionToken&&(b.sessionToken=this._sessionToken);0<this._memoryLimit&&(b.limitMiB=this._memoryLimit);(this._boundingPreviewMode&d.BoundingPreviewMode.Model)===d.BoundingPreviewMode.Model&&
(b.streamModelBoundingPreviews=!0);(this._boundingPreviewMode&d.BoundingPreviewMode.Instance)===d.BoundingPreviewMode.Instance&&(b.streamInstanceBoundingPreviews=!0);(this._boundingPreviewMode&d.BoundingPreviewMode.Ejected)===d.BoundingPreviewMode.Ejected&&(b.streamEjectedBoundingPreviews=!0);switch(this._streamingMode){case d.StreamingMode.OnDemand:b.streamInstancesOnDemand=!0;break;case d.StreamingMode.All:b.streamCulled=!0,b.streamMetaDataOnIdle=!0}return this._loadEmpty(b)};b.prototype.setProjection=
function(b){var c=this.getCamera();c.getProjection()!==b&&(c.setProjection(b),this.setCamera(c))};b.prototype.getViewMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return d.Matrix.createFromArray(b.viewMatrix())};b.prototype.getProjectionMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return d.Matrix.createFromArray(b.projectionMatrix())};b.prototype.getFullCameraMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return d.Matrix.createFromArray(b.fullMatrix())};
b.prototype.getSynchedViewMatrix=function(){return this._syncedCamera?d.Matrix.createFromArray(this._syncedCamera.viewMatrix()):new d.Matrix};b.prototype.getSynchedProjectionMatrix=function(){return this._syncedCamera?d.Matrix.createFromArray(this._syncedCamera.projectionMatrix()):new d.Matrix};b.prototype.getPrimaryModelKey=function(){return this._sc.primaryModelKey()};b.prototype.getPartsBounding=function(b,c,a){return this.getBounding(b,c,!1,a)};b.prototype.getDrawnPartsBounding=function(b){return __awaiter(this,
void 0,void 0,function(){var c,a;return __generator(this,function(f){switch(f.label){case 0:return[4,this._sc.MeshInstance.getDrawnWorldSpaceBounding(b)];case 1:return c=f.sent(),a=new d.Box,a.min.fromArray(c.min),a.max.fromArray(c.max),[2,a]}})})};b.prototype.getBounding=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var k,e;return __generator(this,function(l){switch(l.label){case 0:return[4,this._sc.MeshInstance.getWorldSpaceBounding(b,c,a,f)];case 1:return k=l.sent(),e=new d.Box,
e.min.fromArray(k.min),e.max.fromArray(k.max),[2,e]}})})};b.prototype.getLooseBounding=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._sc.getLooseBounding()];case 1:return b=a.sent(),c=new d.Box,c.min.fromArray(b.min),c.max.fromArray(b.max),[2,c]}})})};b.prototype.getClientDimensions=function(){var b=this._sc.container;return[b.clientWidth,b.clientHeight]};b.prototype.getModelBounding=function(b,c,a){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(f){return[2,this.getBounding([],b,c,a)]})})};b.prototype.pickFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.pickFromScreen(b,c,a)]})})};b.prototype.pickAllFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.pickAllFromScreen(b,c,a)]})})};b.prototype.compositePickFromScreen=
function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.compositePickFromScreen(b,c,a)]})})};b.prototype.beginScreenAreaSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.beginScreenAreaSelection(b,c,a)]})})};b.prototype.beginRayDrillSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,
this._scSelectionManager.beginRayDrillSelection(b,c,a)]})})};b.prototype.beginConvexPolyhedronSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.beginConvexPolyhedronSelection(b,c,a)]})})};b.prototype.beginSphereSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.beginSphereSelection(b,c,a)]})})};b.prototype.endIncrementalSelection=
function(b){this._scSelectionManager.endIncrementalSelection(b)};b.prototype.advanceIncrementalSelection=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._scSelectionManager.advanceIncrementalSelection(b,!1)]})})};b.prototype.flushMetaDataCache=function(){this._sc.flushMetaDataCache()};b.prototype.safeGetMetaDatas=function(b,c){for(var a=[],f=0;f<c.length;f++)a.push(b,c[f]);return this.getDataFromIds(a).then(h.identity,function(){return null})};
b.prototype.safeGetMetaData=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:return[4,this.safeGetMetaDatas(b,[c])];case 1:return a=f.sent(),null!==a?[2,a[0]]:[2,null]}})})};b.prototype.safeLoadMetaDatas=function(b){return this.getDataFromIds(b).then(h.nop,h.nop)};b.prototype.getDataFromIds=function(b){if(0===this._requestBatchCountByType[0])return this._getDataFromIds(b);b=new c(b);this._pendingRequestsByType[0].push(b);
return b.promise};b.prototype._getDataFromIds=function(b){return this._sc.getMetaData(b)};b.prototype.pickFromRay=function(b,c){return this._scSelectionManager.pickFromRay(b,c)};b.prototype.pickAllFromRay=function(b,c){return this._scSelectionManager.pickAllFromRay(b,c)};b.prototype.updateCamera=function(b){var c=b._getFlags(),a=this._sc.getCamera();(c&h.CameraFlags.Position)===h.CameraFlags.Position&&a.setPosition(this._toVector3(b.getPosition()));(c&h.CameraFlags.Target)===h.CameraFlags.Target&&
a.setTarget(this._toVector3(b.getTarget()));(c&h.CameraFlags.Up)===h.CameraFlags.Up&&a.setUpVector(this._toVector3(b.getUp()));this._setCamera(a);return this.getCamera()};b.prototype._toProjection=function(b){switch(b){default:case d.Projection.Orthographic:return 1;case d.Projection.Perspective:return 0}};b.prototype._toCamera=function(b){var c=this._sc.getCamera();c.reset(this._toProjection(b.getProjection()),this._toVector3(b.getPosition()),this._toVector3(b.getTarget()),this._toVector3(b.getUp()),
b.getWidth(),b.getHeight());c.setNearLimit(b.getNearLimit());return c};b.prototype.setCamera=function(b){b=this._toCamera(b);this._setCamera(b)};b.prototype._setCamera=function(b){this.delayCapping();this._sc.setCamera(b)};b.prototype.markCameraAsEmpty=function(){this._sc.markCameraAsEmpty()};b.prototype.setInstancesMatrix=function(b,c){this._sc.MeshInstance.setAnonymousMatrix(b,c.m)};b.prototype.setMatrices=function(b,c){for(var a=[],f=0;f<c.length;f++)a.push.apply(a,c[f].m);this._sc.MeshInstance.setAnonymousMatrices(b,
a)};b.prototype.highlightParts=function(b,c){this._sc.MeshInstance.setHighlighted(b,c);this._sc.MeshInstance.setXRay(b,c)};b.prototype.highlightElements=function(b,c,a,f,d){c=this._toElementType(c);this._sc.MeshInstance.setElementHighlighted(b,c,a,f,d);this._sc.MeshInstance.setElementXRay(b,c,a,f,d)};b.prototype.getPartHighlighted=function(b){return this._sc.MeshInstance.getHighlighted(b)};b.prototype.getElementHighlighted=function(b,c,a){return this._sc.MeshInstance.getElementHighlighted(b,this._toElementType(c),
a)};b.prototype.setNodeHighlightColor=function(b,c){b?(this._sc.setHighlightedInstanceFilter(3),b=this._toRgba(b,1),this._sc.setHiddenLineHighlightedInstanceFillColor(b),this._sc.setHighlightedInstanceColor(b)):this._sc.setHighlightedInstanceFilter(0);b=c?this._toRgba(c,1):[0,0,0,0];this._sc.setHiddenLineHighlightedInstanceOutlineColor(b);this._sc.setHighlightedInstanceOutlineColor(b)};b.prototype.setElementHighlightColor=function(b,c){b?(this._sc.setHighlightedElementFilter(3),b=this._toRgba(b,1),
this._sc.setHighlightedElementColor(b),this._sc.setHiddenLineHighlightedElementFillColor(b)):this._sc.setHighlightedElementFilter(0);b=c?this._toRgba(c,1):[0,0,0,0];this._sc.setHighlightedElementOutlineColor(b);this._sc.setHiddenLineHighlightedElementOutlineColor(b)};b.prototype.setHighlightColorizeCompression=function(b){this._sc.setHighlightColorizeCompression(b)};b.prototype.computeMinimumBodyBodyDistance=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,
function(f){switch(f.label){case 0:if(2!==b.length||2!==c.length)throw new d.CommunicatorError("Invalid instance inc.");return[4,this._sc.MeshInstance.computeMinimalBodyBodyDistance(b,c)];case 1:return a=f.sent(),[2,h.makeFaceFaceDistanceItem(a)]}})})};b.prototype.computeMininimumFaceFaceDistance=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var k;return __generator(this,function(e){switch(e.label){case 0:if(2!==b.length||2!==a.length)throw new d.CommunicatorError("Invalid instance inc.");
return[4,this._sc.MeshInstance.computeMinimalFaceFaceDistance(b,c,a,f)];case 1:return k=e.sent(),[2,h.makeFaceFaceDistanceItem(k)]}})})};b.prototype.computeMinimumFaceRayDistance=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(e){switch(e.label){case 0:if(2!==b.length)throw new d.CommunicatorError("Invalid instance inc.");f=h.toScRay(a);return[4,this._sc.MeshInstance.computeMinimalFaceRayDistance(b,c,f)];case 1:return k=e.sent(),[2,h.makeFaceFaceDistanceItem(k)]}})})};
b.prototype.computeMinimumFaceLineDistance=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(e){switch(e.label){case 0:if(2!==b.length)throw new d.CommunicatorError("Invalid instance inc.");f=h.toScRay(a);return[4,this._sc.MeshInstance.computeMinimalFaceLineDistance(b,c,f)];case 1:return k=e.sent(),[2,h.makeFaceFaceDistanceItem(k)]}})})};b.prototype.pauseRendering=function(b){this._sc.suspendDrawing();if("function"===typeof b)try{b()}finally{this._sc.resumeDrawing()}};
b.prototype.resumeRendering=function(){this._sc.resumeDrawing()};b.prototype.beginRequestBatch=function(b){++this._requestBatchCountByType[b]};b.prototype.endRequestBatch=function(b){0<this._requestBatchCountByType[b]&&--this._requestBatchCountByType[b];this._flushBatchedRequests(b)};b.prototype._flushBatchedRequests=function(b){var c=this._pendingRequestsByType[b];this._pendingRequestsByType[b]=[];for(var a=[],f=0;f<c.length;f++)for(var k=0,e=c[f].ids;k<e.length;k++)a.push(e[k]);switch(b){case 0:return this._flushBatchedMetaDataRequests(c,
a);default:return d.Util.TypeAssert(b),console.assert(!1),Promise.resolve()}};b.prototype._flushBatchedMetaDataRequests=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,d,k,e,l,g,h,v;return __generator(this,function(n){switch(n.label){case 0:return[4,this._getDataFromIds(c)];case 1:a=n.sent();d=f=0;for(k=b;d<k.length;d++){e=k[d];l=[];g=e.ids.length/2;for(h=0;h<g;++h)v=a[f++],l.push(v);e.promise.resolve(l)}console.assert(f===a.length);return[2]}})})};b.prototype.clearHighlight=
function(){this._sc.unsetAllHighlighted();this._sc.unsetAllXRay()};b.prototype.resetColors=function(){this._sc.unsetAllColors()};b.prototype.resetOpacity=function(){this._sc.unsetAllOpacity()};b.prototype.setPartOpacity=function(b,c){var a=this;this.pauseRendering(function(){a._sc.MeshInstance.setOpacity(b,0,c);a._sc.MeshInstance.setOpacity(b,1,c);a._sc.MeshInstance.setOpacity(b,2,c)})};b.prototype.unsetPartOpacity=function(b){var c=this;this.pauseRendering(function(){c._sc.MeshInstance.unsetOpacity(b,
0);c._sc.MeshInstance.unsetOpacity(b,1);c._sc.MeshInstance.unsetOpacity(b,2)})};b.prototype.getPartOpacity=function(b){return this._sc.MeshInstance.getOpacity(b,0)};b.prototype.getEffectivePartOpacity=function(b,c){return this._sc.MeshInstance.getEffectiveOpacity(b,this._toElementType(c))};b.prototype.getPartHasTransparency=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f,d,k,e;return __generator(this,function(l){switch(l.label){case 0:return c=[],c.push(this._sc.MeshInstance.hasTransparency(b,
0)),c.push(this._sc.MeshInstance.hasTransparency(b,1)),c.push(this._sc.MeshInstance.hasTransparency(b,2)),[4,Promise.all(c)];case 1:a=l.sent();f=a[0];d=a[1];k=a[2];for(e=0;e<f.length;++e)f[e]||(f[e]=d[e]||k[e]);return[2,f]}})})};b.prototype.setPartColor=function(b,c,a){this._sc.MeshInstance.setColor(b,this._toElementType(c),a.getFloatArray())};b.prototype.unsetPartColor=function(b,c){this._sc.MeshInstance.unsetColor(b,this._toElementType(c))};b.prototype.getPartColor=function(b,c){return this._sc.MeshInstance.getColor(b,
this._toElementType(c)).then(a)};b.prototype.getEffectivePartColor=function(b,c){return __awaiter(this,void 0,void 0,function(){var f,d;return __generator(this,function(k){switch(k.label){case 0:return f=this._toElementType(c),[4,this._sc.MeshInstance.getEffectiveColor(b,f)];case 1:return d=k.sent(),[2,a(d)]}})})};b.prototype.setPartAmbientColor=function(b,c,a){this._sc.MeshInstance.setAmbientColor(b,this._toElementType(c),a.getFloatArray())};b.prototype.setPartAmbientMix=function(b,c,a){this._sc.MeshInstance.setAmbientMix(b,
this._toElementType(c),a)};b.prototype.setPartEmissiveColor=function(b,c,a){this._sc.MeshInstance.setEmissiveColor(b,this._toElementType(c),a.getFloatArray())};b.prototype.unsetPartEmissiveColor=function(b,c){this._sc.MeshInstance.unsetEmissiveColor(b,this._toElementType(c))};b.prototype.setPartSpecularColor=function(b,c,a){this._sc.MeshInstance.setSpecularColor(b,this._toElementType(c),a.getFloatArray())};b.prototype.unsetPartSpecularColor=function(b,c){this._sc.MeshInstance.unsetSpecularColor(b,
this._toElementType(c))};b.prototype.setPartSpecularIntensity=function(b,c,a){this._sc.MeshInstance.setSpecularIntensity(b,this._toElementType(c),a)};b.prototype.unsetPartSpecularIntensity=function(b,c){this._sc.MeshInstance.unsetSpecularIntensity(b,this._toElementType(c))};b.prototype.setElementColor=function(b,c,a,f,d){this._sc.MeshInstance.setElementColor(b,this._toElementType(c),a,f,d.getFloatArray())};b.prototype.unsetElementColor=function(b,c,a,f){this._sc.MeshInstance.unsetElementColor(b,this._toElementType(c),
a,f)};b.prototype.getElementColor=function(b,c,f){return this._sc.MeshInstance.getElementColor(b,this._toElementType(c),f).then(a)};b.prototype.getEffectiveElementColor=function(b,c,f){return __awaiter(this,void 0,void 0,function(){var d,k;return __generator(this,function(e){switch(e.label){case 0:return d=this._toElementType(c),[4,this._sc.MeshInstance.getEffectiveElementColor(b,d,f)];case 1:return k=e.sent(),[2,a(k)]}})})};b.prototype.synchronizeVisibilities=function(b,c){0<b.length&&this._sc.MeshInstance.synchronizeVisibilities(b,
c)};b.prototype.setPartVisibility=function(b,c,a){0<b.length&&this._sc.MeshInstance.setVisible(b,c,a)};b.prototype.setElementVisibility=function(b,c,a,f,d){0<b.length&&this._sc.MeshInstance.setElementVisible(b,this._toElementType(c),a,f,d)};b.prototype.clearElementVisibility=function(b,c){0<b.length&&this._sc.MeshInstance.clearElementVisible(b,this._toElementType(c))};b.prototype.setVisibilityByAttachment=function(b,c){this._sc.setVisibilityByAttachment(b,c)};b.prototype.requestMeshInstances=function(b){this._sc.demandMeshInstances(b)};
b.prototype.getRendererType=function(){return this._rendererType};b.prototype._toMeshDataBuilder=function(b){for(var c=b._getFaceData(),a=b._getPointData(),f=b._getPolylineData(),k=new this._sc.MeshDataBuilder,e=0;e<c.length;e++){var g=c[e];k.addFace(g.vertexData,{normals:g.normalData,rgba32s:g.rgba32data,uvs:g.uvData,bits:g.bits})}for(c=0;c<a.length;c++)g=a[c],k.addPoints(g.vertexData,{rgba32s:g.rgba32data,bits:g.bits});for(a=0;a<f.length;a++)g=f[a],k.addPolyline(g.vertexData,{rgba32s:g.rgba32data,
bits:g.bits});switch(b.getFaceWinding()){case d.FaceWinding.Clockwise:f=1;break;case d.FaceWinding.CounterClockwise:f=2;break;default:f=0}g=b.getBackfacesEnabled()?4:0;b=b.isManifold()?65536:0;k.formatBits=k.formatBits|f|g|b;return k};b.prototype.createMesh=function(b){b=this._toMeshDataBuilder(b);return this._sc.MeshData.create(b)};b.prototype.replaceMesh=function(b,c){c=this._toMeshDataBuilder(c);return this._sc.MeshData.replace(b,c)};b.prototype.destroyMeshes=function(b){return this._sc.MeshData.destroy(b)};
b.prototype._toImageFormat=function(b){switch(b){case d.ImageFormat.Gray8:return 2;case d.ImageFormat.GrayAlpha16:return 3;case d.ImageFormat.Rgb24:return 1;case d.ImageFormat.Rgba32:return 0;case d.ImageFormat.Jpeg:return 4;case d.ImageFormat.Png:return 5}};b.prototype._validateImage=function(b){if(void 0===b.format)throw new d.ParseError("missing 'format' property");if(void 0===b.data)throw new d.ParseError("missing 'data' property");if((b.format===d.ImageFormat.Gray8||b.format===d.ImageFormat.GrayAlpha16||
b.format===d.ImageFormat.Rgb24||b.format===d.ImageFormat.Rgba32)&&(void 0===b.width||0>=b.width||void 0===b.height||0>=b.height))throw new d.ParseError("uncompressed format requested but missing width or height");};b.prototype._pngImageHasAlpha=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f,d,k,e;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,new Promise(function(c,a){var f=new Image;f.onload=function(){c(f)};f.onerror=function(){a()};
f.src="data:image/png;base64, "+h.arrayBufferToBase64(b)})];case 1:return c=l.sent(),[3,3];case 2:return l.sent(),console.warn("Unable to read PNG image to check alpha component. Will be considered with alpha."),[2,!0];case 3:a=document.createElement("canvas");f=a.getContext("2d");if(null===f)return console.warn("Unable to create 2d context to check alpha component. Will be considered with alpha."),[2,!0];a.width=c.width;a.height=c.height;f.drawImage(c,0,0);d=f.getImageData(0,0,c.width,c.height);
k=d.data;for(e=0;e<k.length;e+=4)if(255>k[e+3])return[2,!0];return[2,!1]}})})};b.prototype.createImage=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f;return __generator(this,function(k){switch(k.label){case 0:return this._validateImage(b),a=!1,b.format!==d.ImageFormat.Png?[3,2]:[4,this._pngImageHasAlpha(b.data)];case 1:a=k.sent(),k.label=2;case 2:if(void 0===c)return[3,5];this._validateImage(c);f=!1;return c.format!==d.ImageFormat.Png?[3,4]:[4,this._pngImageHasAlpha(c.data)];
case 3:f=k.sent(),k.label=4;case 4:return[2,this._sc.Image.create(this._toImageFormat(b.format),b.data,a,b.width,b.height,this._toImageFormat(c.format),c.data,f,c.width,c.height)];case 5:return[2,this._sc.Image.create(this._toImageFormat(b.format),b.data,a,b.width,b.height)]}})})};b.prototype.destroyImages=function(b){return this._sc.Image.destroy(b)};b.prototype._toTextureTiling=function(b){switch(b){default:case d.TextureTiling.Repeat:return 0;case d.TextureTiling.Clamp:return 1}};b.prototype._toTextureInterpolation=
function(b){return!1===b?1:0};b.prototype._toTextureMipMapping=function(b){return!1===b?1:0};b.prototype._toTextureParameterization=function(b){switch(b){default:case d.TextureParameterization.UV:return 0}};b.prototype._toTextureModifier=function(b){switch(b){default:case 0:return 0;case d.TextureModifier.Decal:return 1}};b.prototype.setTexture=function(b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(void 0===c.imageId)throw new d.ParseError("missing 'imageId' property");
return[2,this._sc.MeshInstance.setTexture(b,0,c.imageId,void 0!==c.matrix?c.matrix.m:(new d.Matrix).m,this._toTextureTiling(c.tiling),this._toTextureInterpolation(c.interpolation),this._toTextureMipMapping(c.mipMapping),this._toTextureParameterization(c.parameterization),this._toTextureModifier(c.modifiers))]})})};b.prototype.unsetTexture=function(b){this._sc.MeshInstance.unsetTexture(b,0)};b.prototype.createMatrix=function(b){return this._sc.Matrix.create(b)};b.prototype.createIdentityMatrix=function(){return this._sc.Matrix.create()};
b.prototype.createMeshInstance=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f,k,e,g,h,u,w,v;return __generator(this,function(l){switch(l.label){case 0:c=b.getMeshId();if(null===c)throw new d.CommunicatorError("MeshId is not set");a=this._matrixCache.getIdentityInc();f=[];if(k=b.getMatrix())e=this.createMatrix(k.m).then(function(b){a=b}),f.push(e);g=new d.Color(255,0,0);h=this._toRgba(b.getFaceColor()||g,b.getOpacity());u=this._toRgba(b.getLineColor()||g,b.getLineOpacity());w=
this._toRgba(b.getPointColor()||g,b.getPointOpacity());return[4,Promise.all(f)];case 1:return l.sent(),[4,this._sc.MeshInstance.create(c,a,h,u,w,b.getCreationFlags(),b.getOverlayIndex())];case 2:return v=l.sent(),this._callbackManager.trigger("_geometryCreated",v),[2,v]}})})};b.prototype.destroyLocalInstances=function(b){return this._sc.MeshInstance.destroy(b)};b.prototype._fromScCamera=function(b){var c=d.Projection.Orthographic;0===b.projection()&&(c=d.Projection.Perspective);return d.Camera.create(d.Point3.createFromArray(b.position()),
d.Point3.createFromArray(b.target()),d.Point3.createFromArray(b.upVector()),c,b.fieldWidth(),b.fieldHeight(),b.nearLimit())};b.prototype.getCameraPromise=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sc.getCameraPromise()];case 1:return b=c.sent(),[2,this._fromScCamera(b)]}})})};b.prototype.getCamera=function(){var b=this._sc.getCamera();return this._fromScCamera(b)};b.prototype.resize=function(){this._sc.onResize();
this._windowSize.set(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight)};b.prototype.setFaceVisibility=function(b){this._sc.setFacesVisible(b)};b.prototype.setLineVisibility=function(b){this._sc.setLinesVisible(b)};b.prototype.getCanvasSize=function(){return this._windowSize.copy()};b.prototype.setBackgroundGradient=function(b,c){this._sc.setBackgroundGradient(b?this._toRgba(b,1):[0,0,0,0],c?this._toRgba(c,1):[0,0,0,0])};b.prototype.setBoundingPreviewUnderDrawColor=function(b){this._sc.setBoundingPreviewUnderdrawColor(this._toRgba(b,
.7))};b.prototype.setBoundingPreviewTestedColor=function(b){this._sc.setBoundingPreviewTestedColor(this._toRgba(b,.7))};b.prototype.setBoundingPreviewEjectedColor=function(b){this._sc.setBoundingPreviewEjectedColor(this._toRgba(b,.7))};b.prototype.setBoundingPreviewUnderDraw=function(b){var c=this;this._sc.setBoundingPreviewUnderdraw(b.reduce(function(b,a){b.push(c._toVector3(a.min),c._toVector3(a.max));return b},[]))};b.prototype.setBoundingDebugLevel=function(b){this._sc.setBoundingDebugLevel(b)};
b.prototype.setBoundingPreviewTested=function(b){var c=this;this._sc.setBoundingPreviewTested(b.reduce(function(b,a){b.push(c._toVector3(a.min),c._toVector3(a.max));return b},[]))};b.prototype.setBoundingPreviewEjected=function(b){var c=this;this._sc.setBoundingPreviewEjected(b.reduce(function(b,a){b.push(c._toVector3(a.min),c._toVector3(a.max));return b},[]))};b.prototype.setServerRenderQuality=function(b,c,a,f){this._sc.setSsrQuality({jpegQualityLow:b,jpegQualityHigh:c,scaleLow:a,scaleHigh:f})};
b.prototype.setMinimumFramerate=function(b){this._sc.setMinFrameRate(b)};b.prototype.getMinimumFramerate=function(){return this._sc.getMinFrameRate()};b.prototype.setBackFacesVisible=function(b){this._sc.setBackFacesVisible(b)};b.prototype.setDrawMode=function(b){this._sc.setDrawMode(b)};b.prototype.enableHiddenLineRendering=function(b){this.setDrawMode(2);this._sc.setHiddenLineVisibleLineColor(this._toRgba(b.getVisibleLineColor(),b.getVisibleLineOpacity()));this._sc.setHiddenLineHiddenLineColor(this._toRgba(b.getObscuredLineColor(),
b.getObscuredLineOpacity()))};b.prototype.setAntiAliasingMode=function(b){switch(b){case d.AntiAliasingMode.None:this._sc.setAntiAliasingMode(0);break;case d.AntiAliasingMode.SMAA:this._sc.setAntiAliasingMode(1)}};b.prototype.setInstanceModifier=function(b,c,a){switch(b){case d.InstanceModifier.DoNotCut:this._sc.MeshInstance.setDoNotCut(c,a);break;case d.InstanceModifier.DoNotExplode:this._sc.MeshInstance.setDoNotExplode(c,a);break;case d.InstanceModifier.DoNotSelect:this._sc.MeshInstance.setDoNotSelect(c,
a);break;case d.InstanceModifier.SuppressCameraScale:this._sc.MeshInstance.setSuppressCameraScale(c,a);break;case d.InstanceModifier.OverrideSceneVisibility:this._sc.MeshInstance.setOverrideSceneVisibility(c,a);break;case d.InstanceModifier.DoNotLight:this._sc.MeshInstance.setDoNotLight(c,a);break;case d.InstanceModifier.DoNotOutlineHighlight:this._sc.MeshInstance.setDoNotOutlineHighlight(c,a);break;case d.InstanceModifier.ExcludeBounding:this._sc.MeshInstance.setExcludeBounding(c,a);break;case d.InstanceModifier.DoNotUseVertexColors:this._sc.MeshInstance.setDoNotUseVertexColors(c,
a);break;case d.InstanceModifier.AlwaysDraw:this._sc.MeshInstance.setAlwaysDraw(c,a);break;case d.InstanceModifier.DoNotXRay:this._sc.MeshInstance.setDoNotXRay(c,a);break;case d.InstanceModifier.ScreenOriented:this._sc.MeshInstance.setScreenOriented(c,a);break;case d.InstanceModifier.ScreenSpace:this._sc.MeshInstance.setScreenSpace(c,a);break;case d.InstanceModifier.ScreenSpaceStretched:this._sc.MeshInstance.setScreenSpaceStretched(c,a)}};b.prototype.attachModel=function(b,c,a,f,d){return this._attachModels(b,
[[c,a]],f,d)};b.prototype.attachScsModelByKey=function(b,c,a,f,d){console.assert(2===this._sessionType);return this._sc.attachScsModelByKey(b,a,c,f,d)};b.prototype._attachModels=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.attachModels(b,c,a,f)];case 1:return d.sent(),this._callbackManager.trigger("_attached",b),[2]}})})};b.prototype.attachScsBuffer=function(b,c,a,f,d,e){return __awaiter(this,void 0,void 0,
function(){return __generator(this,function(k){switch(k.label){case 0:return[4,this._sc.attachScsBuffer(b,c,a,f,d,e)];case 1:return k.sent(),this._callbackManager.trigger("_attached",b),[2]}})})};b.prototype.feedScsBuffer=function(b,c){this._sc.feedScsBuffer(b,c)};b.prototype._parseKeyInfo=function(b,c,a){if(b||c)return a;b=new Map;for(c=0;c<a.length;++c){for(var f=a[c++],d=[];c<a.length&&4294967295!==a[c];++c)d.push(a[c]);b.set(f,d)}return b};b.prototype.instanceKeyInfo=function(b,c,a){return __awaiter(this,
void 0,void 0,function(){var f,d,k;return __generator(this,function(e){switch(e.label){case 0:return f=1===c,d=1===a,[4,this._sc.meshInstanceKeyInfo(b,f,d)];case 1:return k=e.sent(),[2,this._parseKeyInfo(f,d,k)]}})})};b.prototype.metaDataKeyInfo=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.metaDataKeyInfo(b,c,a)];case 1:return f=d.sent(),[2,this._parseKeyInfo(c,a,f)]}})})};b.prototype.modelKeysFromInclusionKeys=
function(b){return this._sc.modelKeysFromInclusionKeys(b)};b.prototype.detachInclusions=function(b){return this._sc.detachInclusions(b)};b.prototype.resetToEmpty=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,d,k;return __generator(this,function(e){switch(e.label){case 0:for(a=0;a<this._requestBatchCountByType.length;++a){f=this._requestBatchCountByType[a]=0;for(d=this._pendingRequestsByType[a];f<d.length;f++)k=d[f],k.promise.reject(k.ids);this._pendingRequestsByType[a].length=
0}return[4,this._sc.resetToEmpty(b,c)];case 1:return e.sent(),this.flushMetaDataCache(),[2]}})})};b.prototype.setDrawStrategy=function(b){console.warn("This API has been deactivated for lack of stability it is recommended not to use it");switch(b){case d.DrawStrategy.FixedFramerate:b=0;break;case d.DrawStrategy.OcclusionCulling:b=1;break;default:console.warn("Invalid draw strategy, defaulting to fixed framerate"),b=0}this._sc.setDrawStrategy(b)};b.prototype.redraw=function(){this._sc.queueRedraw()};
b.prototype.disconnectNetwork=function(){this._sc.disconnectNetwork()};b.prototype.shutdown=function(){null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=null);this._sessionType=0;this._sc.shutDown()};b.prototype.getVersionString=function(){return this._sc.getStreamVersion().toString()};b.prototype.setAllowHighDpi=function(b){this._sc.allowHighDpi=b;this.resize()};b.prototype.getAllowHighDpi=function(){return this._sc.allowHighDpi};b.prototype.setMeshLevel=
function(b,c){this._sc.MeshInstance.setMeshLevel(b,c)};b.prototype.setMetallicRoughness=function(b,c,a){this._sc.MeshInstance.setMetallicRoughness(b,c,a)};b.prototype.setMetallicRoughnessMaterialOverride=function(b,c){this._sc.setMetallicRoughnessMaterialOverride(b,c)};b.prototype.getMetallicRoughness=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.MeshInstance.getMetallicRoughness(b)];case 1:c=d.sent();
a=[];for(f=0;f<c.length;f+=2)0>c[f]||0>c[f+1]?a.push(null):a.push({metallic:c[f],roughness:c[f+1]});return[2,a]}})})};b.prototype.unsetMetallicRoughness=function(b){this._sc.MeshInstance.unsetMetallicRoughness(b)};b.prototype.setOverlayVisibility=function(b,c){this._sc.Overlay.setVisible(b,c)};b.prototype.setOverlayCamera=function(b,c){c=this._toCamera(c);this._sc.Overlay.setCamera(b,c)};b.prototype.destroyOverlay=function(b){this._sc.Overlay.destroy(b)};b.prototype._overlayUnit=function(b){switch(b){case d.OverlayUnit.ProportionOfCanvas:return 1;
case d.OverlayUnit.ProportionOfOtherDimension:return 2;default:return 0}};b.prototype.getMaxOverlayIndex=function(){return this._sc.Overlay.maxIndex()};b.prototype._overlayAnchor=function(b){switch(b){case d.OverlayAnchor.BottomCenter:return 7;case d.OverlayAnchor.Center:return 8;case d.OverlayAnchor.LeftCenter:return 5;case d.OverlayAnchor.LowerLeftCorner:return 1;case d.OverlayAnchor.LowerRightCorner:return 2;case d.OverlayAnchor.RightCenter:return 6;case d.OverlayAnchor.TopCenter:return 4;case d.OverlayAnchor.UpperRightCorner:return 3;
default:return 0}};b.prototype.setOverlayViewport=function(b,c,a,f,d,e,g,h,u,w){this._sc.Overlay.setViewport(b,this._overlayAnchor(c),a,this._overlayUnit(f),d,this._overlayUnit(e),g,this._overlayUnit(h),u,this._overlayUnit(w))};b.prototype.addNodesToOverlay=function(b,c){this._sc.MeshInstance.setOverlayIndex(b,c)};b.prototype.getInstancesMeshData=function(b){return this._sc.MeshInstance.getMeshData(b)};b.prototype.getInstancesCappingMeshData=function(b){return this._sc.MeshInstance.getCappingMeshData(b)};
b.prototype.getMeshData=function(b){return this._sc.MeshData.getData(b)};b.prototype._toElementType=function(b){switch(b){case d.ElementType.Faces:return 0;case d.ElementType.Lines:return 1;case d.ElementType.Points:return 2}};b.prototype._toXRayGroup=function(b){switch(b){case d.XRayGroup.Selected:return 0;case d.XRayGroup.Unselected:return 1}};b.prototype.setXRayColor=function(b,c,a){this._sc.setXRayMaterial(this._toXRayGroup(b),this._toElementType(c),this._toRgba(a,1))};b.prototype.unsetXRayColor=
function(b,c){return this._sc.unsetXRayMaterial(this._toXRayGroup(b),this._toElementType(c))};b.prototype.setXRayOpacity=function(b,c){void 0!==c?this._sc.setXRayOpacity(this._toElementType(c),b):(this._sc.setXRayOpacity(0,b),this._sc.setXRayOpacity(1,b),this._sc.setXRayOpacity(2,b))};b.prototype._xRayTransparencyMode=function(b){switch(b){case d.XRayTransparencyMode.Unsorted:return 0;case d.XRayTransparencyMode.SingleLayer:return 1}};b.prototype.setXRayTransparencyMode=function(b){this._sc.setXRayTransparencyMode(this._xRayTransparencyMode(b))};
b.prototype.setGoochBlue=function(b){this._sc.setGoochBlue(b)};b.prototype.setGoochBaseColorProminence=function(b){this._sc.setGoochBaseColorProminence(b)};b.prototype.setGoochYellow=function(b){this._sc.setGoochYellow(b)};b.prototype.setGoochLuminanceShiftStrength=function(b){this._sc.setGoochLuminanceShiftStrength(b)};b.prototype.setToonShadingBandCount=function(b){this._sc.setToonBandCount(b)};b.prototype.setToonShadingSpecularFactor=function(b){this._sc.setToonSpecularFactor(b)};b.prototype._transparencyMode=
function(b){switch(b){case d.TransparencyMode.Unsorted:return 0;case d.TransparencyMode.SingleLayer:return 1}};b.prototype.setTransparencyMode=function(b){this._sc.setTransparencyMode(this._transparencyMode(b))};b.prototype._toPointSizeUnit=function(b){switch(b){case d.PointSizeUnit.ScreenPixels:return 0;case d.PointSizeUnit.CSSPixels:return 1;case d.PointSizeUnit.World:return 2;case d.PointSizeUnit.ProportionOfScreenWidth:return 3;case d.PointSizeUnit.ProportionOfScreenHeight:return 4;case d.PointSizeUnit.ProportionOfBoundingDiagonal:return 5}};
b.prototype._toPointShape=function(b){switch(b){case d.PointShape.Square:return 0;case d.PointShape.Disk:return 1;case d.PointShape.Sphere:return 2}};b.prototype._fromPointSizeUnit=function(b){switch(b){default:case 0:return d.PointSizeUnit.ScreenPixels;case 1:return d.PointSizeUnit.CSSPixels;case 2:return d.PointSizeUnit.World;case 3:return d.PointSizeUnit.ProportionOfScreenWidth;case 4:return d.PointSizeUnit.ProportionOfScreenHeight;case 5:return d.PointSizeUnit.ProportionOfBoundingDiagonal}};b.prototype._fromPointShape=
function(b){switch(b){default:case 0:return d.PointShape.Square;case 1:return d.PointShape.Disk;case 2:return d.PointShape.Sphere}};b.prototype.setPointSize=function(b,c){this._sc.setPointSize(b,this._toPointSizeUnit(c))};b.prototype.getPointSize=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,Promise.all([this._sc.getPointSize(),this._sc.getPointSizeUnit()])];case 1:return b=c.sent(),[2,[b[0],this._fromPointSizeUnit(b[1])]]}})})};
b.prototype.setPointShape=function(b){this._sc.setPointShape(this._toPointShape(b))};b.prototype.getPointShape=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return b=this._fromPointShape,[4,this._sc.getPointShape()];case 1:return[2,b.apply(this,[c.sent()])]}})})};b.prototype.setEyeDomeLightingEnabled=function(b){this._sc.setEyeDomeLightingEnabled(b)};b.prototype.getEyeDomeLightingEnabled=function(){return this._sc.getEyeDomeLightingEnabled()};
b.prototype.setEyeDomeLightingBlurSamples=function(b){this._sc.setEyeDomeLightingBlurSamples(b)};b.prototype.getEyeDomeLightingBlurSamples=function(){return this._sc.getEyeDomeLightingBlurSamples()};b.prototype.setEyeDomeLightingBlurInterval=function(b){this._sc.setEyeDomeLightingBlurInterval(b)};b.prototype.getEyeDomeLightingBlurInterval=function(){return this._sc.getEyeDomeLightingBlurInterval()};b.prototype.setEyeDomeLightingBlurEdgeDistance=function(b){this._sc.setEyeDomeLightingBlurEdgeDistance(b)};
b.prototype.getEyeDomeLightingBlurEdgeDistance=function(){return this._sc.getEyeDomeLightingBlurEdgeDistance()};b.prototype.setEyeDomeLightingShadingEdgeDistance=function(b){this._sc.setEyeDomeLightingShadingEdgeDistance(b)};b.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._sc.getEyeDomeLightingShadingEdgeDistance()};b.prototype.setEyeDomeLightingOpacity=function(b){this._sc.setEyeDomeLightingOpacity(b)};b.prototype.getEyeDomeLightingOpacity=function(){return this._sc.getEyeDomeLightingOpacity()};
b.prototype.setDisplayIncompleteFrames=function(b){this._sc.setDisplayIncompleteFrames(b)};b.prototype.setInteractiveDrawDelay=function(b){this._sc.setPostInputDelay(b)};b.prototype.setInteractiveDrawLimitIncreaseEnabled=function(b){this._sc.setInteractiveDrawLimitIncreaseEnabled(b)};b.prototype.getInteractiveDrawLimitIncreaseEnabled=function(){return this._sc.getInteractiveDrawLimitIncreaseEnabled()};b.prototype._toCullingVectorSpace=function(b){switch(b){case d.CullingVectorSpace.Object:return 0;
case d.CullingVectorSpace.World:return 1}};b.prototype._fromCullingVectorSpace=function(b){switch(b){default:case 0:return d.CullingVectorSpace.Object;case 1:return d.CullingVectorSpace.World}};b.prototype.setCullingVector=function(b,c,a,f){this._sc.MeshInstance.setCullingVector(b,this._toCullingVectorSpace(c),[a.x,a.y,a.z],f)};b.prototype.unsetCullingVector=function(b){this._sc.MeshInstance.unsetCullingVector(b)};b.prototype.getCullingVector=function(b){return __awaiter(this,void 0,void 0,function(){var c,
a,f,k,e;return __generator(this,function(l){switch(l.label){case 0:return[4,this._sc.MeshInstance.getCullingVector(b)];case 1:c=l.sent();a=[];f=0;for(k=c;f<k.length;f++)e=k[f],0===e.vector[0]&&0===e.vector[1]&&0===e.vector[2]?a.push(null):a.push({space:this._fromCullingVectorSpace(e.space),vector:d.Point3.createFromArray(e.vector),toleranceDegrees:e.toleranceDegrees});return[2,a]}})})};b.prototype._setStreamCutoffScale=function(b){this._streamCutoffScale=Math.max(0,Math.min(b,2))};b.prototype.setStreamCutoffScale=
function(b){this._setStreamCutoffScale(b);this._sc.setStreamCutoffScale(this._streamCutoffScale)};b.prototype.getStreamCutoffScale=function(){return this._streamCutoffScale};b.prototype.loseWebGlContext=function(){return this._sc._loseWebGlContext()};b.prototype.triangulatePolygon=function(b,c){b=this._sc.triangulatePolygon(b,c);return new Float32Array(b)};b.prototype.debug_log=function(b){return this._sc.debug_log(b)};b.prototype.debug_stateFailure=function(b){return this._sc.debug_stateFailure(b)};
b.prototype.debug_sync=function(){return this._sc.debug_sync()};b.prototype._toLinePatternLengthUnit=function(b){switch(b){case d.LinePatternLengthUnit.Object:return 0;case d.LinePatternLengthUnit.World:return 1;case d.LinePatternLengthUnit.ProportionOfScreenWidth:return 2;case d.LinePatternLengthUnit.ProportionOfScreenHeight:return 3}};b.prototype.setLinePattern=function(b,c,a,f){this._sc.MeshInstance.setLinePattern(b,c,a,this._toLinePatternLengthUnit(f))};b.prototype.unsetLinePattern=function(b){this._sc.MeshInstance.unsetLinePattern(b)};
b.prototype.createFloorplanMesh=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._sc.createFloorplanMesh(b)]})})};b.prototype.exportToSvg=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(f){switch(f.label){case 0:return[4,this._sc.exportToSvg(b)];case 1:return c=f.sent(),a=c.map(function(b){return String.fromCharCode(b)}),[2,a.join("")]}})})};b.prototype.beginExportToSvg=function(b){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){return[2,this._sc.beginExportToSvg(b)]})})};b.prototype.advanceExportToSvg=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sc.advanceExportToSvg()];case 1:return b=c.sent(),0===b.length?[2,void 0]:[2,b.reduce(function(b,c){c=String.fromCharCode(c);switch(c){case "\n":return b;case "'":return b+'"';default:return""+b+c}},"")]}})})};b.prototype.waitForImageDecoding=
function(){return this._sc.waitForImageDecoding()};b.prototype.registerBimInstances=function(b,c){return this._sc.registerBimInstances(b,c)};b.prototype.setAmbientLightColor=function(b){this._sc.setAmbientLightColor(this._toRgb(b))};b.prototype.getLightKeys=function(){return this._sc.getLightKeys()};b.prototype.getLight=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._sc.getLight(b)];case 1:return c=
a.sent(),[2,new d.Light(c.type.value,c.space.value,new (d.Point3.bind.apply(d.Point3,[void 0].concat(c.position))),d.Color.createFromFloatArray(c.color))];case 2:return a.sent(),[2];case 3:return[2]}})})};b.prototype.clearLights=function(){this._sc.clearLights()};b.prototype._toLightType=function(b){switch(b){default:case d.LightType.Directional:return 0}};b.prototype._toLightSpace=function(b){switch(b){case d.LightSpace.World:return 0;default:case d.LightSpace.Camera:return 1}};b.prototype.addLight=
function(b){return this._sc.addLight(this._toLightType(b.type),this._toLightSpace(b.space),this._toVector3(b.position),this._toRgb(b.color))};b.prototype.removeLight=function(b){this._sc.removeLight(b)};b.prototype.updateLight=function(b,c){this._sc.updateLight(b,this._toLightType(c.type),this._toLightSpace(c.space),this._toVector3(c.position),this._toRgb(c.color))};b.prototype.setBloomEnabled=function(b){this._sc.setBloomEnabled(b)};b.prototype.setBloomThreshold=function(b){this._sc.setBloomThreshold(b)};
b.prototype.setBloomThresholdRampWidth=function(b){this._sc.setBloomThresholdRampWidth(b)};b.prototype.setBloomIntensityScale=function(b){this._sc.setBloomIntensityScale(b)};b.prototype._toBlurIntervalUnit=function(b){switch(b){default:case d.BlurIntervalUnit.Pixels:return 0;case d.BlurIntervalUnit.ProportionOfWidth:return 1;case d.BlurIntervalUnit.ProportionOfHeight:return 2}};b.prototype.setBloomLayers=function(b){for(var c=0;c<b.length;c++){var a=b[c];if(void 0!==a.blurInterval&&2!==a.blurInterval.length)throw new d.CommunicatorError("'blurInterval' must be an array containing a number followed by a BlurIntervalUnit");
}this._sc.suspendDrawing();this._sc.setBloomLayerCount(b.length);for(c=0;c<b.length;++c)a=b[c],void 0!==a.intensity&&this._sc.setBloomIntensity(c,a.intensity),void 0!==a.blurSamples&&this._sc.setBloomBlurSamples(c,a.blurSamples),void 0!==a.blurInterval&&this._sc.setBloomBlurInterval(c,a.blurInterval[0],this._toBlurIntervalUnit(a.blurInterval[1]));this._sc.resumeDrawing()};b.prototype.startComparison=function(b,c,a){var f=a&&a.sameColor?this._toRgb(a.sameColor):[0,0,0],d=a&&a.only1Color?this._toRgb(a.only1Color):
[1,0,0];a=a&&a.only2Color?this._toRgb(a.only2Color):[0,1,0];this._sc.setComparisonColors(f,d,a);this._sc.startComparison(b,c)};b.prototype.endComparison=function(){this._sc.endComparison()};b.prototype.setSimpleShadowColor=function(b){this._sc.setSimpleShadowColor(this._toRgb(b))};b.prototype.setSimpleShadowEnabled=function(b){this._sc.setSimpleShadowEnabled(b)};b.prototype.setSimpleShadowOpacity=function(b){this._sc.setSimpleShadowOpacity(b)};b.prototype.setGroundPlane=function(b,c){void 0!==c?this._sc.setGroundPlaneWithPosition(this._toVector3(b),
this._toVector3(c)):this._sc.setGroundPlane(this._toVector3(b))};b.prototype.setSimpleShadowResolution=function(b){this._sc.setSimpleShadowResolution(b)};b.prototype.setSimpleShadowBlurSamples=function(b){this._sc.setSimpleShadowBlurSamples(b)};b.prototype.setSimpleShadowBlurInterval=function(b){this._sc.setSimpleShadowBlurInterval(b)};b.prototype.setSimpleShadowInteractiveUpdateEnabled=function(b){void 0===b&&(b=!0);this._sc.setSimpleShadowInteractiveUpdateEnabled(b)};b.prototype.setSilhouetteColor=
function(b){this._sc.setSilhouetteColor(this._toRgb(b))};b.prototype.setSilhouetteEnabled=function(b){void 0===b&&(b=!0);this._sc.setSilhouetteEnabled(b)};b.prototype.setSilhouetteOpacity=function(b){this._sc.setSilhouetteOpacity(b)};b.prototype.setSilhouetteThreshold=function(b){this._sc.setSilhouetteThreshold(b)};b.prototype.setSilhouetteThresholdRampWidth=function(b){this._sc.setSilhouetteThresholdRampWidth(b)};b.prototype.setHardEdgeColor=function(b){this._sc.setHardEdgeColor(this._toRgb(b))};
b.prototype.setHardEdgesEnabled=function(b){void 0===b&&(b=!0);this._sc.setHardEdgesEnabled(b)};b.prototype.setHardEdgeOpacity=function(b){this._sc.setHardEdgeOpacity(b)};b.prototype.setHardEdgeThreshold=function(b){this._sc.setHardEdgeThreshold(b)};b.prototype.setHardEdgeThresholdRampWidth=function(b){this._sc.setHardEdgeThresholdRampWidth(b)};b.prototype.setSimpleReflectionEnabled=function(b){void 0===b&&(b=!0);this._sc.setSimpleReflectionEnabled(b)};b.prototype.setSimpleReflectionBlurInterval=
function(b,c){this._sc.setSimpleReflectionBlurInterval(b,this._toBlurIntervalUnit(c))};b.prototype.setSimpleReflectionBlurSamples=function(b){this._sc.setSimpleReflectionBlurSamples(b)};b.prototype.setSimpleReflectionFadeAngle=function(b){this._sc.setSimpleReflectionFadeAngle(b)};b.prototype.setSimpleReflectionOpacity=function(b){this._sc.setSimpleReflectionOpacity(b)};b.prototype.setSimpleReflectionAttenuation=function(b,c,a){void 0===a&&(a=d.SimpleReflectionAttenuationUnit.World);this._sc.setSimpleReflectionAttenuation(b,
c,a)};b.prototype.throttleLoad=function(b,c){this._sc.throttleLoad(b,c)};b.prototype._toVector3Array=function(b){for(var c=[],a=0;a<b.length;a++){var f=b[a];c.push([f.x,f.y,f.z])}return c};b.prototype.testPointVisibility=function(b){return this._sc.testPointVisibility(this._toVector3Array(b))};b.prototype.setPointVisibilityTest=function(b){this._sc.setPointVisibilityTest(this._toVector3Array(b))};b.prototype.setImageBasedLightingEnabled=function(b){this._sc.setImageBasedLightingEnabled(b)};b.prototype.setImageBasedLightingIntensity=
function(b){this._sc.setImageBasedLightingIntensity(b)};b.prototype._toMatrix9=function(b){return[b.m[0],b.m[1],b.m[2],b.m[4],b.m[5],b.m[6],b.m[8],b.m[9],b.m[10]]};b.prototype.setImageBasedLightingMatrix=function(b){this._sc.setImageBasedLightingMatrix(this._toMatrix9(b))};b.prototype.setImageBasedLightingEnvironment=function(b){this._sc.setImageBasedLightingEnvironment(b)};b.prototype.setImageBasedLightingEnvironmentToDefault=function(){this._sc.setImageBasedLightingEnvironmentToDefault()};b.prototype.setLineJitterEnabled=
function(b){this._sc.setLineJitterEnabled(b)};b.prototype.setLineJitterInstanceCount=function(b){this._sc.setLineJitterInstanceCount(b)};b.prototype.setLineJitterRadius=function(b){this._sc.setLineJitterRadius(b)};b.prototype.setLineJitterFrequency=function(b){this._sc.setLineJitterFrequency(b)};return b}();h.ScEngine=b})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b,c,a,d,e,g,h){this._position=b.copy();this._normal=c.copy();this._elementIndex=a;this._elementBits=e;this._bounding=g.copy();this._overlayIndex=d;this._isProximityFace=h}b.prototype.isProximityFace=function(){return this._isProximityFace};b.prototype.isCappingGeometry=function(){return-1===this._elementIndex};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){return{position:this._position.toJson(),normal:this._normal.toJson(),
cadFaceIndex:this._elementIndex,cadFaceBits:this._elementBits,bounding:this._bounding.toJson(),overlayIndex:this._overlayIndex,isProximityFace:this._isProximityFace}};b.prototype.forJson=function(){return this.toJson()};b.fromJson=function(c){var a=d.Point3.fromJson(c.position),f=d.Point3.fromJson(c.normal),e=d.Box.fromJson(c.bounding);return new b(a,f,c.cadFaceIndex,c.overlayIndex,c.cadFaceBits,e,!0===c.isProximityFace)};b.construct=function(c){return b.fromJson(c)};b.prototype.getPosition=function(){return this._position.copy()};
b.prototype.getNormal=function(){return this._normal.copy()};b.prototype.getCadFaceIndex=function(){return this._elementIndex};b.prototype.getCadFaceBits=function(){return this._elementBits};b.prototype.getBounding=function(){return this._bounding.copy()};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.FaceEntity=g;var a=function(){function b(b,c,a,e,g,p,h){this._lineSegmentVertices=[];this._elementIndex=b;this._elementBits=h;this._position=c.copy();this._bounding=g.copy();
this._overlayIndex=p;if(a)for(0<=e&&(b=3*e,this._bestLineSegmentVertexIndex=new d.Point3(a[b],a[b+1],a[b+2])),this._lineSegmentVertices.push(new d.Point3(a[0],a[1],a[2])),b=3;b<a.length;b+=6)this._lineSegmentVertices.push(new d.Point3(a[b],a[b+1],a[b+2]))}b.prototype.isCappingGeometry=function(){return 0>this._elementIndex};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){for(var b=[],c=0,a=this._lineSegmentVertices;c<a.length;c++)b.push(a[c].toJson());return{lineId:this._elementIndex,
lineBits:this._elementBits,position:this._position.toJson(),linePoints:b,bounding:this._bounding.copy(),overlayIndex:this._overlayIndex}};b.prototype.forJson=function(){return this.toJson()};b.fromJson=function(c){var a=d.Point3.fromJson(c.position),f=d.Box.fromJson(c.bounding);a=new b(c.lineId,a,null,-1,f,c.overlayIndex,0);f=0;for(c=c.linePoints;f<c.length;f++){var e=d.Point3.fromJson(c[f]);a._lineSegmentVertices.push(e)}return a};b.construct=function(c){return b.fromJson(c)};b.prototype.getLineId=
function(){return this._elementIndex};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.getPoints=function(){return this._lineSegmentVertices};b.prototype.getBestVertex=function(){return this._bestLineSegmentVertexIndex?this._bestLineSegmentVertexIndex.copy():null};b.prototype.getLineBits=function(){return this._elementBits};b.prototype.getBounding=function(){return this._bounding.copy()};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.LineEntity=
a;var e=function(){function b(b,c,a,d){this._position=b.copy();this._elementIndex=c;this._overlayIndex=a;this._elementBits=d}b.fromJson=function(c){var a=d.Point3.fromJson(c.position);return new b(a,c.pointId,c.pointBits,c.overlayIndex)};b.construct=function(c){return b.fromJson(c)};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){return{pointId:this._elementIndex,pointBits:this._elementBits,position:this._position.toJson(),overlayIndex:this._overlayIndex}};b.prototype.forJson=
function(){return this.toJson()};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.getPointBits=function(){return this._elementBits};b.prototype.getPointId=function(){return this._elementIndex};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.PointEntity=e;var c=function(){return function(b){this._handle=b}}();h.IncrementalSelectionId=c;c=function(){function b(b,c,a,d,e){void 0===b&&(b=null);void 0===c&&(c=null);void 0===a&&(a=null);void 0===
d&&(d=null);void 0===e&&(e=null);this._nodeId=b;this._inclusionKey=c;this._faceEntity=a;this._lineEntity=d;this._pointEntity=e}b.create=function(c,a,d,e,g){return new b(c,a,d,e,g)};b.prototype.getSelectionType=function(){return null===this._nodeId?d.SelectionType.None:null!==this._faceEntity?d.SelectionType.Face:null!==this._lineEntity?d.SelectionType.Line:null!==this._pointEntity?d.SelectionType.Point:d.SelectionType.Part};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=
function(){return{nodeId:this._nodeId,includeId:this._inclusionKey,faceEntity:this._faceEntity?this._faceEntity.toJson():null,lineEntity:this._lineEntity?this._lineEntity.toJson():null,pointEntity:this._pointEntity?this._pointEntity.toJson():null}};b.prototype.forJson=function(){return this.toJson()};b._fromJson=function(c){return new b(c.nodeId,c.includeId,c.faceEntity?g.fromJson(c.faceEntity):null,c.lineEntity?a.fromJson(c.lineEntity):null,c.pointEntity?e.fromJson(c.pointEntity):null)};b.prototype.getFaceEntity=
function(){return this._faceEntity};b.prototype.getLineEntity=function(){return this._lineEntity};b.prototype.getPointEntity=function(){return this._pointEntity};b.prototype.getNodeId=function(){return this._nodeId};b.prototype.getInclusionKey=function(){return this._inclusionKey};b.prototype.getIncludeId=function(){return this.getInclusionKey()};b.prototype.getPosition=function(){return null!==this._faceEntity?this._faceEntity.getPosition():null!==this._lineEntity?this._lineEntity.getPosition():
null!==this._pointEntity?this._pointEntity.getPosition():null};b.prototype.overlayIndex=function(){return this._faceEntity?this._faceEntity.overlayIndex():this._lineEntity?this._lineEntity.overlayIndex():this._pointEntity?this._pointEntity.overlayIndex():null};b.prototype._setNodeId=function(b){this._nodeId=b};b.prototype.equals=function(b){return this._nodeId!==b._nodeId||this.getSelectionType()!==b.getSelectionType()?!1:this._faceEntity&&b._faceEntity?this._faceEntity.getCadFaceIndex()===b._faceEntity.getCadFaceIndex():
this._lineEntity&&b._lineEntity?this._lineEntity.getLineId()===b._lineEntity.getLineId():this._pointEntity&&b._pointEntity?this._pointEntity.getPointId()===b._pointEntity.getPointId():!0};b.prototype._hash=function(b){var c=null!==this._nodeId?this._nodeId.toString(36):"";if(b)return c;c+=";"+this.getSelectionType()+";";this._faceEntity&&(c+=this._faceEntity.getCadFaceIndex().toString(36));c+=";";this._lineEntity&&(c+=this._lineEntity.getLineId().toString(36));c+=";";this._pointEntity&&(c+=this._pointEntity.getPointId().toString(36));
return c};b.prototype.isEntitySelection=function(){return null!==this._faceEntity||null!==this._lineEntity||null!==this._pointEntity};b.prototype.isNodeSelection=function(){return null!==this._nodeId};b.prototype.isNodeEntitySelection=function(){return null!==this._nodeId&&this.isEntitySelection()};b.prototype.isFaceSelection=function(){return null!==this._nodeId&&null!==this._faceEntity};b.prototype.isLineSelection=function(){return null!==this._nodeId&&null!==this._lineEntity};b.prototype.isPointSelection=
function(){return null!==this._nodeId&&null!==this._pointEntity};return b}();h.SelectionItem=c;c=function(){function b(b,c,a){this.faceItem=b;this.lineItem=c;this.pointItem=a}b.prototype.fetchMostRelevant=function(b){return null!==this.pointItem&&0!==(b&d.SelectionMask.Point)?this.pointItem:null!==this.lineItem&&0!==(b&d.SelectionMask.Line)?this.lineItem:null!==this.faceItem&&0!==(b&d.SelectionMask.Face)?this.faceItem:null};return b}();h.CompositeSelectionItem=c})(d.Selection||(d.Selection={}))})(Communicator||
(Communicator={}));(function(d){(function(d){d.sleep=function(d){return new Promise(function(a){setTimeout(a,d)})};d.delayCall=function(d){for(var a=[],e=1;e<arguments.length;e++)a[e-1]=arguments[e];return setTimeout.apply(void 0,[d,0].concat(a))};d.exchangeIdEqual=function(d,a){return d===a}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.hasBits=function(d,a){return(d&a)===a};h.setBit=function(d,a,e){return e?d|a:d&~a};h.classFromString=function(d){d=d.split(".");for(var a=window||this,e=0;e<d.length;e++){if(void 0===a)return null;a=a[d[e]]}return"function"!==typeof a?null:a};h.arrayBufferToBase64=function(d){for(var a="",e=d.byteLength,c=0;c<e;c++)a+=String.fromCharCode(d[c]);return window.btoa(a)};h.projectOnto=function(g,a){g=d.Point3.dot(a,g);var e=a.squaredLength();return d.Point3.scale(a,g/e)};h.majorAxis=
function(g){var a=Math.abs(g.x),e=Math.abs(g.y);g=Math.abs(g.z);a=+a.toFixed(6);e=+e.toFixed(6);g=+g.toFixed(6);return a>e&&a>g?new d.Point3(1,0,0):e>a&&e>g?new d.Point3(0,1,0):g>a&&g>e?new d.Point3(0,0,1):null};h.deepClone=function(d){return JSON.parse(JSON.stringify(d))};h.copyOwnProperties=function(d,a){for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])};h.getWithDefault=function(d,a){return void 0===d?a:d};h.versionAtLeast=function(d,a){for(var e=d.length>a.length?d.length:
a.length,c=0;c<e;++c){var b=d[c]||0,f=a[c]||0;if(b>f)break;else if(b<f)return!1}return!0};h.versionString=function(d){if(0===d.length)return"";for(var a=""+d[0],e=1;e<d.length;++e)a+="."+d[e];return a};h.getCrypto=function(){return window.crypto||window.msCrypto}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){return function(a){this.futureItemHash=null;this.pastItemHash=a}}(),g=function(){function a(){this.part=this.point=this.line=this.face=this.none=0}a.prototype.update=function(c,b){switch(c.getSelectionType()){case d.SelectionType.None:0===b?--this.none:++this.none;break;case d.SelectionType.Face:0===b?--this.face:++this.face;break;case d.SelectionType.Line:0===b?--this.line:++this.line;break;case d.SelectionType.Point:0===b?--this.point:++this.point;break;case d.SelectionType.Part:0===
b?--this.part:++this.part}};a.prototype.sum=function(){return this.none+this.face+this.line+this.point+this.part};return a}(),a=function(){function a(c,b,a,e,l){var f=this;this._selectedItemsPruned=new Map;this._selectedItemsFull=new Map;this._selectedNodeCounts=new Map;this._temporalLinks=new Map;this._newestItemHash=this._oldestItemHash=null;this._selectedLayers=new Set;this._selectedTypes=new Set;this._nodeSelectionColor=new d.Color(255,255,0);this._nodeSelectionOutlineColor=new d.Color(255,255,
0);this._elementSelectionColor=d.Color.red();this._elementSelectionOutlineColor=d.Color.red();this._nodeElementHighlightMode=this._nodeHighlightMode=d.SelectionHighlightMode.HighlightAndOutline;this._ignoreEntityWhenTogglingChildSelection=this._pruneSelectionDescendants=this._selectParentIfSelected=this._highlightPointElementSelection=this._highlightLineElementSelection=this._highlightFaceElementSelection=this._highlightNodeSelection=!0;this._suppressImplicitRemovalCallback=this._singleEntityToggleMode=
!1;this._selectionFilter=null;this._incrementalBlacklistedInstanceNodes=new Set;this._engine=b;this._view=a;this._model=e;this._modelStructure=l;this._callbackManager=c;this._callbackManager.bind({_subtreeLoaded:function(b){for(var c=0;c<b.length;c++)f._onSubtreeLoaded(b[c]);return Promise.resolve()}})}a.deprecated=function(c,b,a){var f=a.value;a.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","SelectionManager",b);return f.apply(this,
c)};return a};a.prototype._init=function(){this._updateHighlightingMode();this._engine.setHighlightColorizeCompression(.7)};a.prototype.setSelectionFilter=function(c){this._selectionFilter=c};a.prototype.getSelectionFilter=function(){return this._selectionFilter};a.prototype.setPruneSelectionDescendants=function(c){this._pruneSelectionDescendants=c;this.clear()};a.prototype.getPruneSelectionDescendants=function(){return this._pruneSelectionDescendants};a.prototype.setSelectParentIfSelected=function(c){this._selectParentIfSelected=
c};a.prototype.getSelectParentIfSelected=function(){return this._selectParentIfSelected};a.prototype.setIgnoreEntityWhenTogglingChildSelection=function(c){this._ignoreEntityWhenTogglingChildSelection=c};a.prototype.getIgnoreEntityWhenTogglingChildSelection=function(){return this._ignoreEntityWhenTogglingChildSelection};a.prototype.setSingleEntityToggleModeEnabled=function(c){this._singleEntityToggleMode=c;this.clear()};a.prototype.getSingleEntityToggleModeEnabled=function(){return this._singleEntityToggleMode};
a.prototype.setSuppressImplicitRemovalCallback=function(c){this._suppressImplicitRemovalCallback=c};a.prototype.getSuppressImplicitRemovalCallback=function(){return this._suppressImplicitRemovalCallback};a.prototype.selectFromPoint=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromPoint(c,b)];case 1:return f=d.sent(),this._onSelectionItem(f,a),[2]}})})};a.prototype.selectAllFromPoint=
function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickAllFromPoint(c,b)];case 1:return f=d.sent(),this._onSelectionItems(f,a),[2]}})})};a.prototype.selectFromRay=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromRay(c,b)];case 1:return f=
d.sent(),this._onSelectionItem(f,a),[2]}})})};a.prototype.selectAllFromRay=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickAllFromRay(c,b)];case 1:return f=d.sent(),this._onSelectionItems(f,a),[2]}})})};a.prototype._onSelectionItem=function(c,b){c.isNodeEntitySelection()?this._processSelection(c,b):this._triggerNullSelection()};a.prototype._onSelectionItems=function(c,
b){b===d.SelectionMode.Set&&this.clear(!1);if(0===c.length)this._triggerNullSelection();else switch(b){case d.SelectionMode.Add:case d.SelectionMode.Set:this.add(c);break;case d.SelectionMode.Toggle:for(b=0;b<c.length;b++)this.toggle(c[b]);break;default:d.Util.TypeAssertNever(b)}};a.prototype.beginScreenSelectByArea=function(c,b,a){return this._view.beginScreenSelectByArea(c,b,a)};a.prototype.beginRayDrillSelection=function(c,b,a){return this._view.beginRayDrillSelection(c,b,a)};a.prototype.beginConvexPolyhedronSelection=
function(c,b,a){return this._view.beginConvexPolyhedronSelection(c,b,a)};a.prototype.beginSphereSelection=function(c,b,a){return this._view.beginSphereSelection(c,b,a)};a.prototype.endIncrementalSelection=function(c){this._callbackManager.trigger("incrementalSelectionEnd");this._view.endIncrementalSelection(c);return Promise.resolve()};a.prototype.endVolumeSelection=function(c){return this.endIncrementalSelection(c)};a.prototype.advanceIncrementalSelection=function(c,b){void 0===b&&(b=null);return __awaiter(this,
void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._view.advanceIncrementalSelection(c)];case 1:return a=f.sent(),null===a?[2,!1]:null===b?[3,3]:[4,Promise.all(a.map(b))];case 2:d=f.sent(),a=a.filter(function(b,c){return d[c]}),f.label=3;case 3:return this.add(a),[2,!0]}})})};a.prototype.advanceVolumeSelection=function(c,b){void 0===b&&(b=null);return this.advanceIncrementalSelection(c,b)};a.prototype.isSelected=function(c){return this.contains(c)?
!0:c.isNodeSelection()?null!==this._findAncestor(c):!1};a.prototype.isNodeSelected=function(c){for(var b=0,a=this.getResults();b<a.length;b++)if(a[b].getNodeId()===c)return!0;c=d.Selection.SelectionItem.create(c);return null!==this._findAncestor(c)};a.prototype.contains=function(c){return this._selectedItemsPruned.has(c._hash(this._singleEntityToggleMode))};a.prototype.containsParent=function(c){return this._findAncestor(c)};a.prototype._findAncestor=function(c){if(0<this._selectedItemsPruned.size)for(;;){c=
this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c);var b=c._hash(this._singleEntityToggleMode);if(this._selectedItemsPruned.has(b))return c}return null};a.prototype.selectLayer=function(c,b){b===d.SelectionMode.Set&&this.clear();var a=[],e=this._model.getLayerIdsFromName(c);if(null!==e)for(var l=0;l<e.length;l++){var g=this._model.getNodesFromLayer(e[l],!0);if(null!==g)for(var m=0;m<g.length;m++)a.push(d.Selection.SelectionItem.create(g[m]))}e=this._selectedLayers.has(c);
b===d.SelectionMode.Toggle&&e?this.remove(a):(this.add(a),this._selectedLayers.add(c))};a.prototype.getSelectedLayers=function(){var c=[];this._selectedLayers.forEach(function(b){c.push(b)});return c};a.prototype.selectType=function(c,b){b===d.SelectionMode.Set&&this.clear();var a=[],e=this._model.getNodesByGenericType(c);null!==e&&e.forEach(function(b){a.push(d.Selection.SelectionItem.create(b))});e=this._selectedTypes.has(c);if(b===d.SelectionMode.Toggle&&e)for(c=0;c<a.length;c++)this.remove(a[c]);
else this.add(a),this._selectedTypes.add(c)};a.prototype.getSelectedTypes=function(){var c=[];this._selectedTypes.forEach(function(b){c.push(b)});return c};a.prototype.selectNode=function(c,b){void 0===b&&(b=d.SelectionMode.Set);if(null!==c&&this._modelStructure.isIdValid(c))return c=d.Selection.SelectionItem.create(c),this._processSelection(c,b),c.getSelectionType();this._processSelection(null,b);return d.SelectionType.None};a.prototype._triggerNullSelection=function(){this._callbackManager.trigger("selectionArray",
[],!1)};a.prototype._isInAxisOverlay=function(c){var b=c.getFaceEntity();return b||(b=c.getLineEntity())?1===b.overlayIndex():(c=c.getPointEntity())?1===c.overlayIndex():!1};a.prototype._getNodeCounts=function(c){c=c.getNodeId();var b=this._selectedNodeCounts.get(c);b||(b=new g,this._selectedNodeCounts.set(c,b));return b};a.prototype._addToFull=function(c,b){for(;this._selectedItemsFull.set(b,c);){c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c);b=
c._hash(this._singleEntityToggleMode)}};a.prototype._addItems=function(c,b){var a=c.length;if(0!==a){this._callbackManager.trigger("incrementalSelectionBatchBegin");for(var e=[],l=0;l<a;++l){var g=this._filterItem(c[l]);null!==g&&this._addImpl(g,g._hash(this._singleEntityToggleMode))&&(g=new d.Event.NodeSelectionEvent(g),e.push(g))}0===e.length?this._triggerNullSelection():b||this._callbackManager.trigger("selectionArray",e,!1);this._callbackManager.trigger("incrementalSelectionBatchEnd")}};a.prototype._addItem=
function(c,b){c=this._filterItem(c);null!==c&&this._addImpl(c,c._hash(this._singleEntityToggleMode))?(c=new d.Event.NodeSelectionEvent(c),b||this._callbackManager.trigger("selectionArray",[c],!1)):this._triggerNullSelection()};a.prototype.add=function(c,b){void 0===b&&(b=!1);null===c?this._triggerNullSelection():Array.isArray(c)?this._addItems(c,b):this._addItem(c,b)};a.prototype._filterItem=function(c){if(null===this._selectionFilter)return c;var b=c.getNodeId(),a=this._selectionFilter(b,this._model);
return a===b?c:null===a?null:d.Selection.SelectionItem.create(a)};a.prototype._addImpl=function(c,b){if(c.getSelectionType()===d.SelectionType.None)return!1;if(this._isInAxisOverlay(c))return!0;if(this._selectedItemsPruned.has(b))return!1;if(this._pruneSelectionDescendants){if(null!==this._findAncestor(c))return!1;this._removeDescendants(c)}this._selectedItemsPruned.set(b,c);this._addToFull(c,b);this._getNodeCounts(c).update(c,1);var a=this._newestItemHash;this._newestItemHash=b;this._oldestItemHash||
(this._oldestItemHash=b);if(null!==a){var e=this._temporalLinks.get(a);e&&(e.futureItemHash=b)}a=new h(a);this._temporalLinks.set(b,a);this._updateItemHighlight(c,!0,!0);if(this._modelStructure.getType(c.getNodeId())===d.NodeType.Pmi&&(c=this._modelStructure.getPmiTopologyReferences(c.getNodeId()),null!==c))for(b=0;b<c.length;b++){e=c[b];a=e.body.getRuntimeId();for(var l=0,g=e.faceIds;l<g.length;l++)this._model.setNodeFaceHighlighted(a,g[l],!0);l=0;for(e=e.edgeIds;l<e.length;l++)this._model.setNodeLineHighlighted(a,
e[l],!0)}return!0};a.prototype._removeUpdateLayers=function(c){0<this._selectedLayers.size&&(c=c.getNodeId(),null!==c&&(c=this._model.getNodeLayerId(c),null!==c&&(c=this._model.getLayerName(c),null!==c&&this._selectedLayers.delete(c))))};a.prototype._removeUpdateTypes=function(c){0<this._selectedTypes.size&&(c=c.getNodeId(),null!==c&&(c=this._model.getNodeGenericType(c),null!==c&&this._selectedTypes.delete(c)))};a.prototype._removeFromFull=function(c,b){this._removeUpdateLayers(c);this._removeUpdateTypes(c);
if(this._selectedItemsFull.delete(b))for(b=0,c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var a=d.Selection.SelectionItem.create(c[b]);this._removeFromFull(a,a._hash(this._singleEntityToggleMode))}};a.prototype._removeItems=function(c,b){var a=this,e=[];c.forEach(function(b){a._removeImpl(b,b._hash(a._singleEntityToggleMode))&&e.push(new d.Event.NodeSelectionEvent(b))});b||this._callbackManager.trigger("selectionArray",e,!0)};a.prototype._removeItem=function(c,b){this._removeImpl(c,
c._hash(this._singleEntityToggleMode))&&(c=new d.Event.NodeSelectionEvent(c),b||this._callbackManager.trigger("selectionArray",[c],!0))};a.prototype.remove=function(c,b){void 0===b&&(b=!1);Array.isArray(c)?this._removeItems(c,b):this._removeItem(c,b)};a.prototype._removeImpl=function(c,b){if(this._singleEntityToggleMode){var a=this._selectedItemsPruned.get(b);a&&(c=a)}if(!this._selectedItemsPruned.delete(b))return!1;this._removeFromFull(c,b);a=this._getNodeCounts(c);a.update(c,0);var d=this._temporalLinks.get(b);
if(void 0!==d){this._temporalLinks.delete(b);if(null!==d.pastItemHash){var e=this._temporalLinks.get(d.pastItemHash);e&&(e.futureItemHash=d.futureItemHash)}null!==d.futureItemHash&&(e=this._temporalLinks.get(d.futureItemHash))&&(e.pastItemHash=d.pastItemHash);this._oldestItemHash===b&&(this._oldestItemHash=d.futureItemHash);this._newestItemHash===b&&(this._newestItemHash=d.pastItemHash)}b=!0;0===a.sum()&&(b=!1,a=c.getNodeId(),this._selectedNodeCounts.delete(a));this._updateItemHighlight(c,b,!1);return!0};
a._selectionItemIsFromModelBrowser=function(c){return null===c.getFaceEntity()&&null===c.getLineEntity()&&null===c.getPointEntity()};a.prototype.toggle=function(c){var b=this._filterItem(c);if(null!==b){var f=this._findAncestor(b),e=b._hash(this._singleEntityToggleMode);null!==f?(a._selectionItemIsFromModelBrowser(c)?this._removeImplicit(c,f,this._suppressImplicitRemovalCallback):this._ignoreEntityWhenTogglingChildSelection||this._removeImplicit(d.Selection.SelectionItem.create(b.getNodeId()),f,this._suppressImplicitRemovalCallback),
this._suppressImplicitRemovalCallback&&(c=new d.Event.NodeSelectionEvent(b),this._callbackManager.trigger("selectionArray",[c],!0))):this._selectedItemsPruned.has(e)?this._removeImpl(b,e)&&(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!0)):null!==b&&this._addImpl(b,e)&&(c=new d.Event.NodeSelectionEvent(b),this._callbackManager.trigger("selectionArray",[c],!1))}};a.prototype.set=function(c){this.clear(!1);this.add(c)};a.prototype.getResults=function(){var c=
[];this.each(function(b){c.push(b)});return c};a.prototype.getResult=function(c){var b=this.size();if(0>c||c>=b)return null;b=b-c-1;return c<=b?this._getItemFromOldest(c):this._getItemFromNewest(b)};a.prototype._getItemFromOldest=function(c){for(var b=this._oldestItemHash;b;){if(0===c--)return this._selectedItemsPruned.get(b)||null;b=this._temporalLinks.get(b).futureItemHash}return null};a.prototype._getItemFromNewest=function(c){for(var b=this._newestItemHash;b;){if(0===c--)return this._selectedItemsPruned.get(b)||
null;b=this._temporalLinks.get(b).pastItemHash}return null};a.prototype.getFirst=function(){return null!==this._oldestItemHash?this._selectedItemsPruned.get(this._oldestItemHash)||null:null};a.prototype.getLast=function(){return null!==this._newestItemHash?this._selectedItemsPruned.get(this._newestItemHash)||null:null};a.prototype.size=function(){return this._selectedItemsPruned.size};a.prototype.each=function(c){for(var b=this._oldestItemHash;b;){var a=this._selectedItemsPruned.get(b);c(a);b=this._temporalLinks.get(b).futureItemHash}};
a.prototype.clear=function(c){void 0===c&&(c=!0);this._selectedLayers.clear();this._selectedTypes.clear();this._clearHighlight();this._selectedItemsPruned.clear();this._selectedItemsFull.clear();this._selectedNodeCounts.clear();this._temporalLinks.clear();this._newestItemHash=this._oldestItemHash=null;c&&this._triggerNullSelection()};a.prototype.setNodeSelectionColor=function(c){this._setNodeSelectionColor(c);return Promise.resolve()};a.prototype._setNodeSelectionColor=function(c){this._nodeSelectionColor.assign(c);
this._updateHighlightingMode()};a.prototype.getNodeSelectionColor=function(){return this._nodeSelectionColor.copy()};a.prototype.setNodeSelectionOutlineColor=function(c){this._setNodeSelectionOutlineColor(c);return Promise.resolve()};a.prototype._setNodeSelectionOutlineColor=function(c){this._nodeSelectionOutlineColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeSelectionOutlineColor=function(){return this._nodeSelectionOutlineColor.copy()};a.prototype.setNodeElementSelectionColor=
function(c){this._setNodeElementSelectionColor(c);return Promise.resolve()};a.prototype._setNodeElementSelectionColor=function(c){this._elementSelectionColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeElementSelectionColor=function(){return this._elementSelectionColor.copy()};a.prototype.setNodeElementSelectionOutlineColor=function(c){this._setNodeElementSelectionOutlineColor(c);return Promise.resolve()};a.prototype._setNodeElementSelectionOutlineColor=function(c){this._elementSelectionOutlineColor.assign(c);
this._updateHighlightingMode()};a.prototype.getNodeElementSelectionOutlineColor=function(){return this._elementSelectionOutlineColor.copy()};a.prototype.getHighlightFaceElementSelection=function(){return this._highlightFaceElementSelection};a.prototype.setHighlightFaceElementSelection=function(c){this._highlightFaceElementSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.setNodeSelectionHighlightMode=function(c){this._setNodeSelectionHighlightMode(c);return Promise.resolve()};
a.prototype._setNodeSelectionHighlightMode=function(c){this._nodeHighlightMode=c;this._updateHighlightingMode()};a.prototype.getNodeSelectionHighlightMode=function(){return this._nodeHighlightMode};a.prototype.setNodeElementSelectionHighlightMode=function(c){this._setNodeElementSelectionHighlightMode(c);return Promise.resolve()};a.prototype._setNodeElementSelectionHighlightMode=function(c){this._nodeElementHighlightMode=c;this._updateHighlightingMode()};a.prototype.getNodeElementSelectionHighlightMode=
function(){return this._nodeElementHighlightMode};a.prototype.setHighlightNodeSelection=function(c){this._highlightNodeSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.getHighlightNodeSelection=function(){return this._highlightNodeSelection};a.prototype.getHighlightLineElementSelection=function(){return this._highlightLineElementSelection};a.prototype.getHighlightPointElementSelection=function(){return this._highlightPointElementSelection};a.prototype.setHighlightLineElementSelection=
function(c){this._highlightLineElementSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.setHighlightPointElementSelection=function(c){this._highlightPointElementSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.setPickTolerance=function(c){this._engine.setPickTolerance(c)};a.prototype.getPickTolerance=function(){return this._engine.getPickTolerance()};a.prototype.exportSelectionData=function(){for(var c=[],b=0,a=this.getResults();b<a.length;b++)c.push(a[b].toJson());
return c};a.prototype.loadSelectionData=function(c){this.clear(!1);if("string"===typeof c&&(c=JSON.parse(c),!Array.isArray(c)))throw new d.ParseError("Expected JSON depicting an Array.");for(var b=[],a=0;a<c.length;a++){var e=d.Selection.SelectionItem._fromJson(c[a]);e.isNodeSelection()&&b.push(e)}this.add(b)};a.prototype._pathToParent=function(c,b){for(var a=[];!c.equals(b);){a.push(c);c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c)}return a};a.prototype._removeImplicit=
function(c,b,a){var f=this._pathToParent(c,b),e=b;b=[c];for(var g=[];0<f.length;){b.push(e);var m=0;for(e=this._model.getNodeChildren(e.getNodeId());m<e.length;m++){var p=d.Selection.SelectionItem.create(e[m]);a:{var h=p;for(var r=0,t=f;r<t.length;r++)if(h.equals(t[r])){h=!0;break a}h=!1}h||g.push(p)}e=f.pop()}console.assert(c===e);this.remove(b,a);this.add(g,a)};a.prototype._removeDescendants=function(c){var b=0;for(c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var a=d.Selection.SelectionItem.create(c[b]);
this._removeDescendantsRecursive(a)}};a.prototype._removeDescendantsRecursive=function(c){var b=c._hash(this._singleEntityToggleMode);if(this._selectedItemsFull.delete(b))for(this._removeImpl(c,b),b=0,c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var a=d.Selection.SelectionItem.create(c[b]);this._removeDescendantsRecursive(a)}};a.prototype._processSelection=function(c,b){switch(b){case d.SelectionMode.Add:this.add(c);break;case d.SelectionMode.Set:this.set(c);break;case d.SelectionMode.Toggle:null!==
c&&this.toggle(c)}};a.prototype._clearHighlight=function(){0<this._selectedItemsPruned.size&&this._engine.clearHighlight()};a.prototype._updateHighlight=function(){var c=this;this._clearHighlight();this._selectedItemsPruned.forEach(function(b){b&&c._updateItemHighlight(b,!0,!0)});this._highlightNodeSelection&&this._model.setNodesHighlighted([],!0)};a.prototype._updateItemHighlight=function(c,b,a){var f=c.getNodeId();this._highlightNodeSelection&&this._model.setNodesHighlighted([f],b);this._model.getNodeType(f)!==
d.NodeType.Pmi&&(b=c.getFaceEntity(),this._highlightFaceElementSelection&&null!==b&&!b.isCappingGeometry()&&this._model.setNodeFaceHighlighted(f,b.getCadFaceIndex(),a),b=c.getLineEntity(),this._highlightLineElementSelection&&null!==b&&!b.isCappingGeometry()&&this._model.setNodeLineHighlighted(f,b.getLineId(),a),c=c.getPointEntity(),this._highlightPointElementSelection&&null!==c&&this._model.setNodePointHighlighted(f,c.getPointId(),a))};a.prototype._updateHighlightingMode=function(){switch(this._nodeHighlightMode){case d.SelectionHighlightMode.HighlightOnly:this._engine.setNodeHighlightColor(this._nodeSelectionColor,
null);break;case d.SelectionHighlightMode.OutlineOnly:this._engine.setNodeHighlightColor(null,this._nodeSelectionOutlineColor);break;case d.SelectionHighlightMode.HighlightAndOutline:this._engine.setNodeHighlightColor(this._nodeSelectionColor,this._nodeSelectionOutlineColor)}switch(this._nodeElementHighlightMode){case d.SelectionHighlightMode.HighlightOnly:this._engine.setElementHighlightColor(this._elementSelectionColor,null);break;case d.SelectionHighlightMode.OutlineOnly:this._nodeHighlightMode===
d.SelectionHighlightMode.OutlineOnly?this._engine.setElementHighlightColor(null,this._elementSelectionOutlineColor):this._engine.setElementHighlightColor(this._nodeSelectionColor,this._elementSelectionOutlineColor);break;case d.SelectionHighlightMode.HighlightAndOutline:this._engine.setElementHighlightColor(this._elementSelectionColor,this._elementSelectionOutlineColor)}};a.prototype._onSubtreeLoaded=function(c){c=d.Selection.SelectionItem.create(c);if(this.isSelected(c))return this._updateItemHighlight(c,
!0,!0)};a.ifcSelectionFilter=function(c,b){if(b.getNodeType(c)===d.NodeType.BodyInstance)for(var a=c;null!==a;){if(null!==b.getNodeGenericId(a))return a;a=b.getNodeParent(a)}return c};__decorate([a.deprecated],a.prototype,"endVolumeSelection",null);__decorate([a.deprecated],a.prototype,"advanceVolumeSelection",null);return a}();d.SelectionManager=a})(Communicator||(Communicator={}));
(function(d){var h;(function(a){a[a.Background=0]="Background";a[a.Shadow=1]="Shadow";a[a.Selection=2]="Selection"})(h||(h={}));var g=function(){function a(a,c,b,f){var e=this;this._backgroundSheetMeshId=this._activeSheetId=null;this._sheetIds=[null,null,null];this._backgroundSelectionEnabled=this._backgroundSheetEnabled=!1;this._backgroundColor=new d.Color(180,180,180);this._sheetColor=d.Color.white();this._sheetShadowColor=new d.Color(75,75,75);this._viewer=a;this._engine=c;this._callbackManager=
b;var l=function(){return __awaiter(e,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:if(!this._viewer.model.isDrawing())return[2];b=this._viewer.sheetManager.getActiveSheetId();return null!=b?[3,4]:[4,this.deactivateSheets(!1)];case 1:return a.sent(),c=this.getSheetIds(),0===this.get3DNodes().length&&0<c.length?[4,this.setActiveSheetId(c[0],!0,!0)]:[3,3];case 2:a.sent(),a.label=3;case 3:return[3,6];case 4:return[4,this._activateSheetId(b,!0,!0)];case 5:a.sent(),
a.label=6;case 6:return[2]}})})};this._viewer.setCallbacks({_modelStructureHeaderParsed:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){return this._viewer.model.isDrawing()&&!f?[2,this.setBackgroundSheetEnabled(!0)]:[2]})})},_firstModelLoaded:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,l()];case 1:return b.sent(),[2]}})})},_resetAssemblyTreeBegin:function(){return __awaiter(e,
void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return[4,this.setBackgroundSheetEnabled(!1)];case 1:return a.sent(),[4,this.setBackgroundSelectionEnabled(!1)];case 2:return a.sent(),this._backgroundSheetMeshId=this._activeSheetId=null,b=this._viewer.view,c=b.getBackgroundColor(),b.setBackgroundColor(c.top,c.bottom),[2]}})})},_resetDrawing:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,
l()];case 1:return b.sent(),[2]}})})}})}a.prototype.getSheetIds=function(){var a=this._viewer.model,c=function(b){for(var f=[],e=0,g=a.getNodeChildren(b);e<g.length;e++)f=f.concat(c(g[e]));a.getNodeType(b)===d.NodeType.DrawingSheet&&f.push(b);return f},b=a.getAbsoluteRootNode();return c(b)};a.prototype.get3DNodes=function(){var a=this._viewer.model,c=a.getAbsoluteRootNode();c=a.getNodeChildren(c);var b=a.getNodeChildren(c[0]);c=[];var f=0;for(b=a.getNodeChildren(b[0]);f<b.length;f++){var k=b[f];a.getNodeType(k)!==
d.NodeType.DrawingSheet&&c.push(k)}return c};a.prototype.deactivateSheets=function(a,c){void 0===a&&(a=!0);void 0===c&&(c=!1);return __awaiter(this,void 0,void 0,function(){var b,f,d,e;return __generator(this,function(k){switch(k.label){case 0:return this._activeSheetId=null,this._viewer.pauseRendering(),b=this.get3DNodes(),f=c?!1:0<b.length,[4,this._viewer.view.isolateNodes(b,0,f)];case 1:return k.sent(),[4,this._refreshBackgroundSheets()];case 2:return k.sent(),d=this._viewer.view,e=d.getBackgroundColor(),
d.setBackgroundColor(e.top,e.bottom),this._viewer.resumeRendering(),a&&this._callbackManager.trigger("sheetDeactivated"),[2]}})})};a.prototype.setActiveSheetId=function(a,c,b){void 0===c&&(c=!0);void 0===b&&(b=!0);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:if(this._activeSheetId===a)return[2];this._activeSheetId=a;return[4,this._activateSheetId(a,c,b)];case 1:return f.sent(),[2]}})})};a.prototype._activateSheetId=function(a,c,b){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return[4,this._markupManager._setActiveMarkupView(null)];case 1:f.sent();if(!c)return[3,4];this._viewer.pauseRendering();return[4,this._viewer.view.isolateNodes([a],0,b)];case 2:return f.sent(),[4,this._refreshBackgroundSheets()];case 3:f.sent(),this._viewer.resumeRendering(),f.label=4;case 4:return this._callbackManager.trigger("sheetActivated",this._activeSheetId),[2]}})})};a.prototype.getActiveSheetId=function(){return this._activeSheetId};
a.prototype.isDrawingSheetActive=function(){return this._viewer.model.isDrawing()&&null!==this._activeSheetId};a.prototype.setMarkupManager=function(a){this._markupManager=a};a.prototype._createBackgroundSheetMesh=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b;return __generator(this,function(f){a=[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0];c=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];b=new d.MeshData;b.addFaces(a,c);b.setBackfacesEnabled(!0);return[2,this._viewer.model.createMesh(b)]})})};
a.prototype._createBackgroundSheetMatrix=function(a,c){var b=a.min,f=a.max,e=this._viewer.view.getCamera();a=e.getPosition();var l=e.getTarget(),g=d.Point3.subtract(l,a);a=f.x-b.x;l=f.y-b.y;var m=Math.max(.1*a,.1*(f.z-b.z)),p=b.x+.5*a,h=b.y+.5*l,r=Math.max(.05*a,.05*l);a+=r;l+=r;p-=.5*a;h-=.5*l;b=0<g.z?f.z+m:b.z-m;c&&(c=e.getUp(),e=.3*r,p+=e,0<c.y&&(e=-e),h+=e,b+=0<g.z?m:-m);c=new d.Matrix;c.setTranslationComponent(p,h,b);c.setScaleComponent(a,l,1);return c};a.prototype._createBackgroundSheetInstance=
function(a,c,b,f,k,l){return __awaiter(this,void 0,void 0,function(){var e,g,p;return __generator(this,function(n){switch(n.label){case 0:return e=d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.DoNotLight|d.MeshInstanceCreationFlags.DoNotOutlineHighlight|d.MeshInstanceCreationFlags.AlwaysDraw|d.MeshInstanceCreationFlags.ExcludeBounding,l||(e|=d.MeshInstanceCreationFlags.DoNotSelect),g=new d.MeshInstanceData(a,
b,c,f,null,null,e),[4,this._viewer.model.createMeshInstance(g,null,!1,!0)];case 1:return p=n.sent(),this._viewer.model.setNodesOpacity([p],k),[2,p]}})})};a.prototype._deleteBackgroundSheetInstances=function(a){void 0===a&&(a=[h.Background,h.Selection,h.Shadow]);return __awaiter(this,void 0,void 0,function(){var c,b,f,d,e;return __generator(this,function(k){c=[];b=0;for(f=a;b<f.length;b++)d=f[b],e=this._sheetIds[d],null!==e&&(this._sheetIds[d]=null,c.push(e));return 0<c.length?[2,this._viewer.model.deleteMeshInstances(c)]:
[2]})})};a.prototype._createOrUpdateSheet=function(a,c,b,f,k,l){return __awaiter(this,void 0,void 0,function(){var e,g,p,h;return __generator(this,function(n){switch(n.label){case 0:e=this._viewer.model;if(null!==this._sheetIds[a])return[3,2];g=this._sheetIds;p=a;return[4,this._createBackgroundSheetInstance(this._backgroundSheetMeshId,c,b,f,k,l)];case 1:return g[p]=n.sent(),[2,Promise.resolve()];case 2:return h=this._sheetIds[a],e.setNodesFaceColor([h],f),e.setNodesOpacity([h],k),null!==l&&e.setInstanceModifier(d.InstanceModifier.DoNotSelect,
[h],!l),[2,e.setNodeMatrix(h,b,!0)]}})})};a.prototype._refreshBackgroundSheets=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b,f,k,l;return __generator(this,function(e){switch(e.label){case 0:a=this._viewer.model;if(!this.isDrawingSheetActive())return this._backgroundSelectionEnabled=!1,[2,this._deleteBackgroundSheetInstances()];if(null!==this._backgroundSheetMeshId)return[3,2];c=this;return[4,this._createBackgroundSheetMesh()];case 1:c._backgroundSheetMeshId=e.sent(),e.label=
2;case 2:return[4,a.getModelBounding(!0,!1)];case 3:return b=e.sent(),f=this._createBackgroundSheetMatrix(b,!1),k=[],this._backgroundSelectionEnabled?[4,this._createOrUpdateSheet(h.Selection,"2d_drawing_background_selection_sheet",f,d.Color.black(),0,!0)]:[3,5];case 4:return e.sent(),[3,6];case 5:k.push(h.Selection),e.label=6;case 6:this._engine.setBackgroundGradient(this._backgroundColor,this._backgroundColor);if(!this._backgroundSheetEnabled)return[3,9];l=this._createBackgroundSheetMatrix(b,!0);
return[4,this._createOrUpdateSheet(h.Background,"2d_drawing_background_sheet",f,this._sheetColor,1,!1)];case 7:return e.sent(),[4,this._createOrUpdateSheet(h.Shadow,"2d_drawing_background_shadow_sheet",l,this._sheetShadowColor,1,!1)];case 8:return e.sent(),[3,10];case 9:k.push(h.Background,h.Shadow),e.label=10;case 10:return 0<k.length?[2,this._deleteBackgroundSheetInstances(k)]:[2]}})})};a.prototype.setSheetColors=function(a,c,b){this._backgroundColor=a.copy();this._sheetColor=c.copy();this._sheetShadowColor=
b.copy();return this._refreshBackgroundSheets()};a.prototype.getSheetBackgroundColor=function(){return this._backgroundColor};a.prototype.getSheetColor=function(){return this._sheetColor};a.prototype.getSheetShadowColor=function(){return this._sheetShadowColor};a.prototype.setBackgroundSheetEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:if(a===this._backgroundSheetEnabled)return[2];this._backgroundSheetEnabled=a;this._viewer.pauseRendering();
return[4,this._refreshBackgroundSheets()];case 1:return c.sent(),this._viewer.resumeRendering(),[2]}})})};a.prototype.getBackgroundSheetEnabled=function(){return this._backgroundSheetEnabled};a.prototype.setBackgroundSelectionEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:this.isDrawingSheetActive()||(a=!1);if(a===this._backgroundSelectionEnabled)return[2];this._backgroundSelectionEnabled=a;this._viewer.pauseRendering();
return[4,this._refreshBackgroundSheets()];case 1:return c.sent(),this._viewer.resumeRendering(),[2]}})})};a.prototype.getBackgroundSelectionEnabled=function(){return this._backgroundSelectionEnabled};a.prototype.startComparison=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return f=this._viewer.view,f.startComparison([a],[c],b),[4,this.setActiveSheetId(a,!1,!1)];case 1:return d.sent(),[4,f.isolateNodes([a,c],0,!0)];
case 2:return d.sent(),[4,this._refreshBackgroundSheets()];case 3:return d.sent(),[2]}})})};a.prototype.endComparison=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===this._activeSheetId?[2]:[4,this.setActiveSheetId(this._activeSheetId,!0,!1)];case 1:return a.sent(),this._viewer.view.endComparison(),[2]}})})};return a}();d.SheetManager=g})(Communicator||(Communicator={}));
(function(d){var h;(function(a){a[a.Model=1]="Model";a[a.Svg=2]="Svg";a[a.Html=4]="Html";a[a.All=7]="All"})(h=d.SnapshotLayer||(d.SnapshotLayer={}));var g=function(){return function(a,d,c){void 0===a&&(a=0);void 0===d&&(d=0);void 0===c&&(c=h.All);this.width=a;this.height=d;this.layers=c}}();d.SnapshotConfig=g})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b){var c=document.createElement("canvas");c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(b,0,0);return c}function a(b){if(b instanceof HTMLCanvasElement&&0<b.clientWidth&&0<b.clientHeight)return b;for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes.item(c);if(d=a(d))return d}return null}function e(b,c){var a=b.getContext("2d");if(null===a)throw new d.CommunicatorError("failed to create 2D canvas context");for(var f=0;f<c.length;f++)a.drawImage(c[f],
0,0);var e=h.OpenPromise.create(),g=new Image;g.src=b.toDataURL();g.onload=function(){e.resolve(g)};return e}var c=function(){function b(b,c){this._domElements=b;this._config=c}b.prototype._extractMarkupSvgAsCanvas=function(){var b=this._domElements.getMarkupSvgElement(),c=(new XMLSerializer).serializeToString(b);b=c;var a=(new DOMParser).parseFromString(b,"text/xml");c=a.getElementsByTagName("defs");for(var d=[],e=0;e<c.length;e++)for(var p=c.item(e).getElementsByTagName("marker"),h=0;h<p.length;h++){var r=
p.item(h);d.push(r)}c=[];p=a.getElementsByTagName("line");for(e=0;e<p.length;e++)if(a=p.item(e),null!==a.style.marker&&0<a.style.marker.length){h=a.style.marker.indexOf("#")+1;r=a.style.marker.indexOf('"',h+1);r=a.style.marker.substring(h,r);var t=null,u=null;for(h=0;h<d.length;h++)if(d[h].id===r){t=d[h];u=d[h+1];break}c.push({line:a,start:t,end:u})}for(d=b.indexOf("marker: url");0<=d;){e=b.indexOf(")",d)+1;a=b.substring(d,e);h=a.indexOf("#")+1;p=a.indexOf('"',h);r=a.indexOf("&quot",h+11+1);t=p;if(0>
p||r<p)t=r;h=a.substring(h,t);p=0;for(r=c;p<r.length;p++)if(a=r[p],t=a.start,a=a.end,null!==t&&null!==a&&t.id===h){h="marker-start: url('#"+t.id+"');";h+="marker-end: url('#"+a.id+"')";b=b.slice(0,d)+h+b.slice(e);break}d=b.indexOf("marker: url",e+1)}c=b;b=document.createElement("canvas");document.body.appendChild(b);canvg(b,c);c=g(b);document.body.removeChild(b);return c};b.prototype._extractRedlineSvgAsCanvas=function(b,c){var a=this._domElements.getRedlineSvgElement();a.setAttribute("width",""+
b);a.setAttribute("height",""+c);a=(new XMLSerializer).serializeToString(a);a=a.replace("width: 100%;","width: "+b+";");a=a.replace("height: 100%;","height: "+c+";");b=document.createElement("canvas");document.body.appendChild(b);canvg(b,a);c=g(b);document.body.removeChild(b);return c};b.prototype._extractRedlineAsCanvas=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){b=this._domElements.getRedlineElement();return[2,html2canvas(b,{background:void 0,
letterRendering:!0})]})})};b.prototype.capture=function(b){return __awaiter(this,void 0,void 0,function(){var c,f,n,m,p;return __generator(this,function(k){switch(k.label){case 0:c=a(b);if(null===c)throw new d.CommunicatorError("failed to find canvas");f=document.createElement("canvas");f.width=this._config.width||b.clientWidth;f.height=this._config.height||b.clientHeight;f.style.width="100%";f.style.height="100%";n=[];this._config.layers&d.SnapshotLayer.Model&&n.push(g(c));this._config.layers&d.SnapshotLayer.Svg&&
(n.push(this._extractMarkupSvgAsCanvas()),n.push(this._extractRedlineSvgAsCanvas(f.width,f.height)));if(!(this._config.layers&d.SnapshotLayer.Html))return[3,2];p=(m=n).push;return[4,this._extractRedlineAsCanvas()];case 1:p.apply(m,[k.sent()]),k.label=2;case 2:return[2,e(f,n)]}})})};return b}();h.Snapshot=c})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function b(){this._strokeWidth=1;this._strokeColor=d.Color.black()}b.prototype._assign=function(b){this._strokeWidth=b._strokeWidth;this._strokeColor.assign(b._strokeColor)};b.prototype.setStrokeColor=function(b){this._strokeColor.assign(b)};b.prototype.getStrokeColor=function(){return this._strokeColor.copy()};b.prototype.setStrokeWidth=function(b){this._strokeWidth=b};b.prototype.getStrokeWidth=function(){return this._strokeWidth};return b}();
g.StrokedShape=a;var e=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c._fillColor=d.Color.black();c._fillOpacity=1;return c}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._fillColor.assign(c._fillColor);this._fillOpacity=c._fillOpacity};c.prototype.getFillOpacity=function(){return this._fillOpacity};c.prototype.setFillOpacity=function(b){this._fillOpacity=b};c.prototype.setFillColor=function(b){this._fillColor.assign(b)};c.prototype.getFillColor=
function(){return this._fillColor.copy()};return c}(a);g.FilledShape=e;var c;(function(b){b[b.None=0]="None";b[b.Arrowhead=1]="Arrowhead";b[b.Circle=2]="Circle"})(c=g.EndcapType||(g.EndcapType={}));a=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a._startEndcapType=c.None;a._startEndcapColor=d.Color.black();a._startEndcapSize=9;a._endEndcapType=c.None;a._endEndcapColor=d.Color.black();a._endEndcapSize=9;a._endcapsInverted=!1;return a}__extends(a,b);a.prototype._assign=function(c){b.prototype._assign.call(this,
c);this._startEndcapType=c._startEndcapType;this._startEndcapColor.assign(c._startEndcapColor);this._startEndcapSize=c._startEndcapSize;this._endEndcapType=c._endEndcapType;this._endEndcapColor.assign(c._endEndcapColor);this._endEndcapSize=c._endEndcapSize;this._endcapsInverted=c._endcapsInverted};a.prototype.getStartEndcapType=function(){return this._startEndcapType};a.prototype.setStartEndcapType=function(b){this._startEndcapType=b};a.prototype.getStartEndcapColor=function(){return this._startEndcapColor.copy()};
a.prototype.setStartEndcapColor=function(b){this._startEndcapColor.assign(b)};a.prototype.getStartEndcapSize=function(){return this._startEndcapSize};a.prototype.setStartEndcapSize=function(b){this._startEndcapSize=b};a.prototype.getEndEndcapType=function(){return this._endEndcapType};a.prototype.setEndEndcapType=function(b){this._endEndcapType=b};a.prototype.setEndcapType=function(b){this._endEndcapType=this._startEndcapType=b};a.prototype.getEndEndcapSize=function(){return this._endEndcapSize};
a.prototype.setEndEndcapSize=function(b){this._endEndcapSize=b};a.prototype.getEndEndcapColor=function(){return this._endEndcapColor.copy()};a.prototype.setEndEndcapColor=function(b){this._endEndcapColor.assign(b)};a.prototype.getEndcapsInverted=function(){return this._endcapsInverted};a.prototype.setEndcapsInverted=function(b){this._endcapsInverted=b};return a}(a);g.EndcapShape=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c._borderRadius=0;return c}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._borderRadius=c._borderRadius};c.prototype.getBorderRadius=function(){return this._borderRadius};c.prototype.setBorderRadius=function(b){this._borderRadius=b};return c}(g.FilledShape);g.RectangleBase=a;var e=function(b){function c(c,a){var f=b.call(this)||this;f._position=
d.Point2.zero();f._size=d.Point2.zero();c&&f._position.assign(c);a&&f._size.assign(a);return f}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._position.assign(c._position);this._size.assign(c._size)};c.prototype.setPosition=function(b){this._position.assign(b)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(b){this._size.assign(b)};c.prototype.getSize=function(){return this._size.copy()};return c}(a);g.Rectangle=
e;var c=function(){return function(b,c){this.position=b.copy();this.size=c.copy()}}();g._MarkupRectangleData=c;a=function(b){function a(){var c=null!==b&&b.apply(this,arguments)||this;c._rectangles=[];return c}__extends(a,b);a.prototype.clear=function(){this._rectangles=[]};a.prototype.addRectangle=function(b,a){this._rectangles.push(new c(b,a))};a.prototype.getRectangles=function(){return this._rectangles};return a}(a);g.RectangleCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(g){var a=function(b){function c(){var c=b.call(this)||this;c._fontFamily=null;c._fontSize=12;c.setStrokeWidth(0);return c}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._fontFamily=c._fontFamily;this._fontSize=c._fontSize};c.prototype.getFontFamily=function(){return this._fontFamily};c.prototype.setFontFamily=function(b){this._fontFamily=b};c.prototype.setFontSize=function(b){this._fontSize=b};c.prototype.getFontSize=function(){return this._fontSize};
return c}(g.FilledShape);g.TextMarkupBase=a;var e=function(b){function c(c,a){var f=b.call(this)||this;f._position=d.Point2.zero();f._text="";a&&(f._position=a.copy());c&&f.setText(c);return f}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._text=c._text;this._position.assign(c._position)};c.prototype.setPosition=function(b){this._position.assign(b)};c.prototype.getPosition=function(){return this._position};c.prototype.setText=function(b){this._text=b};c.prototype.getText=
function(){return this._text};return c}(a);g.Text=e;var c=function(){return function(b,c){this.text=b;this.position=c.copy()}}();g._MarkupTextData=c;a=function(b){function a(){var c=null!==b&&b.apply(this,arguments)||this;c._textStrings=[];return c}__extends(a,b);a.prototype.clear=function(){this._textStrings=[]};a.prototype.addString=function(b,a){this._textStrings.push(new c(b,a))};a.prototype.getStrings=function(){return this._textStrings};return a}(a);g.TextCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._behindView=!1}a.prototype.remove=function(){};a.prototype.draw=function(){};a.prototype.hit=function(a){a;return!1};a.prototype.hitWithTolerance=function(a,c){a;c;return!1};a.prototype.onSelect=function(){};a.prototype.onDeselect=function(){};a.prototype.toJson=function(){return{}};a.prototype.forJson=function(){return this.toJson()};a.prototype.getClassName=function(){return"Communicator.Markup.MarkupItem"};return a}();d.MarkupItem=g})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(c){function b(b){var a=c.call(this)||this;a._position=new d.Point2(10,10);a._nextItemPosition=d.Point2.zero();a._statItemOffset=new d.Point2(5,5);a._maxStatWidth=0;a._viewer=b;a._backgroundPanel=new d.Markup.Shape.Rectangle(a._position,new d.Point2(300,100));a._backgroundPanel.setFillColor(d.Color.white());a._backgroundPanel.setStrokeWidth(0);a._statsText=new d.Markup.Shape.TextCollection;return a}__extends(b,c);b.prototype.draw=function(){this._updateBackgroundSize();
var b=this._viewer.markupManager.getRenderer();b.drawRectangle(this._backgroundPanel);b.drawTexts(this._statsText)};b.prototype.clearStatsText=function(){this._statsText.clear();this._nextItemPosition.assign(this._position)};b.prototype.setPosition=function(b){this._position.assign(b);this._backgroundPanel.setPosition(this._position)};b.prototype.addStatistic=function(b,c){var a=d.Point2.add(this._nextItemPosition,this._statItemOffset);this._statsText.addString(b+": "+c,a);this._nextItemPosition.y+=
this._statsText.getFontSize()};b.prototype._updateBackgroundSize=function(){for(var b=this._viewer.markupManager.getRenderer(),c=this._statsText.getStrings(),a=this._statsText.getFontSize(),e=0;e<c.length;e++){var g=b.measureText(c[e].text,this._statsText);this._maxStatWidth=Math.max(this._maxStatWidth,g.x)}this._backgroundPanel.setSize(new d.Point2(2*this._statItemOffset.x+this._maxStatWidth,c.length*(a+this._statItemOffset.y)))};return b}(d.Markup.MarkupItem),a=function(){return function(){this.total_triangle_count=
this.total_element_count=0}}();h.StatisticMap=a;var e=function(){function c(b,c){var f=this;this._statisticsDisplayHandle=null;this._statistics=new a;this._viewer=c;this._callbackManager=b;this._callbackManager.bind({frameDrawn:function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.update()];case 1:return b.sent(),[2]}})})}});this._statisticsDisplay=new g(this._viewer)}c.prototype.update=function(){return __awaiter(this,void 0,
void 0,function(){var b,c,a,d,e,g,p;return __generator(this,function(f){switch(f.label){case 0:return[4,this._viewer.getStatistics()];case 1:this._statistics=b=f.sent();this._statisticsDisplay.clearStatsText();c=Object.keys(this._statistics);a=0;for(d=c;a<d.length;a++)g=e=d[a],p=this._statistics[g],this._statisticsDisplay.addStatistic(g,p.toString());return[2]}})})};c.prototype.isShown=function(){return null!==this._statisticsDisplayHandle};c.prototype.getStatistics=function(){return this._statistics};
c.prototype.showDisplay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this.isShown()?[3,2]:[4,this.update()];case 1:b.sent(),this._statisticsDisplayHandle=this._viewer.markupManager.registerMarkup(this._statisticsDisplay),b.label=2;case 2:return[2]}})})};c.prototype.hideDisplay=function(){this.isShown()&&(this._viewer.markupManager.unregisterMarkup(this._statisticsDisplayHandle),this._statisticsDisplayHandle=null)};return c}();
h.Statistics=e})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){var h=function(){return function(){this.svgXmlPrologEnabled=!0;this.svgBackgroundCssColor="";this.linesDrawModelLinesEnabled=this.silhouettesEnabled=!0;this.linesStrokeWidth=20;this.linesCssColor="#000000";this.linesClipZNudgeFactor=this.linesClipProximityToPlane=5.5;this.polygonsForceDrawCssColor="";this.logDiagnostics=this.logProgress=!1}}();d.SvgConfig=h})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.Rgba32=0]="Rgba32";d[d.Rgb24=1]="Rgb24";d[d.Gray8=2]="Gray8";d[d.GrayAlpha16=3]="GrayAlpha16";d[d.Jpeg=4]="Jpeg";d[d.Png=5]="Png"})(d.ImageFormat||(d.ImageFormat={}));(function(d){d[d.Clamp=0]="Clamp";d[d.Repeat=1]="Repeat";d[d.Trim=2]="Trim"})(d.TextureTiling||(d.TextureTiling={}));(function(d){d[d.UV=0]="UV"})(d.TextureParameterization||(d.TextureParameterization={}));(function(d){d[d.Decal=1]="Decal"})(d.TextureModifier||(d.TextureModifier={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){var g=function(){function a(a){this._timeoutDurationMinutes=15;this._timeoutWarningMinutes=14;this._timer=new d.Util.Timer;this._enabled=!0;this._callbackManager=a;this.resetTimeout()}a.prototype.setTimeoutDurations=function(a,c){this._timeoutDurationMinutes=a;this._timeoutWarningMinutes=c;this.resetTimeout();return!0};a.prototype.shutdown=function(){this._enabled=!1;this._timer.clear()};a.prototype.resetTimeout=function(){var a=this;this._enabled&&this._timer.set(Math.round(6E4*this._timeoutWarningMinutes),
function(){a._warn()})};a.prototype._warn=function(){var a=this;console.assert(this._timer.isIdle(0));var c=this._timeoutDurationMinutes-this._timeoutWarningMinutes,b=Math.round(6E4*c);this._callbackManager.trigger("timeoutWarning",c);this._timer.set(b,function(){a._timeout()})};a.prototype._timeout=function(){this._callbackManager.trigger("timeout");this._callbackManager.trigger("_timeout")};return a}();h.TimeoutMonitor=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.create=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(g){var a=new Uint32Array(1);d.Internal.getCrypto().getRandomValues(a);a=a[0]/4294967295*16|0;return("x"===g?a:a&3|8).toString(16)})}})(d.UUID||(d.UUID={}))})(Communicator||(Communicator={}));(function(d){(function(h){h.create=function(){return d.UUID.create()}})(d.GUID||(d.GUID={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e,c,b,f,k,g,n){this._backfacesVisible=!1;this._initialCamera=null;this._boundingCalculationIgnoresInvisible=this._faceVisibility=this._lineVisibility=!0;this._backgroundColorBottom=this._backgroundColorTop=null;this._drawMode=d.DrawMode.WireframeOnShaded;this._ambientOcclusionEnabled=!1;this._ambientOcclusionRadius=.03;this._antiAliasingMode=d.AntiAliasingMode.SMAA;this._lightingEnabled=!0;this._ambientLightColor=d.Color.black();this._massageExtremeCameras=
!0;this._bloomEnabled=!1;this._bloomIntensityScale=this._bloomThresholdRampWidth=this._bloomThreshold=0;this._bloomLayers=[];this._hardEdgesEnabled=this._silhouetteEnabled=this._simpleReflectionEnabled=this._simpleShadowEnabled=!1;this._imageBasedLightingEnabled=!0;this._lineJitterEnabled=!1;this._hiddenLineSettings=new d.Settings.HiddenLineSettings;this._projectionMode=d.Projection.Orthographic;this._drawStrategy=d.DrawStrategy.FixedFramerate;var l=a.getCreationParameters();this._viewer=a;this._engine=
e;this._callbackManager=c;this._interpolationManager=f;this._eventDispatcher=b;this._model=a.model;this._statistics=k;this._navCube=g;this._axisTriad=n;this._determineInitialAxes=d.Internal.getWithDefault(l.calculateDefaultViewAxes,!0);this._initEvents()}g.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","View",d);return b.apply(this,c)};return c};g.prototype._initEvents=function(){var a=
this;this._callbackManager.bind({_resetAssemblyTreeBegin:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){this._initialCamera=null;return[2]})})},_firstAttachment:function(e){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(c){return e===d.Internal.AttachType.Direct?[2,this._massageInitialCamera(!1)]:[2]})})},_firstModelLoaded:function(d,c){return c?Promise.resolve():a._massageInitialCamera(!1)},_modelSwitched:function(d){return __awaiter(a,
void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return d?[3,2]:[4,this._massageInitialCamera(!1)];case 1:return c.sent(),[2,this._setInitialView(0)];case 2:return[2]}})})},hwfParseComplete:function(){return a._massageInitialCamera(!0)},_modelStructureHeaderParsed:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){return this._viewer.sheetManager.isDrawingSheetActive()?(this._model.setViewAxes(new d.Point3(0,0,1),new d.Point3(0,
1,0)),[2,this.setViewOrientation(d.ViewOrientation.Front,0)]):[2]})})},_sessionStarted:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){this.setBloomIntensityScale(1);this.setBloomThreshold(.65);this.setBloomThresholdRampWidth(.1);this.setBloomLayers([{intensity:.5,blurSamples:5,blurInterval:[.0025,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,blurSamples:5,blurInterval:[.005,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,blurSamples:9,blurInterval:[.01,
d.BlurIntervalUnit.ProportionOfHeight]},{intensity:1,blurSamples:9,blurInterval:[.02,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:2,blurSamples:11,blurInterval:[.04,d.BlurIntervalUnit.ProportionOfHeight]}]);this.setGroundPlane({normal:new d.Point3(0,0,1),followViewAxes:!0});this.setSimpleShadowColor(d.Color.black());this.setSimpleShadowOpacity(.65);this.setSimpleShadowResolution(512);this.setSimpleShadowBlurSamples(5);this.setSimpleShadowBlurInterval(1);this.setSimpleShadowInteractiveUpdateEnabled();
this.setSimpleReflectionOpacity(.65);this.setSimpleReflectionFadeAngle(10);this.setSimpleReflectionBlurSamples(9);this.setSimpleReflectionBlurInterval(1,d.BlurIntervalUnit.Pixels);this.setSimpleReflectionAttenuation(0,1,d.SimpleReflectionAttenuationUnit.ProportionOfBoundingHeight);this.setSilhouetteColor(d.Color.black());this.setSilhouetteOpacity(1);this.setSilhouetteThreshold(.05);this.setSilhouetteThresholdRampWidth(.025);this.setHardEdgeColor(d.Color.black());this.setHardEdgeOpacity(1);this.setHardEdgeThreshold(30);
this.setHardEdgeThresholdRampWidth(20);this.setImageBasedLightingIntensity(1);this.setImageBasedLightingOrientation({matrix:new d.Matrix,followViewAxes:!0});this.setGoochBlue(.55);this.setGoochYellow(.3);this.setGoochBaseColorProminence(.25);this.setGoochLuminanceShiftStrength(.5);this.setLineJitterInstanceCount(4);this.setLineJitterFrequency(5);this.setLineJitterRadius(.005);this.setToonShadingBandCount(3);this.setToonShadingSpecularFactor(1);return[2]})})},viewAxes:function(d,c){a._updateGroundPlane(d,
c);a._updateImageBasedLightingOrientation(d,c)}})};g.prototype._massageInitialCamera=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null!==this._initialCamera)return[2];d=this;return[4,this._engine.getCameraPromise()];case 1:return d._initialCamera=c.sent(),this._projectionMode=this._initialCamera.getProjection(),!this._determineInitialAxes||this._viewer.sheetManager.isDrawingSheetActive()||this._model.viewAxesHaveBeenSet()||
this._determineViewAxes(this._initialCamera),a?[4,this.fitWorld()]:[3,3];case 2:c.sent(),this._initialCamera=this.getCamera(),c.label=3;case 3:return[2]}})})};g.prototype.setLineVisibility=function(a){this._setLineVisibility(a);return Promise.resolve()};g.prototype._setLineVisibility=function(a){a!==this._lineVisibility&&(this._lineVisibility=a,this._engine.setLineVisibility(a))};g.prototype.getLineVisibility=function(){return this._lineVisibility};g.prototype.setFaceVisibility=function(a){this._setFaceVisibility(a);
return Promise.resolve()};g.prototype._setFaceVisibility=function(a){a!==this._faceVisibility&&(this._faceVisibility=a,this._engine.setFaceVisibility(a));return Promise.resolve()};g.prototype.getFaceVisibility=function(){return this._faceVisibility};g.prototype.setProjectionMode=function(a){this._projectionMode!==a&&(this._projectionMode=a,this._engine.isInit()&&this._engine.setProjection(a),this._eventDispatcher.injectViewOrientationChangeEvent())};g.prototype.getProjectionMode=function(){return this._projectionMode};
g.prototype.getDrawStrategy=function(){return this._drawStrategy};g.prototype.getViewMatrix=function(){return this._engine.getViewMatrix()};g.prototype.getProjectionMatrix=function(){return this._engine.getProjectionMatrix()};g.prototype.getFullCameraMatrix=function(){return this._engine.getFullCameraMatrix()};g.prototype.raycastFromPoint=function(a){var e=this.getCanvasSize(),c=this._engine.getViewMatrix(),b=this._engine.getProjectionMatrix(),f=new d.Point3(a.x,e.y-a.y,0);a=this._unproject(f,b,c,
e);if(null===a)return null;f.z=.5;e=this._unproject(f,b,c,e);if(null===e)return null;e=d.Point3.subtract(e,a).normalize();return new d.Ray(a,e)};g.prototype._unproject=function(a,e,c,b){e=d.Matrix.multiply(c,e);e=d.Matrix.inverse(e);if(null===e)return null;a=new d.Point4(a.x,a.y,a.z,1);a.x/=b.x;a.y/=b.y;a.x=2*a.x-1;a.y=2*a.y-1;a.z=2*a.z-1;b=e.transform4(a);if(0===b.w)return null;b.scale(1/b.w);return new d.Point3(b.x,b.y,b.z)};g.prototype._rectifySelectionItem=function(a){var d=a.getInclusionKey(),
c=a.getNodeId();d=this._model._getNodeFromInstanceInc(!1,d,c,!0);a._setNodeId(d)};g.prototype.isOutsideCanvasArea=function(a){var d=this.getCanvasSize();return 0>a.x||0>a.y||a.x>=d.x||a.y>=d.y};g.prototype.pickFromPoint=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:if(this.isOutsideCanvasArea(a))throw new d.PickOutsideCanvasError;return[4,this._engine.pickFromScreen(a,e,this._viewer.sheetManager.isDrawingSheetActive())];
case 1:return(c=b.sent())?(this._rectifySelectionItem(c),[2,c]):[2,d.Selection.SelectionItem.create()]}})})};g.prototype.pickAllFromPoint=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f,k;return __generator(this,function(g){switch(g.label){case 0:if(this.isOutsideCanvasArea(a))throw new d.PickOutsideCanvasError;return[4,this._engine.pickAllFromScreen(a,e,this._viewer.sheetManager.isDrawingSheetActive())];case 1:c=g.sent();b=0;for(f=c;b<f.length;b++)k=f[b],this._rectifySelectionItem(k);
return[2,c]}})})};g.prototype.compositePickFromPoint=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:if(this.isOutsideCanvasArea(a))throw new d.PickOutsideCanvasError;return[4,this._engine.compositePickFromScreen(a,e,this._viewer.sheetManager.isDrawingSheetActive())];case 1:return c=b.sent(),null!==c.faceItem&&this._rectifySelectionItem(c.faceItem),null!==c.lineItem&&this._rectifySelectionItem(c.lineItem),null!==c.pointItem&&
this._rectifySelectionItem(c.pointItem),[2,c]}})})};g.prototype.pickFromRay=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._engine.pickFromRay(a,e)];case 1:return(c=b.sent())?(this._rectifySelectionItem(c),[2,c]):[2,d.Selection.SelectionItem.create()]}})})};g.prototype.pickAllFromRay=function(a,d){return __awaiter(this,void 0,void 0,function(){var c,b,f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,
this._engine.pickAllFromRay(a,d)];case 1:c=k.sent();b=0;for(f=c;b<f.length;b++)e=f[b],this._rectifySelectionItem(e);return[2,c]}})})};g.prototype.beginScreenSelectByArea=function(a,e,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isOutsideCanvasArea(a)||this.isOutsideCanvasArea(e))throw new d.PickOutsideCanvasError;return[2,this._engine.beginScreenAreaSelection(a,e,c)]})})};g.prototype.beginRayDrillSelection=function(a,e,c){return __awaiter(this,void 0,
void 0,function(){return __generator(this,function(b){if(this.isOutsideCanvasArea(a))throw new d.PickOutsideCanvasError;return[2,this._engine.beginRayDrillSelection(a,e,c)]})})};g.prototype.beginConvexPolyhedronSelection=function(a,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._engine.beginConvexPolyhedronSelection(a,d,c)]})})};g.prototype.beginSphereSelection=function(a,e,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,
function(f){b=d.Internal.toVec3(a);return[2,this._engine.beginSphereSelection(b,e,c)]})})};g.prototype.endIncrementalSelection=function(a){this._endIncrementalSelection(a);return Promise.resolve()};g.prototype._endIncrementalSelection=function(a){this._engine.endIncrementalSelection(a)};g.prototype.endVolumeSelection=function(a){return this.endIncrementalSelection(a)};g.prototype.advanceIncrementalSelection=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,k,g,n,m,p,h;return __generator(this,
function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this._engine.advanceIncrementalSelection(a)];case 1:e=l.sent();if(null===e)return[2,null];c=this._viewer.selectionManager;b=[];f=0;for(k=e;f<k.length;f++)g=k[f],this._rectifySelectionItem(g),n=g,m=n.getNodeId(),(p=c._incrementalBlacklistedInstanceNodes.has(m))||b.push(n);return[2,b];case 2:h=l.sent();if("advanceVolumeSelection"===h.scFunction)throw new d.SelectionInvalidatedError;throw h;case 3:return[2]}})})};g.prototype.advanceVolumeSelection=
function(a){return this.advanceIncrementalSelection(a)};g.prototype.projectPoint=function(a,d){if(void 0!==d){var c=d.getProjectionMatrix(this._viewer);var b=d.getViewMatrix(this._viewer)}else c=this._engine.getSynchedProjectionMatrix(),b=this._engine.getSynchedViewMatrix();d=this.getCanvasSize();a=this._project(a,c,b,d);a.y=d.y-a.y;return a};g.prototype._project=function(a,e,c,b){a=new d.Point4(a.x,a.y,a.z,1);c.transform4(a,a);e.transform4(a,a);e=0>=a.w;c=a.w;0>=a.w&&(a.w=.001);a.scale(1/a.w);a.x=
.5*a.x+.5;a.y=.5*a.y+.5;a.z=.5*a.z+.5;a.x*=b.x;a.y*=b.y;e&&(a.z=c);return new d.Point3(a.x,a.y,a.z)};g.prototype.unprojectPoint=function(a,e){var c=this.getCanvasSize(),b=this.getProjectionMatrix(),f=this.getViewMatrix();a=new d.Point3(a.x,c.y-a.y,e);return this._unproject(a,b,f,c)};g.prototype.pointToWindowPosition=function(a){var e=this._engine.getCanvasSize();return new d.Point2(a.x/e.x*2-1,1-a.y/e.y*2)};g.prototype.setInitialCamera=function(a){this._initialCamera=a.copy()};g.prototype.setCamera=
function(a,d){void 0===d&&(d=0);return null===a?!1:this._setCameraImpl(a,d).unsafeValue};g.prototype._setCameraPromise=function(a,d){return this._setCameraImpl(a,d).readyPromise};g.prototype._setCameraImpl=function(a,e){return 0<e?this._interpolateCamera(a,e):this._engine.isInit()?(e=a.getProjection(),this._projectionMode!==e&&this.setProjectionMode(e),this._engine.setCamera(a),e=this._markupManager?this._markupManager._setActiveMarkupView(null):Promise.resolve(),this._callbackManager.trigger("camera",
a),d.Internal.UnsafePromise.create(!0,e)):d.Internal.UnsafePromise.create(!1,Promise.resolve())};g.prototype._interpolateCamera=function(a,e){var c=this;if(this._engine.isInit()){var b=this.getCamera();if(b.equals(a))return this._markupManager&&this._markupManager._update(),d.Internal.UnsafePromise.create(!1,Promise.resolve());this._callbackManager.trigger("transitionBegin",e);var f=d.Util.OpenPromise.create();this._interpolationManager.start(new d.Internal.CameraInterpolation(b,a,e,function(){c._eventDispatcher.injectViewOrientationChangeEvent();
c._callbackManager.trigger("transitionEnd");f.resolve()},this));return d.Internal.UnsafePromise.create(!0,f)}return d.Internal.UnsafePromise.create(!1,Promise.resolve())};g.prototype.updateCamera=function(a){a=this._engine.updateCamera(a);this._callbackManager.trigger("camera",a);return a};g.prototype.resetCamera=function(a){void 0===a&&(a=d.DefaultTransitionDuration);return this._setInitialView(a)};g.prototype.getCamera=function(){if(this._engine.isInit())return this._engine.getCamera();throw new d.CommunicatorError("getCamera() called before sceneReady");
};g.prototype.getViewOrientationCamera=function(a,e,c){void 0===c&&(c=!0);return __awaiter(this,void 0,void 0,function(){var b,f,k,g,n,m,p,h,r,t,u,w,v,y,x,z,A,C,B,D,F,E;return __generator(this,function(l){switch(l.label){case 0:return b=this.getCamera(),f=b.getUp().copy().normalize(),k=this._model.getViewAxes(),g=k.upVector.copy(),n=k.frontVector.copy(),void 0!==e?[3,2]:[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return e=l.sent(),[3,3];case 2:this._fitCameraToBounding(b,
e),l.label=3;case 3:m=e.center();p=m.copy();h=m.copy();r=d.Point3.subtract(b.getPosition(),b.getTarget()).length();t=d.Point3.subtract(b.getPosition(),m).length();u=new d.Point3(0,0,1);w=new d.Point3(-1,0,0);null!==g&&(u=g.copy());null!==n&&(w=n.copy());v=w.copy().scale(-1);y=w.copy();x=u.copy();z=u.copy().scale(-1);A=d.Point3.cross(x,v);C=A.copy().scale(-1);B=function(b){b=d.Point3.subtract(h,b);var c=u,a=d.Util.computeAngleBetweenVector(b,u);if(0===a||180===a)c=w;var e=d.Point3.cross(b,c),k=e.copy().negate(),
g=d.Point3.cross(b,e),l=g.copy().negate();b=Infinity;c=e;a=0;for(e=[e,k,g,l];a<e.length;a++)k=e[a],g=d.Util.computeAngleBetweenVector(f,k),g<=b&&(b=g,c=k);return c.normalize()};D=null;switch(a){case d.ViewOrientation.Front:p=d.Point3.add(h,y);break;case d.ViewOrientation.Back:p=d.Point3.add(h,v);break;case d.ViewOrientation.Left:p=d.Point3.add(h,A);break;case d.ViewOrientation.Right:p=d.Point3.add(h,C);break;case d.ViewOrientation.Bottom:p=d.Point3.add(h,z);D=v.copy();break;case d.ViewOrientation.Top:p=
d.Point3.add(h,x);D=v.copy();break;case d.ViewOrientation.FrontTop:case d.ViewOrientation.TopFront:p=d.Point3.add(h,d.Point3.add(y,x));D=d.Point3.add(v,x).normalize();break;case d.ViewOrientation.FrontTopLeft:case d.ViewOrientation.LeftTopFront:case d.ViewOrientation.TopLeftFront:p=d.Point3.add(h,d.Point3.add(y,d.Point3.add(A,x)));D=d.Point3.add(v,d.Point3.add(C,x)).normalize();break;case d.ViewOrientation.Iso:case d.ViewOrientation.FrontTopRight:case d.ViewOrientation.RightTopFront:case d.ViewOrientation.TopRightFront:p=
d.Point3.add(h,d.Point3.add(y,d.Point3.add(C,x)));D=d.Point3.add(v,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.FrontLeft:case d.ViewOrientation.LeftFront:p=d.Point3.add(h,d.Point3.add(y,A));break;case d.ViewOrientation.FrontRight:case d.ViewOrientation.RightFront:p=d.Point3.add(h,d.Point3.add(y,C));break;case d.ViewOrientation.FrontBottom:case d.ViewOrientation.BottomFront:p=d.Point3.add(h,d.Point3.add(y,z));D=d.Point3.add(y,x).normalize();break;case d.ViewOrientation.FrontBottomLeft:case d.ViewOrientation.LeftBottomFront:case d.ViewOrientation.BottomLeftFront:p=
d.Point3.add(h,d.Point3.add(y,d.Point3.add(A,z)));D=d.Point3.add(y,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.FrontBottomRight:case d.ViewOrientation.RightBottomFront:case d.ViewOrientation.BottomRightFront:p=d.Point3.add(h,d.Point3.add(y,d.Point3.add(C,z)));D=d.Point3.add(y,d.Point3.add(C,x)).normalize();break;case d.ViewOrientation.BackTop:case d.ViewOrientation.TopBack:p=d.Point3.add(h,d.Point3.add(v,x));D=d.Point3.add(y,x).normalize();break;case d.ViewOrientation.BackTopLeft:case d.ViewOrientation.LeftTopBack:case d.ViewOrientation.TopLeftBack:p=
d.Point3.add(h,d.Point3.add(v,d.Point3.add(A,x)));D=d.Point3.add(y,d.Point3.add(C,x)).normalize();break;case d.ViewOrientation.BackTopRight:case d.ViewOrientation.RightTopBack:case d.ViewOrientation.TopRightBack:p=d.Point3.add(h,d.Point3.add(v,d.Point3.add(C,x)));D=d.Point3.add(y,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.BackLeft:case d.ViewOrientation.LeftBack:p=d.Point3.add(h,d.Point3.add(v,A));break;case d.ViewOrientation.BackRight:case d.ViewOrientation.RightBack:p=d.Point3.add(h,
d.Point3.add(v,C));break;case d.ViewOrientation.BackBottom:case d.ViewOrientation.BottomBack:p=d.Point3.add(h,d.Point3.add(v,z));D=d.Point3.add(v,x).normalize();break;case d.ViewOrientation.BackBottomLeft:case d.ViewOrientation.LeftBottomBack:case d.ViewOrientation.BottomLeftBack:p=d.Point3.add(h,d.Point3.add(v,d.Point3.add(A,z)));D=d.Point3.add(v,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.BackBottomRight:case d.ViewOrientation.RightBottomBack:case d.ViewOrientation.BottomRightBack:p=
d.Point3.add(h,d.Point3.add(v,d.Point3.add(C,z)));D=d.Point3.add(v,d.Point3.add(C,x)).normalize();break;case d.ViewOrientation.LeftBottom:case d.ViewOrientation.BottomLeft:p=d.Point3.add(h,d.Point3.add(A,z));D=d.Point3.add(A,x).normalize();break;case d.ViewOrientation.LeftTop:case d.ViewOrientation.TopLeft:p=d.Point3.add(h,d.Point3.add(A,x));D=d.Point3.add(C,x).normalize();break;case d.ViewOrientation.RightBottom:case d.ViewOrientation.BottomRight:p=d.Point3.add(h,d.Point3.add(C,z));D=d.Point3.add(C,
x).normalize();break;case d.ViewOrientation.RightTop:case d.ViewOrientation.TopRight:p=d.Point3.add(h,d.Point3.add(C,x));D=d.Point3.add(A,x).normalize();break;default:d.Util.TypeAssertNever(a)}c||(D=B(p));null===D&&(D=u);F=d.Point3.add(d.Point3.subtract(p,m).normalize().scale(t),m);E=d.Point3.add(d.Point3.subtract(p,m).normalize().scale(t-r),m);b.setPosition(F);b.setTarget(E);b.setUp(D);return[2,b]}})})};g.prototype.setViewOrientation=function(a,e,c,b){void 0===e&&(e=d.DefaultTransitionDuration);
void 0===b&&(b=!0);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this.getViewOrientationCamera(a,c,b)];case 1:return f=d.sent(),void 0!==c?[3,3]:[4,this.fitWorld(e,f)];case 2:return d.sent(),[3,5];case 3:return[4,this.fitBounding(c,e,f)];case 4:d.sent(),d.label=5;case 5:return this._callbackManager.trigger("viewOrientation",a),[2]}})})};g.prototype.centerCameraOnNode=function(a,e,c){void 0===e&&(e=0);void 0===c&&(c=this.getCamera());
return __awaiter(this,void 0,void 0,function(){var b,f,k,g,n;return __generator(this,function(l){switch(l.label){case 0:return[4,this._model.getNodesBounding([a])];case 1:b=l.sent();f=b.center();k=c.getPosition();g=c.getTarget();n=d.Point3.subtract(g,f);k.subtract(n);c.setPosition(k);c.setTarget(f);if(0<e)return[2,this._setCameraPromise(c,e)];this.setCamera(c);return[2]}})})};g.prototype._setInitialView=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){if(!this._initialCamera)return[2,
this.fitWorld(a)];if(0<a)return[2,this._setCameraPromise(this._initialCamera,a)];this.setCamera(this._initialCamera);this._eventDispatcher.injectViewOrientationChangeEvent();return[2]})})};g.prototype.getCanvasSize=function(){return this._engine.getCanvasSize()};g.prototype._setMarkupManager=function(a){this._markupManager=a};g.prototype.setStatisticsDisplayVisibility=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return a?[4,
this._statistics.showDisplay()]:[3,2];case 1:return d.sent(),[3,3];case 2:this._statistics.hideDisplay(),d.label=3;case 3:return[2]}})})};g.prototype.getBackgroundColor=function(){var a=null!==this._backgroundColorTop?this._backgroundColorTop.copy():null,e=null!==this._backgroundColorBottom?this._backgroundColorBottom.copy():null;return new d.VerticalGradient(a,e)};g.prototype.setBackgroundColor=function(a,e){void 0===a&&(a=null);void 0===e&&(e=null);this._backgroundColorTop=null!==a?a.copy():null;
this._backgroundColorBottom=null!==e?e.copy():null;this._drawMode===d.DrawMode.HiddenLine||this._viewer.sheetManager.isDrawingSheetActive()||this._engine.setBackgroundGradient(this._backgroundColorTop,this._backgroundColorBottom);return Promise.resolve()};g.prototype.isolateNodes=function(a,e,c,b){void 0===e&&(e=d.DefaultTransitionDuration);void 0===c&&(c=!0);void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var f,d,g,n,m;return __generator(this,function(k){switch(k.label){case 0:f=
this._model.getAbsoluteRootNode();d=new Map;d.set(f,!1);g=0;for(n=a;g<n.length;g++)m=n[g],d.set(m,!0);return[4,this._model.setNodesVisibilities(d,b)];case 1:return k.sent(),c?[2,this.fitNodes(a,e)]:[2]}})})};g.prototype.fitNodes=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._model.getNodesBounding(a)];case 1:return c=b.sent(),[2,this.fitBounding(c,e)]}})})};g.prototype.fitWorld=
function(a,d){void 0===a&&(a=0);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return d||(d=this.getCamera()),[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return c=b.sent(),[4,this.fitBounding(c,a,d)];case 2:return b.sent(),[2]}})})};g.prototype._fitCameraToBounding=function(a,e){if(this._viewer.sheetManager.isDrawingSheetActive()){var c=e.extents(),b=e.center();e=new d.Point3(b.x,b.y,e.min.z+
c.length());a.setProjection(d.Projection.Orthographic);a.setPosition(e);a.setTarget(b);a.setWidth(1.25*c.x);a.setHeight(1.25*c.y)}else if(c=e.extents(),c=c.length(),0!==c){b=a.getWidth();var f=d.Point3.subtract(a.getPosition(),a.getTarget()),k=f.length();k=c*k/b;b=e.center();e=d.Point3.add(b,f.normalize().scale(k));a.setTarget(b);a.setPosition(e);a.setWidth(c);a.setHeight(c)}else f=d.Point3.subtract(a.getPosition(),a.getTarget()),b=e.center(),e=d.Point3.add(b,f),a.setTarget(b),a.setPosition(e)};g.prototype.fitBounding=
function(a,e,c){void 0===e&&(e=d.DefaultTransitionDuration);void 0===c&&(c=this.getCamera());return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(a){a.isDegenerate()||this._fitCameraToBounding(c,a);if(0<e)return[2,this._setCameraPromise(c,e)];this.setCamera(c)}return[2]})})};g.prototype.setBackfacesVisible=function(a){this._backfacesVisible=a;this._engine.setBackFacesVisible(a);return Promise.resolve()};g.prototype.getBackfacesVisible=function(){return this._backfacesVisible};
g.prototype.setDrawMode=function(a){this._setDrawMode(a);return Promise.resolve()};g.prototype._setDrawMode=function(a){this._drawMode=a;this._drawMode!==d.DrawMode.HiddenLine&&this.setBackgroundColor(this._backgroundColorTop,this._backgroundColorBottom);switch(a){case d.DrawMode.Wireframe:this._engine.setDrawMode(1);this._setLineVisibility(!0);this._setFaceVisibility(!1);break;case d.DrawMode.Shaded:this._engine.setDrawMode(1);this._setLineVisibility(!1);this._setFaceVisibility(!0);break;case d.DrawMode.WireframeOnShaded:this._engine.setDrawMode(1);
this._setLineVisibility(!0);this._setFaceVisibility(!0);break;case d.DrawMode.HiddenLine:a=this._hiddenLineSettings.getBackgroundColor();this._setLineVisibility(!0);this._setFaceVisibility(!0);this._engine.enableHiddenLineRendering(this._hiddenLineSettings);this._engine.setBackgroundGradient(a.top,a.bottom);break;case d.DrawMode.XRay:this._engine.setDrawMode(3);this._setLineVisibility(!0);this._setFaceVisibility(!0);break;case d.DrawMode.Gooch:this._engine.setDrawMode(4);break;case d.DrawMode.Toon:this._setLineVisibility(!1),
this._engine.setDrawMode(5)}};g.prototype.getDrawMode=function(){return this._drawMode};g.prototype.setAntiAliasingMode=function(a){this._setAntiAliasingMode(a);return Promise.resolve()};g.prototype._setAntiAliasingMode=function(a){this._antiAliasingMode=a;this._engine.setAntiAliasingMode(a)};g.prototype.getAntiAliasingMode=function(){return this._antiAliasingMode};g.prototype.getHiddenLineSettings=function(){return this._hiddenLineSettings};g.prototype.setAmbientOcclusionEnabled=function(a){void 0===
a&&(a=!0);this._setAmbientOcclusionEnabled(a);return Promise.resolve()};g.prototype._setAmbientOcclusionEnabled=function(a){void 0===a&&(a=!0);this._ambientOcclusionEnabled=a;this._engine.setAmbientOcclusionEnabled(a)};g.prototype.getAmbientOcclusionEnabled=function(){return this._ambientOcclusionEnabled};g.prototype.setAmbientOcclusionRadius=function(a){this._setAmbientOcclusionRadius(a);return Promise.resolve()};g.prototype._setAmbientOcclusionRadius=function(a){this._ambientOcclusionRadius=a;this._engine.setAmbientOcclusionRadius(a)};
g.prototype.getAmbientOcclusionRadius=function(){return this._ambientOcclusionRadius};g.prototype.setLightingEnabled=function(a){void 0===a&&(a=!0);this._setLightingEnabled(a);return Promise.resolve()};g.prototype._setLightingEnabled=function(a){void 0===a&&(a=!0);this._lightingEnabled=a;this._engine.setLightingEnabled(a)};g.prototype.getLightingEnabled=function(){return this._lightingEnabled};g.prototype.setTransparencyMode=function(a){this._engine.setTransparencyMode(a)};g.prototype.setXRayOpacity=
function(a,d){this._setXRayOpacity(a,d);return Promise.resolve()};g.prototype._setXRayOpacity=function(a,d){this._engine.setXRayOpacity(a,d)};g.prototype.setXRayTransparencyMode=function(a){this._setXRayTransparencyMode(a);return Promise.resolve()};g.prototype._setXRayTransparencyMode=function(a){this._engine.setXRayTransparencyMode(a)};g.prototype.setXRayColor=function(a,e,c){void 0===c&&(c=d.XRayGroup.Selected);this._engine.setXRayColor(c,a,e);return Promise.resolve()};g.prototype.unsetXRayColor=
function(a,e){void 0===e&&(e=d.XRayGroup.Selected);return this._engine.unsetXRayColor(e,a)};g.prototype.setGoochBlue=function(a){this._goochBlue=a;this._engine.setGoochBlue(a)};g.prototype.getGoochBlue=function(){return this._goochBlue};g.prototype.setGoochBaseColorProminence=function(a){this._goochBaseColorProminence=a;this._engine.setGoochBaseColorProminence(a)};g.prototype.getGoochBaseColorProminence=function(){return this._goochBaseColorProminence};g.prototype.setGoochYellow=function(a){this._goochYellow=
a;this._engine.setGoochYellow(a)};g.prototype.getGoochYellow=function(){return this._goochYellow};g.prototype.setToonShadingBandCount=function(a){this._toonBandCount=a;this._engine.setToonShadingBandCount(a)};g.prototype.getToonShadingBandCount=function(){return this._toonBandCount};g.prototype.setToonShadingSpecularFactor=function(a){this._toonSpecularFactor=a;this._engine.setToonShadingSpecularFactor(a)};g.prototype.getToonShadingSpecularFactor=function(){return this._toonSpecularFactor};g.prototype.setGoochLuminanceShiftStrength=
function(a){this._goochLuminanceShiftStrength=a;this._engine.setGoochLuminanceShiftStrength(a)};g.prototype.getGoochLuminanceShiftStrength=function(){return this._goochLuminanceShiftStrength};g.prototype.setPointSize=function(a,d){this._setPointSize(a,d);return Promise.resolve()};g.prototype._setPointSize=function(a,d){this._engine.setPointSize(a,d)};g.prototype.getPointSize=function(){return this._engine.getPointSize()};g.prototype.setPointShape=function(a){this._setPointShape(a);return Promise.resolve()};
g.prototype._setPointShape=function(a){this._engine.setPointShape(a)};g.prototype.getPointShape=function(){return this._engine.getPointShape()};g.prototype.setEyeDomeLightingEnabled=function(a){void 0===a&&(a=!0);this._setEyeDomeLightingEnabled(a);return Promise.resolve()};g.prototype._setEyeDomeLightingEnabled=function(a){void 0===a&&(a=!0);this._engine.setEyeDomeLightingEnabled(a)};g.prototype.getEyeDomeLightingEnabled=function(){return this._engine.getEyeDomeLightingEnabled()};g.prototype.setEyeDomeLightingBlurSamples=
function(a){this._setEyeDomeLightingBlurSamples(a);return Promise.resolve()};g.prototype._setEyeDomeLightingBlurSamples=function(a){this._engine.setEyeDomeLightingBlurSamples(a)};g.prototype.getEyeDomeLightingBlurSamples=function(){return this._engine.getEyeDomeLightingBlurSamples()};g.prototype.setEyeDomeLightingBlurInterval=function(a){this._setEyeDomeLightingBlurInterval(a);return Promise.resolve()};g.prototype._setEyeDomeLightingBlurInterval=function(a){this._engine.setEyeDomeLightingBlurInterval(a)};
g.prototype.getEyeDomeLightingBlurInterval=function(){return this._engine.getEyeDomeLightingBlurInterval()};g.prototype.setEyeDomeLightingBlurEdgeDistance=function(a){this._setEyeDomeLightingBlurEdgeDistance(a);return Promise.resolve()};g.prototype._setEyeDomeLightingBlurEdgeDistance=function(a){this._engine.setEyeDomeLightingBlurEdgeDistance(a)};g.prototype.getEyeDomeLightingBlurEdgeDistance=function(){return this._engine.getEyeDomeLightingBlurEdgeDistance()};g.prototype.setEyeDomeLightingShadingEdgeDistance=
function(a){this._setEyeDomeLightingShadingEdgeDistance(a);return Promise.resolve()};g.prototype._setEyeDomeLightingShadingEdgeDistance=function(a){this._engine.setEyeDomeLightingShadingEdgeDistance(a)};g.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._engine.getEyeDomeLightingShadingEdgeDistance()};g.prototype.setEyeDomeLightingOpacity=function(a){this._setEyeDomeLightingOpacity(a);return Promise.resolve()};g.prototype._setEyeDomeLightingOpacity=function(a){this._engine.setEyeDomeLightingOpacity(a)};
g.prototype.getEyeDomeLightingOpacity=function(){return this._engine.getEyeDomeLightingOpacity()};g.prototype.setBoundingCalculationIgnoresInvisible=function(a){this._boundingCalculationIgnoresInvisible=a};g.prototype.getBoundingCalculationIgnoresInvisible=function(){return this._boundingCalculationIgnoresInvisible};g.prototype.setDisplayIncompleteFrames=function(a){this._setDisplayIncompleteFrames(a);return Promise.resolve()};g.prototype._setDisplayIncompleteFrames=function(a){this._engine.setDisplayIncompleteFrames(a)};
g.prototype.setMassageExtremeCameras=function(a){this._massageExtremeCameras=a};g.prototype.getMassageExtremeCameras=function(){return this._massageExtremeCameras};g.prototype.setInteractiveDrawDelay=function(a){this._setInteractiveDrawDelay(a);return Promise.resolve()};g.prototype._setInteractiveDrawDelay=function(a){this._engine.setInteractiveDrawDelay(a)};g.prototype.setInteractiveDrawLimitIncreaseEnabled=function(a){this._engine.setInteractiveDrawLimitIncreaseEnabled(a)};g.prototype.getInteractiveDrawLimitIncreaseEnabled=
function(){return this._engine.getInteractiveDrawLimitIncreaseEnabled()};g.prototype.getNavCube=function(){return this._navCube};Object.defineProperty(g.prototype,"navCube",{get:function(){return this._navCube},enumerable:!0,configurable:!0});g.prototype.getAxisTriad=function(){return this._axisTriad};Object.defineProperty(g.prototype,"axisTriad",{get:function(){return this._axisTriad},enumerable:!0,configurable:!0});g.prototype._determineViewAxes=function(a){var e=a.getUp().normalize();a=d.Point3.subtract(a.getTarget(),
a.getPosition()).normalize();e=d.Internal.majorAxis(e);a=d.Internal.majorAxis(a);null===e&&null===a?(e=new d.Point3(0,1,0),a=new d.Point3(0,0,1)):null===e?e=0===a.y?new d.Point3(0,1,0):new d.Point3(0,0,1):null===a&&(a=0===e.z?new d.Point3(0,0,1):new d.Point3(0,1,0));try{this._model.setViewAxes(a,e)}catch(c){}};g.prototype.setAmbientLightColor=function(a){this._ambientLightColor=a;this._engine.setAmbientLightColor(a)};g.prototype.getAmbientLightColor=function(){return this._ambientLightColor};g.prototype.getLightKeys=
function(){return this._engine.getLightKeys()};g.prototype.getLight=function(a){return this._engine.getLight(a)};g.prototype.clearLights=function(){this._engine.clearLights()};g.prototype.addLight=function(a){return this._engine.addLight(a)};g.prototype.removeLight=function(a){this._engine.removeLight(a)};g.prototype.updateLight=function(a,d){this._engine.updateLight(a,d)};g.prototype.setBloomEnabled=function(a){void 0===a&&(a=!0);this._engine.setBloomEnabled(a);this._bloomEnabled=a};g.prototype.getBloomEnabled=
function(){return this._bloomEnabled};g.prototype.setBloomThreshold=function(a){this._engine.setBloomThreshold(a);this._bloomThreshold=a};g.prototype.getBloomThreshold=function(){return this._bloomThreshold};g.prototype.setBloomThresholdRampWidth=function(a){this._engine.setBloomThresholdRampWidth(a);this._bloomThresholdRampWidth=a};g.prototype.getBloomThresholdRampWidth=function(){return this._bloomThresholdRampWidth};g.prototype.setBloomIntensityScale=function(a){this._engine.setBloomIntensityScale(a);
this._bloomIntensityScale=a};g.prototype.getBloomIntensityScale=function(){return this._bloomIntensityScale};g.prototype.setBloomLayers=function(a){a=d.Internal.deepClone(a);for(var e=0;e<a.length;e++){var c=a[e];void 0===c.intensity&&(c.intensity=1);void 0===c.blurSamples&&(c.blurSamples=9);void 0===c.blurInterval&&(c.blurInterval=[1,d.BlurIntervalUnit.Pixels])}this._engine.setBloomLayers(a);this._bloomLayers=a};g.prototype.getBloomLayers=function(){return d.Internal.deepClone(this._bloomLayers)};
g.prototype.startComparison=function(a,e,c){var b=this._model._getModelStructure();a=b.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);e=b.gatherInstanceIncsFromNodeIds(e,7,d.Internal.Tree.WalkRestriction.None);this._engine.startComparison(a,e,c)};g.prototype.endComparison=function(){this._engine.endComparison()};g.prototype.setSimpleShadowEnabled=function(a){void 0===a&&(a=!0);this._simpleShadowEnabled=a;this._engine.setSimpleShadowEnabled(a)};g.prototype.getSimpleShadowEnabled=
function(){return this._simpleShadowEnabled};g.prototype.setSimpleShadowColor=function(a){this._simpleShadowColor=a.copy();this._engine.setSimpleShadowColor(a)};g.prototype.getSimpleShadowColor=function(){return this._simpleShadowColor.copy()};g.prototype.setSimpleShadowOpacity=function(a){this._simpleShadowOpacity=a;this._engine.setSimpleShadowOpacity(a)};g.prototype.getSimpleShadowOpacity=function(){return this._simpleShadowOpacity};g.prototype.setGroundPlane=function(a){this._groundPlane=__assign({},
a);this._updateGroundPlane()};g.prototype._updateGroundPlane=function(a,e){if(this._groundPlane.followViewAxes&&(void 0!==a&&void 0!==e||this._model.viewAxesHaveBeenSet())){if(void 0===a||void 0===e)e=this._model.getViewAxes(),a=e.frontVector,e=e.upVector;a=a.copy().negate();var c=d.Point3.cross(e,a);a=d.Matrix.createFromBasis(a,c,e);e=new d.Point3(0,0,0);a.transform(this._groundPlane.normal,e);this._engine.setGroundPlane(e,this._groundPlane.position)}else this._engine.setGroundPlane(this._groundPlane.normal,
this._groundPlane.position)};g.prototype.getGroundPlane=function(){return __assign({},this._groundPlane)};g.prototype.setSimpleShadowResolution=function(a){this._simpleShadowResolution=a;this._engine.setSimpleShadowResolution(a)};g.prototype.getSimpleShadowResolution=function(){return this._simpleShadowResolution};g.prototype.setSimpleShadowBlurSamples=function(a){this._simpleShadowBlurSamples=a;this._engine.setSimpleShadowBlurSamples(a)};g.prototype.getSimpleShadowBlurSamples=function(){return this._simpleShadowBlurSamples};
g.prototype.setSimpleShadowBlurInterval=function(a){this._simpleShadowBlurInterval=a;this._engine.setSimpleShadowBlurInterval(a)};g.prototype.getSimpleShadowBlurInterval=function(){return this._simpleShadowBlurInterval};g.prototype.setSimpleShadowInteractiveUpdateEnabled=function(a){void 0===a&&(a=!0);this._simpleShadowInteractiveUpdateEnabled=a;this._engine.setSimpleShadowInteractiveUpdateEnabled(a)};g.prototype.getSimpleShadowInteractiveUpdateEnabled=function(){return this._simpleShadowInteractiveUpdateEnabled};
g.prototype.setSilhouetteEnabled=function(a){void 0===a&&(a=!0);this._silhouetteEnabled=a;this._engine.setSilhouetteEnabled(a)};g.prototype.getSilhouetteEnabled=function(){return this._silhouetteEnabled};g.prototype.setSilhouetteColor=function(a){this._silhouetteColor=a.copy();this._engine.setSilhouetteColor(a)};g.prototype.getSilhouetteColor=function(){return this._silhouetteColor.copy()};g.prototype.setSilhouetteOpacity=function(a){this._silhouetteOpacity=a;this._engine.setSilhouetteOpacity(a)};
g.prototype.getSilhouetteOpacity=function(){return this._silhouetteOpacity};g.prototype.setSilhouetteThreshold=function(a){this._silhouetteThreshold=a;this._engine.setSilhouetteThreshold(a)};g.prototype.getSilhouetteThreshold=function(){return this._silhouetteThreshold};g.prototype.setSilhouetteThresholdRampWidth=function(a){this._silhouetteThresholdRampWidth=a;this._engine.setSilhouetteThresholdRampWidth(a)};g.prototype.getSilhouetteThresholdRampWidth=function(){return this._silhouetteThresholdRampWidth};
g.prototype.setHardEdgesEnabled=function(a){void 0===a&&(a=!0);this._hardEdgesEnabled=a;this._engine.setHardEdgesEnabled(a)};g.prototype.getHardEdgesEnabled=function(){return this._hardEdgesEnabled};g.prototype.setHardEdgeColor=function(a){this._hardEdgeColor=a.copy();this._engine.setHardEdgeColor(a)};g.prototype.getHardEdgeColor=function(){return this._hardEdgeColor.copy()};g.prototype.setHardEdgeOpacity=function(a){this._hardEdgeOpacity=a;this._engine.setHardEdgeOpacity(a)};g.prototype.getHardEdgeOpacity=
function(){return this._hardEdgeOpacity};g.prototype.setHardEdgeThreshold=function(a){this._hardEdgeThreshold=a;this._engine.setHardEdgeThreshold(a)};g.prototype.getHardEdgeThreshold=function(){return this._hardEdgeThreshold};g.prototype.setHardEdgeThresholdRampWidth=function(a){this._hardEdgeThresholdRampWidth=a;this._engine.setHardEdgeThresholdRampWidth(a)};g.prototype.getHardEdgeThresholdRampWidth=function(){return this._hardEdgeThresholdRampWidth};g.prototype.setSimpleReflectionEnabled=function(a){void 0===
a&&(a=!0);this._simpleReflectionEnabled=a;this._engine.setSimpleReflectionEnabled(a)};g.prototype.getSimpleReflectionEnabled=function(){return this._simpleReflectionEnabled};g.prototype.setSimpleReflectionBlurInterval=function(a,e){void 0===e&&(e=d.BlurIntervalUnit.Pixels);this._simpleReflectionBlurInterval=[a,e];this._engine.setSimpleReflectionBlurInterval(a,e)};g.prototype.getSimpleReflectionBlurInterval=function(){return[this._simpleReflectionBlurInterval[0],this._simpleReflectionBlurInterval[1]]};
g.prototype.setSimpleReflectionBlurSamples=function(a){this._simpleReflectionBlurSamples=a;this._engine.setSimpleReflectionBlurSamples(a)};g.prototype.getSimpleReflectionBlurSamples=function(){return this._simpleReflectionBlurSamples};g.prototype.setSimpleReflectionFadeAngle=function(a){this._simpleReflectionFadeAngle=a;this._engine.setSimpleReflectionFadeAngle(a)};g.prototype.getSimpleReflectionFadeAngle=function(){return this._simpleReflectionFadeAngle};g.prototype.setSimpleReflectionOpacity=function(a){this._simpleReflectionOpacity=
a;this._engine.setSimpleReflectionOpacity(a)};g.prototype.getSimpleReflectionOpacity=function(){return this._simpleReflectionOpacity};g.prototype.setSimpleReflectionAttenuation=function(a,e,c){void 0===c&&(c=d.SimpleReflectionAttenuationUnit.World);this._simpleReflectionAttenuation={nearDistance:a,farDistance:e,unit:c};this._engine.setSimpleReflectionAttenuation(a,e,c)};g.prototype.getSimpleReflectionAttenuation=function(){return __assign({},this._simpleReflectionAttenuation)};g.prototype.testPointVisibility=
function(a){return this._engine.testPointVisibility(a)};g.prototype.setPointVisibilityTest=function(a){this._engine.setPointVisibilityTest(a)};g.prototype.setImageBasedLightingEnabled=function(a){this._engine.setImageBasedLightingEnabled(a);this._imageBasedLightingEnabled=a};g.prototype.getImageBasedLightingEnabled=function(){return this._imageBasedLightingEnabled};g.prototype.setImageBasedLightingIntensity=function(a){this._engine.setImageBasedLightingIntensity(a);this._imageBasedLightingIntensity=
a};g.prototype.getImageBasedLightingIntensity=function(){return this._imageBasedLightingIntensity};g.prototype._copyImageBasedLightingOrientation=function(a){return __assign({},a,{matrix:a.matrix.copy()})};g.prototype.setImageBasedLightingOrientation=function(a){this._imageBasedLightingOrientation=this._copyImageBasedLightingOrientation(a);this._updateImageBasedLightingOrientation()};g.prototype.getImageBasedLightingOrientation=function(){return this._copyImageBasedLightingOrientation(this._imageBasedLightingOrientation)};
g.prototype._updateImageBasedLightingOrientation=function(a,e){if(this._imageBasedLightingOrientation.followViewAxes){if(void 0===a||void 0===e)this._model.viewAxesHaveBeenSet()?(e=this._model.getViewAxes(),a=e.frontVector,e=e.upVector):(a=new d.Point3(0,0,1),e=new d.Point3(0,1,0));a=d.Matrix.createFromBasis(d.Point3.cross(e,a),e,a);a=d.Matrix.multiply(this._imageBasedLightingOrientation.matrix,a)}else a=this._imageBasedLightingOrientation.matrix;this._engine.setImageBasedLightingMatrix(a)};g.prototype.setImageBasedLightingEnvironment=
function(a){null!=a?this._engine.setImageBasedLightingEnvironment(a):this._engine.setImageBasedLightingEnvironmentToDefault()};g.prototype.setLineJitterEnabled=function(a){void 0===a&&(a=!0);this._engine.setLineJitterEnabled(a);this._lineJitterEnabled=a};g.prototype.getLineJitterEnabled=function(){return this._lineJitterEnabled};g.prototype.setLineJitterInstanceCount=function(a){this._engine.setLineJitterInstanceCount(a);this._lineJitterInstanceCount=a};g.prototype.getLineJitterInstanceCount=function(){return this._lineJitterInstanceCount};
g.prototype.setLineJitterRadius=function(a){this._engine.setLineJitterRadius(a);this._lineJitterRadius=a};g.prototype.getLineJitterRadius=function(){return this._lineJitterRadius};g.prototype.setLineJitterFrequency=function(a){this._engine.setLineJitterFrequency(a);this._lineJitterFrequency=a};g.prototype.getLineJitterFrequency=function(){return this._lineJitterFrequency};__decorate([g.deprecated],g.prototype,"endVolumeSelection",null);__decorate([g.deprecated],g.prototype,"advanceVolumeSelection",
null);return g}();d.View=h})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b){return b instanceof e?b.referencedInfo:b}g.MaxModelFileVersion=[24,0,0];var e=function(){return function(b){this.referencedInfo=b}}();g.ReferencedNodeInfo=e;g.modelFileNodeInfoAsProdOccInfo=a;var c=function(){function b(){}b.parseXml=function(b,c,a,n,m){console.assert("ModelFile"===n.localName);var f=new Map,k=new Map,l=new Map;for(n=n.firstElementChild;null!==n;){if("ProductOccurence"!==n.localName)throw new d.XmlParseError('Unexpected element "'+
n.localName+'".');if(null===g.XmlParser.parseNodeId(n,"Id"))throw new d.XmlParseError('Expected "Id" attribute.');var h=n,u=g.ProductOccurrence.parseXml(b,c,a,h,m),w=u.nodeInfo.nodeId;if(l.has(u.nodeInfo.nodeId)){var v=new e(u);f.set(w,v)}else{if(!k.has(u.nodeInfo.nodeId)&&(k.set(u.nodeInfo.nodeId,null),null!==b.additionalMatrix)){v=b.additionalMatrix.m;var y=u.nodeInfo.localTransform;y=null===y?v:g.Transform.multiply(y,v);u=__assign({},u,{nodeInfo:__assign({},u.nodeInfo,{localTransform:y})})}f.set(w,
u)}w=0;for(v=g.XmlParser.parseNodeIds(h,"Children")||[];w<v.length;w++)k.set(v[w],u);h=g.XmlParser.parseNodeId(h,"InstanceRef");null!==h&&(w=l.get(h),void 0===w?l.set(h,[u]):w.push(u));n=n.nextElementSibling}b=this._parentMapToChildMap(f,k,l);return{treeInfos:this._childMapRoseTrees(b)}};b._parentMapToChildMap=function(b,c,a){var f=new Map,k=function(b,c){var a=f.get(b);void 0===a?f.set(b,[c]):a.push(c)};c.forEach(function(c,a){a=b.get(a);if(a instanceof e)throw new d.XmlParseError('Expected a referenced node for "InstanceRef".');
k(c,a)});a.forEach(function(c,a){console.assert(0<c.length);a=b.get(a);if(!(a instanceof e))throw new d.XmlParseError('Node is both an "InstanceRef" and contained in another node\'s "Children" list.');for(var f=0;f<c.length;f++)k(c[f],a)});return f};b._childMapRoseTrees=function(b){var c=function(f){var d=[],e=a(f);e=b.get(e);if(void 0!==e){console.assert(0<e.length);for(var k=0;k<e.length;k++){var g=c(e[k]);d.push(g)}}return new h.RoseTree(f,d)},f=b.get(null);if(void 0===f)return console.assert(0===
b.size),[];for(var d=[],g=0;g<f.length;g++){var p=f[g];p instanceof e?console.assert(!1):(p=c(p),d.push(p))}return d};b.reify=function(b,c,a,g,m,p){return __awaiter(this,void 0,void 0,function(){var f,k,l,n,h,v,y,x;return __generator(this,function(q){switch(q.label){case 0:f=[];k=[];l=[];n=0;for(h=p.treeInfos;n<h.length;n++)v=h[n],v.value instanceof e?console.assert(!1):(y=this._reifyProductOccurrence(b,c,a,g,m,m,v,f),k.push(y),l.push(y.getRuntimeId()));x=c.promiseTrigger("_subtreeLoaded","subtreeLoaded",
l,d.NodeSource.LoadModel).then(function(){for(var b=0,a=l;b<a.length;b++)c.trigger("shatteredXmlStructureReady",a[b])});f.push(x);return[4,d.Util.waitForAll(f)];case 1:return q.sent(),[2,k]}})})};b._rectifyExternalModelInfo=function(b,c){c=c.referencedInfo.externalModelInfo;if(null===c)throw new d.XmlParseError('"InstanceRef" node does not contain "ExternalModel".');if(!g.ExternalModel.isNameInfo(c))throw new d.InternalLogicError;console.assert(0===c.reservedNodeIdOffset);b=b.newNodeIdOffset();return c=
__assign({},c,{reservedNodeIdOffset:b})};b._reifyProductOccurrence=function(b,c,l,n,m,p,h,r){var f=this,k=a(h.value);if(0!==k.childDataKeys.length)throw new d.InternalLogicError;if(null!==k.externalModelInfo)throw new d.LoadError('Unexpected "ExternalModel". Should be a child of an "InstanceRef".');var q=g.ProductOccurrence.reifySync(b,l,n,m,k,p);p.addProductOccurrence(q);q.markLoaded();p=0;for(h=h.kids;p<h.length;p++)k=h[p],k.value instanceof e?(console.assert(0===k.kids.length),k=this._rectifyExternalModelInfo(n,
k.value),g.ExternalModel.canImplicitlyLoad(k)?(k=l.attachByExternalModelInfo(k,q,m).then(function(b){return __awaiter(f,void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:return null===b?[2]:[4,g.markContextsLoaded([b])];case 1:return f.sent(),q.addAttachContext(b),a=b.getChildren().map(function(b){return b.getRuntimeId()}),[4,c.promiseTrigger("_subtreeLoaded","subtreeLoaded",a,d.NodeSource.LoadModel)];case 2:return f.sent(),[2]}})})}),r.push(k)):q.addPendingExternalModel(k)):
(console.assert(null===k.value.externalModelInfo),this._reifyProductOccurrence(b,c,l,n,m,q,k,r));return q};b._parseBounding=function(b,c){var f=a(b.value),e=SC.UnspecifiedMeasurementUnit;null!==f.measurementUnit&&(e=f.measurementUnit);var k=1;e===SC.UnspecifiedMeasurementUnit?e=c:c!==SC.UnspecifiedMeasurementUnit&&(k=e/c);k=(new d.Matrix).setScaleComponent(k,k,k);var p=f.nodeInfo.localTransform;null!==p&&(p=d.Matrix.createFromArray(p),k=d.Matrix.multiply(p,k));p=d.Box.invalid();var h=0;for(b=b.kids;h<
b.length;h++){var r=this._parseBounding(b[h],e);r=k.transformBox(r);p.addBox(r)}b=f.externalModelInfo;if(null!==b){if(!g.ExternalModel.isNameInfo(b))throw new d.InternalLogicError;f=b.bounding;null===f||f.isDegenerate()||(b=b.measurementUnit||SC.UnspecifiedMeasurementUnit,c!==SC.UnspecifiedMeasurementUnit&&b!==SC.UnspecifiedMeasurementUnit&&(c=b/e,c=(new d.Matrix).setScaleComponent(c,c,c),k=d.Matrix.multiply(c,k)),f=k.transformBox(f),p.addBox(f))}return p};b.parseBounding=function(b,c){var a=d.Box.invalid(),
f=0;for(b=b.treeInfos;f<b.length;f++)for(var e=0,k=b[f].kids;e<k.length;e++){var g=this._parseBounding(k[e],c);a.addBox(g)}return a};return b}();g.ModelFile=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){var e=this;this._callbackManager=new d.Internal.CallbackManager;this._interpolationManager=new d.Internal.InterpolationManager;this._streamingMode=d.StreamingMode.Interactive;this._rendererType=d.RendererType.Client;this._alreadyShutDown=!1;this._shutdownTimer=new d.Util.Timer;this._sceneReadyPromise=d.Util.OpenPromise.create();this._seenPriorityMetaDataSent=this._modelLoadFailure=!1;this._params=__assign({},a);this._contextMenuActiveFlag=!1;if(void 0!==
this._params.containerId){a=d.Internal.DomElements.createFromId(this._params.containerId);if(null===a)throw new d.ParseError("'containerId' is invalid");this._domElements=a}else if(void 0!==this._params.container)this._domElements=d.Internal.DomElements.createFromElement(this._params.container);else throw new d.ParseError("must supply 'container' or 'containerId'");this.operatorManager=new d.OperatorManager(this);this._eventDispatcher=new d.Internal.EventDispatcher(this._callbackManager,this.operatorManager);
this._timeoutMonitor=new d.Internal.TimeoutMonitor(this._callbackManager);this._inputMonitor=new d.Internal.InputMonitor(this._eventDispatcher,this._timeoutMonitor);this._setInitialOptions(this._params);this._engine=new d.Internal.ScEngine(this._callbackManager,this._params);this._statistics=new d.Internal.Statistics(this._callbackManager,this);a=new d.NavCube(this);var c=new d.AxisTriad(this);this.model=new d.Model(this._engine,this._callbackManager);this.view=new d.View(this,this._engine,this._callbackManager,
this._eventDispatcher,this._interpolationManager,this._statistics,a,c);this.cuttingManager=new d.CuttingManager(this,this.model,this._callbackManager,this._engine);a={disableAutomaticFitWorld:d.Internal.getWithDefault(this._params.disableAutomaticFitWorld,!1),markImplicitNodesOutOfHierarchy:d.Internal.getWithDefault(this._params._markImplicitNodesOutOfHierarchy,!0),streamingMode:d.Internal.getWithDefault(this._params.streamingMode,d.StreamingMode.Default)};this._modelStructure=d.Internal.Tree.ModelStructure.unsafeCreate(a,
this._engine,this._callbackManager,this.cuttingManager,this.view,this.model,this._params._maxConcurrentAttachments||null);this.model._setModelStructure(this._modelStructure);this.measureManager=new d.MeasureManager(this,this._callbackManager);this.lineManager=new d.LineManager(this,this._callbackManager);this.explodeManager=new d.ExplodeManager(this.model,this._engine,this._callbackManager);this.overlayManager=new d.OverlayManager(this,this._engine);this.BCFManager=new d.BCFManager(this);this.selectionManager=
new d.SelectionManager(this._callbackManager,this._engine,this.view,this.model,this._modelStructure);a=new d.FloorplanConfig;d.Internal.getWithDefault(this._params.disableAutomaticFloorplanOverlay,!1)&&(a.autoActivate=d.FloorplanAutoActivation.Never);this.floorplanManager=new d.FloorplanManager(this,this.model,this.overlayManager,this._engine,this._modelStructure,a);a=d.Internal.getWithDefault(this._params.disableAutomaticBackgroundSheets,!1);this.sheetManager=new d.SheetManager(this,this._engine,
this._callbackManager,a);this.noteTextManager=new d.Markup.Note.NoteTextManager(this);this.markupManager=new d.MarkupManager(this._domElements,this.measureManager,this.lineManager,this._callbackManager,this.sheetManager,this.noteTextManager,this);this.view._setMarkupManager(this.markupManager);this.animationManager=new d.Animation.Manager(this);this._initEventDispatcher();var b=function(b){e.model.isDrawing()&&(b=e.sheetManager.get3DNodes());e.model._setInstanceModifier(d.InstanceModifier.OverrideSceneVisibility,
b,!0,6);for(var c=0;c<b.length;c++)e.model.setPmiColorOverride(!0,b[c])},f=function(b){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return b?[4,Promise.all([this.view.setPointSize(.003,d.PointSizeUnit.ProportionOfBoundingDiagonal),this.view.setEyeDomeLightingEnabled(!0),this.view.setPointShape(d.PointShape.Disk)])]:[3,2];case 1:return c.sent(),[3,4];case 2:return[4,Promise.all([this.view.setPointSize(1,d.PointSizeUnit.ScreenPixels),this.view.setEyeDomeLightingEnabled(!1),
this.view.setPointShape(d.PointShape.Square)])];case 3:c.sent(),c.label=4;case 4:return[2]}})})},k=function(b){return __awaiter(e,void 0,void 0,function(){var c,a,e,k;return __generator(this,function(g){switch(g.label){case 0:c=0,a=b,g.label=1;case 1:if(!(c<a.length))return[3,4];e=a[c];k=this.model.getModelFileTypeFromNode(e);return null===k||k===d.FileType.Unknown?[3,3]:[4,f(!1)];case 2:return g.sent(),[3,4];case 3:return c++,[3,1];case 4:return[2]}})})},g=function(b){return __awaiter(e,void 0,void 0,
function(){var c,a,f,e,k;return __generator(this,function(g){switch(g.label){case 0:c=[];if(this.model.getModelFileTypeFromNode(b[0])===d.FileType.Ifc)for(a=0,f=b;a<f.length;a++)e=f[a],k=this.model.registerIfcNodes(e),c.push(k);return[4,Promise.all(c)];case 1:return g.sent(),[2]}})})},n=function(b){var c=e.selectionManager.getSelectionFilter();b=e.model.getModelFileTypeFromNode(b[0])===d.FileType.Ifc;!c&&b?e.selectionManager.setSelectionFilter(d.SelectionManager.ifcSelectionFilter):c!==d.SelectionManager.ifcSelectionFilter||
b||e.selectionManager.setSelectionFilter(null)};this.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){e.model.setPmiColor(d.Color.black());return[2]})})},_sessionStarted:function(){return f(!0)},_firstModelLoaded:function(c){return __awaiter(e,void 0,void 0,function(){var a,f;return __generator(this,function(l){switch(l.label){case 0:return e.model.setPmiColor(d.Color.black()),n(c),b([this.model.getAbsoluteRootNode()]),
[4,Promise.all([g(c),k(c)])];case 1:return l.sent(),a=null!==this.model.getDefaultCadView(),(f=null!==this.model.getDefaultCadConfiguration())?[4,this._modelStructure.cadConfigurationsEnabled()]:[3,3];case 2:f=l.sent(),l.label=3;case 3:return f?[4,this.model.activateDefaultCadConfiguration(!a)]:[3,5];case 4:l.sent(),l.label=5;case 5:return a?[4,this.model.activateDefaultCadView()]:[3,7];case 6:l.sent(),l.label=7;case 7:return[2]}})})},_modelSwitched:function(c,a){return __awaiter(e,void 0,void 0,
function(){return __generator(this,function(c){switch(c.label){case 0:return n(a),b(a),[4,Promise.all([g(a),k(a)])];case 1:return c.sent(),[2]}})})},_subtreeLoaded:function(c){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return b(c),[4,g(c)];case 1:return a.sent(),[2]}})})},subtreeLoaded:function(b,c){e._callbackManager.trigger("modelLoaded",b,c)},modelLoadFailure:function(){e._modelLoadFailure=!0}})}g.deprecated=function(a,d,c){var b=c.value;
c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","WebViewer",d);return b.apply(this,c)};return c};g.prototype.setContextMenuStatus=function(a){this._contextMenuActiveFlag=a};g.prototype.getContextMenuStatus=function(){return this._contextMenuActiveFlag};g.prototype.deactivateSheets=function(){return this.sheetManager.deactivateSheets()};g.prototype.setActiveSheetId=function(a){return this.sheetManager.setActiveSheetId(a,!0,!0)};
g.prototype.getActiveSheetId=function(){return this.sheetManager.getActiveSheetId()};g.prototype.getSheetIds=function(){return this.sheetManager.getSheetIds()};g.prototype.isDrawingSheetActive=function(){return this.sheetManager.isDrawingSheetActive()};g.prototype.setBackgroundSheetEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this.sheetManager.setBackgroundSheetEnabled(a)]})})};g.prototype.getBackgroundSheetEnabled=function(){return this.sheetManager.getBackgroundSheetEnabled()};
g.prototype.setBackgroundSelectionEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this.sheetManager.setBackgroundSelectionEnabled(a)]})})};g.prototype.getBackgroundSelectionEnabled=function(){return this.sheetManager.getBackgroundSelectionEnabled()};g.prototype.setSheetColors=function(a,d,c){return this.sheetManager.setSheetColors(a,d,c)};g.prototype.getSheetBackgroundColor=function(){return this.sheetManager.getSheetBackgroundColor()};
g.prototype.getSheetColor=function(){return this.sheetManager.getSheetColor()};g.prototype.getSheetShadowColor=function(){return this.sheetManager.getSheetShadowColor()};g.prototype.getCreationParameters=function(){return __assign({},this._params)};g.prototype._setInitialOptions=function(a){this._inputMonitor.setOptions(a);void 0!==a.streamingMode?this._streamingMode=a.streamingMode:a.streamingMode=this._streamingMode;void 0!==a.rendererType?this._rendererType=a.rendererType:a.rendererType=this._rendererType};
g.prototype._initEventDispatcher=function(){var a=new d.Operator.CameraOrbitOperator(this),e=new d.Operator.CameraPanOperator(this),c=new d.Operator.CameraZoomOperator(this),b=new d.Operator.CameraWindowZoomOperator(this),f=new d.Operator.CameraNavigationOperator(this,a,e,c),k=new d.Operator.CameraWalkOperator(this),g=new d.Operator.CameraKeyboardWalkOperator(this),n=new d.Operator.CameraWalkModeOperator(this,k,g),m=new d.Operator.CameraTurntableOperator(this),p=new d.Operator.SelectionOperator(this,
this.noteTextManager),h=new d.Operator.AreaSelectionOperator(this),r=new d.Operator.RayDrillSelectionOperator(this),t=new d.Operator.RedlineCircleOperator(this),u=new d.Operator.RedlineTextOperator(this),w=new d.Operator.RedlineRectangleOperator(this),v=new d.Operator.RedlinePolylineOperator(this),y=new d.Operator.MeasureEdgeLengthOperator(this,this.measureManager),x=new d.Operator.MeasureFaceFaceDistanceOperator(this,this.measureManager),z=new d.Operator.MeasureLineLineAngleOperator(this,this.measureManager),
A=new d.Operator.MeasurePointPointDistanceOperator(this,this.measureManager),C=new d.Operator.MeasureBodyBodyDistanceOperator(this,this.measureManager),B=new d.Operator.MeasureFaceFaceAngleOperator(this,this.measureManager),D=new d.Operator.MeasurePolylineDistanceOperator(this,this.measureManager),F=new d.Operator.MeasurePolygonAreaOperator(this,this.measureManager),E=new d.Operator.NoteOperator(this,this.noteTextManager),G=new d.Operator.CuttingPlaneOperator(this,this.cuttingManager),H=new d.Operator.HandleOperator(this),
I=new d.Operator.NavCubeOperator(this),K=new d.Operator.AxisTriadOperator(this),J=new d.Operator.FloorplanOperator(this),L=new d.Operator.SpaceMouseOperator(this);this.operatorManager._registerOperator(d.OperatorId.Navigate,f);this.operatorManager._registerOperator(d.OperatorId.Orbit,a);this.operatorManager._registerOperator(d.OperatorId.Pan,e);this.operatorManager._registerOperator(d.OperatorId.Zoom,c);this.operatorManager._registerOperator(d.OperatorId.WindowZoom,b);this.operatorManager._registerOperator(d.OperatorId.Walk,
k);this.operatorManager._registerOperator(d.OperatorId.KeyboardWalk,g);this.operatorManager._registerOperator(d.OperatorId.WalkMode,n);this.operatorManager._registerOperator(d.OperatorId.Turntable,m);this.operatorManager._registerOperator(d.OperatorId.Select,p);this.operatorManager._registerOperator(d.OperatorId.AreaSelect,h);this.operatorManager._registerOperator(d.OperatorId.RayDrillSelect,r);this.operatorManager._registerOperator(d.OperatorId.RedlineCircle,t);this.operatorManager._registerOperator(d.OperatorId.RedlineText,
u);this.operatorManager._registerOperator(d.OperatorId.RedlineRectangle,w);this.operatorManager._registerOperator(d.OperatorId.RedlinePolyline,v);this.operatorManager._registerOperator(d.OperatorId.MeasureEdgeLength,y);this.operatorManager._registerOperator(d.OperatorId.MeasureFaceFaceDistance,x);this.operatorManager._registerOperator(d.OperatorId.MeasureLineLineAngle,z);this.operatorManager._registerOperator(d.OperatorId.MeasurePointPointDistance,A);this.operatorManager._registerOperator(d.OperatorId.MeasureBodyBodyDistance,
C);this.operatorManager._registerOperator(d.OperatorId.MeasureFaceFaceAngle,B);this.operatorManager._registerOperator(d.OperatorId.MeasurePolylineDistance,D);this.operatorManager._registerOperator(d.OperatorId.MeasurePolygonArea,F);this.operatorManager._registerOperator(d.OperatorId.Note,E);this.operatorManager._registerOperator(d.OperatorId.Cutting,G);this.operatorManager._registerOperator(d.OperatorId.Handle,H);this.operatorManager._registerOperator(d.OperatorId.NavCube,I);this.operatorManager._registerOperator(d.OperatorId.AxisTriad,
K);this.operatorManager._registerOperator(d.OperatorId.Floorplan,J);this.operatorManager._registerOperator(d.OperatorId.SpaceMouse,L);f.setBimNavigationEnabled(!1);y.addMapping(d.Button.Left);x.addMapping(d.Button.Left);A.addMapping(d.Button.Left);A.addMapping(d.Button.Left,d.KeyModifiers.Alt);B.addMapping(d.Button.Left);b.addMapping(d.Button.Left);G.addMapping(d.Button.Left);h.addMapping(d.Button.Left);h.addMapping(d.Button.Left,d.KeyModifiers.Control);this.operatorManager.set(d.OperatorId.Navigate,
0);this.operatorManager.set(d.OperatorId.Select,1);this.operatorManager.push(d.OperatorId.Cutting);this.operatorManager.push(d.OperatorId.Handle);this.operatorManager.push(d.OperatorId.NavCube);this.operatorManager.push(d.OperatorId.AxisTriad);this.operatorManager.push(d.OperatorId.Floorplan);this.operatorManager.push(d.OperatorId.SpaceMouse)};g.prototype.getViewerVersionString=function(){return g.VIEWER_VERSION_STRING};g.prototype.getFormatVersionString=function(){return this._engine.getVersionString()};
g.prototype.getView=function(){return this.view};g.prototype.getModel=function(){return this.model};g.prototype.getOverlayManager=function(){return this.overlayManager};g.prototype.getMeasureManager=function(){return this.measureManager};g.prototype.getLineManager=function(){return this.lineManager};g.prototype.getCuttingManager=function(){return this.cuttingManager};g.prototype.getMarkupManager=function(){return this.markupManager};g.prototype.getSelectionManager=function(){return this.selectionManager};
g.prototype.getExplodeManager=function(){return this.explodeManager};g.prototype.getOperatorManager=function(){return this.operatorManager};g.prototype._getNoteTextManager=function(){return this.noteTextManager};g.prototype.start=function(){var a=this,d=this._domElements.getCanvasContainerElement();return this._engine.start(d,{enginePath:this._params.enginePath,engineReady:function(c){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,c];
case 1:return b.sent(),[4,this._modelStructure.waitForReady()];case 2:return b.sent(),[4,this._scEngineReady()];case 3:return b.sent(),[2]}})})},sceneReady:function(){a._sceneReady()},renderComplete:function(){a._renderComplete()},streamingActivated:function(){a._streamingActivated()},streamingDeactivated:function(){a._streamingDeactivated()},priorityMetaDataSent:function(c,b){a._priorityMetaDataSent(c,b)}})};g.prototype.registerCustomOperator=function(a){return this.operatorManager.registerCustomOperator(a)};
g.prototype.unregisterCustomOperator=function(a){this.operatorManager.unregisterCustomOperator(a)};g.prototype.focusInput=function(a){this._inputMonitor.focusInput(a)};g.prototype.setCallbacks=function(a){this._callbackManager.bind(a)};g.prototype.unsetCallbacks=function(a){this._callbackManager.unbind(a)};g.prototype.resizeCanvas=function(){this._alreadyShutDown||(this._engine.resize(),this._inputMonitor.elementResize())};g.prototype.moveToWindow=function(a){this._inputMonitor.setDocument(a.document)};
g.prototype.redraw=function(a){var d=this;if(a){var c=function(){d._callbackManager.unbind({_drawComplete:c});a()};this._callbackManager.bind({_drawComplete:c})}this._engine.redraw()};g.prototype.selectPart=function(a,e){void 0===e&&(e=d.SelectionMode.Set);return this.selectionManager.selectNode(a,e)};g.prototype.trigger=function(a){for(var d=[],c=1;c<arguments.length;c++)d[c-1]=arguments[c];this._callbackManager.unsafeTrigger(a,d)};g.prototype.triggerEvent=function(a,d){this._callbackManager.unsafeTrigger(a,
d)};g.prototype._getCallbackManager=function(){return this._callbackManager};g.prototype._setStreamIdleMarker=function(){return this._engine.setStreamIdleMarker()};g.prototype.getStatistics=function(a){void 0===a&&(a=!1);return this._engine.getStatistics(a)};g.prototype.setMinimumFramerate=function(a){this._setMinimumFramerate(a);return Promise.resolve()};g.prototype._setMinimumFramerate=function(a){this._engine.setMinimumFramerate(a)};g.prototype.getMinimumFramerate=function(){return this._engine.getMinimumFramerate()};
g.prototype.setServerRenderQuality=function(a,d,c,b){return this._engine.setServerRenderQuality(a,d,c,b)};g.prototype.getStreamingMode=function(){return this._streamingMode};g.prototype.getRendererType=function(){return this._engine.getRendererType()};g.prototype.getViewElement=function(){return this._domElements.getCanvasContainerElement()};g.prototype.shutdown=function(){var a=this;this._alreadyShutDown||(this._shutdownTimer.clear(),this._modelStructure.isReady()||this._modelLoadFailure?(this._callbackManager.trigger("_shutdownBegin"),
this.operatorManager._shutdown(),this._inputMonitor.shutdown(),this.markupManager._shutdown(),this._timeoutMonitor.shutdown(),this._modelStructure.shutdown(),this._domElements.shutdown(),this._engine.shutdown(),this.animationManager._shutdown(),this._alreadyShutDown=!0):this._shutdownTimer.set(500,function(){a.shutdown()}))};g.prototype.setClientTimeout=function(a,d){return this._timeoutMonitor.setTimeoutDurations(a,d)};g.prototype.resetClientTimeout=function(){this._timeoutMonitor.resetTimeout()};
g.prototype.pauseRendering=function(a){this._pauseRendering(a);return Promise.resolve()};g.prototype._pauseRendering=function(a){this._engine.pauseRendering(a)};g.prototype.resumeRendering=function(){this._resumeRendering();return Promise.resolve()};g.prototype._resumeRendering=function(){this._engine.resumeRendering()};g.prototype.delayCapping=function(){this.cuttingManager.delayCapping()};g.prototype.reset=function(a){void 0===a&&(a=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,
function(){var d,c;return __generator(this,function(b){switch(b.label){case 0:return[4,this.model.reset()];case 1:return b.sent(),d=null!==this.model.getDefaultCadView(),(c=null!==this.model.getDefaultCadConfiguration())?[4,this._modelStructure.cadConfigurationsEnabled()]:[3,3];case 2:c=b.sent(),b.label=3;case 3:return c?[4,this.model.activateDefaultCadConfiguration(!d)]:[3,5];case 4:return b.sent(),[3,7];case 5:return this.sheetManager.isDrawingSheetActive()||d?[3,7]:[4,this.view.resetCamera(a)];
case 6:b.sent(),b.label=7;case 7:return d?[4,this.model.activateDefaultCadView(a)]:[3,9];case 8:b.sent(),b.label=9;case 9:return[2]}})})};g.prototype.closeConnection=function(){this.view.setCamera(this.view.getCamera());this._engine.disconnectNetwork();this._timeoutMonitor.shutdown()};g.prototype.setAllowHighDpi=function(a){this._engine.setAllowHighDpi(a)};g.prototype.setAllowHighDPI=function(a){this.setAllowHighDpi(a)};g.prototype.getAllowHighDpi=function(){return this._engine.getAllowHighDpi()};
g.prototype.getAllowHighDPI=function(){return this.getAllowHighDpi()};g.prototype.takeSnapshot=function(a){var e=this;void 0===a&&(a=new d.SnapshotConfig);var c=d.Util.OpenPromise.create(),b=new d.Internal.Snapshot(this._domElements,a),f=this._domElements.getCanvasContainerElement(),k=this._domElements.getRedlineElement(),g=0<a.width&&0<a.height;if(g){var n=a.width/f.clientWidth*100+"%";a=a.height/f.clientHeight*100+"%";f.style.width=n;f.style.height=a;k.style.width=n;k.style.height=a}var m=this.getAllowHighDpi();
this._engine.setAllowHighDpi(!1);this._engine.resize();this.redraw(function(){return __awaiter(e,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,b.capture(f)];case 1:return a=d.sent(),g&&(f.style.width="100%",f.style.height="100%",k.style.width="100%",k.style.height="100%"),this._engine.setAllowHighDpi(m),this._engine.resize(),c.resolve(a),[2]}})})});return c};g.prototype.fitWorld=function(a){void 0===a&&(a=d.DefaultTransitionDuration);return this.view.fitWorld(a)};
g.prototype.setViewOrientation=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this.view.setViewOrientation(a,e)];case 1:return c.sent(),this._eventDispatcher.injectViewOrientationChangeEvent(),[2]}})})};g.prototype._applyMetallicRoughnessDefaults=function(){var a=1,d=1,c=!1;void 0!=this._params.defaultMetallicFactor&&(a=this._params.defaultMetallicFactor,c=!0);void 0!=this._params.defaultRoughnessFactor&&
(d=this._params.defaultRoughnessFactor,c=!0);c&&this._engine.setMetallicRoughnessMaterialOverride(a,d)};g.prototype._scEngineReady=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b,f,k,g;return __generator(this,function(l){switch(l.label){case 0:console.assert(this._modelStructure.isReady()),a=this.model.getAbsoluteRootNode(),e=this._engine.getSessionType(),l.label=1;case 1:return l.trys.push([1,,17,18]),this.cuttingManager._init(),[4,this._sceneReadyPromise];case 2:return l.sent(),
[4,this._callbackManager.promiseTrigger("_assemblyTreeReady","assemblyTreeReady")];case 3:l.sent(),c="",l.label=4;case 4:l.trys.push([4,15,,16]);b=new d.LoadSubtreeConfig;b._allowSubtreeLoadedCallback=!1;f=0;this._applyMetallicRoughnessDefaults();if(1!==e)return[3,8];c=this._engine.getNetworkModelName();return c!==d.EmptyModelName?[3,5]:[3,7];case 5:return[4,this.model.loadSubtreeFromModel(a,c,b)];case 6:l.sent(),l.label=7;case 7:return[3,14];case 8:if(2!==e)return[3,13];this._timeoutMonitor.shutdown();
k=this._engine.getScsInfo();return"string"!==typeof k?[3,10]:[4,this.model.loadSubtreeFromScsFile(a,k,b)];case 9:return l.sent(),[3,12];case 10:return null===k?[3,12]:[4,this.model.loadSubtreeFromScsBuffer(a,k,b)];case 11:return l.sent(),[3,12];case 12:return void 0!==this._params.streamCutoffScale&&(f=this._params.streamCutoffScale),[3,14];case 13:throw new d.InternalLogicError;case 14:return this._modelStructure.setPrefetchScsCutoffScale(f),[3,16];case 15:throw g=l.sent(),this._callbackManager.trigger("modelLoadFailure",
c,""+g,g),g;case 16:return[3,18];case 17:return console.assert(this._modelStructure.isReady()),[2,this._callbackManager.promiseTrigger("_modelStructureReady","modelStructureReady")];case 18:return[2]}})})};g.prototype._sceneReady=function(){var a=this;this._inputMonitor.bindEvents(this._domElements.getCanvasContainerElement());this.selectionManager._init();this._callbackManager.bind({_timeout:function(){a.shutdown()}});this._callbackManager.trigger("sceneReady");this._sceneReadyPromise&&this._sceneReadyPromise.resolve()};
g.prototype._priorityMetaDataSent=function(a,e){this._callbackManager.trigger("_priorityMetaDataSent",a,e);if(!this._seenPriorityMetaDataSent){if(0!==a||0!==e)throw new d.InternalLogicError;this._seenPriorityMetaDataSent=!0;this._callbackManager.trigger("_attached",0)}};g.prototype._renderComplete=function(){this.markupManager._update()};g.prototype._streamingActivated=function(){this._callbackManager.trigger("streamingActivated")};g.prototype._streamingDeactivated=function(){this._callbackManager.trigger("streamingDeactivated")};
g.prototype.setStreamCutoffScale=function(a){this._setStreamCutoffScale(a);return Promise.resolve()};g.prototype._setStreamCutoffScale=function(a){this._engine.setStreamCutoffScale(a);this._modelStructure.setPrefetchScsCutoffScale(a)};g.prototype.getStreamCutoffScale=function(){return this._engine.getStreamCutoffScale()};g.prototype._loseWebGlContext=function(){return this._engine.loseWebGlContext()};g.prototype._getScEngine=function(){return this._engine};g.prototype._debug_log=function(a){return this._engine.debug_log(a)};
g.prototype._debug_stateFailure=function(a){return this._engine.debug_stateFailure(a)};g.prototype._debug_sync=function(){return this._engine.debug_sync()};g.prototype.exportToSvg=function(a){void 0===a&&(a=new d.SvgConfig);return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return[4,this.cuttingManager._setStandinGeometryVisible(!1)];case 1:c.sent(),c.label=2;case 2:return c.trys.push([2,,5,7]),[4,this.waitForIdle({redraw:!1})];case 3:return c.sent(),
[4,this._engine.exportToSvg(a)];case 4:return d=c.sent(),[3,7];case 5:return[4,this.cuttingManager._setStandinGeometryVisible(!0)];case 6:return c.sent(),[7];case 7:return[2,d]}})})};g.prototype.beginExportToSvg=function(a){void 0===a&&(a=new d.SvgConfig);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this.cuttingManager._setStandinGeometryVisible(!1)];case 1:d.sent(),d.label=2;case 2:return d.trys.push([2,5,,7]),[4,this.waitForIdle({redraw:!1})];
case 3:return d.sent(),[4,this._engine.beginExportToSvg(a)];case 4:return d.sent(),[3,7];case 5:return d.sent(),[4,this.endExportToSvg()];case 6:return d.sent(),[3,7];case 7:return[2]}})})};g.prototype.endExportToSvg=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this.cuttingManager._setStandinGeometryVisible(!0)]})})};g.prototype.advanceExportToSvg=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,
this._engine.advanceExportToSvg()]})})};g.prototype.waitForIdle=function(a){void 0===a&&(a={});return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:return this._alreadyShutDown?[2]:[4,this._setStreamIdleMarker()];case 1:return f.sent(),e=[],this.cuttingManager.hasActiveCuttingSection()?[4,this.cuttingManager.enableCappingIdleCallback(!0)]:[3,3];case 2:(c=f.sent())||e.push(this.cuttingManager.waitForCappingIdle()),f.label=3;case 3:return e.push(this._engine.waitForImageDecoding()),
[4,Promise.all(e)];case 4:f.sent();if(!1===a.redraw)return[3,6];b=d.Util.OpenPromise.create();this.redraw(function(){b.resolve()});return[4,b];case 5:f.sent(),f.label=6;case 6:return[2]}})})};g.prototype.startSheetComparison=function(a,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.sheetManager.startComparison(a,d,c)];case 1:return b.sent(),[2]}})})};g.prototype.endSheetComparison=function(){return __awaiter(this,void 0,
void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.sheetManager.endComparison()];case 1:return a.sent(),[2]}})})};g.BUILD_ID="3429d58";g.VIEWER_VERSION_STRING=d.Internal.versionString(d.Internal.Tree.MaxModelFileVersion)+" Build "+g.BUILD_ID;__decorate([g.deprecated],g.prototype,"deactivateSheets",null);__decorate([g.deprecated],g.prototype,"setActiveSheetId",null);__decorate([g.deprecated],g.prototype,"getActiveSheetId",null);__decorate([g.deprecated],g.prototype,
"getSheetIds",null);__decorate([g.deprecated],g.prototype,"isDrawingSheetActive",null);__decorate([g.deprecated],g.prototype,"setBackgroundSheetEnabled",null);__decorate([g.deprecated],g.prototype,"getBackgroundSheetEnabled",null);__decorate([g.deprecated],g.prototype,"setBackgroundSelectionEnabled",null);__decorate([g.deprecated],g.prototype,"getBackgroundSelectionEnabled",null);__decorate([g.deprecated],g.prototype,"setSheetColors",null);__decorate([g.deprecated],g.prototype,"getSheetBackgroundColor",
null);__decorate([g.deprecated],g.prototype,"getSheetColor",null);__decorate([g.deprecated],g.prototype,"getSheetShadowColor",null);__decorate([g.deprecated],g.prototype,"getView",null);__decorate([g.deprecated],g.prototype,"getModel",null);__decorate([g.deprecated],g.prototype,"getOverlayManager",null);__decorate([g.deprecated],g.prototype,"getMeasureManager",null);__decorate([g.deprecated],g.prototype,"getLineManager",null);__decorate([g.deprecated],g.prototype,"getCuttingManager",null);__decorate([g.deprecated],
g.prototype,"getMarkupManager",null);__decorate([g.deprecated],g.prototype,"getSelectionManager",null);__decorate([g.deprecated],g.prototype,"getExplodeManager",null);__decorate([g.deprecated],g.prototype,"getOperatorManager",null);__decorate([g.deprecated],g.prototype,"setAllowHighDPI",null);__decorate([g.deprecated],g.prototype,"getAllowHighDPI",null);__decorate([g.deprecated],g.prototype,"startSheetComparison",null);__decorate([g.deprecated],g.prototype,"endSheetComparison",null);return g}();d.WebViewer=
h})(Communicator||(Communicator={}));
(function(d){(function(h){function g(c){for(var b=2*Math.PI/c,a=[],d=0;d<c;d++){var e=d*b,g=Math.sin(e);a.push(Math.cos(e));a.push(g)}return a}function a(c,b,a,e){void 0===e&&(e=1);var f=d.Point3.cross(a,new d.Point3(0,1,0));.001>f.length()&&(f=d.Point3.cross(a,new d.Point3(0,0,1)));a=d.Point3.cross(f,a);for(var k=2*Math.PI/c,g=[],p=0;p<c;p++){var h=p*k,r=Math.sin(h);h=Math.cos(h);r=f.copy().scale(r).add(a.copy().scale(h)).scale(e).add(b);g.push(r)}return g}function e(c,b,a,e,g){for(var f=[],k=[],
l=0;l<a.length;l++){var h=(l+1)%a.length;f.push(a[l]);f.push(a[h]);f.push(e[l]);f.push(a[h]);f.push(e[h]);f.push(e[l]);k.push(d.Point3.subtract(a[l],c));k.push(d.Point3.subtract(a[h],c));k.push(d.Point3.subtract(e[l],b));k.push(d.Point3.subtract(a[h],c));k.push(d.Point3.subtract(e[h],b));k.push(d.Point3.subtract(e[l],b))}if(g)for(c=d.Point3.subtract(c,b),b=0;b<k.length;b++)k[b].add(c).normalize();return[f,k]}h.generateSphereMeshData=function(){var c=(1+Math.sqrt(5))/2,b=Math.sqrt(10+2*Math.sqrt(5))/
(4*c),a=b/2;c=b/(2*c);var e=[];e[0]=new d.Point3(-c,a,0);e[1]=new d.Point3(c,a,0);e[2]=new d.Point3(-c,-a,0);e[3]=new d.Point3(c,-a,0);e[4]=new d.Point3(0,-c,a);e[5]=new d.Point3(0,c,a);e[6]=new d.Point3(0,-c,-a);e[7]=new d.Point3(0,c,-a);e[8]=new d.Point3(a,0,-c);e[9]=new d.Point3(a,0,c);e[10]=new d.Point3(-a,0,-c);e[11]=new d.Point3(-a,0,c);for(a=0;a<e.length;a++)e[a].normalize();var g=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,
6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],n=12;a=function(b){var c=[];g.map(function(b){var a=e[b[0]],f=e[b[1]],k=e[b[2]];e[n++]=(new d.Point3(a.x+f.x,a.y+f.y,a.z+f.z)).scale(.5).normalize();e[n++]=(new d.Point3(f.x+k.x,f.y+k.y,f.z+k.z)).scale(.5).normalize();e[n++]=(new d.Point3(k.x+a.x,k.y+a.y,k.z+a.z)).scale(.5).normalize();c.push([b[0],n-3,n-1]);c.push([n-3,n-2,n-1]);c.push([n-3,b[1],n-2]);c.push([n-2,b[2],n-1])});g=c};for(c=0;2>c;c++)a(c);a=[];c=[];b=0;for(var m=g;b<m.length;b++)for(var p=
m[b],h=0;3>h;h++){var r=p[h];a.push(e[r].x);a.push(e[r].y);a.push(e[r].z);r=e[r].normalize();c.push(r.x);c.push(r.y);c.push(r.z)}b=new d.MeshData;b.addFaces(a,c);b.setFaceWinding(d.FaceWinding.CounterClockwise);return b};h.generateConeCylinderMeshData=function(c,b,f,k,l,n){var m=new d.Matrix,p,h=f+n,r=g(b);for(p=0;p<r.length;p++)r[p]*=k;l=new d.Point3(0,h+l,0);p=new d.Point3(0,h,0);var t=m.transform(l),u=m.transform(p);l=[];var w=[];for(p=0;p<r.length;p+=2){var v=r[p],y=r[p+1],x=(p+2)%r.length,z=
r[x],A=r[x+1],C=r[p],B=r[p+1],D=r[x];x=r[x+1];var F=new d.Point3(v,h,y),E=new d.Point3(z,h,A);F=m.transform(F);E=m.transform(E);l.push(t);l.push(F);l.push(E);E=new d.Point3(0,1,0);C=new d.Point3(C,0,B);D=new d.Point3(D,0,x);B=m.transform(E);C=m.transform(C);D=m.transform(D);w.push(B);w.push(C);w.push(D);v=new d.Point3(v,h,y);z=new d.Point3(z,h,A);A=m.transform(v);z=m.transform(z);l.push(u);l.push(z);l.push(A);z=new d.Point3(0,-1,0);z=m.transform(z);w.push(z);w.push(z);w.push(z)}h=[];r=[];for(p=0;p<
l.length;p++)t=l[p],h.push(t.x),h.push(t.y),h.push(t.z),t=w[p],r.push(t.x),r.push(t.y),r.push(t.z);p=[h,r];l=[];w=[];r=g(b);for(h=0;h<r.length;h++)r[h]*=c;t=[];u=[];for(h=0;h<r.length;h+=2){z=r[h];A=r[h+1];x=(h+2)%r.length;v=r[x];y=r[x+1];D=r[h];C=r[h+1];B=r[x];x=r[x+1];t[0]=new d.Point3(z,f,A);t[1]=new d.Point3(z,0,A);t[2]=new d.Point3(v,0,y);t[3]=new d.Point3(v,0,y);t[4]=new d.Point3(v,f,y);t[5]=new d.Point3(z,f,A);u[0]=new d.Point3(D,0,C);u[1]=new d.Point3(D,0,C);u[2]=new d.Point3(B,0,x);u[3]=
new d.Point3(B,0,x);u[4]=new d.Point3(B,0,x);u[5]=new d.Point3(D,0,C);for(D=0;D<t.length;D++)C=m.transform(t[D]),l.push(C),C=m.transform(u[D]),w.push(C);t[0]=new d.Point3(v,0,y);t[1]=new d.Point3(z,0,A);t[2]=d.Point3.zero();u[0]=new d.Point3(0,-1,0);u[1]=new d.Point3(0,-1,0);u[2]=new d.Point3(0,-1,0);for(D=0;3>D;D++)C=m.transform(t[D]),l.push(C),C=m.transform(u[D]),w.push(C)}m=[];r=[];for(h=0;h<l.length;h++)t=l[h],m.push(t.x),m.push(t.y),m.push(t.z),t=w[h],r.push(t.x),r.push(t.y),r.push(t.z);m=[m,
r];l=new d.Point3(0,0,f);f=new d.Point3(0,0,f+n);n=new d.Point3(0,0,1);c=a(b,l,n,c);b=a(b,f,n,k);b=e(l,f,c,b,!0);k=[];c=[];for(f=0;f<b[0].length;f++)k.push(b[0][f].x),k.push(b[0][f].z),k.push(b[0][f].y),c.push(b[1][f].x),c.push(b[1][f].z),c.push(b[1][f].y);k=[k,c];b=p[0].concat(m[0]).concat(k[0]);k=p[1].concat(m[1]).concat(k[1]);c=new d.MeshData;c.setFaceWinding(d.FaceWinding.Clockwise);c.addFaces(b,k);return c};h.createCylinderMeshDataFromArc=function(c,b,f,k){for(var g=[],n=[],m,h=0;h<c.length-
3;h+=3){var q=new d.Point3(c[h],c[h+1],c[h+2]),r=new d.Point3(c[h+3],c[h+4],c[h+5]),t=a(f,q,b,k),u=a(f,r,b,k);m=e(q,r,t,u,!1);Array.prototype.push.apply(g,m[0]);Array.prototype.push.apply(n,m[1])}q=c.length;h=new d.Point3(c[q-3],c[q-2],c[q-1]);u=h.copy().subtract(new d.Point3(c[q-6],c[q-5],c[q-4])).normalize();q=a(2*f,h,b,k);r=h.copy().add(u.copy().scale(2/3));t=a(2*f,r,b,2*k);u=r.copy().add(u.copy().scale(2));m=e(h,r,q,t,!1);Array.prototype.push.apply(g,m[0]);Array.prototype.push.apply(n,m[1]);for(h=
0;h<q.length;h++)m=(h+1)%q.length,g.push(u),g.push(t[h]),g.push(t[m]),m=t[h].copy().subtract(r).normalize().add(u.copy().normalize()).normalize(),n.push(m),n.push(m),n.push(m);h=new d.Point3(c[0],c[1],c[2]);u=h.copy().subtract(new d.Point3(c[3],c[4],c[5])).normalize();q=a(2*f,h,b,k);r=h.copy().add(u.copy().scale(2/3));t=a(2*f,r,b,2*k);u=r.copy().add(u.copy().scale(2));m=e(r,h,t,q,!1);Array.prototype.push.apply(g,m[0]);Array.prototype.push.apply(n,m[1]);for(h=0;h<q.length;h++)m=(h+1)%q.length,g.push(u),
g.push(t[m]),g.push(t[h]),m=t[h].copy().subtract(r).normalize().add(u.copy().normalize()).normalize(),n.push(m),n.push(m),n.push(m);c=[];b=[];for(h=0;h<g.length;h++)f=g[h],c.push(f.x),c.push(f.y),c.push(f.z),m=n[h],b.push(m.x),b.push(m.y),b.push(m.z);g=new d.MeshData;g.setFaceWinding(d.FaceWinding.CounterClockwise);g.addFaces(c,b);return g}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c){this._mode=a;this._impl=new d.Internal.IncrementalSelectionImpl(c)}a.create=function(d,c){return new a(d,c)};a.prototype.performSelection=function(a,c,b){var f=this._impl.viewer;"View"===this._mode?(f=f.view,void 0===b&&(b=[])):(h.TypeAssert(this._mode),f=f.selectionManager);void 0===c&&(c=null);return this._impl.performSelection(f,a,c,b)};a.prototype.isIdle=function(){return this._impl.isIdle()};a.prototype.waitForIdle=function(){return this._impl.waitForIdle()};
a.prototype.stopSelection=function(){return this._impl.stopSelection()};a.prototype.clearSelection=function(){return this._impl.clearSelection()};return a}();h.IncrementalSelection=g;(function(a){a.isScreenByAreaConfig=function(a){return"areaCssMin"in a};a.isRayDrillConfig=function(a){return"rayCssBoxRadius"in a};a.isConvexPolyhedronConfig=function(a){return"volumePlanes"in a};a.isSphereConfig=function(a){return"sphereRadius"in a}})(g=h.IncrementalSelection||(h.IncrementalSelection={}))})(d.Util||
(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a){this._killHandles=[];this._activeSelectionCount=0;this._inactivityPromise=null;this.viewer=a}a.prototype.isIdle=function(){return 0===this._activeSelectionCount};a.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(0===this._activeSelectionCount)return console.assert(null===this._inactivityPromise),[2,Promise.resolve()];null===this._inactivityPromise&&(this._inactivityPromise=
h.OpenPromise.create());return[2,this._inactivityPromise]})})};a.prototype.stopSelection=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b,f;return __generator(this,function(e){console.assert(this._killHandles.length===this._activeSelectionCount);a=[];c=0;for(b=this._killHandles;c<b.length;c++)f=b[c],a.push(f());return[2,d.Util.waitForAll(a)]})})};a.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return a=
this.viewer.selectionManager,a.clear(),[4,this.stopSelection()];case 1:return c.sent(),a.clear(),[2]}})})};a.prototype._advanceBySelectionManager=function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){b=this.viewer.selectionManager;return[2,b.advanceIncrementalSelection(a,c)]})})};a.prototype._advanceByView=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f,d,e,g,m,h;return __generator(this,function(k){switch(k.label){case 0:return f=
this.viewer.view,[4,f.advanceIncrementalSelection(a)];case 1:return d=k.sent(),null===d?[2,!1]:c?[4,Promise.all(d.map(c))]:[3,3];case 2:e=k.sent(),d=d.filter(function(b,c){return e[c]}),k.label=3;case 3:g=0;for(m=d;g<m.length;g++)h=m[g],b.push(h);return[2,!0]}})})};a.prototype._wrapBeginSelection=function(a,c){return d.Util.IncrementalSelection.isScreenByAreaConfig(c)?a.beginScreenSelectByArea(c.areaCssMin,c.areaCssMax,c.pickConfig):d.Util.IncrementalSelection.isRayDrillConfig(c)?a.beginRayDrillSelection(c.rayCssOrigin,
c.rayCssBoxRadius,c.pickConfig):d.Util.IncrementalSelection.isConvexPolyhedronConfig(c)?a.beginConvexPolyhedronSelection(c.volumePlanes,c.heuristicOrigin,c.pickConfig):d.Util.IncrementalSelection.isSphereConfig(c)?a.beginSphereSelection(c.sphereCenter,c.sphereRadius,c.pickConfig):d.Util.TypeAssertNever(c)};a.prototype.performSelection=function(a,c,b,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return void 0!==f?[3,1]:[2,this._performSelection(a,
c,b,null)];case 1:return[4,this._performSelection(a,c,b,f)];case 2:return d.sent(),[2,f]}})})};a.prototype._performSelection=function(a,c,b,f){return __awaiter(this,void 0,void 0,function(){var e,g,n,m,p,q,r,t,u=this;return __generator(this,function(k){switch(k.label){case 0:e=this._wrapBeginSelection(a,c);if(null===e)return[2];++this._activeSelectionCount;g=this.viewer.selectionManager;n=null===f;m=!1;p=h.Lazy.create(function(){return __awaiter(u,void 0,void 0,function(){var b,c;return __generator(this,
function(a){switch(a.label){case 0:m=!0,a.label=1;case 1:return a.trys.push([1,,7,8]),[4,e];case 2:return b=a.sent(),n?[4,g.endIncrementalSelection(b)]:[3,4];case 3:return a.sent(),[3,6];case 4:return[4,this.viewer.view.endIncrementalSelection(b)];case 5:a.sent(),a.label=6;case 6:return[3,8];case 7:return c=this._killHandles.indexOf(q),console.assert(0<=c),this._killHandles.splice(c,1),--this._activeSelectionCount,0===this._activeSelectionCount&&null!==this._inactivityPromise&&(this._inactivityPromise.resolve(),
this._inactivityPromise=null),[7];case 8:return[2]}})})});q=function(){return p.get()};this._killHandles.push(q);k.label=1;case 1:return k.trys.push([1,,11,13]),[4,e];case 2:r=k.sent(),t=!0,k.label=3;case 3:return!t||m?[3,10]:n?[4,this._advanceBySelectionManager(r,b)]:[3,5];case 4:return t=k.sent(),[3,7];case 5:return[4,this._advanceByView(r,b,f)];case 6:t=k.sent(),k.label=7;case 7:return!t||m?[3,9]:[4,d.Util.sleep(1)];case 8:k.sent(),k.label=9;case 9:return[3,3];case 10:return[3,13];case 11:return[4,
q()];case 12:return k.sent(),[7];case 13:return[2]}})})};return a}();h.IncrementalSelectionImpl=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._engine=a}a.prototype.getIdentityInc=function(){return this._identityInc};a.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,this._engine.createIdentityMatrix()];case 1:return this._identityInc=a=c.sent(),[2]}})})};return a}();d.ScMatrixCache=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b,c,a){if(b.selectionMask===d.SelectionMask.None)throw new d.CommunicatorError("selectionMask is None");return __assign({},b,{cullSuboptimalEntities:c,enableOcclusionChecks:c,restrictLinesAndPointsToSelectedFaceInstances:a?!1:b.restrictLinesAndPointsToSelectedFaceInstances})}function a(b,c){var a=d.Point3.createFromArray(b.rayPoint),f=d.Point3.createFromArray(b.normal),e=new d.Point3(b.bounding.min[0],b.bounding.min[1],b.bounding.min[2]),k=new d.Point3(b.bounding.max[0],
b.bounding.max[1],b.bounding.max[2]);e=new d.Box(e,k);c=new d.Selection.FaceEntity(a,f,b.elementIndex,b.overlayIndex,b.elementBits,e,c);b=b.instanceInc;return d.Selection.SelectionItem.create(b[1],b[0],c,null,null)}function e(b){var c=new d.Point3(b.bounding.min[0],b.bounding.min[1],b.bounding.min[2]),a=new d.Point3(b.bounding.max[0],b.bounding.max[1],b.bounding.max[2]);c=new d.Box(c,a);c=new d.Selection.LineEntity(b.elementIndex,d.Point3.createFromArray(b.point),b.lineSegmentVertices,b.bestLineSegmentVertexIndex,
c,b.overlayIndex,b.elementBits);b=b.instanceInc;return d.Selection.SelectionItem.create(b[1],b[0],null,c,null)}function c(b){var c=new d.Selection.PointEntity(d.Point3.createFromArray(b.point),b.elementIndex,b.overlayIndex,b.elementBits);b=b.instanceInc;return d.Selection.SelectionItem.create(b[1],b[0],null,null,c)}function b(b){return null!==b.point?(b=b.point.entities[0],c(b)):null!==b.line?(b=b.line.entities[0],e(b)):null!==b.face?(b=b.face.entities[0],a(b,!1)):null!==b.proximityFace?(b=b.proximityFace.entities[0],
a(b,!0)):null}function f(b){var f=null;if(null!==b.face){var k=b.face.entities[0];f=a(k,!1)}else null!==b.proximityFace&&(k=b.proximityFace.entities[0],f=a(k,!0));var g=null;null!==b.line&&(k=b.line.entities[0],g=e(k));k=null;null!==b.point&&(k=b.point.entities[0],k=c(k));return new d.Selection.CompositeSelectionItem(f,g,k)}function k(b){var f=[];if(null!==b.face)for(var d=0,k=b.face.entities;d<k.length;d++){var g=a(k[d],!1);f.push(g)}a:for(g=b.line,d=b.point,k=b.proximityFace,b=null!==g?g.entities:
[],d=null!==d?d.entities:[],k=null!==k?k.entities:[],g=[b,d,k];;){for(var l,n=l=Number.POSITIVE_INFINITY,m=null,h=0;h<g.length;h++){var x=g[h];if(0<x.length){var z=x[0];z.radialMetric<l?(l=z.radialMetric,n=z.zMetric,m=x):z.radialMetric===l&&z.zMetric<n&&(n=z.zMetric,m=x)}}l=m;if(null===l){console.assert(0===b.length);console.assert(0===d.length);console.assert(0===k.length);break a}console.assert(0<l.length);l===b?(l=b.pop(),l=e(l)):l===d?(l=d.pop(),l=c(l)):(console.assert(l===k),l=k.pop(),l=a(l,
!0));f.push(l)}return f}var l;(function(b){b[b.Batch=5E3]="Batch";b[b.Chunk=500]="Chunk"})(l=h.AdvanceSelectionCapacity||(h.AdvanceSelectionCapacity={}));var n=function(){function c(b){this._pickTolerance=20;this._incrementalChunkedItems=new Map;this._sc=b}c.prototype.setPickTolerance=function(b){this._pickTolerance=b};c.prototype.getPickTolerance=function(){return this._pickTolerance};c.prototype.beginScreenAreaSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k;return __generator(this,
function(g){switch(g.label){case 0:f=a,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._sc.beginScreenAreaSelection(b.x,b.y,c.x,c.y,f)];case 2:return e=g.sent(),[3,4];case 3:k=g.sent();if(SC.isError(k)&&"beginScreenAreaSelection"===k.scFunction)throw new d.SelectionInvalidatedError;throw k;case 4:return[2,new d.Selection.IncrementalSelectionId(e)]}})})};c.prototype.beginRayDrillSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k;return __generator(this,function(g){switch(g.label){case 0:f=
a,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._sc.beginRayDrillSelection(b.x,b.y,c,f)];case 2:return e=g.sent(),[3,4];case 3:k=g.sent();if(SC.isError(k)&&"beginRayDrillSelection"===k.scFunction)throw new d.SelectionInvalidatedError;throw k;case 4:return[2,new d.Selection.IncrementalSelectionId(e)]}})})};c.prototype.beginConvexPolyhedronSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,g,l,n,m,h;return __generator(this,function(p){switch(p.label){case 0:f=
a;e=[];k=0;for(g=b;k<g.length;k++)l=g[k],e.push(l.getCoefficients());n=[c.x,c.y,c.z];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this._sc.beginConvexPolyhedronSelection(e,n,f)];case 2:return m=p.sent(),[3,4];case 3:h=p.sent();if(SC.isError(h)&&"beginConvexPolyhedronSelection"===h.scFunction)throw new d.SelectionInvalidatedError;throw h;case 4:return[2,new d.Selection.IncrementalSelectionId(m)]}})})};c.prototype.beginSphereSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,
e,k;return __generator(this,function(g){switch(g.label){case 0:f=a,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._sc.beginSphereSelection(b,c,f)];case 2:return e=g.sent(),[3,4];case 3:k=g.sent();if(SC.isError(k)&&"beginSphereSelection"===k.scFunction)throw new d.SelectionInvalidatedError;throw k;case 4:return[2,new d.Selection.IncrementalSelectionId(e)]}})})};c.prototype.endIncrementalSelection=function(b){this._incrementalChunkedItems.delete(b._handle);this._sc.endVolumeSelection(b._handle)};
c.prototype.advanceIncrementalSelection=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,e,k,g,n,m,p;return __generator(this,function(q){switch(q.label){case 0:if((a=this._incrementalChunkedItems.get(b._handle))&&0!==a.length)return[2,a.pop()];q.label=1;case 1:return q.trys.push([1,3,,4]),[4,this._sc.advanceVolumeSelection(b._handle,l.Batch)];case 2:return f=q.sent(),[3,4];case 3:e=q.sent();if(SC.isError(e)&&"advanceVolumeSelection"===e.scFunction)throw new d.SelectionInvalidatedError;
throw e;case 4:return 2!==f.length||4294967295!==f[1]?[3,7]:c?[4,this._sc.setStreamIdleMarker()]:[3,6];case 5:return q.sent(),[2,this.advanceIncrementalSelection(b,!1)];case 6:return[2,null];case 7:k=[];for(g=0;g<f.length;g+=2)n=f[g],m=f[g+1],k.push(d.Selection.SelectionItem.create(m,n));if(k.length<=l.Chunk)return[2,k];p=h.chunkify(k,l.Chunk).reverse();this._incrementalChunkedItems.set(b._handle,p);return[2,p.pop()]}})})};c.prototype._screenSelectByRay=function(b,c,a,f){return __awaiter(this,void 0,
void 0,function(){var e,k,l,n;return __generator(this,function(m){e=g(c,a,f);k=c.selectionMask;n=(l=c.selectionMask!==d.SelectionMask.Face||c.enableProximityFaces)?this._pickTolerance:-1;return[2,this._sc.screenSelectByRay(k,b.x,b.y,n,e)]})})};c.prototype._worldSelectByRay=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,d;return __generator(this,function(e){f=g(c,a,!1);d=h.toScRay(b);return[2,this._sc.worldSelectByRay(d,f)]})})};c.prototype.pickFromScreen=function(c,a,f){return __awaiter(this,
void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return[4,this._screenSelectByRay(c,a,!0,f)];case 1:return d=e.sent(),[2,b(d)]}})})};c.prototype.pickAllFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._screenSelectByRay(b,c,!1,a)];case 1:return f=d.sent(),[2,k(f)]}})})};c.prototype.compositePickFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,
function(){var d;return __generator(this,function(e){switch(e.label){case 0:return[4,this._screenSelectByRay(b,c,!0,a)];case 1:return d=e.sent(),[2,f(d)]}})})};c.prototype.pickFromRay=function(c,a){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._worldSelectByRay(c,a,!0)];case 1:return f=d.sent(),[2,b(f)]}})})};c.prototype.pickAllFromRay=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,
function(f){switch(f.label){case 0:return[4,this._worldSelectByRay(b,c,!1)];case 1:return a=f.sent(),[2,k(a)]}})})};c.prototype.pickCompositeFromRay=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d,e;return __generator(this,function(k){switch(k.label){case 0:return a=g(c,!0,!1),d=h.toScRay(b),[4,this._sc.worldSelectByRay(d,a)];case 1:return e=k.sent(),[2,f(e)]}})})};return c}();h.ScSelectionManager=n})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){d=d.Internal||(d.Internal={});(d.Test||(d.Test={})).AdvanceSelectionCapacity=d.AdvanceSelectionCapacity})(Communicator||(Communicator={}));
(function(d){(function(h){h.toScRay=function(d){var a={origin:[],direction:[]};d.origin.toArray(a.origin);d.direction.toArray(a.direction);return a};h.makeFaceFaceDistanceItem=function(g){var a=new d.FaceFaceDistanceItem;a.pos1.fromArray(g.point1);a.pos2.fromArray(g.point2);a.distance=g.distance;return a}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a){this.attributes=a}d.prototype.copy=function(){return new d(this.attributes.map(function(a){return a.copy()}))};return d}();d.SubentityAttributes=h})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){a.isFace=function(a){return a instanceof d.SubentityProperties.CylinderElement||a instanceof d.SubentityProperties.PlaneElement||a instanceof d.SubentityProperties.ConeElement||a instanceof d.SubentityProperties.SphereElement||a instanceof d.SubentityProperties.TorusElement||a instanceof d.SubentityProperties.Blend01Element||a instanceof d.SubentityProperties.Blend02Element||a instanceof d.SubentityProperties.Blend03Element||a instanceof d.SubentityProperties.NurbsElement||
a instanceof d.SubentityProperties.CylindricalElement||a instanceof d.SubentityProperties.OffsetElement||a instanceof d.SubentityProperties.PipeElement||a instanceof d.SubentityProperties.RuledElement||a instanceof d.SubentityProperties.RevolutionElement||a instanceof d.SubentityProperties.ExtrusionElement||a instanceof d.SubentityProperties.FromCurvesElement||a instanceof d.SubentityProperties.TransformElement||a instanceof d.SubentityProperties.OtherFaceElement};a.isEdge=function(a){return a instanceof
d.SubentityProperties.LineElement||a instanceof d.SubentityProperties.CircleElement||a instanceof d.SubentityProperties.OtherEdgeElement}})(g.MeasurementProperty||(g.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){(function(a){a.parseBinary=function(a){var k=d.SubentityProperties.FaceType,l=a.parseFaceType();switch(l){case k.Cylinder:return c.parseBinary(a);case k.Plane:return b.parseBinary(a);case k.Cone:return f.parseBinary(a);case k.Other:return n.parseBinary(a);case k.Sphere:return e.parseBinary(a);case k.Torus:return g.parseBinary(a);case k.Blend01:return m.parseBinary(a);case k.Blend02:return h.parseBinary(a);case k.Blend03:return q.parseBinary(a);case k.Nurbs:return r.parseBinary(a);
case k.Cylindrical:return t.parseBinary(a);case k.Offset:return u.parseBinary(a);case k.Pipe:return w.parseBinary(a);case k.Ruled:return v.parseBinary(a);case k.Revolution:return y.parseBinary(a);case k.Extrusion:return x.parseBinary(a);case k.FromCurves:return z.parseBinary(a);case k.Transform:return A.parseBinary(a);default:throw d.Util.TypeAssert(l),new d.AssemblyDataParseError("Unexpected measurement face type.");}};var c=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),
a=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.CylinderElement(c,a,b)};return b}();a.Cylinder=c;var b=function(){function b(){}b.parseBinary=function(b){var c=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.PlaneElement(c,b)};return b}();a.Plane=b;var f=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parsePoint3_32(),f=b.parsePoint3_32();b=b.parseFloat_32();return new d.SubentityProperties.ConeElement(c,a,f,b)};return b}();
a.Cone=f;var e=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.SphereElement(c,a,b)};return b}();a.Sphere=e;var g=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parseFloat_32(),f=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.TorusElement(c,a,f,b)};return b}();a.Torus=g;var n=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.OtherFaceElement};
return b}();a.Other=n;var m=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.Blend01Element};return b}();a.Blend01=m;var h=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.Blend02Element};return b}();a.Blend02=h;var q=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.Blend03Element};return b}();a.Blend03=q;var r=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.NurbsElement};
return b}();a.Nurbs=r;var t=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.CylindricalElement};return b}();a.Cylindrical=t;var u=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.OffsetElement};return b}();a.Offset=u;var w=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.PipeElement};return b}();a.Pipe=w;var v=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.RuledElement};
return b}();a.Ruled=v;var y=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.RevolutionElement};return b}();a.Revolution=y;var x=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.ExtrusionElement};return b}();a.Extrusion=x;var z=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.FromCurvesElement};return b}();a.FromCurves=z;var A=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.TransformElement};
return b}();a.Transform=A})(a.Face||(a.Face={}))})(g.MeasurementProperty||(g.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){(function(a){a.parseBinary=function(a){var e=d.SubentityProperties.EdgeType,k=a.parseEdgeType();switch(k){case e.Line:return c.parseBinary(a);case e.Circle:return b.parseBinary(a);case e.Other:return f.parseBinary(a);default:throw d.Util.TypeAssert(k),new d.AssemblyDataParseError("Unexpected measurement edge type.");}};var c=function(){function b(){}b.parseBinary=function(b){b=b.parseFloat_32();return new d.SubentityProperties.LineElement(b)};return b}();
a.Line=c;var b=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.CircleElement(c,a,b)};return b}();a.Circle=b;var f=function(){function b(){}b.parseBinary=function(b){b=b.parseFloat_32();return new d.SubentityProperties.OtherEdgeElement(b)};return b}();a.Other=f})(a.Edge||(a.Edge={}))})(g.MeasurementProperty||(g.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){var g;(function(c){c[c.Undefined=0]="Undefined";c[c.Line=1]="Line";c[c.Circle=2]="Circle";c[c.Other=6]="Other"})(g=h.EdgeType||(h.EdgeType={}));var a;(function(c){c[c.Undefined=0]="Undefined";c[c.Cylinder=3]="Cylinder";c[c.Plane=4]="Plane";c[c.Cone=5]="Cone";c[c.Other=6]="Other";c[c.Sphere=7]="Sphere";c[c.Torus=8]="Torus";c[c.Blend01=9]="Blend01";c[c.Blend02=10]="Blend02";c[c.Blend03=11]="Blend03";c[c.Nurbs=12]="Nurbs";c[c.Cylindrical=13]="Cylindrical";c[c.Offset=14]="Offset";
c[c.Pipe=15]="Pipe";c[c.Ruled=16]="Ruled";c[c.Revolution=17]="Revolution";c[c.Extrusion=18]="Extrusion";c[c.FromCurves=19]="FromCurves";c[c.Transform=20]="Transform"})(a=h.FaceType||(h.FaceType={}));var e=function(){function c(b){this.length=b}c.fromJson=function(b){return new c(b.length)};c.prototype.copy=function(){return new c(this.length)};c.prototype.type=function(){return g.Line};return c}();h.LineElement=e;e=function(){function c(b,c,a){this.radius=b;this.origin=c.copy();this.normal=a.copy()}
c.fromJson=function(b){var a=b.radius,e=new d.Point3(b.origin.x,b.origin.y,b.origin.z);b=new d.Point3(b.normal.x,b.normal.y,b.normal.z);return new c(a,e,b)};c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal)};c.prototype.type=function(){return g.Circle};return c}();h.CircleElement=e;e=function(){function c(b){this.length=b}c.fromJson=function(b){return new c(b.length)};c.prototype.copy=function(){return new c(this.length)};c.prototype.type=function(){return g.Other};return c}();
h.OtherEdgeElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Other};return c}();h.OtherFaceElement=e;e=function(){function c(b,c,a){this.radius=b;this.origin=c.copy();this.normal=a.copy()}c.fromJson=function(b){var a=b.radius,e=new d.Point3(b.origin.x,b.origin.y,b.origin.z);b=new d.Point3(b.normal.x,b.normal.y,b.normal.z);return new c(a,e,b)};c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal)};c.prototype.type=
function(){return a.Cylinder};return c}();h.CylinderElement=e;e=function(){function c(b,c){this.origin=b.copy();this.normal=c.copy()}c.fromJson=function(b){var a=new d.Point3(b.origin.x,b.origin.y,b.origin.z);b=new d.Point3(b.normal.x,b.normal.y,b.normal.z);return new c(a,b)};c.prototype.copy=function(){return new c(this.origin,this.normal)};c.prototype.type=function(){return a.Plane};return c}();h.PlaneElement=e;e=function(){function c(b,c,a,d){this.radius=b;this.origin=c.copy();this.normal=a.copy();
this.halfAngle=d}c.fromJson=function(b){var a=b.radius,e=b.halfAngle,g=new d.Point3(b.origin.x,b.origin.y,b.origin.z);b=new d.Point3(b.normal.x,b.normal.y,b.normal.z);return new c(a,g,b,e)};c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal,this.halfAngle)};c.prototype.type=function(){return a.Cone};return c}();h.ConeElement=e;e=function(){function c(b,c,a){this.radius=b;this.origin=c.copy();this.normal=a.copy()}c.fromJson=function(b){var a=b.radius,e=new d.Point3(b.origin.x,
b.origin.y,b.origin.z);b=new d.Point3(b.normal.x,b.normal.y,b.normal.z);return new c(a,e,b)};c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal)};c.prototype.type=function(){return a.Sphere};return c}();h.SphereElement=e;e=function(){function c(b,c,a,d){this.majorRadius=b;this.minorRadius=c;this.origin=a.copy();this.normal=d.copy()}c.fromJson=function(b){var a=new d.Point3(b.origin.x,b.origin.y,b.origin.z),e=new d.Point3(b.normal.x,b.normal.y,b.normal.z);return new c(b.majRadius,
b.minRadius,a,e)};c.prototype.copy=function(){return new c(this.majorRadius,this.minorRadius,this.origin,this.normal)};c.prototype.type=function(){return a.Torus};return c}();h.TorusElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Blend01};return c}();h.Blend01Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Blend02};return c}();h.Blend02Element=e;e=function(){function c(){}
c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Blend03};return c}();h.Blend03Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Nurbs};return c}();h.NurbsElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Cylindrical};return c}();h.CylindricalElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=
function(){return a.Offset};return c}();h.OffsetElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Pipe};return c}();h.PipeElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Ruled};return c}();h.RuledElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Revolution};return c}();h.RevolutionElement=e;e=function(){function c(){}
c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Extrusion};return c}();h.ExtrusionElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.FromCurves};return c}();h.FromCurvesElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Transform};return c}();h.TransformElement=e})(d.SubentityProperties||(d.SubentityProperties={}))})(Communicator||(Communicator=
{}));(function(d){d=d.StaticGenericType||(d.StaticGenericType={});d.IfcColumn="IFCCOLUMN";d.IfcCovering="IFCCOVERING";d.IfcCurtainWall="IFCCURTAINWALL";d.IfcDoor="IFCDOOR";d.IfcRamp="IFCRAMP";d.IfcRoof="IFCROOF";d.IfcSlab="IFCSLAB";d.IfcSpace="IFCSPACE";d.IfcStair="IFCSTAIR";d.IfcStairFlight="IFCSTAIRFLIGHT";d.IfcTransportElement="IFCTRANSPORTELEMENT";d.IfcWall="IFCWALL";d.IfcWallStandardCase="IFCWALLSTANDARDCASE";d.IfcWindow="IFCWINDOW"})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,m,h,v,y;return __generator(this,function(p){switch(p.label){case 0:return[4,c.getNodeOrRepItem(a)];case 1:e=p.sent();if(null===e||e instanceof g.RepresentationItem||e instanceof g.PartDefinition)return[2,d.BimMask.None];k=g.getNodeGenericType(e);return null!==k?[3,3]:null===f?[2,d.BimMask.None]:[4,e.getAttributes()];case 2:l=p.sent();n=0;for(m=l;n<m.length;n++)if(h=m[n],v=h.getTitle(),
v===f){k=h.getValue();break}if(null===k)return[2,d.BimMask.None];p.label=3;case 3:return y=b(k),y!==d.BimMask.None?[2,y]:[2,d.BimMask.None]}})})}function e(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(f){switch(f.label){case 0:return c=[],a={enterAnyBody:function(b){b instanceof g.BodyInstance&&c.push(b)}},[4,g.WalkerAsync.walk(a,b,g.WalkRestriction.None)];case 1:return f.sent(),[2,c]}})})}function c(b){return __awaiter(this,void 0,void 0,function(){var c,
a,f,k,g,h;return __generator(this,function(l){switch(l.label){case 0:return[4,e(b)];case 1:c=l.sent();a=new Set;f=0;for(k=c;f<k.length;f++)g=k[f],h=g.getParent(),a.add(h);return[2,d.Util.setToArray(a)]}})})}function b(b,c,f,e){return __awaiter(this,void 0,void 0,function(){var k,g,l,n,m,h,v,y,x,z,A;return __generator(this,function(p){switch(p.label){case 0:k=[];g=0;for(l=f;g<l.length;g++)n=l[g],m=a(b,c,n,e),k.push(m);return[4,Promise.all(k)];case 1:h=p.sent();v=[];y=[];x=[];for(z=0;z<f.length;++z)n=
f[z],A=h[z],A!==d.BimMask.None&&(0!==(A&d.BimMask.Floor)&&v.push(n),0!==(A&d.BimMask.Wall)&&y.push(n),0!==(A&d.BimMask.Door)&&x.push(n));return[2,{floors:v,walls:y,doors:x}]}})})}function f(b){for(var c=[],a=0;a<b.length;a++)for(var f=0,d=b[a].getBodyInstances();f<d.length;f++){var e=d[f].getInstanceInc();c.push(e[0],e[1])}return c}g.hasEffectiveGenericType=function(b,c){for(;null!==b;){if(b.getName()===c||g.getNodeGenericType(b)===c)return!0;b=g.towardProductOccurrence(b.getParent())}return!1};g.ifcAttributeToBimMask=
function(b){switch(b){case d.StaticGenericType.IfcColumn:case d.StaticGenericType.IfcCurtainWall:case d.StaticGenericType.IfcStair:case d.StaticGenericType.IfcStairFlight:case d.StaticGenericType.IfcWall:case d.StaticGenericType.IfcWallStandardCase:case d.StaticGenericType.IfcWindow:return d.BimMask.Wall|d.BimMask.Floor;case d.StaticGenericType.IfcCovering:case d.StaticGenericType.IfcRamp:case d.StaticGenericType.IfcRoof:case d.StaticGenericType.IfcSlab:return d.BimMask.Floor;case d.StaticGenericType.IfcDoor:case d.StaticGenericType.IfcTransportElement:return d.BimMask.Door|
d.BimMask.Floor}return d.BimMask.None};g.registerBimNodes=function(a,d,e,g,h){return __awaiter(this,void 0,void 0,function(){var k,l,n,m,p;return __generator(this,function(q){switch(q.label){case 0:return[4,c(g)];case 1:return k=q.sent(),[4,b(a,e,k,h)];case 2:return l=q.sent(),n=f(l.floors),d.registerBimInstances(n,0),m=f(l.walls),d.registerBimInstances(m,1),p=f(l.doors),d.registerBimInstances(p,2),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function c(b,c,a,d,e,g,h){this.headerVersion=b;this._rootAssemblyDataKey=c;this.isDrawing=a;this.isMeasurable=d;this.originalFileName=e;this.originalFileType=g;this.doublePrecisionMatrices=h}c.prototype.supportsAttributeBits=function(){return 5<=this.headerVersion};c.prototype.rootAssemblyDataKey=function(){console.assert(4294967295!==this._rootAssemblyDataKey);return this._rootAssemblyDataKey};c.parseBinary=function(b){if(0===b.length)return null;
b=new g.AssemblyDataParser(new e(null,b));var a=new g.NodeParseBits;a.parseBits1(b);if(!a.hasBits1(8388608))return null;var k=b.parseAssemblyDataHeaderVersion();if(k>c._maxHeaderVersion)throw new d.AssemblyDataParseError("Unknown header version: "+k);if(4<=k){var l=b.parseAssemblyDataVersion(3);if(!h.versionAtLeast(g.MaxModelFileVersion,l))throw new d.AssemblyDataParseError("Invalid version: "+h.versionString(l));}a.parseBits2(b);l=b.parseDataKey();var n=b.parseBoolean(),m="",p=d.FileType.Unknown,
q=!1;var r=1<=k?b.parseBoolean():!0;3<=k&&(q=a.hasBits2(64),a.hasBits2(4)&&(m=b.parseCString()),p=b.parseIndex_32());return new c(k,l,n,r,m,p,q)};c._maxHeaderVersion=5;c.dynamic=new c(c._maxHeaderVersion,4294967295,!1,!1,"",d.FileType.Unknown,!0);return c}();g.AssemblyDataHeader=a;var e=function(){return function(c,b){this.header=c;this.bytes=b}}();g.AssemblyData=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){return function(){this.prototypes=new Map;this.partDefinitions=new Map}}(),e=function(){return function(){this.bodies=new Map;this.contexts=[]}}(),c=function(){function b(b,c,a,e,m,p){this._centralQueueClock=new h.Clock;this._productOccurrences=new Map;this._pmis=new Map;this._cadViews=new Map;this._bodyInstances=new Map;this._pmiBodies=new Map;this._viewFrames=new Map;this._partDefinitions=new Map;this._representationItems=new Map;this._partToInstance=
new Map;this._filters=[];this._layers=new Map;this._layersIds=new Map;this._nextLayerId=0;this._genericTypeToNodes=new Map;this._genericIdToNodes=new Map;this._cadConfigurations=new Set;this._modelContents=new Map;this._inclusionContents=new Map;this._nodeDeletionBlackList=new Set;this._meshDeletionBlackList=new Set;this._dynamicNodeIdSeed=g.invalidNodeId;this._currentNodeIdOffset=0;this._initialEmptyNodeIdOffsetObtained=!1;this._defaultCadConfiguration=this._activeCadConfiguration=this._activeCadView=
null;this._defaultCadViewsByConfiguration=new Map;this._firstProductOccurrenceWithView=null;this._isMeasurable=this._containsDrawings=!1;this._initiallyHiddenStayHidden=this._automaticMeasurementUnitScaling=!0;this._nextLoadId=0;this._activeLoadIds=new Set;this._requestedNodes=new Map;this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0;this._seenExternalModel=this._isInitialized=!1;this._config=__assign({},b);this._engine=c;this._callbackManager=
a;this._cuttingManager=e;this._view=m;this._model=p;this._isScs=2===this._engine.getSessionType();console.assert(!this._isScs||this._engine.getRendererType()===d.RendererType.Client)}b.prototype.initialize=function(b){var c=this;console.assert(void 0===this._rootLoadContext);console.assert(void 0===this._rootNode);console.assert(!this._isInitialized);this._isInitialized=!0;console.assert(void 0===this._centralQueue);this._centralQueue=new h.PromiseQueue(b.maxConcurrentAttachments(),!1);this._callbackManager.bind({_inputInteraction:function(b,
a){c._onUserInteraction(b,a)}});this._rootLoadContext=new g.LoadContext(null,d.EmptyModelName,null);b=new g.AttachContext(new g.ScKeyRemapper,0,!1,0,this._rootLoadContext);this._rootLoadContext.addAttachContext(b);var a=new g.InclusionContext(this,b,0,0);b.addInclusionContext(a);this._rootNode=g.ProductOccurrence.createDynamic(this,a,"Models",null,null,!0);a.addProductOccurrence(this._rootNode);console.assert(this._rootNode.isAbsoluteRoot());this.preventNodeDeletion(this._rootLoadContext);this.preventNodeDeletion(b);
this.preventNodeDeletion(a);this.preventNodeDeletion(this._rootNode);this._rootNode.markLoaded()};b.prototype.isInitialized=function(){return this._isInitialized};b.prototype.getRootNode=function(){return this._rootNode};b.prototype.getAbstractScEngine=function(){return this._engine};b.prototype.generateDynamicNodeId=function(){return--this._dynamicNodeIdSeed};b.prototype.newNodeIdOffset=function(){if(!this._initialEmptyNodeIdOffsetObtained)return this._initialEmptyNodeIdOffsetObtained=!0,console.assert(0===
this._currentNodeIdOffset),0;var b=this._currentNodeIdOffset;this._currentNodeIdOffset+=4294967296;return b};b.prototype.getLowestAvailableNodeId=function(){return this._currentNodeIdOffset};b.prototype.tryParseHeader=function(b){var c=this,a=g.AssemblyDataHeader.parseBinary(b);if(null===a)return null;this._containsDrawings=this._containsDrawings||a.isDrawing;this._isMeasurable=this._isMeasurable||a.isMeasurable;return this._callbackManager.promiseTrigger("_modelStructureHeaderParsed",null,a).then(function(){c._callbackManager.trigger("modelStructureHeaderParsed",
a.originalFileName,a.originalFileType);return a})};b.prototype._isRegistered=function(b){return this._productOccurrences.has(b)||this._pmis.has(b)||this._cadViews.has(b)||this._bodyInstances.has(b)||this._pmiBodies.has(b)||this._viewFrames.has(b)||this._partDefinitions.has(b)||this._representationItems.has(b)};b.prototype.registerProductOccurrence=function(b){if(!b.isMissing()){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._productOccurrences.set(c,b);c=g.getNodeGenericType(b);
null!==c&&this.registerGenericType(b,c);c=b.getGenericId();null!==c&&this.registerGenericGlobalId(b,c);b.isAConfigurationNode()&&this._registerCadConfiguration(b);if(b.isADrawingSheetNode()||b.isADrawingViewNode())this._containsDrawings=!0}};b.prototype.lookupProductOccurrence=function(b){b=this._productOccurrences.get(b);return void 0!==b?b:null};b.prototype.registerPmi=function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._pmis.set(c,b)};b.prototype.lookupPmi=function(b){b=
this._pmis.get(b);return void 0!==b?b:null};b.prototype.registerCadView=function(b){null===this._firstProductOccurrenceWithView&&(this._firstProductOccurrenceWithView=b.getParent());var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._cadViews.set(c,b);b.isDefaultView()&&this._defaultCadViewsByConfiguration.set(this._firstProductOccurrenceWithView,b)};b.prototype.getFirstProductOccurrenceWithView=function(){return this._firstProductOccurrenceWithView};b.prototype.lookupCadView=function(b){b=
this._cadViews.get(b);return void 0!==b?b:null};b.prototype.registerBodyInstance=function(b,c){var a=b.getRuntimeId();console.assert(!this._isRegistered(a));this._bodyInstances.set(a,b);this._registerAnyBodyByInstanceInc(b,c)};b.prototype.lookupBodyInstance=function(b){b=this._bodyInstances.get(b);return void 0!==b?b:null};b.prototype.registerPmiBody=function(b,c){var a=b.getRuntimeId();console.assert(!this._isRegistered(a));this._pmiBodies.set(a,b);this._registerAnyBodyByInstanceInc(b,c)};b.prototype.lookupPmiBody=
function(b){b=this._pmiBodies.get(b);return void 0!==b?b:null};b.prototype.registerViewFrame=function(b,c){var a=b.getRuntimeId();console.assert(!this._isRegistered(a));this._viewFrames.set(a,b);this._registerAnyBodyByInstanceInc(b,c)};b.prototype.lookupViewFrame=function(b){b=this._viewFrames.get(b);return void 0!==b?b:null};b.prototype.registerPartDefinition=function(b){if(!b.isMissing()){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._partDefinitions.set(c,b)}};b.prototype.lookupPartDefinition=
function(b){b=this._partDefinitions.get(b);return void 0!==b?b:null};b.prototype.registerRepresentationItem=function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._representationItems.set(c,b)};b.prototype.lookupRepresentationItem=function(b){b=this._representationItems.get(b);return void 0!==b?b:null};b.prototype.lookupAnyBody=function(b){return this.lookupBodyInstance(b)||this.lookupPmiBody(b)||this.lookupViewFrame(b)};b.prototype.lookupAnyTreeNode=function(b){return this.lookupProductOccurrence(b)||
this.lookupPmi(b)||this.lookupCadView(b)||this.lookupAnyBody(b)};b.prototype.lookupAnyNonTreeNode=function(b){return this.lookupRepresentationItem(b)||this.lookupPartDefinition(b)};b.prototype.lookupAnyNode=function(b){return this.lookupAnyTreeNode(b)||this.lookupAnyNonTreeNode(b)};b.prototype._registerCadConfiguration=function(b){console.assert(b.isAConfigurationNode());console.assert(!this._cadConfigurations.has(b));this._cadConfigurations.add(b);b.isADefaultNode()&&null===this._defaultCadConfiguration&&
(this._defaultCadConfiguration=b)};b.prototype.getInstanceCountByInclusion=function(b){return this._getInclusionContent(b).bodies.size};b.prototype.lookupAnyBodyByInstanceInc=function(b,c){b=this._getInclusionContent(b).bodies.get(c);return void 0!==b?b:null};b.prototype._registerAnyBodyByInstanceInc=function(b,c){var a=b.getInstanceInc();c=this._getInclusionContent(c);var f=c.bodies.get(a[1]);if(void 0!==f){console.assert(b.hasAuthoredId());if(f.hasAuthoredId()){console.assert(f.constructor===b.constructor);
h.CompileTime.disable&&console.assert(!1);return}console.assert(f.constructor===g.BodyInstance);var e=f.getRuntimeId();f.getParent().removeBodyInstance(f);b instanceof g.BodyInstance?this._bodyInstances.set(e,b):b instanceof g.PmiBody?this._pmiBodies.set(e,b):(d.Util.TypeAssert(b),this._viewFrames.set(e,b))}c.bodies.set(a[1],b)};b.prototype._getInclusionContent=function(b){console.assert(4294967295!==b);var c=this._inclusionContents.get(b);void 0===c&&(c=new e,this._inclusionContents.set(b,c));return c};
b.prototype._getModelContent=function(b,c){console.assert(4294967295!==c);var f=this._modelContents.get(b);void 0===f&&(f=new Map,this._modelContents.set(b,f));b=f.get(c);void 0===b&&(b=new a,f.set(c,b));return b};b.prototype.registerPrototypeByDataId=function(b,c,a,d){b=this._getModelContent(b,c);console.assert(!b.prototypes.has(a));b.prototypes.set(a,d)};b.prototype.registerPartDefinitionByDataId=function(b,c,a,d){b=this._getModelContent(b,c);console.assert(!b.partDefinitions.has(a));b.partDefinitions.set(a,
d)};b.prototype.lookupPrototypeByDataId=function(b,c,a){b=this._getModelContent(b,c).prototypes.get(a);return void 0!==b?b:null};b.prototype.lookupPartDefinitionByDataId=function(b,c,a){b=this._getModelContent(b,c).partDefinitions.get(a);return void 0!==b?b:null};b.prototype.registerInclusionContext=function(b){var c=b.getInclusionKey();this._getInclusionContent(c).contexts.push(b)};b.prototype.getInclusionContexts=function(b){return this._getInclusionContent(b).contexts};b.prototype._createLayer=
function(b,c,a,d){a=new g.Layer(b,c,a,d);console.assert(!this._layers.has(b));this._layers.set(b,a);null!==c&&this._updateNameToLayersMap(c,b);return a};b.prototype._updateNameToLayersMap=function(b,c){var a=this._layersIds.get(b);void 0!==a?a.push(c):this._layersIds.set(b,[c])};b.prototype.createLayer=function(b,c,a){var f=this._nextLayerId++;c=this._createLayer(f,c,[],[]);a.addLayerIdToMap(f,b);return c};b.prototype.updateLayerName=function(b,c){var a=this._layers.get(b);void 0!==a&&(a.name=c,this._updateNameToLayersMap(c,
b))};b.prototype._registerNodeInLayer=function(b,c,a){var f=g.towardLoadContext(b),d=f.getRuntimeLayerId(c);c===g.Layer.NoLayerId&&null===d?d=this.createLayer(g.Layer.NoLayerId,"No layer",f).id:null===d&&(d=this._nextLayerId++,this._createLayer(d,null,[b],[]),f.addLayerIdToMap(d,c));var e=this._layers.get(d);void 0!==e?a(e).push(b):(console.assert(!1,"Layer has mapping in LoadContext but not represented in AssemblyTree"),this._createLayer(d,null,[b],[]),f.addLayerIdToMap(d,c))};b.prototype.registerNodeInLayer=
function(b,c){return this._registerNodeInLayer(b,c,function(b){return b.nodes})};b.prototype.registerTreeNodeInLayer=function(b,c){return this._registerNodeInLayer(b,c,function(b){return b.treeNodes})};b.prototype.addFilter=function(b,c){this._filters.push({filter:b,loadContext:c})};b.prototype.getFilters=function(){for(var b=new Map,c=0;c<this._filters.length;c++){var a=this.getFilterName(c)||"";b.set(c,a)}return b};b.prototype.getFilterName=function(b){return b<this._filters.length?this._filters[b].filter.name||
"":null};b.prototype.getFiltersWithNode=function(b){for(var c=b.getAuthoredId(),a=this._filters,f=[],d=0;d<a.length;d++){var e=a[d],g=e.filter;e=e.loadContext;if(null!==g.layers)for(var h=0,t=g.layers.authoredIds;h<t.length;h++){var u=e.getRuntimeLayerId(t[h]);if(null!==u){var w=this.getNodesFromLayer(u);if(null!==w)for(u=0;u<w.length;u++)b===w[u]&&f.push(d)}}if(null!==g.entities)for(e=0,g=g.entities.ids;e<g.length;e++)c===g[e]&&f.push(d)}return f};b.prototype.getNodesFromFilterIds=function(b){for(var c=
new Set,a=new Set,f=null,e=0;e<b.length;e++){var g=this._filters[b[e]],h=g.filter,r=g.loadContext,t=h.layers;if(null!==t){g=t.isInclusive;null===f&&(f=g);var u=0;for(t=t.authoredIds;u<t.length;u++){var w=r.getRuntimeLayerId(t[u]);if(null!==w&&(w=this._layers.get(w))&&null!==w.nodes)for(var v=0,y=w.nodes;v<y.length;v++)w=y[v].getRuntimeId(),g?(c.add(w),a.delete(w)):(c.delete(w),a.add(w))}}r=h.entities;if(null!==r)for(g=r.isInclusive,null===f&&(f=g),h=0,r=r.ids;h<r.length;h++)w=r[h],g?(c.add(w),a.delete(w)):
(c.delete(w),a.add(w))}return null===f?null:f?new d.FilteredNodes(!0,c):new d.FilteredNodes(!1,a)};b.prototype.getLayers=function(){var b=new Map;this._layers.forEach(function(c,a){b.set(a,c.name||"")});return b};b.prototype.getUniqueLayerNames=function(){var b=new Set,c=[];this._layers.forEach(function(a){a=a.name;null===a||b.has(a)||(b.add(a),c.push(a))});return c};b.prototype.getLayerName=function(b){b=this._layers.get(b);return void 0!==b?b.name||"":null};b.prototype.getLayersIdFromName=function(b){b=
this._layersIds.get(b);return void 0!==b?b:null};b.prototype.getNodesFromLayer=function(b,c){b=this._layers.get(b);return void 0!==b?c?b.treeNodes:b.nodes:null};b.prototype.getNodesFromLayers=function(b,c){for(var a=[],f=0;f<b.length;f++){var d=this.getNodesFromLayer(b[f],c);if(null!==d)for(var e=0;e<d.length;e++)a.push(d[e])}return a};b.prototype.getNodesFromLayerName=function(b,c){b=this._layersIds.get(b);return void 0!==b?this.getNodesFromLayers(b,c):null};b.prototype.generateProductName=function(){return"Product "+
this._unnamedProductCount++};b.prototype.generateGroupName=function(){return"Product "+this._unnamedGroupCount++};b.prototype.generateDrawingSheetName=function(){return"Product "+this._unnamedDrawingSheetCount++};b.prototype.generateDrawingViewName=function(){return"Product "+this._unnamedDrawingViewCount++};b.prototype.forEachCadView=function(b){this._cadViews.forEach(b)};b.prototype.forEachPmi=function(b){this._pmis.forEach(b)};b.prototype.forEachCadConfiguration=function(b){this._cadConfigurations.forEach(b)};
b.prototype.hasActiveCadView=function(){return null!==this._activeCadView};b.prototype.activateCadView=function(b,c,a){console.assert(null===this._activeCadView);this._activeCadView=b;return b.activate(this,this._engine,this._callbackManager,this._cuttingManager,this._view,c,a,this._activeCadConfiguration)};b.prototype.deactivateActiveCadView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._activeCadView?[2]:[4,
this._activeCadView.deactivate(this._cuttingManager)];case 1:return b.sent(),console.assert(null!==this._activeCadView),this._activeCadView=null,[2]}})})};b.prototype.getDefaultCadView=function(b){if(null===b){if(1===this._defaultCadViewsByConfiguration.size)var c=this._defaultCadViewsByConfiguration.values().next().value}else c=this._defaultCadViewsByConfiguration.get(b);return void 0!==c?c:null};b.prototype.getCadViewPmis=function(b){var c=[];this._pmis.forEach(function(a){b.hasPmi(a)&&c.push(a)});
return c};b.prototype.isMeasurable=function(){return this._isMeasurable};b.prototype.containsDrawings=function(){return this._containsDrawings};b.prototype.getCadConfigurations=function(){var b=[];this._cadConfigurations.forEach(function(c){b.push(c)});return b};b.prototype.getDefaultCadConfiguration=function(){return this._defaultCadConfiguration};b.prototype.getActiveCadConfiguration=function(){return this._activeCadConfiguration};b.prototype.activateCadConfiguration=function(b){console.assert(b.isAConfigurationNode());
this._activeCadConfiguration=b};b.prototype.massageAuthoredUserId=function(b,c){if(null===c)return this.generateDynamicNodeId();b=b.toRuntimeId(c);return null!==this.lookupAnyNode(b)?this.generateDynamicNodeId():c};b.prototype.createNode=function(b,c,a,d,e,h){void 0===h&&(h=null);c=g.ProductOccurrence.createDynamic(this,b,c,a,d,e,!1,h);b.addProductOccurrence(c);c.markLoaded();return c};b.prototype.createPart=function(b){b=g.PartDefinition.createDynamic(this,b,null);b.markLoaded();return b};b.prototype.setPart=
function(b,c){c.addReferrer(b);var a=this._partToInstance.get(c);if(void 0===a){a=g.towardInclusionContext(this._rootNode);var d=h.LazyObject.create(function(){console.assert(void 0!==f);return new g.SharedPrototypeContext(h.LazyPromise.create(f))});a=new g.PrototypeContext(d,a);var f=g.ProductOccurrence.createDynamic(this,a,null,null,null,!0);f.setPartDefinition(c);f.markLoaded()}b.setPrototype(a)};b.prototype._createCadView=function(b,c,a,d,e,h,q,r){c=g.CadView.createDynamic(this,b,c,a,d,e,h,q,
r);b.addCadView(c);c.markLoaded();return c};b.prototype._createCadViewInstance=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f,e,k,l,h,u,w,v;return __generator(this,function(n){switch(n.label){case 0:return null===a?[3,2]:[4,b.createMeshInstance(a)];case 1:d=n.sent(),f=d[0],e=d[1],k=this.generateDynamicNodeId(),l={nodeId:k,bits:786432,name:null,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,
userDatas:null},h={nodeInfo:l,inclusionKey:f,instanceKey:e,bits:0},u=g.towardAttachContext(c),w=u.getMasterModelKey(),console.assert(c.isLoaded()),v=g.ViewFrame.reify(this,w,c,h),c.setViewFrame(v),v.markLoaded(),n.label=2;case 2:return[2]}})})};b.prototype.createCadView=function(b,c,a,d,e,g,h,r,t,u){c=this._createCadView(c,a,d,e,g,h,r,t);null!==u&&(b=this._createCadViewInstance(b,c,u),b);return c};b.prototype.createMeshInstance=function(b,c,a,d,e,h,q,r,t,u){var f=0;t&&(f|=1073741824);t=0;q&&(t|=16384);
r&&(t|=268435456);u&&(t|=512);c=g.BodyInstance.createDynamic(this,c,a,d,e,h,f,t);h.addBodyInstance(c);b&&c.markLoaded();return c};b.prototype.createPmiInstance=function(b,c,a,d,e,h,q,r){var f=g.towardInclusionContext(e);b={nodeInfo:{nodeId:this.massageAuthoredUserId(f,a),bits:1073741824,name:d,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:b,instanceKey:c,bits:0};d=g.Pmi.createDynamic(this,
f,e,d,h,q,[b],r);e.addPmi(d);d.markLoaded();return d};b.prototype.getRelationshipsOfItem=function(b,c){var a=new Map,d=this.lookupAnyTreeNode(b);if(null===d)return a;b=0;for(d=g.towardInclusionContext(d).getRelationships();b<d.length;b++){var f=d[b];if(null!==f.relating&&f.relating.relationElt.id===c)g.RelationshipUtils.addFromRelatingElt(f,a);else{var e=f.related,k=-1;null!==e&&(k=g.RelationshipUtils.findIndexInRelated(c,e.relationships));0<=k&&g.RelationshipUtils.addFromRelatedElt(f,a)}}return a};
b.prototype.getAutomaticMeasurementUnitScaling=function(){return this._automaticMeasurementUnitScaling};b.prototype.setAutomaticMeasurementUnitScaling=function(b){this._automaticMeasurementUnitScaling=b};b.prototype.getInitiallyHiddenStayHidden=function(){return this._initiallyHiddenStayHidden};b.prototype.setInitiallyHiddenStayHidden=function(b){this._initiallyHiddenStayHidden=b};b.prototype._removeIdMappingsRecursive=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f,e,h,q,r=this;
return __generator(this,function(k){switch(k.label){case 0:return c=function(b){var c=b.getGenericId();null!==c&&(c=r._genericIdToNodes.get(c),void 0!==c&&c.delete(b));c=g.getNodeGenericType(b);null!==c&&(c=r._genericTypeToNodes.get(c),void 0!==c&&c.delete(b))},a=function(b){for(var c=new Map,a=0;a<b.length;a++){var d=b[a],f=d.getAuthoredLayerId();if(null!==f&&(f=g.towardLoadContext(d).getRuntimeLayerId(f),null!==f)){var e=c.get(f);void 0===e?c.set(f,[d]):e.push(d)}}c.forEach(function(b,c){c=r._layers.get(c);
c.nodes=c.nodes.filter(function(c){return-1===b.indexOf(c)});c.treeNodes=c.treeNodes.filter(function(c){return-1===b.indexOf(c)})})},f=function(b){var c=new Set;b.forEach(function(b){b=b.getInstanceInc();c.add(b[0])});c.forEach(function(c){var a=r._inclusionContents.get(c);if(void 0!==a)for(var d=0;d<b.length;d++){var f=b[d].getInstanceInc();f[0]===c&&a.bodies.delete(f[1])}})},e=[],h=[],q={enterProductOccurrence:function(b){c(b);r._productOccurrences.delete(b.getRuntimeId());e.push(b)},enterAnyBody:function(b){c(b);
var a=b.getRuntimeId();b instanceof g.BodyInstance?r._bodyInstances.delete(a):b instanceof g.PmiBody?r._pmiBodies.delete(a):(d.Util.TypeAssert(b),r._viewFrames.delete(a));e.push(b);h.push(b)},enterCadView:function(b){r._cadViews.delete(b.getRuntimeId())},enterPmi:function(b){r._pmis.delete(b.getRuntimeId())}},[4,g.WalkerAsync.walk(q,b,g.WalkRestriction.None)];case 1:return k.sent(),a(e),f(h),[2]}})})};b.prototype.deleteNode=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f,e,h,
q,r,t,u,w,v,y;return __generator(this,function(k){switch(k.label){case 0:if(!this._canDeleteNode(b))throw c=b.getRuntimeId(),new d.CommunicatorError("Cannot delete node ("+c+")");a=g.gatherInstanceIncsSync(b,7,!0,new Set,g.WalkRestriction.None);this._engine.setPartVisibility(a,!1,!1);this._engine.setInstanceModifier(d.InstanceModifier.DoNotSelect,a,!0);if(!(b instanceof g.ProductOccurrence))return[3,2];this._cadConfigurations.delete(b)&&(b===this._activeCadConfiguration&&(this._activeCadConfiguration=
null),b===this._defaultCadConfiguration&&(this._defaultCadConfiguration=null));f=b.getParent();e=g.towardLoadContext(f);console.assert(null!==f);null!==f&&(h=void 0,f instanceof g.PrototypeContext?h=f.removeReferrer(b):(f instanceof g.InclusionContext&&1===f.getChildren().length&&(q=f.getInclusionKey(),this._inclusionContents.delete(q),r=f.getModelKey(),t=this._modelContents.get(e),t.delete(r),0===t.size&&this._modelContents.delete(e)),h=f.removeProductOccurrence(b)),console.assert(h));this._productOccurrences.delete(b.getRuntimeId());
return[4,this._removeIdMappingsRecursive(b)];case 1:return k.sent(),0===e.getChildren().length?[2,e.purgeContents()]:[2,b.purgeContents()];case 2:b instanceof g.Pmi?(u=b.getParent(),u.removePmi(b),this._pmis.delete(b.getRuntimeId())):(d.Util.TypeAssert(b),w=b.getParent(),w.removeBodyInstance(b),v=b.getInstanceInc(),y=this._getInclusionContent(v[0]),y.bodies.delete(v[1]),this._bodyInstances.delete(b.getRuntimeId())),k.label=3;case 3:return[2]}})})};b.prototype._canDeleteNode=function(b){return!this._nodeDeletionBlackList.has(b)};
b.prototype.allowNodeDeletion=function(b){this._nodeDeletionBlackList.delete(b)};b.prototype.preventNodeDeletion=function(b){var c=b.getParent();if(c instanceof g.PrototypeContext)throw new d.InternalLogicError;null!==c&&(console.assert(null===c||this._nodeDeletionBlackList.has(c)),b instanceof g.ProductOccurrence?(console.assert(!b.hasAuthoredId()),console.assert(!b.isOutOfHierarchy())):b instanceof g.BodyInstance&&(c=b.getInstanceInc(),console.assert(!b.hasAuthoredId()),console.assert(0===c[0]),
console.assert(b.isOutOfHierarchy())));this._nodeDeletionBlackList.add(b)};b.prototype.preventMeshDeletion=function(b){this._meshDeletionBlackList.add(b)};b.prototype._resetContents=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return this.hasActiveCadView()?[4,this.deactivateActiveCadView()]:[3,2];case 1:return c.sent(),[2,this._resetContents()];case 2:return[4,this._rootLoadContext.purgeContents()];case 3:return c.sent(),
this._productOccurrences.clear(),this._pmis.clear(),this._cadViews.clear(),this._bodyInstances.clear(),this._pmiBodies.clear(),this._viewFrames.clear(),this._partDefinitions.clear(),this._representationItems.clear(),this._partToInstance.clear(),this._filters.length=0,this._layers.clear(),this._layersIds.clear(),this._genericTypeToNodes.clear(),this._genericIdToNodes.clear(),this._cadConfigurations.clear(),this._modelContents.clear(),this._inclusionContents.clear(),this._currentNodeIdOffset=0,this._firstProductOccurrenceWithView=
this._defaultCadConfiguration=this._activeCadConfiguration=this._activeCadView=null,this._isMeasurable=this._containsDrawings=!1,this._requestedNodes.clear(),this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0,this._seenExternalModel=!1,this._rootNode.unsetMeasurementUnit(),this._nodeDeletionBlackList.forEach(function(c){if(c instanceof g.ProductOccurrence){var a=c.getRuntimeId();b._productOccurrences.set(a,c);a=c.getParent();a instanceof
g.PrototypeContext?console.assert(!1):a.addProductOccurrence(c);c.setVisibility(!0);c.unsetMeasurementUnit();c.hasLocalTransformOverride()&&c.removeLocalTransformOverride()}else if(c instanceof g.BodyInstance){a=c.getRuntimeId();b._bodyInstances.set(a,c);a=c.getInstanceInc();var f=a[0];console.assert(0===f);f=b._getInclusionContent(f);f.bodies.set(a[1],c);c.getParent().addBodyInstance(c)}else c instanceof g.Pmi?(a=c.getRuntimeId(),b._pmis.set(a,c),c.getParent().addPmi(c)):c instanceof g.LoadContext?
(a=c.getParent(),null!==a&&a.addLoadContext(c)):c instanceof g.AttachContext?c.getParent().addAttachContext(c):(d.Util.TypeAssert(c),f=c.getInclusionKey(),console.assert(0===f),f=b._getInclusionContent(f),f.contexts.push(c),c.getParent().addInclusionContext(c))}),[2]}})})};b.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._callbackManager.promiseTrigger("_resetAssemblyTreeBegin",null)];case 1:return a.sent(),
[4,this._resetContents()];case 2:return a.sent(),b=[],this._nodeDeletionBlackList.forEach(function(c){c instanceof g.BodyInstance&&(c=c.getInstanceInc(),console.assert(0===c[0]),b.push(c[1]))}),c=[],this._meshDeletionBlackList.forEach(function(b){c.push(b)}),[4,this._engine.resetToEmpty(b,c)];case 3:return a.sent(),[4,this._resetContents()];case 4:return a.sent(),[2]}})})};b.prototype.setViewAxes=function(b,c){this._model.setViewAxes(b,c)};b.prototype._requestIncsOfNodes=function(b){return __awaiter(this,
void 0,void 0,function(){var c,a,f,e,h,q,r,t,u;return __generator(this,function(k){switch(k.label){case 0:if(this._config.streamingMode!==d.StreamingMode.OnDemand)return[2];c=new Set;a=[];f=[];e=0;for(h=b;e<h.length;e++)q=h[e],r=g.gatherInstanceIncs(q,7,!1,c).then(function(b){for(var c=0;c<b.length;c++)a.push(b[c])}),f.push(r);return[4,d.Util.waitForAll(f)];case 1:return k.sent(),t=[],u=[],c.forEach(function(b){if(!b.isRequested()){b.setRequested();var c=b.isInitiallyShown();c!==b.isVisible()&&(c?
(b.setVisibility(!0),t.push(b.getRuntimeId())):(b.setVisibility(!1),u.push(b.getRuntimeId())))}}),0<t.length+u.length&&this._callbackManager.trigger("visibilityChanged",t,u),this._engine.requestMeshInstances(a),[2]}})})};b.prototype._requestExternalModelsLocal=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return[4,c.loadPendingExternalModels(b)];case 1:return d=f.sent(),0===d.length?[3,4]:[4,g.markContextsLoaded(d)];
case 2:return f.sent(),[4,this._requestNodes(b,[c],a)];case 3:f.sent(),f.label=4;case 4:return[2,d]}})})};b.prototype._requestExternalModelsNonLocal=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f,e,k,l,t,u,w;return __generator(this,function(n){switch(n.label){case 0:return[4,g.gatherParentsOfPendingExternalModels(c)];case 1:d=n.sent();if(0===d.length)return[2,[]];f=[];e=0;for(k=d;e<k.length;e++)l=k[e],t=this._requestExternalModelsLocal(b,l,a),f.push(t);w=h.concatAll;return[4,
Promise.all(f)];case 2:return u=w.apply(void 0,[n.sent()]),[2,u]}})})};b.prototype._requestExternalModelsOfNodes=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f,e,k,g,l,u;return __generator(this,function(n){switch(n.label){case 0:d=[];f=0;for(e=c;f<e.length;f++)k=e[f],g=this._requestExternalModelsNonLocal(b,k,a),d.push(g);u=h.concatAll;return[4,Promise.all(d)];case 1:return l=u.apply(void 0,[n.sent()]),[2,l]}})})};b.prototype._requestNodes=function(b,c,a){return __awaiter(this,
void 0,void 0,function(){var d,f,e,k,l,h,u,w,v;return __generator(this,function(n){switch(n.label){case 0:if(!a)for(d=0!==this._activeLoadIds.size,f=[],d&&this._activeLoadIds.forEach(function(b){f.push(b)}),e=0,k=c;e<k.length;e++)l=k[e],d&&this._requestedNodes.set(l,f),l instanceof g.ProductOccurrence&&b.notifyDirectRequest(l);h=this._requestIncsOfNodes(c);u=this._requestExternalModelsOfNodes(b,c,a);w=[h,u];return[4,Promise.all(w)];case 1:return v=n.sent()[1],[2,v]}})})};b.prototype.requestNodes=
function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,g,l,t,u;return __generator(this,function(n){switch(n.label){case 0:return[4,this._requestNodes(b,c,a)];case 1:f=n.sent();e=[];k=0;for(g=f;k<g.length;k++)l=g[k],t=l.getChildren(),h.concatInPlace(e,t);if(!(0<e.length))return[3,3];u=e.map(function(b){return b.getRuntimeId()});return[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",u,d.NodeSource.LoadModel)];case 2:n.sent(),n.label=3;case 3:return[2]}})})};
b.prototype.isBeingRequested=function(b){for(;;)if(b instanceof g.NodeMixin){if(this._requestedNodes.has(b))return!0;b=b.getParent()}else if(b instanceof g.AttachContext)b=b.getParent();else if(b instanceof g.InclusionContext)b=b.getParent();else if(b instanceof g.LoadContext){if(b=b.getParent(),null===b)return!1}else return d.Util.TypeAssert(b),console.assert(!1),!1};b.prototype.onDemandRequestsActive=function(){return 0!==this._requestedNodes.size};b.prototype.onLoadBegin=function(){var b=this._nextLoadId++;
this._activeLoadIds.add(b);return b};b.prototype.onLoadEnd=function(b){var c=this;this._activeLoadIds.delete(b);var a=[];this._requestedNodes.forEach(function(b,d){for(var f=!0,e=0;e<b.length;e++)if(c._activeLoadIds.has(b[e])){f=!1;break}f&&a.push(d)});for(b=0;b<a.length;b++)this._requestedNodes.delete(a[b])};b.prototype.markSeenExternalModel=function(){this._seenExternalModel=!0};b.prototype.seenExternalModel=function(){return this._seenExternalModel};b.prototype.getNodesByGenericId=function(b){return this._genericIdToNodes.get(b)||
null};b.prototype.getNodesByGenericType=function(b){return this._genericTypeToNodes.get(b)||null};b.prototype.genericTypeToNodes=function(){return this._genericTypeToNodes};b.prototype.registerGenericGlobalId=function(b,c){var a=this._genericIdToNodes.get(c);void 0===a&&(a=new Set);a.add(b);this._genericIdToNodes.set(c,a)};b.prototype.registerGenericType=function(b,c){var a=this._genericTypeToNodes.get(c);void 0===a&&(a=new Set);a.add(b);this._genericTypeToNodes.set(c,a)};b.prototype.disableAutomaticFitWorld=
function(){return this._config.disableAutomaticFitWorld};b.prototype.markImplicitNodesOutOfHierarchy=function(){return this._config.markImplicitNodesOutOfHierarchy};b.prototype._throttleLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._engine.throttleLoad(200,200),[4,this._engine.sleep(20)];case 1:return b.sent(),[2]}})})};b.prototype.enqueue=function(b){var c=this,a="function"===typeof b?h.Lazy.create(b):b;return this._centralQueue.push(function(){return __awaiter(c,
void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:return(b=this._isScs&&this._centralQueueClock.isTicking())?[4,this._throttleLoad()]:[3,2];case 1:d.sent(),d.label=2;case 2:return[4,a.get()];case 3:return c=d.sent(),b?[4,this._throttleLoad()]:[3,5];case 4:d.sent(),d.label=5;case 5:return[2,c]}})})})};b.prototype._onUserInteraction=function(b,c){if(this._isScs){var a=!1;switch(c){case d.EventType.MouseDown:case d.EventType.MouseUp:case d.EventType.Mousewheel:case d.EventType.TouchStart:case d.EventType.TouchMove:case d.EventType.TouchEnd:case d.EventType.KeyDown:case d.EventType.KeyUp:case d.EventType.ViewOrientationChange:a=
!0;break;case d.EventType.MouseMove:a=b.getButtons()!==d.Buttons.None;break;default:d.Util.TypeAssertNever(c)}a&&this._centralQueueClock.tickFor(1E3)}};return b}();g.AssemblyTree=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c){var b=this;return function(a,d){return __awaiter(b,void 0,void 0,function(){var b,f;return __generator(this,function(e){switch(e.label){case 0:return b=h.versionAtLeast(d,[7,3])?a+".scs":a,[4,c(b)];case 1:return f=e.sent(),"string"===typeof f?h.FetchApi.isSupported()?[2,h.FetchApi.request(f)]:[2,h.httpRequestBuffer(f)]:[2,f]}})})}}var e=function(){function c(b,c,a,d,e,m){this._clearQueue=new h.PromiseQueue(1,!1);this._clearInProgress=!1;this._cadConfigurationsEnabled=
!0;this._engine=c;this._callbackManager=a;this._cuttingManager=d;this._view=e;this._model=m;this._assemblyTree=new g.AssemblyTree(b,this._engine,this._callbackManager,this._cuttingManager,this._view,this._model);this._readyPromise=h.TrackedOpenPromise.create()}c.unsafeCreate=function(b,c,a,d,e,g,h){return this._create(b,c,a,d,e,g,h).unsafeValue};c.create=function(b,c,a,d,e,g,h){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._create(b,c,a,d,e,g,h)]})})};
c._create=function(b,a,d,e,g,m,p){b=new c(b,a,d,e,g,m);p=b._init(p);return h.UnsafePromise.create(b,p)};c.prototype._init=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(d){switch(d.label){case 0:return[4,g.ScAttacher.createWithEmptyModel(this._engine,this._view,this._callbackManager,b)];case 1:return c=d.sent(),this._assemblyTree.initialize(c),a=new g.TreeLoader(this._assemblyTree,c,this._engine,this._view,this._callbackManager),this._callbackManager.trigger("modelStructureLoadBegin"),
this._callbackManager.trigger("modelStructureLoadEnd"),this._callbackManager.trigger("modelStructureParseBegin"),console.assert(void 0===this._treeLoader),this._treeLoader=a,this._readyPromise.resolve(),[2]}})})};c.prototype._loadSubtreePrologue=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(e){switch(e.label){case 0:if(this._engine.getSessionType()!==b)throw new d.LoadError("Incompatible load types.");return a?[4,this._clearQueue.waitOnLatest()]:
[3,2];case 1:e.sent(),e.label=2;case 2:if(this._clearInProgress)throw new d.LoadCancelledError;f=this._assemblyTree.lookupProductOccurrence(c);if(null===f)throw new d.InvalidNodeTypeError(c,0);return[2,f]}})})};c.prototype._loadSubtreeEpilogue=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f;return __generator(this,function(e){switch(e.label){case 0:return b.isFirstLoad()&&2===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",null)]:[3,
2];case 1:e.sent(),e.label=2;case 2:return a=b.getChildren(),f=a.map(function(b){return b.getRuntimeId()}),c?[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",f,d.NodeSource.LoadModel)]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2,f]}})})};c.prototype.loadSubtreeFromXmlFile=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._disableCadConfigurations()];case 1:return k.sent(),[4,
this._loadSubtreePrologue(1,b,!0)];case 2:return f=k.sent(),[4,this._treeLoader.loadByXmlFile(d,f,c,a)];case 3:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!1)]}})})};c.prototype.loadSubtreeFromXmlDoc=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._disableCadConfigurations()];case 1:return k.sent(),[4,this._loadSubtreePrologue(1,b,!0)];case 2:return f=k.sent(),[4,this._treeLoader.loadByXmlDoc(d,
f,c,a)];case 3:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!1)]}})})};c.prototype.loadSubtreeFromScsXmlFile=function(b,c,d,e){return __awaiter(this,void 0,void 0,function(){var f,k,g;return __generator(this,function(l){switch(l.label){case 0:return[4,this._disableCadConfigurations()];case 1:return l.sent(),[4,this._loadSubtreePrologue(2,b,!0)];case 2:return f=l.sent(),k=a(d),[4,this._treeLoader.loadByXmlFile(e,f,c,k)];case 3:return g=l.sent(),[2,this._loadSubtreeEpilogue(g,!1)]}})})};c.prototype.loadSubtreeFromScsXmlDoc=
function(b,c,d,e){return __awaiter(this,void 0,void 0,function(){var f,k,g;return __generator(this,function(l){switch(l.label){case 0:return[4,this._disableCadConfigurations()];case 1:return l.sent(),[4,this._loadSubtreePrologue(2,b,!0)];case 2:return f=l.sent(),k=a(d),[4,this._treeLoader.loadByXmlDoc(e,f,c,k)];case 3:return g=l.sent(),[2,this._loadSubtreeEpilogue(g,!1)]}})})};c.prototype._loadSubtreeFromStream=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,
function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(1,b,a)];case 1:return f=k.sent(),[4,this._treeLoader.loadByStream(d,f,c)];case 2:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,d._allowSubtreeLoadedCallback)]}})})};c.prototype.loadSubtreeFromStream=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._loadSubtreeFromStream(b,c,!0,a)]})})};c.prototype.loadSubtreeFromScsFile=function(b,c,a){return __awaiter(this,void 0,
void 0,function(){var d,f;return __generator(this,function(e){switch(e.label){case 0:return[4,this._loadSubtreePrologue(2,b,!0)];case 1:return d=e.sent(),[4,this._treeLoader.loadByScsFile(a,d,c)];case 2:return f=e.sent(),[2,this._loadSubtreeEpilogue(f,a._allowSubtreeLoadedCallback)]}})})};c.prototype.loadSubtreeFromScsBuffer=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(e){switch(e.label){case 0:return[4,this._loadSubtreePrologue(2,b,!0)];
case 1:return d=e.sent(),[4,this._treeLoader.loadByScsBuffer(a,d,c)];case 2:return f=e.sent(),[2,this._loadSubtreeEpilogue(f,a._allowSubtreeLoadedCallback)]}})})};c.prototype.loadSubtreeFromAssemblyData=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(1,b,!0)];case 1:return f=k.sent(),[4,this._treeLoader.loadByAssemblyData(d,f,c,a)];case 2:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,
d._allowSubtreeLoadedCallback)]}})})};c.prototype.loadMeasurementFromJson=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,e,n,h,p,q,r,t,u,w,v,y,x,z,A,C;return __generator(this,function(f){switch(f.label){case 0:c=Object.keys(b),a=0,e=c,f.label=1;case 1:if(!(a<e.length))return[3,4];n=e[a];h=parseInt(n,10);if(isNaN(h))return[3,3];p=b[h];q=parseInt(p.instance_id,10);return isNaN(q)?[3,3]:[4,this._getNodeOrRepItemFromId(q)];case 2:r=f.sent();if(!(r instanceof g.RepresentationItem))return[3,
3];t=p.edge_properties;for(u=0;u<t.length;u++){w=t[u];v=w.id;y=w.data;x=null;switch(w.type){case "circle":x=d.SubentityProperties.CircleElement.fromJson(y);break;case "line":x=d.SubentityProperties.LineElement.fromJson(y);break;case "unknown_edge":x=d.SubentityProperties.OtherEdgeElement.fromJson(y)}null!==x&&r.setEdgeMeasurementProperty(v,x)}z=p.face_properties;for(A=0;A<z.length;A++){w=z[A];C=w.id;y=w.data;x=null;switch(w.type){case "cylinder":x=d.SubentityProperties.CylinderElement.fromJson(y);
break;case "plane":x=d.SubentityProperties.PlaneElement.fromJson(y);break;case "cone":x=d.SubentityProperties.ConeElement.fromJson(y);break;case "sphere":x=d.SubentityProperties.SphereElement.fromJson(y);break;case "torus":x=d.SubentityProperties.TorusElement.fromJson(y)}null!==x&&r.setFaceMeasurementProperty(C,x)}f.label=3;case 3:return a++,[3,1];case 4:return[2]}})})};c.prototype.loadMeasurementFromString=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=
JSON.parse(b);return[2,this.loadMeasurementFromJson(c)]})})};c.prototype.loadMeasurementFromFile=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e;return __generator(this,function(f){switch(f.label){case 0:return[4,h.httpRequest(b,"blob")];case 1:c=f.sent();if(200!==c.status)throw Error("Cannot pull measurement file '"+b+"': "+c.response);return[4,JSZip.loadAsync(c.response)];case 2:a=f.sent();d=a.file("measurement.json");if(!d)throw Error("Cannot pull measurement data from '"+
b+"'");return[4,d.async("string")];case 3:return e=f.sent(),[2,this.loadMeasurementFromString(e)]}})})};c.prototype._clearImpl=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:console.assert(!this._clearInProgress),this._clearInProgress=!0,c.label=1;case 1:return c.trys.push([1,6,,7]),[4,this._treeLoader.cancelActiveAttachmentProcess()];case 2:return c.sent(),[4,this._treeLoader.cancelPendingLoads()];case 3:return c.sent(),
console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),[4,this._treeLoader.reset()];case 4:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),[4,this._assemblyTree.reset()];case 5:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),this._clearInProgress=!1,[3,7];case 6:throw b=c.sent(),console.assert(this._clearInProgress),this._clearInProgress=!1,b;case 7:return[2]}})})};c.prototype.clear=
function(){var b=this;return this._clearQueue.push(function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._callbackManager.trigger("modelSwitchStart",!0),[4,this._clearImpl()];case 1:return b.sent(),[2,this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",!0,[],h.AttachType.Direct)]}})})})};c.prototype.switchToModel=function(b){var c=this,a=b===d.EmptyModelName;return this._clearQueue.push(function(){return __awaiter(c,
void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return this._callbackManager.trigger("modelSwitchStart",!1),[4,this._clearImpl()];case 1:f.sent();if(!a)return[3,2];c=[];return[3,4];case 2:return[4,this._loadSubtreeFromStream(this.getAbsoluteRootNodeId(),b,!1,new d.LoadSubtreeConfig)];case 3:c=f.sent(),f.label=4;case 4:return[4,this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",a,c,h.AttachType.Direct)];case 5:return f.sent(),[2,c]}})})})};
c.prototype.getAbsoluteRootNodeId=function(){return this._assemblyTree.getRootNode().getRuntimeId()};c.prototype.isIdValid=function(b){return null!==this._assemblyTree.lookupAnyNode(b)};c.prototype._getNodeChildren=function(b,c){var a=b.getChildrenSync();c||(a=a.filter(function(b){return!b.isOutOfHierarchy()}));for(var d=0,f=b.getBodyInstances();d<f.length;d++){var e=f[d];e.isOutOfHierarchy()&&!c||a.push(e)}c=0;for(b=b.getPmis();c<b.length;c++)a.push(b[c]);return a};c.prototype.getChildIds=function(b,
c){var a=this._assemblyTree.lookupProductOccurrence(b);if(null===a)return[];b=[];var d=0;for(c=this._getNodeChildren(a,c);d<c.length;d++)b.push(c[d].getRuntimeId());return b};c.prototype.isOutOfHierarchy=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b&&g.isOutOfHierarchy(b)};c.prototype.getParentId=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return null;b=g.towardContainerNode(b.getParent());return null===b?null:b.getRuntimeId()};c.prototype.getPartReferrers=
function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e,h,p,q,r,t,u,w,v,y;return __generator(this,function(f){switch(f.label){case 0:c=this._assemblyTree.lookupProductOccurrence(b);if(null===c)return[2,null];a=this._assemblyTree.getRootNode();return[4,g.forcePrototypes(a)];case 1:return f.sent(),[4,g.forcePartDefinitions(a)];case 2:f.sent();d=c.getPartDefinitionSync();if(null===d)return[2,null];e=d.getReferrers();h=new Set;p=0;for(q=e;p<q.length;p++)for(r=q[p],t=r.getParent(),u=t.getReferrers(),
w=0,v=u;w<v.length;w++)y=v[w],h.add(y.getRuntimeId());return[2,Array.from(h)]}})})};c.prototype.getAttributes=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return c=a.sent(),null===c?[2,[]]:[2,c.getAttributes()]}})})};c.prototype.getProperties=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,e,m,p,q,r,t,u=this;return __generator(this,function(k){switch(k.label){case 0:return[4,
this._getNodeOrRepItemFromId(b)];case 1:a=k.sent();if(null===a)return[2,null];f={};e={};m=[];p=a.getAttributes().then(function(b){for(var c=0;c<b.length;c++){var a=b[c],d=a.getValueName(),e=a.getTitle();null!==d&&(e=""!==e?e+"/"+d:d);a=""+a.getValue()+a.getUnit();f[e]=a}});m.push(p);q=function(c){var a=u.getNetMatrix(b),e=new d.Point3(a[0],a[1],a[2]),k=u.getUnit(b),g=e.length()/k;e=c.volume*g*g*g;g=d.Util.formatWithUnit(c.surfaceArea*g*g,k);f["Surface Area"]=""+g+h.Unicode.Subscript2;e=d.Util.formatWithUnit(e,
k);f.Volume=""+e+h.Unicode.Subscript3;c=d.Matrix.createFromArray(a).transform(c.centerOfGravity);a=d.Point3.scale(c,1/k);k=a.x.toLocaleString();c=a.y.toLocaleString();a=a.z.toLocaleString();f.COG="x:"+k+" y:"+c+" z:"+a};r=function(b){return __awaiter(u,void 0,void 0,function(){var c,a,d,f,k,g,l,n;return __generator(this,function(h){switch(h.label){case 0:return[4,b.value];case 1:return c=h.sent(),null===c?[3,3]:[4,c.getAttributes()];case 2:a=h.sent();d=0;for(f=a;d<f.length;d++)k=f[d],g=k.getValueName(),
l=k.getTitle(),null!==g&&(l=""!==l?l+"/"+g:g),n=""+k.getValue()+k.getUnit(),e[l]=n;h.label=3;case 3:return[2]}})})};a instanceof g.RepresentationItem?(t=a.getPhysicalProperties(),null!==t&&q(t)):a instanceof g.ProductOccurrence&&(p=Promise.resolve(g.forcePartDefinition(a)).then(function(){return __awaiter(u,void 0,void 0,function(){var b,d;return __generator(this,function(f){switch(f.label){case 0:return[4,a.getPhysicalProperties(c)];case 1:return b=f.sent(),null!==b&&q(b),[4,a.getPartDefinition()];
case 2:return d=f.sent(),null!==d?[2,r(d)]:[2]}})})}),m.push(p));return[4,d.Util.waitForAll(m)];case 2:return k.sent(),[2,__assign({},e,f)]}})})};c.prototype.addProperty=function(b,c,a,e){b=this._assemblyTree.lookupAnyNode(b);if(null===b)return!1;c=new g.Attribute(d.AttributeType.String,c,null,a,e);b.addAttribute(c);return!0};c.prototype.setPhysicalProperties=function(b,c,a,d){b=this._assemblyTree.lookupRepresentationItem(b);if(null===b)return!1;c=new g.PhysicalProperties(a,d,c);b.setPhysicalProperties(c);
return!0};c.prototype.getUserDataIndices=function(b){var c=this._assemblyTree.lookupAnyTreeNode(b);if(null===c)throw new d.InvalidNodeIdError(b);return c.getUserDataIndices()};c.prototype.getUserData=function(b,c){var a=this._assemblyTree.lookupAnyTreeNode(b);if(null===a)throw new d.InvalidNodeIdError(b);return a.getUserData(c)};c.prototype.getInstanceIncs=function(b,c){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return console.assert(!1),[];var a=g.isOutOfHierarchy(b),d=new Set;return g.gatherInstanceIncsSync(b,
c,a,d,g.WalkRestriction.None)};c.prototype.getNodeFromInstanceInc=function(b,c,a,d){var f=this._assemblyTree.lookupAnyBodyByInstanceInc(c,a);null===f?(f=b?this._rectifyParent(c,null):this._assemblyTree.getRootNode(),f=this._assemblyTree.createMeshInstance(b,c,a,null,null,f,!1,d,!0,!1)):f instanceof g.PmiBody?f=f.getParent():f instanceof g.ViewFrame&&(b=f.getParent(),b);return f.getRuntimeId()};c.prototype._getAssociatedModelKey=function(b){if(b instanceof g.PartDefinition)return b.getModelKey();d.Util.TypeAssert(b);
return this._getAssociatedModelKey(b.getParent())};c.prototype.getAssociatedModelKey=function(b){var c=this._assemblyTree.lookupAnyTreeNode(b);return null===c?(c=this._assemblyTree.lookupAnyNonTreeNode(b),null===c?null:this._getAssociatedModelKey(c)):g.towardAttachContext(c).getMasterModelKey()};c.prototype.getMatrix=function(b){b=this._assemblyTree.lookupAnyNode(b);if(null===b)return new d.Matrix;b=b.getLocalTransform();return null===b?new d.Matrix:d.Matrix.createFromArray(b)};c.prototype.setMatrix=
function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(e){d=this._assemblyTree.lookupAnyTreeNode(b);if(null===d)return[2];a?d.setLocalTransformAsInitial(c.m):d.overrideLocalTransform(c.m);f=g.isOutOfHierarchy(d);return[2,g.updateScMatrices(this._engine,this._callbackManager,[d],f)]})})};c.prototype.setMatrices=function(b,c,a){for(var d=[],f=!1,e=0;e<b.length;e++){var k=this._assemblyTree.lookupAnyTreeNode(b[e]),h=c[e];null!==k&&(a?k.setLocalTransformAsInitial(h.m):
k.overrideLocalTransform(h.m),f=f||g.isOutOfHierarchy(k),d.push(k))}return g.updateScMatrices(this._engine,this._callbackManager,d,f)};c.prototype.resetToInitialMatrix=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(d){c=this._assemblyTree.lookupAnyTreeNode(b);return null===c?[2]:c.hasLocalTransformOverride()?(c.removeLocalTransformOverride(),a=g.isOutOfHierarchy(c),[2,g.updateScMatrices(this._engine,this._callbackManager,[c],a)]):[2]})})};c.prototype.getNetMatrix=
function(b){b=this._assemblyTree.lookupAnyNode(b);return null===b?g.Transform.getIdentity():g.getNetMatrix(b)};c.prototype._getBodyInstanceIndexFrom=function(b,c,a){void 0===a&&(a={});for(var d=0,f=b.getBodyInstances();d<f.length;d++){var e=f[d];void 0!==a.value?a.value++:a.value=0;if(e===c)return a.value}d=0;for(f=b.getChildrenSync();d<f.length;d++)if(b=this._getBodyInstanceIndexFrom(f[d],c,a),void 0!==b)return b};c.prototype.getNodeOrRepItem=function(b){return __awaiter(this,void 0,void 0,function(){var c,
a,d,e,h,p;return __generator(this,function(f){switch(f.label){case 0:if(!(b instanceof g.BodyInstance))return[3,8];c=void 0;a=b.getParent();d=void 0;e=a;f.label=1;case 1:return e instanceof g.ProductOccurrence?[4,g.forcePartDefinition(e)]:[2,null];case 2:return f.sent(),[4,e.getPartDefinition()];case 3:return h=f.sent(),null===h?[3,5]:[4,h.value];case 4:return d=f.sent(),[3,7];case 5:e=e.getParent(),f.label=6;case 6:return[3,1];case 7:return c=this._getBodyInstanceIndexFrom(e,b),p=d.getRepresentationItems(),
void 0!==c&&c<p.length?[2,p[c]]:[2,null];case 8:if(b instanceof g.ProductOccurrence||b instanceof g.Pmi||b instanceof g.CadView||b instanceof g.PartDefinition||b instanceof g.RepresentationItem)return[2,b];f.label=9;case 9:return[2,null]}})})};c.prototype._getNodeOrRepItemFromId=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=this._assemblyTree.lookupAnyNode(b);return null===c?[2,null]:[2,this.getNodeOrRepItem(c)]})})};c.prototype.getPointAttributes=
function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=f.sent(),a instanceof g.RepresentationItem&&(d=a.getPointAttributes(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getEdgeCount=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return c=
a.sent(),c instanceof g.RepresentationItem?[2,c.getEdgeCount()]:[2,0]}})})};c.prototype.getEdgeAttributes=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=f.sent(),a instanceof g.RepresentationItem&&(d=a.getEdgeAttributes(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getEdgeProperty=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,
function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=f.sent(),a instanceof g.RepresentationItem&&(d=a.getEdgeMeasurementProperty(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getFaceCount=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return c=a.sent(),c instanceof g.RepresentationItem?[2,c.getFaceCount()]:[2,0]}})})};c.prototype.getFaceAttributes=
function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=f.sent(),a instanceof g.RepresentationItem&&(d=a.getFaceAttributes(c),null!=d)?[2,d.copy()]:[2,null]}})})};c.prototype.getFaceProperty=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=
f.sent(),a instanceof g.RepresentationItem&&(d=a.getFaceMeasurementProperty(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.setEdgeProperty=function(b,c,a){b=this._assemblyTree.lookupRepresentationItem(b);null!==b&&g.MeasurementProperty.isEdge(a)&&b.setEdgeMeasurementProperty(c,a)};c.prototype.setFaceProperty=function(b,c,a){b=this._assemblyTree.lookupRepresentationItem(b);null!==b&&g.MeasurementProperty.isFace(a)&&b.setFaceMeasurementProperty(c,a)};c.prototype.getName=function(b){b=this._assemblyTree.lookupAnyNode(b);
return null!==b?b.getName():null};c.prototype.getNodeExchangeId=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?b.getExchangeId():null};c.prototype.getFilters=function(){return this._assemblyTree.getFilters()};c.prototype.getFilterName=function(b){return this._assemblyTree.getFilterName(b)};c.prototype.getFiltersWithNode=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null===b?[]:this._assemblyTree.getFiltersWithNode(b)};c.prototype.getNodesFromFilterIds=function(b){return this._assemblyTree.getNodesFromFilterIds(b)};
c.prototype.getLayers=function(){return this._assemblyTree.getLayers()};c.prototype.getUniqueLayerNames=function(){return this._assemblyTree.getUniqueLayerNames()};c.prototype.getLayerName=function(b){return this._assemblyTree.getLayerName(b)};c.prototype.getLayerIdsFromName=function(b){return this._assemblyTree.getLayersIdFromName(b)};c.prototype.getNodeLayerId=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return null;var c=b.getAuthoredLayerId();return null===c?null:g.towardLoadContext(b).getRuntimeLayerId(c)};
c.prototype.getAuthoredNodesFromLayer=function(b,c){b=this._assemblyTree.getNodesFromLayer(b,c);return null===b?null:b.map(function(b){return b.getAuthoredId()})};c.prototype.getAuthoredNodesFromLayers=function(b,c){b=this._assemblyTree.getNodesFromLayers(b,c);return null===b?null:b.map(function(b){return b.getAuthoredId()})};c.prototype.getRuntimeNodesFromLayer=function(b,c){b=this._assemblyTree.getNodesFromLayer(b,c);return null===b?null:b.map(function(b){return b.getRuntimeId()})};c.prototype.getRuntimeNodesFromLayers=
function(b,c){b=this._assemblyTree.getNodesFromLayers(b,c);return null===b?null:b.map(function(b){return b.getRuntimeId()})};c.prototype.getRuntimeNodesFromLayerName=function(b,c){b=this._assemblyTree.getNodesFromLayerName(b,c);return null===b?null:b.map(function(b){return b.getRuntimeId()})};c.prototype.createCadView=function(b,c,a,d,e,g,h,q,r){if(null===this._assemblyTree.lookupProductOccurrence(b))return null;b=this._assemblyTree.lookupProductOccurrence(b);if(null===b)return null;for(var f=[],
k=0;k<d.length;k++){var l=this._assemblyTree.lookupPmi(d[k]);null!==l&&f.push(l)}d=new Map;for(k=0;k<h.length;k++)l=h[k],d.set(l[0],l[1].m);return this._assemblyTree.createCadView(this._engine,b,c,a,f,e,g,d,q,r).getRuntimeId()};c.prototype.getCadViewMap=function(){var b=this._assemblyTree.getFirstProductOccurrenceWithView(),c=new Map;this._assemblyTree.forEachCadView(function(a){var d=a.getRuntimeId(),f=a.getParent();a=f===b?a.getName()||"(null)":f.getName()+" - "+a.getName();c.set(d,a)});return c};
c.prototype.activateCadView=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return this._assemblyTree.hasActiveCadView()?[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:return f.sent(),[2,this.activateCadView(b,c,a)];case 2:return d=this._assemblyTree.lookupCadView(b),null===d?[2]:[2,this._assemblyTree.activateCadView(d,c,a)]}})})};c.prototype.getCadViewPmis=function(b){var c=this._assemblyTree.lookupCadView(b);
if(null===c)return[];b=[];var a=0;for(c=this._assemblyTree.getCadViewPmis(c);a<c.length;a++)b.push(c[a].getRuntimeId());return b};c.prototype._disableCadConfigurations=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._cadConfigurationsEnabled=!1,[4,this._assemblyTree.deactivateActiveCadView()];case 1:return b.sent(),[2]}})})};c.prototype.cadConfigurationsEnabled=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return this._cadConfigurationsEnabled&&this._assemblyTree.seenExternalModel()?[4,this._disableCadConfigurations()]:[3,2];case 1:b.sent(),b.label=2;case 2:return[2,this._cadConfigurationsEnabled]}})})};c.prototype.getCadConfigurations=function(){var b={};this._assemblyTree.forEachCadConfiguration(function(c){var a=c.getRuntimeId();c=c.getName()||"(null)";b[a]=c});return b};c.prototype.getDefaultCadConfiguration=function(){var b=this._assemblyTree.getDefaultCadConfiguration();
return null!==b?b.getRuntimeId():null};c.prototype.getActiveCadConfiguration=function(){var b=this._assemblyTree.getActiveCadConfiguration();return null!==b?b.getRuntimeId():null};c.prototype.getCadViewConfiguration=function(b){b=this._assemblyTree.lookupCadView(b);if(null===b)return null;b=b.getParent();return null!==b&&b.isAConfigurationNode()?b.getRuntimeId():null};c.prototype._activateCadConfiguration=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,e,h,p;return __generator(this,
function(k){switch(k.label){case 0:return this._assemblyTree.activateCadConfiguration(b),a=b.getRuntimeId(),f=this._assemblyTree.getCadConfigurations().filter(function(c){return c!==b}).map(function(b){return b.getRuntimeId()}),e=new Map,e.set(a,!0),f.forEach(function(b){e.set(b,!1)}),[4,this.setVisibilitiesByMap(e)];case 1:return k.sent(),[4,g.gatherInstanceIncs(b,7,!0,new Set)];case 2:return h=k.sent(),(p=c&&null!==h&&0<h.length)?[4,this._view.fitNodes([a],d.DefaultTransitionDuration)]:[3,4];case 3:k.sent(),
k.label=4;case 4:return this._callbackManager.trigger("configurationActivated",a),[2]}})})};c.prototype.activateCadConfiguration=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){a=this._assemblyTree.lookupProductOccurrence(b);return null===a?[2]:[2,this._activateCadConfiguration(a,c)]})})};c.prototype.activateDefaultCadConfiguration=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return c=
this._assemblyTree.getDefaultCadConfiguration(),null===c?[3,2]:[4,this._activateCadConfiguration(c,b)];case 1:a.sent(),a.label=2;case 2:return[2]}})})};c.prototype.getDefaultCadView=function(){var b=this._assemblyTree.getDefaultCadConfiguration();b=this._assemblyTree.getDefaultCadView(b);return null!==b?b.getRuntimeId():null};c.prototype.activateDefaultCadView=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return a=this.getDefaultCadView(),
null===a?[3,2]:[4,this.activateCadView(a,b,c)];case 1:d.sent(),d.label=2;case 2:return[2]}})})};c.prototype.getPmis=function(){var b={};this._assemblyTree.forEachPmi(function(c){var a=c.getRuntimeId();c=c.getName()||"(null)";b[a]=c});return b};c.prototype.getPmiType=function(b){b=this._assemblyTree.lookupPmi(b);return null===b?g.PmiType.Unknown:b.getPmiType()};c.prototype.getPmiSubType=function(b){b=this._assemblyTree.lookupPmi(b);return null===b?d.PmiSubType.Unknown:b.getPmiSubType()};c.prototype.getUnit=
function(b){b=this._assemblyTree.lookupAnyNode(b);return b instanceof g.ProductOccurrence?b.getMeasurementUnit():b instanceof g.BodyInstance?b.getParent().getMeasurementUnit():1};c.prototype._rectifyParent=function(b,c){if(null!==c){c=this._assemblyTree.lookupProductOccurrence(c);if(null!==c)return c;console.assert(!1)}b=this._assemblyTree.getInclusionContexts(b);return 0<b.length?(b=b[0].getChildren(),console.assert(0<b.length),b[0]):this._assemblyTree.getRootNode()};c.prototype.createMeshInstance=
function(b,c,a,d,e,g,h){d=this._rectifyParent(b,d);return this._assemblyTree.createMeshInstance(!0,b,c,null,a,d,e,g,!0,h).getRuntimeId()};c.prototype.createPmiInstance=function(b,c,a,d,e,g,h){h=this._rectifyParent(b,h);return this._assemblyTree.createPmiInstance(b,c,null,g,h,a,d,e).getRuntimeId()};c.prototype.setVisibilitiesByMap=function(b,c){var a=this,d=new Map;b.forEach(function(b,c){c=a._assemblyTree.lookupAnyTreeNode(c);null!==c&&d.set(c,b)});b=null;var f=this.getActiveCadConfiguration();null!==
f&&(b=this._assemblyTree.lookupProductOccurrence(f));f=this._assemblyTree.getRootNode();return g.updateVisibilities({assemblyTree:this._assemblyTree,engine:this._engine,startNode:f,visibilityFormatter:function(b){return d.get(b)},resetNonAffectedToDefault:!1,configurationNode:null!==b?b:void 0,callbackManager:this._callbackManager,initiallyHiddenStayHidden:c})};c.prototype.setBodyNodesVisibility=function(b,c){return g.updateBodyNodesVisibilities({assemblyTree:this._assemblyTree,engine:this._engine,
startNode:b,visibilityFormatter:"boolean"===typeof c?function(b){return c}:c,resetNonAffectedToDefault:!1,callbackManager:this._callbackManager,initiallyHiddenStayHidden:!1})};c.prototype.setVisibilitiesByValue=function(b,c,a){for(var d=new Map,f=0;f<b.length;f++)d.set(b[f],c);return this.setVisibilitiesByMap(d,null!==a?a:void 0)};c.prototype.resetAllVisibilities=function(){var b=this._assemblyTree.getRootNode(),c=this._assemblyTree.getActiveCadConfiguration();return g.updateVisibilities({assemblyTree:this._assemblyTree,
engine:this._engine,startNode:b,visibilityFormatter:function(){},resetNonAffectedToDefault:!0,configurationNode:null!==c?c:void 0,callbackManager:this._callbackManager})};c.prototype.resetAllTransforms=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return b=this._assemblyTree.getRootNode(),[4,g.resetTransforms(b)];case 1:return(c=a.sent())?[2,g.updateScMatrices(this._engine,this._callbackManager,[b],!1)]:[2]}})})};c.prototype.reset=
function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this._cadConfigurationsEnabled=!0,this.isACadDrawing()?[2,this._callbackManager.promiseTrigger("_resetDrawing",null)]:this._assemblyTree.hasActiveCadView()?[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:c.sent(),c.label=2;case 2:return b=[this.resetAllVisibilities(),this.resetAllTransforms()],[4,d.Util.waitForAll(b)];case 3:return c.sent(),[2]}})})};c.prototype.setPmiColor=
function(b,c){void 0===c&&(c=this.getAbsoluteRootNodeId());c=this.getInstanceIncs(c,6);0<c.length&&(this._engine.setPartColor(c,d.ElementType.Faces,b),this._engine.setPartColor(c,d.ElementType.Lines,b))};c.prototype.resetPmiColor=function(b){void 0===b&&(b=this.getAbsoluteRootNodeId());b=this.getInstanceIncs(b,6);0<b.length&&(this._engine.unsetPartColor(b,d.ElementType.Faces),this._engine.unsetPartColor(b,d.ElementType.Lines))};c.prototype.getPmiTopologyReferences=function(b){b=this._assemblyTree.lookupPmi(b);
return null===b?null:b.getPmiTopologyReferences(this._assemblyTree)};c.prototype.createNode=function(b,c,a,e,n,h){void 0===e&&(e=null);void 0===n&&(n=!0);void 0===h&&(h=null);var f=null;null!==b&&(f=this._assemblyTree.lookupProductOccurrence(b));null===f&&(f=this._assemblyTree.getRootNode());null===a||g.isAuthoredId(a)||(a=null);h&&(b=h/f.getMeasurementUnit(),b=(new d.Matrix).setScaleComponent(b,b,b),e=e?d.Matrix.multiply(e,b):b);return this._assemblyTree.createNode(f,c,a,null===e?null:e.m,n,h).getRuntimeId()};
c.prototype.deleteNode=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=this._assemblyTree.lookupAnyTreeNode(b);if(null!==c){if(c instanceof g.ProductOccurrence||c instanceof g.BodyInstance||c instanceof g.Pmi)return[2,this._assemblyTree.deleteNode(c)];throw new d.InvalidNodeTypeError(b,0,2);}return[2]})})};c.prototype.createPart=function(b){return this._assemblyTree.createPart(b).getRuntimeId()};c.prototype.setPart=function(b,c){b=this._assemblyTree.lookupProductOccurrence(b);
if(null===b)return!1;c=this._assemblyTree.lookupPartDefinition(c);if(null===c)return!1;this._assemblyTree.setPart(b,c);return!0};c.prototype.createAndAddRepItem=function(b,c){b=this._assemblyTree.lookupPartDefinition(b);return null===b?null:b.createRepItem(this._assemblyTree,c).getRuntimeId()};c.prototype.getLowestAvailableNodeId=function(){return this._assemblyTree.getLowestAvailableNodeId()};c.prototype.getType=function(b){b=this._assemblyTree.lookupAnyNode(b);return null===b?d.NodeType.Unknown:
g.getNodeType(b)};c.prototype.isVisible=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?b.isVisible():!1};c.prototype.getBranchVisibility=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?g.getBranchVisibility(b):1};c.prototype.setMeshLevel=function(b,c){for(var a=[],d=0;d<b.length;d++){var f=this._assemblyTree.lookupAnyTreeNode(b[d]);null!==f&&a.push(f)}return g.setMeshLevels(this._engine,a,c)};c.prototype.setEnableAutomaticUnitScaling=function(b){this._assemblyTree.setAutomaticMeasurementUnitScaling(b)};
c.prototype.setBehaviorInitiallyHidden=function(b){this._assemblyTree.setInitiallyHiddenStayHidden(b)};c.prototype.isACadDrawing=function(){return this._assemblyTree.containsDrawings()};c.prototype.isMeasurable=function(){return this._assemblyTree.isMeasurable()};c.prototype.isLineMeasurable=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:a=f.sent();if(!(a instanceof g.RepresentationItem))return[2,
!1];d=a.getEdgeMeasurementProperty(c);return[2,null!==d]}})})};c.prototype.isFaceMeasurable=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:a=f.sent();if(!(a instanceof g.RepresentationItem))return[2,!1];d=a.getFaceMeasurementProperty(c);return[2,null!==d]}})})};c.prototype.getModelFileNameFromNode=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?g.towardAttachContext(b).getOriginalFileName():
null};c.prototype.getModelFileTypeFromNode=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?g.towardAttachContext(b).getOriginalFileType():null};c.prototype.isAnnotationView=function(b){var c=this._assemblyTree.lookupCadView(b);if(null!==c)return c.isAnnotationView();throw new d.InvalidNodeTypeError(b,3);};c.prototype.isCombineStateView=function(b){var c=this._assemblyTree.lookupCadView(b);if(c)return c.isCombineStateView();throw new d.InvalidNodeTypeError(b,3);};c.prototype.allowNodeDeletion=
function(b){b=this._assemblyTree.lookupBodyInstance(b);if(null===b)throw new d.InternalLogicError;this._assemblyTree.allowNodeDeletion(b)};c.prototype.preventNodeDeletion=function(b){b=this._assemblyTree.lookupBodyInstance(b);if(null===b)throw new d.InternalLogicError;this._assemblyTree.preventNodeDeletion(b)};c.prototype.preventMeshDeletion=function(b){this._assemblyTree.preventMeshDeletion(b)};c.prototype.getBounding=function(b,c,a,d){return g.getBoundingByNodeId(this._assemblyTree,this._engine,
b,c,a,d)};c.prototype.getIdOffset=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?(b instanceof g.PartDefinition?b.getInclusionContextForNodeId():b instanceof g.RepresentationItem?b.getParent().getInclusionContextForNodeId():g.towardInclusionContext(b)).getIdOffset():0};c.prototype.isNodeLoaded=function(b){var c=this._assemblyTree.lookupAnyNode(b);if(null===c)throw new d.InvalidNodeIdError(b);return c.isLoaded()};c.prototype.shutdown=function(){if(this._treeLoader){var b=this._treeLoader.cancelPendingLoads();
b}};c.prototype.isReady=function(){console.assert(2!==this._readyPromise.state);return 0!==this._readyPromise.state};c.prototype.waitForReady=function(){return this._readyPromise};c.prototype.lookupAnyTreeNode=function(b){return this._assemblyTree.lookupAnyTreeNode(b)};c.prototype.lookupAnyBody=function(b){return this._assemblyTree.lookupAnyBody(b)};c.prototype.lookupBodyInstance=function(b){return this._assemblyTree.lookupBodyInstance(b)};c.prototype.gatherInstanceIncsFromNodeIds=function(b,c,a){return g.gatherInstanceIncsByNodeIdsSync(this._assemblyTree,
b,c,a)};c.prototype.gatherInclusionKeysFromNodeIds=function(b){return g.gatherInclusionKeysFromNodeIdsSync(this._assemblyTree,b,g.WalkRestriction.None)};c.prototype.requestNodes=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e,g;return __generator(this,function(f){c=[];a=0;for(d=b;a<d.length;a++)e=d[a],g=this._assemblyTree.lookupAnyTreeNode(e),null!==g&&c.push(g);return[2,this._assemblyTree.requestNodes(this._treeLoader,c,!1)]})})};c.prototype.isWithinExternalModel=function(b){b=
this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return!1;for(b=g.towardProductOccurrence(b);null!==b;){if(b.isExternalModelRoot())return!0;b=g.towardProductOccurrence(b.getParent())}return!1};c.prototype.getNodeGenericType=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?g.getNodeGenericType(b):null};c.prototype.getNodeGenericId=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?b.getGenericId():null};c.prototype.getNodesByGenericId=function(b){b=this._assemblyTree.getNodesByGenericId(b);
if(null!==b){var c=new Set;b.forEach(function(b){c.add(b.getRuntimeId())});return c}return null};c.prototype.getNodesByGenericType=function(b){b=this._assemblyTree.getNodesByGenericType(b);if(null!==b){var c=new Set;b.forEach(function(b){c.add(b.getRuntimeId())});return c}return null};c.prototype.getGenericTypes=function(){var b=[];this._assemblyTree.genericTypeToNodes().forEach(function(c,a){b.push(a)});return b};c.prototype.getGenericTypeIdMap=function(){var b=new Map;this._assemblyTree.genericTypeToNodes().forEach(function(c,
a){var d=new Set;c.forEach(function(b){d.add(b.getRuntimeId())});b.set(a,d)});return b};c.prototype.hasEffectiveGenericType=function(b,c){var a=this.lookupAnyTreeNode(b);if(null===a)throw new d.InvalidNodeIdError(b);return g.hasEffectiveGenericType(a,c)};c.prototype.registerGenericId=function(b,c){return this._assemblyTree.registerGenericGlobalId(b,c)};c.prototype.registerGenericType=function(b,c){return this._assemblyTree.registerGenericType(b,c)};c.prototype.hasRelationships=function(b){var c=this.lookupAnyTreeNode(b);
if(null===c)throw new d.InvalidNodeIdError(b);return 0<g.towardInclusionContext(c).getRelationships().length};c.prototype.getBimIdFromNode=function(b){b=this.lookupAnyTreeNode(b);return null!==b&&b.hasAuthoredId()?b.getAuthoredId().toString():null};c.prototype.getRuntimeNodeFromBimId=function(b,c){b=this.lookupAnyTreeNode(b);return null===b?null:g.towardInclusionContext(b).getRuntimeNodeFromBimId(c)};c.prototype.getRelationsByTypeFromNode=function(b,c){return this._assemblyTree.getRelationshipsOfItem(b,
c)};c.prototype.firstAssemblyDataHeader=function(){return this._treeLoader.firstAssemblyDataHeader()};c.prototype.setPrefetchScsCutoffScale=function(b){this._treeLoader.setPrefetchScsCutoffScale(b)};c.prototype.getAllRelationships=function(b){b=this.lookupAnyTreeNode(b);return null===b?[]:g.towardInclusionContext(b).getRelationships()};c.prototype.getAllBimInfos=function(b){b=this.lookupAnyTreeNode(b);return null===b?[]:g.towardInclusionContext(b).getBimInfos()};c.prototype.getInfoOfBimId=function(b,
c){for(var a=0,d=this.getAllBimInfos(b);a<d.length;a++){var f=d[a];if(f.id===c)return a=f.name,d=!1,f.category===g.BimStatus.Connected&&(b=this.getRuntimeNodeFromBimId(b,c),null!==b&&null!==this.getName(b)&&(a=this.getName(b),d=!0)),{name:a,connected:d}}return{name:"",connected:!1}};c.prototype.indexOfBimInfo=function(b,c){for(var a=0,d=0;d<b.length;d++){if(c===b[d].type)return a;a++}return-1};c.prototype.getBimIdRelationshipTypes=function(b,c){var a=[],d=this.lookupAnyTreeNode(b);if(null===d)return[];
b=0;for(d=g.towardInclusionContext(d).getRelationships();b<d.length;b++){var f=d[b];if(null!==f.relating&&f.relating.relationElt.id===c){var e=this.indexOfBimInfo(a,f.type);if(0>e){e=[];if(null!==f.related)for(var h=0,q=f.related.relationships;h<q.length;h++){var r=q[h];e.push(r.id)}a.push({type:f.type,relateds:e,relatings:[]})}else if(null!==f.related)for(h=0,f=f.related.relationships;h<f.length;h++)r=f[h],0>a[e].relateds.indexOf(r.id)&&a[e].relateds.push(r.id)}else if(null!==f.related)for(h=0,q=
f.related.relationships;h<q.length;h++)r=q[h],r.id===c&&(e=this.indexOfBimInfo(a,f.type),null!==f.relating&&(0>e?a.push({type:f.type,relateds:[],relatings:[f.relating.relationElt.id]}):a[e].relatings.push(f.relating.relationElt.id)))}return a};return c}();g.ModelStructure=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(a){for(;;)if(a instanceof g.InclusionContext)a=a.getParent();else{if(a instanceof g.AttachContext)return a;if(a instanceof g.NodeMixin)a=a.getParent();else if(a instanceof g.LoadContext){if(a=a.getParent(),null===a)throw new d.InternalLogicError;}else d.Util.TypeAssert(a),a=a.getInclusionContext()}}g.getNetMatrix=function(a){for(var c=g.Transform.getIdentity();null!==a;)if(a instanceof g.NodeMixin){var b=a.getLocalTransform();b&&(c=g.Transform.multiply(c,
b));a=a instanceof g.PartDefinition?null:a.getParent()}else if(a instanceof g.InclusionContext)a=a.getParent();else if(a instanceof g.AttachContext)a=a.getParent();else if(a instanceof g.LoadContext)a=a.getParent();else{d.Util.TypeAssert(a);break}return c};g.towardContainerNode=function(a){for(;;)if(a instanceof g.NodeMixin)if(a instanceof g.BodyMixin)a=a.getParent();else return a;else if(a instanceof g.LoadContext)a=a.getParent();else if(a instanceof g.InclusionContext)a=a.getParent();else if(a instanceof
g.AttachContext)a=a.getParent();else{if(null===a)return null;d.Util.TypeAssert(a);console.assert(!1);a=a.getInclusionContext()}};g.isOutOfHierarchy=function(a){return a instanceof g.BodyMixin||a instanceof g.ProductOccurrence?a.isOutOfHierarchy():!1};g.getBranchVisibility=function(a){return a instanceof g.ProductOccurrence||a instanceof g.Pmi||a instanceof g.CadView?a.getBranchVisibility():a.isVisible()?2:1};g.getNodeType=function(a){if(a instanceof g.ProductOccurrence)return a.isADrawingSheetNode()?
d.NodeType.DrawingSheet:a.hasBodyInstances()?d.NodeType.PartInstance:d.NodeType.AssemblyNode;if(a instanceof g.PartDefinition)return d.NodeType.Part;if(a instanceof g.PmiBody)return d.NodeType.PmiBody;if(a instanceof g.ViewFrame)return d.NodeType.ViewFrame;if(a instanceof g.BodyInstance)return d.NodeType.BodyInstance;if(a instanceof g.RepresentationItem)switch(a.getBodyType()){case g.BodyType.BRep:return d.NodeType.BrepBody;case g.BodyType.Tessellation:return d.NodeType.TessBody;case g.BodyType.Wireframe:return d.NodeType.WireBody;
case g.BodyType.PointCloud:return d.NodeType.PointsBody;default:return d.NodeType.Body}else{if(a instanceof g.Pmi)return d.NodeType.Pmi;d.Util.TypeAssert(a);return d.NodeType.CadView}};g.getNodeGenericType=function(d){var c=d.getGenericTypeId();return null!==c&&(d=a(d).getGenericTypeMaps(),null!==d)?d.getRight(c)||null:null};g.towardInclusionContext=function(a){for(;;)if(a instanceof g.NodeMixin)a=a.getParent();else{if(a instanceof g.InclusionContext)return a;if(a instanceof g.PmiBody)a=a.getParent();
else if(a instanceof g.ViewFrame)a=a.getParent();else return d.Util.TypeAssert(a),a.getInclusionContext()}};g.towardLoadContext=function(a){for(;;)if(a instanceof g.AttachContext)a=a.getParent();else{if(a instanceof g.LoadContext)return a;a instanceof g.NodeMixin?a=a.getParent():a instanceof g.InclusionContext?a=a.getParent():(d.Util.TypeAssert(a),a=a.getInclusionContext())}};g.towardAttachContext=a;g.towardAttachRoot=function(a){for(var c=null;;)if(a instanceof g.ProductOccurrence)c=a,a=a.getParent();
else if(a instanceof g.NodeMixin)a=a.getParent();else{if(a instanceof g.InclusionContext){if(null===c)throw new d.InternalLogicError;return c}d.Util.TypeAssert(a);a=a.getInclusionContext()}};g.towardProductOccurrence=function(a){for(;;){if(a instanceof g.ProductOccurrence)return a;if(a instanceof g.AttachContext)a=a.getParent();else if(a instanceof g.InclusionContext)a=a.getParent();else if(a instanceof g.LoadContext){if(a=a.getParent(),null===a)return null}else if(a instanceof g.BodyMixin)a=a.getParent();
else if(a instanceof g.Pmi)a=a.getParent();else if(a instanceof g.CadView)a=a.getParent();else return d.Util.TypeAssert(a),console.assert(!1),null}}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){})(g.GenericTypeId||(g.GenericTypeId={}));var a=function(){function a(c,b,a,e,g){this._inclusionContexts=this._reservedNodeIdOffset=null;this._originalFileName="";this._originalFileType=d.FileType.Unknown;this._genericTypeMaps=null;console.assert(4294967295!==e);this._remapper=c;this._attachScope=b;this._attachedInvisibly=a;this._masterModelKey=e;this._parent=g}a.prototype.getRootNodeMetaData=function(c){return __awaiter(this,void 0,void 0,function(){var b,
a,d,e,n,h;return __generator(this,function(f){switch(f.label){case 0:if(4294967295===this._masterModelKey)return[2,null];b=c.getAbstractScEngine();a=this._masterModelKey;return[4,b.safeGetMetaData(a,1)];case 1:d=f.sent();if(null===d)return[3,4];e=c.tryParseHeader(d);return null===e?[2,new g.AssemblyData(null,d)]:[4,e];case 2:return n=f.sent(),this._originalFileName=n.originalFileName,this._originalFileType=n.originalFileType,[4,b.safeGetMetaData(a,n.rootAssemblyDataKey())];case 3:return h=f.sent(),
null!==h?[2,new g.AssemblyData(n,h)]:[2,null];case 4:return[2,null]}})})};a.prototype.getAttachScope=function(){return this._attachScope};a.prototype.attachedInvisibly=function(){return this._attachedInvisibly};a.prototype.getMasterModelKey=function(){return this._masterModelKey};a.prototype.addInclusionContext=function(c){console.assert(c.getParent()===this);this._inclusionContexts=h.TerseArray.push(this._inclusionContexts,c)};a.prototype.getRemapper=function(){return this._remapper};a.prototype.getParent=
function(){return this._parent};a.prototype.getChildren=function(){var c=this._inclusionContexts;if(null===c)return[];if(Array.isArray(c)){console.assert(0<c.length);for(var b=c[0].getChildren(),a=1;a<c.length;++a)h.append(b,c[a].getChildren());return b}return c.getChildren()};a.prototype.getInclusionContexts=function(){return h.TerseArray.toArray(this._inclusionContexts)};a.prototype.split=function(c,b,d){return new a(this._remapper,c,b,this._masterModelKey,d)};a.prototype.hasChildren=function(){return null!==
this._inclusionContexts};a.prototype.removeProductOccurrence=function(c){for(var b=null,a=h.TerseArray.toArray(this._inclusionContexts),d=0,e=a;d<e.length;d++){var g=e[d];if(g.removeProductOccurrence(c)){b=g;break}}if(null===b)return!1;a=a.filter(function(b){return b.hasChildren()});this._inclusionContexts=0===a.length?null:h.TerseArray.fromArray(a);return!0};a.prototype.purgeContents=function(){for(var c=[],b=0,a=h.TerseArray.toArray(this._inclusionContexts);b<a.length;b++){var e=a[b].purgeContents();
c.push(e)}this._inclusionContexts=null;return d.Util.waitForAll(c)};a.prototype.isLoaded=function(){if(this._inclusionContexts instanceof g.InclusionContext)return this._inclusionContexts.isLoaded();if(null!==this._inclusionContexts)for(var c=0,b=this._inclusionContexts;c<b.length;c++)if(!b[c].isLoaded())return!1;return!0};a.prototype.setReservedNodeIdOffset=function(c){console.assert(null===this._reservedNodeIdOffset);this._reservedNodeIdOffset=c};a.prototype.getReservedNodeIdOffset=function(){return this._reservedNodeIdOffset};
a.prototype.forgetReservedNodeIdOffset=function(){console.assert(null!==this._reservedNodeIdOffset);this._reservedNodeIdOffset=null};a.prototype.getOriginalFileName=function(){return this._originalFileName};a.prototype.getOriginalFileType=function(){return this._originalFileType};a.prototype.setGenericTypeMaps=function(c){this._genericTypeMaps=c};a.prototype.getGenericTypeMaps=function(){return this._genericTypeMaps};return a}();g.AttachContext=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a,d){this._productOccurrences=null;this._relationship=[];this._bimNodeIdMap=new Map;this._bimInfos=[];console.assert(void 0!==a);console.assert(0===a===(0===d));this._attachContext=b;this._inclusionKey=a;this._modelKey=d;a=b.getReservedNodeIdOffset();null!==a?b.forgetReservedNodeIdOffset():a=c.newNodeIdOffset();this._nodeIdOffset=a;c.registerInclusionContext(this)}a.prototype.split=function(c,b){return new a(c,b,this._inclusionKey,
this._modelKey)};a.prototype.getIdOffset=function(){return this._nodeIdOffset};a.prototype.toRuntimeId=function(c){console.assert(g.isAuthoredId(c));return c+this._nodeIdOffset};a.prototype.getInclusionKey=function(){return this._inclusionKey};a.prototype.getModelKey=function(){return this._modelKey};a.prototype.getParent=function(){return this._attachContext};a.prototype.getAttachContext=function(){return this._attachContext};a.prototype.addProductOccurrence=function(c){console.assert(c.getParent()===
this);this._productOccurrences=h.TerseArray.push(this._productOccurrences,c)};a.prototype.getChildren=function(){console.assert(null!==this._productOccurrences);return h.TerseArray.toArray(this._productOccurrences)};a.prototype.removeProductOccurrence=function(c){var b=h.TerseArray.toArray(this._productOccurrences),a=b.length;b=b.filter(function(b){return b!==c});0===b.length?delete this._productOccurrences:this._productOccurrences=h.TerseArray.fromArray(b);return b.length<a};a.prototype.purgeContents=
function(){for(var c=[],b=0,a=h.TerseArray.toArray(this._productOccurrences);b<a.length;b++){var e=a[b].purgeContents();c.push(e)}this._productOccurrences=null;this._relationship.length=0;return d.Util.waitForAll(c)};a.prototype.hasChildren=function(){return null!==this._productOccurrences};a.prototype.isLoaded=function(){if(this._productOccurrences instanceof g.ProductOccurrence)return this._productOccurrences.isLoaded();if(null!==this._productOccurrences)for(var c=0,b=this._productOccurrences;c<
b.length;c++)if(!b[c].isLoaded())return!1;return!0};a.prototype.addRelationship=function(c){this._relationship.push(c)};a.prototype.getRelationships=function(){return this._relationship};a.prototype.addBimInfos=function(c){this._bimInfos.push(c)};a.prototype.getBimInfos=function(){return this._bimInfos};a.prototype.addBimIdToMap=function(c,b){this._bimNodeIdMap.set(c,b)};a.prototype.getRuntimeNodeFromBimId=function(c){c=this._bimNodeIdMap.get(c);return void 0!==c?c:null};return a}();g.InclusionContext=
a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a){this._attachContexts=this._handledExternalModels=null;this._registeredScsModelKeys=new Map;this._layerIdMap=new h.Bimap;this._parent=c;this._debugLoadString=b;this._debugLoadString;this._scsBufferCache=a}a.prototype.handleExternalModel=function(c,b,a){b=b.getInclusionKey();c=h.compressUint(a)+" "+h.compressUint(b)+" "+h.compressUint(c);null===this._handledExternalModels&&(this._handledExternalModels=new Set);if(this._handledExternalModels.has(c))return!1;
this._handledExternalModels.add(c);return!0};a.prototype.getParent=function(){return this._parent};a.prototype.addAttachContext=function(c){this._attachContexts=h.TerseArray.push(this._attachContexts,c)};a.prototype.getChildren=function(){var c=this._attachContexts;if(null===c)return[];if(Array.isArray(c)){console.assert(0<c.length);for(var b=c[0].getChildren(),a=1;a<c.length;++a)h.append(b,c[a].getChildren());return b}return c.getChildren()};a.prototype.getAttachContexts=function(){return null===
this._attachContexts?[]:Array.isArray(this._attachContexts)?this._attachContexts:[this._attachContexts]};a.prototype.hasChildren=function(){return null!==this._attachContexts};a.prototype.removeProductOccurrence=function(c){for(var b=null,a=h.TerseArray.toArray(this._attachContexts),d=0,e=a;d<e.length;d++){var g=e[d];if(g.removeProductOccurrence(c)){b=g;break}}if(null===b)return!1;a=a.filter(function(b){return b.hasChildren()});this._attachContexts=0===a.length?null:h.TerseArray.fromArray(a);return!0};
a.prototype.purgeContents=function(){for(var c=[],b=0,a=h.TerseArray.toArray(this._attachContexts);b<a.length;b++){var e=a[b].purgeContents();c.push(e)}this._attachContexts=null;return d.Util.waitForAll(c)};a.prototype.isLoaded=function(){if(this._attachContexts instanceof g.AttachContext)return this._attachContexts.isLoaded();if(null!==this._attachContexts)for(var c=0,b=this._attachContexts;c<b.length;c++)if(!b[c].isLoaded())return!1;return!0};a.prototype.initializeScsModelKeysOf=function(c){console.assert(void 0===
this._registeredScsModelKeys.get(c));this._registeredScsModelKeys.set(c,h.TrackedOpenPromise.create())};a.prototype.getScsModelKeysOf=function(c){c=this._registeredScsModelKeys.get(c);return void 0===c?null:c};a.prototype.markAsFirstLoad=function(){console.assert(void 0===this._isFirstLoad);this._isFirstLoad=!0};a.prototype.isFirstLoad=function(){return!0===this._isFirstLoad};a.prototype.toScsBuffer=function(c,b){return __awaiter(this,void 0,void 0,function(){var a,e=this;return __generator(this,
function(f){a=h.LazyPromise.create(function(){return __awaiter(e,void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:return[4,b(c)];case 1:f=a=f.sent();if("string"===typeof f)throw new d.InternalLogicError;return[2,f]}})})});return null===this._scsBufferCache?[2,a]:[2,this._scsBufferCache.load(c,a)]})})};a.prototype.onLoadComplete=function(){this._scsBufferCache=null};a.prototype.addLayerIdToMap=function(c,b){this._layerIdMap.set(c,b)};a.prototype.getAuthoredLayerId=
function(c){c=this._layerIdMap.getRight(c);return void 0!==c?c:null};a.prototype.getRuntimeLayerId=function(c){c=this._layerIdMap.getLeft(c);return void 0!==c?c:null};return a}();g.LoadContext=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(){function c(b){this._referrers=null;this._prototype=b}c.prototype._addReferrer=function(b){this._referrers=d.TerseArray.push(this._referrers,b)};c.prototype._getReferrers=function(){return d.TerseArray.toArray(this._referrers)};c.prototype._getPrototype=function(){return this._prototype};c.prototype._removeReferrer=function(b){var c=!1,a=d.TerseArray.toArray(this._referrers);a=a.filter(function(a){return a===b?(c=!0,!1):!0});if(!c)return!1;0===
a.length?delete this._referrers:this._referrers=d.TerseArray.fromArray(a);return!0};c.prototype._purgeContents=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this._prototype.isUnforced()?[3,3]:[4,this._prototype];case 1:return b=c.sent(),[4,b.purgeContents()];case 2:c.sent(),c.label=3;case 3:return[2]}})})};c.prototype._isLoaded=function(){return this._prototype.isResolved()&&this._prototype.getResolved().isLoaded()};
return c}();g.SharedPrototypeContext=a;var e=function(){function c(b,c){b instanceof a&&(b=d.LazyObject.create(b));this._shared=b;this._inclusionContext=c}c.prototype.getInclusionContext=function(){return this._inclusionContext};c.prototype.addReferrer=function(b){this._shared.get()._addReferrer(b)};c.prototype.getReferrers=function(){return this._shared.get()._getReferrers()};c.prototype.getProductOccurrence=function(){return this._shared.get()._getPrototype()};c.prototype.removeReferrer=function(b){return this._shared.get()._removeReferrer(b)?
(b=b.removePrototype(),console.assert(this===b),!0):!1};c.prototype.removeAllReferrers=function(){for(var b=0,c=this.getReferrers();b<c.length;b++)this.removeReferrer(c[b])||console.assert(!1)};c.prototype.purgeContents=function(){return this._shared.get()._purgeContents()};c.prototype.isLoaded=function(){return this._shared.get()._isLoaded()};return c}();g.PrototypeContext=e})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function b(){this._bits2=this._bits1=0}b.prototype.hasBits1=function(b){return h.hasBits(this._bits1,b)};b.prototype.hasBits2=function(b){return h.hasBits(this._bits2,b)};b.prototype.parseBits1=function(b){this._bits1=b.parseIndex_32()};b.prototype.parseBits2=function(b){this.hasBits1(1073741824)&&(this._bits2=b.parseIndex_32())};return b}();g.NodeParseBits=a;var e=function(){return function(b,c){this.shown=b;this.removed=c}}();g.AssemblyVisibility=
e;var c=function(){function b(b){this._bytes=b.bytes;this._header=b.header;this._dataView=new DataView(this._bytes.buffer,this._bytes.byteOffset,this._bytes.byteLength);this._currentPos=0}b.prototype.hasNext=function(){return this._currentPos<this._bytes.length};b.prototype.parseCount_32=function(){return this._parseUint_32()};b.prototype.parseIndex_32=function(){return this._parseUint_32()};b.prototype.parseAssemblyDataVersion=function(b){for(var c=[],a=0;a<b;++a)c.push(this._parseUint_32());return c};
b.prototype.parseAssemblyDataHeaderVersion=function(){return this._parseUint_32()};b.prototype.parseVisibility=function(){var b=this._parseInt_8(),c=h.hasBits(b,2);b=h.hasBits(b,1);return new e(c,b)};b.prototype.parseProductBits=function(){var b=this._parseUint_8();return null!==this._header&&2<=this._header.headerVersion||!h.hasBits(b,6)?b:b&-7|32};b.prototype.parseUnits=function(){for(var b=this.parseInt32(),c=[],a=0;a<b;a++){var d=this.parseUInt32(),e=this.parseInt32(),g=this.parseFloat_64();c.push({basicUnit:d,
exponent:e,factor:g})}return c};b.prototype.parseCString=function(){for(var b=this._currentPos,c=this._bytes[this._currentPos++];0!==c;)c=this._bytes[this._currentPos++];return h.utf8ArrayToStr(this._bytes.subarray(b,this._currentPos-1))};b.prototype.parseUInt32=function(){return this._parseUint_32()};b.prototype.parseInt32=function(){return this._parseInt_32()};b.prototype.parseBytes=function(b){var c=this._currentPos;this._currentPos+=b;b=this._bytes.subarray(c,this._currentPos);return new Uint8Array(b)};
b.prototype.parseNodeId=function(){var b=this._parseUint_32();console.assert(b!==g.invalidNodeId);return b};b.prototype.parseLayerId=function(){var b=this._parseUint_32();console.assert(b!==g.invalidNodeId);return b};b.prototype.parseGenericTypes=function(){for(var b=this._parseUint_32(),c=new h.Bimap,a=0;a<b;a++){var d=this.parseCString(),e=this._parseUint_32();c.set(e,d)}return c};b.prototype.parseGenericTypeId=function(){return this._parseUint_32()};b.prototype.parseGenericId=function(){return this.parseCString()};
b.prototype._parseScKey=function(){var b=this._parseUint_32();console.assert(4294967295!==b);return b};b.prototype.parseDataKey=function(){return this._parseScKey()};b.prototype.parseInstanceKey=function(){return this._parseScKey()};b.prototype.parseMeshKey=function(){return this._parseScKey()};b.prototype.parseModelKey=function(b){var c=this._parseScKey();return null!==b?b.getEffectiveModelKey(c):c};b.prototype.parseInclusionKey=function(b,c){var a=this._parseScKey();return null!==b?b.getEffectiveInclusionKey(a,
c):a};b.prototype.parseMatrix=function(){for(var b=this,c=null!==this._header&&this._header.doublePrecisionMatrices?function(){return b.parseFloat_64()}:function(){return b.parseFloat_32()},a=g.Transform.getIdentity(),d=0;4>d;++d)for(var e=0;3>e;++e)a[4*d+e]=c();return a};b.prototype._parseInt_8=function(){return this._dataView.getInt8(this._currentPos++)};b.prototype._parseUint_8=function(){return this._dataView.getUint8(this._currentPos++)};b.prototype._parseUint_32=function(){var b=this._dataView.getUint32(this._currentPos,
!0);this._currentPos+=4;return b};b.prototype._parseInt_32=function(){var b=this._dataView.getInt32(this._currentPos,!0);this._currentPos+=4;return b};b.prototype._parseFloat_32=function(){var b=this._dataView.getFloat32(this._currentPos,!0);this._currentPos+=4;return b};b.prototype._parseFloat_64=function(){var b=this._dataView.getFloat64(this._currentPos,!0);this._currentPos+=8;return b};b.prototype.parseFloat_32=function(){return this._parseFloat_32()};b.prototype.parseFloat_64=function(){return this._parseFloat_64()};
b.prototype.parseAttributeType=function(){return this._parseInt_8()};b.prototype.parseNodeParseBits=function(){var b=new a;b.parseBits1(this);b.parseBits2(this);return b};b.prototype.parseViewParseBits=function(){return this._parseUint_32()};b.prototype.parsePmiParseBits=function(){return this._parseUint_32()};b.prototype.parseLayerParseBits=function(){return this._parseUint_32()};b.prototype.parseAttributeParseBits=function(){return this._parseUint_32()};b.prototype.parseRelationshipParseBits=function(){return this._parseUint_32()};
b.prototype.parseBoolean=function(){return 0!==this._parseUint_8()};b.prototype.parsePoint3_32=function(){return new d.Point3(this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32())};b.prototype.parsePoint3_64=function(){return new d.Point3(this._parseFloat_64(),this._parseFloat_64(),this._parseFloat_64())};b.prototype.parsePlane3_32=function(){return d.Plane.createFromCoefficients(this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32())};b.prototype.parsePmiType=
function(){return this._parseUint_32()};b.prototype.parsePmiSubType=function(){return this._parseUint_32()};b.prototype.parsePmiTopoRef=function(){return this._parseInt_8()};b.prototype.parseBodyType=function(){return this._parseUint_8()};b.prototype.parseFaceType=function(){return this._parseInt_8()};b.prototype.parseEdgeType=function(){return this._parseInt_8()};b.prototype.parseUserDataIndex=function(){var b=this._parseUint_32(),c=this._parseUint_32();return 2097151>=c?4294967296*c+b:(""+c.toString(16)+
h.zeroPadHex32(b)).toUpperCase()};b.prototype.getHeader=function(){return this._header};return b}();g.AssemblyDataParser=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b){this._inclusionsOf=new Map;this._masterModelKey=4294967295;this._prototypeInstanceCount=-1;this._attachScope=c;this._attachedInvisibly=b}a.prototype.getAttachScope=function(){return this._attachScope};a.prototype.getMasterModelKey=function(){console.assert(4294967295!==this._masterModelKey);return this._masterModelKey};a.prototype.getModelKeys=function(){var c=[];this._inclusionsOf.forEach(function(b,a){c.push(a)});return c};
a.prototype.hasInclusions=function(){return 0<this._inclusionsOf.size};a.prototype.getAllInclusions=function(){var c=[];this._inclusionsOf.forEach(function(b,a){for(var d=0;d<b.length;d++)c.push(b[d],a)});return c};a.prototype.getInclusionsOf=function(c){var b=this._inclusionsOf.get(c);if(void 0===b)return[];for(var a=[],d=0;d<b.length;d++)a.push(b[d],c);return a};a.prototype.hasModelIncluded=function(c){return this._inclusionsOf.has(c)};a.prototype.attachedInvisibly=function(){return this._attachedInvisibly};
a.prototype.prototypeInstanceCount=function(){console.assert(0<=this._prototypeInstanceCount);return this._prototypeInstanceCount};a.prototype.registerInclusion=function(c,b){var a=this._inclusionsOf.get(b);void 0===a?this._inclusionsOf.set(b,[c]):a.push(c)};a.prototype.registerMasterModelKey=function(c){console.assert(4294967295===this._masterModelKey);this._masterModelKey=c};a.prototype.registerPrototypeInstanceCount=function(c){console.assert(-1===this._prototypeInstanceCount);this._prototypeInstanceCount=
c};return a}();d.AttachInfoBuilder=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(){this._calculatedCutoff=0;this._requireBoundingInfo=!1;this._prevPriorityValue=1;this._priorityProxies=new Map}a.prototype.getPriorityCompareValue=function(c){if("number"===typeof c)return c;c=this._priorityProxies.get(c);null!==c.worldBounding&&console.assert(1>=c.priorityHeuristic);return c.priorityHeuristic};a.prototype.setRequireBoundingInfo=function(c){this._requireBoundingInfo=c};a.prototype.comparePriority=function(c,b){c=
this.getPriorityCompareValue(c);b=this.getPriorityCompareValue(b);return c<b};a.prototype._updateHeuristicInfo=function(c,b){if(null!==b.worldBounding){var a=h.toVec3(b.worldBounding.center()),d=h.toVec3(b.worldBounding.extents());c=c.calculateAttachHeuristic(d,a);b.priorityHeuristic=c}null!==b.xmlAttachInfo&&b.xmlAttachInfo.directlyRequested&&(null===b.worldBounding&&(b.priorityHeuristic=0),b.priorityHeuristic+=-1E6)};a.prototype.createPriority=function(c,b,a){if(null===a)return++this._prevPriorityValue;
var d=Object.create(null);if(null!==a.bounding){b=b.transformBox(a.bounding);var f=0}else{if(this._requireBoundingInfo)throw Error("WorldBounding must be specified when streamCutoff is enabled");b=null;f=++this._prevPriorityValue}a={xmlAttachInfo:a,worldBounding:b,priorityHeuristic:f};this._updateHeuristicInfo(c,a);this._priorityProxies.set(d,a);return d};a.prototype.destroyPriority=function(c){"object"===typeof c&&this._priorityProxies.delete(c)};a.prototype.onViewChange=function(c,b,a){var d=this;
this._calculateCutoff(a.getProjectionMatrix(b.getCamera()));this._priorityProxies.forEach(function(b){d._updateHeuristicInfo(c,b)})};a.prototype.reset=function(){this._priorityProxies.clear()};a.prototype._calculateCutoff=function(c){var b=.98;0!==c.m[11]&&(b=(1-c.m[15])/c.m[11]*c.m[10]+c.m[14]);var a=d.Matrix.inverse(c);if(!a)throw Error();c=h.toVec4(a.transform4(new d.Point4(0,0,b,1)));var e=h.toVec4(a.transform4(new d.Point4(.0125,0,b,1)));b=h.toVec4(a.transform4(new d.Point4(0,.0125,b,1)));h.scale4(1/
c[3],c);h.scale4(1/e[3],e);h.scale4(1/b[3],b);this._calculatedCutoff=Math.min(h.squaredNorm4(h.sub4(e,c)),h.squaredNorm4(h.sub4(b,c)))};a.prototype.getCalculatedCutoff=function(){return this._calculatedCutoff};return a}();g.AttachPriorityManager=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){(function(a){function d(c){return"modelName"in c}a.isNameInfo=d;a.isIncInfo=function(c){return!d(c)};a.canImplicitlyLoad=function(c){return c.config.implicitlyLoadXmlExternalModels||!d(c)}})(d.ExternalModel||(d.ExternalModel={}))})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a,d){var f=this;this._cameraTimeoutId=null;this._isFirstAttachment=!0;this._attachScope=0;null===d&&(d=13);console.assert(0<d);this._engine=c;this._view=b;this._callbackManager=a;this._parentToXmlAttachInfos=new Map;this._viewInfo=new g.ViewInfo(this._view);this._attachPriorityManager=new g.AttachPriorityManager;this._comparePriority=function(b,c){return f._attachPriorityManager.comparePriority(b,c)};this._attachQueue=this._createAttachQueue(d);
this._prefetchScsQueue=this._createPrefetchScsQueue(d);this._registerCameraListener()}a.createWithEmptyModel=function(c,b,d,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return[4,c.loadEmpty()];case 1:return f.sent(),[2,new a(c,b,d,e)]}})})};a.prototype.setPrefetchScsCutoffScale=function(c){this._prefetchScsQueue.setCutoffScale(c);this._attachPriorityManager.setRequireBoundingInfo(this._prefetchScsQueue.cutoffEnabled())};a.prototype._createAttachQueue=
function(c){return new h.PriorityPromiseQueue(c,this._comparePriority,!1)};a.prototype._createPrefetchScsQueue=function(c){var b=this;return new h.StreamCutoffAttachQueue(0,this._attachPriorityManager,c+15,function(c,a){return b._comparePriority(c,a)},!1)};a.prototype._reprioritizeAttachments=function(){this._viewInfo=new g.ViewInfo(this._view);this._attachPriorityManager.onViewChange(this._viewInfo,this._view,this._engine);this._attachQueue.markDirty();this._prefetchScsQueue.update()};a.prototype._registerCameraListener=
function(){var c=this,b=function(){c._onCameraChange()};this._callbackManager.bind({camera:b,_shutdownBegin:function(){null!==c._cameraTimeoutId&&(clearTimeout(c._cameraTimeoutId),c._cameraTimeoutId=null);c._callbackManager.unbind({camera:b})}})};a.prototype.reprioritizeAttachmentsNow=function(){null!==this._cameraTimeoutId&&(clearTimeout(this._cameraTimeoutId),this._cameraTimeoutId=null);this._reprioritizeAttachments()};a.prototype._onCameraChange=function(){var c=this;null!==this._cameraTimeoutId&&
clearTimeout(this._cameraTimeoutId);this._cameraTimeoutId=this._engine.setTimeout(function(){c._cameraTimeoutId=null;c._reprioritizeAttachments()},500)};a.prototype._awaitAttachInfo=function(c,b,a,e,l){var f=this,k=null===e,p=new g.AttachInfoBuilder(b,a),q=!1,r=[],t=h.OpenPromise.create(),u=h.OpenPromise.create(),w=!1,v=function(){console.assert(!w);w=!0;f._cleanupAttachLowLevel();f._callbackManager.unbind(x)},y=null,x={_priorityMetaDataSent:function(c,a){c===b&&(p.registerPrototypeInstanceCount(a),
t.resolve())},_announceModel:function(c,a){c===b&&(q=!0,p.registerMasterModelKey(a))},_inclusion:function(c,a,d){c===b&&(p.registerInclusion(a,d),r.push(d))},_remapModel:function(a,d,f){a===b&&c.remapModel(d,f)},_remapInclusion:function(a,d,f,e){a===b&&c.remapInclusion(d,f,e)},_missingModel:function(c,a){c===b&&(y=a)},_attached:function(c){if(c===b){if(!q){if(null!==y&&(k||l)){console.assert(0===r.length);u.reject(new d.MissingModelError(y));return}if(1!==r.length){u.reject(new d.LoadError("Bad model: Could not find master model key."));
return}p.registerMasterModelKey(r[0])}c=[t];var a=f._isFirstAttachment;if(a){f._isFirstAttachment=!1;var e=f._callbackManager.promiseTrigger("_firstAttachment",null,k?h.AttachType.Direct:h.AttachType.Indirect);c.push(e)}return d.Util.waitForAll(c).catch(function(b){console.assert(!1);throw b;}).then(function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return a&&1===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",
null)]:[3,2];case 1:b.sent(),b.label=2;case 2:return v(),u.resolve(p),[2]}})})})}}};this._callbackManager.bind(x);return u.catch(function(b){v();throw b;})};a.prototype._createPriority=function(c,b){return this._attachPriorityManager.createPriority(this._viewInfo,c,b)};a.prototype._cleanupAttachLowLevel=function(){};a.prototype._cleanupAttachHighLevel=function(c,b,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,,2,
3]),[4,c];case 1:return[2,d.sent()];case 2:return null!==a&&this._forgetXmlAttachment(a),this._attachPriorityManager.destroyPriority(b),[7];case 3:return[2]}})})};a.prototype.newAttachScope=function(){return++this._attachScope};a.prototype._attachByStream=function(c,b,a,e,g,n,h,p){var f=this,k=d.Matrix.toMatrix12(e.m);e=this._createPriority(e,h);var l=this._attachQueue.push(function(){return __awaiter(f,void 0,void 0,function(){var d,f,e,l=this;return __generator(this,function(m){switch(m.label){case 0:d=
this.newAttachScope(),f=this._awaitAttachInfo(b,d,n.get(),h,p),m.label=1;case 1:return m.trys.push([1,4,,5]),[4,c.enqueue(function(){return l._engine.attachModel(d,a,k,g,n.get())})];case 2:return m.sent(),[4,f];case 3:return[2,m.sent()];case 4:throw e=m.sent(),this._cleanupAttachLowLevel(),e;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(l,e,h)};a._getAllModelKeys=function(c){var b=c.getMasterModelKey();c=c.getAllInclusions();if(c[1]!==b)for(var a=2;a<c.length;a+=2)if(c[a+1]===b){var d=
c[a];c[a]=c[0];c[a+1]=c[1];c[0]=d;c[1]=b;break}b=[];a=0;for(d=1;d<c.length;++a,d+=2)b[a]=c[d];return b};a.prototype.attachByNamedScsBuffer=function(c,b,f,e,l,n,m,p){return __awaiter(this,void 0,void 0,function(){var k,r,t,u,w,v=this;return __generator(this,function(q){c.getAutomaticMeasurementUnitScaling()||(n=SC.UnspecifiedMeasurementUnit);k=g.towardLoadContext(p.parent);r=d.Matrix.toMatrix12(l.m);t=this._createPriority(l,p);u=function(e){return __awaiter(v,void 0,void 0,function(){var l,q,t,u,w,
v,y,x,H,I,K,J,L=this;return __generator(this,function(z){switch(z.label){case 0:return[4,function(){return __awaiter(L,void 0,void 0,function(){var c;return __generator(this,function(a){c=k.getScsModelKeysOf(b);return null===c?(k.initializeScsModelKeysOf(b),[2,e]):[2,c]})})}()];case 1:l=z.sent();q=k.getScsModelKeysOf(b);if(null===q)throw new d.InternalLogicError;t=this.newAttachScope();if(!(l instanceof Uint8Array||h.FetchApi.isSupported()&&l instanceof Response))return[3,7];w=!0;v=this._awaitAttachInfo(f,
t,m.get(),p,!1);z.label=2;case 2:return z.trys.push([2,5,,6]),[4,c.enqueue(function(){var b=L._engine.attachScsBuffer(t,l instanceof Uint8Array?l:null,r,n,m.get(),w);l instanceof Uint8Array||L.streamScsData(t,l);return b})];case 3:return z.sent(),[4,v];case 4:return u=z.sent(),[3,6];case 5:throw y=z.sent(),this._cleanupAttachLowLevel(),y;case 6:return 0===q.state&&(x=a._getAllModelKeys(u),q.resolve(x)),[3,8];case 7:if(null===l)u=null,0===q.state&&q.resolve(null);else if(l instanceof Array){console.assert(0!==
q.state);H=new g.AttachInfoBuilder(t,m.get());H.registerPrototypeInstanceCount(0);for(I=0;I<l.length;++I)K=l[I],J=this._engine.attachScsModelByKey(t,K,r,n,m.get()),H.registerInclusion(J,K),0===I&&H.registerMasterModelKey(K);u=H}else throw new d.InternalLogicError;z.label=8;case 8:return[2,u]}})})};w=function(){return __awaiter(v,void 0,void 0,function(){var c,a=this;return __generator(this,function(d){switch(d.label){case 0:return[4,this._prefetchScsQueue.push(function(){return __awaiter(a,void 0,
void 0,function(){return __generator(this,function(c){return[2,k.toScsBuffer(b,e)]})})},t)];case 1:return c=d.sent(),p.directlyRequested=!0,[2,this._attachQueue.push(function(){return u(c)},t)]}})})}();return[2,this._cleanupAttachHighLevel(w,t,p)]})})};a.prototype.streamScsData=function(c,b){var a=this;this._callbackManager.trigger("_fetchBegin",b.url,c);var d=b.body.getReader();this._engine.setTimeout(function(){return __awaiter(a,void 0,void 0,function(){var a,f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,
d.read()];case 1:a=k.sent();f=a.done;e=a.value;if(f)return this._engine.feedScsBuffer(c,null),this._callbackManager.trigger("_fetchEnd",b.url,c),[2];this._engine.feedScsBuffer(c,e);return[3,0];case 2:return[2]}})})},0)};a.prototype._attachByScsBuffer=function(c,b,a,e,g,n){var f=this,k=d.Matrix.toMatrix12(e.m);e=this._createPriority(e,null);var l=this._attachQueue.push(function(){return __awaiter(f,void 0,void 0,function(){var d,f,e,l=this;return __generator(this,function(h){switch(h.label){case 0:d=
this.newAttachScope(),f=this._awaitAttachInfo(b,d,n.get(),null,!1),h.label=1;case 1:return h.trys.push([1,4,,5]),[4,c.enqueue(function(){var b=l._engine.attachScsBuffer(d,a instanceof Uint8Array?a:null,k,g,n.get(),!1);a instanceof Uint8Array||l.streamScsData(d,a);return b})];case 2:return h.sent(),[4,f];case 3:return[2,h.sent()];case 4:throw e=h.sent(),this._cleanupAttachLowLevel(),e;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(l,e,null)};a.prototype.simpleAttach=function(c,b,a,e,
g,n,h,p){c.getAutomaticMeasurementUnitScaling()||(g=SC.UnspecifiedMeasurementUnit);if("string"===typeof a)return this._attachByStream(c,b,a,e,g,n,h,p);if(null===h)return this._attachByScsBuffer(c,b,a,e,g,n);d.Util.TypeAssert(a);d.Util.TypeAssert(h);throw new d.InternalLogicError;};a.prototype.reset=function(){this._isFirstAttachment=!0;this._attachScope=0;this._parentToXmlAttachInfos.clear();this._attachPriorityManager.reset();return this.clearAttachQueues()};a.prototype.clearAttachQueues=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._prefetchScsQueue.killDeferred(),this._attachQueue.killDeferred(),[4,this._prefetchScsQueue.waitForIdle()];case 1:return c.sent(),[2,this._attachQueue.waitForIdle()]}})})};a.prototype.isIdle=function(){return this._attachQueue.isIdle()};a.prototype.notifyDirectRequest=function(c){c=this._parentToXmlAttachInfos.get(c);if(void 0!==c){for(var b=!1,a=0;a<c.length;a++){var d=c[a];d.directlyRequested||(b=d.directlyRequested=
!0)}b&&this._reprioritizeAttachments()}};a.prototype.registerXmlAttachInfo=function(c){var b=c.parent,a=this._parentToXmlAttachInfos.get(b);void 0===a&&(a=[],this._parentToXmlAttachInfos.set(b,a));a.push(c)};a.prototype._forgetXmlAttachment=function(c){var b=c.parent,a=this._parentToXmlAttachInfos.get(b);1===a.length?(console.assert(a[0]===c),this._parentToXmlAttachInfos.delete(b)):(console.assert(1<a.length),c=a.indexOf(c),console.assert(0<=c),a.splice(c,1))};a.prototype.maxConcurrentAttachments=
function(){return this._attachQueue.maxActivePromises()};return a}();g.ScAttacher=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(){this._remappedModelKeys=new Map;this._remappedInclusionKeys=new Map}a.prototype.remapModel=function(c,b){this._remappedModelKeys.set(b,c);this._remappedInclusionKeys.has(c)||this._remappedInclusionKeys.set(c,new Map)};a.prototype.remapInclusion=function(c,b,a){c=this._remappedInclusionKeys.get(c);console.assert(void 0!==c);c.set(a,b)};a.prototype.getEffectiveModelKey=function(c){var b=this._remappedModelKeys.get(c);return void 0!==
b?b:c};a.prototype.getEffectiveInclusionKey=function(c,b){b=this._remappedInclusionKeys.get(b);return void 0!==b&&(b=b.get(c),void 0!==b)?b:c};return a}();d.ScKeyRemapper=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b){return(new DOMParser).parseFromString(b,"application/xml")}function e(b){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(f){switch(f.label){case 0:return[4,h.httpRequest(b)];case 1:return c=f.sent(),d=c.responseXML,null===d&&(d=a(c.responseText)),[2,d]}})})}function c(b){if(!b.hasChildNodes)return null;b=b.firstChild;if(!(b instanceof Comment))return null;b=b.data.split(" ");if(2!==b.length||"HC"!==b[0])return null;
b=b[1].split(".");if(2>b.length)return null;for(var c=[],a=0;a<b.length;a++){var d=b[a];if(!h.isBase10Number(d))return null;c.push(parseInt(d,10))}return c}function b(b){b=b.getElementsByTagName("parsererror");if(0<b.length)throw new d.XmlParseError(b[0].textContent||"unknown error");}function f(b,c,a,d){return{getAttachScope:function(){return b},getMasterModelKey:function(){return d},getModelKeys:function(){return[d]},hasInclusions:function(){return!0},getAllInclusions:function(){return[a,d]},getInclusionsOf:function(b){return b===
d?[a,d]:[]},hasModelIncluded:function(b){return b===d},attachedInvisibly:function(){return c},prototypeInstanceCount:function(){return 0}}}var k=function(){function k(b,c,a,d,f){this._loadQueue=new h.PromiseQueue(1024,!1);this._activeLoadGeneration=this._activeLoadCount=0;this._isFirstLoad=!0;this._firstAssemblyDataHeader=null;console.assert(b.isInitialized());this._assemblyTree=b;this._scAttacher=c;this._engine=a;this._view=d;this._callbackManager=f;this._isScsSession=2===this._engine.getSessionType();
this._nodesUntilNextSleep=2E3}k.prototype._resolveMeasurementUnits=function(b){if(this._assemblyTree.getAutomaticMeasurementUnitScaling()){var c=g.towardProductOccurrence(b.getParent());if(null===c)throw new d.InternalLogicError;var a=c.getMeasurementUnit(),f=b.getMeasurementUnit();a!==f&&(c=b.getLocalTransform(),null===c&&(c=g.Transform.getIdentity()),a=f/a,c[0]*=a,c[5]*=a,c[10]*=a,b.setLocalTransformAsInitial(c))}};k.prototype._patchImplicitNodesByModelInc=function(b,c,a,d,f){return __awaiter(this,
void 0,void 0,function(){var e,k,l,n,m,p,q,r,C,B,D,F=this;return __generator(this,function(t){switch(t.label){case 0:e=0;if(0===d.length)return[2];l=h.Lazy.create(function(){var d=b.get(),e=g.towardAttachContext(d),l=e.getAttachScope();k=e.attachedInvisibly();e=e.split(l,k,d);d.addAttachContext(e);d=new g.InclusionContext(F._assemblyTree,e,c,a);e.addInclusionContext(d);e=g.ProductOccurrence.createDynamic(F._assemblyTree,d,"Of Inclusion ("+c+")",null,null,!k,f);d.addProductOccurrence(e);return e});
n=0;m=d;t.label=1;case 1:if(!(n<m.length))return[3,4];p=m[n];q=this._assemblyTree.lookupAnyBodyByInstanceInc(c,p);if(null!==q)return[3,3];r=l.get();C="Implicit Body "+ ++e;return[4,this._engine.getPartsBounding([c,p],!0,!1)];case 2:B=t.sent(),D=B.max!==B.min&&!B.isDegenerate(),q=this._assemblyTree.createMeshInstance(!0,c,p,null,C,r,!1,!1,D,!0),k&&q.setVisibility(!1),t.label=3;case 3:return n++,[3,1];case 4:return[2]}})})};k.prototype._getPrototypeInstanceCountByAttachment=function(b){var c=new Set,
a=0;b=b.getAllInclusions();for(var d=0;d<b.length;d+=2){var f=b[d],e=b[d+1];c.has(e)||(c.add(e),a+=this._assemblyTree.getInstanceCountByInclusion(f))}return a};k.prototype._patchImplicitNodesByAttachment=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,l,n,m,p,x,z,A,C=this;return __generator(this,function(q){switch(q.label){case 0:return console.assert(b.isLoaded()),f=null,e=h.Lazy.create(function(){var d=new g.ScKeyRemapper,e=c.getMasterModelKey();f=new g.AttachContext(d,
c.getAttachScope(),c.attachedInvisibly(),e,b);d=new g.InclusionContext(C._assemblyTree,f,0,0);f.addInclusionContext(d);e=g.ProductOccurrence.createDynamic(C._assemblyTree,d,"Implicit Bodies",null,null,!c.attachedInvisibly(),a);d.addProductOccurrence(e);return e}),k=c.prototypeInstanceCount(),0!==k?[3,2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),0,1)];case 1:k=q.sent()[0],q.label=2;case 2:return l=this._getPrototypeInstanceCountByAttachment(c),l===k?[2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),
0,0)];case 3:n=q.sent(),m=c.getAllInclusions(),p=0,q.label=4;case 4:if(!(p<m.length))return[3,7];x=m[p];z=m[p+1];A=n.get(z);return void 0===A?[3,6]:[4,this._patchImplicitNodesByModelInc(e,x,z,A,a)];case 5:q.sent(),q.label=6;case 6:return p+=2,[3,4];case 7:l=this._getPrototypeInstanceCountByAttachment(c);if(l<k)throw new d.InternalLogicError;return null===f?[2]:[4,g.markContextsLoaded([f])];case 8:return q.sent(),b.addAttachContext(f),[2]}})})};k.prototype._updateOnDemandRequests=function(b){return __awaiter(this,
void 0,void 0,function(){var c,a,d,f,e;return __generator(this,function(k){if(!this._assemblyTree.onDemandRequestsActive())return[2];c=b.getChildren();a=[];d=0;for(f=c;d<f.length;d++)e=f[d],this._assemblyTree.isBeingRequested(e)&&a.push(e);return[2,this._assemblyTree.requestNodes(this,a,!0)]})})};k.prototype._populateAttachment=function(b,c,a,d,f,e){return __awaiter(this,void 0,void 0,function(){var k;return __generator(this,function(g){switch(g.label){case 0:return console.assert(f===h.AttachType.Indirect===
(null!==e)),[4,this._parseRootNodes(b,c,a,d,e)];case 1:return k=g.sent(),[4,this._postProcessAttachContext(c,d,f,k)];case 2:return g.sent(),[2,k]}})})};k.prototype._postProcessAttachContext=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e,k,l=this;return __generator(this,function(n){switch(n.label){case 0:return[4,g.WalkerAsync.forceLazyPromises(d)];case 1:return n.sent(),[4,this._assemblyTree.enqueue(function(){return g.synchronizePmiVisibilities(l._engine,d)})];case 2:return n.sent(),
(f=this._assemblyTree.markImplicitNodesOutOfHierarchy())&&(f=0<d.getChildren().length||a===h.AttachType.Indirect),[4,this._patchImplicitNodesByAttachment(b,c,f)];case 3:return n.sent(),[4,this._updateOnDemandRequests(d)];case 4:return n.sent(),e=d.getChildren(),k=e.map(function(b){return b.getRuntimeId()}),this._callbackManager.trigger("_attachmentPopulated",k),[2]}})})};k.prototype._parseRootNodes=function(b,c,a,d,f){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,m,p,q,r=this;return __generator(this,
function(t){switch(t.label){case 0:return e=d.getMasterModelKey(),k=d.getInclusionsOf(e),4294967295===e&&(console.assert(0===k.length),k.push(4294967295,4294967295)),l=new g.AttachContext(a,d.getAttachScope(),d.attachedInvisibly(),e,c),null!==f&&l.setReservedNodeIdOffset(f),n=new h.PromiseQueue(1,!0),[4,this._assemblyTree.enqueue(function(){return l.getRootNodeMetaData(r._assemblyTree)})];case 1:m=t.sent();p=function(c){n.push(function(){return r._parseRootNode(b,l,m,k[c],k[c+1])})};for(q=0;q<k.length;q+=
2)p(q);return[4,n.waitForIdle()];case 2:return t.sent(),[2,l]}})})};k.prototype._parseRootNode=function(b,c,a,d,f){return __awaiter(this,void 0,void 0,function(){var e,k;return __generator(this,function(l){switch(l.label){case 0:return console.assert(0!==d),[4,this._populateInclusion(b,c,a,d,f)];case 1:return e=l.sent(),e.hasAuthoredId()?(console.assert(!e.isLoaded()),k=g.towardInclusionContext(e),l=k.getParent(),l=l instanceof g.AttachContext&&l.getParent()instanceof g.LoadContext?!0:!1,l&&this._setupRootNode(e,
!1)):null===e.getName()&&(c.removeProductOccurrence(e)||console.assert(!1)),[2]}})})};k.prototype._setupRootNode=function(b,c){console.assert(!b.isAbsoluteRoot());c&&b.markIsExternalModelRoot(this._assemblyTree);this._resolveMeasurementUnits(b)};k.prototype._populateInclusion=function(b,c,a,d,f){return __awaiter(this,void 0,void 0,function(){var e,k,l=this;return __generator(this,function(n){switch(n.label){case 0:return console.assert(0!==d),e=new g.InclusionContext(this._assemblyTree,c,d,f),c.addInclusionContext(e),
[4,function(){return __awaiter(l,void 0,void 0,function(){var d,f,k;return __generator(this,function(l){if(null===a||0===a.bytes.length)return d=null,null===a&&(d="Missing"),[2,g.ProductOccurrence.createDynamic(this._assemblyTree,e,d,null,null,!c.attachedInvisibly())];f=new g.AssemblyDataParser(a);k=g.ProductOccurrence.parseBinary(b,this._assemblyTree,e,f);return[2,g.ProductOccurrence.reify(b,this,this._assemblyTree,e,k,e)]})})}()];case 1:return k=n.sent(),e.addProductOccurrence(k),[2,k]}})})};k.prototype._rectifyLateVisibilityChange=
function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d,f,e;return __generator(this,function(k){a=g.towardAttachContext(c.getParent());d=g.towardProductOccurrence(c.getParent());console.assert(d===g.towardProductOccurrence(a));if(b.attachInvisibly||null===d||!d.isLoaded())return[2];f=d.isVisible();if(a.attachedInvisibly()===!f)return[2];e=f?2:0;return[2,g.updateVisibilitiesByAttachment({assemblyTree:this._assemblyTree,engine:this._engine,attachContext:a,setVisibility:e})]})})};k.prototype._loadCleanup=
function(b,c,a){console.assert(0<this._activeLoadCount);b.onLoadComplete();null!==c&&this._callbackManager.unbind(c);--this._activeLoadCount;this._assemblyTree.onLoadEnd(a);this._callbackManager.trigger("visibilityChanged",[],[])};k.prototype._wrap=function(b,c,a,f){var e=this,k=this._activeLoadGeneration;return this._loadQueue.push(function(){return __awaiter(e,void 0,void 0,function(){var e,g,l,n,m,p,q,r,t,D,F,E,G,H,I=this;return __generator(this,function(u){switch(u.label){case 0:e=this._assemblyTree.onLoadBegin();
g=null;if(k!==this._activeLoadGeneration)throw this._loadCleanup(c,g,e),new d.LoadCancelledError;null===this._firstAssemblyDataHeader&&(g={_modelStructureHeaderParsed:function(b){return __awaiter(I,void 0,void 0,function(){return __generator(this,function(c){null!==g&&(null===this._firstAssemblyDataHeader&&(this._firstAssemblyDataHeader=b),this._callbackManager.unbind(g),g=null);return[2]})})}},this._callbackManager.bind(g,!0));u.label=1;case 1:return u.trys.push([1,3,,5]),[4,a];case 2:return u.sent(),
[3,5];case 3:return l=u.sent(),[4,c.purgeContents()];case 4:throw u.sent(),this._loadCleanup(c,g,e),l;case 5:n=c.getParent();if(null===n)throw this._loadCleanup(c,g,e),new d.InternalLogicError;m=f===h.AttachType.Direct;if(!m)return[3,8];if(!c.hasChildren())return[3,6];n.addLoadContext(c);return[3,8];case 6:return[4,c.purgeContents()];case 7:u.sent(),u.label=8;case 8:this._loadCleanup(c,g,e);p=c.getChildren();q=[];r=0;for(t=p;r<t.length;r++)D=t[r],F=this._rectifyLateVisibilityChange(b,D),q.push(F);
return[4,d.Util.waitForAll(q)];case 9:u.sent();if(!this._isFirstLoad)return[3,13];this._isFirstLoad=!1;c.markAsFirstLoad();E=p.map(function(b){return b.getRuntimeId()});G=!1;u.label=10;case 10:return u.trys.push([10,12,,13]),[4,this._callbackManager.promiseTrigger("_firstModelLoaded","firstModelLoaded",E,G,f)];case 11:return u.sent(),[3,13];case 12:throw H=u.sent(),console.assert(!1),H;case 13:return[2,c]}})})})};k.prototype._initLoad=function(b,c,a){++this._activeLoadCount;a=this._isScsSession&&
a?new h.PromiseCache:null;return new g.LoadContext(b,c,a)};k._getNetMatrix=function(b,c){b=d.Matrix.createFromArray(g.getNetMatrix(b));null!==c&&(b=d.Matrix.multiply(c,b));return b};k.prototype._lazyAttachInvisibly=function(b,c){return h.Lazy.create(function(){return c.attachInvisibly||!b.isVisible()})};k.prototype._loadBySingleAttach=function(b,c,a,d){var f=this,e=this._initLoad(c,d,!1);d=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var d,f,l,n,m,p,q;return __generator(this,
function(r){switch(r.label){case 0:return[4,a];case 1:return d=r.sent(),f=new g.ScKeyRemapper,l=k._getNetMatrix(c,b.additionalMatrix),n=c.getMeasurementUnit(),m=this._lazyAttachInvisibly(c,b),[4,this._scAttacher.simpleAttach(this._assemblyTree,f,d,l,n,m,null,!1)];case 2:return p=r.sent(),[4,this._populateAttachment(b,e,f,p,h.AttachType.Direct,null)];case 3:return q=r.sent(),[4,g.markContextsLoaded([e,q])];case 4:return r.sent(),q.hasChildren()&&e.addAttachContext(q),[2,{}]}})})});return this._wrap(b,
e,d,h.AttachType.Direct)};k.prototype._populateFromXml=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,h,m,p,q,A,C,B,D;return __generator(this,function(r){switch(r.label){case 0:e=a.documentElement;k=e.firstElementChild;for(n=l=null;null!==k;){"ModelFile"===k.localName&&(console.assert(null===l),l=g.ModelFile.parseXml(b,this._assemblyTree,c,k,f));if("DefaultCamera"===k.localName&&(n=g.XmlParser.parseCamera(k),!n))throw new d.XmlParseError('"DefaultCamera" element exists but couldn\'t be parsed');
k=k.nextElementSibling}if(null===l)throw new d.XmlParseError('Expected "ModelFile" element.');h=!1;if(!this._isFirstLoad)return[3,4];m=SC.UnspecifiedMeasurementUnit;this._assemblyTree.getAutomaticMeasurementUnitScaling()&&(p=g.towardProductOccurrence(c),m=p.getMeasurementUnit());if(null==n)return[3,2];h=!0;return[4,this._view._setCameraPromise(n,0)];case 1:return r.sent(),[3,4];case 2:q=g.ModelFile.parseBounding(l,m);if(q.isDegenerate()||null!==n)return[3,4];h=!0;return[4,this._view.setViewOrientation(d.ViewOrientation.Iso,
0,q)];case 3:r.sent(),r.label=4;case 4:return[4,g.ModelFile.reify(b,this._callbackManager,this,this._assemblyTree,c,l)];case 5:A=r.sent();C=0;for(B=A;C<B.length;C++)D=B[C],this._setupRootNode(D,!1);return!this._isFirstLoad||h?[3,7]:[4,this._view.setViewOrientation(d.ViewOrientation.Iso,0)];case 6:r.sent(),r.label=7;case 7:return[2]}})})};k.prototype._loadByXml=function(a,f,e,k,l){var n=this,m=this._initLoad(f,l,!0);l=h.LazyPromise.create(function(){return __awaiter(n,void 0,void 0,function(){var l,
n,p,q,r,t,u,B,D;return __generator(this,function(w){switch(w.label){case 0:return[4,e];case 1:l=w.sent();b(l);n=c(l);if(null===n||!h.versionAtLeast(g.MaxModelFileVersion,n))throw new d.XmlParseError("Bad version.");p=function(b){return k(b,n)};this._scAttacher.reprioritizeAttachmentsNow();f.addLoadContext(m);q=g.towardInclusionContext(f);r=g.towardAttachContext(q);t=this._scAttacher.newAttachScope();u=this._lazyAttachInvisibly(f,a);B=r.split(t,u.get(),m);m.addAttachContext(B);D=q.split(this._assemblyTree,
B);B.addInclusionContext(D);return[4,this._populateFromXml(a,D,l,p)];case 2:return w.sent(),[4,g.markContextsLoaded([m,B])];case 3:return w.sent(),[2,{}]}})})});return this._wrap(a,m,l,h.AttachType.Indirect)};k.prototype._attachExternalModelByInc=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d,f,e,k,l;return __generator(this,function(h){switch(h.label){case 0:return console.assert(0!==b.inclusionKey),a=g.towardAttachContext(c).getAttachScope(),d=b.modelKey,f=this._lazyAttachInvisibly(c,
b.config),e=new g.ScKeyRemapper,k=new g.AttachContext(e,a,f.get(),d,c),[4,k.getRootNodeMetaData(this._assemblyTree)];case 1:return l=h.sent(),[4,this._populateInclusion(b.config,k,l,b.inclusionKey,b.modelKey)];case 2:return h.sent(),[2,k]}})})};k.prototype._attachExternalModelInfoByName=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,l,n,m,p,x,z,A,C=this;return __generator(this,function(q){switch(q.label){case 0:f=new g.ScKeyRemapper;e=this._lazyAttachInvisibly(c,b.config);
k=c.getMeasurementUnit();q=d.Matrix.createFromArray(g.getNetMatrix(c));if(0>=k||!C._assemblyTree.getAutomaticMeasurementUnitScaling())l=q;else{var r=a.getAttachContext().getParent();null===r?r=SC.UnspecifiedMeasurementUnit:(r=r.getParent(),r=null===r?SC.UnspecifiedMeasurementUnit:r.getMeasurementUnit());r=r===SC.UnspecifiedMeasurementUnit?1:k/r;l=1===r?q:d.Matrix.multiply(q,(new d.Matrix).setScaleComponent(r,r,r))}n={bounding:b.bounding,parent:c,directlyRequested:!1};if(!this._isScsSession)return[3,
2];this._scAttacher.registerXmlAttachInfo(n);return[4,this._scAttacher.attachByNamedScsBuffer(this._assemblyTree,b.modelName,f,b.toAttachData,l,k,e,n)];case 1:return m=q.sent()||0,[3,8];case 2:return q.trys.push([2,7,,8]),[4,b.toAttachData(b.modelName)];case 3:p=q.sent();if(null!==p&&p!==d.EmptyModelName)return[3,4];m=0;return[3,6];case 4:if("string"!==typeof p)throw d.Util.TypeAssert(p),new d.InternalLogicError;d.Util.TypeAssert(p);this._scAttacher.registerXmlAttachInfo(n);return[4,this._scAttacher.simpleAttach(this._assemblyTree,
f,p,l,k,e,n,b.config.allowMissingExternalModels)];case 5:m=q.sent(),q.label=6;case 6:return[3,8];case 7:x=q.sent();if(b.config.allowMissingExternalModels&&x instanceof d.MissingModelError)m=1;else throw x;return[3,8];case 8:if("number"===typeof m){d.Util.TypeAssert(m);z=this._scAttacher.newAttachScope();A=!e.get();a:{r=this._assemblyTree;var t=m,u=A;q=new g.AttachContext(f,z,u,0,c);switch(t){case 0:break a;case 1:t=new g.InclusionContext(r,q,0,0);q.addInclusionContext(t);r=g.ProductOccurrence.createDynamic(r,
t,"Missing",null,null,!u);t.addProductOccurrence(r);break a;default:q=d.Util.TypeAssertNever(t)}}return[2,q]}return[2,this._populateAttachment(b.config,c,f,m,h.AttachType.Indirect,b.reservedNodeIdOffset)]}})})};k.prototype.setPrefetchScsCutoffScale=function(b){this._scAttacher.setPrefetchScsCutoffScale(b)};k.prototype.isIdle=function(){return 0===this._activeLoadCount?(console.assert(this._scAttacher.isIdle()),!0):!1};k.prototype.waitOnCurrentLoads=function(){return this._loadQueue.waitForIdle()};
k.prototype.cancelPendingLoads=function(){++this._activeLoadGeneration;return this.waitOnCurrentLoads()};k.prototype.cancelActiveAttachmentProcess=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._scAttacher.clearAttachQueues()]})})};k.prototype.loadByStream=function(b,c,a){return a===d.EmptyModelName?(b=new g.LoadContext(c,d.EmptyModelName,null),Promise.resolve(b)):this._loadBySingleAttach(b,c,Promise.resolve(a),a)};k.prototype.loadByScsBuffer=
function(b,c,a){return this._loadBySingleAttach(b,c,Promise.resolve(a),"*SCS Buffer*")};k.prototype.loadByScsFile=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){if(h.FetchApi.isSupported())return[2,this._loadBySingleAttach(b,c,h.FetchApi.request(a),a)];d=h.httpRequestBuffer(a);return[2,this._loadBySingleAttach(b,c,d,a)]})})};k.prototype.loadByXmlDoc=function(b,c,d,f){d="string"===typeof d?a(d):d;return this._loadByXml(b,c,Promise.resolve(d),
f,"*XML Document*")};k.prototype.loadByXmlFile=function(b,c,a,d){var f=e(a);return this._loadByXml(b,c,f,d,a)};k.prototype.attachByExternalModelInfo=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,l,h,n,m;return __generator(this,function(p){switch(p.label){case 0:return g.ExternalModel.isNameInfo(b)?[4,this._attachExternalModelInfoByName(b,c,a)]:[3,2];case 1:return f=p.sent(),[3,4];case 2:return[4,this._attachExternalModelByInc(b,c)];case 3:f=p.sent(),p.label=4;case 4:e=[];
k=f.getChildren();l=0;for(h=k;l<h.length;l++)n=h[l],this._setupRootNode(n,!0),m=this._rectifyLateVisibilityChange(b.config,n),e.push(m);return[4,d.Util.waitForAll(e)];case 5:return p.sent(),[2,f]}})})};k.prototype.loadByAssemblyData=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,m,p,q,z,A=this;return __generator(this,function(r){e=h.AttachType.Direct;k=a[0];l=a[1];n=this._scAttacher.newAttachScope();m=!c.isVisible();p=f(n,m,k,l);q=this._initLoad(c,"*Assembly Data*",!1);
z=h.LazyPromise.create(function(){return __awaiter(A,void 0,void 0,function(){var c,a,f;return __generator(this,function(h){switch(h.label){case 0:return c=new g.ScKeyRemapper,a=p.getMasterModelKey(),f=new g.AttachContext(c,n,p.attachedInvisibly(),a,q),[4,this._parseRootNode(b,f,d,k,l)];case 1:return h.sent(),[4,this._postProcessAttachContext(q,p,e,f)];case 2:return h.sent(),[4,g.markContextsLoaded([q,f])];case 3:return h.sent(),f.hasChildren()&&q.addAttachContext(f),[2,{}]}})})});return[2,this._wrap(b,
q,z,e)]})})};k.prototype.reset=function(){this._isFirstLoad=!0;this._firstAssemblyDataHeader=null;return this._scAttacher.reset()};k.prototype.notifyDirectRequest=function(b){this._scAttacher.notifyDirectRequest(b)};k.prototype.onLoadChildProductOccurrence=function(){if(0===this._nodesUntilNextSleep)return this._nodesUntilNextSleep=2E3,this._engine.sleep(10);--this._nodesUntilNextSleep};k.prototype.firstAssemblyDataHeader=function(){return this._firstAssemblyDataHeader};return k}();g.TreeLoader=k})(h.Tree||
(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c){var b=c.getCamera(),a=b.getPosition(),e=b.getTarget();e=d.Point3.subtract(e,a);var g=e.length();1E-7>g&&(g=1E-7);this._eyeDistanceInverse=1/g;e.scale(this._eyeDistanceInverse);c=c.getFullCameraMatrix();this._frustum=h.ConvexVolume.createFrustumFromMatrix(c);this._viewProjectionW=h.col4(c,3);this._cameraIsOrtho=b.getProjection()===d.Projection.Orthographic;this._position=h.toVec3(a);this._eye=h.toVec3(e)}a.prototype.calculateAttachHeuristic=
function(c,b){var a=0;if(this._frustum.axisAlignedBoxNotOutside(b,c))return c=h.squaredNorm3(c),c=h.projectSquaredSize(b,c,this._viewProjectionW),0<c&&(a=h.sub3(b,this._position),b=1/(h.dot3(this._eye,a)*this._eyeDistanceInverse+1E-5),a=h.scale3(1/h.norm3(a),a),a=h.dot3(this._eye,a),b=Math.pow(b,6),this._cameraIsOrtho||(b*=5*Math.pow(a,10)),1E-5>b&&(b=1E-5),a=c*b),console.assert(0<=a),-a-1;a=1/(1+Math.exp(h.norm3(c)));console.assert(0<=a&&1>a);return a};return a}();g.ViewInfo=a})(h.Tree||(h.Tree=
{}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(){}a._parseUint_32=function(c){if(!h.isBase10Number(c))return null;c=parseInt(c,10);return 4294967295>=c?c:null};a._parseFloat=function(c){c=parseFloat(c);return isNaN(c)?null:c};a.parseFloat=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseFloat(c)};a._parseScKey=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};a.parseDataKey=function(c,b){return this._parseScKey(c,b)};a.parseMeshKey=
function(c,b){return this._parseScKey(c,b)};a.parseInstanceKeyFromInc=function(c,b){c=c.getAttribute(b);if(null===c)return null;c=c.split(" ");return 2!==c.length||null===this._parseUint_32(c[0])?null:this._parseUint_32(c[1])};a.parseNodeId=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};a.parseLayerId=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};a.parseUint=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};
a.parseUints=function(c,b){var a=c.getAttribute(b);if(null===a)return null;c=[];b=0;for(a=a.match(/[0-9]+/g)||[];b<a.length;b++){var d=this._parseUint_32(a[b]);if(null===d)return null;c.push(d)}return c};a.parseFloats=function(c,b){var a=c.getAttribute(b);if(null===a)return null;c=[];b=0;for(a=a.match(/\S+/g)||[];b<a.length;b++){var d=this._parseFloat(a[b]);if(null===d)return null;c.push(d)}return c};a.parseNodeIds=function(c,b){return this.parseUints(c,b)};a._parsePoint3=function(c,b){c=c.getAttribute(b);
if(null===c)return null;c=c.split(" ");if(3!==c.length)return null;b=[];for(var a=0;a<c.length;a++){var e=Number(c[a]);if(isNaN(e))return null;b.push(e)}return new d.Point3(b[0],b[1],b[2])};a.parseBounding=function(c,b){c=c.getElementsByTagName(b);if(1!==c.length)return null;b=c[0];c=this._parsePoint3(b,"Min");if(null===c)return null;b=this._parsePoint3(b,"Max");return null===b?null:new d.Box(c,b)};a.parseCamera=function(c){var b=a.parseUint(c,"Projection");if(null===b)return null;var f=c.getAttribute("field");
if(null===f)return null;var e=f.split(" ");if(2!==e.length)return null;f=parseFloat(e[0]);e=parseFloat(e[1]);c=c.getAttribute("definition");if(null===c)return null;var g=c.split(" ");if(9!==g.length)return null;var h=function(b,c){return new d.Point3(parseFloat(b[c]),parseFloat(b[c+1]),parseFloat(b[c+2]))};c=h(g,0);var m=h(g,3);g=h(g,6);return d.Camera.create(c,m,g,b,f,e)};return a}();g.XmlParser=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c,b){var a="number"===typeof c;return a===("number"===typeof b)?c<b?-1:c>b?1:0:a?-1:1}var e=function(){function c(){console.assert(!1)}c.parseXml=function(b,c,a){var d=g.XmlParser.parseNodeId(c,"Id");null===d&&(console.assert(!1),d=b.generateDynamicNodeId());b=c.getAttribute("Name");for(var f=null,e=[],k=c.firstElementChild;null!==k;){if("Transformation"===k.localName)console.assert(null===f),f=g.Transform.parseXml(k),g.Transform.isIdentity(f)&&(f=
null);else if("Attributes"===k.localName)for(var h=k.firstElementChild;null!==h;){console.assert("Attr"===h.localName);var r=g.Attribute.parseXml(h);e.push(r);h=h.nextElementSibling}k=k.nextElementSibling}k=c.getAttribute("ExchangeId");c=a.ignoreLayers?null:g.XmlParser.parseLayerId(c,"LayerId");return{nodeId:d,bits:1073741824,name:b,localTransform:f,attributes:e,header:g.AssemblyDataHeader.dynamic,exchangeId:k,layerId:c,genericTypeId:null,genericId:null,userDatas:null}};c.parseBinary=function(b,c,
a,d){a.hasBits1(1)?b=c.parseNodeId():(console.assert(!1),b=b.generateDynamicNodeId());var f=a.hasBits1(2)?c.parseCString():null,e=1073741824;if(a.hasBits1(4)){var k=c.parseVisibility();k.shown||(e&=-1073741825);k.removed&&(e|=536870912)}k=null;a.hasBits1(8)&&(k=g.Transform.parseBinary(c),g.Transform.isIdentity(k)&&(k=null));var l=null;a.hasBits1(256)&&(l=c.parseDataKey());var h=a.hasBits1(33554432)?c.parseCString():null,t=null;if(a.hasBits1(67108864)){var u=c.parseLayerId();d.ignoreLayers||(t=u)}u=
null;if(a.hasBits2(16)){var w=c.parseGenericTypeId();d.ignoreGenericTypes||(u=w)}d=null;a.hasBits2(32)&&(d=c.parseGenericId());w=null;if(a.hasBits1(536870912)){w=new Map;a=c.parseCount_32();for(var v=0;v<a;++v){var y=c.parseUserDataIndex(),x=c.parseCount_32();x=c.parseBytes(x);w.set(y,x)}}return{nodeId:b,bits:e,name:f,localTransform:k,attributes:null!==l?l:[],header:c.getHeader(),exchangeId:h,layerId:t,genericTypeId:u,genericId:d,userDatas:w}};return c}();g.Node=e;e=function(){function c(b,a,e){this._bits=
0;this._nodeId=e.nodeId;this._bits=e.bits;null!==e.name&&(this._name=e.name);null!==e.localTransform&&(this._localTransform=g.Transform.copy(e.localTransform));"number"===typeof e.attributes?this._lazyAttributes=c._lazyLoadAttributes(b,a,e.attributes,e.header):0<e.attributes.length&&(this._lazyAttributes=h.LazyPromise.create(e.attributes));null!==e.exchangeId&&(this._exchangeId=e.exchangeId);null!==e.layerId&&(this._layerId=e.layerId);null!==e.genericTypeId&&(this._genericTypeId=e.genericTypeId);
null!==e.genericId&&(this._genericId=e.genericId);null!==e.userDatas&&(this._userDatas=d.Util.copyMap(e.userDatas))}c._lazyLoadAttributes=function(b,c,a,d){var f=this;return h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var f,e,k,l,h,n;return __generator(this,function(m){switch(m.label){case 0:return f=b.getAbstractScEngine(),[4,b.enqueue(function(){return f.safeGetMetaData(c,a)})];case 1:e=m.sent();k=[];if(null!==e)for(l=new g.AssemblyData(d,e),h=new g.AssemblyDataParser(l);h.hasNext();)n=
g.Attribute.parseBinary(h),k.push(n);return[2,k]}})})})};c.prototype.hasAuthoredId=function(){return g.isAuthoredId(this._nodeId)};c.prototype.getAuthoredId=function(){return g.getAuthoredId(this._nodeId)};c.prototype.getName=function(){return void 0!==this._name?this._name:null};c.prototype.getExchangeId=function(){return void 0!==this._exchangeId?this._exchangeId:null};c.prototype.getAuthoredLayerId=function(){return void 0!==this._layerId?this._layerId:null};c.prototype.getGenericTypeId=function(){return void 0!==
this._genericTypeId?this._genericTypeId:null};c.prototype.getGenericId=function(){return void 0!==this._genericId?this._genericId:null};c.prototype._hasBits=function(b){return h.hasBits(this._bits,b)};c.prototype.isLoaded=function(){return this._hasBits(-2147483648)};c.prototype.markLoaded=function(){this._bits|=-2147483648};c.prototype._setVisibility=function(b){this._bits|=524288;this._bits=b?this._bits|262144:this._bits&-262145};c.prototype.isVisible=function(){return this._hasBits(524288)?this._hasBits(262144):
this.isInitiallyShown()};c.prototype.isInitiallyShown=function(){return this._hasBits(536870912)?!1:this._hasBits(1073741824)};c.prototype._toAffineTransformation=function(b){b=b.slice();b[3]=0;b[7]=0;b[11]=0;b[15]=1;return b};c.prototype.setLocalTransformAsInitial=function(b){this._localTransform=this._toAffineTransformation(b)};c.prototype.overrideLocalTransform=function(b){this._localTransformOverride=this._toAffineTransformation(b)};c.prototype.hasLocalTransformOverride=function(){return void 0!==
this._localTransformOverride};c.prototype.removeLocalTransformOverride=function(){console.assert(void 0!==this._localTransformOverride);delete this._localTransformOverride};c.prototype.getLocalTransform=function(){return void 0!==this._localTransformOverride?this._localTransformOverride:void 0!==this._localTransform?this._localTransform:null};c.prototype.getAttributes=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){return void 0!==this._lazyAttributes?
[2,this._lazyAttributes.then(function(c){if(void 0!==b._lazyAttributes){for(var a=0;a<c.length;a++)b.addAttribute(c[a]);delete b._lazyAttributes}return b.getAttributes()})]:[2,h.TerseArray.toArray(this._attributes)]})})};c.prototype.addAttribute=function(b){this._attributes=h.TerseArray.push(this._attributes,b)};c.prototype.getUserDataIndices=function(){var b=[];void 0!==this._userDatas&&this._userDatas.forEach(function(c,a){b.push(a)});return b.sort(a)};c.prototype.getUserData=function(b){if(void 0!==
this._userDatas){var c=this._userDatas.get(b);if(void 0!==c)return c}throw new d.InvalidIndexError(b);};return c}();g.NodeMixin=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(b){function c(c,a,d,f){a=b.call(this,c,a,f.nodeInfo)||this;a._bits|=f.bits;a._parent=d;a._instanceKey=f.instanceKey;d=a.getAuthoredLayerId();null!==d&&c.registerNodeInLayer(a,d);null===d||a.isOutOfHierarchy()||c.registerTreeNodeInLayer(a,d);null===d&&!a.isOutOfHierarchy()&&g.isAuthoredId(f.nodeInfo.nodeId)&&(c.registerNodeInLayer(a,g.Layer.NoLayerId),c.registerTreeNodeInLayer(a,g.Layer.NoLayerId));return a}__extends(c,b);c.prototype.setRequested=
function(){this._bits|=1024};c.prototype.isRequested=function(){return this._hasBits(1024)};c.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};c.prototype.preventFromResetting=function(){return this._hasBits(16384)};c.prototype.isImplicitBody=function(){return this._hasBits(512)};c.prototype.getParent=function(){return this._parent};c.prototype.getInstanceKey=function(){return this._instanceKey};return c}(g.NodeMixin);g.BodyMixin=a;var e=function(b){function c(c,a,d,f){a=b.call(this,
c,a,d,f)||this;c.registerBodyInstance(a,f.inclusionKey);return a}__extends(c,b);c.parseXml=function(b,c,a,f){b=g.Node.parseXml(b,c,f);c=g.XmlParser.parseInstanceKeyFromInc(c,"MeshInstanceKey");if(null===c)throw new d.XmlParseError('Expected "MeshInstanceKey" attribute.');return{nodeInfo:b,inclusionKey:a,instanceKey:c,bits:0}};c.parseBinary=function(b,c,a,f){var e=g.towardAttachContext(c),k=e.getRemapper(),l=e.getMasterModelKey();e=a.parseNodeParseBits();b=g.Node.parseBinary(b,a,e,f);c=e.hasBits1(131072)?
a.parseInclusionKey(k,l):c.getInclusionKey();if(!e.hasBits1(262144))throw new d.AssemblyDataParseError('Expected "ScInstanceKey" in binary data.');a=a.parseInstanceKey();return{nodeInfo:b,inclusionKey:c,instanceKey:a,bits:0}};c.reify=function(b,a,d,f){var e=g.towardAttachContext(d);b=new c(b,a,d,f);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.createDynamic=function(b,a,d,f,e,h,r,t){var k=g.towardInclusionContext(h),l=g.towardAttachContext(k).getMasterModelKey();a={nodeInfo:{nodeId:b.massageAuthoredUserId(k,
f),bits:r,name:e,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:a,instanceKey:d,bits:t};return new c(b,l,h,a)};c.prototype.getName=function(){var c=b.prototype.getName.call(this);if(null!==c)return c;c=this.getParent().getBodyInstances();if(1<c.length){for(var a=0;a<c.length;++a)if(this===c[a])return"body "+(a+1);console.assert(!1)}return"body"};c.prototype.getInstanceInc=function(){var b=
this._instanceKey,c=0;if(this.hasAuthoredId()||this.isImplicitBody())c=g.towardInclusionContext(this).getInclusionKey();return[c,b]};c.prototype.setVisibility=function(b){b!==this.isVisible()&&this.getParent().markBranchVisibilityDirty();this._setVisibility(b)};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};return c}(a);g.BodyInstance=e;var c=function(b){function c(c,a,d,f){a=b.call(this,c,a,d,f)||this;c.registerPmiBody(a,f.inclusionKey);return a}__extends(c,b);c.parseBinary=
function(b,c,a,d,f){b=e.parseBinary(b,c,a,f);d&&(d=b.nodeInfo,d=__assign({},d,{bits:d.bits&-1073741825}),b=__assign({},b,{nodeInfo:d}));return b};c.reify=function(b,a,d,f){var e=g.towardAttachContext(d);b=new c(b,a,d,f);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.prototype.getName=function(){var c=b.prototype.getName.call(this);return null!==c?c:"PMI body"};c.prototype.getInstanceInc=function(){var b=this._instanceKey,c=0;if(this.hasAuthoredId()||this.isImplicitBody())c=g.towardInclusionContext(this).getInclusionKey();
return[c,b]};c.prototype.setVisibility=function(b){b!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();this._setVisibility(b)};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};return c}(a);g.PmiBody=c;a=function(b){function c(c,a,d,f){a=b.call(this,c,a,d,f)||this;a._bits&=-1073741825;c.registerViewFrame(a,f.inclusionKey);return a}__extends(c,b);c.parseXml=function(b,c,a,d){return e.parseXml(b,c,a,d)};c.parseBinary=function(b,c,a,d){return e.parseBinary(b,
c,a,d)};c.reify=function(b,a,d,f){var e=g.towardAttachContext(d);b=new c(b,a,d,f);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.prototype.getName=function(){var b=this.getName();return null!==b?b:"CAD View frame"};c.prototype.getInstanceInc=function(){var b=this._instanceKey,c=0;if(this.hasAuthoredId()||this.isImplicitBody())c=g.towardInclusionContext(this).getInclusionKey();return[c,b]};c.prototype.setVisibility=function(b){b!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();
this._setVisibility(b)};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};return c}(a);g.ViewFrame=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b,c){var a=new h.PromiseQueue(1,!0);a.push(function(){return b.clear()});for(var d=function(c){a.push(function(){return b.addPlane(c,null)})},f=0;f<c.length;f++)d(c[f]);return a.waitForIdle()}function e(b,c){c.hasLocalTransformOverride()&&(c.removeLocalTransformOverride(),b.push(c))}var c=function(b){function c(a,f,e,m,p){var k=this,l=g.towardAttachContext(f).getMasterModelKey();k=b.call(this,a,l,{nodeId:e.nodeId,bits:0,name:e.name,localTransform:null,
attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;k._parent=p;k._bits|=e.bits;null!==e.camera&&(k._camera={initial:e.camera.copy(),derived:e.camera.copy()});k._instanceMarkupKeysToShow=d.Util.toSet(e.instanceMarkupKeysToShow);c.isAuthoredViewInfo(e,m)?(k._nodesToShow=c._toRuntimeIds(f,e.nodesToShow),k._nodesToHide=c._toRuntimeIds(f,e.nodesToHide),0<e.transformMap.size&&(k._transformMap=new Map,e.transformMap.forEach(function(b,
c){c=f.toRuntimeId(c);k._transformMap.set(c,g.Transform.copy(b))}))):(k._nodesToShow=d.Util.toSet(e.nodesToShow),k._nodesToHide=d.Util.toSet(e.nodesToHide),0<e.transformMap.size&&(k._transformMap=d.Util.copyMap(e.transformMap)));null!==e.viewFrameInfo&&(k._viewFrame=k._loadViewFrame(a,l,e.viewFrameInfo));if(0<e.cuttingPlanes.length){k._cuttingPlanes=h.TerseArray.fromArray(e.cuttingPlanes);var n=1;e=g.towardAttachRoot(k);m=g.towardAttachContext(e);if(m=g.towardProductOccurrence(m))e=e.getMeasurementUnit(),
m=m.getMeasurementUnit(),e!==m&&(n=e/m);1!==n&&h.TerseArray.toArray(k._cuttingPlanes).forEach(function(b){b.d*=n})}a.registerCadView(k);return k}__extends(c,b);c.parseXml=function(b,c,a,f){var e=0,k=g.XmlParser.parseNodeId(c,"Id");if(null===k)throw new d.XmlParseError('Expected "Id" attribute.');var l=c.getAttribute("Name");if(null===l)throw new d.XmlParseError('Expected "Name" attribute');var n=function(b,c,a,f){b=b.getAttribute("Enabled");if(null===b)throw new d.XmlParseError("Expected "+a+" attribute");
return c=h.setBit(c,f,"1"===b)},m=c.getAttribute("isAnnotationView");e=null===m?h.setBit(e,134217728,!1):h.setBit(e,134217728,"true"===m);var w=m=null,v=[],y=[],x=[],z=new Map,A=[],C=function(b){var c=g.XmlParser.parseUint(b,"Projection");if(null===c)throw new d.XmlParseError('Expected "Projection" attribute');var a=b.getAttribute("field");if(null===a)throw new d.XmlParseError('Expected "field" attribute');var f=a.split(" ");if(2!==f.length)throw new d.XmlParseError("Expected 2 field values");a=parseFloat(f[0]);
f=parseFloat(f[1]);b=b.getAttribute("definition");if(null===b)throw new d.XmlParseError('Expected "definition" attribute');var e=b.split(" ");if(9!==e.length)throw new d.XmlParseError("Expected 9 definition values");var k=function(b,c){return new d.Point3(parseFloat(b[c]),parseFloat(b[c+1]),parseFloat(b[c+2]))};b=k(e,0);var l=k(e,3);e=k(e,6);return d.Camera.create(b,l,e,c,a,f)},B=function(b){var c=[];if(null===g.XmlParser.parseUint(b,"Count"))throw new d.XmlParseError('Expected "PMIToShow Count" attribute');
b=g.XmlParser.parseNodeIds(b,"IDs");if(null===b)throw new d.XmlParseError('Expected "PMIToShow Ids" attribute');for(var a=0;a<b.length;a+=2)c.push(b[a+1]);return c},D=function(b){var c=[],a=g.XmlParser.parseUint(b,"Count");if(null===a)throw new d.XmlParseError('Expected "ClipPlanes Count" attribute');b=g.XmlParser.parseFloats(b,"Plane");if(null===b)throw new d.XmlParseError('Expected "Plane" attribute');if(b.length/4!==a)throw new d.XmlParseError("Expected "+a+" Planes");for(a=0;a<b.length;a+=4)c.push(d.Plane.createFromCoefficients(b[a],
b[a+1],b[a+2],b[a+3]));return c},F=function(b){var c=new Map,a=g.XmlParser.parseUint(b,"Count");if(null===a)throw new d.XmlParseError('Expected "IDLocalTransform Count" attribute');b=g.XmlParser.parseFloats(b,"IDTransform");if(null===b)throw new d.XmlParseError('Expected "IDTransform" attribute');if(b.length/13!==a)throw new d.XmlParseError("Expected "+a+" IDTransform values");for(a=0;a<b.length;a+=13){var f=b[a],e=b,k=a,l=g.Transform.getIdentity();l[1]=e[k+1];l[2]=e[k+2];l[3]=e[k+3];l[4]=e[k+4];
l[6]=e[k+5];l[7]=e[k+6];l[8]=e[k+7];l[9]=e[k+8];l[11]=e[k+9];l[12]=e[k+10];l[13]=e[k+11];l[14]=e[k+12];c.set(f,l)}return c};for(c=c.firstElementChild;null!==c;)"Camera"===c.localName?(console.assert(null===m),m=C(c)):"Frame"===c.localName?w=g.ViewFrame.parseXml(b,c,a.getInclusionKey(),f):"PMIToShow"===c.localName?v=B(c):"InstanceToShow"===c.localName?y=g.XmlParser.parseNodeIds(c,"IDs"):"InstanceToHide"===c.localName?x=g.XmlParser.parseNodeIds(c,"IDs"):"ClipPlanes"===c.localName?A=D(c):"IDLocalTransform"===
c.localName?z=F(c):"IsCameraSet"===c.localName?e=n(c,e,"IsCameraSet",67108864):"IsPMIFilteringSet"===c.localName?e=n(c,e,"IsPMIFilteringSet",33554432):"IsGeomFilteringSet"===c.localName?e=n(c,e,"IsGeomFilteringSet",16777216):"IsCrosssectionSet"===c.localName?e=n(c,e,"IsCrosssectionSet",8388608):"IsExplosionSet"===c.localName?e=n(c,e,"IsExplosionSet",4194304):"IsCombineState"===c.localName&&(e=n(c,e,"IsCombineState",2097152)),c=c.nextElementSibling;return{nodeId:k,name:l,camera:m,instanceMarkupKeysToShow:v,
viewFrameInfo:w,nodesToShow:null===y?[]:y,nodesToHide:null===x?[]:x,transformMap:z,cuttingPlanes:A,bits:e}};c.parseBinary=function(b,c,a,f){var e=a.parseViewParseBits(),k=a.parseNodeId(),l=null;h.hasBits(e,1)&&(l=a.parseCString());var n=0,m=!1;h.hasBits(e,256)?(m=!0,l+=" # Annotation View"):null!==l&&0<=l.indexOf("# Annotation View")&&(m=!0);m&&(n|=134217728);h.hasBits(e,1024)||(n|=33554432);h.hasBits(e,2048)||(n|=16777216);h.hasBits(e,4096)||(n|=8388608);h.hasBits(e,8192)||(n|=4194304);h.hasBits(e,
16384)&&(n|=2097152);h.hasBits(e,65536)&&(n|=256);var w=h.hasBits(e,32768);w&&(n|=1048576);m=null;if(h.hasBits(e,2)){w=w?d.Projection.Perspective:d.Projection.Orthographic;var v=a.parsePoint3_32(),y=a.parsePoint3_32(),x=a.parsePoint3_32(),z=a.parseFloat_32(),A=a.parseFloat_32();!h.hasBits(e,512)&&(n|=67108864,m=d.Camera.create(v,y,x,w,z,A),0>z||0>A)&&(n|=8192)}w=[];if(h.hasBits(e,4))for(y=a.parseCount_32(),v=0;v<y;++v)x=a.parseInstanceKey(),w.push(x);y=null;h.hasBits(e,8)&&(y=g.ViewFrame.parseBinary(b,
c,a,f));b=[];if(h.hasBits(e,16))for(c=a.parseCount_32(),v=0;v<c;++v)f=a.parseNodeId(),b.push(f);c=[];if(h.hasBits(e,32))for(f=a.parseCount_32(),v=0;v<f;++v)x=a.parseNodeId(),c.push(x);f=new Map;if(h.hasBits(e,64))for(x=a.parseCount_32(),v=0;v<x;++v)z=a.parseNodeId(),A=g.Transform.parseBinary(a),f.set(z,A);x=[];if(h.hasBits(e,128))for(e=a.parseCount_32(),v=0;v<e;++v)z=a.parsePlane3_32(),x.push(z);return{nodeId:k,name:l,camera:m,instanceMarkupKeysToShow:w,viewFrameInfo:y,nodesToShow:b,nodesToHide:c,
transformMap:f,cuttingPlanes:x,bits:n}};c.reify=function(b,a,d,f){var e=g.towardAttachContext(a);b=new c(b,a,d,0,f);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.createDynamic=function(b,a,d,f,e,h,r,t,u){for(var k=g.towardInclusionContext(a),l=b.generateDynamicNodeId(),n=[],m=0;m<e.length;m++)for(var p=0,q=e[m].getPmiBodies();p<q.length;p++){var C=q[p],B=g.towardInclusionContext(C);console.assert(k===B);C=C.getInstanceInc()[1];n.push(C)}return new c(b,k,{nodeId:l,name:d,camera:f,instanceMarkupKeysToShow:n,
viewFrameInfo:null,nodesToShow:h,nodesToHide:r,transformMap:t,cuttingPlanes:null!==u?[u]:[],bits:67108864},1,a)};c.isAuthoredViewInfo=function(b,c){return 0===c};c._toRuntimeIds=function(b,c){for(var a=new Set,d=0;d<c.length;d++){var f=b.toRuntimeId(c[d]);a.add(f)}return a};c.prototype._loadViewFrame=function(b,c,a){return g.ViewFrame.reify(b,c,this,a)};c.prototype.getViewFrame=function(){return void 0!==this._viewFrame?this._viewFrame:null};c.prototype.getParent=function(){return this._parent};c.prototype.getRuntimeId=
function(){return g.getRuntimeId(this._nodeId,this)};c.prototype.getBranchVisibility=function(){var b=this.isVisible()?2:1;void 0===this._viewFrame||this._viewFrame.isOutOfHierarchy()||(b|=this._viewFrame.isVisible()?2:1);return b};c.prototype.setVisibility=function(b){this._setVisibility(b)};c.prototype.isPmiFilteringSet=function(){return this._hasBits(33554432)};c.prototype.isDefaultView=function(){return this._hasBits(256)};c.prototype.IsCombineState=function(){return this._hasBits(2097152)};c.prototype.deactivate=
function(b){return b.clearAllCuttingSections()};c.prototype._replaceCuttingPlanes=function(b,c){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,b.clearAllCuttingSections()];case 1:k.sent();f=b.getCuttingSectionCount();if(c.length>f)throw new d.CommunicatorError("System does not support more than "+f+" cutting planes in a CadView");e=c.reduce(function(c,d,f){f=b.getCuttingSection(f);console.assert(null!==f);c.push(a(f,[d]));
return c},[]);return[4,Promise.all(e)];case 2:return k.sent(),[4,b.activateCuttingSections()];case 3:return k.sent(),[2]}})})};c.prototype.activate=function(b,c,a,d,f,e,g,h){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(k){switch(k.label){case 0:return[4,this._activateView(b,c,a,d,h)];case 1:return k.sent(),[2,this._activateCamera(b,c,f,e,g)]}})})};c.prototype._activateView=function(b,c,a,f,p){return __awaiter(this,void 0,void 0,function(){var k,l,n,m,w,v,y,x,z,A,
C,B=this;return __generator(this,function(q){switch(q.label){case 0:return k=b.getRootNode(),null!==p&&console.assert(p.isAConfigurationNode()),l=null!==p?p.getRuntimeId():g.invalidNodeId,n=g.invalidNodeId,m=new Map,w=[],v=[],y=e,void 0!==this._transformMap&&(y=function(b,c){var a=B._transformMap,d=c.getRuntimeId();a=a.get(d);void 0!==a?(c.overrideLocalTransform(a),b.push(c)):c.hasLocalTransformOverride()&&(c.removeLocalTransformOverride(),b.push(c))}),x={enterProductOccurrence:function(b){b.isAConfigurationNode()&&
(n=b.getRuntimeId());var c=n,a=b.forEachPmi(function(b){var a=b.getPmiBodies();if(0!==a.length){var d=!0;if(B.isPmiFilteringSet()){d=!1;for(var f=0;f<a.length;f++){var e=a[f];e=e.getInstanceInc()[1];if(B._instanceMarkupKeysToShow.has(e)){d=!0;break}}}null!==p&&(d=d&&(c===l||c===g.invalidNodeId));m.set(b,d);for(b=0;b<a.length;b++)e=a[b],m.set(e,d)}}).then(function(){var a=b.getRuntimeId();B._nodesToHide.has(a)||b.isADrawingSheetNode()?m.set(b,!1):B._nodesToShow.has(a)&&(null!==p?m.set(b,c===l||c===
g.invalidNodeId):m.set(b,!0));y(w,b);return b.forEachCadView(function(b){if(void 0!==b._viewFrame){var a=b===B;null!==p&&(a=a&&(c===l||c===g.invalidNodeId));m.set(b,a);m.set(b._viewFrame,a)}})});v.push(a)},leaveProductOccurrence:function(b){b.isAConfigurationNode()&&(n=g.invalidNodeId)},enterAnyBody:function(b){if(!b.isOutOfHierarchy()){y(w,b);for(var c=b.getParent();null!==c&&!(c instanceof g.Pmi);){var a=c.getRuntimeId();if(B._nodesToHide.has(a)){m.set(c,!1);break}else if(B._nodesToShow.has(a)){m.set(c,
!0);break}c=g.towardContainerNode(c.getParent())}c=b.getRuntimeId();B._nodesToShow.has(c)?m.set(b,!0):B._nodesToHide.has(c)&&m.set(b,!1);null!==p&&n!==g.invalidNodeId&&n!==l&&m.set(b,!1)}}},[4,g.WalkerAsync.walk(x,k,g.WalkRestriction.None)];case 1:return q.sent(),[4,Promise.all(v)];case 2:return q.sent(),z=[],A=g.updateVisibilities({assemblyTree:b,engine:c,startNode:k,visibilityFormatter:function(b){return m.get(b)},resetNonAffectedToDefault:!0,configurationNode:null!==p?p:void 0,callbackManager:a,
initiallyHiddenStayHidden:!1}),z.push(A),A=g.updateScMatrices(c,a,w,!1),z.push(A),[4,d.Util.waitForAll(z)];case 3:return q.sent(),C=h.TerseArray.toArray(this._cuttingPlanes),[4,this._replaceCuttingPlanes(f,C)];case 4:return q.sent(),[2]}})})};c.prototype._activateCamera=function(b,c,a,f,e){return __awaiter(this,void 0,void 0,function(){var k,l,h,n,m,p,y,x,z,A,C,B,D,F,E,G,H,I,K,J,L,N,M,Q,O,P,R,T,S,U,V,W,X,Y;return __generator(this,function(q){switch(q.label){case 0:return k=this._camera,void 0!==k?
[3,3]:b.disableAutomaticFitWorld()?[3,2]:[4,a.fitWorld(f)];case 1:q.sent(),q.label=2;case 2:return[2];case 3:if(!e)return[2,a._setCameraPromise(k.initial,f)];l=g.towardAttachRoot(this);h=g.towardAttachContext(l);n=g.towardProductOccurrence(h);m=d.Matrix.createFromArray(g.getNetMatrix(h));null!==n&&(p=l.getMeasurementUnit(),y=n.getMeasurementUnit(),p!==y&&(x=p/y,z=new d.Matrix,z.setScaleComponent(x,x,x),m=d.Matrix.multiply(z,m)));k.derived=k.initial.transform(m);if(!this._hasBits(8192))return[3,8];
A=!1;return void 0===this._viewFrame?[3,5]:[4,g.getBoundingByNodeId(b,c,[this._viewFrame.getRuntimeId()],7,!1,A)];case 4:return B=q.sent(),[3,7];case 5:return[4,c.getModelBounding(!0,!1,A)];case 6:B=q.sent(),q.label=7;case 7:return C=B,D=d.Point3.subtract(k.derived.getTarget(),k.derived.getPosition()),F=C.extents().length(),E=D.copy().normalize().scale(F),G=C.center(),H=d.Point3.subtract(G,E),k.derived.setPosition(H),k.derived.setTarget(G),k.derived.setWidth(F),k.derived.setHeight(F),[2,a._setCameraPromise(k.derived,
f)];case 8:if(k.derived.getProjection()!==d.Projection.Orthographic)return[3,10];I=d.Point3.subtract(k.derived.getTarget(),k.derived.getPosition());return[4,c.getModelBounding(!0,!1,!1)];case 9:return C=q.sent(),K=d.Point3.subtract(C.center(),k.derived.getPosition()),J=1/I.length(),L=J*d.Point3.dot(I,K),0<L&&(I.scale(J),N=Math.max(k.derived.getWidth(),k.derived.getHeight()),M=d.Point3.add(k.derived.getPosition(),d.Point3.scale(I,L)),Q=d.Point3.subtract(M,d.Point3.scale(I,2.5*N)),k.derived.setPosition(Q),
k.derived.setTarget(M)),[2,a._setCameraPromise(k.derived,f)];case 10:if(k.derived.getProjection()!==d.Projection.Perspective)return[3,12];O=.01;return[4,c.getModelBounding(!0,!1,!1)];case 11:C=q.sent();P=d.Point3.subtract(C.max,C.min).length();I=d.Point3.subtract(k.derived.getTarget(),k.derived.getPosition());R=I.length();T=R/P;if(0===P||T>O)return[2,a._setCameraPromise(k.derived,f)];S=P*O*1.001;U=k.derived.getWidth()/R;V=k.derived.getHeight()/R;W=U*S;X=V*S;Y=I.copy().normalize().scale(S);G=d.Point3.add(k.derived.getPosition(),
Y);k.derived.setTarget(G);k.derived.setWidth(W);k.derived.setHeight(X);return[2,a._setCameraPromise(k.derived,f)];case 12:return[2,a._setCameraPromise(k.derived,f)]}})})};c.prototype.hasPmi=function(b){var c=g.towardInclusionContext(this).getInclusionKey(),a=g.towardInclusionContext(b).getInclusionKey();if(c!==a)return!1;c=0;for(b=b.getPmiBodies();c<b.length;c++)if(a=b[c].getInstanceInc()[1],this._instanceMarkupKeysToShow.has(a))return!0;return!1};c.prototype.isAnnotationView=function(){return this._hasBits(134217728)};
c.prototype.isCombineStateView=function(){return this._hasBits(2097152)};c.prototype.setViewFrame=function(b){console.assert(void 0===this._viewFrame);this._viewFrame=b};return c}(g.NodeMixin);g.CadView=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(a){function c(b,c,e,g){var f=a.call(this,b,e,g.nodeInfo)||this;f._inclusionContextForNodeId=c;f._modelKey=e;0<g.repItemInfos.length&&(c=f._loadRepresentationItems(b,e,g.repItemInfos),f._repItems=d.TerseArray.fromArray(c));b.registerPartDefinition(f);return f}__extends(c,a);c.parseXml=function(b,c,a){var d=g.Node.parseXml(b,c,a);if(null===d.name){var f=c.getAttribute("FilePath");null!==f&&(d=__assign({},d,{name:f}))}f=[];for(c=c.firstElementChild;null!==
c;){if("Body"===c.localName){var e=g.RepresentationItem.parseXml(b,c,a);f.push(e)}c=c.nextElementSibling}return{nodeInfo:d,repItemInfos:f}};c.parseBinary=function(b,c,a){var d=c.parseNodeParseBits(),f=g.Node.parseBinary(b,c,d,a),e=[];if(d.hasBits1(1024)){d=c.parseCount_32();for(var k=0;k<d;++k){var h=g.RepresentationItem.parseBinary(b,c,a);e.push(h)}}return{nodeInfo:f,repItemInfos:e}};c.reify=function(b,a,d,e){return new c(b,a,d,e)};c.createDynamic=function(b,a,d){var f=b.getRootNode();f=g.towardInclusionContext(f);
a={nodeInfo:{nodeId:b.massageAuthoredUserId(f,a),bits:1073741824,name:d,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},repItemInfos:[]};return new c(b,f,0,a)};c.createMissing=function(b){b=this.createDynamic(b,null,null);b._bits|=4096;return b};c.prototype.isMissing=function(){return this._hasBits(4096)};c.prototype._loadRepresentationItems=function(b,c,a){for(var d=[],f=0;f<a.length;f++){var e=g.RepresentationItem.reify(b,
c,a[f],this);this._addRepresentationItem(e);d.push(e)}return d};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this._inclusionContextForNodeId)};c.prototype.getInclusionContextForNodeId=function(){return this._inclusionContextForNodeId};c.prototype.addReferrer=function(b){var c=g.towardLoadContext(b),a=g.towardLoadContext(this._inclusionContextForNodeId);console.assert(c===a);this._referrers=d.TerseArray.push(this._referrers,b)};c.prototype.createRepItem=function(b,c){b=g.RepresentationItem.createDynamic(b,
c,null,this._modelKey,this);this._addRepresentationItem(b);return b};c.prototype._addRepresentationItem=function(b){this._repItems=d.TerseArray.push(this._repItems,b)};c.prototype.getRepresentationItems=function(){return d.TerseArray.toArray(this._repItems)};c.prototype.getReferrers=function(){return d.TerseArray.toArray(this._referrers)};c.prototype.removeAllReferrers=function(){for(var b=0,c=this.getReferrers();b<c.length;b++){var a=c[b].removePartDefinition();console.assert(this===a)}delete this._referrers};
c.prototype.getModelKey=function(){return this._modelKey};return c}(g.NodeMixin);g.PartDefinition=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(c){c[c.Unknown=0]="Unknown";c[c.Text=1]="Text";c[c.Dimension=2]="Dimension";c[c.Arrow=3]="Arrow";c[c.Balloon=4]="Balloon";c[c.CircleCenter=5]="CircleCenter";c[c.Coordinate=6]="Coordinate";c[c.Datum=7]="Datum";c[c.Fastener=8]="Fastener";c[c.Gdt=9]="Gdt";c[c.Locator=10]="Locator";c[c.MeasurementPoint=11]="MeasurementPoint";c[c.Roughness=12]="Roughness";c[c.Welding=13]="Welding";c[c.Table=14]="Table";c[c.Other=15]="Other";c[c.GeometricalTolerance=16]=
"GeometricalTolerance"})(g.PmiType||(g.PmiType={}));(function(c){c[c.Ident=1]="Ident";c[c.Target=2]="Target"})(g.PmiSubTypeDatum||(g.PmiSubTypeDatum={}));(function(c){c[c.Distance=1]="Distance";c[c.DistanceOffset=2]="DistanceOffset";c[c.DistanceCumulate=3]="DistanceCumulate";c[c.Chamfer=4]="Chamfer";c[c.Slope=5]="Slope";c[c.Ordinate=6]="Ordinate";c[c.Radius=7]="Radius";c[c.RadiusTangent=8]="RadiusTangent";c[c.RadiusCylinder=9]="RadiusCylinder";c[c.RadiusEdge=10]="RadiusEdge";c[c.Diameter=11]="Diameter";
c[c.DiameterTangent=12]="DiameterTangent";c[c.DiameterCylinder=13]="DiameterCylinder";c[c.DiameterEdge=14]="DiameterEdge";c[c.DiameterCone=15]="DiameterCone";c[c.Length=16]="Length";c[c.LengthCurvilinear=17]="LengthCurvilinear";c[c.LengthCircular=18]="LengthCircular";c[c.Angle=19]="Angle"})(g.PmiSubTypeDimension||(g.PmiSubTypeDimension={}));(function(c){c[c.Fcf=1]="Fcf"})(g.PmiSubTypeGdt||(g.PmiSubTypeGdt={}));(function(c){c[c.Line=1]="Line";c[c.Spot=2]="Spot"})(g.PmiSubTypeWelding||(g.PmiSubTypeWelding=
{}));(function(c){c[c.SymbolUser=1]="SymbolUser";c[c.SymbolUtility=2]="SymbolUtility";c[c.SymbolCustom=3]="SymbolCustom";c[c.GeometricReference=4]="GeometricReference";c[c.Region=5]="Region"})(g.PmiSubTypeOther||(g.PmiSubTypeOther={}));var a=function(){return function(c){this.faceIds=[];this.edgeIds=[];this.body=c}}();g.PmiTopologyReference=a;var e=function(c){function b(a,d,e,n){var f=g.towardAttachContext(d).getMasterModelKey();var k=0;e.initiallyShown&&(k|=1073741824);k=c.call(this,a,f,{nodeId:e.nodeId,
bits:k,name:e.name,localTransform:null,attributes:e.attributesDataKey?e.attributesDataKey:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;k._bits|=16384;k._parent=n;k._packed=b._pack(e.pmiType,e.pmiSubType);n=0;for(var l=e.pmiBodyInfos;n<l.length;n++){var r=k._loadPmiBody(a,f,l[n]);k._pmiBodies=h.TerseArray.push(k._pmiBodies,r);r.markLoaded()}0<e.topoRefInfos.length&&(k._topoRefs=b._loadTopoRefs(d,e.topoRefInfos));if(0<e.topoRefs.length)if(void 0===
k._topoRefs)k._topoRefs=e.topoRefs.slice();else for(d=0,e=e.topoRefs;d<e.length;d++)k._topoRefs.push(e[d]);a.registerPmi(k);return k}__extends(b,c);b.parseBinary=function(b,c,a,d){var f=a.parsePmiParseBits(),e=a.parseNodeId(),k=null;h.hasBits(f,1)&&(k=a.parseCString());var l=null;h.hasBits(f,4)&&(l=a.parseDataKey());var n=1;h.hasBits(f,16)&&(n=a.parseCount_32());for(var u=[],w=h.hasBits(f,8),v=0;v<n;++v){var y=g.PmiBody.parseBinary(b,c,a,w,d);u.push(y)}b=0<u.length?h.hasBits(u[0].nodeInfo.bits,1073741824):
!1;c=a.parsePmiType();d=a.parsePmiSubType();n=[];if(h.hasBits(f,2))for(f=a.parseCount_32(),v=0;v<f;++v)w=g.ReferenceOnTopology.parseBinary(a),n.push(w);return{nodeId:e,name:k,attributesDataKey:l,pmiBodyInfos:u,initiallyShown:b,pmiType:c,pmiSubType:d,topoRefInfos:n,topoRefs:[]}};b.reify=function(c,a,d,e){var f=g.towardAttachContext(a);c=new b(c,a,d,e);f.attachedInvisibly()&&c.setVisibility(!1);return c};b.createDynamic=function(c,a,d,e,g,h,q,r){e={nodeId:c.generateDynamicNodeId(),name:e,attributesDataKey:null,
pmiBodyInfos:q,initiallyShown:!0,pmiType:g,pmiSubType:h,topoRefInfos:[],topoRefs:r};return new b(c,a,e,d)};b._loadTopoRefs=function(b,c){for(var a=[],d=0;d<c.length;d++){var f=g.ReferenceOnTopology.reify(b,c[d]);a.push(f)}return a};b.prototype._loadPmiBody=function(b,c,a){return g.PmiBody.reify(b,c,this,a)};b.prototype.getPmiBodies=function(){return h.TerseArray.toArray(this._pmiBodies)};b._pack=function(b,c){return b+100*c};b.prototype.getPmiType=function(){return this._packed%100};b.prototype.getPmiSubType=
function(){return Math.floor(this._packed/100)%100};b.prototype.getParent=function(){return this._parent};b.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};b.prototype.getBranchVisibility=function(){for(var b=this.isVisible()?2:1,c=0,a=h.TerseArray.toArray(this._pmiBodies);c<a.length;c++){var d=a[c];d.isOutOfHierarchy()||(b|=d.isVisible()?2:1)}return b};b.prototype.setVisibility=function(b){this._setVisibility(b)};b.prototype.getPmiTopologyReferences=function(b){if(void 0===
this._topoRefs)return[];for(var c=new Map,f=0,e=this._topoRefs;f<e.length;f++){var g=e[f],h=g.getBodyInstanceInc();h=b.lookupAnyBodyByInstanceInc(h[0],h[1]);if(null!==h){var q=c.get(h);void 0===q&&(q=new a(h),c.set(h,q));switch(g.getTopoItemType()){case d.PmiTopoRef.Face:q.faceIds.push(g.getItemIndex());break;case d.PmiTopoRef.Edge:q.edgeIds.push(g.getItemIndex())}}}var r=[];c.forEach(function(b){r.push(b)});return r};return b}(g.NodeMixin);g.Pmi=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal=
{}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c,b){for(var a=[],e=0;e<c.length;e++){var g=b(c[e]);g&&a.push(g)}return d.Util.waitForAll(a)}var e=function(c){function b(a,e,l,n,m,p,q){var f=this;q=b._amendInfo(n,q);var k=g.towardAttachContext(m),u=k.getMasterModelKey();k=g.towardLoadContext(k);f=c.call(this,n,u,q.nodeInfo)||this;f._parent=p;f._bits=f._bits|q.productBits|32768;var w=q.nodeInfo.header;p=[];null!==q.prototypeDataKey&&(console.assert(null!==l),f._prototypeContext=f._loadPrototypeContext(e,
l,n,m,q.prototypeDataKey,w));console.assert(null===q.quickAccessPartDefinitionDataId||null===q.partDefinition);null!==q.partDefinition?Array.isArray(q.partDefinition)?f._partDefinition=f._lazyLoadPartDefinitionById(n,m,q.partDefinition,w,e):f._partDefinition=f._lazyLoadPartDefinitionByInfo(n,m,q.partDefinition,u):null!==q.quickAccessPartDefinitionDataId&&(f._partDefinition=f._lazyLoadPartDefinitionById(n,m,q.quickAccessPartDefinitionDataId,w,e));if(0<q.childDataKeys.length){console.assert(null!==
l);var v=function(){return __awaiter(f,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._loadProductOccurrences(e,l,n,m,q.childDataKeys,w)];case 1:return b=c.sent(),this._children=h.TerseArray.fromArray(b),[2]}})})}();p.push(v)}0<q.bodyInstanceInfos.length&&(u=f._loadBodyInstances(n,u,q.bodyInstanceInfos),f._bodyInstances=h.TerseArray.fromArray(u));0<q.cadViewInfos.length&&(u=f._loadCadViews(n,m,q.cadViewInfos),f._cadViews=h.TerseArray.fromArray(u));
0<q.pmiInfos.length&&(u=f._loadPmis(n,m,q.pmiInfos),f._pmis=h.TerseArray.fromArray(u));null!==q.measurementUnit&&(f._measurementUnit=q.measurementUnit);null!==q.externalModelInfo&&(console.assert(null!==a),console.assert(null!==l),g.ExternalModel.canImplicitlyLoad(q.externalModelInfo)?(v=f._loadAndAttachExternalModel(l,m,q.externalModelInfo),p.push(v)):f._pendingExternalModels=h.TerseArray.push(f._pendingExternalModels,q.externalModelInfo));u=0;for(v=q.layerInfos;u<v.length;u++){var y=v[u],x=k.getRuntimeLayerId(y.id);
null===x?n.createLayer(y.id,y.name,k):null!==y.name&&n.updateLayerName(x,y.name)}u=0;for(v=q.filters;u<v.length;u++)n.addFilter(v[u],k);k=0;for(u=q.relationships;k<u.length;k++)m.addRelationship(u[k]);k=0;for(u=q.bimInfos;k<u.length;k++)m.addBimInfos(u[k]);k=f.getAuthoredLayerId();null!==k&&(n.registerNodeInLayer(f,k),f.isOutOfHierarchy()||n.registerTreeNodeInLayer(f,k));n.registerProductOccurrence(f);if(null===a){if(0<p.length)throw new d.InternalLogicError;}else a.resolve(d.Util.waitForAll(p));
return f}__extends(b,c);b.parseXml=function(b,c,a,d,e){var f=a.getInclusionKey(),k=g.Node.parseXml(c,d,b),l=g.XmlParser.parseFloat(d,"Unit"),h=[],n=[],m=[],v=[],y=[],x=[],z=null,A=null,C=null;for(d=d.firstElementChild;null!==d;){if("PartDefinition"===d.localName){z=g.PartDefinition.parseXml(c,d,b);break}else if("BodyInstance"===d.localName){var B=g.BodyInstance.parseXml(c,d,f,b);h.push(B)}else if("Material"===d.localName)console.assert(null===A),A=g.SimpleMaterial.parseXml(d);else if("ExternalModel"===
d.localName){if(console.assert(null===C),B=d.getAttribute("Name"),null!==B){C=g.XmlParser.parseFloat(d,"Unit");var D=g.XmlParser.parseBounding(d,"BoundingBox");C={config:b,modelName:B,bounding:D,measurementUnit:C,toAttachData:e,reservedNodeIdOffset:0}}}else if("CADView"===d.localName&&!b.ignoreCadViews)B=g.CadView.parseXml(c,d,a,b),x.push(B);else if("Filter"===d.localName&&!b.ignoreFilters)n.push(g.Filter.parseXml(d));else if("Layer"===d.localName&&!b.ignoreLayers)B=g.Layer.parseXml(d),null!==B&&
m.push(B);else if("Relationships"===d.localName&&!b.ignoreBimRelationships){B=g.Relationship.parseXml(d);null!==B&&v.push(B);if(null!==B.related){D=0;for(var F=B.related.relationships;D<F.length;D++){var E=F[D];!1===g.RelationshipUtils.findBimObjectInArray(y,E)&&y.push(E)}}null!==B.relating&&!1===g.RelationshipUtils.findBimObjectInArray(y,B.relating.relationElt)&&y.push(B.relating.relationElt)}d=d.nextElementSibling}return{nodeInfo:k,productBits:0,childDataKeys:[],prototypeDataKey:null,partDefinition:z,
quickAccessPartDefinitionDataId:null,externalModelInfo:C,bodyInstanceInfos:h,cadViewInfos:x,pmiInfos:[],measurementUnit:l,simpleMaterial:A,layerInfos:m,filters:n,relationships:v,bimInfos:y}};b.parseBinary=function(b,c,a,d){var f=g.towardAttachContext(a),e=f.getRemapper(),k=d.parseNodeParseBits();if(k.hasBits1(2097152)){var l=d.parseAssemblyDataVersion(2);l}k.hasBits2(8)&&(l=d.parseGenericTypes(),b.ignoreGenericTypes||f.setGenericTypeMaps(l));l=g.Node.parseBinary(c,d,k,b);var h=0;k.hasBits1(4194304)&&
(h=d.parseProductBits());var n=[];if(k.hasBits1(16))for(var w=d.parseCount_32(),v=0;v<w;++v){var y=d.parseDataKey();n.push(y)}y=w=null;if(k.hasBits1(32)&&(w=d.parseDataKey(),k.hasBits1(64))){y=d.parseModelKey(e);console.assert(0!==y);var x=d.parseDataKey();y=[y,x]}x=[];if(k.hasBits1(128)){var z=d.parseCount_32();for(v=0;v<z;++v){var A=g.BodyInstance.parseBinary(c,a,d,b);x.push(A)}}z=null;k.hasBits1(524288)&&(v=d.parseModelKey(e),console.assert(0!==v),z=d.parseInclusionKey(e,v),z={config:b,inclusionKey:z,
modelKey:v});A=null;k.hasBits1(512)&&(v=d.parseModelKey(e),0===v&&(v=f.getMasterModelKey()),A=d.parseDataKey(),A=[v,A]);f=[];if(k.hasBits1(32768))for(e=d.parseCount_32(),v=0;v<e;++v){var C=g.CadView.parseBinary(c,a,d,b);b.ignoreCadViews||f.push(C)}e=[];if(k.hasBits1(65536))for(C=d.parseCount_32(),v=0;v<C;++v){var B=g.Pmi.parseBinary(c,a,d,b);e.push(B)}C=null;k.hasBits1(16384)&&(C=d.parseFloat_64());k.hasBits1(16777216)&&(v=d.parsePoint3_64(),B=d.parsePoint3_64(),c.setViewAxes(v,B));c=[];if(k.hasBits1(134217728))for(B=
d.parseCount_32(),v=0;v<B;++v){var D=g.Layer.parseBinary(d);b.ignoreLayers||c.push(D)}B=[];if(k.hasBits1(268435456))for(D=d.parseCount_32(),v=0;v<D;++v){var F=g.Filter.parseBinary(d);b.ignoreFilters||B.push(F)}D=[];F=[];if(k.hasBits2(256))for(k=d.parseCount_32(),v=0;v<k;++v){var E=g.Relationship.parseBinary(a,d);b.ignoreBimRelationships||D.push(E);if(null!==E.relating&&!b.ignoreBimRelationships&&(!1===g.RelationshipUtils.findBimObjectInArray(F,E.relating.relationElt)&&F.push(E.relating.relationElt),
null!==E.related)){var G=0;for(E=E.related.relationships;G<E.length;G++){var H=E[G];!1===g.RelationshipUtils.findBimObjectInArray(F,H)&&F.push(H)}}}return{nodeInfo:l,productBits:h,childDataKeys:n,prototypeDataKey:w,partDefinition:A,quickAccessPartDefinitionDataId:y,externalModelInfo:z,bodyInstanceInfos:x,cadViewInfos:f,pmiInfos:e,measurementUnit:C,simpleMaterial:null,layerInfos:c,filters:B,relationships:D,bimInfos:F}};b.reifySync=function(c,a,d,e,h,p){console.assert(0===h.childDataKeys.length);console.assert(null===
h.externalModelInfo);var f=g.towardAttachContext(e);c=new b(null,c,a,d,e,p,h);f.attachedInvisibly()&&c.setVisibility(!1);return c};b.reify=function(c,a,d,e,g,p){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(l){switch(l.label){case 0:return f=h.OpenPromise.create(),k=new b(f,c,a,d,e,p,g),[4,f];case 1:return l.sent(),[2,k]}})})};b.createDynamic=function(c,a,e,h,m,p,q,r){void 0===q&&(q=!1);void 0===r&&(r=null);var f=g.towardInclusionContext(a);e={nodeInfo:{nodeId:c.massageAuthoredUserId(f,
h),bits:p?1073741824:0,name:e,localTransform:m,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},productBits:q?268435456:0,childDataKeys:[],prototypeDataKey:null,partDefinition:null,quickAccessPartDefinitionDataId:null,bodyInstanceInfos:[],externalModelInfo:null,cadViewInfos:[],pmiInfos:[],measurementUnit:r,simpleMaterial:null,layerInfos:[],filters:[],relationships:[],bimInfos:[]};h=new d.LoadSubtreeConfig;h.attachInvisibly=
!p;return new b(null,h,null,c,f,a,e)};b.createMissing=function(b,c){b=this.createDynamic(b,c,"Missing",null,null,!1);b._bits|=4096;return b};b.prototype.isMissing=function(){return this._hasBits(4096)};b._amendInfo=function(b,c){if(null!==c.nodeInfo.name)return c;var a=null;h.hasBits(c.productBits,2)?a=b.generateProductName():h.hasBits(c.productBits,4)?a=b.generateGroupName():h.hasBits(c.productBits,32)?a=b.generateDrawingSheetName():h.hasBits(c.productBits,8)&&(a=b.generateDrawingViewName());if(null===
a)return c;b=__assign({},c.nodeInfo,{name:a});return __assign({},c,{nodeInfo:b})};b.prototype._loadExternalModel=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(e){if(g.ExternalModel.isNameInfo(a))return[2,b.attachByExternalModelInfo(a,this,c)];d=this.getAuthoredId();f=g.towardLoadContext(c);return f.handleExternalModel(d,c,a.inclusionKey)?[2,b.attachByExternalModelInfo(a,this,c)]:[2,null]})})};b.prototype._loadAndAttachExternalModel=function(b,
c,a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._loadExternalModel(b,c,a)];case 1:return d=f.sent(),null!==d&&this.addAttachContext(d),[2,d]}})})};b.prototype.loadPendingExternalModels=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,f,e,q,r,t,u,w;return __generator(this,function(k){switch(k.label){case 0:if(!this.hasPendingExternalModels())return[2,[]];c=g.towardInclusionContext(this);a=[];d=0;
for(f=h.TerseArray.toArray(this._pendingExternalModels);d<f.length;d++)e=f[d],q=this._loadAndAttachExternalModel(b,c,e),a.push(q);delete this._pendingExternalModels;r=[];t=0;return[4,Promise.all(a)];case 1:u=k.sent(),k.label=2;case 2:if(!(t<u.length))return[3,4];w=u[t];null!==w&&r.push(w);k.label=3;case 3:return t++,[3,2];case 4:return[2,r]}})})};b.prototype._lazyLoadPartDefinitionByInfo=function(b,c,a,d){b=g.PartDefinition.reify(b,c,d,a);return h.LazyPromise.create(b)};b.prototype._lazyLoadPartDefinitionById=
function(b,c,a,d,e){var f=this,k=b.getAbstractScEngine(),l=g.towardLoadContext(c),n=b.lookupPartDefinitionByDataId(l,a[0],a[1]);if(null!==n)return h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,n];case 1:return b=c.sent(),b.addReferrer(this),[2,b]}})})});n=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var f,l,h,n,m,p,q;return __generator(this,function(r){switch(r.label){case 0:return f=
a[0],l=a[1],[4,b.enqueue(function(){return k.safeGetMetaData(f,l)})];case 1:return h=r.sent(),null!==h?(n=new g.AssemblyData(d,h),m=new g.AssemblyDataParser(n),p=g.PartDefinition.parseBinary(b,m,e),q=g.PartDefinition.reify(b,c,f,p),q.addReferrer(this),[2,q]):[2,g.PartDefinition.createMissing(b)]}})})});b.registerPartDefinitionByDataId(l,a[0],a[1],n);return n};b._loadProductOccurrence=function(c,a,d,e,h,p){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(l){f=
new g.AssemblyDataParser(h);k=b.parseBinary(c,d,e,f);return[2,b.reify(c,a,d,e,k,p)]})})};b.prototype._loadPrototypeContext=function(c,a,d,e,m,p){var f=this,k=g.towardAttachContext(e),l=g.towardLoadContext(k),n=k.getMasterModelKey();k=d.lookupPrototypeByDataId(l,n,m);null===k&&(k=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var f,k,l;return __generator(this,function(h){switch(h.label){case 0:return f=d.getAbstractScEngine(),[4,d.enqueue(function(){return f.safeGetMetaData(n,
m)})];case 1:return k=h.sent(),null!==k?(l=new g.AssemblyData(p,k),[2,b._loadProductOccurrence(c,a,d,e,l,w)]):[2,b.createMissing(d,w)]}})})}),k=new g.SharedPrototypeContext(k),d.registerPrototypeByDataId(l,n,m,k));var w=new g.PrototypeContext(k,e);w.addReferrer(this);return w};b.prototype._loadProductOccurrences=function(c,a,d,e,m,p){return __awaiter(this,void 0,void 0,function(){var f,k,l,n,w,v,y,x,z,A,C;return __generator(this,function(q){switch(q.label){case 0:return f=g.towardAttachContext(e),
l=k=f.getMasterModelKey(),n=d.getAbstractScEngine(),[4,d.enqueue(function(){return n.safeGetMetaDatas(l,m)})];case 1:w=q.sent(),v=[],y=0,q.label=2;case 2:if(!(y<m.length))return[3,9];x=void 0;if(null===w)return[3,6];z=w[y];w[y]=h.emptyBytes;A=new g.AssemblyData(p,z);return[4,b._loadProductOccurrence(c,a,d,e,A,this)];case 3:return x=q.sent(),(C=a.onLoadChildProductOccurrence())?[4,C]:[3,5];case 4:q.sent(),q.label=5;case 5:return[3,7];case 6:x=b.createMissing(d,this),q.label=7;case 7:v.push(x),q.label=
8;case 8:return++y,[3,2];case 9:return[2,v]}})})};b.prototype._loadBodyInstances=function(b,c,a){for(var d=[],f=0;f<a.length;f++){var e=g.BodyInstance.reify(b,c,this,a[f]);d.push(e)}return d};b.prototype._loadCadViews=function(b,c,a){for(var d=[],f=0;f<a.length;f++){var e=g.CadView.reify(b,c,a[f],this);d.push(e);e.markLoaded()}return d};b.prototype._loadPmis=function(b,c,a){for(var d=[],f=0;f<a.length;f++){var e=g.Pmi.reify(b,c,a[f],this);d.push(e)}return d};b.prototype.getParent=function(){return this._parent};
b.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};b.prototype.isAbsoluteRoot=function(){return-2===this._nodeId};b.prototype.getPrototype=function(){return void 0!==this._prototypeContext?this._prototypeContext:null};b.prototype.isAConfigurationNode=function(){return this._hasBits(1)};b.prototype.isADefaultNode=function(){return this._hasBits(16)};b.prototype.isAProductNode=function(){return h.hasBits(this._bits,2)};b.prototype.isAGroupNode=function(){return h.hasBits(this._bits,
4)};b.prototype.isADrawingSheetNode=function(){return h.hasBits(this._bits,32)};b.prototype.isADrawingViewNode=function(){return h.hasBits(this._bits,8)};b.prototype.addProductOccurrence=function(b){console.assert(b.getParent()===this);this._children=h.TerseArray.push(this._children,b);this._itemWasAdded()};b.prototype.addBodyInstance=function(b){console.assert(b.getParent()===this);this._bodyInstances=h.TerseArray.push(this._bodyInstances,b);this._itemWasAdded()};b.prototype.addCadView=function(b){console.assert(b.getParent()===
this);this._cadViews=h.TerseArray.push(this._cadViews,b);this._itemWasAdded()};b.prototype.addPmi=function(b){console.assert(b.getParent()===this);this._pmis=h.TerseArray.push(this._pmis,b);this._itemWasAdded()};b.prototype.addLoadContext=function(b){console.assert(b.getParent()===this);this._childContexts=h.TerseArray.push(this._childContexts,b);this._itemWasAdded()};b.prototype.addAttachContext=function(b){console.assert(b.getParent()===this);this._childContexts=h.TerseArray.push(this._childContexts,
b);this._itemWasAdded()};b.prototype._followPrototypesWhileEmpty=function(){if(void 0===this._prototypeContext||void 0!==this._children||void 0!==this._childContexts)return this;var b=this._prototypeContext.getProductOccurrence();return b.isResolved()?b.getResolved()._followPrototypesWhileEmpty():this};b.prototype.getRawPartDefinition=function(){if(void 0!==this._partDefinition)return this._partDefinition;if(void 0!==this._prototypeContext){var b=this._prototypeContext.getProductOccurrence();if(b.isResolved())return b.getResolved().getRawPartDefinition()}return null};
b.prototype.getPartDefinition=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){b=this.getRawPartDefinition();if(b instanceof h.LazyPromise)return[2,h.Boxed.create(b)];if(b instanceof Promise)return[2,b];d.Util.TypeAssert(b);return[2,null]})})};b.prototype.getPartDefinitionSync=function(){console.assert(this.isLoaded());if(void 0!==this._partDefinition&&this._partDefinition.isResolved())return this._partDefinition.getResolved();if(void 0!==this._prototypeContext){var b=
this._prototypeContext.getProductOccurrence();if(b.isResolved())return b.getResolved().getPartDefinitionSync()}return null};b.prototype.getChildContexts=function(){return h.TerseArray.toArray(this._childContexts)};b.prototype._getChildren=function(){for(var b=h.TerseArray.toArray(this._children),c=0,a=h.TerseArray.toArray(this._childContexts);c<a.length;c++){var d=a[c].getChildren();h.append(b,d)}return b};b.prototype.getChildren=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,
function(c){switch(c.label){case 0:return[4,this._followPrototypesWhileEmpty()];case 1:return b=c.sent(),[2,b._getChildren()]}})})};b.prototype.getChildrenSync=function(){console.assert(this.isLoaded());var b=this.tryGetChildrenSync();if(null===b)throw new d.InternalLogicError;return b};b.prototype.tryGetChildrenSync=function(){var b=this._followPrototypesWhileEmpty();return b instanceof Promise?null:b._getChildren()};b.prototype.forEachChild=function(b){return __awaiter(this,void 0,void 0,function(){var c;
return __generator(this,function(d){switch(d.label){case 0:return[4,this.getChildren()];case 1:return c=d.sent(),[2,a(c,b)]}})})};b.prototype.forEachBodyInstance=function(b){var c=this.getBodyInstances();return a(c,b)};b.prototype.forEachPmi=function(b){var c=this.getPmis();return a(c,b)};b.prototype.forEachCadView=function(b){var c=this.getCadViews();return a(c,b)};b.prototype.hasBodyInstances=function(){return void 0!==this._bodyInstances};b.prototype.getBodyInstances=function(){return h.TerseArray.toArray(this._bodyInstances)};
b.prototype.getCadViews=function(){return h.TerseArray.toArray(this._cadViews)};b.prototype.getPmis=function(){return h.TerseArray.toArray(this._pmis)};b.prototype.setMeasurementUnit=function(b){this._measurementUnit=b};b.prototype.unsetMeasurementUnit=function(){this._measurementUnit=void 0};b.prototype.hasMeasurementUnit=function(){return void 0!==this._measurementUnit};b.prototype.getMeasurementUnit=function(){for(var b=this;null!==b;){if(void 0!==b._measurementUnit)return b._measurementUnit;b=
g.towardProductOccurrence(b._parent)}return 1};b.prototype.getPhysicalProperties=function(c){return __awaiter(this,void 0,void 0,function(){var a,f,e,h,p,q,r,t,u,w,v,y,x,z,A=this;return __generator(this,function(k){switch(k.label){case 0:return a=function(){return __awaiter(A,void 0,void 0,function(){var a,f,e,k,l,h,n,m,p,q,r;return __generator(this,function(t){switch(t.label){case 0:if(!Array.isArray(this._children))return[3,6];a=[];f=0;e=this._children;t.label=1;case 1:if(!(f<e.length))return[3,
5];k=e[f];return[4,g.forcePartDefinition(k)];case 2:return t.sent(),h=(l=a).push,[4,k.getPhysicalProperties(c)];case 3:h.apply(l,[t.sent()]),t.label=4;case 4:return f++,[3,1];case 5:if(!a.some(function(b){return null!==b}))return[2,null];m=n=0;p=d.Point3.zero();q=0;a.forEach(function(b){null!==b&&(q+=1,n+=b.volume,m+=b.surfaceArea,p.add(b.centerOfGravity))});if(0===q)return[2,null];r=d.Point3.scale(p,1/q);return[2,Promise.resolve(new g.PhysicalProperties(m,n,r))];case 6:return this._children instanceof
b?[4,g.forcePartDefinition(this._children)]:[3,8];case 7:return t.sent(),[2,this._children.getPhysicalProperties(c)];case 8:return[2,null]}})})},[4,this.getPartDefinition()];case 1:return f=k.sent(),null===f?[2,c?a():null]:[4,f.value];case 2:e=k.sent();h=e.getRepresentationItems();if(0===h.length)return[2,c?a():null];q=p=0;r=d.Point3.zero();u=t=0;for(w=h;u<w.length;u++)v=w[u],y=v.getPhysicalProperties(),null!==y&&(p+=y.volume,q+=y.surfaceArea,r.add(y.centerOfGravity),t++);0!==t&&r.scale(1/t);x=new g.PhysicalProperties(q,
p,r);return[4,a()];case 3:return z=k.sent(),null!==z?[2,new g.PhysicalProperties(x.surfaceArea+z.surfaceArea,x.volume+z.volume,d.Point3.add(x.centerOfGravity,z.centerOfGravity).scale(.5))]:[2,x]}})})};b.prototype.setPartDefinition=function(b){console.assert(void 0===this._partDefinition);this._partDefinition=h.LazyPromise.create(b)};b.prototype.setPrototype=function(b){console.assert(void 0===this._prototypeContext);this._prototypeContext=b;this._markBranchVisibilityDirty(!1)};b.prototype.removePrototype=
function(){if(void 0===this._prototypeContext)throw new d.InternalLogicError;var b=this._prototypeContext;delete this._prototypeContext;this._markBranchVisibilityDirty(!1);return b};b.prototype.getBranchVisibility=function(){this._updateBranchVisibility();return this._getBranchVisibility()};b.prototype._getBranchVisibility=function(){var b=this.isVisible()?2:1;this._hasBits(65536)&&(b|=2);this._hasBits(131072)&&(b|=1);return b};b.prototype._setBranchVisibility=function(b){this.isVisible()?console.assert(h.hasBits(b,
2)):console.assert(h.hasBits(b,1));this._bits&=-196609;h.hasBits(b,1)&&(this._bits|=131072);h.hasBits(b,2)&&(this._bits|=65536)};b.prototype._updateBranchVisibility=function(){if(this._hasBits(32768)){var b=this.isVisible()?2:1,c=this._getSubBranchVisibilities();null!==c&&(b|=c);this._setBranchVisibility(b);this._bits&=-32769}};b.prototype._getSubBranchVisibilities=function(){for(var b=0,c=0,a=this.getChildrenSync();c<a.length;c++){var d=a[c].getBranchVisibility();b|=d;if(3===b)return 3}d=0;for(c=
this.getBodyInstances();d<c.length;d++)if(a=c[d],!a.isOutOfHierarchy()&&(b|=a.isVisible()?2:1,3===b))return 3;c=0;for(a=this.getPmis();c<a.length;c++)if(d=a[c].getBranchVisibility(),b|=d,3===b)return 3;c=0;for(a=this.getCadViews();c<a.length;c++)if(d=a[c].getBranchVisibility(),b|=d,3===b)return 3;return 0===b?null:b};b.prototype._itemWasAdded=function(){3!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!0)};b.prototype._onItemRemoved=function(){1!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!1)};
b.prototype.markBranchVisibilityDirty=function(){this._markBranchVisibilityDirty(!1)};b.prototype._markBranchVisibilityDirty=function(b){if(!(this._hasBits(32768)||b&&3===this._getBranchVisibility()))if(this._bits|=32768,this._parent instanceof g.PrototypeContext)for(var c=0,a=this._parent.getReferrers();c<a.length;c++)a[c]._markBranchVisibilityDirty(b);else if(c=g.towardProductOccurrence(this._parent),null!==c)return c._markBranchVisibilityDirty(b)};b.prototype.setVisibility=function(b){this.isVisible()!==
b&&(this._setVisibility(b),this._markBranchVisibilityDirty(!1))};b.prototype._removeDirectChild=function(b){var c=h.TerseArray.toArray(this._children),a=c.length;c=c.filter(function(c){return c!==b});if(c.length===a)return!1;0===c.length?delete this._children:this._children=h.TerseArray.fromArray(c);this._onItemRemoved();return!0};b.prototype._removeIndirectChild=function(b){for(var c=!1,a=h.TerseArray.toArray(this._childContexts),d=0,f=a;d<f.length;d++)if(f[d].removeProductOccurrence(b)){c=!0;break}if(!c)return!1;
a=a.filter(function(b){return b.hasChildren()});0===a.length?delete this._childContexts:this._childContexts=h.TerseArray.fromArray(a);this._onItemRemoved();return!0};b.prototype.removeProductOccurrence=function(b){return this._removeDirectChild(b)?!0:this._removeIndirectChild(b)};b.prototype.removePmi=function(b){var c=h.TerseArray.toArray(this._pmis),a=c.length;c=c.filter(function(c){return c!==b});if(c.length===a)return!1;0===c.length?delete this._pmis:this._pmis=h.TerseArray.fromArray(c);this._onItemRemoved();
return!0};b.prototype.removeBodyInstance=function(b){var c=h.TerseArray.toArray(this._bodyInstances),a=c.length;c=c.filter(function(c){return c!==b});if(c.length===a)return!1;0===c.length?delete this._bodyInstances:this._bodyInstances=h.TerseArray.fromArray(c);this._onItemRemoved();return!0};b.prototype.purgeContents=function(){var b=this;this._markBranchVisibilityDirty(!1);var c=[];if(void 0!==this._partDefinition&&!this._partDefinition.isUnforced()){var e=this._partDefinition.then(function(c){c.removeAllReferrers();
delete b._partDefinition});c.push(e)}void 0!==this._prototypeContext&&(e=this._prototypeContext.purgeContents(),c.push(e),this._prototypeContext.removeReferrer(this),delete this._prototypeContext);e=h.TerseArray.toArray(this._children);e=a(e,function(b){return b.purgeContents()});c.push(e);delete this._children;e=h.TerseArray.toArray(this._childContexts);e=a(e,function(b){return b.purgeContents()});c.push(e);delete this._childContexts;delete this._bodyInstances;delete this._cadViews;delete this._pmis;
delete this._measurementUnit;return d.Util.waitForAll(c)};b.prototype.removePartDefinition=function(){if(void 0===this._partDefinition||!this._partDefinition.isResolved())throw new d.InternalLogicError;var b=this._partDefinition;delete this._partDefinition;return b.getResolved()};b.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};b.prototype.markIsExternalModelRoot=function(b){console.assert(!this._hasBits(2048));this._bits|=2048;b.markSeenExternalModel()};b.prototype.isExternalModelRoot=
function(){return this._hasBits(2048)};b.prototype.addPendingExternalModel=function(b){this._pendingExternalModels=h.TerseArray.push(this._pendingExternalModels,b)};b.prototype.hasPendingExternalModels=function(){return!h.TerseArray.isEmpty(this._pendingExternalModels)};return b}(g.NodeMixin);g.ProductOccurrence=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b,c){return void 0!==b&&c<b.length?b[c]:null}function e(b,c,a){void 0===b&&(b=[]);b.length=Math.max(b.length,c+1);b[c]=a;return b}var c;(function(b){b[b.Unknown=0]="Unknown";b[b.BRep=1]="BRep";b[b.Tessellation=2]="Tessellation";b[b.Wireframe=3]="Wireframe";b[b.PointCloud=4]="PointCloud"})(c=g.BodyType||(g.BodyType={}));var b=function(b){function f(c,a,d,f){a=b.call(this,c,a,d.nodeInfo)||this;a._parent=f;a._bodyType=d.bodyType;0<d.faceMeasurementProps.length&&
(a._faceMeasurementProps=d.faceMeasurementProps.slice());0<d.edgeMeasurementProps.length&&(a._edgeMeasurementProps=d.edgeMeasurementProps.slice());null!==d.physicalProps&&(a._physicalProps=d.physicalProps);if(0<d.faceAttributes.length){a._faceAttributes=[];for(var e=0,k=d.faceAttributes;e<k.length;e++)f=k[e],a._faceAttributes.push(null===f?null:f.copy())}if(0<d.edgeAttributes.length)for(a._edgeAttributes=[],e=0,k=d.edgeAttributes;e<k.length;e++)f=k[e],a._edgeAttributes.push(null===f?null:f.copy());
if(0<d.pointAttributes.length)for(a._pointAttributes=[],e=0,d=d.pointAttributes;e<d.length;e++)f=d[e],a._pointAttributes.push(null===f?null:f.copy());c.registerRepresentationItem(a);return a}__extends(f,b);f.parseXml=function(b,a,d){b=g.Node.parseXml(b,a,d);a=g.XmlParser.parseMeshKey(a,"TCKey_Mesh");return{nodeInfo:b,meshKey:a,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[],pointAttributes:[]}};f.parseBinary=function(b,c,a){var f=
c.parseNodeParseBits();b=g.Node.parseBinary(b,c,f,a);a=c.parseBodyType();var e=null;f.hasBits1(8192)&&(e=c.parseMeshKey());var k=[];if(f.hasBits1(2048))for(var l=c.parseCount_32(),h=0;h<l;++h){var n=g.MeasurementProperty.Face.parseBinary(c);k.push(n)}n=[];if(f.hasBits1(4096))for(l=c.parseCount_32(),h=0;h<l;++h){var m=g.MeasurementProperty.Edge.parseBinary(c);n.push(m)}l=null;f.hasBits1(1048576)&&(l=g.PhysicalProperties.parseBinary(c));m=[];if(f.hasBits2(1)){var y=c.parseCount_32();for(h=0;h<y;h++){for(var x=
[],z=c.parseCount_32(),A=0;A<z;A++){var C=g.Attribute.parseBinary(c);C.getType()!==d.AttributeType.Ignored&&x.push(C)}m.push(0<x.length?new d.SubentityAttributes(x):null)}}y=[];if(f.hasBits2(2)){var B=c.parseCount_32();for(h=0;h<B;h++){x=[];z=c.parseCount_32();for(A=0;A<z;A++)C=g.Attribute.parseBinary(c),C.getType()!==d.AttributeType.Ignored&&x.push(C);y.push(0<x.length?new d.SubentityAttributes(x):null)}}B=[];if(f.hasBits2(128))for(f=c.parseCount_32(),h=0;h<f;h++){x=[];z=c.parseCount_32();for(A=
0;A<z;A++)C=g.Attribute.parseBinary(c),C.getType()!==d.AttributeType.Ignored&&x.push(C);B.push(0<x.length?new d.SubentityAttributes(x):null)}return{nodeInfo:b,meshKey:e,bodyType:a,faceMeasurementProps:k,edgeMeasurementProps:n,physicalProps:l,faceAttributes:m,edgeAttributes:y,pointAttributes:B}};f.reify=function(b,c,a,d){return new f(b,c,a,d)};f.createDynamic=function(b,a,d,e,k){var l=k.getInclusionContextForNodeId();a={nodeInfo:{nodeId:b.massageAuthoredUserId(l,a),bits:1073741824,name:d,localTransform:null,
attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},meshKey:null,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[],pointAttributes:[]};return new f(b,e,a,k)};f.prototype.setPhysicalProperties=function(b){this._physicalProps=b};f.prototype.getPhysicalProperties=function(){return void 0!==this._physicalProps?this._physicalProps:null};f.prototype.getParent=
function(){return this._parent};f.prototype.getFaceCount=function(){return void 0!==this._faceMeasurementProps?this._faceMeasurementProps.length:0};f.prototype.getEdgeCount=function(){return void 0!==this._edgeMeasurementProps?this._edgeMeasurementProps.length:0};f.prototype.getFaceAttributes=function(b){return a(this._faceAttributes,b)};f.prototype.getEdgeAttributes=function(b){return a(this._edgeAttributes,b)};f.prototype.getPointAttributes=function(b){return a(this._pointAttributes,b)};f.prototype.getFaceMeasurementProperty=
function(b){return a(this._faceMeasurementProps,b)};f.prototype.getEdgeMeasurementProperty=function(b){return a(this._edgeMeasurementProps,b)};f.prototype.setFaceMeasurementProperty=function(b,c){this._faceMeasurementProps=e(this._faceMeasurementProps,b,c.copy())};f.prototype.setEdgeMeasurementProperty=function(b,c){this._edgeMeasurementProps=e(this._edgeMeasurementProps,b,c.copy())};f.prototype.getBodyType=function(){return this._bodyType};f.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,
this._parent.getInclusionContextForNodeId())};return f}(g.NodeMixin);g.RepresentationItem=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a,d,e){this._type=c;this._valueName=a;this._title=b;this._value=d;this._unit=e}a.parseBinary=function(c){var b=null,d=c.getHeader(),e=0;null!==d&&d.supportsAttributeBits()&&(e=c.parseAttributeParseBits());d=c.parseCString();h.hasBits(e,1)&&(b=c.parseCString());var g=c.parseAttributeType(),n=c.parseCString(),m=[];h.hasBits(e,2)&&(m=c.parseUnits());return new a(g,d,b,n,m)};a.parseXml=function(c){console.assert("Attr"===c.localName);
var b=d.AttributeType.Undefined,f="",e="",g=[],h=c.getAttribute("ValueName"),m=c.getAttribute("Name");if(null!==m&&(f=m,"__PRC_RESERVED_ATTRIBUTE_A3DF_ProductInformation"===f))return new a(b,f,h,e,g);m=c.getAttribute("Type");if(null!==m)switch(m){case "i":b=d.AttributeType.Int;break;case "f":b=d.AttributeType.Float;break;case "t":b=d.AttributeType.Time;break;case "s":b=d.AttributeType.String}c=c.getAttribute("Value");null!==c&&(e=c);return new a(b,f,h,e,g)};a.prototype.getType=function(){return this._type};
a.prototype.getValueName=function(){return this._valueName};a.prototype.getTitle=function(){return this._title};a.prototype.getValue=function(){return this._value};a.prototype.getUnit=function(){return d.Util.getLongUnitString(this._unit)};a.prototype.copy=function(){var c=null;null!==this._valueName&&(c=this._valueName.slice());return new a(this._type,this._title.slice(),c,this._value.slice(),this._unit.slice())};return a}();g.Attribute=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c){this._colorTable=[];this._colorTable=c.slice()}a.parseXml=function(c){console.assert("ColorTable"===c.localName);var b=[];c=c.getAttribute("data");if(null!==c){c=c.split(" ");console.assert(0===c.length%3);for(var f=0;f<c.length;f+=3){var e=parseFloat(c[f]),g=parseFloat(c[f+1]),h=parseFloat(c[f+2]);e=new d.Color(e,g,h);b.push(e)}}return new a(b)};a.prototype.getColor=function(c){if(0<=c&&0===c%3&&(c/=3,c<this._colorTable.length))return this._colorTable[c];console.assert(!1);
return null};return a}();g.ColorTable=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(){function b(){this.isInclusive=!1;this.ids=[]}b.parseBinary=function(c){var a=new b;a.isInclusive=c.parseBoolean();for(var d=c.parseCount_32(),f=0;f<d;f++)a.ids.push(c.parseNodeId());return a};b.parseXml=function(c){var a=new b;a.isInclusive="1"===c.getAttribute("Inclusive");var d=g.XmlParser.parseNodeIds(c,"Ids");null!==d?(a.ids=d,c=c.getAttribute("Count"),null!==c&&(c=parseInt(c,10),console.assert(c===a.ids.length))):console.error("'Entities' tag has missing or malformed 'Ids' attribute");
return a};return b}();g.FilterEntities=a;var e=function(){function b(){this.isInclusive=!1;this.authoredIds=[]}b.parseBinary=function(c){var a=new b;a.isInclusive=c.parseBoolean();for(var d=c.parseCount_32(),f=0;f<d;f++)a.authoredIds.push(c.parseLayerId());return a};b.parseXml=function(c){var a=new b;a.isInclusive="1"===c.getAttribute("Inclusive");var d=g.XmlParser.parseUints(c,"Ids");null!==d?(a.authoredIds=d,c=c.getAttribute("Count"),null!==c&&(c=parseInt(c,10),console.assert(c===a.authoredIds.length))):
console.error("'Layers' tag has missing or malformed 'Ids' attribute");return a};return b}();g.FilterLayers=e;var c=function(){function b(){this.isDisplayfilter=!1;this.name=null;this.isActive=!1;this.entities=this.layers=null}b.parseBinary=function(c){var f=new b,g=null,h=null,m=c.parseLayerParseBits();f.isDisplayfilter=c.parseBoolean();d.hasBits(m,1)&&(f.name=c.parseCString());f.isActive=c.parseBoolean();d.hasBits(m,2)&&(g=e.parseBinary(c));d.hasBits(m,4)&&(h=a.parseBinary(c));f.layers=g;f.entities=
h;return f};b.parseXml=function(c){var d=new b,f=c.getAttribute("Name");null!==f&&(d.name=f);d.isDisplayfilter="1"===c.getAttribute("Display");d.isActive="1"===c.getAttribute("Active");for(f=c.firstElementChild;null!==f;f=f.nextElementSibling)"Layers"===f.localName?(console.assert(null===d.layers),d.layers=e.parseXml(f)):"Entities"===f.localName?(console.assert(null===d.entities),d.entities=a.parseXml(f)):console.error("Unknown tag: "+c.localName);return d};return b}();g.Filter=c})(d.Tree||(d.Tree=
{}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(){function a(c,b,a,d){this.id=c;this.name=b;this.nodes=a;this.treeNodes=d}a.parseBinary=function(c){var b=c.parseLayerParseBits(),a=c.parseLayerId(),e=null;d.hasBits(b,1)&&(e=c.parseCString());return{id:a,name:e}};a.parseXml=function(c){var b=c.getAttribute("Name");c=g.XmlParser.parseUint(c,"Id");return null===c?(console.error("'Layer' tag missing 'Id' attribute"),null):{id:c,name:b}};a.NoLayerId=-1;return a}();g.Layer=a})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a,d,e,g,h,p,q){this._ambientAlpha=c;this._diffuseAlpha=b;this._emissiveAlpha=a;this._specularAlpha=d;this._shininess=e;null!==g&&(this._ambientIndex=g);null!==h&&(this._diffuseIndex=h);null!==p&&(this._emissiveIndex=p);null!==q&&(this._specularIndex=q)}a.parseXml=function(c){console.assert("MaterialTable"===c.localName);var b=g.XmlParser.parseFloat(c,"AmbientAlpha")||0,d=g.XmlParser.parseFloat(c,"DiffuseAlpha")||0,e=g.XmlParser.parseFloat(c,
"EmissiveAlpha")||0,l=g.XmlParser.parseFloat(c,"SpecularAlpha")||0,h=g.XmlParser.parseFloat(c,"Shininess")||0,m=g.XmlParser.parseUint(c,"AmbientIndice"),p=g.XmlParser.parseUint(c,"DiffuseIndice"),q=g.XmlParser.parseUint(c,"EmissiveIndice");c=g.XmlParser.parseUint(c,"SpecularIndice");return new a(b,d,e,l,h,m,p,q,c)};a.prototype.getAmbientColorIndex=function(){return void 0!==this._ambientIndex?this._ambientIndex:null};a.prototype.getDiffuseColorIndex=function(){return void 0!==this._diffuseIndex?this._diffuseIndex:
null};a.prototype.getEmissiveColorIndex=function(){return void 0!==this._emissiveIndex?this._emissiveIndex:null};a.prototype.getSpecularColorIndex=function(){return void 0!==this._specularIndex?this._specularIndex:null};a.prototype.getAmbientAlpha=function(){return this._ambientAlpha};a.prototype.getDiffuseAlpha=function(){return this._diffuseAlpha};a.prototype.getEmissiveAlpha=function(){return this._emissiveAlpha};a.prototype.getSpecularAlpha=function(){return this._specularAlpha};a.prototype.getShininess=
function(){return this._shininess};return a}();g.Material=a;a=function(){function a(c,b){null!==c&&(this._color=c);null!==b&&(this._alpha=b)}a.parseXml=function(c){console.assert("Material"===c.localName);var b=null,f=null;c=c.getAttribute("Color");if(null!==c){var e=c.split(" ");if(4!==e.length)throw new d.XmlParseError('Expected "Color" attribute to have four channel components.');b=parseFloat(e[0]);f=parseFloat(e[1]);c=parseFloat(e[2]);e=parseFloat(e[3]);b=new d.Color(b,f,c);f=e}return new a(b,
f)};a.prototype.getColor=function(){return void 0!==this._color?this._color:null};a.prototype.getAlpha=function(){return void 0!==this._alpha?this._alpha:null};return a}();g.SimpleMaterial=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b,a){this.surfaceArea=c;this.volume=b;this.centerOfGravity=a}a.parseBinary=function(c){var b=c.parseFloat_64(),d=c.parseFloat_64();c=c.parsePoint3_64();return new a(b,d,c)};return a}();d.PhysicalProperties=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b,a,d){this._inclusionKey=c;this._bodyInstanceKey=b;this._topoItemType=a;this._itemIndex=d}a.parseBinary=function(c){var b=c.parseInstanceKey(),a=c.parsePmiTopoRef();c=c.parseIndex_32();return{bodyInstanceKey:b,topoItemType:a,itemIndex:c}};a.reify=function(c,b){c=c.getInclusionKey();return new a(c,b.bodyInstanceKey,b.topoItemType,b.itemIndex)};a.fromBodyInstance=function(c,b,d){c=c.getInstanceInc();return new a(c[0],c[1],b,d)};a.prototype.getBodyInstanceInc=
function(){return[this._inclusionKey,this._bodyInstanceKey]};a.prototype.getTopoItemType=function(){return this._topoItemType};a.prototype.getItemIndex=function(){return this._itemIndex};return a}();d.ReferenceOnTopology=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a;(function(b){b[b.Undefined=0]="Undefined";b[b.Unconnected=1]="Unconnected";b[b.Connected=2]="Connected"})(a=g.BimStatus||(g.BimStatus={}));var e=function(){function c(){this.relationships=[]}c.parseBinary=function(d,f){for(var e=new c,g=f.parseCount_32(),k=0;k<g;k++){var l=f.parseCString(),h=f.parseCString();if(f.parseBoolean()){var n=a.Connected;b.registerBimId(l,d)}else n=a.Unconnected;e.relationships.push({category:n,id:l,name:h})}return e};return c}();
g.RelationshipRelated=e;var c=function(){function c(){this.relationElt={id:"",name:"",category:a.Undefined}}c.parseBinary=function(d,f){var e=new c;e.relationElt.id=f.parseCString();e.relationElt.name=f.parseCString();f.parseBoolean()?(e.relationElt.category=a.Connected,b.registerBimId(e.relationElt.id,d)):e.relationElt.category=a.Unconnected;return e};c.parseXml=function(b){var a=new c;b.getAttribute("Relating");return a};return c}();g.RelationshipRelating=c;var b=function(){function b(){this.type=
d.RelationshipType.Undefined;this.relating=this.related=null}b.registerBimId=function(b,c){var a=c.toRuntimeId(parseInt(b,10));null!==a&&c.addBimIdToMap(b,a)};b.parseBinary=function(a,d){var f=new b,g=d.parseRelationshipParseBits();h.hasBits(g,1)&&(f.type=d.parseCount_32());h.hasBits(g,4)&&(f.relating=c.parseBinary(a,d));h.hasBits(g,2)&&(f.related=e.parseBinary(a,d));return f};b.parseXml=function(c){var a=new b;c=c.getAttribute("Type");null!==c&&(a.type=Number(c));return a};return b}();g.Relationship=
b;var f=function(){function b(){}b.pushRelatedItemFromParser=function(b){var c=[],a=0;for(b=b.relationships;a<b.length;a++){var d=b[a];c.push({category:d.category,id:d.id,name:d.name})}return c};b.addFromRelatingElt=function(b,c){var a=b.related,d=b.type;if(null!==d&&void 0!==d)if(c.has(d)||null===a){if(a=b.related,null!==a)for(b=0,a=a.relationships;b<a.length;b++){var f=a[b],e=c.get(d);void 0!==e&&!1===this.findBimObjectInArray(e.related,{id:f.id,category:f.category,name:f.name})&&e.related.push({id:f.id,
category:f.category,name:f.name})}}else c.set(d,{related:this.pushRelatedItemFromParser(a),relating:[]})};b.findBimObjectInArray=function(b,c){for(var a=0;a<b.length;a++){var d=b[a];if(d.category===c.category&&d.name===c.name&&d.id===c.id)return!0}return!1};b.addFromRelatedElt=function(b,c){var a=b.type;null!==a&&(c.has(a)||null===b.relating||c.set(a,{related:[],relating:[{category:b.relating.relationElt.category,id:b.relating.relationElt.id,name:b.relating.relationElt.name}]}))};b.findIndexInRelated=
function(b,c){for(var a=-1,d=0,f=0;f<c.length;f++){if(c[f].id===b){a=d;break}d++}return a};return b}();g.RelationshipUtils=f})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b){console.assert(null!==c||null!==b);this._materialIndex=c;this._colorIndex=b}a.parseXml=function(c){console.assert("Style"===c.localName);var b=d.XmlParser.parseUint(c,"MaterialIndex");c=d.XmlParser.parseUint(c,"ColorIndex");return new a(b,c)};a.prototype.getMaterialIndex=function(){return this._materialIndex};a.prototype.getColorIndex=function(){return this._colorIndex};return a}();d.Style=a})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(){}a.parseBinary=function(c){return c.parseMatrix()};a.parseXml=function(c){console.assert("Transformation"===c.localName);var b=[];c=c.getAttribute("RelativeTransfo");if(null!==c){c=c.split(" ");console.assert(16===c.length);for(var a=0;16>a;++a){var d=parseFloat(c[a]);console.assert(!isNaN(d));b.push(d)}}return b};a.getIdentity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};a.copy=function(c){return c.slice()};a.isIdentity=
function(c){return 1===c[0]&&0===c[1]&&0===c[2]&&0===c[3]&&0===c[4]&&1===c[5]&&0===c[6]&&0===c[7]&&0===c[8]&&0===c[9]&&1===c[10]&&0===c[11]&&0===c[12]&&0===c[13]&&0===c[14]&&1===c[15]};a.multiply=function(c,b){var d=a.getIdentity();d[0]=c[0]*b[0]+c[1]*b[4]+c[2]*b[8]+c[3]*b[12];d[1]=c[0]*b[1]+c[1]*b[5]+c[2]*b[9]+c[3]*b[13];d[2]=c[0]*b[2]+c[1]*b[6]+c[2]*b[10]+c[3]*b[14];d[3]=c[0]*b[3]+c[1]*b[7]+c[2]*b[11]+c[3]*b[15];d[4]=c[4]*b[0]+c[5]*b[4]+c[6]*b[8]+c[7]*b[12];d[5]=c[4]*b[1]+c[5]*b[5]+c[6]*b[9]+c[7]*
b[13];d[6]=c[4]*b[2]+c[5]*b[6]+c[6]*b[10]+c[7]*b[14];d[7]=c[4]*b[3]+c[5]*b[7]+c[6]*b[11]+c[7]*b[15];d[8]=c[8]*b[0]+c[9]*b[4]+c[10]*b[8]+c[11]*b[12];d[9]=c[8]*b[1]+c[9]*b[5]+c[10]*b[9]+c[11]*b[13];d[10]=c[8]*b[2]+c[9]*b[6]+c[10]*b[10]+c[11]*b[14];d[11]=c[8]*b[3]+c[9]*b[7]+c[10]*b[11]+c[11]*b[15];d[12]=c[12]*b[0]+c[13]*b[4]+c[14]*b[8]+c[15]*b[12];d[13]=c[12]*b[1]+c[13]*b[5]+c[14]*b[9]+c[15]*b[13];d[14]=c[12]*b[2]+c[13]*b[6]+c[14]*b[10]+c[15]*b[14];d[15]=c[12]*b[3]+c[13]*b[7]+c[14]*b[11]+c[15]*b[15];
return d};return a}();d.Transform=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){(function(d){d.getInstanceIncs=function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c].getInstanceInc();d.push(b[0],b[1])}return d};d.getRuntimeIds=function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c].getRuntimeId();d.push(b)}return d}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(){function a(c){this._configuration=c.configuration;this._visibilityFormatter=c.visibilityFormatter;this._resetNonAffectedToDefault=c.resetNonAffectedToDefault;this._state={currentNode:null,nodeConfiguration:null,appliedVisibility:null,inheritedVisibilityStack:[],bodiesToShow:[],bodiesToHide:[]};this.enterProductOccurrence=this.enterProductOccurrence.bind(this);this.leaveProductOccurrence=this.leaveProductOccurrence.bind(this);this.enterAnyBody=
this.enterAnyBody.bind(this);this.leaveAnyBody=this.leaveAnyBody.bind(this);this.enterCadView=this.enterCadView.bind(this);this.leaveCadView=this.leaveCadView.bind(this);this.enterPmi=this.enterPmi.bind(this);this.leavePmi=this.leavePmi.bind(this)}Object.defineProperty(a.prototype,"visibilityFormatter",{get:function(){return this._visibilityFormatter},set:function(c){this._visibilityFormatter=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"currentNode",{get:function(){return this._state.currentNode},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"configuration",{get:function(){return this._configuration},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"nodeConfiguration",{get:function(){return this._state.nodeConfiguration},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"appliedVisibility",{get:function(){return this._state.appliedVisibility},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"state",{get:function(){return this._state},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"result",{get:function(){return{bodies:{hide:this._state.bodiesToHide,show:this._state.bodiesToShow}}},enumerable:!0,configurable:!0});a.prototype._updateNodeVisibility=function(c){this._updateVisitorState(c,!1);var b=this.appliedVisibility;null!==b&&c.setVisibility(b)};a.prototype._getVisibilityConfig=function(){var c=this.currentNode,b=c.isInitiallyShown(),a=b;!this._configuration.initially.shown&&this._configuration.filterByConfiguration&&
(a=a||!this._configuration.containsAnyConfig||this._configuration.containsCurrentConfig);return{explicitVisibility:this._visibilityFormatter?this._visibilityFormatter(c):void 0,visible:c.isVisible(),initiallyShown:b,initiallyOrConfigurationShown:a}};a.prototype._getPmiBodyVisibility=function(){var c=this.currentNode.getParent();return this._visibilityFormatter&&!0===this._visibilityFormatter(c)?!0:null};a.prototype._getInitiallyHiddenNodeVisibility=function(){return this.currentNode instanceof g.PmiBody?
this._getPmiBodyVisibility():null};a.prototype._getInheritedVisibility=function(){var c=d.last(this._state.inheritedVisibilityStack);return c!==this.nodeConfiguration.visible?c&&!this.nodeConfiguration.initiallyShown&&this._configuration.initially.immutableHidden?this._getInitiallyHiddenNodeVisibility():c:null};a.prototype._handleNonAffectedNodeVisibility=function(){return this._resetNonAffectedToDefault&&this.nodeConfiguration.visible!==this.nodeConfiguration.initiallyOrConfigurationShown?this._state.nodeConfiguration.initiallyOrConfigurationShown:
null};a.prototype._getNodeVisibility=function(c){return this.nodeConfiguration&&void 0!==this.nodeConfiguration.explicitVisibility?this.nodeConfiguration.explicitVisibility:g.isOutOfHierarchy(this.currentNode)?null:void 0!==this._configuration.node&&this._configuration.filterByConfiguration&&this._configuration.containsAnyConfig&&!this._configuration.containsCurrentConfig?!1:0<this._state.inheritedVisibilityStack.length?this._getInheritedVisibility():c?null:this._handleNonAffectedNodeVisibility()};
a.prototype._updateVisitorState=function(c,b){this._state.currentNode=c;this._state.nodeConfiguration=this._getVisibilityConfig();void 0!==this._state.nodeConfiguration.explicitVisibility?this._state.inheritedVisibilityStack.push(this._state.nodeConfiguration.explicitVisibility):0<this._state.inheritedVisibilityStack.length&&this._state.inheritedVisibilityStack.push(d.last(this._state.inheritedVisibilityStack));this._state.appliedVisibility=this._getNodeVisibility(b)};a.prototype.leaveNode=function(){0<
this._state.inheritedVisibilityStack.length&&this._state.inheritedVisibilityStack.pop()};a.prototype.enterProductOccurrence=function(c){c.isAConfigurationNode()&&(this._configuration.containsAnyConfig=!0,this._configuration.node===c&&(this._configuration.containsCurrentConfig=!0));this._updateNodeVisibility(c)};a.prototype.leaveProductOccurrence=function(c){this.leaveNode();c.isAConfigurationNode()&&(this._configuration.containsAnyConfig=!1,this._configuration.node===c&&(this._configuration.containsCurrentConfig=
!1))};a.prototype.enterPmi=function(c){this._updateNodeVisibility(c)};a.prototype.leavePmi=function(c){this.leaveNode()};a.prototype.enterCadView=function(c){this._updateNodeVisibility(c)};a.prototype.leaveCadView=function(c){this.leaveNode()};a.prototype.enterAnyBody=function(c){var b=c.preventFromResetting();this._updateVisitorState(c,b);b=this.appliedVisibility;null!==b&&(c.setVisibility(b),b?this._state.bodiesToShow.push(c):this._state.bodiesToHide.push(c))};a.prototype.leaveAnyBody=function(c){return this.leaveNode()};
return a}();g.VisibilityVisitor=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(a){function c(b){b=a.call(this,b)||this;b.enterProductOccurrence=b.enterProductOccurrence.bind(b);return b}__extends(c,a);c.prototype.enterProductOccurrence=function(b){b.isAConfigurationNode()&&(this.configuration.containsAnyConfig=!0,this.configuration.node===b&&(this.configuration.containsCurrentConfig=!0));this._updateVisitorState(b,!0)};return c}(d.VisibilityVisitor);d.BodyVisibilityVisitor=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal=
{}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b){b.markLoaded();var c=0;for(b=b.getRepresentationItems();c<b.length;c++)b[c].markLoaded()}function e(b){b=b.getRawPartDefinition();if(null!==b){if(b instanceof h.LazyPromise)return b.isResolved()?void 0:b.then(a);d.Util.TypeAssert(b);return b.then(function(b){if(null!==b&&(b=b.value,!b.isResolved()))return b.then(a)})}}function c(b){var c=g.forcePrototype(b);return void 0!==c?c.then(function(){return e(b)}):e(b)}g.forcePartDefinition=c;g.forcePartDefinitions=
function(b){return __awaiter(this,void 0,void 0,function(){var a,e;return __generator(this,function(f){switch(f.label){case 0:return a=[],e={enterProductOccurrence:function(b){b=c(b);void 0!==b&&a.push(b)}},[4,g.WalkerAsync.walk(e,b,g.WalkRestriction.None)];case 1:return f.sent(),[2,d.Util.waitForAll(a)]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c){c=c.getPrototype();if(null!==c){var b=c.getProductOccurrence();return(b.isResolved()?e(b.getResolved()):b.then(e)).then(function(){console.assert(b.isResolved());b.getResolved().markLoaded()})}}function e(c){return __awaiter(this,void 0,void 0,function(){var b,f;return __generator(this,function(e){switch(e.label){case 0:return b=[],f={enterProductOccurrence:function(c){c=a(c);void 0!==c&&b.push(c)}},[4,g.WalkerAsync.walk(f,c,g.WalkRestriction.None)];
case 1:return e.sent(),[2,d.Util.waitForAll(b)]}})})}g.forcePrototype=a;g.forcePrototypes=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c,b,a,d,e){var f=[],k=function(b){b.getInclusionContexts().forEach(function(b){f.push(b.getInclusionKey())})};return(c=c.walk({enterProductOccurrence:function(b){d.has(b)||(d.add(b),b.isOutOfHierarchy()&&!a||b.getChildContexts().forEach(function(b){b instanceof g.LoadContext?b.getAttachContexts().forEach(k):k(b)}))}},b,e))?c.then(function(){return f}):f}function e(c,b,d,e){return a(g.WalkerSync,c,b,d,e)}g.gatherInclusionKeysSync=e;g.gatherInclusionKeysFromNodeIdsSync=
function(c,b,a){for(var f=[],l=new Set,h=0;h<b.length;h++){var m=b[h],p=c.lookupAnyTreeNode(m);if(null===p)throw new d.InvalidNodeIdError(m);var q=g.isOutOfHierarchy(p);m=0;for(p=e(p,q,l,a);m<p.length;m++)f.push(p[m])}return f}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c,b,a,e,l,n){var f=[];return(c=c.walk({enterAnyBody:function(b){if(!l.has(b)){l.add(b);if(b instanceof g.BodyInstance){if(!h.hasBits(a,1)||b.isOutOfHierarchy()&&!e)return}else if(b instanceof g.PmiBody){if(!h.hasBits(a,2))return}else if(d.Util.TypeAssert(b),!h.hasBits(a,4))return;b=b.getInstanceInc();f.push(b[0],b[1])}}},b,n))?c.then(function(){return f}):f}function e(c,b,d,e,l){return a(g.WalkerSync,c,b,d,e,l)}g.gatherInstanceIncs=function(c,b,d,
e){return a(g.WalkerAsync,c,b,d,e,g.WalkRestriction.None)};g.gatherInstanceIncsSync=e;g.gatherInstanceIncsByNodeIdsSync=function(c,b,a,k){for(var f=null,h=new Set,m=0;m<b.length;m++){var p=b[m],q=c.lookupAnyTreeNode(p);if(null===q)throw new d.InvalidNodeIdError(p);p=g.isOutOfHierarchy(q);p=e(q,a,p,h,k);if(null===f)f=p;else for(q=0;q<p.length;q++)f.push(p[q])}return null!==f?f:[]}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.gatherParentsOfPendingExternalModels=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:return e=[],c=function(b){b.hasPendingExternalModels()&&e.push(b)},b={enterProductOccurrence:c},[4,d.WalkerAsync.walk(b,a,d.WalkRestriction.None)];case 1:return f.sent(),[2,e]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){g.getBoundingByNodeId=function(a,e,c,b,f,k){return __awaiter(this,void 0,void 0,function(){var l;return __generator(this,function(h){l=g.gatherInstanceIncsByNodeIdsSync(a,c,b,g.WalkRestriction.None);if(0===l.length)throw new d.CommunicatorError("Cannot get the bounding of node without geometry.");return[2,e.getPartsBounding(l,f,k)]})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.getNodeColorMap=function(a,e,c){return __awaiter(this,void 0,void 0,function(){var b,f,g,l,h,m,p,q;return __generator(this,function(k){switch(k.label){case 0:return b=[],f=[],g={enterAnyBody:function(c){c instanceof d.BodyInstance&&!c.isOutOfHierarchy()&&(b.push(c),c=c.getInstanceInc(),f.push(c[0],c[1]))}},[4,d.WalkerAsync.walk(g,a,d.WalkRestriction.None)];case 1:return k.sent(),l=new Map,[4,e.getPartColor(f,c)];case 2:h=k.sent();m=h.length;console.assert(m===
b.length);for(p=0;p<m;++p)q=h[p],null!==q&&l.set(b[p].getRuntimeId(),q);return[2,l]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){g.getVisibilityState=function(a,e){void 0===e&&(e=!1);return __awaiter(this,void 0,void 0,function(){var c,b,f,k,l;return __generator(this,function(h){switch(h.label){case 0:return c=new Set,b=new Set,f=function(b){return e?b.isInitiallyShown():b.isVisible()},k={enterAnyBody:function(a){if(a instanceof g.BodyInstance){var d=a.getRuntimeId();f(a)?c.add(d):b.add(d)}}},[4,g.WalkerAsync.walk(k,a,g.WalkRestriction.None)];case 1:return h.sent(),l=c.size>=b.size,[2,
new d.VisibilityState(l,l?b:c)]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(a,c){var b=function(b){c.push(b)};return g.WalkerAsync.walk({enterProductOccurrence:b,enterAnyBody:b,enterCadView:b,enterPmi:b,enterPartDefinition:b,enterRepresentationItem:b},a,g.WalkRestriction.None)}g.markContextsLoaded=function(e){return __awaiter(this,void 0,void 0,function(){var c,b,f,g,l,h,m,p,q;return __generator(this,function(k){switch(k.label){case 0:c=[];b=[];f=0;for(g=e;f<g.length;f++)l=g[f],h=a(l,b),c.push(h);return[4,d.Util.waitForAll(c)];
case 1:k.sent();m=0;for(p=b;m<p.length;m++)q=p[m],q.markLoaded();return[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.resetTransforms=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:return e=!1,c=function(b){b.hasLocalTransformOverride()&&(b.removeLocalTransformOverride(),e=!0)},b={enterProductOccurrence:c,enterPmi:c,enterCadView:c,enterAnyBody:function(b){b.preventFromResetting()||c(b)}},[4,d.WalkerAsync.walk(b,a,d.WalkRestriction.None)];case 1:return f.sent(),[2,e]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.setMeshLevels=function(a,e,c){var b=[],f=new Set,g=function(b){if(f.has(b))return!1;f.add(b);return!0};g={followProductOccurrence:g,followPmi:g,followCadView:g,followAnyBody:g,enterAnyBody:function(c){c.isOutOfHierarchy()||(c=c.getInstanceInc(),b.push(c[0],c[1]))}};for(var l=0;l<e.length;l++)d.WalkerSync.walk(g,e[l],d.WalkRestriction.None);a.setMeshLevel(b,c)}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){g.updateScMatrices=function(a,e,c,b){return __awaiter(this,void 0,void 0,function(){var f,k,l,n,m,p,q,r,t,u,w,v,y=this;return __generator(this,function(x){switch(x.label){case 0:f=[];k=[];l=[];n=new Set;m=function(b){if(n.has(b))return!1;n.add(b);b=b.getLocalTransform();if(null!==b){var c=h.last(f);c=g.Transform.multiply(b,c);f.push(c)}return!0};p=function(b){null!==b.getLocalTransform()&&(console.assert(1<f.length),f.pop())};q={followProductOccurrence:m,leaveProductOccurrence:p,
followPmi:m,leavePmi:p,followCadView:m,leaveCadView:p,followAnyBody:m,enterAnyBody:function(c){if(!c.isOutOfHierarchy()||b)c=c.getInstanceInc(),l.push(c[0],c[1]),c=d.Matrix.createFromArray(h.last(f)),k.push(c)},leaveAnyBody:p};r=new h.PromiseQueue(1,!0);t=function(b){var c=h.Lazy.create(function(){return __awaiter(y,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return console.assert(0===f.length),c=g.getNetMatrix(b.getParent()),f.push(c),[4,g.WalkerAsync.walk(q,
b,g.WalkRestriction.None)];case 1:return a.sent(),console.assert(1===f.length),f.pop(),[2]}})})});r.push(c)};u=0;for(w=c;u<w.length;u++)v=w[u],t(v);return[4,r.waitForIdle()];case 1:return x.sent(),console.assert(2*k.length===l.length),[4,a.setMatrices(l,k)];case 2:return x.sent(),e.trigger("_updateTransform",b),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c){this._assemblyTree=c.assemblyTree;this._engine=c.engine;this._callbackManager=c.callbackManager;this._startNode=c.startNode;this._setVisibility=c.setVisibility;this._initiallyHiddenStayHidden=c.initiallyHiddenStayHidden;this._configurationNode=c.configurationNode;this._configuration=null}a.getAttachContextFormatter=function(c,b){return function(a){if(a instanceof d.ProductOccurrence&&-1!==c.getChildren().indexOf(a))switch(b){case 0:return console.assert(1!==
b),!1;case 1:return!0;case 2:console.assert(2===b),console.assert(1!==b)}}};Object.defineProperty(a.prototype,"configuration",{get:function(){return this._configuration},enumerable:!0,configurable:!0});a.prototype._generateConfig=function(){return __awaiter(this,void 0,void 0,function(){var c,b,a,e,g,h,m;return __generator(this,function(f){switch(f.label){case 0:e=a=b=c=!1;if(!this._configurationNode)return[3,2];console.assert(this._configurationNode.isAConfigurationNode());c=!0;return[4,d.getVisibilityState(this._configurationNode,
!0)];case 1:g=f.sent();if(g.defaultVisibility||0!==g.visibilityExceptions.size)e=!0;if(!(this._startNode instanceof d.AttachContext))for(h=this._startNode;null!==h;){if(h instanceof d.ProductOccurrence&&h.isAConfigurationNode()){a=!0;h===this._configurationNode&&(b=!0);break}m=h.getParent();if(!(m instanceof d.ProductOccurrence))break;h=m}f.label=2;case 2:return void 0===this._initiallyHiddenStayHidden&&(this._initiallyHiddenStayHidden=void 0!==this._configurationNode?e:this._assemblyTree.getInitiallyHiddenStayHidden()),
[2,{filterByConfiguration:c,containsCurrentConfig:b,containsAnyConfig:a,node:this._configurationNode,setVisibility:this._setVisibility,initially:{shown:e,immutableHidden:this._initiallyHiddenStayHidden}}]}})})};a.prototype._applyVisibilities=function(c){if(this._setVisibility)c=this._startNode.getAttachScope(),console.assert(0!==c),this._engine.setVisibilityByAttachment(c,this._setVisibility);else{var b=d.getInstanceIncs(c.show),a=d.getInstanceIncs(c.hide);this._engine.pauseRendering();this._engine.setPartVisibility(b,
!0,!0);this._engine.setPartVisibility(a,!1,!0);this._engine.resumeRendering();this._callbackManager&&(b=d.getRuntimeIds(c.show),c=d.getRuntimeIds(c.hide),this._callbackManager.trigger("visibilityChanged",b,c))}};a.prototype.traverse=function(c,b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,d.WalkerAsync.walk(c,b?b:this._startNode,d.WalkRestriction.None)];case 1:return a.sent(),[2]}})})};a.prototype.init=function(){return __awaiter(this,
void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return this._startNode instanceof d.AttachContext||console.assert(void 0===this._setVisibility),c=this,[4,this._generateConfig()];case 1:return c._configuration=b.sent(),[2]}})})};a.prototype.quit=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2]})})};a.prototype.update=function(c,b){for(var a=[],d=2;d<arguments.length;d++)a[d-2]=arguments[d];return __awaiter(this,
void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return d=new (c.bind.apply(c,[void 0,__assign({},b,{configuration:this.configuration})].concat(a))),[4,this.traverse(d)];case 1:return f.sent(),this._applyVisibilities(d.result.bodies),[2,d]}})})};a.prototype.updatePerNode=function(c,b,a){for(var d=[],f=3;f<arguments.length;f++)d[f-3]=arguments[f];return __awaiter(this,void 0,void 0,function(){var f,e=this;return __generator(this,function(g){f=new (c.bind.apply(c,
[void 0,__assign({},a,{configuration:this.configuration})].concat(d)));b.forEach(function(b,c){return __awaiter(e,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return a=f.visibilityFormatter,f.visibilityFormatter=function(c){return c===c?b:a?a(c):void 0},[4,this.traverse(f,c)];case 1:return d.sent(),f.visibilityFormatter=a,[2]}})})});this._applyVisibilities(f.result.bodies);return[2,f]})})};return a}();d.VisibilityUpdater=a})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){function a(a){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];return __awaiter(this,void 0,void 0,function(){var b,e;return __generator(this,function(f){switch(f.label){case 0:return b=new d.VisibilityUpdater({assemblyTree:a.assemblyTree,engine:a.engine,callbackManager:a.callbackManager,startNode:a.startNode,setVisibility:null!==a.setVisibility?a.setVisibility:void 0,initiallyHiddenStayHidden:a.initiallyHiddenStayHidden,configurationNode:a.configurationNode}),
[4,b.init()];case 1:return f.sent(),[4,b.update.apply(b,[a.visitorType||d.VisibilityVisitor,{visibilityFormatter:a.visibilityFormatter,resetNonAffectedToDefault:a.resetNonAffectedToDefault}].concat(c))];case 2:return e=f.sent(),console.assert(0===e.state.inheritedVisibilityStack.length),[4,b.quit()];case 3:return f.sent(),[2]}})})}d.updateVisibilitiesByAttachment=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,a(__assign({},e,{startNode:e.attachContext,
visibilityFormatter:d.VisibilityUpdater.getAttachContextFormatter(e.attachContext,e.setVisibility),resetNonAffectedToDefault:2===e.setVisibility,initiallyHiddenStayHidden:1!==e.setVisibility}))]})})};d.updateBodyNodesVisibilitiesByAttachment=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,a(__assign({},e,{startNode:e.attachContext,visibilityFormatter:d.VisibilityUpdater.getAttachContextFormatter(e.attachContext,e.setVisibility),resetNonAffectedToDefault:2===
e.setVisibility,initiallyHiddenStayHidden:1!==e.setVisibility,visitorType:d.BodyVisibilityVisitor}))]})})};d.updateVisibilities=function(d){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,a(d)]})})};d.updateBodyNodesVisibilities=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,a(__assign({},e,{visitorType:d.BodyVisibilityVisitor}))]})})};d.synchronizePmiVisibilities=function(a,c){return __awaiter(this,
void 0,void 0,function(){var b,f,e,g,h;return __generator(this,function(k){switch(k.label){case 0:return b=[],f=[],e={enterAnyBody:function(c){if(c instanceof d.PmiBody||c instanceof d.ViewFrame){var a=c.isVisible();c.setVisibility(a);a?b.push(c):f.push(c)}}},[4,d.WalkerAsync.walk(e,c,d.WalkRestriction.None)];case 1:return k.sent(),g=d.getInstanceIncs(b),h=d.getInstanceIncs(f),a.pauseRendering(),a.synchronizeVisibilities(g,!0),a.synchronizeVisibilities(h,!1),a.resumeRendering(),[2]}})})}})(d.Tree||
(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b){this._visitor=new g.TotalVisitor(c,b)}a.walk=function(c,b,f){if(f===g.WalkRestriction.LoadedNodesOnly&&!b.isLoaded())return Promise.resolve();var e=new a(c,f);if(b instanceof g.NodeMixin)return e._walkAnyTreeNode(b);var l=new d.Util.ActionQueue(1,!1);c=function(b){l.push(function(){return e._walkAnyTreeNode(b)})};f=0;for(b=b.getChildren();f<b.length;f++)c(b[f]);return l.waitForIdle()};a.forceLazyPromises=function(c){return this.walk({},
c,g.WalkRestriction.None)};a.prototype._walkAnyTreeNode=function(c){c instanceof g.ProductOccurrence?c=this._walkProductOccurrence(c):c instanceof g.Pmi?c=this._walkPmi(c):c instanceof g.CadView?c=this._walkCadView(c):(d.Util.TypeAssert(c),c=this._walkAnyBody(c));return void 0===c?Promise.resolve():c};a.prototype._walkRepresentationItem=function(c){this._visitor.followRepresentationItem(c)&&(this._visitor.enterRepresentationItem(c),this._visitor.leaveRepresentationItem(c))};a.prototype._walkPartDefinition=
function(c){if(this._visitor.followPartDefinition(c)){this._visitor.enterPartDefinition(c);for(var b=0,a=c.getRepresentationItems();b<a.length;b++)this._walkRepresentationItem(a[b]);this._visitor.leavePartDefinition(c)}};a.prototype._walkAnyBody=function(c){this._visitor.followAnyBody(c)&&(this._visitor.enterAnyBody(c),this._visitor.leaveAnyBody(c))};a.prototype._walkPmi=function(c){if(this._visitor.followPmi(c)){this._visitor.enterPmi(c);for(var b=0,a=c.getPmiBodies();b<a.length;b++)this._walkAnyBody(a[b]);
this._visitor.leavePmi(c)}};a.prototype._walkCadView=function(c){if(this._visitor.followCadView(c)){this._visitor.enterCadView(c);var b=c.getViewFrame();null!==b&&this._walkAnyBody(b);this._visitor.leaveCadView(c)}};a.prototype._walkProductOccurrence=function(c){var b=this,a=new d.Util.ActionQueue(1,!1);if(this._visitor.followProductOccurrence(c)){this._visitor.enterProductOccurrence(c);var e=c.getRawPartDefinition();null!==e&&(e instanceof h.LazyPromise?a.push(function(){if(e.isResolved())return b._walkPartDefinition(e.getResolved())}):
(d.Util.TypeAssert(e),a.push(function(){return e.then(function(c){return null!==c&&(c=c.value,c.isResolved())?b._walkPartDefinition(c.getResolved()):Promise.resolve()})})));var g=c.tryGetChildrenSync();if(null!==g)for(var n=function(c){a.push(function(){return b._walkProductOccurrence(c)})},m=0;m<g.length;m++)n(g[m]);else a.push(function(){return c.getChildren().then(function(c){if(0!==c.length){for(var a=new d.Util.ActionQueue(1,!1),f=function(c){a.push(function(){return b._walkProductOccurrence(c)})},
e=0;e<c.length;e++)f(c[e]);if(!a.isIdle())return a.waitForIdle()}})});g=function(c){a.push(function(){return b._walkAnyBody(c)})};n=0;for(m=c.getBodyInstances();n<m.length;n++)g(m[n]);g=function(c){a.push(function(){return b._walkPmi(c)})};n=0;for(m=c.getPmis();n<m.length;n++)g(m[n]);g=function(c){a.push(function(){return b._walkCadView(c)})};n=0;for(m=c.getCadViews();n<m.length;n++)g(m[n]);a.push(function(){return b._visitor.leaveProductOccurrence(c)})}if(!a.isIdle())return a.waitForIdle()};return a}();
g.WalkerAsync=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b){return b.isLoaded()}function e(){return!0}var c;(function(b){b[b.None=0]="None";b[b.LoadedNodesOnly=1]="LoadedNodesOnly"})(c=g.WalkRestriction||(g.WalkRestriction={}));var b=function(){return function(b,g){this.followProductOccurrence=e;this.leaveProductOccurrence=this.enterProductOccurrence=h.nop;this.followPartDefinition=e;this.leavePartDefinition=this.enterPartDefinition=h.nop;this.followRepresentationItem=e;this.leaveRepresentationItem=this.enterRepresentationItem=
h.nop;this.followAnyBody=e;this.leaveAnyBody=this.enterAnyBody=h.nop;this.followCadView=e;this.leaveCadView=this.enterCadView=h.nop;this.followPmi=e;this.leavePmi=this.enterPmi=h.nop;g===c.LoadedNodesOnly?(console.assert(void 0===b.followProductOccurrence),console.assert(void 0===b.followAnyBody),console.assert(void 0===b.followCadView),console.assert(void 0===b.followPmi),this.followPmi=this.followCadView=this.followAnyBody=this.followProductOccurrence=a):d.Util.TypeAssert(g);void 0!==b.followProductOccurrence&&
(this.followProductOccurrence=b.followProductOccurrence);void 0!==b.enterProductOccurrence&&(this.enterProductOccurrence=b.enterProductOccurrence);void 0!==b.leaveProductOccurrence&&(this.leaveProductOccurrence=b.leaveProductOccurrence);void 0!==b.followPartDefinition&&(this.followPartDefinition=b.followPartDefinition);void 0!==b.enterPartDefinition&&(this.enterPartDefinition=b.enterPartDefinition);void 0!==b.leavePartDefinition&&(this.leavePartDefinition=b.leavePartDefinition);void 0!==b.followRepresentationItem&&
(this.followRepresentationItem=b.followRepresentationItem);void 0!==b.enterRepresentationItem&&(this.enterRepresentationItem=b.enterRepresentationItem);void 0!==b.leaveRepresentationItem&&(this.leaveRepresentationItem=b.leaveRepresentationItem);void 0!==b.followAnyBody&&(this.followAnyBody=b.followAnyBody);void 0!==b.enterAnyBody&&(this.enterAnyBody=b.enterAnyBody);void 0!==b.leaveAnyBody&&(this.leaveAnyBody=b.leaveAnyBody);void 0!==b.followCadView&&(this.followCadView=b.followCadView);void 0!==b.enterCadView&&
(this.enterCadView=b.enterCadView);void 0!==b.leaveCadView&&(this.leaveCadView=b.leaveCadView);void 0!==b.followPmi&&(this.followPmi=b.followPmi);void 0!==b.enterPmi&&(this.enterPmi=b.enterPmi);void 0!==b.leavePmi&&(this.leavePmi=b.leavePmi)}}();g.TotalVisitor=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b){this._visitor=new d.TotalVisitor(c,b)}a.walk=function(c,b,f){if(f!==d.WalkRestriction.LoadedNodesOnly||b.isLoaded())return c=new a(c,f),b instanceof d.ProductOccurrence?c._walkProductOccurrence(b):b instanceof d.Pmi?c._walkPmi(b):b instanceof d.CadView?c._walkCadView(b):c._walkAnyBody(b)};a.prototype._walkRepresentationItem=function(c){console.assert(c.isLoaded());this._visitor.followRepresentationItem(c)&&(this._visitor.enterRepresentationItem(c),
this._visitor.leaveRepresentationItem(c))};a.prototype._walkPartDefinition=function(c){console.assert(c.isLoaded());if(this._visitor.followPartDefinition(c)){this._visitor.enterPartDefinition(c);for(var b=0,a=c.getRepresentationItems();b<a.length;b++)this._walkRepresentationItem(a[b]);this._visitor.leavePartDefinition(c)}};a.prototype._walkAnyBody=function(c){console.assert(c.isLoaded());this._visitor.followAnyBody(c)&&(this._visitor.enterAnyBody(c),this._visitor.leaveAnyBody(c))};a.prototype._walkPmi=
function(c){console.assert(c.isLoaded());if(this._visitor.followPmi(c)){this._visitor.enterPmi(c);for(var b=0,a=c.getPmiBodies();b<a.length;b++)this._walkAnyBody(a[b]);this._visitor.leavePmi(c)}};a.prototype._walkCadView=function(c){console.assert(c.isLoaded());if(this._visitor.followCadView(c)){this._visitor.enterCadView(c);var b=c.getViewFrame();null!==b&&this._walkAnyBody(b);this._visitor.leaveCadView(c)}};a.prototype._walkProductOccurrence=function(c){console.assert(c.isLoaded());if(this._visitor.followProductOccurrence(c)){this._visitor.enterProductOccurrence(c);
var b=c.getPartDefinitionSync();null!==b&&this._walkPartDefinition(b);b=0;for(var a=c.getChildrenSync();b<a.length;b++)this._walkProductOccurrence(a[b]);b=0;for(a=c.getBodyInstances();b<a.length;b++)this._walkAnyBody(a[b]);b=0;for(a=c.getPmis();b<a.length;b++)this._walkPmi(a[b]);b=0;for(a=c.getCadViews();b<a.length;b++)this._walkCadView(a[b]);this._visitor.leaveProductOccurrence(c)}};return a}();d.WalkerSync=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){this.plane=new d.Plane;this.instanceNodeId=this.meshId=this.referenceGeometry=null;this.color=d.Color.createFromFloat(.65,.65,.65);this.lineColor=d.Color.black();this.opacity=.35;this.matrix=new d.Matrix}a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=function(){return{plane:{normal:this.plane.normal,d:this.plane.d},referenceGeometry:this.referenceGeometry}};a.prototype.forJson=function(){return this.toJson()};a.prototype.fromJson=
function(a){a=h.deepClone(a);var c=a.plane;this.plane=new d.Plane;var b=c.normal;this.plane.normal=new d.Point3(b.x,b.y,b.z);this.plane.d=c.d;a=a.referenceGeometry;if(Array.isArray(a))for(c=0;c<a.length;++c)a[c]=d.Point3.fromJson(a[c]);this.referenceGeometry=a};a.prototype.getMatrix=function(){return this.matrix.copy()};a.prototype.setMatrix=function(a){this.matrix=a.copy()};a.prototype.setReferenceGeometry=function(a){if(a){this.referenceGeometry=[];for(var c=0;c<a.length;c++)this.referenceGeometry.push(a[c].copy())}else this.referenceGeometry=
null};a.prototype.getReferenceGeometry=function(){if(this.referenceGeometry){for(var a=[],c=0,b=this.referenceGeometry;c<b.length;c++)a.push(b[c].copy());return a}return null};a.prototype.createMeshData=function(){var a=this.referenceGeometry;if(null===a)return null;var c=new d.MeshData,b=[],f=[];b.push(a[0].x,a[0].y,a[0].z);b.push(a[1].x,a[1].y,a[1].z);b.push(a[3].x,a[3].y,a[3].z);b.push(a[1].x,a[1].y,a[1].z);b.push(a[2].x,a[2].y,a[2].z);b.push(a[3].x,a[3].y,a[3].z);for(var g=d.Plane.createFromPoints(a[0],
a[1],a[2]).normal,l=0;6>l;l++)f.push(g.x,g.y,g.z);c.addFaces(b,f);c.addPolyline([a[0].x,a[0].y,a[0].z,a[1].x,a[1].y,a[1].z]);c.addPolyline([a[1].x,a[1].y,a[1].z,a[2].x,a[2].y,a[2].z]);c.addPolyline([a[2].x,a[2].y,a[2].z,a[3].x,a[3].y,a[3].z]);c.addPolyline([a[3].x,a[3].y,a[3].z,a[0].x,a[0].y,a[0].z]);return c};return a}();h.CuttingPlane=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,d,c,b,f){this._cuttingPlanes=[];this._isActive=!1;this._viewer=a;this._model=d;this._callbackManager=c;this._cuttingManager=b;this._engine=f}g.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","CuttingSection",d);return b.apply(this,c)};return c};g.prototype.addPlane=function(a,e){void 0===e&&(e=null);return __awaiter(this,void 0,void 0,function(){var c,
b;return __generator(this,function(f){switch(f.label){case 0:c=this._engine.getCuttingSectionLimits();if(this._cuttingPlanes.length>=c.maxCuttingPlanesPerSection)return[2,!1];b=new d.Internal.CuttingPlane;b.plane=a.copy();b.setReferenceGeometry(e);this._cuttingPlanes.push(b);return this._isActive?[4,this._resetCuttingPlane(b)]:[2,!0];case 1:return f.sent(),[4,this._engine.updateCuttingSection(this)];case 2:return f.sent(),[2,!0]}})})};g.prototype.setPlane=function(a,d,c){void 0===c&&(c=null);return __awaiter(this,
void 0,void 0,function(){var b;return __generator(this,function(f){switch(f.label){case 0:b=this._cuttingPlanes[a];if(void 0===b)return[3,2];b.plane=d.copy();b.setReferenceGeometry(c);return this._isActive?[4,this._resetCuttingPlane(b)]:[3,2];case 1:return f.sent(),[2,this._engine.updateCuttingSection(this)];case 2:return[2]}})})};g.prototype.updatePlane=function(a,e,c,b,f){void 0===c&&(c=new d.Matrix);void 0===b&&(b=!1);void 0===f&&(f=!1);return __awaiter(this,void 0,void 0,function(){var g,l,h;
return __generator(this,function(k){switch(k.label){case 0:g=this._cuttingPlanes[a];if(void 0===g)return[3,3];g.plane=e.copy();if(!this._isActive)return[3,3];if(null===g.instanceNodeId)return[3,2];this._engine.pauseRendering();l=g.getMatrix();f&&(l=new d.Matrix);h=d.Matrix.multiply(l,c);b&&g.setMatrix(h);return[4,Promise.all([this._model.setNodeMatrix(g.instanceNodeId,h),this._engine.updateCuttingSection(this)])];case 1:return k.sent(),this._engine.resumeRendering(),[3,3];case 2:return[2,this._engine.updateCuttingSection(this)];
case 3:return[2]}})})};g.prototype.removePlane=function(a){var e=[],c=this._cuttingPlanes[a];void 0!==c&&(null!==c.meshId&&null!==c.instanceNodeId&&e.push(this._destroyMeshes([c.meshId],[c.instanceNodeId])),this._cuttingPlanes.splice(a,1));this._isActive&&e.push(this._engine.updateCuttingSection(this));return d.Util.waitForAll(e)};g.prototype.getPlane=function(a){a=this._cuttingPlanes[a];return void 0!==a?a.plane.copy():null};g.prototype.getNodeId=function(a){a=this._cuttingPlanes[a];return void 0!==
a?a.instanceNodeId:null};g.prototype.getReferenceGeometry=function(a){a=this._cuttingPlanes[a];return void 0!==a?a.getReferenceGeometry():null};g.prototype.getPlaneIndexByNodeId=function(a){for(var d=0;d<this._cuttingPlanes.length;d++)if(this._cuttingPlanes[d].instanceNodeId===a)return d;return null};g.prototype.getPlaneOpacity=function(a){if(a=this._cuttingPlanes[a])return a.opacity};g.prototype.setPlaneOpacity=function(a,d){this.applyPlaneOpacity(a,d)};g.prototype.applyPlaneOpacity=function(a,d){a=
this._cuttingPlanes[a];void 0!==a&&(d&&(a.opacity=d),null!==a.instanceNodeId&&this._model.setNodesOpacity([a.instanceNodeId],a.opacity))};g.prototype.resetPlanesOpacity=function(){var a=this;this._cuttingPlanes.forEach(function(d,c){a.applyPlaneOpacity(c)})};g.prototype.setPlaneTransparency=function(a,d){this.setPlaneOpacity(a,d);return Promise.resolve()};g.prototype.setItemTransparency=function(a,d){this.setPlaneOpacity(a,d);return Promise.resolve()};g.prototype.setColor=function(a){for(var d=[],
c=0,b=this._cuttingPlanes;c<b.length;c++){var f=b[c];f.color.assign(a);null!==f.instanceNodeId&&d.push(f.instanceNodeId)}this._model.setNodesFaceColor(d,a);return Promise.resolve()};g.prototype.setOpacity=function(a){for(var d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var f=b[c];f.opacity=a;null!==f.instanceNodeId&&d.push(f.instanceNodeId)}this._model.setNodesOpacity(d,a)};g.prototype.setTransparency=function(a){this.setOpacity(a);return Promise.resolve()};g.prototype.getCount=function(){return this._cuttingPlanes.length};
g.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.deactivate()];case 1:return a.sent(),this._cuttingPlanes.length=0,[2]}})})};g.prototype.activate=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b,f;return __generator(this,function(g){switch(g.label){case 0:if(this._isActive)return[2];this._isActive=!0;if(!(0<this._cuttingPlanes.length))return[3,2];this._cuttingManager.hasActiveCuttingSection()||
this._engine.setDefaultDepthRange(0,.9999995231628418);a=[];e=[];c=0;for(b=this._cuttingPlanes;c<b.length;c++)f=b[c],a.push(this._createCuttingPlaneGeometry(f).then(function(b){null!==b&&e.push(b)}));return[4,d.Util.waitForAll(a)];case 1:g.sent(),this._initCuttingPlanesByNodeId(e),g.label=2;case 2:return[2,this._engine.addCuttingSection(this)]}})})};g.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(e){return this._isActive?(this._isActive=
!1,a=[],a.push(this._destroyGeometry()),a.push(this._engine.removeCuttingSection(this)),this._cuttingManager.hasActiveCuttingSection()||this._engine.setDefaultDepthRange(0,1),[2,d.Util.waitForAll(a)]):[2]})})};g.prototype.isActive=function(){return this._isActive};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){for(var a=[],d=0;d<this._cuttingPlanes.length;d++)a[d]=this._cuttingPlanes[d].toJson();return{planes:a}};g.prototype.forJson=function(){return this.toJson()};
g.prototype.fromJson=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,g,l;return __generator(this,function(k){switch(k.label){case 0:return[4,this.clear()];case 1:k.sent();e=d.Internal.deepClone(a);c=e.planes;b=0;for(f=c;b<f.length;b++)g=f[b],l=new d.Internal.CuttingPlane,l.fromJson(g),this._cuttingPlanes.push(l);return[2,this.activate()]}})})};g.prototype._initCuttingPlanesByNodeId=function(a){this._model.setInstanceModifier(d.InstanceModifier.DoNotCut,a,!0);this._model.setInstanceModifier(d.InstanceModifier.DoNotExplode,
a,!0);this._cuttingManager.getStandinGeometryPickable()||this._model.setInstanceModifier(d.InstanceModifier.DoNotSelect,a,!0)};g.prototype._destroyGeometry=function(){for(var a=[],d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var f=b[c];null!==f.meshId&&a.push(f.meshId);null!==f.instanceNodeId&&d.push(f.instanceNodeId);f.meshId=null;f.instanceNodeId=null}return this._destroyMeshes(a,d)};g.prototype._getInstanceNodeIds=function(){for(var a=[],d=0,c=this._cuttingPlanes;d<c.length;d++){var b=c[d].instanceNodeId;
null!==b&&a.push(b)}return a};g.prototype._resetCuttingPlane=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null===a.meshId||null===a.instanceNodeId)return[3,2];d=this._destroyMeshes([a.meshId],[a.instanceNodeId]);a.meshId=null;a.instanceNodeId=null;return[4,d];case 1:return c.sent(),[2,this._createInstanceGeometry(a)];case 2:if(null!==a.referenceGeometry)return[2,this._createInstanceGeometry(a)];c.label=3;case 3:return[2]}})})};
g.prototype._createInstanceGeometry=function(a){return __awaiter(this,void 0,void 0,function(){var d,c;return __generator(this,function(b){switch(b.label){case 0:return d=[],[4,this._createCuttingPlaneGeometry(a)];case 1:return c=b.sent(),null!==c&&d.push(c),this._initCuttingPlanesByNodeId(d),[2]}})})};g.prototype._destroyMeshes=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f,g;return __generator(this,function(k){switch(k.label){case 0:return c=[],c.push(this._model.deleteMeshInstances(e)),
c.push(this._model.deleteMeshes(a)),[4,d.Util.waitForAll(c)];case 1:k.sent();b=0;for(f=e;b<f.length;b++)g=f[b],this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.delete(g);return[2]}})})};g.prototype._createCuttingPlaneGeometry=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,g,l,h,m;return __generator(this,function(k){switch(k.label){case 0:e=a.createMeshData();if(null===e)return[2,null];e.setBackfacesEnabled(!0);return[4,this._model.createMesh(e)];case 1:return c=
k.sent(),a.meshId=c,b=d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotXRay,f=a.plane.copy(),g=f.normal.copy().scale(-f.d),l=(new d.Matrix).setTranslationComponent(g.x,g.y,g.z),a.setMatrix(l.copy()),h=new d.MeshInstanceData(c,l,null,a.color,null,null,b),h.setLineColor(a.lineColor),this._engine.pauseRendering(),[4,this._model.createMeshInstance(h,void 0,!0,!0)];case 2:return m=k.sent(),a.instanceNodeId=m,this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.add(m),
this._model.setDepthRange([m],4.76837158203125E-7,1),this._model.setNodesOpacity([m],a.opacity),this._engine.resumeRendering(),[2,m]}})})};__decorate([g.deprecated],g.prototype,"setPlaneTransparency",null);__decorate([g.deprecated],g.prototype,"setItemTransparency",null);__decorate([g.deprecated],g.prototype,"setTransparency",null);__decorate([g.deprecated],g.prototype,"forJson",null);return g}();d.CuttingSection=h})(Communicator||(Communicator={}));
(function(d){(function(d){function g(a,d){for(var c=0;c<d.length;c++)a.push(d[c])}d.emptyBytes=new Uint8Array(0);d.copyArray=function(a){return a.slice()};d.append=function(a,d){for(var c=0;c<d.length;c++)a.push(d[c])};d.last=function(a){console.assert(0<a.length);return a[a.length-1]};d.all=function(a){for(var d=0;d<a.length;d++)if(!a[d])return!1;return!0};d.chunkify=function(a,d){for(var c=[],b=0;b<a.length;b+=d)c.push(a.slice(b,b+d));return c};d.mapInPlace=function(a,d){for(var c=0;c<a.length;++c)a[c]=
d(a[c]);return a};d.concatInPlace=g;d.concatAll=function(a){for(var d=[],c=0;c<a.length;c++)g(d,a[c]);return d}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.filterInPlace=function(d,a){for(var e=0,c=0;c<d.length;++c){var b=d[c];a(b)&&(d[e++]=b)}d.length=e}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._leftToRight=new Map;this._rightToLeft=new Map}a.prototype.set=function(a,c){this._leftToRight.set(a,c);this._rightToLeft.set(c,a)};a.prototype.getLeft=function(a){return this._rightToLeft.get(a)};a.prototype.getRight=function(a){return this._leftToRight.get(a)};return a}();d.Bimap=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this.value=a}a.create=function(d){return new a(d)};return a}();d.Boxed=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._stopTime=this._currentTime=0}a.prototype.stop=function(){this._stopTime=this._currentTime};a.prototype.isTicking=function(){this._refreshCurrentTime();return 0<this._remainingDuration()};a.prototype.tickFor=function(a){this._refreshCurrentTime();this._remainingDuration()>=a||(this._stopTime=this._currentTime+a)};a.prototype._remainingDuration=function(){return this._stopTime-this._currentTime};a.prototype._refreshCurrentTime=function(){this._currentTime=
Date.now()};return a}();d.Clock=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._planes=[];this._absPlanes=[];this._signs=[];this._distanceScale=[];for(var c=a.length,b=0;b<a.length;b++)this._planes.push(a[b].slice());for(a=0;a<c;++a)for(this._planes[a][3]=-this._planes[a][3],this._absPlanes[a]=d.cwiseAbs3(this._planes[a]),this._signs[a]=[0,0,0],b=0;3>b;++b)this._signs[a][b]=0<=this._planes[a][b]?1:-1;for(a=0;a<c;++a)b=d.squaredNorm3(this._planes[a]),this._distanceScale[a]=0===b?0:1/b}a.fromPlaneCoefficients=function(d){for(var c=
[],b=0;b<d.length;b++){var f=d[b];c.push([f.x,f.y,f.z,f.w])}return new a(c)};a.createFrustumFromMatrix=function(e){for(var c=[],b=0;3>b;++b)c[b]=d.sub4(d.col4(e,3),d.col4(e,b));for(b=0;3>b;++b)c[b+3]=d.add4(d.col4(e,3),d.col4(e,b));return new a(c)};a.prototype.testAxisAlignedBox=function(a,c){for(var b=this._planes.length,f=2,e=0;e<b;++e){var g=d.dot3(this._planes[e],a),h=d.dot3(this._absPlanes[e],c);if(g+h<=this._planes[e][3])return 0;g-h<this._planes[e][3]&&(f=1)}return f};a.prototype.axisAlignedBoxNotOutside=
function(a,c){for(var b=this._planes.length,f=0;f<b;++f)if(d.dot3(this._planes[f],d.add3(a,d.cwiseProduct3(c,this._signs[f])))<=this._planes[f][3])return!1;return!0};a.prototype.sphereNotOutside=function(a,c){for(var b=this._planes.length,f=0;f<b;++f){var e=d.dot3(this._planes[f],a)-this._planes[f][3];if(0>e&&e*e*this._distanceScale[f]>=c)return!1}return!0};a.prototype.sphereFullyInside=function(a,c){for(var b=this._planes.length,f=0;f<b;++f){var e=d.dot3(this._planes[f],a)-this._planes[f][3];if(0>
e||e*e*this._distanceScale[f]<c)return!1}return!0};a.prototype.pointInside=function(a){for(var c=this._planes.length,b=0;b<c;++b)if(0>d.dot3(this._planes[b],a)-this._planes[b][3])return!1;return!0};return a}();d.ConvexVolume=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){}a.isSupported=function(){return a._enabled&&"function"===typeof fetch&&"function"===typeof ReadableStream};a.request=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,fetch(a)];case 1:c=b.sent();if(200===c.status)return[2,c];throw new d.LoadError('Failed to fetch "'+a+'" with status '+c.status+".");}})})};a._enabled=!0;return a}();h.FetchApi=g})(d.Internal||(d.Internal=
{}))})(Communicator||(Communicator={}));(function(d){(function(d){d.nop=function(){};d.identity=function(d){return d}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(a,e){return new Promise(function(c,b){var f=new XMLHttpRequest;f.open("GET",a,!0);e&&(f.responseType=e);f.onload=function(e){4===f.readyState&&(200===f.status?c(f):(e=new d.LoadError('XMLHttpRequest failed to GET "'+a+'" with status '+f.status+"."),b(e)))};f.onerror=function(c){b(c)};f.send()})}h.httpRequest=g;h.httpRequestBuffer=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return[4,
g(a,"arraybuffer")];case 1:return d=c.sent(),[2,new Uint8Array(d.response)]}})})}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.copyMap=function(d){var a=new Map;d.forEach(function(d,c){a.set(c,d)});return a};d.copySet=function(d){var a=new Set;d.forEach(function(d){a.add(d)});return a};d.toSet=function(d){for(var a=new Set,e=0;e<d.length;e++)a.add(d[e]);return a}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._deferredValue=a}a.create=function(d){return new a(d)};a.prototype.get=function(){null!==this._deferredValue&&(this._resolvedValue=this._deferredValue(),this._deferredValue=null);return this._resolvedValue};return a}();d.Lazy=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.Lazy=d.Util.Lazy;var g=function(){function a(c){this._value=c}a.create=function(c){return new a(c)};a.prototype.get=function(){"function"===typeof this._value&&(this._value=this._value());return this._value};return a}();h.LazyObject=g;var a=function(){function a(c){"function"===typeof c&&(c=g.create(c));c instanceof Promise&&(c=this._rectifyResult(c));this._value=c}a.create=function(c){return new a(c)};a.prototype.isUnforced=function(){return this._value instanceof g};
a.prototype.isResolved=function(){return!(this._value instanceof g)&&!(this._value instanceof Promise)};a.prototype.getResolved=function(){console.assert(this.isResolved());return this._value};a.prototype.then=function(c,b){this._value instanceof g&&(this._value=this._rectifyResult(this._value.get()));if(this._value instanceof Promise)return this._value.then(c,b);d.Util.TypeAssert(this._value);return Promise.resolve(this._value).then(c,b)};a.prototype._rectifyResult=function(c){var b=this;return c instanceof
Promise?c.then(function(c){return b._value=c}):c};return a}();h.LazyPromise=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d.fromIntegerMap=function(d){if(d instanceof Map)return d;for(var a=new Map,e=0,c=Object.keys(d);e<c.length;e++){var b=c[e],f=d[b];a.set(parseInt(b,10),f)}return a};d.toIntegerMap=function(d){if(!(d instanceof Map))return d;var a={};d.forEach(function(d,c){a[c]=d});return a};d.fromRealNumberMap=function(d){if(d instanceof Map)return d;for(var a=new Map,e=0,c=Object.keys(d);e<c.length;e++){var b=c[e];a.set(Number(b),d[b])}return a};d.fromStringMap=function(d){if(d instanceof
Map)return d;for(var a=new Map,e=0,c=Object.keys(d);e<c.length;e++){var b=c[e];a.set(b,d[b])}return a}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(h){h.Todo=function(){for(var g=0;g<arguments.length;g++);throw new d.InternalLogicError;}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.TypeAssert=function(d){};h.TypeAssertNever=function(g){throw new d.InternalLogicError;}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.CompileTime||(d.CompileTime={});d.enable=!0;d.disable=!1})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._heap=[];this._comparator=a}a.prototype.clear=function(){this._heap.length=0};Object.defineProperty(a.prototype,"length",{get:function(){return this._heap.length},enumerable:!0,configurable:!0});a.prototype.peek=function(){return this._heap[0]};a.prototype.push=function(a){this._heap.push(a);this._siftUp()};a.prototype.pop=function(){var a=this.peek(),c=this.length-1;0<c&&this._swap(0,c);this._heap.pop();this._siftDown();return a};a.prototype.replace=
function(a){var c=this.peek();this._heap[0]=a;this._siftDown();return c};a.prototype._greater=function(a,c){return this._comparator(this._heap[a],this._heap[c])};a.prototype._swap=function(a,c){var b=[this._heap[c],this._heap[a]];this._heap[a]=b[0];this._heap[c]=b[1]};a.prototype._siftUp=function(){for(var a=this.length-1;0<a&&this._greater(a,(a+1>>>1)-1);)this._swap(a,(a+1>>>1)-1),a=(a+1>>>1)-1};a.prototype._siftDown=function(){for(var a=0;(a<<1)+1<this.length&&this._greater((a<<1)+1,a)||a+1<<1<
this.length&&this._greater(a+1<<1,a);){var c=a+1<<1<this.length&&this._greater(a+1<<1,(a<<1)+1)?a+1<<1:(a<<1)+1;this._swap(a,c);a=c}};return a}();d.PriorityQueue=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.waitForAll=function(d){return Promise.all(d)}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){return function(){this.items=[];this.next=null}}(),a=function(){function a(){this.clear()}a.prototype.clear=function(){this._tail=this._head=new g;this._size=0};Object.defineProperty(a.prototype,"length",{get:function(){return this._size},enumerable:!0,configurable:!0});a.prototype.push=function(c){++this._size;if(1024===this._tail.items.length){var b=new g;this._tail=this._tail.next=b}this._tail.items.push(c)};a.prototype.pop=function(){console.assert(0<
this._size);console.assert(0<this._head.items.length);--this._size;var c=this._head.items.shift();if(0===this._head.items.length){var b=this._head.next;null===b?console.assert(this._head===this._tail):this._head=b}return c};return a}();d.Queue=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){var g=function(){return function(a,d){this.value=a;this.kids=d.slice()}}();d.RoseTree=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){function g(a){var d=[];a.forEach(function(c){d.push(c)});return d}d.setToArray=g;d.setSubtraction=function(a,e){a=g(a).filter(function(c){return!e.has(c)});return d.toSet(a)}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a,c){this._state=a;this._reducer=c}a.prototype.handle=function(a,c){this._state=this._reducer(this._state,{name:a,payload:c})};return a}();d.StateMachine=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d.utf8ArrayToStr=function(c){if("undefined"!==typeof window&&8192>c.length&&"escape"in window){var b=void 0;try{var a=String.fromCharCode.apply(null,c),d=window.escape(a);b=decodeURIComponent(d)}catch(p){b=""}return b}b="";d=c.length;for(a=0;a<d;){var e=c[a++];switch(e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(e);break;case 12:case 13:var g=c[a++];b+=String.fromCharCode((e&31)<<6|g&63);break;case 14:g=c[a++];var h=c[a++];b+=String.fromCharCode((e&
15)<<12|(g&63)<<6|(h&63)<<0)}}return b};var g=/^\d+$/;d.isBase10Number=function(c){return g.test(c)};var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`~!@#$%^&*()_+-=[]{};:'\",.<>\\|/?".split("");d.compressUint=function(c){console.assert(0<=c);if(0===c)return a[0];for(var b=[];0!==c;){var d=Math.floor(c/a.length);b.push(a[c%a.length]);c=d}return b.join("")};var e="0000000 000000 00000 0000 000 00 0 ".split(" ");d.zeroPadHex32=function(c){c=c.toString(16);return e[c.length-1]+c}})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){(function(d){d.isEmpty=function(a){return null===a||void 0===a};d.toArray=function(a){return Array.isArray(a)?a.slice():null===a||void 0===a?[]:[a]};d.fromArray=function(a){return 0===a.length?null:1===a.length?a[0]:a};d.push=function(a,d){return a?Array.isArray(a)?(a.push(d),a):[a,d]:d}})(d.TerseArray||(d.TerseArray={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){this._afterActionIdlePromise=this._beforeActionIdlePromise=this._action=this._timerId=null}a.prototype.isIdle=function(a){if(0===a)return null===this._timerId;h.TypeAssert(a);return null===this._action};a.prototype.waitForIdle=function(a){if(0===a){if(null===this._timerId)return Promise.resolve();null===this._beforeActionIdlePromise&&(this._beforeActionIdlePromise=d.Internal.OpenPromise.create());return this._beforeActionIdlePromise}h.TypeAssert(a);
if(null===this._action)return Promise.resolve();null===this._afterActionIdlePromise&&(this._afterActionIdlePromise=d.Internal.OpenPromise.create());return this._afterActionIdlePromise};a.prototype._triggerIdlePromise=function(a){0===a?null!==this._beforeActionIdlePromise&&(this._beforeActionIdlePromise.resolve(),this._beforeActionIdlePromise=null):(h.TypeAssert(a),null!==this._afterActionIdlePromise&&(this._afterActionIdlePromise.resolve(),this._afterActionIdlePromise=null))};a.prototype._clearTimeout=
function(){null!==this._timerId&&(clearTimeout(this._timerId),this._timerId=null)};a.prototype.clear=function(){this._clearTimeout();this._triggerIdlePromise(0);this._action=null;this._triggerIdlePromise(1)};a.prototype.set=function(a,c){var b=this;this._clearTimeout();this._action=c;this._timerId=setTimeout(function(){b._timerId=null;b._triggerIdlePromise(0);var c=b._afterActionIdlePromise;b._afterActionIdlePromise=null;b._action();null===b._timerId&&(b._action=null);null!==c&&c.resolve()},a)};return a}();
h.Timer=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.Unicode||(d.Unicode={});d.Subscript1="\u00b9";d.Subscript2="\u00b2";d.Subscript3="\u00b3";d.SubscriptNeg="\u207b";d.Ohm="\u2126"})(Communicator||(Communicator={}));
(function(d){(function(d){function g(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]}function a(a){var c=a[0],b=a[1];a=a[2];return c*c+b*b+a*a}d.toVec3=function(a){return[a.x,a.y,a.z]};d.cwiseAbs3=function(a){return[Math.abs(a[0]),Math.abs(a[1]),Math.abs(a[2])]};d.cwiseProduct3=function(a,c){return[a[0]*c[0],a[1]*c[1],a[2]*c[2]]};d.add3=function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2]]};d.sub3=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]};d.add4=function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2],
a[3]+c[3]]};d.sub4=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2],a[3]-c[3]]};d.dot3=g;d.squaredNorm3=a;d.norm3=function(d){return Math.sqrt(a(d))};d.scale3=function(a,c){return[a*c[0],a*c[1],a*c[2]]};d.toVec4=function(a){return[a.x,a.y,a.z,a.w]};d.row4=function(a,c){a=a.m;c*=4;return[a[c],a[c+1],a[c+2],a[c+3]]};d.col4=function(a,c){a=a.m;return[a[c],a[c+4],a[c+8],a[c+12]]};d.squaredNorm4=function(a){var c=a[0],b=a[1],d=a[2];a=a[3];return c*c+b*b+d*d+a*a};d.scale4=function(a,c){return[a*c[0],
a*c[1],a*c[2],a*c[3]]};d.projectSquaredSize=function(a,c,b){a=g(a,b)+b[3];a*=a;1E-5>a&&(a=1E-5);return c/a}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c){this._failed=!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;console.assert(0<a,"Don't create a non-progressible queue.");this._maxActivePromises=a;this._suppressFailures=c;this._deferredActions=new d.Internal.Queue}a.prototype.isIdle=function(){return 0===this._activePromiseCount};a.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(this.isIdle()){if(this._failed)throw this._failureError;
return[2]}null===this._idlePromise&&(this._idlePromise=h.OpenPromise.create());return[2,this._idlePromise]})})};a.prototype.push=function(a){"function"===typeof a&&(a=h.Lazy.create(a));this._activePromiseCount<this._maxActivePromises?(console.assert(0===this._deferredActions.length),this._immediateAction(a)):this._deferredActions.push(a)};a.prototype._immediateAction=function(a){var c=this;if(this._failed)return console.assert(0===this._deferredActions.length),!0;try{var b=a.get()}catch(f){this._suppressFailures||
(this._failed=!0,this._failureError=f,this._deferredActions.clear())}if(void 0===b)return!0;++this._activePromiseCount;b.then(function(b){c._finalizePromise();return b}).catch(function(b){c._finalizePromise();throw b;});return!1};a.prototype._finalizePromise=function(){--this._activePromiseCount;this._failed&&console.assert(0===this._deferredActions.length);if(0<this._deferredActions.length){do{var a=this._deferredActions.pop();if(!this._immediateAction(a))break}while(0<this._deferredActions.length)
}this._tryActivateIdlePromise()};a.prototype._tryActivateIdlePromise=function(){0===this._activePromiseCount&&(console.assert(0===this._deferredActions.length),null!==this._idlePromise&&(this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null))};return a}();h.ActionQueue=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._idlePromise=this._pending=this._active=null;this._suppressFailures=a}a.prototype.isIdle=function(){return null===this._active};a.prototype.waitForIdle=function(){if(this.isIdle())return Promise.resolve();null===this._idlePromise&&(this._idlePromise=d.OpenPromise.create());return this._idlePromise};a.prototype.set=function(a){var c=this;"function"===typeof a&&(a=d.Lazy.create(a));if(null===this._active){var b=void 0;try{b=a.get()}catch(f){return this._advance(!this._suppressFailures,
f)}if(void 0===b)return this._advance(!1,null);this._active=b.then(function(){c._advance(!1,null)}).catch(function(b){c._advance(!c._suppressFailures,b)})}else this._pending=a};a.prototype._advance=function(a,c){this._active=null;a&&(this._pending=null);null===this._pending?null!==this._idlePromise&&(a?this._idlePromise.reject(c):this._idlePromise.resolve(),this._idlePromise=null):(a=this._pending,this._pending=null,this.set(a))};a.prototype.clear=function(){this._pending=null};return a}();d.CurrentAction=
g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._action=new d.CurrentAction(!0);this._latestPromise=null;this._timestamp=0}a.prototype.isIdle=function(){return null===this._latestPromise&&this._action.isIdle()};a.prototype.set=function(a){var c=this,b=++this._timestamp;null!==this._latestPromise&&this._latestPromise.reject(void 0);var f=d.OpenPromise.create();this._latestPromise=f;this._action.clear();this._action.waitForIdle().then(function(){b===c._timestamp&&c._action.set(function(){if(b===
c._timestamp){f===c._latestPromise&&(c._latestPromise=null);"function"===typeof a&&(a=d.Lazy.create(a));try{var e=a.get()}catch(l){return c._advance(f,!0,l)}return void 0===e?c._advance(f,!1,null):e.then(function(){return c._advance(f,!1,null)},function(b){return c._advance(f,!0,b)})}})});return f};a.prototype._advance=function(a,c,b){a===this._latestPromise&&(this._latestPromise=null);c?a.reject(b):a.resolve()};return a}();d.CurrentActionSync=g})(d.Util||(d.Util={}))})(Communicator||(Communicator=
{}));(function(d){(function(d){(function(d){d.create=function(){var a,d,c=new Promise(function(b,c){a=b;d=c});c.resolve=a;c.reject=d;return c}})(d.OpenPromise||(d.OpenPromise={}))})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){(d.Internal||(d.Internal={})).OpenPromise=d.Util.OpenPromise})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._cache=new Map}a.prototype.clear=function(){this._cache.clear()};a.prototype.load=function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){b=this._cache.get(a);if(void 0!==b)return[2,b];this._cache.set(a,c);return[2,c]})})};return a}();d.PromiseCache=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function c(b,c,a){this._lazyPromise=b;this._wrapperPromise=c;null!==a&&(this.compareValue=a)}c.prototype.kill=function(){this._lazyPromise=null};c.prototype.cancel=function(b){this._lazyPromise=null;this._wrapperPromise.resolve(b)};c.prototype.fetch=function(b,c){var a=this;null===this._lazyPromise?(this._wrapperPromise.reject(null),setTimeout(c,0)):b(this._lazyPromise).then(function(b){a._wrapperPromise.resolve(b)}).catch(function(b){a._wrapperPromise.reject(b)})};
return c}();d._DeferredPromise=g;var a=function(){function c(b,c,a){this._failed=!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;this._latestPromise=Promise.resolve();this._needsResorting=!1;console.assert(0<b,"Don't create a non-progressible queue.");this._maxActivePromises=b;this._deferredPromises=c;this._failureFailsAll=a}c.prototype.maxActivePromises=function(){return this._maxActivePromises};c.prototype.activePromiseCount=function(){return this._activePromiseCount};
c.prototype.isIdle=function(){return 0===this._activePromiseCount};c.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isIdle()){if(this._failureFailsAll&&this._failed)throw this._failureError;return[2]}null===this._idlePromise&&(this._idlePromise=d.OpenPromise.create());return[2,this._idlePromise]})})};c.prototype.killDeferred=function(){for(var b=[];0<this._deferredPromises.length;){var c=this._dequeue();c.kill();b.push(c)}for(var a=
0;a<b.length;a++)c=b[a],this._queue(c)};c.prototype._push=function(b,c){"function"===typeof b&&(b=d.Lazy.create(b));return this._latestPromise=b=this._activePromiseCount<this._maxActivePromises?this._immediatePromise(b):this._deferPromise(b,c)};c.prototype._resort=function(){console.assert(this._needsResorting);this._needsResorting=!1;for(var b=0,c=this._drainQueue();b<c.length;b++)this._queue(c[b])};c.prototype._drainQueue=function(){for(var b=[];0<this._deferredPromises.length;){var c=this._dequeue();
b.push(c)}return b};c.prototype._deferPromise=function(b,c){var a=d.OpenPromise.create();b=new g(b,a,c);this._queue(b);return a};c.prototype._immediatePromise=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(d){switch(d.label){case 0:if(this._failureFailsAll&&this._failed)throw this._failureError;++this._activePromiseCount;d.label=1;case 1:return d.trys.push([1,3,,4]),[4,b.get()];case 2:return c=d.sent(),this._finalizePromise(),[2,c];case 3:throw a=
d.sent(),this._failureFailsAll&&!this._failed&&(this._failed=!0,this._failureError=a,null!==this._idlePromise&&this._idlePromise.reject(a)),this._finalizePromise(),a;case 4:return[2]}})})};c.prototype._fetchNext=function(){var b=this;this._dequeue().fetch(function(c){return b._immediatePromise(c)},function(){b._finalizePromise()})};c.prototype._finalizePromise=function(){--this._activePromiseCount;0<this._deferredPromises.length?(this._needsResorting&&this._resort(),this._fetchNext()):0===this._activePromiseCount&&
(null!==this._idlePromise&&(this._failureFailsAll&&this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null),this._latestPromise=Promise.resolve())};return c}();d.PromiseQueueImpl=a;var e=function(c){function b(b,a){return c.call(this,b,new d.Queue,a)||this}__extends(b,c);b.prototype._queue=function(b){this._deferredPromises.push(b)};b.prototype._dequeue=function(){return this._deferredPromises.pop()};b.prototype.push=function(b){return this._push(b,
null)};b.prototype.waitOnLatest=function(){return this._latestPromise.then(d.nop,d.nop)};return b}(a);d.PromiseQueue=e;a=function(c){function b(b,a,e){var f=this;f=new d.PriorityQueue(function(b,c){return a(b.compareValue,c.compareValue)});return f=c.call(this,b,f,e)||this}__extends(b,c);b.prototype._queue=function(b){this._deferredPromises.push(b)};b.prototype._dequeue=function(){return this._deferredPromises.pop()};b.prototype.push=function(b,c){return this._push(b,c)};b.prototype.markDirty=function(){this._needsResorting=
!0};return b}(a);d.PriorityPromiseQueue=a;e=function(c){function b(b){return c.call(this,1,b)||this}__extends(b,c);b.prototype._queue=function(b){this._deferredPromises.clear();this._deferredPromises.push(b)};return b}(e);d.SingleMostRecentPromiseQueue=e;e=function(c){function b(b,a,d,e,g){d=c.call(this,d,e,g)||this;d._cutoffAttachments=[];d._attachPriorityManager=a;d._cutoffScale=b;return d}__extends(b,c);b.prototype.setCutoffScale=function(b){this._cutoffScale=Math.max(Math.min(b,2),0)};b.prototype.cutoffEnabled=
function(){return 0!==this._cutoffScale};b.prototype.isEmpty=function(){return 0===this._cutoffAttachments.length&&0===this._deferredPromises.length};b.prototype.killDeferred=function(){var b=this._drainQueue(),c=this._cutoffAttachments;this._cutoffAttachments=[];for(var a=0;a<b.length;a++)b[a].cancel(null);for(b=0;b<c.length;b++)c[b].cancel(null)};b.prototype._getCutoffValue=function(){return this._cutoffScale*-this._attachPriorityManager.getCalculatedCutoff()-1};b.prototype.push=function(b,c){if(!this.cutoffEnabled())return this._push(b,
c);var a=this._attachPriorityManager.getPriorityCompareValue(c),f=this._getCutoffValue();return a>f?("function"===typeof b&&(b=d.Lazy.create(b)),a=d.OpenPromise.create(),b=new g(b,a,c),this._cutoffAttachments.push(b),a):this._push(b,c)};b.prototype._resort=function(){if(this.cutoffEnabled()){this._needsResorting=!1;var b=this._drainQueue(),a=this._cutoffAttachments;this._cutoffAttachments=[];this._updateDeferredPromiseArray(b);this._updateDeferredPromiseArray(a)}else c.prototype._resort.call(this)};
b.prototype.update=function(){this.cutoffEnabled()?0<this._cutoffAttachments.length&&(this._resort(),this._refillQueue()):this.markDirty()};b.prototype._refillQueue=function(){for(var b=Math.min(this.maxActivePromises()-this.activePromiseCount(),this._deferredPromises.length),c=0;c<b;c++)this._fetchNext()};b.prototype._updateDeferredPromiseArray=function(b){for(var c=0;c<b.length;c++){var a=b[c],d=this._attachPriorityManager.getPriorityCompareValue(a.compareValue),f=this._getCutoffValue();d>f?this._cutoffAttachments.push(a):
this._queue(a)}};return b}(a);d.StreamCutoffAttachQueue=e})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){(function(d){d.create=function(){var a,d,c=new Promise(function(b,f){a=function(a){c.state=1;b(a)};d=function(b){c.state=2;f(b)}});c.state=0;c.resolve=a;c.reject=d;return c}})(d.TrackedOpenPromise||(d.TrackedOpenPromise={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.create=function(a,d){var c=new Promise(function(b,f){d.then(function(){c.isReady=!0;b(a)},f)});c.unsafeValue=a;c.readyPromise=d;c.isReady=!1;return c}})(d.UnsafePromise||(d.UnsafePromise={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function c(b,c,e,g){var f=a.call(this)||this;f._position=new d.Point2(b,c);f._modifiers=e;f._inputType=g;return f}__extends(c,a);c.prototype.getPosition=function(){return this._position.copy()};c.prototype.shiftDown=function(){return(this._modifiers&d.KeyModifiers.Shift)===d.KeyModifiers.Shift};c.prototype.altDown=function(){return(this._modifiers&d.KeyModifiers.Alt)===d.KeyModifiers.Alt};c.prototype.controlDown=function(){return(this._modifiers&d.KeyModifiers.Control)===
d.KeyModifiers.Control};c.prototype.commandDown=function(){return(this._modifiers&d.KeyModifiers.Command)===d.KeyModifiers.Command};c.prototype.getEventType=function(){return this._inputType};c.prototype.getModifiers=function(){return this._modifiers};return c}(h.InputEvent);h.MouseInputEventBase=g;var a=function(a){function c(b,c,d,e,g,h){b=a.call(this,b,c,g,h)||this;b._button=d;b._buttons=e;return b}__extends(c,a);c.prototype.getButton=function(){return this._button};c.prototype.getButtons=function(){return this._buttons};
return c}(g);h.MouseInputEvent=a;g=function(a){function c(b,c,d,e,g,h){b=a.call(this,b,c,g,h)||this;b._wheelDelta=d;b._buttons=e;return b}__extends(c,a);c.prototype.getWheelDelta=function(){return this._wheelDelta};c.prototype.getButtons=function(){return this._buttons};return c}(g);h.MouseWheelInputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a){this._selection=a}a.prototype.getType=function(){return this._selection?this._selection.getSelectionType():d.SelectionType.None};a.prototype.getSelection=function(){return this._selection};a._createNull=function(){return new a(d.Selection.SelectionItem.create())};return a}();h.NodeSelectionEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b,f,e,g){var k=a.call(this)||this;k._id=c;k._position=new d.Point2(b,f);k._buttons=e;k._inputType=g;return k}__extends(e,a);e.prototype.getId=function(){return this._id};e.prototype.getPosition=function(){return this._position};e.prototype.getEventType=function(){return this._inputType};e.prototype.getButtons=function(){return this._buttons};return e}(h.InputEvent);h.TouchInputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){}a.calculate=function(a,c,b,d){var f=2/(c+2*b+d);a=a<=c?this._PA(a,f,c):a>=c&&a<=c+b?this._PA(a,f,c):this._PC(a,f,c,b,d);return a=Math.min(a,1)};a._PA=function(a,c,b){return a*a*.5*c/b};a._PB=function(a,c,b){return this._PA(b,c,b)+(a-b)*c};a._PC=function(a,c,b,d,g){return this._PB(b+d,c,b)+(a-(b+d))*c*(1-.5*(a-(b+d))/g)};return a}();d.EaseInEaseOut=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c,b,f,g){this._startTime=this._completeCallback=null;this._progress=0;this._targetMoveDelta=this._positionMoveDelta=null;this._interpolationUsesRotation=!1;this._endQuaternion=this._beginQuaternion=null;this._fieldHeightDelta=this._fieldWidthDelta=this._viewVectorLengthDelta=this._viewVectorLength=0;this._beginCam=a.copy();this._endCam=c.copy();a=d.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()).normalize();c=this._endCam.getUp().normalize();
c=d.Point3.cross(c,a);a=d.Point3.cross(a,c);this._endCam.setUp(a.normalize());this._completeCallback=f;this._duration=b;this._view=g}a.prototype.isComplete=function(){return 1<=this._progress};a.prototype.getCallback=function(){return this._completeCallback};a.prototype.stop=function(){};a.prototype.start=function(){this._startTime=Date.now();this._progress=0;this._init();this._view.getProjectionMode()!==this._endCam.getProjection()&&this._view.setProjectionMode(this._endCam.getProjection())};a.prototype.update=
function(){if(null!==this._startTime){var a=(Date.now()-this._startTime)/this._duration;a=Math.min(a,1);a=Math.max(a,0);a=h.EaseInEaseOut.calculate(a,.49,.02,.49);a=Math.min(a,1);a=Math.max(a,0);var c=d.Point3.scale(this._positionMoveDelta,a),b=d.Point3.scale(this._targetMoveDelta,a),f=this._beginCam.getUp(),g=d.Point3.add(this._beginCam.getPosition(),c);b=d.Point3.add(this._beginCam.getTarget(),b);c=this._beginCam.getWidth()+a*this._fieldWidthDelta;var l=this._beginCam.getHeight()+a*this._fieldHeightDelta;
if(this._interpolationUsesRotation){g=this._viewVectorLength+this._viewVectorLengthDelta*a;var n=d.Quaternion.interpolate(this._beginQuaternion,this._endQuaternion,a);n=d.Quaternion.toMatrix(n);g=new d.Point3(b.x-n.m[8]*g,b.y-n.m[9]*g,b.z-n.m[10]*g);f.set(n.m[4],n.m[5],n.m[6])}f=d.Camera.create(g,b,f,this._endCam.getProjection(),c,l,this._endCam.getNearLimit());this._view.setCamera(f);this._progress=a;1<=this._progress&&this._view.setCamera(this._endCam)}};a.prototype.getMatrixFromCamera=function(a){var c=
d.Point3.subtract(a.getTarget(),a.getPosition()).normalize();a=a.getUp().normalize();a=d.Point3.cross(a,c);var b=d.Point3.cross(c,a);return d.Matrix.createFromBasis(a,b,c)};a.prototype._init=function(){var a=d.Point3.subtract(this._beginCam.getTarget(),this._beginCam.getPosition()),c=d.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()),b=a.length(),f=c.length()-b;a.normalize();c.normalize();c=d.Point3.subtract(a,c);var g=d.Point3.subtract(this._endCam.getUp(),this._beginCam.getUp());
a=!0;1E-4>c.length()&&1E-4>g.length()&&(a=!1);g=c=null;if(a){c=this.getMatrixFromCamera(this._beginCam);g=this.getMatrixFromCamera(this._endCam);c=d.Quaternion.createFromMatrix(c);g=d.Quaternion.createFromMatrix(g);var l=d.Quaternion.subtract(c,g).magnitudeSquared();d.Quaternion.add(c,g).magnitudeSquared()<l&&g.negate()}this._interpolationUsesRotation=a;this._beginQuaternion=c;this._endQuaternion=g;this._viewVectorLength=b;this._viewVectorLengthDelta=f;this._positionMoveDelta=d.Point3.subtract(this._endCam.getPosition(),
this._beginCam.getPosition());this._targetMoveDelta=d.Point3.subtract(this._endCam.getTarget(),this._beginCam.getTarget());this._fieldWidthDelta=this._endCam.getWidth()-this._beginCam.getWidth();this._fieldHeightDelta=this._endCam.getHeight()-this._beginCam.getHeight()};return a}();h.CameraInterpolation=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){this._activeInterpolation=null;this._updateTimer=new d.Util.Timer;this._updateInterval=16}a.prototype.stop=function(){this._activeInterpolation&&this._activeInterpolation.stop();this._activeInterpolation=null;this._updateTimer.clear()};a.prototype.start=function(a,c){void 0===c&&(c=!0);if(this._activeInterpolation&&!c)return!1;this.stop();this._activeInterpolation=a;this._activeInterpolation.start();this.update();return!0};a.prototype.update=
function(){var a=this;if(this._activeInterpolation)if(this._activeInterpolation.update(),this._activeInterpolation.isComplete()){var c=this._activeInterpolation.getCallback();null!==c&&c()}else this._updateTimer.isIdle(0)&&this._updateTimer.set(this._updateInterval,function(){a.update()})};return a}();h.InterpolationManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c,b){this._markupItems=new Map;this._selectedMarkup=this._activeView=null;this._pendingUpdateHandleTimer=new d.Util.Timer;this._pickTolerance=0;this._callbackManager=a;this._domElements=c;this._markupRenderer=b}a.prototype.shutdown=function(){this.setActiveView(null);this._markupItems.forEach(function(a){a.remove()});this._markupItems.clear()};a.prototype._updateLater=function(a){var c=this;this._pendingUpdateHandleTimer.isIdle(0)&&this._pendingUpdateHandleTimer.set(0,
function(){c.update()});null!==a&&this._pendingUpdateHandleTimer.waitForIdle(1).then(function(){a.resolve()})};a.prototype.updateLater=function(){this._updateLater(null)};a.prototype.update=function(){this._pendingUpdateHandleTimer.clear();this.renderMarkup();this.renderActiveViewMarkup()};a.prototype.registerMarkupItem=function(a){var c=d.UUID.create();this._markupItems.set(c,a);return c};a.prototype.unregisterMarkupItem=function(a){var c=this._markupItems.get(a);c&&(c.remove&&c.remove(),this._markupItems.delete(a))};
a.prototype.getActiveView=function(){return this._activeView};a.prototype.setActiveView=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,d,e,g,n;return __generator(this,function(f){switch(f.label){case 0:this._selectedMarkup&&(this._selectedMarkup.onDeselect(),this._selectedMarkup=null);c=this._activeView;this._activeView=a;if(null===c||c===a)return[3,2];b=c.getMarkup();d=0;for(e=b;d<e.length;d++)g=e[d],g.remove();n=h.OpenPromise.create();this._updateLater(n);return[4,n];case 1:return f.sent(),
this._callbackManager.trigger("viewDeactivated",c),[3,4];case 2:return[4,this._pendingUpdateHandleTimer.waitForIdle(1)];case 3:f.sent(),f.label=4;case 4:return[2]}})})};a.prototype.renderMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getMarkupSvgElement());this._markupRenderer._clear();this._markupItems.forEach(function(a){a.draw()});this._markupRenderer._finalize()};a.prototype.renderActiveViewMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getRedlineSvgElement());
this._markupRenderer._clear();if(this._activeView){for(var a=0,c=this._activeView.getMarkup();a<c.length;a++)c[a].draw();this._markupRenderer._finalize()}};a.prototype.getPickTolerance=function(){return this._pickTolerance};a.prototype.setPickTolerance=function(a){this._pickTolerance=a};a.prototype.pick=function(a){var c=this;if(this._activeView)for(var b=0,d=this._activeView.getMarkup();b<d.length;b++){var e=d[b];if(e.hitWithTolerance(a,this._pickTolerance)||e.hit(a))return e}var g=null;this._markupItems.forEach(function(b){null===
g&&(b.hitWithTolerance(a,c._pickTolerance)||b.hit(a))&&(g=b)});return g};a.prototype.select=function(a){if(this._selectedMarkup&&a!==this._selectedMarkup)this._selectedMarkup.onDeselect();if(this._selectedMarkup=a)this._selectedMarkup.onSelect();this.update()};a.prototype.getSelected=function(){return this._selectedMarkup};return a}();h.MarkupItemManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._center=d.Point2.zero();b._radius=1;return b}__extends(b,c);b.prototype.set=function(b,c){this._center.assign(b);this.setRadius(c)};b.prototype.getCenter=function(){return this._center.copy()};b.prototype.setCenter=function(b){this._center.assign(b)};b.prototype.getRadius=function(){return this._radius};b.prototype.setRadius=function(b){this._radius=b};return b}(g.FilledShape);g.Circle=
a;var e=function(){return function(c,b){this.center=c.copy();this.radius=b}}();g._MarkupCircleData=e;a=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._circles=[];return b}__extends(b,c);b.prototype.clear=function(){this._circles=[]};b.prototype.addCircle=function(b,c){this._circles.push(new e(b,c))};b.prototype.setCircle=function(b,c,a){b=this._circles[b];b.center.assign(c);b.radius=a};b.prototype.getCircles=function(){return this._circles};return b}(g.FilledShape);g.CircleCollection=
a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(c){function b(b,a){var f=c.call(this)||this;f._p1=b?b.copy():d.Point2.zero();f._p2=a?a.copy():d.Point2.zero();return f}__extends(b,c);b.prototype.set=function(b,c){this._p1.assign(b);this._p2.assign(c)};b.prototype.getP1=function(){return this._p1.copy()};b.prototype.setP1=function(b){this._p1.assign(b)};b.prototype.getP2=function(){return this._p2};b.prototype.setP2=function(b){this._p2.assign(b)};return b}(g.EndcapShape);g.Line=a;var e=function(){return function(c,
b){this.p1=c.copy();this.p2=b.copy()}}();g._MarkupLineData=e;a=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._lines=[];return b}__extends(b,c);b.prototype.addLine=function(b,c){this._lines.push(new e(b,c))};b.prototype.getLines=function(){return this._lines};b.prototype.clear=function(){this._lines=[]};return b}(g.EndcapShape);g.LineCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function c(){this._padding=5;this._text=new g.TextMarkupBase;this._box=new g.RectangleBase;this._box.setFillOpacity(0);this._box.setFillColor(d.Color.white())}c.prototype._assign=function(b){this._text._assign(b._text);this._box._assign(b._box);this._padding=b._padding};c.prototype.getTextPortion=function(){return this._text};c.prototype.getBoxPortion=function(){return this._box};c.prototype.getPadding=function(){return this._padding};c.prototype.setPadding=
function(b){this._padding=b};return c}();g.TextBoxBase=a;var e=function(c){function b(b,a){var f=c.call(this)||this;f._position=d.Point2.zero();f._textStr="";b&&f._position.assign(b);a&&(f._textStr=a);return f}__extends(b,c);b.prototype._assign=function(b){c.prototype._assign.call(this,b);this._position.assign(b._position)};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.setPosition=function(b){this._position.assign(b)};b.prototype.getTextString=function(){return this._textStr};
b.prototype.setTextString=function(b){this._textStr=b};return b}(a);g.TextBox=e;a=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._textStrings=[];return b}__extends(b,c);b.prototype.clear=function(){this._textStrings=[]};b.prototype.addString=function(b,c){this._textStrings.push(new g._MarkupTextData(b,c))};b.prototype.getStrings=function(){return this._textStrings};return b}(a);g.TextBoxCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){var g=function(){return function(a,c){this.markupView=a;this.itemResults=c}}();h._MarkupViewConstruction=g;var a=function(){function a(a,b,d,e,g,h){void 0===h&&(h=null);this._faceVisibility=this._lineVisibility=!0;this._markupItems=new Set;this._sheetId=null;this._colorMap=new Map;this._snapshotImage=null;this._defaultVisibility=!0;this._visibilityExceptions=new Set;this._uniqueId=a;this._camera=d;this._name=b;this._explodeMagnitude=e;this._cuttingPlaneData=g;this._sheetId=h}
a.prototype.getCamera=function(){return this._camera};a.prototype.getSheetId=function(){return this._sheetId};a.prototype.getUniqueId=function(){return this._uniqueId};a.prototype.getName=function(){return this._name};a.prototype.setName=function(a){this._name=a};a.prototype.getLineVisibility=function(){return this._lineVisibility};a.prototype.setLineVisibility=function(a){this._lineVisibility=a};a.prototype.getFaceVisibility=function(){return this._faceVisibility};a.prototype.setFaceVisibility=function(a){this._faceVisibility=
a};a.prototype.addMarkupItem=function(a){this._markupItems.add(a)};a.prototype.getMarkup=function(){return d.Util.setToArray(this._markupItems)};a.prototype.removeMarkup=function(a){a.remove();return this._markupItems.delete(a)};a.prototype.getCuttingPlaneData=function(){return this._cuttingPlaneData};a.prototype.setCuttingPlaneData=function(a){this._cuttingPlaneData=a};a.prototype.getExplodeMagnitude=function(){return this._explodeMagnitude};a.prototype.setExplodeMagnitude=function(a){this._explodeMagnitude=
a};a.prototype.getColorMap=function(){return this._colorMap};a.prototype.setColorMap=function(a){this._colorMap=a};a.prototype.getDefaultVisibility=function(){return this._defaultVisibility};a.prototype.setDefaultVisibility=function(a){this._defaultVisibility=a};a.prototype.getVisibilityExceptions=function(){return this._visibilityExceptions};a.prototype.setVisibilityExceptions=function(a){this._visibilityExceptions=a};a.prototype.getSnapshotImage=function(){return this._snapshotImage};a.prototype.setSnapshotImage=
function(a){this._snapshotImage=a};a.prototype._handleLoadMarkupItem=function(a){return a instanceof h.MarkupItem?(this.addMarkupItem(a),!0):!1};a._fromJson=function(c,b){return __awaiter(this,void 0,void 0,function(){var f,e,l,h,m,p,q,r,t,u,w,v,y,x,z,A,C,B,D,F,E,G;return __generator(this,function(k){switch(k.label){case 0:f=c;e=d.Camera.fromJson(f.camera);f.hasOwnProperty("sheetId")&&f.sheetId&&(h=parseInt(c.sheetId,10),isNaN(h)||(l=h));m=new a(f.uniqueId,f.name,e,f.explodeMagnitude,f.cuttingData,
l);m.setLineVisibility(f.lineVisibility);m.setFaceVisibility(f.faceVisibility);void 0!==f.defaultVisibility&&void 0!==f.visibilityExceptions&&(m.setDefaultVisibility(f.defaultVisibility),p=new Set,f.visibilityExceptions.forEach(function(b){p.add(b)}),m.setVisibilityExceptions(p));q=new Map;r=f.colors;if(Array.isArray(r))for(t=0,u=r;t<u.length;t++)w=u[t],v=w[0],y=d.Color.fromJson(w[1]),q.set(v,y);m.setColorMap(q);x=[];console.assert(Array.isArray(f.markup));z=0;for(A=f.markup;z<A.length;z++)if(C=A[z],
B=d.Internal.classFromString(C.className))D=B.fromJson(C,b),D instanceof Promise?x.push(D.then(function(b){return m._handleLoadMarkupItem(b)})):x.push(Promise.resolve(m._handleLoadMarkupItem(D)));F=f.imageSrc;void 0!==F&&0<F.length&&(E=new Image,E.src=F,m.setSnapshotImage(E));return[4,Promise.all(x)];case 1:return G=k.sent(),[2,new g(m,G)]}})})};a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=function(){var a={uniqueId:this._uniqueId,name:this._name,camera:this._camera.toJson(),
cuttingData:this._cuttingPlaneData,explodeMagnitude:this._explodeMagnitude,lineVisibility:this._lineVisibility,faceVisibility:this._faceVisibility,markup:[],sheetId:this._sheetId,defaultVisibility:this._defaultVisibility,visibilityExceptions:[],colors:[],imageSrc:""};this._markupItems.forEach(function(b){var c=b.toJson();c.className=b.getClassName();a.markup.push(c)});this._visibilityExceptions.forEach(function(b){a.visibilityExceptions.push(b)});this._colorMap.forEach(function(b,c){a.colors.push([c,
b.toJson()])});null!==this._snapshotImage&&(a.imageSrc=this._snapshotImage.src);return a};a.prototype.forJson=function(){return this.toJson()};return a}();h.MarkupView=a})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b,d,e,g,h){var f=a.call(this)||this;f._markupViews=new Map;f._defaultViewCounter=1;f._markupItemManager=b;f._callbackManager=d;f._explodeManager=e;f._cuttingManager=g;f._viewer=c;f._sheetManager=h;f._initEvents();return f}__extends(e,a);e.prototype._initEvents=function(){var a=this;this._callbackManager.bind({modelSwitchStart:function(){a._markupItemManager.shutdown()}})};e.prototype.getView=function(a){a=this._markupViews.get(a);return void 0!==
a?a:null};e.prototype.getViewKeys=function(){var a=[];this._markupViews.forEach(function(b,c){a.push(c)});return a};e.prototype.loadData=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,n,m=this;return __generator(this,function(f){b=[];c=0;for(e=a;c<e.length;c++)g=e[c],n=d.Markup.MarkupView._fromJson(g,this._viewer).then(function(b){if(!h.all(b.itemResults))return!1;b=b.markupView;var a=b.getUniqueId();return m._markupViews.has(a)?!1:(m._markupViews.set(a,b),m._callbackManager.trigger("viewLoaded",
b),!0)}),b.push(n);return[2,Promise.all(b)]})})};e.prototype.exportMarkup=function(){var a=[];this._markupViews.forEach(function(b){a.push(b.toJson())});return a};e.prototype.createView=function(a,b,f,e,g,h){void 0===a&&(a=this._createDefaultViewName());void 0===b&&(b=!0);void 0===f&&(f=null);void 0===e&&(e=null);void 0===g&&(g=null);void 0===h&&(h=null);var c=this._viewer.view,k=d.UUID.create();a=new d.Markup.MarkupView(k,a,c.getCamera(),this._explodeManager.getMagnitude(),this._cuttingManager.toJson(),
f);this._markupViews.set(k,a);a.setLineVisibility(c.getLineVisibility());a.setFaceVisibility(c.getFaceVisibility());null!==e&&(a.setDefaultVisibility(e.defaultVisibility),a.setVisibilityExceptions(e.visibilityExceptions));null!==g&&a.setColorMap(g);null!==h&&a.setSnapshotImage(h);this._markupItemManager.setActiveView(a);b&&this._callbackManager.trigger("viewCreated",a);return a};e.prototype._activateSheet=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return null!==
a?[2,this._sheetManager.setActiveSheetId(a,!0,!1)]:[2]})})};e.prototype._activateViewImpl=function(a,b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,this._activateSheet(a.getSheetId())];case 1:return d.sent(),c=this._viewer.view,c.setFaceVisibility(a.getFaceVisibility()),c.setLineVisibility(a.getLineVisibility()),0<b?[4,this._markupItemManager.setActiveView(null)]:[3,4];case 2:return d.sent(),[4,c._setCameraPromise(a.getCamera(),
b)];case 3:return d.sent(),[3,5];case 4:c.setCamera(a.getCamera()),d.label=5;case 5:return[4,this._setActiveView(a)];case 6:return d.sent(),[2]}})})};e.prototype._activateView=function(a,b){a=this._markupViews.get(a);return void 0!==a?(b=this._activateViewImpl(a,b),h.UnsafePromise.create(!0,b)):h.UnsafePromise.create(!1,Promise.resolve())};e.prototype.activateView=function(a,b){void 0===b&&(b=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,
this._activateView(a,b)]})})};e.prototype.deprecatedActivateView=function(a,b){void 0===b&&(b=d.DefaultTransitionDuration);return this._activateView(a,b).unsafeValue};e.prototype._setActiveView=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d,e,g;return __generator(this,function(f){switch(f.label){case 0:return this._viewer.model.isDrawing()?null!==a.getSheetId()?[3,2]:[4,this._viewer.sheetManager.deactivateSheets(!0,!0)]:[3,5];case 1:return f.sent(),[3,4];case 2:b=a.getVisibilityExceptions();
c=a.getDefaultVisibility();if(!(0<b.size&&c))return[3,4];d=[];b.forEach(function(b){d.push(b)});return[4,this._viewer.model.setNodesVisibility(d,!1)];case 3:f.sent(),f.label=4;case 4:return[3,7];case 5:return e=a.getDefaultVisibility(),g=a.getVisibilityExceptions(),[4,this._viewer.model.setBodyNodesVisibility(this._viewer.model.getAbsoluteRootNode(),function(b){return g.has(b)?!e:e})];case 6:f.sent(),f.label=7;case 7:return[4,this._markupItemManager.setActiveView(a)];case 8:return f.sent(),[4,this._cuttingManager.fromJson(a.getCuttingPlaneData())];
case 9:return f.sent(),[4,this._viewer.model.setNodesColors(a.getColorMap())];case 10:return f.sent(),[4,this._explodeManager.setMagnitude(a.getExplodeMagnitude())];case 11:return f.sent(),[2]}})})};e.prototype.deleteView=function(a){var b=this._markupViews.get(a);return void 0!==b?(this._callbackManager.trigger("viewDeleted",b),b===this._markupItemManager.getActiveView()&&this._markupItemManager.setActiveView(null),this._markupViews.delete(a),!0):!1};e.prototype._createDefaultViewName=function(){return"View "+
this._defaultViewCounter++};e.prototype.toJson=function(){return this.exportMarkup()};e.prototype.forJson=function(){return this.toJson()};return e}(d.MarkupTypeManager);h.MarkupViewManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,c,e,g,h){void 0===c&&(c=null);void 0===e&&(e=null);void 0===g&&(g=null);void 0===h&&(h=null);var f=a.call(this)||this;f._uniqueId=d.UUID.create();f._lineMeshId=null;f._lineMeshInstanceId=null;f._lineColor=d.Color.red();f._lineOpacity=1;f._linePattern=null;f._linePatternLength=null;f._linePatternLengthUnit=null;f._viewer=b;f._firstPoint=c;f._secondPoint=e;f._firstNodeId=g;f._secondNodeId=h;return f}__extends(c,a);c.prototype.setLineColor=
function(b){this._lineColor=b};c.prototype.getLineColor=function(){return this._lineColor};c.prototype.setLineOpacity=function(b){this._lineOpacity=b};c.prototype.getLineOpacity=function(){return this._lineOpacity};c.prototype.setLinePattern=function(b,a,c){this._linePattern=b;this._linePatternLength=a;this._linePatternLengthUnit=c};c.prototype.getLinePattern=function(){return void 0!==this._linePattern?this._linePattern:null};c.prototype.getLinePatternLength=function(){return void 0!==this._linePatternLength?
this._linePatternLength:null};c.prototype.getLinePatternLengthUnit=function(){return void 0!==this._linePatternLengthUnit?this._linePatternLengthUnit:null};c.prototype.setFirstPoint=function(b){this._firstPoint=b};c.prototype.getFirstPoint=function(){return this._firstPoint};c.prototype.setSecondPoint=function(b){this._secondPoint=b};c.prototype.getSecondPoint=function(){return this._secondPoint};c.prototype.setFirstNodeId=function(b){this._firstNodeId=b};c.prototype.getFirstNodeId=function(){return this._firstNodeId};
c.prototype.setSecondNodeId=function(b){this._secondNodeId=b};c.prototype.getSecondNodeId=function(){return this._secondNodeId};c.prototype.getNodeId=function(){return this._lineMeshInstanceId};c.prototype.removeLine=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return b=this._viewer.model,null===this._lineMeshInstanceId?[3,3]:[4,b.deleteMeshInstances([this._lineMeshInstanceId])];case 1:return a.sent(),this._lineMeshInstanceId=
null,null===this._lineMeshId?[3,3]:[4,b.deleteMeshes([this._lineMeshId])];case 2:a.sent(),this._lineMeshId=null,a.label=3;case 3:return[2]}})})};c.prototype.updateLine=function(){return __awaiter(this,void 0,void 0,function(){var b,a,c,e,g;return __generator(this,function(f){switch(f.label){case 0:return[4,this.removeLine()];case 1:f.sent();if(null===this._firstPoint||null===this._secondPoint)return[3,4];b=new d.MeshData;b.addPolyline([this._firstPoint.x,this._firstPoint.y,this._firstPoint.z,this._secondPoint.x,
this._secondPoint.y,this._secondPoint.z]);a=this._viewer.model;return[4,a.createMesh(b)];case 2:return this._lineMeshId=c=f.sent(),e=new d.MeshInstanceData(c),e.setLineColor(this._lineColor),e.setLineOpacity(this._lineOpacity),e.setCreationFlags(d.MeshInstanceCreationFlags.ExcludeBounding),[4,a.createMeshInstance(e)];case 3:g=f.sent(),null!==this._linePattern&&a.setNodesLinePattern([g],this._linePattern,this._linePatternLength,this._linePatternLengthUnit),this._lineMeshInstanceId=g,f.label=4;case 4:return[2]}})})};
c.prototype.getId=function(){return this._uniqueId};c.prototype.setId=function(b){this._uniqueId=b};c.prototype.getClassName=function(){return c.className};c.prototype._toJson=function(){return{className:this.getClassName(),uniqueId:this._uniqueId,firstPoint:this.getFirstPoint(),secondPoint:this.getSecondPoint(),firstNodeId:this.getFirstNodeId(),secondNodeId:this.getSecondNodeId(),lineColor:this.getLineColor(),lineOpacity:this.getLineOpacity(),linePattern:this.getLinePattern(),linePatternLength:this.getLinePatternLength(),
linePatternLengthUnit:this.getLinePatternLengthUnit()}};c.prototype.toJson=function(){return this._toJson()};c.fromJson=function(b,a){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(g){f=b;e=new c(a,d.Point3.fromJson(f.firstPoint),d.Point3.fromJson(f.secondPoint),f.firstNodeId,f.secondNodeId);e.setId(f.uniqueId);e.setLineColor(d.Color.fromJson(f.lineColor));e.setLineOpacity(f.lineOpacity);null!=f.linePattern&&null!=f.linePatternLength&&null!=f.linePatternLengthUnit&&
e.setLinePattern(f.linePattern,f.linePatternLength,f.linePatternLengthUnit);return[2,e]})})};c.className="Communicator.Markup.Line.LineMarkup";return c}(h.MarkupItem);g.LineMarkup=a})(h.Line||(h.Line={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(a){function c(b){var c=a.call(this)||this;c._viewer=b;return c}__extends(c,a);c.prototype.onDragStart=function(b){b;return!1};c.prototype.onDragMove=function(b){b;return!1};c.prototype.onDragEnd=function(b){b;return!1};c.prototype.remove=function(){this._viewer.trigger("redlineDeleted",this);this._viewer.markupManager.refreshMarkup()};return c}(d.MarkupItem);g.RedlineItem=a})(d.Redline||(d.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(){this._svgDefsElement=this._svgCanvas=null;this._svgElements=[];this._svgTextElements=[]}a.prototype._setCanvas=function(a){this._svgCanvas=a;this._svgDefsElement=document.createElementNS(g.Util.svgNamespace,"defs");this._svgCanvas.appendChild(this._svgDefsElement)};a.prototype._clear=function(){if(null===this._svgCanvas||null===this._svgDefsElement)throw new d.CommunicatorError("canvas not set");for(;this._svgCanvas.firstChild;)this._svgCanvas.removeChild(this._svgCanvas.firstChild);this._svgElements=
[];for(this._svgTextElements=[];this._svgDefsElement.firstChild;)this._svgDefsElement.removeChild(this._svgDefsElement.firstChild);this._svgCanvas.appendChild(this._svgDefsElement)};a.prototype._finalize=function(){if(null===this._svgCanvas)throw new d.CommunicatorError("canvas not set");for(var a=0,b=this._svgElements;a<b.length;a++){var f=b[a];this._svgCanvas.appendChild(f)}a=0;for(b=this._svgTextElements;a<b.length;a++)f=b[a],this._svgCanvas.appendChild(f)};a.prototype.drawCircle=function(a){return this._addCircleNode(a.getCenter(),
a.getRadius(),a)};a.prototype.drawCircles=function(a){for(var b=[],c=0,d=a.getCircles();c<d.length;c++){var e=d[c];e=this._addCircleNode(e.center,e.radius,a);b.push(e)}return b};a.prototype.drawLine=function(a){return this._addLineElement(a.getP1(),a.getP2(),a)};a.prototype.drawLines=function(a){for(var b=[],c=0,d=a.getLines();c<d.length;c++){var e=d[c];e=this._addLineElement(e.p1,e.p2,a);b.push(e)}return b};a.prototype.drawText=function(a){return this._addTextElement(a.getText(),a.getPosition(),
a)};a.prototype.drawTexts=function(a){for(var b=[],c=0,d=a.getStrings();c<d.length;c++){var e=d[c];e=this._addTextElement(e.text,e.position,a);b.push(e)}return b};a.prototype.measureText=function(a,b){if(null===this._svgCanvas)throw new d.CommunicatorError("canvas not set");a=this._createTextElement(a,d.Point2.zero(),b);this._svgCanvas.appendChild(a);b=a.getBoundingClientRect();b=new d.Point2(b.width,b.height);this._svgCanvas.removeChild(a);return b};a.prototype.measureTextBox=function(a){var b=this.measureText(a.getTextString(),
a.getTextPortion());b.x+=2*a.getBoxPortion().getStrokeWidth();b.y+=2*a.getBoxPortion().getStrokeWidth();b.x+=2*a.getPadding();b.y+=2*a.getPadding();return b};a.prototype.drawPolyline=function(a){return this._addPolylineElement(a.getPoints(),a)};a.prototype.drawPolylines=function(a){for(var b=[],c=0,d=a.getPolylines();c<d.length;c++){var e=this._addPolylineElement(d[c],a);b.push(e)}return b};a.prototype.drawPolygon=function(a){return this._addPolygonElement(a.getPoints(),a)};a.prototype.drawPolygons=
function(a){for(var b=[],c=0,d=a.getPolygons();c<d.length;c++){var e=this._addPolygonElement(d[c],a);b.push(e)}return b};a.prototype.drawRectangle=function(a){return this._addRectangleElement(a.getPosition(),a.getSize(),a)};a.prototype.drawRectangles=function(a){for(var b=[],c=0,d=a.getRectangles();c<d.length;c++){var e=d[c];e=this._addRectangleElement(e.position,e.size,a);b.push(e)}return b};a.prototype.drawTextBox=function(a){return this._addTextBoxElement(a.getTextString(),a.getPosition(),a)};
a.prototype.drawTextBoxes=function(a){for(var b=[],c=0,d=a.getStrings();c<d.length;c++){var e=d[c];e=this._addTextBoxElement(e.text,e.position,a);b.push(e)}return b};a.prototype._addTextBoxElement=function(a,b,d){var c=this.measureText(a,d.getTextPortion());c.x+=2*d.getPadding();c.y+=2*d.getPadding();var f=[];c=this._addRectangleElement(b,c,d.getBoxPortion(),!0);f.push(c);b=b.copy();b.x+=d.getPadding();b.y+=d.getPadding()/2+d.getBoxPortion().getStrokeWidth();a=this._addTextElement(a,b,d.getTextPortion());
f.push(a);return f};a.prototype._renderEndcaps=function(a,b,f,e){if(null===this._svgDefsElement)throw new d.CommunicatorError("canvas not set");f.getStartEndcapType()===d.Markup.Shape.EndcapType.Arrowhead?(f.getEndcapsInverted()?(a=g.Util.createEndArrowMarker(f.getStartEndcapSize(),f.getStartEndcapColor()),a.refX.baseVal.value=f.getStartEndcapSize()):a=g.Util.createStartArrowMarker(f.getStartEndcapSize(),f.getStartEndcapColor()),e.style.markerStart="url(#"+a.id+")",this._svgDefsElement.appendChild(a)):
f.getStartEndcapType()===d.Markup.Shape.EndcapType.Circle&&(a=g.Util.createCircleMarker(a,f.getStrokeWidth(),f.getStartEndcapSize(),f.getStartEndcapColor()),this._addSVGElement(a));f.getEndEndcapType()===d.Markup.Shape.EndcapType.Arrowhead?(a=f.getEndcapsInverted()?g.Util.createStartArrowMarker(f.getEndEndcapSize(),f.getEndEndcapColor()):g.Util.createEndArrowMarker(f.getEndEndcapSize(),f.getEndEndcapColor()),e.style.markerEnd="url(#"+a.id+")",this._svgDefsElement.appendChild(a)):f.getEndEndcapType()===
d.Markup.Shape.EndcapType.Circle&&(a=g.Util.createCircleMarker(b,f.getStrokeWidth(),f.getEndEndcapSize(),f.getEndEndcapColor()),this._addSVGElement(a))};a.prototype._createTextElement=function(a,b,d){var c=document.createElementNS(g.Util.svgNamespace,"text"),f=0;for(a=a.split("\n");f<a.length;f++){var e=a[f],h=document.createElementNS(g.Util.svgNamespace,"tspan");h.textContent=e;h.setAttributeNS(null,"x",""+b.x);h.setAttributeNS(null,"dy","1.2em");c.appendChild(h)}(f=d.getFontFamily())&&c.setAttributeNS(null,
"font-family",f);c.setAttributeNS(null,"font-size",d.getFontSize().toString());c.setAttributeNS(null,"x",""+b.x);c.setAttributeNS(null,"y",""+b.y);this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);return c};a.prototype._addTextElement=function(a,b,d){a=this._createTextElement(a,b,d);this._addSVGTextItemElement(a);return a};a.prototype._addRectangleElement=function(a,b,d,e){void 0===e&&(e=!1);var c=document.createElementNS(g.Util.svgNamespace,"rect");c.setAttributeNS(null,"x",
a.x.toString());c.setAttributeNS(null,"y",a.y.toString());c.setAttributeNS(null,"width",b.x.toString());c.setAttributeNS(null,"height",b.y.toString());a=d.getBorderRadius();0<a&&(c.setAttributeNS(null,"rx",a.toString()),c.setAttributeNS(null,"ry",a.toString()));this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);e?this._addSVGTextItemElement(c):this._addSVGElement(c);return c};a.prototype._addLineElement=function(a,b,d){var c=document.createElementNS(g.Util.svgNamespace,"line");
c.setAttributeNS(null,"x1",a.x.toString());c.setAttributeNS(null,"y1",a.y.toString());c.setAttributeNS(null,"x2",b.x.toString());c.setAttributeNS(null,"y2",b.y.toString());this._setGenericStrokeAttributes(c,d);this._addSVGElement(c);this._renderEndcaps(a,b,d,c);return c};a.prototype._addPolygonElement=function(a,b){a=g.Util.svgPointString(a);var c=document.createElementNS(g.Util.svgNamespace,"polygon");c.setAttributeNS(null,"points",a);this._setGenericStrokeAttributes(c,b);this._setGenericFillAttributes(c,
b);this._addSVGElement(c);return c};a.prototype._addPolylineElement=function(a,b){var c=g.Util.svgPointString(a),d=document.createElementNS(g.Util.svgNamespace,"polyline");d.setAttributeNS(null,"points",c);d.setAttributeNS(null,"fill","none");this._renderEndcaps(a[0],a[a.length-1],b,d);this._setGenericStrokeAttributes(d,b);this._addSVGElement(d);return d};a.prototype._addCircleNode=function(a,b,d){var c=document.createElementNS(g.Util.svgNamespace,"circle");c.setAttributeNS(null,"cx",a.x.toString());
c.setAttributeNS(null,"cy",a.y.toString());c.setAttributeNS(null,"r",b.toString());this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);this._addSVGElement(c);return c};a.prototype._setGenericFillAttributes=function(a,b){a.setAttributeNS(null,"fill",g.Util.svgColorRgbString(b.getFillColor()));a.setAttributeNS(null,"fill-opacity",b.getFillOpacity().toString())};a.prototype._setGenericStrokeAttributes=function(a,b){a.setAttributeNS(null,"stroke",g.Util.svgColorRgbString(b.getStrokeColor()));
a.setAttributeNS(null,"stroke-width",b.getStrokeWidth().toString())};a.prototype._addSVGTextItemElement=function(a){this._svgTextElements.push(a)};a.prototype._addSVGElement=function(a){this._svgElements.push(a)};return a}();g.SVGMarkupRenderer=a})(h.SVG||(h.SVG={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){function e(a){return"rgb("+a.r+", "+a.g+", "+a.b+")"}a.svgNamespace="http://www.w3.org/2000/svg";a.svgColorRgbString=e;a.svgPointString=function(a){for(var b="",c=0;c<a.length;c++)c&&(b+=" "),b+=a[c].x+","+a[c].y;return b};a.createStartArrowMarker=function(c,b){var f=1.1*c,g=new d.Point2(f,0),l=new d.Point2(f,c),h=new d.Point2(0,c/2),m=document.createElementNS(a.svgNamespace,"marker");m.id=d.UUID.create();m.markerWidth.baseVal.value=f;m.markerHeight.baseVal.value=
c;m.setOrientToAuto();m.refY.baseVal.value=c/2;c="M"+g.x+","+g.y+" L"+l.x+","+l.y+" L"+h.x+","+h.y+" Z";f=document.createElementNS(a.svgNamespace,"path");f.setAttribute("d",c);f.setAttributeNS(null,"fill",e(b));m.appendChild(f);return m};a.createEndArrowMarker=function(c,b){var f=1.1*c,g=d.Point2.zero(),l=new d.Point2(0,c),h=new d.Point2(f,c/2),m=document.createElementNS(a.svgNamespace,"marker");m.id=d.UUID.create();m.markerWidth.baseVal.value=f;m.markerHeight.baseVal.value=c;m.setOrientToAuto();
m.refY.baseVal.value=c/2;m.refX.baseVal.value=c;c="M"+g.x+","+g.y+" L"+l.x+","+l.y+" L"+h.x+","+h.y+" Z";f=document.createElementNS(a.svgNamespace,"path");f.setAttribute("d",c);f.setAttributeNS(null,"fill",e(b));m.appendChild(f);return m};a.createCircleMarker=function(c,b,d,g){d/=2;g=e(g);var f=document.createElementNS(a.svgNamespace,"circle");f.setAttributeNS(null,"cx",c.x.toString());f.setAttributeNS(null,"cy",c.y.toString());f.setAttributeNS(null,"r",d.toString());f.setAttributeNS(null,"fill",
g);0<b&&(f.setAttributeNS(null,"stroke-width",b.toString()),f.setAttributeNS(null,"stroke",g));return f}})(g.Util||(g.Util={}))})(h.SVG||(h.SVG={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._points=[];return b}__extends(c,a);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(b){this._points.push(b.copy())};return c}(d.FilledShape);d.Polygon=a;a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._polygons=[];return b}__extends(c,a);c.prototype.clear=function(){this._polygons=
[]};c.prototype.createPolygon=function(){var b=[];this._polygons.push(b);return b};c.prototype.getPolygons=function(){return this._polygons};return c}(d.FilledShape);d.PolygonCollection=a})(d.Shape||(d.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._points=[];return b}__extends(c,a);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(b){this._points.push(b.copy())};return c}(d.EndcapShape);d.Polyline=a;a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._polylines=[];return b}__extends(c,a);c.prototype.clear=function(){this._polylines=
[]};c.prototype.createPolyline=function(){var b=[];this._polylines.push(b);return b};c.prototype.getPolylines=function(){return this._polylines};return c}(d.EndcapShape);d.PolylineCollection=a})(d.Shape||(d.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b,a){var c=Math.abs(b.x);var f=Math.abs(b.y),e=Math.abs(b.z);c=c<=f&&c<=e?new d.Point3(1,0,0):f<=c&&f<=e?new d.Point3(0,1,0):new d.Point3(0,0,1);b=d.Point3.cross(c,b);return a?(a.assign(b),a):b}function a(b,a,c,d){var f=c.normal.x*(a.x-b.x)+c.normal.y*(a.y-b.y)+c.normal.z*(a.z-b.z);if(1E-5>Math.abs(f))return!1;c=-(c.d+c.normal.x*b.x+c.normal.y*b.y+c.normal.z*b.z)/f;d.x=b.x+c*(a.x-b.x);d.y=b.y+c*(a.y-b.y);d.z=b.z+c*(a.z-b.z);return 0>c||1<c?!1:!0}function e(b){if(.01>
Math.abs(b-25.4/72))return"points";if(.01>Math.abs(b-25.4))return"inch";if(.01>Math.abs(b-1))return"mm";if(.01>Math.abs(b-10))return"cm";if(.01>Math.abs(b-25.4/6))return"picas";if(.01>Math.abs(b-12*25.4))return"ft";if(.01>Math.abs(b-914.4))return"yd";if(.01>Math.abs(b-1E3))return"m";if(.01>Math.abs(b-1E6))return"km";if(.01>Math.abs(b-1609344))return"mi";console.log("warning: unit multiplier doesn't map to known type: unit="+b);return""}function c(b){return Math.PI/180*b}function b(b){return 180/Math.PI*
b}function f(b,a,f){b=b.copy().normalize();var e=c(a);a=Math.cos(e);e=Math.sin(e);var g=1-a,k=g*b.x*b.y,l=g*b.x*b.z,h=g*b.y*b.z;void 0===f&&(f=new d.Matrix);f.m[0]=g*b.x*b.x+a;f.m[1]=e*b.z+k;f.m[2]=l-e*b.y;f.m[3]=0;f.m[4]=k-e*b.z;f.m[5]=g*b.y*b.y+a;f.m[6]=e*b.x+h;f.m[7]=0;f.m[8]=e*b.y+l;f.m[9]=h-e*b.x;f.m[10]=g*b.z*b.z+a;f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;return f}function k(b,a,c){a=d.Point3.subtract(a,b);b=d.Point3.subtract(c,b);b=d.Point3.dot(b,a)/a.squaredLength();return Math.max(0,
Math.min(1,b))}function l(b,a){var c="";switch(b){case .3048:c="ft";break;case .0254:c="inch";break;case .001:c="m"+a;break;case .01:c="c"+a;break;case .1:c="d"+a;break;case 1:c=a;break;case 10:c="da"+a;break;case 100:c="h"+a;break;case 1E3:c="k"+a;break;case 60:c="min";break;case 3600:c="h";break;case 86400:c="d";break;case 274.15:c="\u00b0C";break;case 255.927778:c="\u00b0F";break;case .555556:c="\u00b0R"}return c}function n(b,a){var c="";switch(b){case 1E-6:c="m"+a;break;case 1E-5:c="d"+a;break;
case 1E-4:c="c"+a;break;case .001:c=a;break;case .01:c="da"+a;break;case .1:c="h"+a;break;case 1:c="k"+a;break;case 100:c="q";break;case 1E3:c="t"}return c}h.oneVectorCross=g;h.intersectionPlaneLine2=a;h.computePointToLineDistance=function(b,a,c,f){var e=d.Point3.subtract(c,a),g=e.squaredLength(),k=0;0<g&&(k=((b.x-a.x)*(c.x-a.x)+(b.y-a.y)*(c.y-a.y)+(b.z-a.z)*(c.z-a.z))/g);e.set(e.x*k,e.y*k,e.z*k);f.set(a.x+e.x,a.y+e.y,a.z+e.z);new d.Point3(0,0,0);return d.Point3.subtract(b,f).length()};h.formatWithUnit=
function(b,a){a=e(a);for(var c,d=2;9>d&&(c=b.toFixed(d),0===parseFloat(c));d++);0===parseFloat(c)&&(c="0");return c+a};h.degreesToRadians=c;h.radiansToDegrees=b;h.computeOffaxisRotation=f;h.intersect3d2Planes=function(b,a,c,f,e,g){var k=d.Point3.cross(b.normal,c.normal),l=Math.abs(k.x),h=Math.abs(k.y),n=Math.abs(k.z);if(1E-7>l+h+n)return c=d.Point3.subtract(f,a),0===d.Point3.dot(b.normal,c)?1:0;l=l>h?l>n?1:3:h>n?2:3;h=d.Point3.zero();a=-d.Point3.dot(b.normal,a);f=-d.Point3.dot(c.normal,f);switch(l){case 1:h.x=
0;h.y=(f*b.normal.z-a*c.normal.z)/k.x;h.z=(a*c.normal.y-f*b.normal.y)/k.x;break;case 2:h.x=(a*c.normal.z-f*b.normal.z)/k.y;h.y=0;h.z=(f*b.normal.x-a*c.normal.x)/k.y;break;case 3:h.x=(f*b.normal.y-a*c.normal.y)/k.z,h.y=(a*c.normal.x-f*b.normal.x)/k.z,h.z=0}e.assign(h);g.set(h.x+k.x,h.y+k.y,h.z+k.z);return 2};h.intersectionPlaneLine=function(b,c,f,e,g,k){var l=new d.Plane;l.normal.x=(e.y-f.y)*(g.z-f.z)-(e.z-f.z)*(g.y-f.y);l.normal.y=(e.z-f.z)*(g.x-f.x)-(e.x-f.x)*(g.z-f.z);l.normal.z=(e.x-f.x)*(g.y-
f.y)-(e.y-f.y)*(g.x-f.x);l.normal.normalize();l.d=-l.normal.x*f.x-l.normal.y*f.y-l.normal.z*f.z;return a(b,c,l,k)};h.computeAngleBetweenVector=function(a,c){a=a.copy().normalize();var f=c.copy().normalize();c=d.Point3.cross(a,f).length();a=d.Point3.dot(a,f);return b(Math.atan2(c,a))};h.generatePointsOnCircle=function(b,a,c,f,e){for(var k=2*Math.PI/f,l=0;l<f;l++)b[l]=new d.Point3(0,c*Math.cos(k*l),c*Math.sin(k*l));b[f]=b[0].copy();c=g(e);c.normalize();k=d.Point3.cross(c,e);k.normalize();l=new d.Matrix;
var h=l.m;h[0]=e.x;h[1]=e.y;h[2]=e.z;h[3]=0;h[4]=c.x;h[5]=c.y;h[6]=c.z;h[7]=0;h[8]=k.x;h[9]=k.y;h[10]=k.z;h[11]=0;h[12]=0;h[13]=0;h[14]=0;h[15]=1;l.transformArray(b,b);for(l=0;l<=f;l++)b[l].set(b[l].x+a.x,b[l].y+a.y,b[l].z+a.z)};h.distanceLineLine=function(b,a,c,f,e,g){var k=0,l=0,h=d.Point3.subtract(a,b),n=d.Point3.subtract(f,c),m=d.Point3.dot(h,b),p=d.Point3.dot(h,n),q=d.Point3.dot(h,h),r=d.Point3.dot(h,c),t=d.Point3.dot(n,n),u=d.Point3.dot(n,c),E=d.Point3.dot(n,b);f=d.Point3.dot(h,f);var G=d.Point3.dot(n,
a),H=q*t-p*p;0===H?(0!==q?(r=(r-m)/q,0>r?r=0:1<r&&(r=1),m=(f-m)/q,0>m?m=0:1<m&&(m=1)):m=r=0,0!==t?(E=(E-u)/t,0>E?E=0:1<E&&(E=1),t=(G-u)/t,0>t?t=0:1<t&&(t=1)):t=E=0,k=(r+m)/2,l=(E+t)/2):(a=(p*E-p*u-t*m+t*r)/H,p=(q*E-q*u+p*r-p*m)/H,r=(r-m)/q,E=(E-u)/t,m=(f-m)/q,t=(G-u)/t,0<=a&&1>=a&&0<=p&&1>=p?(k=a,l=p):0>a&&0<=p&&1>=p?(k=a,l=E):1<a&&0<=p&&1>=p?(k=a,l=t):0<=a&&1>=a&&0>p?(k=r,l=p):0<=a&&1>=a&&1<p?(k=m,l=p):0>a&&0>p?(k=r,l=E):0>a&&1<p?(k=m,l=E):1<a&&0>p?(k=r,l=t):1<a&&1<p&&(k=m,l=t),0>k?k=0:1<k&&(k=1),
0>l?l=0:1<l&&(l=1));e.x=k*h.x+b.x;e.y=k*h.y+b.y;e.z=k*h.z+b.z;g.x=l*n.x+c.x;g.y=l*n.y+c.y;g.z=l*n.z+c.z;return d.Point3.subtract(g,e).length()};h.lineLineIntersect=function(b,a,c,f){var e=d.Point3.zero(),g=d.Point3.zero(),k=d.Point3.zero(),l=d.Point3.zero(),h=d.Point3.zero();k.x=b.x-c.x;k.y=b.y-c.y;k.z=b.z-c.z;l.x=f.x-c.x;l.y=f.y-c.y;l.z=f.z-c.z;if(1E-12>Math.abs(l.x)&&1E-12>Math.abs(l.y)&&1E-12>Math.abs(l.z))return null;h.x=a.x-b.x;h.y=a.y-b.y;h.z=a.z-b.z;if(1E-12>Math.abs(h.x)&&1E-12>Math.abs(h.y)&&
1E-12>Math.abs(h.z))return null;a=k.x*l.x+k.y*l.y+k.z*l.z;f=l.x*h.x+l.y*h.y+l.z*h.z;var n=k.x*h.x+k.y*h.y+k.z*h.z;k=l.x*l.x+l.y*l.y+l.z*l.z;var m=(h.x*h.x+h.y*h.y+h.z*h.z)*k-f*f;if(1E-12>Math.abs(m))return null;n=(a*f-n*k)/m;a=(a+f*n)/k;e.x=b.x+n*h.x;e.y=b.y+n*h.y;e.z=b.z+n*h.z;g.x=c.x+a*l.x;g.y=c.y+a*l.y;g.z=c.z+a*l.z;return e};h.closestPointScalarFromPointToSegment=k;h.closestPointFromPointToSegment=function(b,a,c){c=k(b,a,c);a=d.Point3.subtract(a,b).scale(c);return d.Point3.add(b,a)};h.isPointOnLineSegment=
function(b,a,c,f){var e=k(b,a,c);if(0>e||1<e)return!1;a=d.Point3.subtract(a,b).scale(e);b=d.Point3.add(b,a);return d.Point3.subtract(b,c).squaredLength()<=f*f};h.isPointOnLineSegment2d=function(b,a,c,f){var e=d.Point2.subtract(c,a);var g=e.length();e.scale(((b.x-a.x)*(c.x-a.x)+(b.y-a.y)*(c.y-a.y))/(g*g));e=d.Point2.add(a,e);return d.Point2.distance(b,e)<=f?e.x<Math.min(a.x,c.x)||e.x>Math.max(a.x,c.x)||e.y<Math.min(a.y,c.y)||e.y>Math.max(a.y,c.y)?!1:!0:!1};h.isPointInRect2d=function(b,a,c,d){void 0===
d&&(d=0);return b.x+d<a.x||b.x>a.x+c.x+d||b.y+d<a.y||b.y>a.y+c.y+d?!1:!0};h.generateArcPoints=function(b,a,c,e,g){var k=[],l=d.Point3.zero(),h=new d.Matrix;a/=g;for(var n=0,m=0;n<=g;++n,m+=a)f(b,m,h),h.transform(e,l),k.push(d.Point3.add(c,l));return k};h.getLongUnitString=function(b){b=b.sort(function(b,a){return b.exponent<a.exponent?1:-1});for(var a="",c=0;c<b.length;c++){switch(b[c].basicUnit){case d.BasicUnit.unitLength:a+=l(b[c].factor,"m");break;case d.BasicUnit.unitMass:a+=n(b[c].factor,"g");
break;case d.BasicUnit.unitTime:a+=l(b[c].factor,"s");break;case d.BasicUnit.unitElectricCurrent:a+=l(b[c].factor,"A");break;case d.BasicUnit.unitThermoTemperature:a+=l(b[c].factor,"K");break;case d.BasicUnit.unitSubstanceAmount:a+=l(b[c].factor,"mol");break;case d.BasicUnit.unitLuminosityIntensity:a+=l(b[c].factor,"cd");break;case d.BasicUnit.unitPlaneAngle:a+=l(b[c].factor,"rad");break;case d.BasicUnit.unitSolidAngle:a+=l(b[c].factor,"sr");break;case d.BasicUnit.unitFrequency:a+=l(b[c].factor,"Hz");
break;case d.BasicUnit.unitForce:a+=l(b[c].factor,"N");break;case d.BasicUnit.unitPressure:a+=l(b[c].factor,"Pa");break;case d.BasicUnit.unitEnergy:a+=l(b[c].factor,"J");break;case d.BasicUnit.unitPower:a+=l(b[c].factor,"W");break;case d.BasicUnit.unitElectricCharge:a+=l(b[c].factor,"C");break;case d.BasicUnit.unitElectromotiveForce:a+=l(b[c].factor,"V");break;case d.BasicUnit.unitCapacitance:a+=l(b[c].factor,"F");break;case d.BasicUnit.unitElectricResistance:a+=l(b[c].factor,d.Internal.Unicode.Ohm);
break;case d.BasicUnit.unitElectricConductance:a+=l(b[c].factor,"S");break;case d.BasicUnit.unitMagneticFlux:a+=l(b[c].factor,"Wb");break;case d.BasicUnit.unitMagneticFluxDensity:a+=l(b[c].factor,"T");break;case d.BasicUnit.unitInductance:a+=l(b[c].factor,"H");break;case d.BasicUnit.unitLuminousFlux:a+=l(b[c].factor,"lm");break;case d.BasicUnit.unitIlluminance:a+=l(b[c].factor,"lx");break;case d.BasicUnit.unitActivityRadionuclide:a+=l(b[c].factor,"Bq");break;case d.BasicUnit.unitKerma:a+=l(b[c].factor,
"Gy");break;case d.BasicUnit.unitDoseEquivalent:a+=l(b[c].factor,"Sv");break;case d.BasicUnit.unitCatalyticActivity:a+=l(b[c].factor,"kat")}switch(b[c].exponent){case 2:a+=d.Internal.Unicode.Subscript2;break;case 3:a+=d.Internal.Unicode.Subscript3;break;case -1:a+=d.Internal.Unicode.SubscriptNeg;a+=d.Internal.Unicode.Subscript1;break;case -2:a+=d.Internal.Unicode.SubscriptNeg;a+=d.Internal.Unicode.Subscript2;break;case -3:a+=d.Internal.Unicode.SubscriptNeg,a+=d.Internal.Unicode.Subscript3}c+1<b.length&&
(a+=".")}return a}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e){this.origin=d.Point3.zero();this.direction=new d.Point3(0,0,1);a&&this.origin.assign(a);e&&this.direction.assign(e)}g.prototype.copy=function(){return new g(this.origin,this.direction)};g.prototype.assign=function(a){this.origin.assign(a.origin);this.direction.assign(a.direction);return this};g.prototype.negate=function(){this.direction.negate();return this};return g}();d.Ray=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this.normal=d.Point3.zero();this.d=0}g.prototype.setFromPointAndNormal=function(a,e){this.normal.assign(e);this.d=-d.Point3.dot(e,a);return this};g.prototype.setFromPoints=function(a,e,c){this.normal=d.Point3.cross(d.Point3.subtract(e,a),d.Point3.subtract(c,a)).normalize();this.d=-d.Point3.dot(a,this.normal)};g.prototype.setFromCoefficients=function(a,d,c,b){this.normal.set(a,d,c);this.d=b};g.prototype.getCoefficients=function(){var a=this.normal;return[a.x,
a.y,a.z,this.d]};g.prototype.distanceToPoint=function(a){return d.Point3.dot(this.normal,a)+this.d};g.prototype.rayIntersection=function(a){var e=d.Point3.zero();return this.intersectsRay(a,e)?e:null};g.prototype.intersectsRay=function(a,e){var c=d.Point3.dot(this.normal,a.direction),b=this.distanceToPoint(a.origin),f=-b/c;return 0<=f&&0<Math.abs(c)?(e&&(c=a.direction.copy().scale(f),e.set(a.origin.x+c.x,a.origin.y+c.y,a.origin.z+c.z)),!0):0<=f&&0>=Math.abs(b)?(e&&e.assign(a.origin),!0):!1};g.prototype.determineSide=
function(a){return 0<this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z+this.d?!0:!1};g.prototype.copy=function(){var a=new g;a.normal.assign(this.normal);a.d=this.d;return a};g.prototype.assign=function(a){this.normal.assign(a.normal);this.d=a.d};g.prototype.equals=function(a){return this.normal.equals(a.normal)&&this.d===a.d};g.createFromPointAndNormal=function(a,d){return(new g).setFromPointAndNormal(a,d)};g.createFromPoints=function(a,d,c){var b=new g;b.setFromPoints(a,d,c);return b};g.createFromCoefficients=
function(a,d,c,b){var f=new g;f.setFromCoefficients(a,d,c,b);return f};return g}();d.Plane=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b}d.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this};d.prototype.set=function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b};d.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};d.zero=function(){return new d(0,0,0,0)};return d}();d.Point4=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,b){this._button=a;this._modifier=b}a.prototype.getButton=function(){return this._button};a.prototype.getModifier=function(){return this._modifier};return a}();h.ButtonModifier=g;var a=function(){function a(a){this._ptFirst=d.Point2.zero();this._ptPrevious=d.Point2.zero();this._ptCurrent=d.Point2.zero();this._dragging=!1;this._dragCount=0;this._primaryTouchId=null;this._mapping=[];this._buttonModifierActive=!1;this._doubleClickInterval=200;this._firstMouseDownTime=
null;this._isDoubleClick=!1;this._viewer=a}a.prototype.onDoubleClick=function(a){};a.prototype.onMouseDown=function(a){this._firstMouseDownTime?Date.now()-this._firstMouseDownTime<this._doubleClickInterval?(this._isDoubleClick=!0,this._firstMouseDownTime=null):this._firstMouseDownTime=Date.now():(this._firstMouseDownTime=Date.now(),this._isDoubleClick=!1);if(this._isDoubleClick)this.onDoubleClick(a);else{if(this._buttonModifierActive=this.checkMapping(a))a=a.getPosition(),this._ptFirst.assign(a),
this._ptPrevious.assign(a),this._ptCurrent.assign(a);this._dragging=!0}};a.prototype.onMouseMove=function(a){this.isActive()&&(this._ptPrevious.assign(this._ptCurrent),this._ptCurrent.assign(a.getPosition()),this._dragging&&!this._ptCurrent.equals(this._ptPrevious)&&(++this._dragCount,1===this._dragCount&&this._viewer.trigger("beginInteraction")))};a.prototype.onMouseUp=function(a){this._buttonModifierActive&&this.stopInteraction();this._dragging=!1;this._dragCount=0};a.prototype.stopInteraction=
function(){this._viewer.trigger("endInteraction");this._dragging=!1;this._dragCount=0;this._buttonModifierActive=!1};a.prototype.isDragging=function(){return this._dragging};a.prototype.isActive=function(){return(this._buttonModifierActive||null!==this._primaryTouchId)&&!this._isDoubleClick&&!this._viewer.getContextMenuStatus()};a.prototype.onTouchStart=function(a){if(null===this._primaryTouchId){this._primaryTouchId=a.getId();var b=a.getPosition();b=new d.Event.MouseInputEvent(b.x,b.y,d.Button.None,
a.getButtons(),d.KeyModifiers.None,d.MouseInputType.Down);this.onMouseDown(b)}a.setHandled(this.setHandled())};a.prototype.onTouchMove=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(f){switch(f.label){case 0:if(this._primaryTouchId!==a.getId())return[3,2];b=a.getPosition();c=new d.Event.MouseInputEvent(b.x,b.y,d.Button.None,a.getButtons(),d.KeyModifiers.None,d.MouseInputType.Move);return[4,this.onMouseMove(c)];case 1:f.sent(),f.label=2;case 2:return a.setHandled(this.setHandled()),
[2,Promise.resolve()]}})})};a.prototype.onTouchEnd=function(a){if(this._primaryTouchId===a.getId()){var b=a.getPosition();b=new d.Event.MouseInputEvent(b.x,b.y,d.Button.None,a.getButtons(),d.KeyModifiers.None,d.MouseInputType.Up);this.onMouseUp(b);this._primaryTouchId=null}a.setHandled(this.setHandled())};a.prototype.addMapping=function(a,b){void 0===b&&(b=d.KeyModifiers.None);this._mapping.push(new g(a,b))};a.prototype.clearMapping=function(){this._mapping=[]};a.prototype.setMapping=function(a,b){void 0===
b&&(b=d.KeyModifiers.None);this._mapping=[];this._mapping.push(new g(a,b))};a.prototype.checkMapping=function(a){if(0===this._mapping.length)return!0;for(var b=0,c=this._mapping;b<c.length;b++){var d=c[b];if(d.getButton()===a.getButton()&&d.getModifier()===a.getModifiers())return!0}return!1};a.prototype.setHandled=function(){return!1};a.prototype.onDeactivate=function(){var a=this.stopInteraction();this._primaryTouchId=null;return a};return a}();h.OperatorBase=a})(d.Operator||(d.Operator={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;b._rectangleMarkup=new h.SelectionRectangleMarkup(c,!1);b._incrementalSelection=d.Util.IncrementalSelection.create("SelectionManager",c);c.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.clearSelection()];case 1:return b.sent(),[2,this.waitForIdle()]}})})}});
return b}__extends(e,a);e.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};e.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};e.prototype.hasActiveSelection=function(){return!this._incrementalSelection.isIdle()};e.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.waitForIdle()]})})};e.prototype.clearSelection=
function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.clearSelection()]})})};e.prototype._allowSelection=function(a,b){return a.x===b.x||a.y===b.y?!1:!0};e.prototype._createBeginConfig=function(a,b,f){var c=new d.IncrementalPickConfig;c.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;c.ignoreCuttingSections=!1;c.ignoreUnrequestedInstances=!0;f&&(c.mustBeFullyContained=!0);return{pickConfig:c,areaCssMin:a,
areaCssMax:b}};e.prototype._performSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return b=this._rectangleMarkup.min.copy(),c=this._rectangleMarkup.max.copy(),e=this._rectangleMarkup.initialPosition.x<this._rectangleMarkup.currentPosition.x,a?[4,this.clearSelection()]:[3,2];case 1:f.sent(),f.label=2;case 2:if(!this._allowSelection(b,c))return[2];g=this._createBeginConfig(b,c,e);f.label=3;case 3:return f.trys.push([3,
5,,6]),[4,this._incrementalSelection.performSelection(g)];case 4:return[2,f.sent()];case 5:h=f.sent();if(!(h instanceof d.SelectionInvalidatedError))throw h;return[3,6];case 6:return[2]}})})};e.prototype.setHandled=function(){return!0};e.prototype.onKeyUp=function(a){a.getKeyCode()===d.KeyCode.Escape&&this.clearSelection()};e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);this.isActive()&&(c.setHandled(!0),this._rectangleMarkup.isActive()&&this._rectangleMarkup.deactivate(),
this._rectangleMarkup.activate(c.getPosition()))};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);this.isActive()&&this._rectangleMarkup.isActive()&&(c.setHandled(!0),this._rectangleMarkup.updateCurrentPosition(c.getPosition()),this._viewer.markupManager.refreshMarkup())};e.prototype.onMouseUp=function(c){if(this.isActive()&&this._rectangleMarkup.isActive()){c.setHandled(!0);this._rectangleMarkup.updateCurrentPosition(c.getPosition());var b=!c.controlDown();this._performSelection(b)}this._rectangleMarkup.isActive()&&
this._rectangleMarkup.deactivate();a.prototype.onMouseUp.call(this,c)};return e}(h.OperatorBase);h.AreaSelectionOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._axisTriad=c.view.getAxisTriad();b._pickConfig=new d.PickConfig(d.SelectionMask.Face);b._pickConfig.restrictToOverlays=!0;return b}__extends(e,a);e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){switch(f.label){case 0:return this._axisTriad.getEnabled()&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()&&this._axisTriad.insideOverlay(c.getPosition())?
[4,this._viewer.view.pickFromPoint(this._ptFirst,this._pickConfig)]:[3,3];case 1:return b=f.sent(),[4,this._axisTriad.onClickSelection(b)];case 2:f.sent(),f.label=3;case 3:return a.prototype.onMouseUp.call(this,c),[2]}})})};return e}(h.OperatorBase);h.AxisTriadOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){return function(a,c,b,d,g){this.section=a;this.node=c;this.planeIndex=b;this.plane=d;this.selectionPosition=g;this.origPlaneD=d.d}}(),a=function(a){function c(b,c){b=a.call(this,b)||this;b._context=null;b._cuttingManager=c;return b}__extends(c,a);c.prototype.onMouseDown=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return a.prototype.onMouseDown.call(this,b),null===this._context&&this.isActive()&&
this._cuttingManager.hasActiveCuttingSection()?[4,this._startSelection(b)]:[3,2];case 1:c.sent(),b.setHandled(null!==this._context),c.label=2;case 2:return[2]}})})};c.prototype.onMouseMove=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:a.prototype.onMouseMove.call(this,b);c=this._context;if(!this.isActive()||null===c)return[3,2];b.setHandled(!0);return[4,this._updatePlane(b.getPosition(),c,!1)];case 1:d.sent(),this._viewer.trigger("cuttingPlaneDrag",
c.section,c.planeIndex),d.label=2;case 2:return[2]}})})};c.prototype._updatePlane=function(b,a,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h,r,t,u,w;return __generator(this,function(l){switch(l.label){case 0:f=a.selectionPosition;e=a.plane.normal.copy().add(a.selectionPosition);g=this._viewer.view.unprojectPoint(b,0);k=this._viewer.view.unprojectPoint(b,.5);if(null===g||null===k)return[3,3];h=d.Util.lineLineIntersect(f,e,g,k);if(null===h)return[3,2];r=d.Point3.subtract(h,a.selectionPosition);
t=0>d.Point3.dot(r,a.plane.normal)?r.length():-r.length();a.plane.d=a.origPlaneD+t;u=a.plane.normal.copy().scale(-t);w=(new d.Matrix).setTranslationComponent(u.x,u.y,u.z);return[4,a.section.updatePlane(a.planeIndex,a.plane,w,c,!1)];case 1:l.sent(),l.label=2;case 2:this._cuttingManager.delayCapping(),l.label=3;case 3:return[2]}})})};c.prototype.onMouseUp=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:c=this._context;if(!this.isActive()||
null===c)return[3,2];b.setHandled(!0);return[4,this._updatePlane(b.getPosition(),c,!0)];case 1:d.sent(),this._viewer.trigger("cuttingPlaneDragEnd",c.section,c.planeIndex),d.label=2;case 2:return this._context=null,a.prototype.onMouseUp.call(this,b),[2]}})})};c.prototype.setHandled=function(){return this.isActive()&&null!==this._context};c.prototype._startSelection=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,h,m,p,q,r;return __generator(this,function(f){switch(f.label){case 0:return this._context=
null,a=b.getPosition(),c=d.SelectionMask.Face|d.SelectionMask.Line,e=new d.PickConfig(c),e.ignoreCappingGeometry=!0,e.forceEffectiveSceneVisibilityMask=d.SelectionMask.Face,[4,this._viewer.view.compositePickFromPoint(a,e)];case 1:h=f.sent();m=h.fetchMostRelevant(c);if(null===m)return[2];p=m.getNodeId();q=this._cuttingManager.getCuttingSectionFromNodeId(p);null!==q&&(r=q.getPlaneIndexByNodeId(p),this._context=new g(q,p,r,q.getPlane(r),m.getPosition()),this._cuttingManager.delayCapping(),this._viewer.trigger("cuttingPlaneDragStart",
q,r));return[2]}})})};return c}(h.OperatorBase);h.CuttingPlaneOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._draggingAvatar=!1;b._restrictToAvatar=!0;b._floorLocked=!1;b._manager=c.floorplanManager;return b}__extends(e,a);e.prototype.onMouseDown=function(c){return __awaiter(this,void 0,void 0,function(){var b,f,e,g;return __generator(this,function(k){switch(k.label){case 0:a.prototype.onMouseDown.call(this,c);if(!this._manager.isActive())return[2];b=c.getPosition();if(this._restrictToAvatar)return[3,1];f=this._manager.insideOverlay(b);
return[3,3];case 1:return e=new d.PickConfig,e.restrictToOverlays=!0,[4,this._viewer.view.pickFromPoint(b,e)];case 2:g=k.sent(),f=g.getNodeId()===this._manager.getAvatarNodeId(),k.label=3;case 3:if(!f)return[3,5];this._draggingAvatar=!0;this._floorLocked=this._manager.getFloorLock();return[4,this._manager.setFloorLock(!0)];case 4:k.sent(),this._manager.snapAvatarToPoint(b),c.setHandled(!0),k.label=5;case 5:return[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return a.prototype.onMouseUp.call(this,c),this._draggingAvatar?[4,this._manager.setFloorLock(this._floorLocked)]:[3,2];case 1:b.sent(),b.label=2;case 2:return this._draggingAvatar=!1,[2]}})})};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);this._manager.isActive()&&this._draggingAvatar&&(c.setHandled(!0),c=c.getPosition(),this._manager.insideOverlay(c)&&this._manager.snapAvatarToPoint(c))};e.prototype.restrictToAvatar=function(a){this._restrictToAvatar=
a};return e}(h.OperatorBase);h.FloorplanOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._draggingHandle=!1;b._newRotationMatrix=new d.Matrix;b._translation=d.Point3.zero();b._newTranslation=d.Point3.zero();b._nodeIdGroupMap=new Map;b._groupIdCount=0;b._activeChildrenGroupIds=new Map;b._initialLocalNodeMatrices=[];b._newLocalNodeMatrices=[];b._trackedPoints=[];b._trackedPointsPositions=[];b._trackedPointCount=0;b._previousContextClick=!1;b._overlayIndex=null;b._activeHandleNodeId=null;b._handleEventType=
d.HandleEventType.Translate;b._highlightedHandleId=null;b._handleSize=1;b._explodeActive=!1;b._measureActive=!1;b._settingMatrixInProgress=!1;b._handleMarkup=new d.Markup.HandleMarkup(c);b._pickConfig=new d.PickConfig(d.SelectionMask.Face);b._pickConfig.restrictToOverlays=!0;c.setCallbacks({explode:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return(this._explodeActive=0<a)?[4,this.removeHandles()]:[3,2];case 1:b.sent(),b.label=
2;case 2:return[2]}})})},measurementBegin:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._measureActive=!0,[4,this.removeHandles()];case 1:return b.sent(),[2]}})})},measurementCreated:function(){b._measureActive=!1},measurementDeleted:function(){b._measureActive=!1}});return b}__extends(e,a);e.prototype.setAxisMeshData=function(a){return this._handleMarkup.setAxisMeshData(a)};e.prototype.setPlaneMeshData=function(a){return this._handleMarkup.setPlaneMeshData(a)};
e.prototype.setViewPlaneMeshData=function(a){return this._handleMarkup.setViewPlaneMeshData(a)};e.prototype.setRotateMeshData=function(a){return this._handleMarkup.setRotateMeshData(a)};e.prototype.addTrackedPoint=function(a){var b=this._trackedPointCount;this._trackedPoints[b]=a.copy();this._trackedPointsPositions[b]=a.copy();++this._trackedPointCount;return b};e.prototype.getTrackedPoints=function(){return this._trackedPointsPositions};e.prototype.clearTrackedPoints=function(){this._trackedPoints.length=
0;this._trackedPointCount=this._trackedPointsPositions.length=0};e.prototype.isEnabled=function(){return!this._explodeActive&&!this._measureActive&&!this._viewer.sheetManager.isDrawingSheetActive()};e.prototype._guardEnabled=function(){if(!this.isEnabled()){var a=this._explodeActive?"Handles are not enabled when the model is exploded":this._measureActive?"Handles are not enabled while a measurement is in progress.":this._viewer.sheetManager.isDrawingSheetActive()?"Handles are not enabled for 2d drawings.":
"Handles are not enabled.";throw new d.CommunicatorError(a);}};e.prototype.setHandleSize=function(a){this._handleSize=a};e.prototype.addHandles=function(a,b,d){void 0===b&&(b=null);void 0===d&&(d=null);return __awaiter(this,void 0,void 0,function(){var c,f;return __generator(this,function(e){switch(e.label){case 0:return this._previousContextClick=!1,this._guardEnabled(),b?[3,2]:[4,this._viewer.model.getNodesBounding(a)];case 1:return c=e.sent(),[2,this.addHandles(a,c.center())];case 2:return f=this._findGroupId(a),
null===d&&(d=null!==f?f:this.generateGroupId()),this._nodeIdGroupMap.set(d,a),null===f?[3,4]:[4,this._handleMarkup.removeHandles(d)];case 3:e.sent(),e.label=4;case 4:return[2,this._handleMarkup.addHandles(b,this._handleSize,d)]}})})};e.prototype._findGroupId=function(a){var b=null;this._nodeIdGroupMap.forEach(function(c,d){c.length===a.length&&c.every(function(b){return-1!==a.indexOf(b)})&&(b=d)});return b};e.prototype.generateGroupId=function(){return this._groupIdCount++};e.prototype._massageGroupId=
function(a){return null===a?d.Markup.HandleMarkup.defaultGroupId:a};e.prototype.addAxisTranslationHandle=function(a,b,d,e,g){void 0===e&&(e=null);void 0===g&&(g=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addAxisTranslationHandle(a,b,d,e,this._massageGroupId(g))]})})};e.prototype.addAxisRotationHandle=function(a,b,d,e,g){void 0===e&&(e=null);void 0===g&&(g=null);return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addRotateHandle(a,b,d,e,this._massageGroupId(g))]})})};e.prototype.addPlaneTranslationHandle=function(a,b,d,e,g,h){void 0===g&&(g=null);void 0===h&&(h=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addPlaneTranslationHandle(a,b,d,e,g,this._massageGroupId(h))]})})};
e.prototype.addViewPlaneTranslationHandle=function(a,b,d){void 0===d&&(d=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addViewPlaneHandle(a,b,this._massageGroupId(d))]})})};e.prototype.setNodeIds=function(a,b){void 0===b&&(b=null);this._nodeIdGroupMap.set(this._massageGroupId(b),a)};e.prototype.getNodeIds=function(a){void 0===a&&(a=null);a=this._nodeIdGroupMap.get(this._massageGroupId(a));
return void 0===a?[]:a.slice()};e.prototype.showHandles=function(){this._handleMarkup.showOverlay()};e.prototype.updatePosition=function(a,b,d,e){void 0===e&&(e=null);return this._handleMarkup.updatePosition(a,b,d,this._massageGroupId(e),this._activeChildrenGroupIds)};e.prototype.getPosition=function(){var a=this._handleMarkup.getHandleNodeIds();return 0<a.length&&(a=this._handleMarkup.getPosition(a[0]),null!==a)?a.copy():null};e.prototype.removeHandles=function(){this._newRotationMatrix=new d.Matrix;
this._translation=d.Point3.zero();this._highlightedHandleId=null;this._nodeIdGroupMap.clear();this._groupIdCount=0;return this._handleMarkup.removeHandles()};e.prototype.getTranslation=function(){return this._translation};e.prototype._initLocalNodeMatrices=function(a){var b=this._viewer.model;this._initialLocalNodeMatrices=[];for(var c=0;c<a.length;c++)this._initialLocalNodeMatrices.push(b.getNodeMatrix(a[c]))};e.prototype._getHandleEventType=function(a){return this._handleMarkup.getHandleType(a)===
d.HandleType.Rotate?d.HandleEventType.Rotate:d.HandleEventType.Translate};e.prototype._rotate=function(a,b,f,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(g){switch(g.label){case 0:if(!this._draggingHandle||this._settingMatrixInProgress)return[2];c=this.getNodeIds(e);return[4,this._genericTransform(a,b,d.Point3.zero(),f,c,e)];case 1:return g.sent(),this._viewer.trigger("handleEvent",d.HandleEventType.Rotate,c,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),
[2]}})})};e.prototype._translate=function(a,b,f){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(e){switch(e.label){case 0:if(!this._draggingHandle||this._settingMatrixInProgress)return[2];c=this.getNodeIds(f);return[4,this._genericTransform(d.Point3.zero(),0,a,b,c,f)];case 1:return e.sent(),this._viewer.trigger("handleEvent",d.HandleEventType.Translate,c,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),[2]}})})};e.prototype._genericTransform=function(a,
b,f,e,g,h){return __awaiter(this,void 0,void 0,function(){var c,k,l,n,t,u,w,v,y,x,z,A,C,B,D,F;return __generator(this,function(m){switch(m.label){case 0:this._settingMatrixInProgress=!0;c=this._viewer.model;k=new d.Matrix;this._newTranslation=f;0<a.squaredLength()&&(k=this._getRotationMatrix(a,d.Point3.zero(),b),this._newRotationMatrix=k.copy());l=[];l.push(this.updatePosition(this._newTranslation,this._newRotationMatrix,!1,h));this._newLocalNodeMatrices=[];for(n=0;n<g.length;n++)t=this._newTranslation.copy(),
u=g[n],w=this._initialLocalNodeMatrices[n].copy(),v=a.copy(),y=e.copy(),x=void 0,z=c.getNodeParent(u),null!==z?(x=c.getNodeNetMatrix(z),A=d.Matrix.inverse(x),null!==A&&(A.transform(y,y),A.setTranslationComponent(0,0,0),A.transform(v,v),A.transform(t,t))):x=null,0<a.squaredLength()&&(k=this._getRotationMatrix(v,y,x&&0>x.upperLeft3x3Determinant()?-b:b),w=d.Matrix.multiply(w,k)),w.setTranslationComponent(w.m[12]+t.x,w.m[13]+t.y,w.m[14]+t.z),l.push(c.setNodeMatrix(u,w)),this._newLocalNodeMatrices.push(w);
C=this._newRotationMatrix.copy();C.setTranslationComponent(f.x,f.y,f.z);for(n=0;n<this._trackedPoints.length;++n)B=this._trackedPoints[n].copy(),D=d.Point3.subtract(B,e),C.transform(D,D),F=d.Point3.add(D,e),this._trackedPointsPositions[n]=F;return[4,d.Util.waitForAll(l)];case 1:return m.sent(),this._settingMatrixInProgress=!1,[2]}})})};e.prototype._testRotate=function(a,b,f){void 0===f&&(f=null);return __awaiter(this,void 0,void 0,function(){var c,e;return __generator(this,function(g){switch(g.label){case 0:f=
this._massageGroupId(f);c=this._getActiveNodeIdByGroupId(f);if(null===c)return[3,3];e=this._handleMarkup.getPosition(c);if(null===e)return[2];this._startDragging(c,d.HandleEventType.Rotate);return[4,this._rotate(a,b,e,f)];case 1:return g.sent(),[4,this._stopDragging()];case 2:g.sent(),g.label=3;case 3:return[2]}})})};e.prototype._testTranslate=function(a,b){void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:b=this._massageGroupId(b);
c=this._getActiveNodeIdByGroupId(b);if(null===c)return[3,3];this._startDragging(c,d.HandleEventType.Translate);return[4,this._translate(a,d.Point3.zero(),b)];case 1:return f.sent(),[4,this._stopDragging()];case 2:f.sent(),f.label=3;case 3:return[2]}})})};e.prototype._getActiveNodeIdByGroupId=function(a){for(var b=this._handleMarkup.getHandleNodeIds(),c=0;c<b.length;++c){var d=b[c];if(this._handleMarkup.getHandleGroupId(d)===a)return d}return null};e.prototype._startDragging=function(a,b){var c=this;
this._activeHandleNodeId=a;this._handleEventType=b;var d=this._handleMarkup.getHandleGroupId(a),e=this.getNodeIds(d),g=new Map;this._nodeIdGroupMap.forEach(function(b,a){a!==d&&b.forEach(function(b){for(var d=c._viewer.model.getNodeParent(b);null!==d;){if(-1!==e.indexOf(d)){g.set(a,b);break}d=c._viewer.model.getNodeParent(d)}})});this._activeChildrenGroupIds=g;0<e.length&&(this._initLocalNodeMatrices(e),this._viewer.trigger("handleEventStart",this._handleEventType,e,this._initialLocalNodeMatrices),
this._draggingHandle=!0)};e.prototype._stopDragging=function(){return __awaiter(this,void 0,void 0,function(){var a,b;return __generator(this,function(c){switch(c.label){case 0:this._draggingHandle=!1;if(null===this._activeHandleNodeId)return[3,2];a=this._handleMarkup.getHandleGroupId(this._activeHandleNodeId);return[4,this.updatePosition(this._newTranslation,this._newRotationMatrix,!0,a)];case 1:c.sent(),b=this.getNodeIds(a),this._activeHandleNodeId=null,this._activeChildrenGroupIds.clear(),this._viewer.trigger("handleEventEnd",
this._handleEventType,b,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),this._newRotationMatrix=new d.Matrix,this._handleMarkup.resetTranslation(),this._translation.add(this._newTranslation),this._newTranslation=d.Point3.zero(),this._trackedPoints=this._trackedPointsPositions.slice(),c.label=2;case 2:return[2]}})})};e.prototype.onMouseDown=function(c){return __awaiter(this,void 0,void 0,function(){var b,d,e,g;return __generator(this,function(f){switch(f.label){case 0:return a.prototype.onMouseDown.call(this,
c),this._overlayIndex=null,[4,this._viewer.view.pickFromPoint(c.getPosition(),this._pickConfig)];case 1:return b=f.sent(),b.isNodeEntitySelection()&&(d=b.getNodeId(),e=this._viewer.model.getNodeName(d),null!==e&&"handle-"===e.slice(0,7)&&(c.setHandled(!0),g=this._getHandleEventType(d),this._startDragging(d,g))),[2]}})})};e.prototype._onHandleDrag=function(){if(null!==this._activeHandleNodeId){var a=this._viewer.view.getCamera();d.Point3.zero();d.Point3.zero();var b=this._handleMarkup.getHandleType(this._activeHandleNodeId),
f=this._handleMarkup.getVector(this._activeHandleNodeId),e=this._handleMarkup.getPosition(this._activeHandleNodeId);if(null!==b&&null!==e){var g=this._handleMarkup.getHandleGroupId(this._activeHandleNodeId);switch(b){case d.HandleType.Axis:null!==f&&(a=this._getTranslationComponent(e,f,0,g),this._translate(a,e,g));break;case d.HandleType.Plane:null!==f&&(a=this._getTranslationComponent(e,f,1,g),this._translate(a,e,g));break;case d.HandleType.ViewPlane:f=a.getTarget();a=a.getPosition();a=d.Point3.subtract(a,
f).normalize();a=this._getTranslationComponent(e,a,2,g);this._translate(a,e,g);break;case d.HandleType.Rotate:null!==f&&(this._handleMarkup.getGroupIdRotationMatrix(g).copy().setTranslationComponent(0,0,0).transform(f,f),a=this._getRotationAngle(e,f),this._rotate(f,a,e,g));break;default:d.Util.TypeAssertNever(b)}}}};e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:a.prototype.onMouseMove.call(this,c);
if(!this._draggingHandle||null===this._activeHandleNodeId)return[3,1];this._onHandleDrag();return[3,4];case 1:return[4,this._viewer.view.pickFromPoint(c.getPosition(),this._pickConfig)];case 2:return b=d.sent(),[4,this._highlightHandle(b)];case 3:d.sent(),d.label=4;case 4:return[2]}})})};e.prototype.onMouseUp=function(c){this._draggingHandle||!(3>this._dragCount)||c.getButton()===d.Button.Right||this._previousContextClick||this._viewer.getContextMenuStatus()||0!==this._overlayIndex&&null!==this._overlayIndex||
this.removeHandles();this._previousContextClick=c.getButton()===d.Button.Right||this._viewer.getContextMenuStatus();this._draggingHandle&&this._stopDragging();a.prototype.onMouseUp.call(this,c)};e.prototype.setHandled=function(){return this._draggingHandle};e.prototype._getClosestPoint=function(a,b,f){var c=a.copy();a=a.copy().add(b);b=this._viewer.view.unprojectPoint(f,0);f=this._viewer.view.unprojectPoint(f,.5);return null!==b&&null!==f?d.Util.lineLineIntersect(c,a,b,f):null};e.prototype._getTranslationComponent=
function(a,b,f,e){2!==f&&this._handleMarkup.getGroupIdRotationMatrix(e).copy().setTranslationComponent(0,0,0).transform(b,b);var c=e=null;1===f||2===f?(e=this._getPlaneIntersectionPoint(a,b,this._ptFirst),null!==e&&(c=this._getPlaneIntersectionPoint(e,b,this._ptCurrent))):0===f&&(e=this._getClosestPoint(a,b,this._ptFirst),null!==e&&(c=this._getClosestPoint(e,b,this._ptCurrent)));return null!==c&&null!==e?d.Point3.subtract(c,e):d.Point3.zero()};e.prototype._clearHighlightedHandle=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===this._highlightedHandleId?[3,2]:[4,this._viewer.model.unsetNodesFaceColor([this._highlightedHandleId])];case 1:a.sent(),this._highlightedHandleId=null,a.label=2;case 2:return[2]}})})};e.prototype._highlightHandle=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e;return __generator(this,function(f){switch(f.label){case 0:if(!a.isNodeEntitySelection()||a.overlayIndex()!==d.BuiltinOverlayIndex.Handles)return[3,
2];b=this._viewer.model;c=b.getNodeName(a.getNodeId());if(null===c||"handle-"!==c.slice(0,7))return[3,2];e=a.getNodeId();return this._highlightedHandleId===e?[2]:[4,this._clearHighlightedHandle()];case 1:return f.sent(),this._highlightedHandleId=e,b.setNodesFaceColor([this._highlightedHandleId],d.Color.green()),[2];case 2:return[2,this._clearHighlightedHandle()]}})})};e.prototype._getPlaneIntersectionPoint=function(a,b,f){var c=this._viewer.view.unprojectPoint(f,0);f=this._viewer.view.unprojectPoint(f,
.5);if(null===c||null===f)return null;c=new d.Ray(c,f.copy().subtract(c));a=d.Plane.createFromPointAndNormal(a,b);b=d.Point3.zero();return a.intersectsRay(c,b)?b:null};e.prototype._getRotationAngle=function(a,b){console.assert(null!==a);var c=this._getPlaneIntersectionPoint(a,b,this._ptFirst),e=this._getPlaneIntersectionPoint(a,b,this._ptCurrent);if(null===c||null===e)return 0;c=d.Point3.subtract(c,a).normalize();a=d.Point3.subtract(e,a).normalize();e=d.Point3.dot(c,a);e=180*Math.acos(e)/Math.PI;
0>d.Point3.dot(d.Point3.cross(c,a),b)&&(e=-e);return e};e.prototype._getRotationMatrix=function(a,b,f){var c=(new d.Matrix).setTranslationComponent(-b.x,-b.y,-b.z);a=d.Matrix.createFromOffAxisRotation(a,f);b=(new d.Matrix).setTranslationComponent(b.x,b.y,b.z);return d.Matrix.multiply(d.Matrix.multiply(c,a),b)};return e}(h.OperatorBase);h.HandleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._navCube=c.view.getNavCube();b._pickConfig=new d.PickConfig(d.SelectionMask.Face);b._pickConfig.restrictToOverlays=!0;return b}__extends(e,a);e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var b,d,e;return __generator(this,function(f){switch(f.label){case 0:return a.prototype.onMouseMove.call(this,c),b=c.getPosition(),d=this._dragging&&1<this._dragCount,this._navCube.getEnabled()&&
!d&&this._navCube.insideOverlay(b)?[4,this._viewer.view.pickFromPoint(b,this._pickConfig)]:[3,2];case 1:e=f.sent(),this._navCube.onMoveSelection(e),f.label=2;case 2:return[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){switch(f.label){case 0:return this._navCube.getEnabled()&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()?[4,this._viewer.view.pickFromPoint(this._ptFirst,this._pickConfig)]:[3,
3];case 1:return b=f.sent(),[4,this._navCube.onClickSelection(b)];case 2:f.sent(),f.label=3;case 3:return a.prototype.onMouseUp.call(this,c),[2]}})})};return e}(h.OperatorBase);h.NavCubeOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._insertNoteButton=d.Button.Left;c._callbackFlag=!1;c._noteTextManager=b;return c}__extends(e,a);e.prototype.onMouseDown=function(c){var b=this;a.prototype.onMouseDown.call(this,c);this.isActive()&&(this._callbackFlag||(this._viewer.setCallbacks({explode:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._noteTextManager.explode(a)];case 1:return b.sent(),
[2]}})})}}),this._callbackFlag=!0),this._dragging=!1)};e.prototype.onMouseUp=function(c){var b=this;if(this.isActive()){var f=new d.PickConfig(d.SelectionMask.Face);if(this._ptFirst.equals(this._ptCurrent)&&c.getButton()===this._insertNoteButton||null!==this._primaryTouchId)f=this._viewer.view.pickFromPoint(c.getPosition(),f).then(function(a){b._noteTextManager.selectPin(a)||b._noteTextManager.getExplodeActive()||b._noteTextManager.getIsolateActive()||0!==a.overlayIndex()||(a.isFaceSelection()&&new d.Markup.Note.NoteText(b._viewer,
b._noteTextManager,a.getPosition(),a.getFaceEntity().getNormal(),a.getNodeId()),c.setHandled(!0))}),f}a.prototype.onMouseUp.call(this,c)};e.prototype.getNoteTextElement=function(){return this._noteTextManager.getNoteTextElement()};e.prototype.setNoteTextElement=function(a){this._noteTextManager.setNoteTextElement(a)};e.prototype.checkPinInstance=function(a){return null!==this._noteTextManager.checkPinInstance(a)};return e}(h.OperatorBase);h.NoteOperator=g})(d.Operator||(d.Operator={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._selectionButton=d.Button.Left;b._ignoreTransparency=!1;b._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;b._incrementalSelection=d.Util.IncrementalSelection.create("SelectionManager",c);c.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.clearSelection()];case 1:return b.sent(),[2,this.waitForIdle()]}})})},
selectionArray:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return 0!==a.length?[3,2]:[4,this._incrementalSelection.stopSelection()];case 1:b.sent(),b.label=2;case 2:return[2]}})})}});return b}__extends(e,a);e.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};e.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};e.prototype.setIgnoreTransparency=
function(a){this._ignoreTransparency=a};e.prototype.getIgnoreTransparency=function(){return this._ignoreTransparency};e.prototype.hasActiveSelection=function(){return!this._incrementalSelection.isIdle()};e.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.waitForIdle()]})})};e.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,
this._incrementalSelection.clearSelection()]})})};e.prototype._createBeginConfig=function(a){var b=new d.IncrementalPickConfig;b.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;b.ignoreUnrequestedInstances=!0;return{pickConfig:b,rayCssOrigin:a,rayCssBoxRadius:10}};e.prototype._selectionPredicate=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.model,c=a.getNodeId(),null===
c?[2,!1]:[4,b.getNodesHaveTransparency([c])];case 1:return d=f.sent()[0],[2,!d]}})})};e.prototype._performSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d=this;return __generator(this,function(f){b=this._createBeginConfig(a);c=this._ignoreTransparency?function(b){return d._selectionPredicate(b)}:null;return[2,this._incrementalSelection.performSelection(b,c)]})})};e.prototype.setHandled=function(){return!0};e.prototype.onKeyUp=function(a){a.getKeyCode()===d.KeyCode.Escape&&
this.clearSelection()};e.prototype.onMouseUp=function(c){var b=this;this.isActive()&&function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return(c.getButton()===this._selectionButton||null!==this._primaryTouchId)&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()?c.controlDown()?[3,2]:[4,this.clearSelection()]:[3,4];case 1:b.sent(),b.label=2;case 2:return[4,this._performSelection(c.getPosition())];case 3:b.sent(),b.label=
4;case 4:return[2]}})})}();a.prototype.onMouseUp.call(this,c)};return e}(h.OperatorBase);h.RayDrillSelectionOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._selectionButton=d.Button.Left;c._pickConfig=new d.PickConfig(d.SelectionMask.Face|d.SelectionMask.Line);c._forceEffectiveSceneVisibilityMask=null;c._doubleClickFitWorld=!0;c._noteTextManager=b;return c}__extends(e,a);e.prototype.setPickConfig=function(a){this._pickConfig=a.copy()};e.prototype.getPickConfig=function(){return this._pickConfig.copy()};e.prototype.getForceEffectiveSceneVisibilityMask=function(){return null!==
this._forceEffectiveSceneVisibilityMask?this._forceEffectiveSceneVisibilityMask:this._pickConfig.forceEffectiveSceneVisibilityMask};e.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};e.prototype.getSelectionButton=function(){return this._selectionButton};e.prototype.setSelectionButton=function(a){this._selectionButton=a};e.prototype.onKeyUp=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._viewer.selectionManager.clear()};e.prototype.onMouseUp=
function(c){var b=this;if(this.isActive()&&5>d.Point2.subtract(this._ptFirst,this._ptCurrent).length()&&(c.getButton()===this._selectionButton||null!==this._primaryTouchId)){var f=this._viewer.view,e=this._pickConfig;null!==this._forceEffectiveSceneVisibilityMask&&(e=e.copy(),e.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask);f=f.pickFromPoint(this._ptCurrent,e).then(function(a){var f=null!==b._viewer.cuttingManager.getCuttingSectionFromNodeId(a.getNodeId()),e=b._noteTextManager.selectPin(a),
g=b._viewer.markupManager.pickMarkupItem(b._ptCurrent);g instanceof d.Markup.Redline.RedlineText&&b._viewer.markupManager.selectMarkup(g);e||f||null!==g||(a.isNodeSelection()?b._processSelectionClick(c,a):b._isDoubleClick||b._viewer.selectionManager.clear())});f}a.prototype.onMouseUp.call(this,c)};e.prototype.onDoubleClick=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return this._doubleClickFitWorld?[2,this._viewer.view.fitWorld()]:[2]})})};e.prototype.setDoubleClickFitWorldEnabled=
function(a){this._doubleClickFitWorld=a};e.prototype._getSelectionOrParentIfSelected=function(a){var b=this._viewer.selectionManager;if(!b.getSelectParentIfSelected())return a;var c=this._viewer.model,e=a.getNodeId();if(!c.isNodeLoaded(e)||c.getNodeType(e)===d.NodeType.PmiBody)return a;var g=b.containsParent(a);return null!==g?(b=d.Selection.SelectionItem.create(c.getNodeParent(g.getNodeId())),b.isNodeSelection()?b:a):b.contains(a)?(b=d.Selection.SelectionItem.create(c.getNodeParent(e)),b.isNodeSelection()?
b:a):a};e.prototype._processSelectionClick=function(a,b){var c=b.overlayIndex();if(0===c||null===c)c=this._viewer.selectionManager,a.controlDown()||a.commandDown()?c.toggle(b):(a=this._getSelectionOrParentIfSelected(b),c.set(a))};return e}(h.OperatorBase);h.SelectionOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this)||this;c._stage=0;c._finalized=!1;c._uniqueId="";c._positions=[];c._name="";c._measurementValue=0;c._unitMultiplier=1;c._textShape=new h.Shape.TextBox;c._visibility=!0;c._positions=[];c._lineShapes=[];c._viewer=b;return c}__extends(c,a);c.prototype.getName=function(){return this._name};c.prototype.setName=function(b){this._name=b};c.prototype._getStage=function(){return this._stage};c.prototype._nextStage=function(){this._stage++};
c.prototype._setId=function(b){this._uniqueId=b};c.prototype._getId=function(){return this._uniqueId};c.prototype.adjust=function(b){b};c.prototype._isFinalized=function(){return this._finalized};c.prototype.update=function(){};c.prototype.draw=function(){this.update()};c.prototype.setVisibility=function(b){this._visibility=b;this.draw();b?this._viewer.trigger("measurementShown",this):this._viewer.trigger("measurementHidden",this)};c.prototype.getVisibility=function(){return this._visibility};c.prototype.toJson=
function(){return{}};c.prototype.forJson=function(){return this.toJson()};c.prototype.getMeasurementValue=function(){return this._measurementValue};c.prototype.getUnitMultiplier=function(){return this._unitMultiplier};c.prototype.setMeasurementText=function(b){this._textShape.setTextString(b)};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype.isMarkupValid=function(){return!0};c.prototype._setMeasurementValue=function(b){this._measurementValue=b/this._unitMultiplier;
this.setMeasurementText(d.Util.formatWithUnit(this._measurementValue,this._unitMultiplier));this._viewer.trigger("measurementValueSet",this)};c._serializePointArray=function(b){for(var a=[],c=0;c<b.length;c++)a.push(b[c].toJson());return a};c._constructPointArray=function(b){for(var a=[],c=0;c<b.length;c++){var e=d.Point3.fromJson(b[c]);a.push(e)}return a};return c}(h.MarkupItem);g.MeasureMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._rectangle=new d.Markup.Shape.Rectangle;c._markupHandle=null;c._dim=new d.Point2(0,0);c.initialPosition=new d.Point2(0,0);c.currentPosition=new d.Point2(0,0);c.min=new d.Point2(0,0);c.max=new d.Point2(0,0);c._name="_RectangleMarkup";c._rectangle.setFillOpacity(0);c._rectangle.setStrokeColor(d.Color.red());c._constantStrokeColor=b;return c}__extends(e,a);e.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawRectangle(this._rectangle)};
e.prototype.updateCurrentPosition=function(a){this.currentPosition.assign(a);this._constantStrokeColor||this._rectangle.setStrokeColor(this.initialPosition.x<this.currentPosition.x?d.Color.red():d.Color.blue());this.min.assign(this.initialPosition);this.max.assign(this.currentPosition);this.max.x<this.min.x&&(a=this.max.x,this.max.x=this.min.x,this.min.x=a);this.max.y<this.min.y&&(a=this.max.y,this.max.y=this.min.y,this.min.y=a);this._dim.assign(this.max);this._dim.subtract(this.min);this._updateRectangleVertices()};
e.prototype._updateRectangleVertices=function(){this._rectangle.setPosition(this.min);this._rectangle.setSize(this._dim)};e.prototype.activate=function(a){this.initialPosition.assign(a);this.currentPosition.assign(a);this.min.assign(a);this.max.assign(a);this._dim.set(0,0);this._rectangle.setStrokeWidth(1);this._updateRectangleVertices();this._markupHandle=this._viewer.markupManager.registerMarkup(this)};e.prototype.deactivate=function(){this.initialPosition.set(0,0);this.currentPosition.set(0,0);
this.min.set(0,0);this.max.set(0,0);this._dim.set(0,0);this._rectangle.setStrokeWidth(0);this._updateRectangleVertices();var a=this._viewer.markupManager;null!==this._markupHandle&&(a.unregisterMarkup(this._markupHandle),this._markupHandle=null);a.refreshMarkup()};e.prototype.isActive=function(){return null!==this._markupHandle};return e}(d.Markup.Measure.MeasureMarkup);h.SelectionRectangleMarkup=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._modelBounding=new d.Box;b._selectionBounding=new d.Box;b._pivot=d.Point3.zero();b._hitRayOrigin=null;b._hitRayDirection=null;b._hitRayAperture=0;b._hitRaySelectionOnly=!1;b._hitRaySelectionItem=null;b._client={onConnect:function(){if(null!==b._connexion){var a=b._viewer.getViewElement().parentElement;b._connexion.create3dmouse(a,"WebViewer")}},on3dmouseCreated:function(){b._3dMouseInitialized=!0},onDisconnect:function(b){console.log("3Dconnexion NL-Server disconnected "+
b)},getCoordinateSystem:function(){return[0,0,-1,0,1,0,0,0,0,1,0,0,0,0,0,1]},getConstructionPlane:function(){return null},getFov:function(){var a=b._viewer.view.getCamera(),c=a.getWidth();a=d.Point3.subtract(a.getTarget(),a.getPosition()).length();return d.Util.radiansToDegrees(2*Math.atan(c/(2*a)))},setFov:function(a){var c=b._viewer.view.getCamera();a=d.Util.degreesToRadians(a);a=Math.tan(a/2);a*=d.Point3.subtract(c.getTarget(),c.getPosition()).length();var f=c.getHeight()/c.getWidth();c.setWidth(a);
c.setHeight(a*f);b._viewer.view.setCamera(c)},getPerspective:function(){return b._viewer.view.getCamera().getProjection()===d.Projection.Perspective},getViewExtents:function(){var a=b._viewer.view.getCamera(),c=a.getPosition(),e=a.getTarget(),g=a.getWidth()/2,h=a.getHeight()/2;c=d.Point3.subtract(c,e);a=a.getNearLimit();return[-g,-h,c.z/a,g,h,a]},setViewExtents:function(a){var c=new d.Point2(a[0],a[4]),f=new d.Point2(a[3],a[4]);a=new d.Point2(a[3],a[1]);c=d.Point2.distance(c,f);f=d.Point2.distance(f,
a);a=b._viewer.view.getCamera();a.setWidth(c);a.setHeight(f);b._viewer.view.setCamera(a)},getViewFrustum:function(){var a=b._viewer.view.getCamera(),c=a.getWidth(),e=d.Point3.subtract(a.getTarget(),a.getPosition()).length();e=2*Math.atan(c/(2*e));var g=a.getWidth()/a.getHeight();c=a.getNearLimit();e=Math.tan(.5*e)*c;var h=-e,p=g*h;g*=e;a=d.Point3.distance(a.getPosition(),a.getTarget());return[p,g,h,e,c,a]},getViewMatrix:function(){var a=b._viewer.view.getCamera(),c=a.getUp().normalize(),e=d.Point3.subtract(a.getTarget(),
a.getPosition()).normalize(),g=d.Point3.cross(e,c).normalize();a=a.getPosition();return[g.x,g.y,g.z,0,c.x,c.y,c.z,0,e.x,e.y,e.z,0,a.x,a.y,a.z,1]},setViewMatrix:function(a){return __awaiter(b,void 0,void 0,function(){var b,c,f,e,g,h;return __generator(this,function(k){b=this._viewer.view.getCamera();c=new d.Point3(a[4],a[5],a[6]);f=new d.Point3(a[8],a[9],a[10]);e=new d.Point3(a[12],a[13],a[14]);g=d.Point3.subtract(b.getPosition(),b.getTarget()).length();h=e.copy().add(f.copy().scale(g));b.setTarget(h);
b.setPosition(e);b.setUp(c);this._viewer.view.setCamera(b);return[2]})})},getViewRotatable:function(){return!b._viewer.model.isDrawing()},getViewTarget:function(){var a=b._viewer.view.getCamera().getTarget();return[a.x,a.y,a.z]},getFrontView:function(){return[0,1,0,0,0,0,1,0,-1,0,0,0,0,0,0,1]},getPivotPosition:function(){return[b._pivot.x,b._pivot.y,b._pivot.z]},setPivotPosition:function(a){b._pivot=d.Point3.createFromArray(a)},getPointerPosition:function(){var a=b._viewer.view.unprojectPoint(b._ptCurrent,
0);return null===a?[0,0,0]:[a.x,a.y,a.z]},getModelExtents:function(){return[b._modelBounding.min.x,b._modelBounding.min.y,b._modelBounding.min.z,b._modelBounding.max.x,b._modelBounding.max.y,b._modelBounding.max.z]},setLookFrom:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._hitRayOrigin=d.Point3.createFromArray(a),[4,this._updateHitTest()];case 1:return b.sent(),[2]}})})},setLookDirection:function(a){b._hitRayDirection=
d.Point3.createFromArray(a)},setLookAperture:function(a){b._hitRayAperture=a},setSelectionOnly:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._hitRaySelectionOnly=a,[4,this._updateHitTest()];case 1:return b.sent(),[2]}})})},getLookAt:function(){if(null===b._hitRaySelectionItem)return null;var a=b._hitRaySelectionItem.getPosition();return null===a?null:[a.x,a.y,a.z]},getSelectionEmpty:function(){return null===b._viewer.selectionManager.getFirst()},
getSelectionExtents:function(){return[b._selectionBounding.min.x,b._selectionBounding.min.y,b._selectionBounding.min.z,b._selectionBounding.max.x,b._selectionBounding.max.y,b._selectionBounding.max.z]}};b._connexion=null;b._3dMouseInitialized=!1;b._viewer.setCallbacks({modelStructureReady:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._updateModelBounding()];case 1:return b.sent(),[2]}})})},subtreeLoaded:function(){return __awaiter(b,
void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._updateModelBounding()];case 1:return b.sent(),[2]}})})},subtreeDeleted:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._updateModelBounding()];case 1:return b.sent(),[2]}})})},selectionArray:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._updateSelectionBounding()];
case 1:return b.sent(),[2]}})})}});return b}__extends(e,a);e.prototype._updateModelBounding=function(){return __awaiter(this,void 0,void 0,function(){var a,b;return __generator(this,function(c){switch(c.label){case 0:if(null===this._connexion||!this._3dMouseInitialized)return[2];a=this;return[4,this._viewer.model.getModelBounding(!0,!0)];case 1:return a._modelBounding=c.sent(),b=this._modelBounding.center(),this._connexion.update3dcontroller({pivot:{position:[b.x,b.y,b.z]}}),this._pivot=b,[2]}})})};
e.prototype._updateSelectionBounding=function(){return __awaiter(this,void 0,void 0,function(){var a,b;return __generator(this,function(c){switch(c.label){case 0:if(null===this._connexion||!this._3dMouseInitialized)return[2];a=this._viewer.selectionManager.getResults().map(function(b){return b.getNodeId()});if(0===a.length)return this._selectionBounding=new d.Box,[2];b=this;return[4,this._viewer.model.getNodesBounding(a)];case 1:return b._selectionBounding=c.sent(),[2]}})})};e.prototype._updateHitTest=
function(){return __awaiter(this,void 0,void 0,function(){var a,b,f,e,g;return __generator(this,function(c){switch(c.label){case 0:this._hitRayAperture;a=this._viewer;if(null===this._hitRayOrigin||null===this._hitRayDirection)return[2];b=new d.Ray(this._hitRayOrigin,this._hitRayDirection);f=new d.PickConfig;return[4,a.view.pickFromRay(b,f)];case 1:e=c.sent();g=e.getNodeId();if(null===g||this._hitRaySelectionOnly&&!a.selectionManager.isNodeSelected(g))return this._hitRaySelectionItem=null,[2];this._hitRaySelectionItem=
e;return[2]}})})};e.prototype.connect=function(){this._connexion=new _3Dconnexion(this._client);this._connexion.connect()};return e}(h.OperatorBase);h.SpaceMouseOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b,a){var c=new d.PickConfig(d.SelectionMask.Face);c.bimMask=b;c.ignoreOverlays=!0;null!==a&&(c.maxWorldDistance=a);return c}function a(b,a,c,e){return __awaiter(this,void 0,void 0,function(){var f,k,h;return __generator(this,function(l){switch(l.label){case 0:return f=new d.Ray(a,c),k=g(d.BimMask.Floor,e),[4,b.pickFromRay(f,k)];case 1:return h=l.sent(),h.isFaceSelection()?[2,h.getPosition()]:[2,null]}})})}function e(b,a,c,e){return __awaiter(this,void 0,void 0,
function(){var f,k,h;return __generator(this,function(l){switch(l.label){case 0:return f=new d.Ray(a,c.copy().normalize()),k=g(d.BimMask.Wall,e),[4,b.pickFromRay(f,k)];case 1:return h=l.sent(),h.isFaceSelection()?[2,h]:[2,null]}})})}var c=function(){function b(b){this._nearbyDoors=new Set;this._viewer=b}b.prototype._performSphereSelection=function(b,a,c){var f=d.Util.IncrementalSelection.create("View",this._viewer),e=new d.IncrementalPickConfig(d.SelectionMask.Face);e.bimMask=c;e.onlyStreamedInstances=
!0;e.ignoreUnrequestedInstances=!0;return f.performSelection({pickConfig:e,sphereCenter:b,sphereRadius:a})};b.prototype.updateNearbyDoors=function(b,a,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h,l,n,v,y,x,z;return __generator(this,function(m){switch(m.label){case 0:return[4,this._performSphereSelection(b,a,d.BimMask.Door)];case 1:f=m.sent();e=new Set;g=0;for(k=f;g<k.length;g++)h=k[g],l=h.getNodeId(),e.add(l);n=d.Util.setSubtraction(e,this._nearbyDoors);v=d.Util.setSubtraction(this._nearbyDoors,
e);y=d.Util.setToArray(n);x=d.Util.setToArray(v);z=this._viewer.model;z.setNodesOpacity(y,c);z.resetNodesOpacity(x);this._nearbyDoors=e;return[2]}})})};b.prototype.forgetNearbyDoors=function(){var b=d.Util.setToArray(this._nearbyDoors);this._nearbyDoors.clear();this._viewer.model.resetNodesOpacity(b)};return b}(),b=function(b){function f(a){var f=b.call(this,a)||this;f._elevationSpeed=0;f._rotationSpeed=0;f._viewAngle=90;f._zoomDistance=0;f._walkDistance=0;f._tilt=0;f._majorAxis=d.Axis.X;f._maxExtents=
0;f._walkActive=!1;f._activeWalk=new d.Util.CurrentAction(!0);f._bimModeEnabled=!1;f._synchronizedToggleBimMode=new d.Util.CurrentActionSync;f._initialInteractiveDrawLimitIncreaseStatus=!0;f._logical={floor:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.FloorConfig),wall:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.WallConfig),door:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.DoorConfig)};f._effective={floor:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.FloorConfig),wall:__assign({},
h.CameraKeyboardWalkOperator.Bim.Default.WallConfig),door:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.DoorConfig)};f._doorCache=new c(a);f._downAxis=new d.Point3(0,-1,0);a.setCallbacks({subtreeLoaded:function(b,a){a===d.NodeSource.LoadModel&&f._updateSceneFloor()}});return f}__extends(f,b);f.prototype._updateSceneFloor=function(){var b=this._viewer.model.getViewAxes().upVector;console.assert(b.isAxis());this._downAxis=d.Point3.scale(b,-1)};f.prototype.isBimModeEnabled=function(){return this._bimModeEnabled};
f.prototype._enableBimMode=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._bimModeEnabled=!0,this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor),this._effective.wall=this._scaleAgainstModelUnit(this._logical.wall),this._effective.door=this._scaleAgainstModelUnit(this._logical.door),this._updateSceneFloor(),[4,this._applyGravity()];case 1:return b.sent(),[4,this._updateNearbyDoors()];case 2:return b.sent(),
[2]}})})};f.prototype._disableBimMode=function(){this._bimModeEnabled=!1;this._doorCache.forgetNearbyDoors()};f.prototype.enableBimMode=function(){var b=this;return this._synchronizedToggleBimMode.set(function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._enableBimMode()];case 1:return b.sent(),[2]}})})})};f.prototype.disableBimMode=function(){var b=this;return this._synchronizedToggleBimMode.set(function(){b._disableBimMode()})};
f.prototype.toggleBimMode=function(){var b=this;return this._synchronizedToggleBimMode.set(function(){return b._bimModeEnabled?b._disableBimMode():b._enableBimMode()})};f.prototype.onActivate=function(){return __awaiter(this,void 0,void 0,function(){var b,a,c,f,e;return __generator(this,function(g){switch(g.label){case 0:return this._viewer.view.setProjectionMode(d.Projection.Perspective),b=this._viewer.view,a=this,[4,b.getInteractiveDrawLimitIncreaseEnabled()];case 1:return a._initialInteractiveDrawLimitIncreaseStatus=
g.sent(),b.setInteractiveDrawLimitIncreaseEnabled(!1),this._calculateInitialPosition(),0!==this._maxExtents?[3,3]:[4,this.resetDefaultWalkSpeeds()];case 2:g.sent(),g.label=3;case 3:return this._bimModeEnabled?[4,this._updateNearbyDoors()]:[3,5];case 4:g.sent(),g.label=5;case 5:return c=this._viewer.floorplanManager.getConfiguration().autoActivate===d.FloorplanAutoActivation.BimWalk,c?(e=(f=this._viewer.model.getNodesByGenericType("IFCBUILDINGSTOREY"))&&0<f.size)?[4,this._viewer.floorplanManager.activate()]:
[3,7]:[3,7];case 6:g.sent(),g.label=7;case 7:return[2]}})})};f.prototype.onDeactivate=function(){return __awaiter(this,void 0,void 0,function(){var a,c,f;return __generator(this,function(e){switch(e.label){case 0:return this._viewer.view.setInteractiveDrawLimitIncreaseEnabled(this._initialInteractiveDrawLimitIncreaseStatus),this._doorCache.forgetNearbyDoors(),a=this._viewer.floorplanManager.getConfiguration().autoActivate===d.FloorplanAutoActivation.BimWalk,a?(f=(c=this._viewer.model.getNodesByGenericType("IFCBUILDINGSTOREY"))&&
0<c.size)?[4,this._viewer.floorplanManager.deactivate()]:[3,2]:[3,2];case 1:e.sent(),e.label=2;case 2:return b.prototype.onDeactivate.call(this),[2]}})})};f.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,void 0,void 0,function(){var b,a;return __generator(this,function(c){switch(c.label){case 0:return this._rotationSpeed=40,this._viewAngle=90,[4,this._viewer.model.getLooseBounding()];case 1:return b=c.sent(),a=b.extents(),this._maxExtents=Math.max(a.x,a.y,a.z),this._walkDistance=
this._maxExtents/15,this._elevationSpeed=this._maxExtents/10,this._zoomDistance=this._maxExtents/30,[2]}})})};f.prototype.getBimFloorConfig=function(){return __assign({},this._logical.floor)};f.prototype.setBimFloorConfig=function(b){this._logical.floor=__assign({},b);this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor)};f.prototype.getBimWallConfig=function(){return __assign({},this._logical.wall)};f.prototype.setBimWallConfig=function(b){this._logical.wall=__assign({},b);this._effective.wall=
this._scaleAgainstModelUnit(this._logical.wall)};f.prototype.getBimDoorConfig=function(){return __assign({},this._logical.door)};f.prototype.setBimDoorConfig=function(b){this._logical.door=__assign({},b);this._effective.door=this._scaleAgainstModelUnit(this._logical.door)};f.prototype._scaleAgainstModelUnit=function(b){var a=this._viewer.model;a=1/a.getNodeUnitMultiplier(a.getAbsoluteRootNode());b=__assign({},b);for(var c=0,d=Object.keys(b);c<d.length;c++){var f=d[c];"number"===typeof b[f]&&(b[f]*=
a)}return b};f.prototype.onMouseDown=function(a){b.prototype.onMouseDown.call(this,a)};f.prototype.onMouseMove=function(a){b.prototype.onMouseMove.call(this,a)};f.prototype.onMouseUp=function(a){b.prototype.onMouseUp.call(this,a)};f.prototype._applyGravity=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,e,g,k,h,u,w,v;return __generator(this,function(l){switch(l.label){case 0:return b=this._viewer.view,c=b.getCamera(),f=c.getPosition(),[4,a(b,f,this._downAxis,this._effective.floor.maxFallDistance)];
case 1:e=l.sent();if(null!==e)return[3,3];f=d.Point3.subtract(f,d.Point3.scale(this._downAxis,this._effective.floor.avatarOffset));return[4,a(b,f,this._downAxis,this._effective.floor.maxFallDistance)];case 2:e=l.sent();if(null===e)return[2];l.label=3;case 3:g=new d.Point3(0,0,this._effective.floor.avatarOffset);k=d.Point3.add(e,g);h=d.Point3.subtract(k,f);u=h.length();if(u>this._effective.floor.negligibleClimbHeight&&(w=d.Util.computeAngleBetweenVector(h,this._downAxis),(v=90<w)&&u>this._effective.floor.maxClimbHeight))return[2];
this._applyWalkDelta(c,h);return[2]}})})};f.prototype._updateNearbyDoors=function(){var b=this._viewer.view.getCamera().getPosition();return this._doorCache.updateNearbyDoors(b,this._effective.door.transparencyRange,.5)};f.prototype._updateCamera=function(b){this._resetPosition(b);this._updateCameraTilt(b);this._updateCameraViewAngle(b);this._viewer.view.setCamera(b)};f.prototype._applyWalkDelta=function(b,a){b.dolly(d.Point3.scale(a,-1));this._updateCamera(b)};f.prototype._applyWalkDeltaWithCollisionCheck=
function(b,a,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h,l,n,m,x,z,A,C,B,D,F,E,G,H;return __generator(this,function(p){switch(p.label){case 0:return f=b.getPosition(),e=d.Matrix.createFromOffAxisRotation(c,90),g=e.transform(a),k=d.Matrix.createFromOffAxisRotation(c,-90),h=k.transform(a),l=this._testWallCollision(f,g,this._effective.wall.avatarOffset),n=this._testWallCollision(f,h,this._effective.wall.avatarOffset),m=this._testWallCollision(f,a,a.length()+this._effective.wall.avatarOffset),
[4,Promise.all([l,n])];case 1:x=p.sent();z=x[0];A=x[1];if(null!==z||null!==A)if(C=function(b){return null!==b?(b=b.getFaceEntity().getNormal(),90<d.Util.computeAngleBetweenVector(b,a)):!1},C(z)||C(A))return[2];return[4,m];case 2:return B=p.sent(),null!==B&&(D=a.length(),F=d.Point3.scale(a,1/D),E=d.Point3.subtract(B.getPosition(),f).length(),G=E-this._effective.wall.avatarOffset,H=Math.min(D,G),a=d.Point3.scale(F,H)),this._applyWalkDelta(b,a),[2]}})})};f.prototype._testWallCollision=function(b,a,c){return e(this._viewer.view,
b,a,c)};f.prototype._walkBackward=function(b,a){var c=this._viewer.view.getCamera();this._resetPosition(c);var f=c.getTarget(),e=c.getPosition(),g=c.getUp();b=d.Point3.subtract(e,f).normalize().copy().scale(b);return a?this._applyWalkDeltaWithCollisionCheck(c,b,g):this._applyWalkDelta(c,b)};f.prototype._walkForward=function(b,a){return this._walkBackward(-b,a)};f.prototype._walkLeft=function(b,a){var c=this._viewer.view.getCamera();this._resetPosition(c);var f=c.getTarget(),e=c.getPosition(),g=c.getUp();
f=d.Point3.subtract(f,e).normalize();b=d.Point3.cross(g,f).normalize().copy().scale(b);return a?this._applyWalkDeltaWithCollisionCheck(c,b,g):this._applyWalkDelta(c,b)};f.prototype._walkRight=function(b,a){return this._walkLeft(-b,a)};f.prototype.walkBackward=function(b){return this._walkBackward(b,!1)};f.prototype.walkForward=function(b){return this._walkForward(b,!1)};f.prototype.walkLeft=function(b){return this._walkLeft(b,!1)};f.prototype.walkRight=function(b){return this._walkRight(b,!1)};f.prototype.walkBackwardWithCollision=
function(b){return this._walkBackward(b,!0)};f.prototype.walkForwardWithCollision=function(b){return this._walkForward(b,!0)};f.prototype.walkLeftWithCollision=function(b){return this._walkLeft(b,!0)};f.prototype.walkRightWithCollision=function(b){return this._walkRight(b,!0)};f.prototype.walkDown=function(b){var a=this._viewer.view.getCamera();this._resetPosition(a);b=a.getUp().normalize().scale(b);this._applyWalkDelta(a,b)};f.prototype.walkUp=function(b){this.walkDown(-b)};f.prototype.rotateRight=
function(b){var a=this._viewer.view.getCamera();this._resetPosition(a);var c=a.getTarget(),f=a.getPosition(),e=d.Point3.subtract(f,c).length(),g=d.Point3.subtract(c,f).normalize();b=d.Util.degreesToRadians(b);b=Math.tan(b);b*=d.Point3.subtract(a.getTarget(),a.getPosition()).length();g=d.Point3.cross(g,a.getUp()).scale(b);c=c.copy().add(g);e=d.Point3.subtract(c,f).normalize().scale(e);c=d.Point3.add(f,e);a.setTarget(c);this._updateCamera(a)};f.prototype.rotateLeft=function(b){this.rotateRight(-b)};
f.prototype.tiltDown=function(b){this.setTilt(this._tilt+b);b=this._viewer.view.getCamera();this._resetPosition(b);this._updateCamera(b)};f.prototype.tiltUp=function(b){this.tiltDown(-b)};f.prototype._calculateInitialPosition=function(){var b=this._viewer.view.getCamera();this._calculateMajorAxis(b);this.setTilt(this._calculateInitialTilt(b));this._resetPosition(b);this._updateCamera(b)};f.prototype._updateCameraViewAngle=function(b){var a=d.Util.degreesToRadians(this._viewAngle);a=Math.tan(a/2);
a*=d.Point3.subtract(b.getTarget(),b.getPosition()).length();b.setWidth(a);b.setHeight(a)};f.prototype._updateCameraTilt=function(b){var a=b.getPosition(),c=b.getTarget(),f=b.getUp().normalize(),e=d.Point3.subtract(c,a).normalize();f=d.Point3.cross(f,e).normalize();c=d.Point3.distance(c,a);d.Matrix.createFromOffAxisRotation(f,this._tilt).transform(e,e);b.setTarget(d.Point3.add(a,e.scale(c)))};f.prototype._calculateInitialTilt=function(b){var a=b.getTarget();b=b.getPosition();b=d.Point3.subtract(a,
b);a=b.length();this._majorAxis===d.Axis.X?b.x=0:this._majorAxis===d.Axis.Y?b.y=0:this._majorAxis===d.Axis.Z&&(b.z=0);b=b.length();return 180/Math.PI*Math.acos(b/a)};f.prototype._resetPosition=function(b){this._calculateMajorAxis(b);var a=b.getPosition(),c=b.getTarget();c=d.Point3.subtract(c,a);var f=c.length();0<this.getWalkSpeed()&&(f=this.getWalkSpeed());switch(this._majorAxis){case d.Axis.X:c.set(0,c.y,c.z);b.setUp(new d.Point3(1,0,0));break;case d.Axis.Y:c.set(c.x,0,c.z);b.setUp(new d.Point3(0,
1,0));break;case d.Axis.Z:c.set(c.x,c.y,0),b.setUp(new d.Point3(0,0,1))}c.normalize().scale(f);b.setTarget(d.Point3.add(a,c))};f.prototype._calculateMajorAxis=function(b){var a=b.getUp();b=Math.abs(a.x);var c=Math.abs(a.y);a=Math.abs(a.z);this._majorAxis=a>=b&&a>=c?d.Axis.Z:c>=b&&c>=a?d.Axis.Y:d.Axis.X};f.prototype.setZoomSpeed=function(b){this._zoomDistance=b};f.prototype.getZoomSpeed=function(){return this._zoomDistance};f.prototype.setTilt=function(b){this._tilt=Math.max(Math.min(b,45),-45);b=
this._viewer.view.getCamera();this._updateCamera(b)};f.prototype.getTilt=function(){return this._tilt};f.prototype.setViewAngle=function(b){b=Math.max(Math.min(b,150),30);this._viewAngle!==b&&(this._viewAngle=b,this._updateCamera(this._viewer.view.getCamera()))};f.prototype.getViewAngle=function(){return this._viewAngle};f.prototype.setWalkSpeed=function(b){this._walkDistance=b};f.prototype.getWalkSpeed=function(){return this._walkDistance};f.prototype.setElevationSpeed=function(b){this._elevationSpeed=
b};f.prototype.getElevationSpeed=function(){return this._elevationSpeed};f.prototype.setRotationSpeed=function(b){this._rotationSpeed=b};f.prototype.getRotationSpeed=function(){return this._rotationSpeed};f.prototype.setWalkActive=function(b){this._walkActive=b};f.prototype.getWalkActive=function(){return this._walkActive};f.prototype.getBimModeEnabled=function(){return this._bimModeEnabled};f.prototype.getMajorAxis=function(){return this._majorAxis};f.prototype.getActiveWalk=function(){return this._activeWalk};
return f}(h.OperatorBase);h.CameraWalkBaseOperator=b;(function(b){(function(b){(function(b){(function(b){b[b.avatarOffset=1500]="avatarOffset";b[b.maxClimbHeight=600]="maxClimbHeight";b[b.negligibleClimbHeight=20]="negligibleClimbHeight";b[b.maxFallDistance=5E3]="maxFallDistance"})(b.FloorConfig||(b.FloorConfig={}));(function(b){b[b.avatarOffset=150]="avatarOffset"})(b.WallConfig||(b.WallConfig={}));(function(b){b[b.transparencyRange=4E3]="transparencyRange"})(b.DoorConfig||(b.DoorConfig={}))})(b.Default||
(b.Default={}))})(b.Bim||(b.Bim={}))})(b=h.CameraWalkBaseOperator||(h.CameraWalkBaseOperator={}))})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(c){a(c,d.WalkDirection.Forward,d.WalkDirection.Backward);a(c,d.WalkDirection.Left,d.WalkDirection.Right);a(c,d.WalkDirection.Up,d.WalkDirection.Down);a(c,d.WalkDirection.RotateLeft,d.WalkDirection.RotateRight);a(c,d.WalkDirection.TiltUp,d.WalkDirection.TiltDown)}function a(a,b,d){a.has(b)&&a.has(d)&&(a.delete(b),a.delete(d))}var e=function(a){function b(b){var c=a.call(this,b)||this;c._keyWalkMapping=new Map;c._keyUpMap=new Map;c._keyDownMap=new Map;c._mouseLookSpeed=
0;c._mouseLookEnabled=!0;c._previousWalkTime=0;c._tickTimerId=null;b.setCallbacks({camera:function(b){b.getProjection()!==d.Projection.Perspective&&c._keyDownMap.clear()}});c.addKeyMapping(d.KeyCode.a,d.WalkDirection.Left);c.addKeyMapping(d.KeyCode.d,d.WalkDirection.Right);c.addKeyMapping(d.KeyCode.w,d.WalkDirection.Forward);c.addKeyMapping(d.KeyCode.s,d.WalkDirection.Backward);c.addKeyMapping(d.KeyCode.q,d.WalkDirection.RotateLeft);c.addKeyMapping(d.KeyCode.e,d.WalkDirection.RotateRight);c.addKeyMapping(d.KeyCode.r,
d.WalkDirection.TiltUp);c.addKeyMapping(d.KeyCode.f,d.WalkDirection.TiltDown);c.addKeyMapping(d.KeyCode.x,d.WalkDirection.Up);c.addKeyMapping(d.KeyCode.c,d.WalkDirection.Down);c.addKeyMapping(d.KeyCode.LeftArrow,d.WalkDirection.Left);c.addKeyMapping(d.KeyCode.RightArrow,d.WalkDirection.Right);c.addKeyMapping(d.KeyCode.UpArrow,d.WalkDirection.Forward);c.addKeyMapping(d.KeyCode.DownArrow,d.WalkDirection.Backward);return c}__extends(b,a);b.prototype.addKeyMapping=function(b,a){this._keyWalkMapping.set(b,
a)};b.prototype.getKeyMapping=function(){return d.Util.copyMap(this._keyWalkMapping)};b.prototype.clearKeyMappings=function(){this._keyWalkMapping.clear()};b.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);this._viewer.focusInput(!0)};b.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,b);if(this._dragging&&this._mouseLookEnabled){this._viewer.view.setProjectionMode(d.Projection.Perspective);var c=window.screen.width,f=window.screen.height;b.setHandled(!0);
b=d.Point2.subtract(this._ptPrevious,this._ptCurrent);this.rotateLeft(b.x/c*this._mouseLookSpeed);this.tiltUp(b.y/f*this._mouseLookSpeed)}};b.prototype.onMouseUp=function(b){5<this._dragCount&&b.setHandled(!0);a.prototype.onMouseUp.call(this,b)};b.prototype.onMousewheel=function(b){var a=this;this._viewer.view.setProjectionMode(d.Projection.Perspective);var c=this._viewer.view,f=c.getCamera(),e=b.getPosition(),g=b.getWheelDelta();b=c.pickFromPoint(e,new d.PickConfig(d.SelectionMask.Face)).then(function(b){var c=
b.getPosition();null!==b&&null!==c?(b=d.Point3.subtract(f.getPosition(),c).normalize().scale(a.getZoomSpeed()*g),a._applyWalkDelta(f,b)):a.walkBackward(g*a.getWalkSpeed())});b};b.prototype.onKeyDown=function(b){this._viewer.view.setProjectionMode(d.Projection.Perspective);var a=b.getKeyCode();a===d.KeyCode.v&&this.toggleBimMode();this._keyCodeActive(a)||(this._keyDownMap.set(a,b.getDate().getTime()),this._onKeyChange(a))};b.prototype.onKeyUp=function(b){var a=b.getKeyCode();this._keyUpMap.set(a,b.getDate().getTime());
this._onKeyChange(a)};b.prototype._keyCodeActive=function(b){var a=this._keyDownMap.get(b);return void 0!==a&&(b=this._keyUpMap.get(b),void 0===b||a>b)?!0:!1};b.prototype._onKeyChange=function(b){this._keyCodeActive(b)&&this._keyWalkMapping.has(b)&&(this.getWalkActive()||(this._previousWalkTime=Date.now()),this._onTick())};b.prototype.setMouseLookSpeed=function(b){this._mouseLookSpeed=b};b.prototype.getMouseLookSpeed=function(){return this._mouseLookSpeed};b.prototype.setMouseLookEnabled=function(b){this._mouseLookEnabled=
b};b.prototype.getMouseLookEnabled=function(){return this._mouseLookEnabled};b.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){return[2,a.prototype.resetDefaultWalkSpeeds.call(this).then(function(){b._mouseLookSpeed=300})]})})};b.prototype._execWalkDirection=function(b,a,c){var f=this.getWalkSpeed()*a;switch(b){case d.WalkDirection.Forward:return c?this.walkForwardWithCollision(f):this.walkForward(f);case d.WalkDirection.Backward:return c?
this.walkBackwardWithCollision(f):this.walkBackward(f);case d.WalkDirection.Left:return c?this.walkLeftWithCollision(f):this.walkLeft(f);case d.WalkDirection.Right:return c?this.walkRightWithCollision(f):this.walkRight(f);case d.WalkDirection.Up:return this.walkUp(this.getElevationSpeed()*a);case d.WalkDirection.Down:return this.walkDown(this.getElevationSpeed()*a);case d.WalkDirection.RotateLeft:return this.rotateLeft(this.getRotationSpeed()*a);case d.WalkDirection.RotateRight:return this.rotateRight(this.getRotationSpeed()*
a);case d.WalkDirection.TiltUp:return this.tiltUp(this.getRotationSpeed()*a);case d.WalkDirection.TiltDown:return this.tiltDown(this.getRotationSpeed()*a);default:d.Util.TypeAssertNever(b)}};b.prototype._queueWalkDirections=function(b){var a=this,c=new Set;this._keyWalkMapping.forEach(function(b,d){a._keyCodeActive(d)&&c.add(b)});g(c);var f=d.Util.setToArray(c);f.sort();if(0<f.length){this.setWalkActive(!0);var e=this.getBimModeEnabled();this.getActiveWalk().set(function(){return __awaiter(a,void 0,
void 0,function(){var a,g,k,h,l,n=this;return __generator(this,function(m){a=new d.Util.ActionQueue(1,!0);if(0<b)for(g=function(c){a.push(function(){return n._execWalkDirection(c,b,e)})},k=0,h=f;k<h.length;k++)l=h[k],g(l);e&&(c.has(d.WalkDirection.Up)||c.has(d.WalkDirection.Down)||a.push(function(){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._applyGravity()];case 1:return b.sent(),[2]}})})}),a.push(function(){return __awaiter(n,
void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._updateNearbyDoors()];case 1:return b.sent(),[2]}})})}));return a.isIdle()?[2]:[2,a.waitForIdle()]})})})}};b.prototype._onTick=function(){var b=this,a=Date.now(),c=(a-this._previousWalkTime)/1E3;this._previousWalkTime=a;a=!this.getActiveWalk().isIdle();this.setWalkActive(a);this._queueWalkDirections(c);null!==this._tickTimerId&&(cancelAnimationFrame(this._tickTimerId),this._tickTimerId=null);this.getWalkActive()&&
(this._tickTimerId=requestAnimationFrame(function(){b._onTick()}))};return b}(h.CameraWalkBaseOperator);h.CameraKeyboardWalkOperator=e})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(e){function c(b,c){b=e.call(this,b)||this;b._cameraRotationMomentumEnabled=!1;b._isDown=!1;b._mouseDragged=!1;b._averagedMousePoints=new a;b._averageTimeIntervalMilliseconds=150;b._previousMouseMovePoint=d.Point2.zero();b._mouseMovePoint=d.Point2.zero();b._mouseMoveOffset=d.Point2.zero();b._previousMouseMoveTime=null;b._mouseMoveTime=null;b._mouseMoveElapsedTimeSeconds=0;b._rotationDegreesPerSecond=[0,0];b._animationLastTickTime=0;b._animationElapsedTimeSeconds=
0;b._animationIntervalResult=null;b._preferredAnimationIntervalMilliseconds=16;b._momentum=0;b._momentumLossPerSecond=0;b._degreesPerPixel=.5;b._maxRotationMagnitudeScale=8;b._initialSelectionPosition=null;b._cameraRotateFunction=c;return b}__extends(c,e);c.prototype.getCameraRotationMomentumEnabled=function(){return this._cameraRotationMomentumEnabled};c.prototype.setCameraRotationMomentumEnabled=function(b){b!==this._cameraRotationMomentumEnabled&&((this._cameraRotationMomentumEnabled=b)||this.stopAnimation())};
c.prototype.isCurrentlyAnimating=function(){return this._cameraRotationMomentumEnabled&&0<this.getMomentum()};c.prototype.onDeactivate=function(){return e.prototype.onDeactivate.call(this)};c.prototype.onViewOrientationChange=function(){this.stopAnimation()};c.prototype.supportsAnimation=function(){return!0};c.prototype.onMouseDown=function(b){e.prototype.onMouseDown.call(this,b);this.isActive()&&(this._initialSelectionPosition=b.getPosition(),this._isDown=!0,this.stopAnimation(),this._mouseDragged=
!1,this._mouseMoveTime=this._previousMouseMoveTime=Date.now(),this._mouseMovePoint.assign(this._initialSelectionPosition),this._previousMouseMovePoint.assign(this._mouseMovePoint),this._averagedMousePoints.clear(),this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime))};c.prototype.onMouseMove=function(b){e.prototype.onMouseMove.call(this,b);this.isActive()&&this._isDown&&(this._mouseDragged=!0,this._previousMouseMovePoint.assign(this._mouseMovePoint),this._mouseMovePoint.assign(b.getPosition()),
this._mouseMoveOffset=d.Point2.subtract(this._mouseMovePoint,this._previousMouseMovePoint),this._previousMouseMoveTime=this._mouseMoveTime,this._mouseMoveTime=Date.now(),this._mouseMoveElapsedTimeSeconds=null===this._previousMouseMoveTime?0:(this._mouseMoveTime-this._previousMouseMoveTime)/1E3,this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime),b=this._getMouseMoveOffsetForRotation(),this._rotateCamera(b))};c.prototype.onMouseUp=function(b){if(this.isActive()&&(this._isDown=!1,
this._mouseDragged&&this.getCameraRotationMomentumEnabled())){this._mouseMoveOffset=this._averagedMousePoints.getAverageOffsetWithinMilliseconds(this._averageTimeIntervalMilliseconds);var a=this._getMouseMoveOffsetForRotation();if(0!==a[0]||0!==a[1]){for(var c=0;2>c;c++){var d=Math.abs(a[c])*this._maxRotationMagnitudeScale;this._rotationDegreesPerSecond[c]=a[c]/this._mouseMoveElapsedTimeSeconds;this._rotationDegreesPerSecond[c]<-d?this._rotationDegreesPerSecond[c]=-d:this._rotationDegreesPerSecond[c]>
d&&(this._rotationDegreesPerSecond[c]=d)}this._momentum=1;this._startAnimation()}else this._momentum=0}e.prototype.onMouseUp.call(this,b)};c.prototype._rotateCamera=function(b){this._cameraRotateFunction(b)};c.prototype.stopAnimation=function(){null!==this._animationIntervalResult&&(clearInterval(this._animationIntervalResult),this._animationIntervalResult=null)};c.prototype.getMomentum=function(){return this._momentum};c.prototype.setMomentumLossPerSecond=function(b){0<=b&&(this._momentumLossPerSecond=
b)};c.prototype.getMomentumLossPerSecond=function(){return this._momentumLossPerSecond};c.prototype.isAnimating=function(){return null!==this._animationIntervalResult};c.prototype._startAnimation=function(){var b=this;null===this._animationIntervalResult&&(this._animationLastTickTime=Date.now(),this._animationIntervalResult=window.setInterval(function(){b._onTick()},this._preferredAnimationIntervalMilliseconds))};c.prototype._getMouseMoveOffsetForRotation=function(){return[-this._mouseMoveOffset.x*
this._degreesPerPixel,this._mouseMoveOffset.y*this._degreesPerPixel]};c.prototype._onTick=function(){var b=Date.now();this._animationElapsedTimeSeconds=(b-this._animationLastTickTime)/1E3;this._animationLastTickTime=b;this._rotateCamera([this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[0],this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[1]]);if(0<this._momentumLossPerSecond)if(this._momentum=Math.max(0,this._momentum-this._animationElapsedTimeSeconds*this._momentumLossPerSecond),
0<this._momentum)for(b=0;b<this._rotationDegreesPerSecond.length;b++)this._rotationDegreesPerSecond[b]*=this._momentum;else{for(b=0;b<this._rotationDegreesPerSecond.length;b++)this._rotationDegreesPerSecond[b]=0;this._rotateCamera(this._rotationDegreesPerSecond);this.stopAnimation()}};return c}(h.OperatorBase);h.CameraOrbitBaseOperator=g;var a=function(){function a(a){void 0===a&&(a=10);this._count=0;this._points=Array(a);this._times=Array(a)}a.prototype.clear=function(){this._count=0};a.prototype.add=
function(a,b){void 0===b&&(b=Date.now());var c=this._count%this._points.length;void 0===this._points[c]?this._points[c]=a.copy():this._points[c].assign(a);this._times[c]=b;this._count++};a.prototype.getAverageOffsetWithinMilliseconds=function(a,b){void 0===b&&(b=Date.now());var c=-1,e=d.Point2.zero(),g=Math.min(this._points.length,this._count);if(0<g){for(var h=0,m=0;m<g;m++){var p=(this._count-1-m)%this._points.length;if(b-this._times[p]>a)break;c=p;e.add(this._points[p]);h++}1<h?(e.subtract(this._points[c]),
h--,e.scale(1/h)):(c=-1,e.set(0,0))}return 0<=c?d.Point2.subtract(e,this._points[c]):e};return a}()})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function c(b,c,e){var f=a.call(this)||this;f._circle=new d.Markup.Shape.Circle;f._viewer=b;f._position=c;f._circle.setRadius(e);return f}__extends(c,a);c.prototype.draw=function(){if(this._circle){var b=this._viewer.view.projectPoint(this._position);this._circle.setCenter(d.Point2.fromPoint3(b));this._viewer.markupManager.getRenderer().drawCircle(this._circle)}};return c}(d.Markup.MarkupItem);h.OrbitMarkup=g;var a=function(a){function c(b){var c=a.call(this,
b,function(b){if(!c._viewer.sheetManager.isDrawingSheetActive())if(null!==c._pickPosition){if(null===c._circleMarkupHandler){var a=new g(c._viewer,c._pickPosition,c._circleRadius);c._circleMarkupHandler=c._viewer.markupManager.registerMarkup(a)}c._orbitByTurnTiltWithTarget(b,c._pickPosition)}else switch(a=c._viewer.view.getCamera(),c._orbitFallbackMode){default:case d.OrbitFallbackMode.CameraTarget:c._orbitByTurnTiltWithTarget(b,a.getTarget());break;case d.OrbitFallbackMode.ModelCenter:c._modelCenter&&
c._orbitByTurnTiltWithTarget(b,c._modelCenter);break;case d.OrbitFallbackMode.OrbitTarget:c._orbitByTurnTiltWithTarget(b,c._orbitTarget)}})||this;c._orbitTarget=d.Point3.zero();c._orbitFallbackMode=d.OrbitFallbackMode.ModelCenter;c._modelCenter=null;c._circleMarkupHandler=null;c._circleRadius=3;c._updateCameraCenterAction=new d.Util.CurrentAction(!1);c._updateCameraCenterTimer=new d.Util.Timer;c._primaryButton=d.Button.Middle;c._pickPosition=null;c._bimOrbitEnabled=!1;c._viewer.setCallbacks({sceneReady:function(){c._updateModelCenter()},
modelSwitched:function(){c._updateModelCenter()},visibilityChanged:function(){c._updateModelCenter()},_updateTransform:function(b){b||c._updateModelCenter()},_geometryCreated:function(){c._updateModelCenter()},hwfParseComplete:function(){c._updateModelCenter()}});return c}__extends(c,a);c.prototype._updateModelCenter=function(b){var a=this;void 0===b&&(b=50);this._updateCameraCenterTimer.clear();this._updateCameraCenterAction.set(function(){return __awaiter(a,void 0,void 0,function(){var a,c=this;
return __generator(this,function(d){switch(d.label){case 0:return[4,this._viewer.model.getModelBounding(!0,!1)];case 1:a=d.sent();if(a.isDegenerate()&&0<b)return this._updateCameraCenterTimer.set(500,function(){c._updateModelCenter(b-1)}),[2];this._modelCenter=a.center();return[2]}})})})};c.prototype.onMouseDown=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return a.prototype.onMouseDown.call(this,b),this.isActive()&&b.getButton()===
this._primaryButton?[4,this._viewer.view.pickFromPoint(b.getPosition(),new d.PickConfig(d.SelectionMask.Face))]:[3,2];case 1:c=f.sent(),null!==c&&0===c.overlayIndex()?(this._pickPosition=c.getPosition(),b.setHandled(!0)):this._pickPosition=null,f.label=2;case 2:return[2]}})})};c.prototype.onMouseUp=function(b){a.prototype.onMouseUp.call(this,b);b.getButton()===this._primaryButton&&(this._pickPosition=null);this._removeMarkup()};c.prototype.onDeactivate=function(){var b=a.prototype.onDeactivate.call(this);
this._updateCameraCenterTimer.clear();return b};c.prototype.setBimOrbitEnabled=function(b){this._bimOrbitEnabled=b};c.prototype.getBimOrbitEnabled=function(){return this._bimOrbitEnabled};c.prototype._removeMarkup=function(){null!==this._circleMarkupHandler&&(this._viewer.markupManager.unregisterMarkup(this._circleMarkupHandler),this._circleMarkupHandler=null)};c.prototype._getClampedRotationMatrix=function(b,a,c,e){b=d.Matrix.createFromOffAxisRotation(b,a);a=d.Point3.zero();b.transform(c,a);return 0>=
d.Util.radiansToDegrees(Math.asin(d.Point3.dot(e,a)))?new d.Matrix:b};c.prototype._orbitByTurnTiltWithTarget=function(b,a){var c=this._viewer.view,f=c.getCamera(),e=f.getPosition().subtract(a),g=f.getTarget().subtract(a),h=f.getUp().normalize(),q=d.Point3.subtract(g,e).normalize(),r=d.Point3.cross(h,q).normalize();q=b[0];var t=b[1];new d.Matrix;new d.Matrix;this._bimOrbitEnabled?(b=this._viewer.model.getViewAxes().upVector.copy(),r=this._getClampedRotationMatrix(r,t,h,b),b=d.Matrix.createFromOffAxisRotation(b,
q/4),q=b.transform(r.transform(e)),g=b.transform(r.transform(g)),h=b.transform(r.transform(d.Point3.add(e,h)))):(r=d.Matrix.createFromOffAxisRotation(r,t),b=d.Matrix.createFromOffAxisRotation(h,q),r=d.Matrix.multiply(b,r),q=r.transform(e),g=r.transform(g),h=r.transform(d.Point3.add(e,h)));h.subtract(q);e=q;e.add(a);g.add(a);f.setPosition(e);f.setTarget(g);f.setUp(h);c.setCamera(f)};c.prototype.setOrbitFallbackMode=function(b){this._orbitFallbackMode=b};c.prototype.getOrbitFallbackMode=function(){return this._orbitFallbackMode};
c.prototype.setOrbitTarget=function(b){this._orbitTarget=b};c.prototype.getOrbitTarget=function(){return this._orbitTarget};c.prototype.setPrimaryButton=function(b){this._primaryButton=b};c.prototype.getPrimaryButton=function(){return this._primaryButton};return c}(h.CameraOrbitBaseOperator);h.CameraOrbitOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._cameraPtPrevious=d.Point3.zero();return c}__extends(e,a);e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);if(this.isActive()||this._viewer.sheetManager.isDrawingSheetActive()){var b=this._viewer.view;(c=b.getCamera().getCameraPlaneIntersectionPoint(c.getPosition(),b))&&this._cameraPtPrevious.assign(c)}};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);if(this.isActive()||
this._viewer.sheetManager.isDrawingSheetActive()){var b=this._viewer.view,f=b.getCamera();if(c=f.getCameraPlaneIntersectionPoint(c.getPosition(),b))c=d.Point3.subtract(c,this._cameraPtPrevious),f.dolly(c),b.setCamera(f)}};return e}(h.OperatorBase);h.CameraPanOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._mouseMoveZoomDelta=3;c._mouseWheelZoomDelta=.25;c._pinchZoomModifier=2.5;c._zoomToMousePosition=!0;c._dollyZoomEnabled=!1;c._adjustCameraTarget=!1;c._preserveViewAngle=!0;c._mouseMoveZoomFactor=1;c._mouseWheelZoomFactor=-1;c._secondaryTouchId=null;c._lastTouch1=d.Point2.zero();c._lastTouch2=d.Point2.zero();c._prevLen=0;return c}__extends(e,a);e.prototype.setMouseWheelZoomInverted=function(a){this._mouseWheelZoomFactor=
a?-1:1};e.prototype.getMouseWheelZoomInverted=function(){return-1===this._mouseWheelZoomFactor};e.prototype.setMouseMoveZoomInverted=function(a){this._mouseMoveZoomFactor=a?-1:1};e.prototype.getMouseMoveZoomInverted=function(){return-1===this._mouseMoveZoomFactor};e.prototype.setMouseMoveZoomDelta=function(a){this._mouseMoveZoomDelta=a};e.prototype.getMouseMoveZoomDelta=function(){return this._mouseMoveZoomDelta};e.prototype.setMouseWheelZoomDelta=function(a){this._mouseWheelZoomDelta=a};e.prototype.getMouseWheelZoomDelta=
function(){return this._mouseWheelZoomDelta};e.prototype.setZoomToMousePosition=function(a){this._zoomToMousePosition=a};e.prototype.getZoomToMousePosition=function(){return this._zoomToMousePosition};e.prototype.setDollyZoomEnabled=function(a){this._dollyZoomEnabled=a};e.prototype.getDollyZoomEnabled=function(){return this._dollyZoomEnabled};e.prototype.setMouseWheelAdjustCameraTarget=function(a){this._adjustCameraTarget=a};e.prototype.getMouseWheelAdjustCameraTarget=function(){return this._adjustCameraTarget};
e.prototype.setPreserveViewAngle=function(a){this._preserveViewAngle=a};e.prototype.getPreserveViewAngle=function(){return this._preserveViewAngle};e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var b,d,e,g,h,m;return __generator(this,function(f){switch(f.label){case 0:a.prototype.onMouseMove.call(this,c);if(!this.isDragging()||!this.isActive())return[3,4];b=this._viewer.view;d=b.pointToWindowPosition(this._ptCurrent);e=b.pointToWindowPosition(this._ptPrevious);
g=d.y-e.y;h=d.x-e.x;m=this._mouseMoveZoomDelta*this._mouseMoveZoomFactor*(g-h);return this._dollyZoomEnabled?[4,this._dollyZoom(m,void 0,void 0,!0)]:[3,2];case 1:return f.sent(),[3,4];case 2:return[4,this._doZoom(m)];case 3:f.sent(),f.label=4;case 4:return[2]}})})};e.prototype.onMousewheel=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return b=this._mouseWheelZoomDelta*this._mouseWheelZoomFactor*a.getWheelDelta(),this._dollyZoomEnabled?
[4,this._dollyZoom(-b,void 0,a.getPosition())]:[3,2];case 1:return c.sent(),[3,4];case 2:return[4,this._doZoom(b,void 0,a.getPosition())];case 3:c.sent(),c.label=4;case 4:return[2]}})})};e.prototype.onTouchStart=function(a){var b=this._viewer.view;null===this._primaryTouchId?(this._primaryTouchId=a.getId(),this._lastTouch1.assign(b.pointToWindowPosition(a.getPosition()))):null===this._secondaryTouchId&&(this._secondaryTouchId=a.getId(),this._lastTouch2.assign(b.pointToWindowPosition(a.getPosition())));
null!==this._primaryTouchId&&null!==this._secondaryTouchId&&(this._prevLen=d.Point2.subtract(this._lastTouch2,this._lastTouch1).length(),this._dragging=!0)};e.prototype.onTouchMove=function(a){var b=this._viewer.view,c=a.getId();a=a.getPosition();c===this._primaryTouchId?this._lastTouch1.assign(b.pointToWindowPosition(a)):c===this._secondaryTouchId&&this._lastTouch2.assign(b.pointToWindowPosition(a));!this._dragging||c!==this._primaryTouchId&&c!==this._secondaryTouchId||(b=d.Point2.subtract(this._lastTouch2,
this._lastTouch1).length(),this._zoomHelper(1/(1-(this._prevLen-b)*this._pinchZoomModifier),this._viewer.view.getCamera()),this._prevLen=b);return Promise.resolve()};e.prototype.onTouchEnd=function(a){a=a.getId();this._primaryTouchId===a?this._primaryTouchId=null:this._secondaryTouchId===a&&(this._secondaryTouchId=null);this._dragging=!1};e.prototype.onDeactivate=function(){this._secondaryTouchId=this._primaryTouchId=null};e.prototype._updateCameraViewAngle=function(a){var b=d.Util.degreesToRadians(90);
b=Math.tan(b/2);b*=d.Point3.subtract(a.getTarget(),a.getPosition()).length();a.setWidth(b);a.setHeight(b);return a};e.prototype._dollyZoom=function(a,b,f,e){void 0===b&&(b=this._viewer.view.getCamera());void 0===e&&(e=!1);return __awaiter(this,void 0,void 0,function(){var c,g,k,h,q,r,t,u,w,v,y,x,z=this;return __generator(this,function(l){switch(l.label){case 0:return c=this._viewer.view,b.setProjection(d.Projection.Perspective),g=b.getPosition(),k=b.getTarget(),f?[4,this._viewer.model.getModelBounding(!1,
!1,!1)]:[3,3];case 1:return h=l.sent(),q=h.extents().length(),r=q/100,[4,this._viewer.view.pickFromPoint(f,new d.PickConfig)];case 2:return t=l.sent(),u=t.getPosition(),null!==u&&(w=d.Point3.subtract(k,g),v=d.Point3.subtract(u,g),y=d.Point3.add(g,w.scale(d.Point3.dot(w,v)/d.Point3.dot(w,w))),b.setTarget(y)),x=d.Point3.subtract(b.getTarget(),g),0<a&&x.length()<r&&b.setTarget(d.Point3.add(k,x.copy().normalize().scale(2*r))),x=d.Point3.subtract(b.getTarget(),g),b.setPosition(d.Point3.add(g,x.copy().scale(a/
10))),[3,4];case 3:x=d.Point3.subtract(k,g).scale(a/10),b.setPosition(d.Point3.add(g,x)),e&&b.setTarget(d.Point3.add(k,x)),l.label=4;case 4:return b=this._updateCameraViewAngle(b),this._viewer.pauseRendering(function(){if(f){var a=b.getCameraPlaneIntersectionPoint(f,z._viewer.view);c.setCamera(b);var e=b.getCameraPlaneIntersectionPoint(f,z._viewer.view);null!==a&&null!==e&&b.dolly(d.Point3.subtract(e,a))}c.setCamera(b)}),[2]}})})};e.prototype._doZoom=function(a,b,f){void 0===b&&(b=this._viewer.view.getCamera());
return __awaiter(this,void 0,void 0,function(){var c,e,g,h,p,q,r,t=this;return __generator(this,function(k){switch(k.label){case 0:return c=this._viewer.view,e=Math.max(1/(1-a),.001),f&&this._zoomToMousePosition?this._adjustCameraTarget?[4,this._viewer.view.pickFromPoint(f,new d.PickConfig)]:[3,2]:[3,3];case 1:g=k.sent(),void 0!==g&&g.isEntitySelection()&&(h=b.getPosition().subtract(b.getTarget()),p=d.Point3.subtract(b.getTarget(),b.getPosition()),q=d.Point3.subtract(g.getPosition(),b.getPosition()),
r=b.getPosition().add(p.scale(d.Point3.dot(p,q)/d.Point3.dot(p,p))),b.setTarget(r),b.setPosition(d.Point3.add(r,h))),k.label=2;case 2:return this._viewer.pauseRendering(function(){var a=b.getCameraPlaneIntersectionPoint(f,t._viewer.view);t._zoomHelper(e,b);var g=b.getCameraPlaneIntersectionPoint(f,t._viewer.view);null!==a&&null!==g&&b.dolly(d.Point3.subtract(g,a));c.setCamera(b)}),[3,4];case 3:this._zoomHelper(e,b),k.label=4;case 4:return[2]}})})};e.prototype._zoomHelper=function(a,b){var c=this._viewer.view;
b.setWidth(b.getWidth()*a);b.setHeight(b.getHeight()*a);if(this._preserveViewAngle&&!this._viewer.sheetManager.isDrawingSheetActive()){var e=b.getPosition(),g=b.getTarget();a=d.Point3.subtract(g,e).scale(a);g=d.Point3.subtract(g,a);b.setPosition(g)}c.setCamera(b)};return e}(h.OperatorBase);h.CameraZoomOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b,d,e){c=a.call(this,c)||this;c._activeOperator=null;c._activeTouchCount=0;c._touchMoveCount=0;c._returnToOrbit=!1;c._bimNavigationEnabled=!1;c._orbitOperator=b;c._panOperator=d;c._zoomOperator=e;return c}__extends(e,a);e.prototype.setBimNavigationEnabled=function(a){this._bimNavigationEnabled=a;var b=this._orbitOperator,c=this._zoomOperator,e=this._panOperator;b.clearMapping();c.clearMapping();e.clearMapping();b.setMapping(d.Button.Left);b.setBimOrbitEnabled(a);
c.setDollyZoomEnabled(a);a?(b.setPrimaryButton(d.Button.Left),c.setMapping(d.Button.Right),e.setMapping(d.Button.Middle),this._setBimCamera()):(b.addMapping(d.Button.Middle),b.setPrimaryButton(d.Button.Middle),c.addMapping(d.Button.Left,d.KeyModifiers.Shift),e.addMapping(d.Button.Right),e.addMapping(d.Button.Left,d.KeyModifiers.Control))};e.prototype._setBimCamera=function(){var a=this._viewer.view.getCamera(),b=d.Point3.subtract(a.getPosition(),a.getTarget()).normalize(),f=this._viewer.model.getViewAxes().upVector.copy();
f=d.Point3.cross(b,f);b=d.Point3.cross(f,b);a.setUp(b);a.setProjection(d.Projection.Perspective);this._viewer.view.setCamera(a)};e.prototype.getBimNavigationEnabled=function(){return this._bimNavigationEnabled};e.prototype.onViewOrientationChange=function(){this._activeTouchCount=0;this._returnToOrbit=!1};e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);this._setActiveOperatorForMouseInput(c);this._activeOperator&&(this._bimNavigationEnabled&&this._setBimCamera(),this._activeOperator.onMouseDown(c))};
e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);if(this._activeOperator&&this._dragging&&3<this._dragCount)this._activeOperator.onMouseMove(c)};e.prototype.onMouseUp=function(c){if(this._activeOperator)this._activeOperator.onMouseUp(c);this._activeOperator instanceof h.CameraOrbitOperator||this._orbitOperator._removeMarkup();a.prototype.onMouseUp.call(this,c)};e.prototype.onMousewheel=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,
this._zoomOperator.onMousewheel(a)];case 1:return b.sent(),[2]}})})};e.prototype.onTouchStart=function(a){++this._activeTouchCount;this._orbitOperator.onTouchStart(a);this._zoomOperator.onTouchStart(a);this._viewer.sheetManager.isDrawingSheetActive()&&(this._panOperator.onTouchStart(a),this._orbitOperator.onDeactivate());1===this._activeTouchCount&&(this._primaryTouchId=a.getId());2===this._activeTouchCount&&(this._orbitOperator.onDeactivate(),this._panOperator.onTouchStart(a),this._zoomOperator.onTouchStart(a))};
e.prototype.onTouchMove=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:++this._touchMoveCount;if(!(5<this._touchMoveCount))return[3,8];if(!this._returnToOrbit)return[3,1];this._orbitOperator.onTouchStart(a);this._returnToOrbit=!1;return[3,8];case 1:return 1!==this._activeTouchCount?[3,5]:[4,this._orbitOperator.onTouchMove(a)];case 2:return b.sent(),[4,this._zoomOperator.onTouchMove(a)];case 3:return b.sent(),[4,this._panOperator.onTouchMove(a)];
case 4:return b.sent(),[3,8];case 5:return 2!==this._activeTouchCount?[3,8]:[4,this._zoomOperator.onTouchMove(a)];case 6:return b.sent(),[4,this._panOperator.onTouchMove(a)];case 7:b.sent(),b.label=8;case 8:return[2]}})})};e.prototype.onTouchEnd=function(a){2===this._activeTouchCount&&(this._returnToOrbit=!0);this._zoomOperator.onTouchEnd(a);this._panOperator.onTouchEnd(a);this._orbitOperator.onTouchEnd(a);0<this._activeTouchCount&&--this._activeTouchCount;0===this._activeTouchCount&&(this._touchMoveCount=
0)};e.prototype.stopInteraction=function(){var c=[];var b=a.prototype.stopInteraction.call(this);void 0!==b&&c.push(b);this._touchMoveCount=this._activeTouchCount=0;b=this._zoomOperator.onDeactivate();void 0!==b&&c.push(b);b=this._panOperator.onDeactivate();void 0!==b&&c.push(b);b=this._orbitOperator.onDeactivate();void 0!==b&&c.push(b);return d.Util.waitForAll(c)};e.prototype._setActiveOperatorForMouseInput=function(a){var b=this._orbitOperator,c=this._panOperator,d=this._zoomOperator;this._activeOperator=
null;this._viewer.sheetManager.isDrawingSheetActive()?this._activeOperator=c:b.checkMapping(a)?this._activeOperator=b:d.checkMapping(a)?this._activeOperator=d:c.checkMapping(a)&&(this._activeOperator=c)};e.prototype.onDeactivate=function(){a.prototype.onDeactivate.call(this);this._orbitOperator.onDeactivate();this._panOperator.onDeactivate();this._zoomOperator.onDeactivate()};return e}(h.OperatorBase);h.CameraNavigationOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c,function(a){b._rotateAroundAxis(b._rotationAxis,a[0])})||this;b._rotationAxis=new d.Point3(0,0,1);b._tiltAmount=12;return b}__extends(e,a);e.prototype._rotateAroundAxis=function(a,b){var c=this._viewer.view,e=c.getCamera(),g=e.getPosition(),h=e.getUp().normalize(),m=e.getTarget();a=d.Matrix.createFromOffAxisRotation(a,b);b=(new d.Matrix).setTranslationComponent(-m.x,-m.y,-m.z);b=d.Matrix.multiply(b,a);m=(new d.Matrix).setTranslationComponent(m.x,
m.y,m.z);d.Matrix.multiply(b,m).transform(g,g);a.transform(h,h);h.normalize();e.setPosition(g);e.setUp(h);c.setCamera(e)};e.prototype.onMousewheel=function(a){a=a.getWheelDelta();var b=this._viewer.view.getCamera(),c=b.getUp().normalize();b=d.Point3.subtract(b.getTarget(),b.getPosition()).normalize();c=d.Point3.cross(c,b).normalize();0<a?this._rotateAroundAxis(c,this._tiltAmount):this._rotateAroundAxis(c,-this._tiltAmount)};e.prototype._axisToPoint3=function(a){switch(a){case d.Axis.X:a=new d.Point3(1,
0,0);break;case d.Axis.Y:a=new d.Point3(0,1,0);break;case d.Axis.Z:a=new d.Point3(0,0,1);break;default:a=null}return a};e.prototype.setRotationAxis=function(a){a=a instanceof d.Point3?a:this._axisToPoint3(a);return null!==a?(this._rotationAxis.assign(a),!0):!1};return e}(h.CameraOrbitBaseOperator);h.CameraTurntableOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c,b){this._keyboardWalkOperator=b;this._activeOperator=this._walkOperator=c;this._walkMode=d.WalkMode.Mouse;this._active=!1}a.prototype.setWalkMode=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:if(this._walkMode===a)return[3,7];this._walkMode=a;if(a!==d.WalkMode.Keyboard)return[3,4];this._activeOperator=this._keyboardWalkOperator;return this._active?[4,this._walkOperator.onDeactivate()]:
[3,3];case 1:return c.sent(),[4,this._keyboardWalkOperator.onActivate()];case 2:c.sent(),c.label=3;case 3:return[3,7];case 4:return this._activeOperator=this._walkOperator,this._active?[4,this._keyboardWalkOperator.onDeactivate()]:[3,7];case 5:return c.sent(),[4,this._walkOperator.onActivate()];case 6:c.sent(),c.label=7;case 7:return[2]}})})};a.prototype.getWalkMode=function(){return this._activeOperator instanceof h.CameraKeyboardWalkOperator?d.WalkMode.Keyboard:d.WalkMode.Mouse};a.prototype.onMouseDown=
function(a){this._activeOperator.onMouseDown(a)};a.prototype.onMouseMove=function(a){this._activeOperator.onMouseMove(a)};a.prototype.onMouseUp=function(a){this._activeOperator.onMouseUp(a)};a.prototype.onMousewheel=function(a){this._activeOperator.onMousewheel(a)};a.prototype.onTouchStart=function(a){this._activeOperator.onTouchStart(a)};a.prototype.onTouchMove=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._activeOperator.onTouchMove(a)];
case 1:return c.sent(),[2]}})})};a.prototype.onTouchEnd=function(a){this._activeOperator.onTouchEnd(a)};a.prototype.onKeyDown=function(a){this._activeOperator.onKeyDown(a)};a.prototype.onKeyUp=function(a){if(this._activeOperator instanceof h.CameraKeyboardWalkOperator)this._activeOperator.onKeyUp(a)};a.prototype.onDeactivate=function(){return this._activeOperator.onDeactivate()};a.prototype.onActivate=function(){this._active=!0;return this._activeOperator.onActivate()};a.prototype.onViewOrientationChange=
function(){this._active=!1};a.prototype.stopInteraction=function(){return this._activeOperator.stopInteraction()};a.prototype.setBimModeEnabled=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){c=[];a?(c.push(this._keyboardWalkOperator.enableBimMode()),c.push(this._walkOperator.enableBimMode())):(c.push(this._keyboardWalkOperator.disableBimMode()),c.push(this._walkOperator.disableBimMode()));return[2,Promise.all(c).then(function(){})]})})};a.prototype.resetDefaultWalkSpeeds=
function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,Promise.all([this._walkOperator.resetDefaultWalkSpeeds(),this._keyboardWalkOperator.resetDefaultWalkSpeeds()]).then(function(){})]})})};a.prototype.setBimFloorConfig=function(a){this._walkOperator.setBimFloorConfig(a);this._keyboardWalkOperator.setBimFloorConfig(a)};a.prototype.setBimWallConfig=function(a){this._walkOperator.setBimWallConfig(a);this._keyboardWalkOperator.setBimWallConfig(a)};a.prototype.setBimDoorConfig=
function(a){this._walkOperator.setBimDoorConfig(a);this._keyboardWalkOperator.setBimDoorConfig(a)};a.prototype.setZoomSpeed=function(a){this._walkOperator.setZoomSpeed(a);this._keyboardWalkOperator.setZoomSpeed(a)};a.prototype.setWalkSpeed=function(a){this._walkOperator.setWalkSpeed(a);this._keyboardWalkOperator.setWalkSpeed(a)};a.prototype.setElevationSpeed=function(a){this._walkOperator.setElevationSpeed(a);this._keyboardWalkOperator.setElevationSpeed(a)};a.prototype.setRotationSpeed=function(a){this._walkOperator.setRotationSpeed(a);
this._keyboardWalkOperator.setRotationSpeed(a)};a.prototype.setViewAngle=function(a){this._walkOperator.setViewAngle(a);this._keyboardWalkOperator.setViewAngle(a)};return a}();h.CameraWalkModeOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._timerId=null;c._walkButton=d.Button.None;c._previousTimestamp=0;c._activeTouchCount=0;c._maxDistance=200;return c}__extends(e,a);e.prototype.onActivate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,a.prototype.onActivate.call(this)];case 1:return c.sent(),this._viewer.trigger("walkOperatorActivated"),[2]}})})};e.prototype.onKeyDown=function(a){a=
a.getKeyCode();var b=this.getWalkSpeed();a===d.KeyCode.PgUp&&this.setWalkSpeed(1.2*b);a===d.KeyCode.PgDown&&this.setWalkSpeed(.8*b);a===d.KeyCode.v&&this.toggleBimMode()};e.prototype.onDeactivate=function(){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return c=this._resetCameraTarget(),this.stopWalking(),[4,a.prototype.onDeactivate.call(this)];case 1:return b.sent(),this._viewer.trigger("walkOperatorDeactivated"),[2,c]}})})};e.prototype._checkProjection=
function(){var a=this._viewer.view;a.getProjectionMode()!==d.Projection.Perspective&&(a.setProjectionMode(d.Projection.Perspective),this._calculateInitialPosition())};e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);this._checkProjection();this.isActive()&&(this.stopWalking(),this.setWalkActive(!0),this._walkButton=c.getButton())};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);this.getWalkActive()&&null===this._timerId&&this.isActive()&&(this._previousTimestamp=
Date.now(),this._onTick())};e.prototype.onMouseUp=function(c){this.isActive()&&this.stopWalking();a.prototype.onMouseUp.call(this,c)};e.prototype.onTouchStart=function(c){a.prototype.onTouchStart.call(this,c);++this._activeTouchCount;1===this._activeTouchCount?this._walkButton=d.Button.Left:2===this._activeTouchCount?this._walkButton=d.Button.Right:3===this._activeTouchCount&&(this._walkButton=d.Button.None)};e.prototype.onTouchMove=function(c){return __awaiter(this,void 0,void 0,function(){var b;
return __generator(this,function(f){switch(f.label){case 0:if(3!==this._activeTouchCount||this._primaryTouchId!==c.getId())return[3,1];this._ptCurrent.assign(c.getPosition());b=d.Point2.subtract(this._ptCurrent,this._ptPrevious);this._adjustTilt(b.y/100*1.5);return[3,3];case 1:return 3>this._activeTouchCount?[4,a.prototype.onTouchMove.call(this,c)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[2,Promise.resolve()]}})})};e.prototype.onTouchEnd=function(c){a.prototype.onTouchEnd.call(this,c);0<this._activeTouchCount&&
--this._activeTouchCount};e.prototype.onMousewheel=function(a){this._checkProjection();0<a.getWheelDelta()?this._adjustTilt(3):this._adjustTilt(-3)};e.prototype.stopWalking=function(){null!==this._timerId&&(cancelAnimationFrame(this._timerId),this._timerId=null);this.setWalkActive(!1)};e.prototype._testWalk=function(a,b,f){return __awaiter(this,void 0,void 0,function(){var c,e,g;return __generator(this,function(k){switch(k.label){case 0:return c=new d.Event.MouseInputEvent(0,0,f,d.Buttons.None,d.KeyModifiers.None,
d.MouseInputType.Down),e=new d.Event.MouseInputEvent(0,a,f,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Move),g=new d.Event.MouseInputEvent(0,a,f,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Up),this.onMouseDown(c),this.onMouseMove(e),[4,d.Util.sleep(b)];case 1:return k.sent(),this.onMouseUp(g),[2]}})})};e.prototype._onTick=function(){var a=this,b=Date.now(),f=(b-this._previousTimestamp)/1E3;this._previousTimestamp=b;var e=this._viewer.view;b=d.Point2.subtract(this._ptCurrent,this._ptFirst);
var g=new d.Point2(Math.abs(b.x)/this._maxDistance,Math.abs(b.y)/this._maxDistance),h=this.getRotationSpeed()*f*g.x,m=this.getWalkSpeed()*f*g.y,p=this.getElevationSpeed()*f*g.x;f=this.getElevationSpeed()*f*g.y;if(this._walkButton===d.Button.Left){if(0!==b.x&&(0<b.x?this.rotateRight(h):0>b.x&&this.rotateLeft(h)),0!==b.y){var q=e.getCamera();this._resetPosition(q);f=q.getTarget();e=q.getPosition();f=d.Point3.subtract(f,e).normalize();var r=q.getUp(),t=d.Point3.scale(f,m);0<b.y&&(t=t.negate());this.setWalkActive(!0);
var u=this.getBimModeEnabled();this.getActiveWalk().set(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return u?[4,this._applyWalkDeltaWithCollisionCheck(q,t,r)]:[3,4];case 1:return b.sent(),[4,this._applyGravity()];case 2:return b.sent(),[4,this._updateNearbyDoors()];case 3:return b.sent(),[3,5];case 4:return[2,this._applyWalkDelta(q,t)];case 5:return[2]}})})})}}else if(this._walkButton===d.Button.Right||this._walkButton===d.Button.Middle)0<
Math.abs(b.y)&&(0<b.y?this.walkUp(f):this.walkDown(f)),0<Math.abs(b.x)&&(0<b.x?this.walkRight(p):this.walkLeft(p));this._timerId=requestAnimationFrame(function(){a._onTick()})};e.prototype._adjustTilt=function(a){var b=this._viewer.view;this.setTilt(this.getTilt()+a);a=b.getCamera();this._resetPosition(a);var c=a.getTarget(),e=a.getPosition(),g=d.Point3.distance(c,e),h=a.getUp().normalize();c=d.Point3.subtract(c,e).normalize();h=d.Point3.cross(h,c).normalize();d.Matrix.createFromOffAxisRotation(h,
this.getTilt()).transform(c,c);c.normalize().scale(g);a.setTarget(d.Point3.add(e,c));b.setCamera(a)};e.prototype._resetCameraTarget=function(){return __awaiter(this,void 0,void 0,function(){var a,b,f,e,g,h;return __generator(this,function(c){switch(c.label){case 0:return a=this._viewer.view,b=a.getCanvasSize(),f=new d.Point2(Math.round(b.x/2),Math.round(b.y/2)),e=new d.PickConfig,[4,a.pickFromPoint(f,e)];case 1:return g=c.sent(),g.isEntitySelection()&&(h=a.getCamera(),h.setTarget(g.getPosition()),
a.updateCamera(h)),[2]}})})};return e}(h.CameraWalkBaseOperator);h.CameraWalkOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._rectangleMarkup=new h.SelectionRectangleMarkup(c,!0);b._view=c.view;b._computeTarget=!1;b._preserveViewAngle=!0;return b}__extends(e,a);e.prototype.setComputeTarget=function(a){this._computeTarget=a};e.prototype.getComputeTarget=function(){return this._computeTarget};e.prototype.setPreserveViewAngle=function(a){this._preserveViewAngle=a};e.prototype.getPreserveViewAngle=function(){return this._preserveViewAngle};
e.prototype.adjustPositionToPlane=function(a,b){var c=this._view.getCamera().getViewMatrix(this._viewer);b=c.transform(b);a=c.transform(a);b.z=a.z;c=d.Matrix.inverse(c);return null===c?null:c.transform(b)};e.prototype.computeNewField=function(a,b,f){var c=d.Point2.add(a,d.Point2.scale(d.Point2.subtract(b,a),.5)),e=new d.Point2(b.x,c.y),g=new d.Point2(c.x,b.y);b=new d.Point2(a.x,c.y);a=new d.Point2(c.x,a.y);c=this._view.getCamera();e=c.getCameraPlaneIntersectionPoint(e,this._view);g=c.getCameraPlaneIntersectionPoint(g,
this._view);b=c.getCameraPlaneIntersectionPoint(b,this._view);a=c.getCameraPlaneIntersectionPoint(a,this._view);if(null===e||null===g||null===b||null===a)return null;e=this.adjustPositionToPlane(f,e);g=this.adjustPositionToPlane(f,g);b=this.adjustPositionToPlane(f,b);f=this.adjustPositionToPlane(f,a);if(null===e||null===g||null===b||null===f)return null;b=d.Point3.subtract(e,b);f=d.Point3.subtract(g,f);return[b.length(),f.length()]};e.prototype.computeReasonableTarget=function(a,b){return __awaiter(this,
void 0,void 0,function(){var c,e,g,h,m,p,q,r,t,u,w,v,y;return __generator(this,function(f){switch(f.label){case 0:return c=d.Point2.add(a,d.Point2.scale(d.Point2.subtract(b,a),.5)),[4,this._view.pickFromPoint(c,new d.PickConfig)];case 1:return e=f.sent(),null===e.getNodeId()?[3,2]:[2,e.getPosition()];case 2:return g=0,h=d.Point3.zero(),[4,this._view.beginScreenSelectByArea(a,b,new d.IncrementalPickConfig)];case 3:m=f.sent(),f.label=4;case 4:return[4,this._view.advanceIncrementalSelection(m)];case 5:p=
f.sent();if(null===p)return[3,6];q=0;for(r=p;q<r.length;q++)t=r[q],u=t.getPosition(),null!==u&&(h.add(u),g++);return[3,4];case 6:w=this._view.getCamera();v=w.getCameraPlaneIntersectionPoint(c,this._view);if(null===v)return[2,null];0!==g&&(y=d.Point3.scale(h,1/g),v=this.adjustPositionToPlane(y,v));return[2,v]}})})};e.prototype.getCameraTarget=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,e,g;return __generator(this,function(f){if(this._computeTarget)return[2,this.computeReasonableTarget(a,
b)];c=this._view.getCamera();e=d.Point2.add(a,d.Point2.scale(d.Point2.subtract(b,a),.5));g=c.getCameraPlaneIntersectionPoint(e,this._view);return[2,g]})})};e.prototype.doZoom=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,e,g,h,m,p,q,r,t,u,w=this;return __generator(this,function(f){switch(f.label){case 0:return c=this._view.getCamera(),e=c.copy(),g=c.getTarget(),[4,this.getCameraTarget(a,b)];case 1:h=f.sent();if(null===h)return[2];m=this.computeNewField(a,b,h);if(null===m)return[2];
p=m[0];q=m[1];r=this._view.getCanvasSize();t=new d.Point2(0,0);u=d.Point3.distance(c.getCameraPlaneIntersectionPoint(r,this._view),c.getCameraPlaneIntersectionPoint(t,this._view));e.setWidth(p);e.setHeight(q);e.setTarget(h);this._viewer.pauseRendering(function(){w._view.setCamera(e);var b=d.Point3.subtract(g,c.getPosition());if(w._preserveViewAngle){var a=d.Point3.distance(e.getCameraPlaneIntersectionPoint(r,w._view),e.getCameraPlaneIntersectionPoint(t,w._view)),f=b.length()/u;b=d.Point3.add(h,d.Point3.scale(b.negate().normalize(),
f*a))}else b=d.Point3.subtract(h,b);e.setPosition(b);w._view.setCamera(e)});return[2]}})})};e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);this.isActive()&&(c.setHandled(!0),this._rectangleMarkup.isActive()&&this._rectangleMarkup.deactivate(),this._rectangleMarkup.activate(c.getPosition()))};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);this.isActive()&&this._rectangleMarkup.isActive()&&(c.setHandled(!0),this._rectangleMarkup.updateCurrentPosition(c.getPosition()),
this._viewer.markupManager.refreshMarkup())};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive()||!this._rectangleMarkup.isActive())return[3,2];b=this._rectangleMarkup;b.updateCurrentPosition(c.getPosition());if(3>=d.Point2.subtract(b.max,b.min).length())return b.deactivate(),[2];c.setHandled(!0);return[4,this.doZoom(b.min,b.max)];case 1:f.sent(),f.label=2;case 2:return this._rectangleMarkup.isActive()&&
this._rectangleMarkup.deactivate(),a.prototype.onMouseUp.call(this,c),[2]}})})};return e}(h.OperatorBase);h.CameraWindowZoomOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(){this._positionOffset=d.Point2.zero();this._position=d.Point2.zero();this._activeNoteText=null;this._createTextBox()}a.prototype._createTextBox=function(){var a=this;this._container=document.createElement("div");this._container.className="noteTextElement";this._textArea=document.createElement("textarea");this._textArea.oninput=function(){null!==a._activeNoteText&&a._activeNoteText.saveTextValue()};this._container.appendChild(this._textArea);
var b=7;["blue","red","green","white","black"].forEach(function(c){var f=document.createElement("button");f.className="noteButton color "+c;f.style.top=b+"px";b+=25;f.id=c+"_button";switch(c){case "blue":var e=d.Color.blue();break;case "red":e=d.Color.red();break;case "green":e=d.Color.green();break;case "white":e=d.Color.white();break;case "black":e=d.Color.black();break;default:e=d.Color.white()}f.onmousedown=function(){null!==a._activeNoteText&&a._activeNoteText.setColor(e)};a._container.appendChild(f)});
var f=document.createElement("button");f.className="noteButton trash";f.style.top=b+"px";f.onmousedown=function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._activeNoteText?[3,2]:[4,this._activeNoteText.remove()];case 1:b.sent(),b.label=2;case 2:return[2]}})})};this._container.appendChild(f)};a.prototype.setPositionOffset=function(a){this._positionOffset=a};a.prototype.getPositionOffset=function(){return this._positionOffset.copy()};
a.prototype.setPosition=function(a){this._position=d.Point2.add(a,this._positionOffset);this._container.style.left=this._position.x+"px";this._container.style.top=this._position.y+"px"};a.prototype.getPosition=function(){return this._position.copy()};a.prototype.setText=function(a){var b=this._container.querySelector("textarea");null!==b&&(b.value=a)};a.prototype.getText=function(){var a=this._container.querySelector("textarea");return null!==a?a.value:""};a.prototype.setSize=function(a){this._container.style.width=
a.x+"px";this._container.style.height=a.y+"px"};a.prototype.getSize=function(){var a=this._container.getBoundingClientRect();return new d.Point2(a.width,a.height)};a.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents="auto"};a.prototype.blur=function(){this._container.blur()};a.prototype.hide=function(){this._container.style.visibility="hidden";this._activeNoteText=null};a.prototype.show=function(a){this._container.style.visibility="visible";this._activeNoteText=
a};a.prototype.getHtmlContainer=function(){return this._container};a.prototype.setHtmlContainer=function(a){this._container=a};return a}();g.NoteTextElement=a})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){return function(){this.rotate=this.viewPlane=this.plane=this.axis=null}}(),a=function(){return function(a,b,f,e,g,h){this.vector=b;this.matrix=f;this.nodeId=e;this.position=a;this.handleType=g;this.translation=d.Point3.zero();this.groupId=h}}(),e=function(c){function b(b){var a=c.call(this)||this;a._meshIds=new g;a._scaleModifier=1;a._id=0;a._handleData=new Map;a._translationFromInitialHandlePosition=d.Point3.zero();a._groupIdRotationMatrix=new Map;a._viewer=
b;a._callbacks={camera:function(){a._updateCamera()},_assemblyTreeReady:function(){return __awaiter(a,void 0,void 0,function(){var b,a,c,d,f=this;return __generator(this,function(e){this._updateViewport();this._hideOverlay();b=this._createMeshId(this._getAxisMeshData()).then(function(b){f._meshIds.axis=b});a=this._createMeshId(this._getPlaneMeshData()).then(function(b){f._meshIds.plane=b});c=this._createMeshId(this._getViewPlaneMeshData()).then(function(b){f._meshIds.viewPlane=b});d=this._createMeshId(this._getRotateMeshData()).then(function(b){f._meshIds.rotate=
b});b;a;c;d;return[2]})})},modelSwitchStart:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.removeHandles()];case 1:return b.sent(),[2]}})})}};a._viewer.setCallbacks(a._callbacks);return a}__extends(b,c);b.prototype.remove=function(){null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);c.prototype.remove.call(this)};b.prototype._getAxisMeshData=function(){return d.Util.generateConeCylinderMeshData(b._cylinderRadius,
b._segmentCount,b._cylinderHeight,b._coneBaseRadius,b._capHeight,b._taperHeight)};b.prototype._getPlaneMeshData=function(){var a=new d.Point3(b._planeOffset,0,b._planeOffset),c=new d.Point3(b._planeOffset+b._planeLength,0,b._planeOffset),e=new d.Point3(b._planeOffset+b._planeLength,0,b._planeOffset+b._planeLength),g=new d.Point3(b._planeOffset,0,b._planeOffset+b._planeLength),h=[a.x,a.y,a.z,c.x,c.y,c.z,e.x,e.y,e.z,a.x,a.y,a.z,e.x,e.y,e.z,g.x,g.y,g.z],p=new d.Point3(0,-1,0);p=[p.x,p.y,p.z,p.x,p.y,
p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z];var q=new d.MeshData;q.addFaces(h,p);q.setBackfacesEnabled(!0);q.addPolyline([a.x,a.y,a.z,c.x,c.y,c.z]);q.addPolyline([c.x,c.y,c.z,e.x,e.y,e.z]);q.addPolyline([e.x,e.y,e.z,g.x,g.y,g.z]);q.addPolyline([g.x,g.y,g.z,a.x,a.y,a.z]);return q};b.prototype._getViewPlaneMeshData=function(){return d.Util.generateSphereMeshData()};b.prototype._getRotateMeshData=function(b,a,c){void 0===b&&(b=35);void 0===a&&(a=12);void 0===c&&(c=.5);var f=b*Math.PI/180*.5;
b=[];for(var e=-f;e<=f;e+=.1){var g=Math.sin(e)*a;b.push(Math.cos(e)*a);b.push(0);b.push(g)}a=new d.Point3(0,0,1);c=d.Util.createCylinderMeshDataFromArc(b,a,10,c);c.setBackfacesEnabled(!0);return c};b.prototype.setAxisMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.axis?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),this._meshIds.axis=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.axis,
b)];case 3:return[2]}})})};b.prototype.setPlaneMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.plane?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),this._meshIds.plane=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.plane,b)];case 3:return[2]}})})};b.prototype.setViewPlaneMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,
function(c){switch(c.label){case 0:return null!==this._meshIds.viewPlane?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),this._meshIds.viewPlane=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.viewPlane,b)];case 3:return[2]}})})};b.prototype.setRotateMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.rotate?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),
this._meshIds.rotate=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.rotate,b)];case 3:return[2]}})})};b.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.Handles};b.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.Handles,!1)};b.prototype.hideOverlay=function(){this._hideOverlay();return Promise.resolve()};b.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.Handles,!0);
this._updateCamera()};b.prototype.showOverlay=function(){this._showOverlay();return Promise.resolve()};b.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.Handles,d.OverlayAnchor.UpperLeftCorner,0,d.OverlayUnit.ProportionOfCanvas,0,d.OverlayUnit.ProportionOfCanvas,1,d.OverlayUnit.ProportionOfCanvas,1,d.OverlayUnit.ProportionOfCanvas)};b.prototype.updateViewport=function(){this._updateViewport();return Promise.resolve()};b.prototype.addHandles=function(b,
a,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return this._scaleModifier=a,this._translationFromInitialHandlePosition.assign(d.Point3.zero()),[4,this.createDefaultHandles(b,c)];case 1:return f.sent(),this._showOverlay(),[2]}})})};b.prototype._updateCamera=function(){this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.Handles,this._viewer.view.getCamera())};b.prototype.getVector=function(b){b=this._handleData.get(b);return void 0!==
b&&(b=b.vector,null!==b)?b.copy():null};b.prototype.getHandleType=function(b){b=this._handleData.get(b);return void 0===b?null:b.handleType};b.prototype.getHandleGroupId=function(a){a=this._handleData.get(a);return void 0===a?b.defaultGroupId:a.groupId};b.prototype.getPosition=function(b){if(b=this._handleData.get(b)){var a=b.translation.copy();return b.position.copy().add(this._translationFromInitialHandlePosition).add(a)}return null};b.prototype.getHandleNodeIds=function(b){void 0===b&&(b=null);
var a=[];this._handleData.forEach(function(b,c){a.push([c,b])});null!==b&&(a=a.filter(function(a){return a[1].groupId===b}));return a.map(function(b){return b[0]})};b.prototype.removeHandles=function(b){void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var a,c=this;return __generator(this,function(d){switch(d.label){case 0:return a=this.getHandleNodeIds(b),null===b?(this._handleData.clear(),this._groupIdRotationMatrix.clear()):(a.forEach(function(b){c._handleData.delete(b)}),this._groupIdRotationMatrix.delete(b)),
0===this._handleData.size&&(this._id=0,this._hideOverlay()),[4,this._viewer.model.deleteMeshInstances(a)];case 1:return d.sent(),[2]}})})};b.prototype.isEmpty=function(){return 0===this._handleData.size};b.prototype.createDefaultHandles=function(a,c){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(e){switch(e.label){case 0:return f=[],f.push(this.addViewPlaneHandle(a,b._viewPlaneColor,c)),f.push(this.addAxisTranslationHandle(a,new d.Point3(1,0,0),b._xColor,null,
c)),f.push(this.addAxisTranslationHandle(a,new d.Point3(0,1,0),b._yColor,null,c)),f.push(this.addAxisTranslationHandle(a,new d.Point3(0,0,1),b._zColor,null,c)),f.push(this.addPlaneTranslationHandle(a,new d.Point3(1,0,0),b._zColor,d.Color.black(),new d.Point3(0,-1,0),c)),f.push(this.addPlaneTranslationHandle(a,new d.Point3(0,1,0),b._xColor,d.Color.black(),new d.Point3(0,0,-1),c)),f.push(this.addPlaneTranslationHandle(a,new d.Point3(0,0,1),b._yColor,d.Color.black(),new d.Point3(-1,0,0),c)),f.push(this.addRotateHandle(a,
new d.Point3(1,0,0),b._zColor,new d.Point3(0,-1,0),c)),f.push(this.addRotateHandle(a,new d.Point3(0,1,0),b._xColor,new d.Point3(0,0,-1),c)),f.push(this.addRotateHandle(a,new d.Point3(0,0,1),b._yColor,new d.Point3(-1,0,0),c)),[4,Promise.all(f)];case 1:return e.sent(),[2]}})})};b.prototype._createMeshId=function(b){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(d){switch(d.label){case 0:return a=this._viewer.model,[4,a.createMesh(b,{doNotDelete:!0})];case 1:return c=
d.sent(),[2,c]}})})};b.prototype.addAxisTranslationHandle=function(b,c,e,g,h){return __awaiter(this,void 0,void 0,function(){var f,k,l,n;return __generator(this,function(m){switch(m.label){case 0:if(null!==this._meshIds.axis)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getAxisMeshData())];case 1:f.axis=m.sent(),m.label=2;case 2:return k="handle-axis-translation-"+this._id++,l=this._getRotationMatrixFromVector(c,g),[4,this._createMeshInstance(this._meshIds.axis,k,e,null,b.copy(),l.copy())];
case 3:return n=m.sent(),this._handleData.set(n,new a(b.copy(),c.copy(),l.copy(),n,d.HandleType.Axis,h)),[2,n]}})})};b.prototype.addViewPlaneHandle=function(b,c,e){return __awaiter(this,void 0,void 0,function(){var f,g;return __generator(this,function(k){switch(k.label){case 0:if(null!==this._meshIds.viewPlane)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getViewPlaneMeshData())];case 1:f.viewPlane=k.sent(),k.label=2;case 2:return[4,this._createMeshInstance(this._meshIds.viewPlane,
"handle-sphere-instance",c,null,b,new d.Matrix)];case 3:return g=k.sent(),this._handleData.set(g,new a(b.copy(),null,new d.Matrix,g,d.HandleType.ViewPlane,e)),[2,g]}})})};b.prototype.addPlaneTranslationHandle=function(b,c,e,g,h,p){return __awaiter(this,void 0,void 0,function(){var f,k,l,n;return __generator(this,function(m){switch(m.label){case 0:if(null!==this._meshIds.plane)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getPlaneMeshData())];case 1:f.plane=m.sent(),m.label=2;case 2:return k=
"handle-plane-translation-"+this._id++,l=this._getRotationMatrixFromVector(c,h),[4,this._createMeshInstance(this._meshIds.plane,k,e,g,b,l)];case 3:return n=m.sent(),this._handleData.set(n,new a(b.copy(),c.copy(),l.copy(),n,d.HandleType.Plane,p)),[2,n]}})})};b.prototype.addRotateHandle=function(b,c,e,g,h){return __awaiter(this,void 0,void 0,function(){var f,k,l,n;return __generator(this,function(m){switch(m.label){case 0:if(null!==this._meshIds.rotate)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getRotateMeshData())];
case 1:f.rotate=m.sent(),m.label=2;case 2:return k="handle-rotate-"+this._id++,l=this._getRotationMatrixFromVector(c,g),[4,this._createMeshInstance(this._meshIds.rotate,k,e,null,b,l)];case 3:return n=m.sent(),this._handleData.set(n,new a(b.copy(),c.copy(),l.copy(),n,d.HandleType.Rotate,h)),[2,n]}})})};b.prototype._getRotationMatrixFromVector=function(b,a){a||(a=new d.Point3(1,0,0),.001>d.Point3.cross(a,b).squaredLength()&&(a=new d.Point3(0,1,0)));a=d.Point3.cross(a,b).normalize();var c=d.Point3.cross(a,
b).normalize();b.normalize();var f=new d.Matrix;f.m[0]=a.x;f.m[1]=a.y;f.m[2]=a.z;f.m[3]=0;f.m[4]=b.x;f.m[5]=b.y;f.m[6]=b.z;f.m[7]=0;f.m[8]=c.x;f.m[9]=c.y;f.m[10]=c.z;f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;return f};b.prototype._createMeshInstance=function(b,a,c,e,g,h){return __awaiter(this,void 0,void 0,function(){var f,k,l;return __generator(this,function(n){f=this._createTransformationMatrix(g,new d.Matrix);f=d.Matrix.multiply(h,f);k=new d.MeshInstanceData(b,f,a,c||void 0,e||void 0);
k.setOpacity(1);k.setCreationFlags(d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw);k.setOverlayIndex(d.BuiltinOverlayIndex.Handles);l=this._viewer.model;return[2,l.createMeshInstance(k,void 0,!0,!0)]})})};b.prototype._createTransformationMatrix=function(a,
c){var f=b._defaultScale*this._scaleModifier;f=(new d.Matrix).setScaleComponent(f,f,f);f=d.Matrix.multiply(f,c);f.setTranslationComponent(a.x,a.y,a.z);return f};b.prototype._getHandlePosition=function(b){var a=null;this._handleData.forEach(function(c){c.groupId===b&&(a=c.position.copy())});return a};b.prototype.getGroupIdRotationMatrix=function(b){b=this._groupIdRotationMatrix.get(b);return void 0===b?new d.Matrix:b.copy()};b.prototype.updatePosition=function(b,a,c,e,g){return __awaiter(this,void 0,
void 0,function(){var f,k,h,l,n=this;return __generator(this,function(m){switch(m.label){case 0:f=this._viewer.model;k=[];h=new Map;l=this._getHandlePosition(e);if(null===l)return[2];this._handleData.forEach(function(m,p){var q=m.groupId,r=void 0!==g.get(q);if(q===e||r){var t=m.position.copy();t.add(b.copy());var u=m.translation.copy();t.add(u);u=d.Matrix.multiply(n.getGroupIdRotationMatrix(q),a);u=d.Matrix.multiply(m.matrix,u);r&&(r=d.Point3.subtract(t,l),a.transform(r,t),t.add(l));r=n._createTransformationMatrix(t,
u);c&&(m.position.assign(t),h.set(q,d.Matrix.multiply(n.getGroupIdRotationMatrix(q),a)));k.push(f.setNodeMatrix(p,r))}});h.forEach(function(b,a){n._groupIdRotationMatrix.set(a,b.copy())});return[4,Promise.all(k)];case 1:return m.sent(),[2]}})})};b.prototype.resetTranslation=function(){var b=this;this._translationFromInitialHandlePosition&&(this._handleData.forEach(function(a){a.translation.add(b._translationFromInitialHandlePosition)}),this._translationFromInitialHandlePosition.assign(d.Point3.zero()))};
b.prototype.getTranslation=function(){return this._translationFromInitialHandlePosition};b.className="Communicator.Markup.HandleMarkup";b.defaultGroupId=-1;b._defaultScale=.02;b._cylinderRadius=.5;b._coneBaseRadius=.9;b._cylinderHeight=7;b._capHeight=1.2;b._taperHeight=.2;b._segmentCount=20;b._planeOffset=1;b._planeLength=2.5;b._xColor=new d.Color(168,56,59);b._yColor=new d.Color(96,166,50);b._zColor=new d.Color(41,81,185);b._viewPlaneColor=d.Color.white();return b}(h.MarkupItem);h.HandleMarkup=e})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._firstNode=null;c._firstPointShape=new h.Shape.Circle;c._secondPointShape=new h.Shape.Circle;c._arrowsInvert=!1;c._measurePoint1=null;c._measurePoint2=null;c._leaderPoint1=null;c._leaderPoint2=null;c._textPoint=null;c._name="MeasureBodyBodyDistance";c._lineShapes=[];for(var e=0;6>e;e++)c._lineShapes.push(new h.Shape.Line),c._lineShapes[e].setStrokeColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setEndEndcapColor(c._viewer.measureManager.getMeasurementColor()),
c._lineShapes[e].setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());c._viewer=b;c.initCircle(c._firstPointShape);c.initCircle(c._secondPointShape);c._textShape=new h.Shape.TextBox;c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));return c}__extends(c,a);c.prototype.initCircle=function(b){b.setRadius(2.5);b.setFillColor(this._viewer.measureManager.getMeasurementColor())};c.prototype.setUnitMultiplier=function(b){this._unitMultiplier=
b};c.prototype.setFirstNode=function(b){this._stage=1;this._firstNode=b};c.prototype.getFirstNode=function(){return this._firstNode};c.prototype.setSecondNode=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:if(null===this._firstNode)return[2];this._stage=2;return[4,this._viewer.model.computeMinimumBodyBodyDistance(this._firstNode,b)];case 1:return a=c.sent(),this._measurePoint1=a.pos1.copy(),this._measurePoint2=a.pos2.copy(),
this._textPoint=a.pos2.copy(),this._setMeasurementValue(a.distance),[2]}})})};c.prototype._getStage=function(){return this._stage};c.prototype.finalize=function(){this._stage++};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);if(!(2>this._stage)){var c=this._viewer.view.raycastFromPoint(b);if(null!==c&&null!==this._measurePoint1&&null!==this._measurePoint2&&null!=this._textPoint){var e=new d.Point3(1,0,0);this._measurePoint2.equals(this._measurePoint1)||(e=d.Point3.subtract(this._measurePoint2,
this._measurePoint1));var g=this._viewer.view.getCamera().getUp();b=d.Point3.cross(c.direction,g).normalize();var h=new d.Point3((this._measurePoint1.x+this._measurePoint2.x)/2,(this._measurePoint1.y+this._measurePoint2.y)/2,(this._measurePoint1.z+this._measurePoint2.z)/2);g=new d.Point3(h.x+g.x,h.y+g.y,h.z+g.z);var m=new d.Point3(h.x+b.x,h.y+b.y,h.z+b.z),p=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z);b=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(c.origin,
p,h,g,m,b);this._textPoint.assign(b);new d.Point3(0,0,0);c=Math.abs(e.x)<=Math.abs(e.y)&&Math.abs(e.x)<=Math.abs(e.z)?new d.Point3(1,0,0):Math.abs(e.y)<=Math.abs(e.x)&&Math.abs(e.y)<=Math.abs(e.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);c=d.Point3.cross(c,e);h=d.Point3.cross(c,e);c.set(this._measurePoint1.x+c.x,this._measurePoint1.y+c.y,this._measurePoint1.z+c.z);h.set(this._measurePoint1.x+h.x,this._measurePoint1.y+h.y,this._measurePoint1.z+h.z);g=new d.Point3(b.x+1E4*e.x,b.y+1E4*e.y,b.z+1E4*e.z);
e=new d.Point3(b.x-1E4*e.x,b.y-1E4*e.y,b.z-1E4*e.z);e=d.Util.intersectionPlaneLine(g,e,this._measurePoint1,c,h,b);c=!isNaN(b.x)&&!isNaN(b.y)&&!isNaN(b.z);e&&c||(b=this._measurePoint2.copy());b=d.Point3.subtract(b,this._measurePoint1);this._leaderPoint1=new d.Point3(this._measurePoint1.x+b.x,this._measurePoint1.y+b.y,this._measurePoint1.z+b.z);this._leaderPoint2=new d.Point3(this._measurePoint2.x+b.x,this._measurePoint2.y+b.y,this._measurePoint2.z+b.z);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}}};
c.prototype._updateArrowsInverted=function(){if(null!==this._leaderPoint1&&null!==this._leaderPoint2&&null!==this._textPoint){var b=new d.Point3((this._leaderPoint1.x+this._leaderPoint2.x)/2,(this._leaderPoint1.y+this._leaderPoint2.y)/2,(this._leaderPoint1.z+this._leaderPoint2.z)/2),a=d.Point3.subtract(this._leaderPoint2,this._leaderPoint1);2*d.Point3.subtract(this._textPoint,b).length()>a.length()?this._arrowsInvert=!0:this._arrowsInvert=!1}};c.prototype.update=function(){var b=this;a.prototype.update.call(this);
if(!(1>=this._stage)){var c=this._viewer.view;this._behindView=!1;var e=function(a){if(null===a)return d.Point2.zero();a=c.projectPoint(a);0>=a.z&&(b._behindView=!0);return d.Point2.fromPoint3(a)},g=e(this._measurePoint1),n=e(this._measurePoint2),m=e(this._textPoint),p=e(this._leaderPoint1);e=e(this._leaderPoint2);this._firstPointShape.setCenter(g);this._textShape&&this._textShape.setPosition(m);this._secondPointShape.setCenter(n);this._lineShapes[0].set(g,n);this._lineShapes[1].set(p,e);this._lineShapes[2].set(g,
p);this._lineShapes[3].set(n,e);this._lineShapes[4].set(p,m);this._lineShapes[5].set(p,e);this._lineShapes[5].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[5].setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[5].setEndcapsInverted(this._arrowsInvert)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var b=this._viewer.markupManager.getRenderer();if(2===this._stage||3===this._stage){b.drawCircle(this._firstPointShape);
b.drawCircle(this._secondPointShape);for(var a=0,c=this._lineShapes;a<c.length;a++)b.drawLine(c[a]);b.drawTextBox(this._textShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,measurePoint1:this._measurePoint1,measurePoint2:this._measurePoint2,leaderPoint1:this._leaderPoint1,leaderPoint2:this._leaderPoint2,textPoint:this._textPoint,text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,
className:this.getClassName()}};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._measurePoint1=d.Point3.fromJson(b.measurePoint1);a._measurePoint2=d.Point3.fromJson(b.measurePoint2);a._textPoint=d.Point3.fromJson(b.textPoint);a._textShape.setTextString(b.text);a._leaderPoint1=d.Point3.fromJson(b.leaderPoint1);a._leaderPoint2=d.Point3.fromJson(b.leaderPoint2);a._measurementValue=b.measurementValue;a._unitMultiplier=b.unitMultiplier||1;a._updateArrowsInverted();a._stage=2;return a};c.prototype.getClassName=
function(){return"Communicator.Markup.Measure.MeasureBodyBodyDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasureBodyBodyDistanceMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._lineEdgeShape=new d.Shape.Polyline;c._linePositions=[];c._name="MeasureLength";c._positions=[];c._lineShapes=[];c._lineEdgeShape.setStrokeWidth(4);c._lineEdgeShape.setStrokeColor(b.measureManager.getMeasurementEdgeColor());return c}__extends(c,a);c.prototype.setLineGeometry=function(b){this._linePositions=b;this._stage=1};c.prototype.setMeasurementEdgeColor=function(b){this._lineEdgeShape.setStrokeColor(b)};
c.prototype.reset=function(){this._stage=0};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b)};c.prototype.draw=function(){};c.prototype.getLineEdgeShape=function(){return this._lineEdgeShape};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureLengthMarkup"};return c}(g.MeasureMarkup);g.MeasureLengthMarkup=a})(d.Measure||(d.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,c,e,g){var f=a.call(this,b)||this;f._circlePoints=[];f._radius=0;f._surfaceCenter=d.Point3.zero();f._circlePlane=new d.Plane;f._arrowsInvert=!1;f._name="MeasureCircleEdgeLength";f._lineProperties=c;f._matrix=e.copy();f._unitMultiplier=g;f._textShape.getBoxPortion().setFillOpacity(1);f._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));b=b.measureManager.getMeasurementColor();for(c=0;5>c;c++)f._lineShapes.push(new h.Shape.Line),
f._lineShapes[c].setStrokeColor(b),f._lineShapes[c].setEndEndcapColor(b),f._lineShapes[c].setStartEndcapColor(b);return f}__extends(c,a);c.prototype.createCircleData=function(){d.Util.generatePointsOnCircle(this._circlePoints,this._lineProperties.origin,this._lineProperties.radius,32,this._lineProperties.normal);this._matrix.transformArray(this._circlePoints,this._circlePoints);this._positions[0]=this._circlePoints[0].copy();this._positions[1]=this._circlePoints[16].copy();var b=new d.Point3(this._lineProperties.radius,
0,0),a=new d.Point3(0,0,0);this._matrix.transform(b,b);this._matrix.transform(a,a);this._radius=d.Point3.subtract(a,b).length();d.Point3.subtract(this._positions[1],this._positions[0]);this._positions[4]=this._positions[1].copy();this._surfaceCenter=this._matrix.transform(this._lineProperties.origin);b=new d.Point3(this._circlePoints[0].x,this._circlePoints[0].y,this._circlePoints[0].z);a=new d.Point3(this._circlePoints[1].x,this._circlePoints[1].y,this._circlePoints[1].z);this._circlePlane=d.Plane.createFromPoints(b,
a,this._surfaceCenter)};c.prototype.setLineGeometry=function(b){a.prototype.setLineGeometry.call(this,b);this._positions[0]=this._linePositions[0];this._positions[0].equals(this._positions[this._positions.length-1])?this._positions[1]=this._positions[Math.floor(this._positions.length/2)]:this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[2]=this._linePositions[1].copy();this.createCircleData();this._setMeasurementValue(this._radius)};
c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);var c=this._viewer.view.raycastFromPoint(b);if(null!==c){b=this._surfaceCenter;var e=this._circlePlane,g=e.rayIntersection(c);null===g&&(g=d.Point3.add(b,c.direction.copy().scale(-2*this._radius)),g=d.Plane.createFromPointAndNormal(g,c.direction).rayIntersection(c),console.assert(null!==g),c=new d.Ray(g,e.normal),g=e.rayIntersection(c),null===g&&(g=e.rayIntersection(c.negate())));null===g&&(console.assert(!1),g=b.copy());c=d.Point3.subtract(g,
b).normalize().scale(this._radius);e=d.Point3.add(b,c);b=d.Point3.subtract(b,c);this._positions[0]=e;this._positions[1]=b;this._positions[2]=e.copy();this._positions[3]=b.copy();this._positions[4]=g.copy();this._positions[5]=this._surfaceCenter.copy();this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=new d.Point3((this._positions[4].x+this._positions[5].x)/2,(this._positions[4].y+this._positions[5].y)/2,(this._positions[4].z+
this._positions[5].z)/2),a=d.Point3.subtract(this._positions[5],this._positions[4]);this._arrowsInvert=2*d.Point3.subtract(this._positions[2],b).length()>a.length()};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view;if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=0,e=this._linePositions;c<e.length;c++){var g=d.Point2.fromPoint3(b.projectPoint(e[c]));this._lineEdgeShape.pushPoint(g)}}if(1<this._stage){c=Array(6);for(e=0;e<this._positions.length;e++)c[e]=
d.Point2.fromPoint3(b.projectPoint(this._positions[e]));this._textShape&&this._textShape.setPosition(c[4]);this._lineShapes[0].set(c[5],c[2]);this._lineShapes[1].set(c[5],c[4]);this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.None);this._lineShapes[0].setEndcapsInverted(this._arrowsInvert)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()){this.update();var b=this._viewer.markupManager.getRenderer();
switch(this._stage){case 1:b.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var a=0;2>a;a++)b.drawLine(this._lineShapes[a]);b.drawTextBox(this._textShape);b.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){var b=g.MeasureMarkup._serializePointArray(this._linePositions),a=g.MeasureMarkup._serializePointArray(this._positions);return{matrix:this._matrix.toJson(),lineOrigin:this._lineProperties.origin,lineRadius:this._lineProperties.radius,
lineNormal:this._lineProperties.normal,linePositions:b,positions:a,text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){var f=d.Matrix.fromJson(b.matrix),e=b.lineRadius,h=d.Point3.fromJson(b.lineOrigin),m=d.Point3.fromJson(b.lineNormal);e=new d.SubentityProperties.CircleElement(e,h,m);a=new c(a,e,f,b.unitMultiplier||1);f=g.MeasureMarkup._constructPointArray(b.linePositions);
e=g.MeasureMarkup._constructPointArray(b.positions);a.setLineGeometry(f);a._positions=e;a._textShape.setTextString(b.text);a._stage=3;a._measurementValue=b.measurementValue;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureCircleEdgeLengthMarkup"};return c}(g.MeasureLengthMarkup);g.MeasureCircleEdgeLengthMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._faceSelection=[];b._arcArray=[];b._lineGeometryShape=new h.Shape.Polyline;b.planeIntersectionLine=[];b._pointOnLine=d.Point3.zero();b._clickpointOriginal2=d.Point3.zero();b._clickpointOriginal1=d.Point3.zero();b._plane1=new d.Plane;b._plane2=new d.Plane;b._secondPoint=d.Point3.zero();b._firstPoint=d.Point3.zero();b._textPos=d.Point3.zero();b._intermediatePoint=d.Point3.zero();b._textAnchorPoint=d.Point3.zero();
b._angle=0;b._useAuthoredNormals=!0;b._name="MeasureFaceFaceAngle";var c=b._viewer.measureManager.getMeasurementColor();b._lineGeometryShape.setStrokeWidth(2);b._lineGeometryShape.setStrokeColor(c);b._lineGeometryShape.setEndEndcapColor(c);b._lineGeometryShape.setStartEndcapColor(c);b._textShape=new h.Shape.TextBox;b._textShape.getBoxPortion().setFillOpacity(1);b._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(var e=0;5>e;e++)b._lineShapes.push(new h.Shape.Line),b._lineShapes[e].setStrokeColor(c),
b._lineShapes[e].setEndEndcapColor(c),b._lineShapes[e].setStartEndcapColor(c);return b}__extends(c,a);c.prototype._getNormalAndPositionFromSelection=function(b,a,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h;return __generator(this,function(l){switch(l.label){case 0:return f=b.getNodeId(),e=b.getFaceEntity().getCadFaceIndex(),c.assign(b.getPosition().copy()),a.assign(b.getFaceEntity().getNormal()),[4,this._viewer.model.getFaceProperty(f,e)];case 1:return g=l.sent(),this._useAuthoredNormals&&
null!==g&&g instanceof d.SubentityProperties.PlaneElement&&(k=this._viewer.model.getNodeNetMatrix(f),h=k.normalMatrix(),null!==h&&h.transform(g.normal,a)),[2]}})})};c.prototype.getFirstSelection=function(){return this._faceSelection[0]};c.prototype.setFirstFace=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g;return __generator(this,function(f){switch(f.label){case 0:return a=b.getNodeId(),c=b.getFaceEntity().getCadFaceIndex(),this._viewer.model.setNodeFaceColor(a,c,new d.Color(255,
0,0)),this._faceSelection.push(b),e=d.Point3.zero(),g=d.Point3.zero(),[4,this._getNormalAndPositionFromSelection(b,e,g)];case 1:return f.sent(),this._firstPoint=g.copy(),this._plane1.setFromPointAndNormal(this._firstPoint,e),this._clickpointOriginal1=b.getPosition().copy(),this._stage++,[2]}})})};c.prototype.setSecondFace=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g,h,p,q,r,t,u,w,v,y,x,z,A,C;return __generator(this,function(f){switch(f.label){case 0:return a=b.getNodeId(),
c=b.getFaceEntity().getCadFaceIndex(),this._faceSelection[1]=b,this._viewer.model.setNodeFaceColor(a,c,new d.Color(255,0,0)),e=d.Point3.zero(),g=d.Point3.zero(),[4,this._getNormalAndPositionFromSelection(b,g,e)];case 1:f.sent();this._secondPoint=e.copy();this._plane2.setFromPointAndNormal(this._secondPoint,g);this.planeIntersectionLine[0]=new d.Point3(0,0,0);this.planeIntersectionLine[1]=new d.Point3(0,0,0);h=d.Util.intersect3d2Planes(this._plane1,this._firstPoint,this._plane2,this._secondPoint,this.planeIntersectionLine[0],
this.planeIntersectionLine[1]);if(2!==h)return[2,!1];p=d.Point3.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]);p.normalize();this.planeIntersectionLine[0].set(this.planeIntersectionLine[0].x-100*p.x,this.planeIntersectionLine[0].y-100*p.y,this.planeIntersectionLine[0].z-100*p.z);this.planeIntersectionLine[1].set(this.planeIntersectionLine[1].x+100*p.x,this.planeIntersectionLine[1].y+100*p.y,this.planeIntersectionLine[1].z+100*p.z);d.Util.computePointToLineDistance(this._secondPoint,
this.planeIntersectionLine[0],this.planeIntersectionLine[1],this._pointOnLine);q=new d.Point3(0,0,0);r=new d.Point3(0,0,0);q.set(this._firstPoint.x+p.x,this._firstPoint.y+p.y,this._firstPoint.z+p.z);d.Util.computePointToLineDistance(this._pointOnLine,this._firstPoint,q,r);this._firstPoint=r.copy();this._clickpointOriginal2=b.getPosition().copy();t=new d.Matrix;u=d.Point3.subtract(this._secondPoint,this._pointOnLine);w=u.length();v=d.Point3.subtract(this._firstPoint,this._pointOnLine);v.normalize();
this._intermediatePoint.set(this._pointOnLine.x+v.x*w,this._pointOnLine.y+v.y*w,this._pointOnLine.z+v.z*w);this._angle=d.Util.computeAngleBetweenVector(u,v);if(0===this._angle)return[2,!1];this._measurementValue=this._angle;this._textShape.setTextString(this._measurementValue.toFixed(2)+"\u00b0");this._viewer.trigger("measurementValueSet",this);this._textPos=this._pointOnLine.copy();y=!1;x=new d.Point3(0,0,0);z=new d.Point3(0,0,0);d.Util.computeOffaxisRotation(p,1,t);t.transform(u,z);x.set(z.x+this._pointOnLine.x,
z.y+this._pointOnLine.y,z.z+this._pointOnLine.z);x=d.Point3.subtract(x,this._firstPoint);A=x.length();d.Util.computeOffaxisRotation(p,-1,t);t.transform(u,z);x.set(z.x+this._pointOnLine.x,z.y+this._pointOnLine.y,z.z+this._pointOnLine.z);d.Point3.subtract(x,this._firstPoint);C=x.length();C<A&&(y=!0);this._arcArray=d.Util.generateArcPoints(p,y?-this._angle:this._angle,this._pointOnLine,u,30);this._stage++;return[2,!0]}})})};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);if(!(1>=this._stage)&&
(b=this._viewer.view.raycastFromPoint(b),null!==b)){var c=new d.Point3(b.origin.x+1E6*b.direction.x,b.origin.y+1E6*b.direction.y,b.origin.z+1E6*b.direction.z),e=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(b.origin,c,this._pointOnLine,this._firstPoint,this._secondPoint,e);this._textPos=e.copy();new d.Point3(0,0,0);b=d.Point3.subtract(e,this._pointOnLine);c=b.length();b=d.Point3.subtract(this._secondPoint,this._pointOnLine);b.normalize();this._secondPoint.set(this._pointOnLine.x+b.x*c,this._pointOnLine.y+
b.y*c,this._pointOnLine.z+b.z*c);b=d.Point3.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]);b.normalize();c=new d.Matrix;e=d.Point3.subtract(this._secondPoint,this._pointOnLine);var g=e.length(),h=d.Point3.subtract(this._firstPoint,this._pointOnLine);h.normalize();this._intermediatePoint.set(this._pointOnLine.x+h.x*g,this._pointOnLine.y+h.y*g,this._pointOnLine.z+h.z*g);g=!1;h=new d.Point3(0,0,0);var m=new d.Point3(0,0,0);d.Util.computeOffaxisRotation(b,1,c);c.transform(e,m);
h.set(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z);h=d.Point3.subtract(h,this._firstPoint);var p=h.length();d.Util.computeOffaxisRotation(b,-1,c);c.transform(e,m);h.set(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z);h=d.Point3.subtract(h,this._firstPoint);h.length()<p&&(g=!0);this._arcArray=d.Util.generateArcPoints(b,g?-this._angle:this._angle,this._pointOnLine,e,30);b=this._viewer.view.projectPoint(this._textPos);c=0;for(e=this._arcArray;c<e.length;c++)if(g=
this._viewer.view.projectPoint(e[c]),g=(new d.Point3(b.x-g.x,b.y-g.y,b.z-g.z)).length(),void 0===q||q>g)var q=g;void 0===q||20>=q?this._textAnchorPoint=this._textPos:(c=this._viewer.view.projectPoint(this._intermediatePoint),q=this._viewer.view.projectPoint(this._secondPoint),c=new d.Point3(c.x-b.x,c.y-b.y,c.z-b.z),q=new d.Point3(q.x-b.x,q.y-b.y,q.z-b.z),b=c.length(),q=q.length(),this._textAnchorPoint=b<q?this._intermediatePoint:this._secondPoint)}};c.prototype._nextStage=function(){this._stage++;
2<this._stage&&(this._finalized=!0,this.cleanup())};c.prototype.cleanup=function(){var b=this,a=function(a){a=b._faceSelection[a];b._viewer.model.unsetNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex())};2<=this._stage&&a(1);1<=this._stage&&a(0)};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view;if(1<this._stage){this._lineGeometryShape.clearPoints();for(var c=0,e=this._arcArray;c<e.length;c++)this._lineGeometryShape.pushPoint(d.Point2.fromPoint3(b.projectPoint(e[c])));
this._lineGeometryShape.setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineGeometryShape.setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineGeometryShape.setEndEndcapSize(5);this._lineGeometryShape.setStartEndcapSize(5);c=Array(10);c[0]=b.projectPoint(this._textPos);c[1]=b.projectPoint(this._firstPoint);c[2]=b.projectPoint(this._clickpointOriginal1);c[3]=b.projectPoint(this._secondPoint);c[4]=b.projectPoint(this._clickpointOriginal2);c[5]=b.projectPoint(this._intermediatePoint);c[6]=b.projectPoint(this._textAnchorPoint);
this._behindView=!1;b=Array(10);for(e=0;6>=e;e++)0>=c[e].z&&(this._behindView=!0),b[e]=d.Point2.fromPoint3(c[e]);this._textShape&&this._textShape.setPosition(b[0]);this._lineShapes[0].set(b[1],b[2]);this._lineShapes[1].set(b[1],b[5]);this._lineShapes[2].set(b[3],b[4]);this._lineShapes[3].set(b[6],b[0])}};c.prototype.draw=function(){var b=0!==this._viewer.explodeManager.getMagnitude();if(this._visibility&&!b&&(this.update(),!this._behindView&&2<=this._stage&&4>=this._stage)){b=this._viewer.markupManager.getRenderer();
for(var a=0;4>a;a++)b.drawLine(this._lineShapes[a]);b.drawTextBox(this._textShape);b.drawPolyline(this._lineGeometryShape)}};c.prototype.setUseAuthoredNormals=function(b){this._useAuthoredNormals=b};c.prototype.getUseAuthoredNormals=function(){return this._useAuthoredNormals};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._arcArray;a<c.length;a++){var d=c[a].toJson();b.push(d)}return{text:this._textShape.getTextString(),textPos:this._textPos.toJson(),
arcArray:b,firstPoint:this._firstPoint.toJson(),clickpointOriginal1:this._clickpointOriginal1.toJson(),secondPoint:this._secondPoint.toJson(),clickpointOriginal2:this._clickpointOriginal2.toJson(),intermediatePoint:this._intermediatePoint.toJson(),textAnchorPoint:this._textAnchorPoint.toJson(),measurementValue:this._measurementValue,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);for(var f=0,e=b.arcArray;f<e.length;f++){var g=
d.Point3.fromJson(e[f]);a._arcArray.push(g)}a._textShape.setTextString(b.text);a._textPos.assign(d.Point3.fromJson(b.textPos));a._firstPoint.assign(d.Point3.fromJson(b.firstPoint));a._clickpointOriginal1=d.Point3.fromJson(b.clickpointOriginal1);a._secondPoint.assign(d.Point3.fromJson(b.secondPoint));a._clickpointOriginal2=d.Point3.fromJson(b.clickpointOriginal2);a._intermediatePoint.assign(d.Point3.fromJson(b.intermediatePoint));a._textAnchorPoint.assign(d.Point3.fromJson(b.textAnchorPoint));a._measurementValue=
b.measurementValue;a._stage=3;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceAngleMarkup"};return c}(g.MeasureMarkup);g.MeasureFaceFaceAngleMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._faceSelection=[];b._line1PreviewShape1=new h.Shape.Line;b._line1PreviewShape2=new h.Shape.Line;b._line2PreviewShape1=new h.Shape.Line;b._line2PreviewShape2=new h.Shape.Line;b._matrix1=new d.Matrix;b._matrix2=new d.Matrix;b._lineGeometryShape=new h.Shape.Polyline;b._parallelFaces=!1;b._triangulatedDistance=!0;b._pointsOnSameRay=!1;b._arrowsInvert=!1;b._faceData=[];b._distance=0;b._surfaceCenter=[d.Point3.zero(),
d.Point3.zero()];b._surfaceAxis1=[d.Point3.zero(),d.Point3.zero()];b._surfaceAxis2=[d.Point3.zero(),d.Point3.zero()];b._cylinderAxisInfinite1=[d.Point3.zero(),d.Point3.zero()];b._cylinderAxisInfinite2=[d.Point3.zero(),d.Point3.zero()];b._secondPointInitial=d.Point3.zero();b._firstPointHelper=d.Point3.zero();b._secondPointHelper=d.Point3.zero();b._secondPoint=d.Point3.zero();b._firstPoint=d.Point3.zero();b._textPos=d.Point3.zero();b._name="MeasureFaceFaceDistance";b._lineGeometryShape.setStrokeWidth(2);
b._lineGeometryShape.setStrokeColor(b._viewer.measureManager.getMeasurementColor());b._textShape=new h.Shape.TextBox;b._textShape.getBoxPortion().setFillOpacity(1);b._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(var c=b._viewer.measureManager.getMeasurementColor(),e=0;5>e;e++)b._lineShapes.push(new h.Shape.Line),b._lineShapes[e].setStrokeColor(c),b._lineShapes[e].setEndEndcapColor(c),b._lineShapes[e].setStartEndcapColor(c);return b}__extends(c,a);c.prototype.setUnitMultiplier=
function(b){this._unitMultiplier=b};c.prototype.setFirstFace=function(b,a,c,e){var f=b.getNodeId(),g=b.getFaceEntity(),k=b.getPosition();this._matrix1=c.copy();this._viewer.model.setNodeFaceColor(f,g.getCadFaceIndex(),new d.Color(255,0,0));this._faceSelection[0]=b;this._firstPoint=k.copy();this._faceData[0]=a;this._faceData[0]instanceof d.SubentityProperties.PlaneElement?(b=this._faceData[0],a=new d.Point3(b.origin.x+b.normal.x,b.origin.y+b.normal.y,b.origin.z+b.normal.z),this._matrix1.transform(a,
this._surfaceAxis1[0]),this._matrix1.transform(b.origin,this._surfaceCenter[0])):this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&this.createCylinderData(this._faceData[0],c,e);this._stage++};c.prototype.getFirstSelection=function(){return this._faceSelection[0]||null};c.prototype.getFirstFaceData=function(){return this._faceData[0]||null};c.prototype.cleanup=function(){var b=this._viewer.model;2<=this._stage&&b.unsetNodeFaceColor(this._faceSelection[1].getNodeId(),this._faceSelection[1].getFaceEntity().getCadFaceIndex());
1<=this._stage&&b.unsetNodeFaceColor(this._faceSelection[0].getNodeId(),this._faceSelection[0].getFaceEntity().getCadFaceIndex())};c.prototype.createCylinderData=function(b,a,c){c=d.Point3.subtract(c.max,c.min).length()/4;var f=new d.Point3(b.origin.x+1E4*b.normal.x,b.origin.y+1E4*b.normal.y,b.origin.z+1E4*b.normal.z),e=new d.Point3(b.origin.x-1E4*b.normal.x,b.origin.y-1E4*b.normal.y,b.origin.z-1E4*b.normal.z),g=new d.Point3(0,0,0);d.Util.computePointToLineDistance(b.origin,f,e,g);this._surfaceCenter[this._stage]=
new d.Point3(0,0,0);a.transform(g,this._surfaceCenter[this._stage]);f=new d.Point3(g.x+b.normal.x,g.y+b.normal.y,g.z+b.normal.z);this._surfaceAxis1[this._stage]=new d.Point3(0,0,0);a.transform(f,this._surfaceAxis1[this._stage]);f.set(g.x-b.normal.x,g.y-b.normal.y,g.z-b.normal.z);this._surfaceAxis2[this._stage]=new d.Point3(0,0,0);a.transform(f,this._surfaceAxis2[this._stage]);new d.Point3(0,0,0);b=this._surfaceAxis1[this._stage].copy();b=d.Point3.subtract(b,this._surfaceCenter[this._stage]);b.normalize();
this._surfaceAxis1[this._stage].set(this._surfaceCenter[this._stage].x+b.x*c,this._surfaceCenter[this._stage].y+b.y*c,this._surfaceCenter[this._stage].z+b.z*c);this._surfaceAxis2[this._stage].set(this._surfaceCenter[this._stage].x-b.x*c,this._surfaceCenter[this._stage].y-b.y*c,this._surfaceCenter[this._stage].z-b.z*c);this._cylinderAxisInfinite1[this._stage]=new d.Point3(this._surfaceCenter[this._stage].x+b.x*c*1E3,this._surfaceCenter[this._stage].y+b.y*c*1E3,this._surfaceCenter[this._stage].z+b.z*
c*1E3);this._cylinderAxisInfinite2[this._stage]=new d.Point3(this._surfaceCenter[this._stage].x-b.x*c*1E3,this._surfaceCenter[this._stage].y-b.y*c*1E3,this._surfaceCenter[this._stage].z-b.z*c*1E3)};c.prototype.setSecondFace=function(b,a,c,e,g){return __awaiter(this,void 0,void 0,function(){var f,k,h,l,n,u,w,v,y,x,z,A,C,B,D,F,E,G,H,I,K,J;return __generator(this,function(m){switch(m.label){case 0:f=this._faceSelection[0];k=this._faceData[0];if(void 0===f||void 0===k)throw new d.CommunicatorError("setSecondFace() called before setFirstFace()");
if(c instanceof d.SubentityProperties.PlaneElement)h=k,l=new d.Point3(h.origin.x+h.normal.x,h.origin.y+h.normal.y,h.origin.z+h.normal.z),this._matrix1.transform(l,this._surfaceAxis1[0]),this._matrix1.transform(h.origin,this._surfaceCenter[0]);else if(c instanceof d.SubentityProperties.CylinderElement)this.createCylinderData(c,e,g);else return[2];return[4,this._viewer.model.computeMinimumFaceFaceDistance(f.getNodeId(),f.getFaceEntity().getCadFaceIndex(),a.getNodeId(),a.getFaceEntity().getCadFaceIndex())];
case 1:n=m.sent();if(0===n.distance)return[2];this._matrix2=e.copy();this._secondPoint=a.getPosition().copy();this._secondPointInitial=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z);if(!(k instanceof d.SubentityProperties.PlaneElement&&c instanceof d.SubentityProperties.PlaneElement))return[3,2];u=c;l=new d.Point3(u.origin.x+u.normal.x,u.origin.y+u.normal.y,u.origin.z+u.normal.z);this._matrix2.transform(l,this._surfaceAxis1[1]);this._matrix2.transform(u.origin,this._surfaceCenter[1]);
w=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);v=new d.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);w.normalize();v.normalize();y=new d.Point3(-w.x,-w.y,-w.z);w.equalsWithTolerance(v,1E-5)||y.equalsWithTolerance(v,1E-5)?(this._secondPointHelper=new d.Point3(this._secondPoint.x,
this._secondPoint.y,this._secondPoint.z),this._firstPointHelper=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z),x=new d.Plane,x.setFromPointAndNormal(this._surfaceCenter[0],w),z=new d.Plane,z.setFromPointAndNormal(this._surfaceCenter[1],v),A=new d.Point3(this._firstPoint.x+w.x,this._firstPoint.y+w.y,this._firstPoint.z+w.z),d.Util.intersectionPlaneLine2(f.getPosition(),A,z,this._secondPoint),y.equalsWithTolerance(v,1E-5)&&(C=new d.Point3(-w.x,-w.y,-w.z),x.setFromPointAndNormal(this._surfaceCenter[0],
C)),this._distance=B=Math.abs(z.d-x.d)/x.normal.length(),this._setMeasurementValue(this._distance),this._parallelFaces=!0,this._triangulatedDistance=!1,D=new d.Point3(0,1,0),F=d.Point3.subtract(this._secondPoint,this._firstPoint),E=new d.Point3(0,0,0),E=d.Point3.subtract(this._secondPointHelper,this._firstPoint),G=d.Util.computeAngleBetweenVector(D,F),H=d.Util.computeAngleBetweenVector(D,E),this._textPos.assign(this._secondPoint),.1>G-H&&-.1<G-H&&(this._pointsOnSameRay=!0)):(this._firstPoint.assign(n.pos1),
this._secondPoint.assign(n.pos2),this._textPos.assign(n.pos2),this._distance=n.distance,this._setMeasurementValue(this._distance));return[3,8];case 2:if(!(k instanceof d.SubentityProperties.CylinderElement&&c instanceof d.SubentityProperties.CylinderElement))return[3,3];w=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);v=new d.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-
this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);w.normalize();v.normalize();y=new d.Point3(-w.x,-w.y,-w.z);if(w.equalsWithTolerance(v,1E-5)||y.equalsWithTolerance(v,1E-5)){I=new d.Point3(0,0,0);d.Util.computePointToLineDistance(this._firstPoint,this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],I);this._firstPoint=I.copy();K=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z);K=d.Point3.subtract(K,this._surfaceCenter[0]);K.set(0,0,0);d.Util.computePointToLineDistance(this._firstPoint,
this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],I);this._secondPoint=I.copy();B=d.Point3.subtract(this._secondPoint,this._firstPoint).length();if(1E-7>B)return[2];this._triangulatedDistance=!1;this._textPos.assign(this._secondPoint);this._setMeasurementValue(B)}else{this._distance=d.Util.distanceLineLine(this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],this._firstPoint,this._secondPoint);if(1E-7>this._distance)return[2];
this._textPos.assign(this._firstPoint);this._setMeasurementValue(this._distance)}return[3,8];case 3:if(!(k instanceof d.SubentityProperties.CylinderElement&&c instanceof d.SubentityProperties.PlaneElement))return[3,5];w=(new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z)).normalize();return[4,this._viewer.model.computeMinimumFaceLineDistance(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),
new d.Ray(this._surfaceCenter[0],w))];case 4:J=m.sent();this._distance=J.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(J.pos1);this._secondPoint.assign(J.pos2);this._textPos.assign(J.pos2);this._secondPointHelper=new d.Point3(this._secondPoint.x,this._secondPoint.y,this._secondPoint.z);this._firstPointHelper=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z);this._viewer.model.setNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Color(255,
0,0));this._faceData[1]=c;this._faceSelection[1]=a;this._stage++;this.adjust(b);this._setMeasurementValue(this._distance);return[3,8];case 5:if(!(k instanceof d.SubentityProperties.PlaneElement&&c instanceof d.SubentityProperties.CylinderElement))return[3,7];w=(new d.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z)).normalize();return[4,this._viewer.model.computeMinimumFaceLineDistance(f.getNodeId(),
f.getFaceEntity().getCadFaceIndex(),new d.Ray(this._surfaceCenter[1],w))];case 6:J=m.sent();this._distance=J.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(J.pos1);this._secondPoint.assign(J.pos2);this._textPos.assign(J.pos2);this._secondPointHelper=new d.Point3(this._secondPoint.x,this._secondPoint.y,this._secondPoint.z);this._firstPointHelper=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z);this._viewer.model.setNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),
new d.Color(255,0,0));this._faceData[1]=c;this._faceSelection[1]=a;this._stage++;this.adjust(b);this._setMeasurementValue(this._distance);return[3,8];case 7:this._firstPoint.assign(n.pos1);this._secondPoint.assign(n.pos2);this._textPos.assign(n.pos2);this._distance=n.distance;if(1E-7>this._distance)return[2];this._setMeasurementValue(this._distance);m.label=8;case 8:return this._viewer.model.setNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0)),this._faceData[1]=
c,this._faceSelection[1]=a,this._stage++,this.adjust(b),[2]}})})};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);if(!(1>=this._stage)){var c=this._viewer.view.raycastFromPoint(b);if(null!==c){var e=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z),g=d.Util.oneVectorCross(c.direction);new d.Point3(0,0,0);var h=d.Point3.cross(c.direction,g);h.normalize();new d.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/
2,(this._firstPoint.z+this._secondPoint.z)/2);var m=this._textPos.copy();g.set(m.x+g.x,m.y+g.y,m.z+g.z);h.set(m.x+h.x,m.y+h.y,m.z+h.z);b=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(c.origin,e,m,g,h,b);2===this._stage?d.Util.computePointToLineDistance(b,this._firstPoint,this._secondPoint,this._textPos):this._parallelFaces||this._triangulatedDistance?(c=new d.Point3(0,0,0),e=this._faceData[0]instanceof d.SubentityProperties.CylinderElement||this._faceData[1]instanceof d.SubentityProperties.CylinderElement,
g=this._faceData[0]instanceof d.SubentityProperties.PlaneElement||this._faceData[1]instanceof d.SubentityProperties.PlaneElement,this._pointsOnSameRay||(e&&g?d.Util.computePointToLineDistance(b,this._secondPoint,this._secondPointInitial,c):d.Util.computePointToLineDistance(b,this._secondPoint,this._secondPointHelper,c),new d.Point3(0,0,0),b=d.Point3.subtract(c,this._secondPoint),this._secondPoint=c.copy(),this._firstPoint.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z),this._textPos.set(this._textPos.x+
b.x,this._textPos.y+b.y,this._textPos.z+b.z))):(c=new d.Point3(0,0,0),d.Util.computePointToLineDistance(b,this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],c),b=d.Point3.subtract(c,this._secondPoint),this._secondPoint=c.copy(),this._firstPoint.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z),this._textPos.set(this._textPos.x+b.x,this._textPos.y+b.y,this._textPos.z+b.z));this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}}};c.prototype._updateArrowsInverted=
function(){var b=new d.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/2,(this._firstPoint.z+this._secondPoint.z)/2),a=d.Point3.subtract(this._secondPoint,this._firstPoint);2*d.Point3.subtract(this._textPos,b).length()>a.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype._nextStage=function(){this._stage++;if(3<this._stage||2<this._stage&&this._triangulatedDistance)this._finalized=!0,this.cleanup()};c.prototype.update=function(){a.prototype.update.call(this);
var b=this._viewer.view;this._behindView=!1;if(0!==this._stage){for(var c=Array(10),e=[],g=0;10>g;g++)e.push(new d.Point3(0,0,0));this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&(e[0]=b.projectPoint(this._surfaceCenter[0]),e[1]=b.projectPoint(this._surfaceAxis1[0]),e[2]=b.projectPoint(this._surfaceAxis2[0]),c[0]=d.Point2.fromPoint3(e[0]),c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._line1PreviewShape1.set(c[0],c[1]),this._line1PreviewShape2.set(c[0],c[2]));
1<this._stage&&this._faceData[1]instanceof d.SubentityProperties.CylinderElement&&(e[0]=b.projectPoint(this._surfaceCenter[1]),e[1]=b.projectPoint(this._surfaceAxis1[1]),e[2]=b.projectPoint(this._surfaceAxis2[1]),c[0]=d.Point2.fromPoint3(e[0]),c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._line2PreviewShape1.set(c[0],c[1]),this._line2PreviewShape2.set(c[0],c[2]));1<this._stage&&(e[0]=b.projectPoint(this._textPos),e[1]=b.projectPoint(this._firstPoint),e[2]=b.projectPoint(this._secondPoint),
c[0]=d.Point2.fromPoint3(e[0]),c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._textShape&&this._textShape.setPosition(c[0]),this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setEndcapsInverted(this._arrowsInvert),this._lineShapes[0].set(c[1],c[2]),e[3]=b.projectPoint(this._firstPointHelper),e[4]=b.projectPoint(this._secondPointHelper),c[3]=d.Point2.fromPoint3(e[3]),c[4]=d.Point2.fromPoint3(e[4]),
this._lineShapes[1].set(c[2],c[4]),this._lineShapes[2].set(c[1],c[3]),this._lineShapes[3].set(c[1],c[0]));for(g=0;6>g;g++)0>e[g].z&&(this._behindView=!0)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var b=this._faceData[0]instanceof d.SubentityProperties.CylinderElement||this._faceData[1]instanceof d.SubentityProperties.CylinderElement,a=this._faceData[0]instanceof d.SubentityProperties.PlaneElement||this._faceData[1]instanceof
d.SubentityProperties.PlaneElement,c=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&(c.drawLine(this._line1PreviewShape1),c.drawLine(this._line1PreviewShape2));break;case 2:case 3:case 4:this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&(c.drawLine(this._line1PreviewShape1),c.drawLine(this._line1PreviewShape2)),this._faceData[1]instanceof d.SubentityProperties.CylinderElement&&(c.drawLine(this._line2PreviewShape1),
c.drawLine(this._line2PreviewShape2)),b&&a?(c.drawLine(this._lineShapes[0]),c.drawLine(this._lineShapes[1]),c.drawLine(this._lineShapes[2])):(c.drawLine(this._lineShapes[0]),this._parallelFaces&&(c.drawLine(this._lineShapes[1]),c.drawLine(this._lineShapes[2]))),c.drawLine(this._lineShapes[3]),c.drawTextBox(this._textShape)}}};c._serializeFaceProp=function(b){return b instanceof d.SubentityProperties.CylinderElement?{type:"CylinderElement",origin:b.origin.toJson(),normal:b.normal.toJson(),radius:b.radius}:
b instanceof d.SubentityProperties.PlaneElement?{type:"PlaneElement",origin:b.origin.toJson(),normal:b.normal.toJson()}:null};c._constructFaceProp=function(b){if("CylinderElement"===b.type){var a=d.Point3.fromJson(b.origin),c=d.Point3.fromJson(b.normal);return new d.SubentityProperties.CylinderElement(b.radius,a,c)}return"PlaneElement"===b.type?(a=d.Point3.fromJson(b.origin),c=d.Point3.fromJson(b.normal),new d.SubentityProperties.PlaneElement(a,c)):null};c.prototype.toJson=function(){return this._toJson()};
c.prototype._toJson=function(){for(var b=[],a=0,d=this._faceData;a<d.length;a++)b.push(c._serializeFaceProp(d[a]));a=[];d=0;for(var e=this._surfaceCenter;d<e.length;d++)a.push(e[d].toJson());d=[];for(var g=0,h=this._surfaceAxis1;g<h.length;g++)e=h[g],d.push(e.toJson());g=[];h=0;for(var p=this._surfaceAxis2;h<p.length;h++)e=p[h],g.push(e.toJson());return{text:this._textShape.getTextString(),textPos:this._textPos.toJson(),firstPoint:this._firstPoint.toJson(),secondPoint:this._secondPoint.toJson(),firstPointHelper:this._firstPointHelper.toJson(),
secondPointHelper:this._secondPointHelper.toJson(),secondPointInitial:this._secondPointInitial.toJson(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,parallelFaces:this._parallelFaces,faceData:b,surfaceCenter:a,surfaceAxis1:d,surfaceAxis2:g,name:this.getName(),className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a.setName(b.name);a._textShape.setTextString(b.text);a._textPos.assign(d.Point3.fromJson(b.textPos));
a._firstPoint.assign(d.Point3.fromJson(b.firstPoint));a._firstPointHelper.assign(d.Point3.fromJson(b.firstPointHelper));a._secondPoint.assign(d.Point3.fromJson(b.secondPoint));a._secondPointHelper.assign(d.Point3.fromJson(b.secondPointHelper));void 0!==b.secondPointInitial&&a._secondPointInitial.assign(d.Point3.fromJson(b.secondPointInitial));console.assert(Array.isArray(b.faceData));for(var f=0,e=b.faceData;f<e.length;f++){var g=c._constructFaceProp(e[f]);console.assert(null!==g);a._faceData.push(g)}a._surfaceCenter[0].assign(b.surfaceCenter[0]);
a._surfaceCenter[1].assign(b.surfaceCenter[1]);a._surfaceAxis1[0].assign(b.surfaceAxis1[0]);a._surfaceAxis1[1].assign(b.surfaceAxis1[1]);a._surfaceAxis2[0].assign(b.surfaceAxis2[0]);a._surfaceAxis2[1].assign(b.surfaceAxis2[1]);a._stage=4;a._parallelFaces=b.parallelFaces;a._measurementValue=b.measurementValue;a._unitMultiplier=b.unitMultiplier||1;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceDistanceMarkup"};
return c}(g.MeasureMarkup);g.MeasureFaceFaceDistanceMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._anchorLinePoint=null;c._firstLinePoint=null;c._secondLinePoint=null;c._selectionPosition=null;c._lineGeometryShape=new h.Shape.Polyline;c._viewer=b;c._name="MeasureLineLineAngle";c._lineGeometryShape.setStrokeWidth(2);c._lineGeometryShape.setStrokeColor(c._viewer.measureManager.getMeasurementColor());c._lineGeometryShape.setEndcapType(h.Shape.EndcapType.Arrowhead);c._lineGeometryShape.setStartEndcapType(h.Shape.EndcapType.Arrowhead);
c._lineGeometryShape.setEndEndcapSize(5);c._lineGeometryShape.setStartEndcapSize(5);c._lineGeometryShape.setEndEndcapColor(c._viewer.measureManager.getMeasurementColor());c._lineGeometryShape.setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(d.Color.white());return c}__extends(c,a);c.prototype.addPoint=function(b){if(this._finalized)return!1;if(null===this._anchorLinePoint)this._anchorLinePoint=
b.copy(),this._stage=1;else if(null===this._firstLinePoint){if(b.equals(this._anchorLinePoint))return!1;this._firstLinePoint=b.copy();this._stage=2}else{if(b.equals(this._anchorLinePoint)||b.equals(this._firstLinePoint))return!1;var a=d.Point3.subtract(this._firstLinePoint,this._anchorLinePoint),c=d.Point3.subtract(b,this._anchorLinePoint);a=d.Util.computeAngleBetweenVector(a,c);if(0===a||180===a)return!1;this._secondLinePoint=b.copy();this.setMeasurementText(a.toFixed(2)+"\u00b0");this._measurementValue=
a;this._finalized=!0;this._stage=3}this.draw();return!0};c.prototype.setSelectionPosition=function(b){this._selectionPosition=b};c.prototype.getLineGeometryShape=function(){return this._lineGeometryShape};c.prototype._drawPreviewLine=function(b,a){var c=this._viewer.markupManager.getRenderer(),f=this._viewer.view;b=d.Point2.fromPoint3(f.projectPoint(b));a=d.Point2.fromPoint3(f.projectPoint(a));a=new h.Shape.Line(b,a);c.drawLine(a)};c.prototype._drawAngleMarkup=function(b,a,c){var f=this._viewer.markupManager.getRenderer(),
e=this._viewer.view,g=d.Point3.subtract(a,b),k=d.Point3.subtract(c,b),q=d.Point3.cross(g,k).normalize();a=d.Util.computeAngleBetweenVector(g,k);if(0!==a&&180!==a&&!isNaN(a)){q=d.Util.generateArcPoints(q,-a,b,k,30);this._lineGeometryShape.clearPoints();for(var r=0;r<q.length;r++)this._lineGeometryShape.pushPoint(d.Point2.fromPoint3(e.projectPoint(q[r])));f.drawPolyline(this._lineGeometryShape)}k=k.length();g=d.Point3.add(b,g.copy().normalize().scale(k));b=d.Point2.fromPoint3(e.projectPoint(b));g=d.Point2.fromPoint3(e.projectPoint(g));
c=d.Point2.fromPoint3(e.projectPoint(c));e=new h.Shape.Line(b,g);f.drawLine(e);c=new h.Shape.Line(b,c);f.drawLine(c);this._textShape.setPosition(g);this._finalized?this._textShape.setTextString(this.getMeasurementText()):isNaN(a)?this._textShape.setTextString("0\u00b0"):this._textShape.setTextString(a.toFixed(2)+"\u00b0");f.drawTextBox(this._textShape)};c.prototype.draw=function(){this._visibility&&null!==this._anchorLinePoint&&(0>=this._viewer.view.projectPoint(this._anchorLinePoint).z||(1===this._stage?
null!==this._selectionPosition&&this._drawPreviewLine(this._anchorLinePoint,this._selectionPosition):2===this._stage?null!==this._firstLinePoint&&null!==this._selectionPosition&&this._drawAngleMarkup(this._anchorLinePoint,this._firstLinePoint,this._selectionPosition):3===this._stage&&null!=this._firstLinePoint&&null!=this._secondLinePoint&&this._drawAngleMarkup(this._anchorLinePoint,this._firstLinePoint,this._secondLinePoint)))};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=
function(){return{name:this._name,anchorPoint:this._anchorLinePoint.copy(),firstPoint:this._firstLinePoint.copy(),secondPoint:this._secondLinePoint.copy(),measurementValue:this._measurementValue,measurementText:this.getMeasurementText(),className:this.getClassName()}};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._anchorLinePoint=d.Point3.fromJson(b.anchorPoint);a._firstLinePoint=d.Point3.fromJson(b.firstPoint);a._secondLinePoint=d.Point3.fromJson(b.secondPoint);a._measurementValue=b.measurementValue;
a.setMeasurementText(b.measurementText);a._finalized=!0;a._stage=3;return a};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureLineLineAngleMarkup"};return c}(g.MeasureMarkup);g.MeasureLineLineAngleMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._firstPointShape=new h.Shape.Circle;c._secondPointShape=new h.Shape.Circle;c._arrowsInvert=!1;c._name="MeasurePointPointDistance";c._lineShapes=[];for(var e=0;6>e;e++)c._lineShapes.push(new h.Shape.Line),c._lineShapes[e].setStrokeColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setEndEndcapColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());
c._viewer=b;c.initCircle(c._firstPointShape);c.initCircle(c._secondPointShape);c._textShape=new h.Shape.TextBox;c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));return c}__extends(c,a);c.prototype.initCircle=function(b){b.setRadius(2.5);b.setFillColor(this._viewer.measureManager.getMeasurementColor())};c.prototype.setUnitMultiplier=function(b){this._unitMultiplier=b};c.prototype.setFirstPointPosition=function(b){this._stage=1;this._positions[0]=
b.copy()};c.prototype.setSecondPointPosition=function(b){this._stage=2;this._positions[1]=b.copy();this._positions[2]=b.copy();this._setMeasurementValue(d.Point3.subtract(this._positions[1],this._positions[0]).length())};c.prototype._getStage=function(){return this._stage};c.prototype.finalize=function(){this._stage++};c.prototype.getFirstPointPosition=function(){return this._positions[0]};c.prototype.getSecondPointPosition=function(){return this._positions[1]};c.prototype.adjust=function(b){a.prototype.adjust.call(this,
b);var c=this._viewer.view.raycastFromPoint(b);if(null!==c){b=this._positions[0];var e=this._positions[1],g=new d.Point3(1,0,0);e.equals(b)||(g=d.Point3.subtract(e,b));var h=this._viewer.view.getCamera().getUp(),m=d.Point3.cross(c.direction,h).normalize(),p=new d.Point3((b.x+e.x)/2,(b.y+e.y)/2,(b.z+e.z)/2);h=new d.Point3(p.x+h.x,p.y+h.y,p.z+h.z);var q=new d.Point3(p.x+m.x,p.y+m.y,p.z+m.z),r=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z);m=new d.Point3(0,
0,0);d.Util.intersectionPlaneLine(c.origin,r,p,h,q,m);this._positions[2].assign(m);new d.Point3(0,0,0);c=Math.abs(g.x)<=Math.abs(g.y)&&Math.abs(g.x)<=Math.abs(g.z)?new d.Point3(1,0,0):Math.abs(g.y)<=Math.abs(g.x)&&Math.abs(g.y)<=Math.abs(g.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);c=d.Point3.cross(c,g);p=d.Point3.cross(c,g);c.set(b.x+c.x,b.y+c.y,b.z+c.z);p.set(b.x+p.x,b.y+p.y,b.z+p.z);h=new d.Point3(m.x+1E4*g.x,m.y+1E4*g.y,m.z+1E4*g.z);g=new d.Point3(m.x-1E4*g.x,m.y-1E4*g.y,m.z-1E4*g.z);g=d.Util.intersectionPlaneLine(h,
g,b,c,p,m);c=!isNaN(m.x)&&!isNaN(m.y)&&!isNaN(m.z);g&&c||(m=e.copy());m=d.Point3.subtract(m,b);this._positions[3]=new d.Point3(b.x+m.x,b.y+m.y,b.z+m.z);this._positions[4]=new d.Point3(e.x+m.x,e.y+m.y,e.z+m.z);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=new d.Point3((this._positions[3].x+this._positions[4].x)/2,(this._positions[3].y+this._positions[4].y)/2,(this._positions[3].z+this._positions[4].z)/2),a=d.Point3.subtract(this._positions[4],
this._positions[3]);2*d.Point3.subtract(this._positions[2],b).length()>a.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view,c=Array(6);if(0<this._stage){this._behindView=!1;for(var e=0;e<this._positions.length;e++)0>=b.projectPoint(this._positions[e]).z&&(this._behindView=!0),c[e]=d.Point2.fromPoint3(b.projectPoint(this._positions[e]));this._firstPointShape.setCenter(c[0])}1<this._stage&&(this._textShape&&this._textShape.setPosition(c[2]),
this._secondPointShape.setCenter(c[1]),this._lineShapes[0].set(c[0],c[1]),this._lineShapes[1].set(c[3],c[4]),this._lineShapes[2].set(c[0],c[3]),this._lineShapes[3].set(c[1],c[4]),this._lineShapes[4].set(c[3],c[2]),this._lineShapes[5].set(c[3],c[4]),this._lineShapes[5].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setEndcapsInverted(this._arrowsInvert))};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&
(this.update(),!this._behindView)){var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:b.drawCircle(this._firstPointShape);break;case 2:case 3:b.drawCircle(this._firstPointShape);b.drawCircle(this._secondPointShape);for(var a=0,c=this._lineShapes;a<c.length;a++)b.drawLine(c[a]);b.drawTextBox(this._textShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),
leaderPoint1:this._positions[3].copy(),leaderPoint2:this._positions[4].copy(),textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._positions[0]=d.Point3.fromJson(b.measurePoint1);a._positions[1]=d.Point3.fromJson(b.measurePoint2);a._positions[2]=d.Point3.fromJson(b.textPoint);
a._textShape.setTextString(b.text);a._positions[3]=d.Point3.fromJson(b.leaderPoint1);a._positions[4]=d.Point3.fromJson(b.leaderPoint2);a._measurementValue=b.measurementValue;a._unitMultiplier=b.unitMultiplier||1;a._updateArrowsInverted();a._stage=2;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePointPointDistanceMarkup"};c.prototype.isMarkupValid=function(){return 5<=this._positions.length};return c}(g.MeasureMarkup);
g.MeasurePointPointDistanceMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._initialPoint=new h.Shape.Circle;c._leaderLine=new h.Shape.Line;c._endpoints=new h.Shape.CircleCollection;c._textboxCorners=[d.Point2.zero(),d.Point2.zero(),d.Point2.zero(),d.Point2.zero()];c._polygon=new h.Shape.Polygon;c._plane=null;c.textPosition=d.Point3.zero();c.leaderPosition=d.Point3.zero();c.pointRadius=2.5;c._viewer=b;b=c._viewer.measureManager.getMeasurementColor();c._initialPoint.setFillColor(b);
c._initialPoint.setStrokeColor(b);c._leaderLine.setStrokeColor(b);c._endpoints.setFillColor(b);c._endpoints.setStrokeColor(b);c._endpoints.setFillOpacity(1);c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(d.Color.white());c._polygon.setFillColor(b);c._polygon.setFillOpacity(.4);return c}__extends(c,a);c.prototype._calculateArea=function(){var b=this._positions.length;if(3>b)return 0;for(var a=new Float32Array(3*b),c=0;c<b;c++){var e=this._positions[c];a[3*
c]=e.x;a[3*c+1]=e.y;a[3*c+2]=e.z}b=d.Point3.subtract(this._positions[1],this._positions[0]);c=d.Point3.subtract(this._positions[2],this._positions[0]);b=d.Point3.cross(b,c);a=this._viewer.model.triangulatePolygon(a,b);b=0;c=a.length/3/3;for(e=0;e<c;e++){for(var g=9*e,h=[],p=0;3>p;p++)h[p]=new d.Point3(a[g+3*p],a[g+3*p+1],a[g+3*p+2]);g=d.Point3.subtract(h[1],h[0]).length();p=d.Point3.subtract(h[2],h[0]).length();h=d.Point3.subtract(h[2],h[1]).length();b+=.25*Math.sqrt((g+p+h)*(-g+p+h)*(g-p+h)*(g+p-
h))}return b};c.prototype.addPoint=function(b){if(3<=this._positions.length&&(null===this._plane&&(this._plane=d.Plane.createFromPoints(this._positions[0],this._positions[1],this._positions[2])),1E-4<Math.abs(this._plane.distanceToPoint(b))))return!1;2===this._positions.length&&(this._plane=d.Plane.createFromPoints(this._positions[0],this._positions[1],b));this._positions.push(b.copy());b=this._calculateArea();var a=this.getUnitMultiplier();a=d.Util.formatWithUnit(b,a)+"\u00b2";this._setMeasurementValue(b);
this.setMeasurementText(a);return!0};c.prototype.getPoints=function(){return this._positions};c.prototype.getLast=function(){return 0===this._positions.length?null:this._positions[this._positions.length-1].copy()};c.prototype.finalize=function(){if(2<this._positions.length){var b=this._calculateArea(),a=this.getUnitMultiplier();a=d.Util.formatWithUnit(b,a)+"\u00b2";this._setMeasurementValue(b);this.setMeasurementText(a)}this._finalized=!0};c.prototype.setUnitMultiplier=function(b){this._unitMultiplier=
b};c.prototype.isValid=function(){return 2<this._positions.length};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._updateProjectedPoints=function(){var b=[];this._behindView=!1;for(var a=0,c=this._positions;a<c.length;a++){var e=this._viewer.view.projectPoint(c[a]);0>=e.z&&(this._behindView=!0);b.push(d.Point2.fromPoint3(e))}return b};c.prototype._updateTextBoxCorners=function(){var b=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),
a=this._textShape.getPosition();this._textboxCorners[0].assign(a);this._textboxCorners[1].set(a.x+b.x,a.y);this._textboxCorners[2].set(a.x+b.x,a.y+b.y);this._textboxCorners[3].set(a.x,a.y+b.y)};c.prototype._calculateLeaderEndpoint=function(b){this._updateTextBoxCorners();for(var a=d.Point2.zero(),c=Number.MAX_VALUE,e=0,g=this._textboxCorners;e<g.length;e++){var h=g[e],p=d.Point2.distance(b,h);p<c&&(a.assign(h),c=p)}return a};c.prototype.draw=function(){if(this._visibility){var b=this._updateProjectedPoints();
if(!this._behindView&&0!==b.length){var a=this._viewer.markupManager.getRenderer();if(1===b.length)this._initialPoint.set(b[0],this.pointRadius),a.drawCircle(this._initialPoint);else{this._polygon.clearPoints();for(var c=0;c<b.length;c++)this._polygon.pushPoint(b[c]);this._finalized&&this._polygon.pushPoint(b[0]);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.textPosition));this._textShape.setPosition(c);a.drawPolygon(this._polygon);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.leaderPosition));
var e=this._calculateLeaderEndpoint(c);this._leaderLine.setP1(c);this._leaderLine.setP2(e);a.drawLine(this._leaderLine);a.drawTextBox(this._textShape);this._endpoints.clear();this._endpoints.addCircle(b[0],this.pointRadius);this._endpoints.addCircle(b[b.length-1],this.pointRadius);a.drawCircles(this._endpoints)}}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._positions;a<c.length;a++)b.push(c[a].toJson());return{name:this._name,points:b,
textPoint:this.textPosition.toJson(),leaderPoint:this.leaderPosition.toJson(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,text:this._textShape.getTextString(),className:this.getClassName()}};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._positions=g.MeasureMarkup._constructPointArray(b.points);a.textPosition=d.Point3.fromJson(b.textPoint);a.leaderPosition=d.Point3.fromJson(b.leaderPoint);a._measurementValue=b.measurementValue;a._unitMultiplier=b.unitMultiplier||
1;a._textShape.setTextString(b.text);a._finalized=!0;return a};c.prototype.hit=function(b){var a=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),c=this._textShape.getPosition();return b.x<c.x||b.x>c.x+a.x||b.y<c.y||b.y>c.y+a.y?!1:!0};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePolygonAreaMarkup"};return c}(g.MeasureMarkup);g.MeasurePolygonAreaMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._polyline=new h.Shape.Polyline;c._initialPoint=new h.Shape.Circle;c._leaderLine=new h.Shape.Line;c._endpoints=new h.Shape.CircleCollection;c._textboxCorners=[d.Point2.zero(),d.Point2.zero(),d.Point2.zero(),d.Point2.zero()];c.textPosition=d.Point3.zero();c.leaderPosition=d.Point3.zero();c.isLoop=!1;c.pointRadius=2.5;c._viewer=b;b=c._viewer.measureManager.getMeasurementColor();c._initialPoint.setFillColor(b);
c._initialPoint.setStrokeColor(b);c._polyline.setStrokeColor(b);c._polyline.setStrokeWidth(2);c._leaderLine.setStrokeColor(b);c._endpoints.setFillColor(b);c._endpoints.setStrokeColor(b);c._endpoints.setFillOpacity(1);c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(d.Color.white());return c}__extends(c,a);c.prototype.addPoint=function(b){this._positions.push(b.copy());1<this._positions.length&&(b=d.Point3.subtract(this._positions[this._positions.length-1],this._positions[this._positions.length-
2]).length(),this._setMeasurementValue(this._measurementValue+b))};c.prototype.getPoints=function(){return this._positions};c.prototype.getlast=function(){return 0===this._positions.length?null:this._positions[this._positions.length-1].copy()};c.prototype.finalize=function(){if(this.isLoop&&2<this._positions.length){var b=d.Point3.subtract(this._positions[this._positions.length-1],this._positions[0]).length();this._setMeasurementValue(this._measurementValue+b)}this._finalized=!0};c.prototype.setUnitMultiplier=
function(b){this._unitMultiplier=b};c.prototype.isValid=function(){return 1<this._positions.length};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._updateProjectedPoints=function(){var b=[];this._behindView=this._behindView=!1;for(var a=0,c=this._positions;a<c.length;a++){var e=this._viewer.view.projectPoint(c[a]);0>=e.z&&(this._behindView=!0);b.push(d.Point2.fromPoint3(e))}return b};c.prototype._updateTextBoxCorners=function(){var b=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),
a=this._textShape.getPosition();this._textboxCorners[0].assign(a);this._textboxCorners[1].set(a.x+b.x,a.y);this._textboxCorners[2].set(a.x+b.x,a.y+b.y);this._textboxCorners[3].set(a.x,a.y+b.y)};c.prototype._calculateLeaderEndpoint=function(b){this._updateTextBoxCorners();for(var a=d.Point2.zero(),c=Number.MAX_VALUE,e=0,g=this._textboxCorners;e<g.length;e++){var h=g[e],p=d.Point2.distance(b,h);p<c&&(a.assign(h),c=p)}return a};c.prototype.draw=function(){if(this._visibility){var b=this._updateProjectedPoints();
if(!this._behindView&&0!==b.length){var a=this._viewer.markupManager.getRenderer();if(1===b.length)this._initialPoint.set(b[0],this.pointRadius),a.drawCircle(this._initialPoint);else{this._polyline.clearPoints();for(var c=0;c<b.length;c++)this._polyline.pushPoint(b[c]);this._finalized&&this.isLoop&&this._polyline.pushPoint(b[0]);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.textPosition));this._textShape.setPosition(c);a.drawPolyline(this._polyline);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.leaderPosition));
var e=this._calculateLeaderEndpoint(c);this._leaderLine.setP1(c);this._leaderLine.setP2(e);a.drawLine(this._leaderLine);a.drawTextBox(this._textShape);this._endpoints.clear();this.isLoop||(this._endpoints.addCircle(b[0],this.pointRadius),this._endpoints.addCircle(b[b.length-1],this.pointRadius),a.drawCircles(this._endpoints))}}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._positions;a<c.length;a++)b.push(c[a].toJson());return{name:this._name,
points:b,textPoint:this.textPosition.toJson(),leaderPoint:this.leaderPosition.toJson(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,isLoop:this.isLoop,text:this._textShape.getTextString(),className:this.getClassName()}};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._positions=g.MeasureMarkup._constructPointArray(b.points);a.textPosition=d.Point3.fromJson(b.textPoint);a.leaderPosition=d.Point3.fromJson(b.leaderPoint);a.isLoop=b.isLoop;a._measurementValue=b.measurementValue;
a._unitMultiplier=b.unitMultiplier||1;a._textShape.setTextString(b.text);a._finalized=!0;return a};c.prototype.hit=function(b){var a=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),c=this._textShape.getPosition();return b.x<c.x||b.x>c.x+a.x||b.y<c.y||b.y>c.y+a.y?!1:!0};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePolylineDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasurePolylineDistanceMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup=
{}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,c,e,g){b=a.call(this,b)||this;b._lineProperties=null;b._worldSpaceLength=0;b._arrowsInvert=!1;b._name="MeasureStraightEdgeLength";b._lineProperties=c;b._matrix=e.copy();b._matrix.setTranslationComponent(0,0,0);b._unitMultiplier=g;c=b._viewer.measureManager.getMeasurementColor();for(e=0;5>e;e++)g=new h.Shape.Line,g.setStrokeColor(c),g.setEndEndcapColor(c),g.setStartEndcapColor(c),b._lineShapes.push(g);c=b._textShape.getBoxPortion();
c.setFillOpacity(1);c.setFillColor(new d.Color(255,255,255));return b}__extends(c,a);c.prototype.setLineGeometry=function(b){a.prototype.setLineGeometry.call(this,b);this._positions[0]=this._linePositions[0];this._positions[2]=this._linePositions[0].copy();this._positions[1]=this._linePositions[this._linePositions.length-1];null!==this._lineProperties&&-1!==this._lineProperties.length?(b=new d.Point3(this._lineProperties.length,0,0),this._matrix.transform(b,b),b=this._worldSpaceLength=b.length()):
b=d.Point3.subtract(this._positions[1],this._positions[0]).length();this._setMeasurementValue(b)};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);var c=this._viewer.view,e=c.raycastFromPoint(b);if(null!==e){b=this._positions[0];var g=this._positions[1],h=new d.Point3(1,0,0);g.equals(b)||(h=d.Point3.subtract(g,b));var m=c.getCamera().getUp();c=d.Point3.cross(e.direction,m).normalize();var p=d.Point3.add(b,g).scale(.5);m=d.Point3.add(p,m);var q=d.Point3.add(p,c),r=d.Point3.add(d.Point3.scale(e.direction,
1E6),e.origin);c=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(e.origin,r,p,m,q,c);this._positions[2].assign(c);new d.Point3(0,0,0);e=Math.abs(h.x)<=Math.abs(h.y)&&Math.abs(h.x)<=Math.abs(h.z)?new d.Point3(1,0,0):Math.abs(h.y)<=Math.abs(h.x)&&Math.abs(h.y)<=Math.abs(h.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);e=d.Point3.cross(e,h);p=d.Point3.cross(e,h);e.add(b);p.add(b);m=d.Point3.add(d.Point3.scale(h,1E4),c);h=d.Point3.add(d.Point3.scale(h,-1E4),c);d.Util.intersectionPlaneLine(m,h,b,e,p,c);h=
d.Point3.subtract(c,b);this._positions[3]=d.Point3.add(b,h);this._positions[4]=d.Point3.add(g,h);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=d.Point3.add(this._positions[3],this._positions[4]).scale(.5),a=d.Point3.subtract(this._positions[4],this._positions[3]);this._arrowsInvert=2*d.Point3.subtract(this._positions[2],b).squaredLength()>a.squaredLength()};c.prototype.update=function(){a.prototype.update.call(this);var b=
this._viewer.view;this._behindView=!1;if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=Array(this._linePositions.length),e=0;e<this._linePositions.length;e++)c[e]=b.projectPoint(this._linePositions[e]),0>=c[e].z&&(this._behindView=!0),this._lineEdgeShape.pushPoint(d.Point2.fromPoint3(c[e]))}if(1<this._stage){var g=Array(6);c=Array(6);for(e=0;e<this._positions.length;e++)c[e]=b.projectPoint(this._positions[e]),0>=c[e].z&&(this._behindView=!0),g[e]=d.Point2.fromPoint3(c[e]);this._textShape&&
this._textShape.setPosition(g[2]);this._lineShapes[0].set(g[3],g[4]);this._lineShapes[1].set(g[0],g[3]);this._lineShapes[2].set(g[1],g[4]);this._lineShapes[3].set(g[3],g[2]);this._lineShapes[4].set(g[3],g[4]);this._lineShapes[4].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setEndcapsInverted(this._arrowsInvert)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),
!this._behindView)){var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:b.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var a=0,c=this._lineShapes;a<c.length;a++)b.drawLine(c[a]);b.drawTextBox(this._textShape);b.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),leaderPoint1:this._positions[3].copy(),
leaderPoint2:this._positions[4].copy(),textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName(),matrix:this._matrix.toJson()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){var e=d.Matrix.fromJson(b.matrix);a=new c(a,null,e,b.unitMultiplier||1);a._name=b.name;a._positions[0]=d.Point3.fromJson(b.measurePoint1);a._positions[1]=d.Point3.fromJson(b.measurePoint2);
a._positions[2]=d.Point3.fromJson(b.textPoint);a._textShape.setTextString(b.text);a._positions[3]=d.Point3.fromJson(b.leaderPoint1);a._positions[4]=d.Point3.fromJson(b.leaderPoint2);a._measurementValue=b.measurementValue;a._updateArrowsInverted();a._stage=2;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureStraightEdgeLengthMarkup"};return c}(g.MeasureLengthMarkup);g.MeasureStraightEdgeLengthMarkup=a})(h.Measure||
(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,c,e,g,h){var f=a.call(this)||this;f._uniqueId=d.UUID.create();f._noteElementId=null;f._position=d.Point3.zero();f._text="";f._color=d.Color.white();f._sphereRadius=.03;f._deleted=!1;f._active=!1;f._callbacks=null;f._viewer=b;f._noteTextManager=c;f._selectionPosition=e;f._selectionNormal=g;f._partId=h;f._noteTextManager.addNote(f);f._init();return f}__extends(c,a);c.prototype._init=function(){return __awaiter(this,void 0,void 0,
function(){var b,a,c,d,e=this;return __generator(this,function(f){switch(f.label){case 0:return b=this._createPinTransformationMatrix(this._selectionPosition,this._selectionNormal),[4,Promise.all([this._createPinStemInstance(b),this._createPinSphereInstance(b)])];case 1:return a=f.sent(),c=a[0],d=a[1],this._stemInstanceId=c,this._sphereInstanceId=d,[4,this._restore(!1)];case 2:return f.sent(),this._callbacks={visibilityChanged:function(){e._matchPartVisibility()}},this._viewer.setCallbacks(this._callbacks),
this._viewer.trigger("noteTextCreated",this),[2]}})})};c.prototype._matchPartVisibility=function(){if(void 0!==this._sphereInstanceId&&void 0!==this._stemInstanceId){var b=this._viewer.model,a=b.getNodeVisibility(this._partId),c=b.getNodeVisibility(this._sphereInstanceId);a===c||this._noteTextManager.getExplodeActive()||b.setNodesVisibility([this._stemInstanceId,this._sphereInstanceId],a);b=this._noteTextManager.getActiveItem();null===b||b.getStemInstanceId()!==this._stemInstanceId||a||this.hide()}};
c.prototype.updatePosition=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return void 0===this._sphereInstanceId?[2]:[4,this._viewer.model.getNodeRealBounding(this._sphereInstanceId)];case 1:return this._pinBoundingBox=b=a.sent(),this._position=this._pinBoundingBox.center(),this.setText(this._text),[2]}})})};c.prototype._restore=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._noteTextManager.setActiveItemHandle(this._viewer.markupManager.registerMarkup(this)),
this._noteTextManager.setActiveItem(this),this._show(b),this._updateColor(),[4,this.draw()];case 1:return a.sent(),[2]}})})};c.prototype.restore=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._restore(!0)]})})};c.prototype.setText=function(b){this._text=b;this._noteTextManager.getNoteTextElement().setText(b)};c.prototype.saveTextValue=function(){this._text=this._noteTextManager.getNoteTextElement().getText()};c.prototype.draw=function(){return __awaiter(this,
void 0,void 0,function(){var b,a,c;return __generator(this,function(e){switch(e.label){case 0:if(this._deleted||!this._active)return[2];this._behindView=!1;return[4,this.updatePosition()];case 1:return e.sent(),b=this._viewer.view.projectPoint(this._position),0>=b.z&&(this._behindView=!0),this._behindView?null!==this._noteElementId&&null!==document.getElementById(this._noteElementId)&&(this._viewer.markupManager.removeMarkupElement(this._noteElementId),this._noteElementId=null):(a=new d.Point2(b.x,
b.y),c=this._noteTextManager.getNoteTextElement(),c.setPosition(a),null===this._noteElementId&&(this._noteElementId=this._viewer.markupManager.addMarkupElement(c.getHtmlContainer()))),[2]}})})};c.prototype.hit=function(b){return this.hitWithTolerance(b,0)};c.prototype.hitWithTolerance=function(b,a){if(!this._active)return!1;var c=this._noteTextManager.getNoteTextElement(),e=c.getPosition();c=c.getSize();return d.Util.isPointInRect2d(b,e,c,a)};c.prototype.getClassName=function(){return c.className};
c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype.getSphereInstanceId=function(){return this._sphereInstanceId};c.prototype.getStemInstanceId=function(){return this._stemInstanceId};c.prototype.onSelect=function(){this._noteTextManager.getNoteTextElement().focus()};c.prototype.onDeselect=function(){this._noteTextManager.getNoteTextElement().blur()};c.prototype.hide=function(){var b=this._noteTextManager.getNoteTextElement();b.hide();this.setText(b.getText());this._noteTextManager.setActiveItem(null);
this._active=!1;this._viewer.trigger("noteTextHidden",this)};c.prototype._show=function(b){this._noteTextManager.getNoteTextElement().show(this);this._active=!0;b&&this._viewer.trigger("noteTextShown",this)};c.prototype.show=function(){this._show(!0)};c.prototype.remove=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(e){switch(e.label){case 0:if(!0===this.getRemoved())return[2];null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),
this._callbacks=null);b=this._viewer.model;c=[];void 0!==this._stemInstanceId&&c.push(b.deleteMeshInstances([this._stemInstanceId]));void 0!==this._sphereInstanceId&&c.push(b.deleteMeshInstances([this._sphereInstanceId]));this.hide();this._noteTextManager.removeNote(this);this._deleted=!0;return[4,d.Util.waitForAll(c)];case 1:return e.sent(),a.prototype.remove.call(this),[2]}})})};c.prototype.getRemoved=function(){return this._deleted};c.prototype.setColor=function(b){this._color=b;this._updateColor();
return Promise.resolve()};c.prototype.getColor=function(){return this._color};c.prototype.getPartId=function(){return this._partId};c.prototype._updateColor=function(){void 0!==this._sphereInstanceId&&this._viewer.model.setNodesFaceColor([this._sphereInstanceId],this._color)};c.prototype._createPinTransformationMatrix=function(b,a){var c=0,e=a.x;Math.abs(a.y)<Math.abs(e)&&(e=a.y,c=1);Math.abs(a.z)<Math.abs(e)&&(c=2);e=[0,0,0];e[c]=1;c=d.Point3.createFromArray(e);c=d.Point3.cross(a,c).normalize();
e=d.Point3.cross(a,c);var f=new d.Matrix;f.m=[a.x,a.y,a.z,0,c.x,c.y,c.z,0,e.x,e.y,e.z,0,0,0,0,1];f=d.Matrix.multiply(f,(new d.Matrix).setScaleComponent(this._sphereRadius,this._sphereRadius,this._sphereRadius));f.setTranslationComponent(b.x,b.y,b.z);return f};c.prototype._createPinStemInstance=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g;return __generator(this,function(f){a=this._noteTextManager.getPinStemMeshId();if(null===a)throw new d.CommunicatorError("stem mesh hasn't been created yet");
c=new d.MeshInstanceData(a,b,"pin-stem-instance",void 0,d.Color.black());c.setOpacity(1);e=d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw;c.setCreationFlags(e);g=this._viewer.model;return[2,g.createMeshInstance(c,void 0,!0,!0)]})})};c.prototype._createPinSphereInstance=
function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g;return __generator(this,function(f){a=this._noteTextManager.getPinSphereMeshId();if(null===a)throw new d.CommunicatorError("sphere mesh hasn't been created yet");c=new d.MeshInstanceData(a,b,"pin-sphere-instance",d.Color.white(),void 0);c.setOpacity(1);e=d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.ExcludeBounding|
d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw;c.setCreationFlags(e);g=this._viewer.model;return[2,g.createMeshInstance(c,void 0,!0,!0)]})})};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),selectionPosition:this._selectionPosition.toJson(),selectionNormal:this._selectionNormal.toJson(),text:this._text,color:this._color,partId:this._partId}};c.prototype.forJson=
function(){return this.toJson()};c._fromJson=function(b,a,e){if(!e.findById(b.uniqueId)){var f=d.Point3.fromJson(b.selectionPosition),g=d.Point3.fromJson(b.selectionNormal);a=new c(a,e,f,g,b.partId);a._uniqueId=b.uniqueId;a.setText(b.text);a.setColor(d.Color.fromJson(b.color));return a}return null};c.fromJson=function(b,a,d){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(f){e=c._fromJson(b,a,d);return[2,e]})})};c.className="Communicator.Markup.Note.NoteText";
return c}(h.MarkupItem);g.NoteText=a})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this)||this;c._pinSphereMeshId=null;c._pinStemMeshId=null;c._noteTextList=[];c._activeItemHandle=null;c._activeItem=null;c._explodeActive=!1;c._isolateActive=!1;c._stemLength=2;c._sphereIterations=2;c._viewer=b;c._noteTextElement=new g.NoteTextElement;c._noteTextElement.setPositionOffset(new d.Point2(12,-24));c._viewer.setCallbacks({sceneReady:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return[4,this._init()];case 1:return b.sent(),[2]}})})}});return c}__extends(c,a);c.prototype._init=function(){return __awaiter(this,void 0,void 0,function(){var b,a,d,e;return __generator(this,function(f){switch(f.label){case 0:return null===c._globalPinSphereMeshData&&(c._globalPinSphereMeshData=this._createPinSphereMeshData()),null===c._globalPinStemMeshData&&(c._globalPinStemMeshData=this._createPinStemMeshData()),b=this._viewer.model,a=b.createMesh(c._globalPinSphereMeshData),
d=b.createMesh(c._globalPinStemMeshData),[4,Promise.all([a,d])];case 1:return e=f.sent(),this._pinSphereMeshId=e[0],this._pinStemMeshId=e[1],[2]}})})};c.prototype._createPinStemMeshData=function(){var b=new d.MeshData;b.addPolyline([0,0,0,this._stemLength,0,0]);return b};c.prototype._createPinSphereMeshData=function(){var b=(1+Math.sqrt(5))/2,a=Math.sqrt(10+2*Math.sqrt(5))/(4*b),c=a/2;b=a/(2*b);var e=[];e[0]=new d.Point3(-b,c,0);e[1]=new d.Point3(b,c,0);e[2]=new d.Point3(-b,-c,0);e[3]=new d.Point3(b,
-c,0);e[4]=new d.Point3(0,-b,c);e[5]=new d.Point3(0,b,c);e[6]=new d.Point3(0,-b,-c);e[7]=new d.Point3(0,b,-c);e[8]=new d.Point3(c,0,-b);e[9]=new d.Point3(c,0,b);e[10]=new d.Point3(-c,0,-b);e[11]=new d.Point3(-c,0,b);for(c=0;c<e.length;c++){var g=e[c];g.normalize()}var h=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],p=12;b=function(b){var a=[];h.map(function(b){var c=e[b[0]],
f=e[b[1]],g=e[b[2]];e[p++]=(new d.Point3(c.x+f.x,c.y+f.y,c.z+f.z)).scale(.5).normalize();e[p++]=(new d.Point3(f.x+g.x,f.y+g.y,f.z+g.z)).scale(.5).normalize();e[p++]=(new d.Point3(g.x+c.x,g.y+c.y,g.z+c.z)).scale(.5).normalize();a.push([b[0],p-3,p-1]);a.push([p-3,p-2,p-1]);a.push([p-3,b[1],p-2]);a.push([p-2,b[2],p-1])});h=a};for(c=0;c<this._sphereIterations;c++)b(c);b=[];a=[];for(var q=0,r=h;q<r.length;q++){var t=r[q];for(c=0;3>c;c++)g=e[t[c]],b.push(g.x+this._stemLength+1),b.push(g.y),b.push(g.z),
g=g.normalize(),a.push(g.x),a.push(g.y),a.push(g.z)}c=new d.MeshData;c.addFaces(b,a);c.setFaceWinding(d.FaceWinding.CounterClockwise);return c};c.prototype.getPinStemMeshId=function(){return this._pinStemMeshId};c.prototype.getPinSphereMeshId=function(){return this._pinSphereMeshId};c.prototype.getNoteTextElement=function(){return this._noteTextElement};c.prototype.setNoteTextElement=function(b){this._noteTextElement.hide();this._noteTextElement=b};c.prototype.getNoteTextList=function(){return this._noteTextList};
c.prototype.addNote=function(b){this._noteTextList.push(b);this._activeItem=b};c.prototype.removeNote=function(b){b=this._noteTextList.indexOf(b);this._noteTextList.splice(b,1)};c.prototype.updatePinVisibility=function(){return __awaiter(this,void 0,void 0,function(){var b,a,c,d,e,g,h;return __generator(this,function(f){if(0<this._noteTextList.length){b=[];a=0;for(c=this._noteTextList;a<c.length;a++)d=c[a],e=d.getSphereInstanceId(),g=d.getStemInstanceId(),void 0!==e&&b.push(e),void 0!==g&&b.push(g);
h=this._viewer.model.setNodesVisibility(b,!this._explodeActive);this._explodeActive&&this._noteTextElement.hide();return[2,h]}return[2]})})};c.prototype.explode=function(b){this._explodeActive=0<b;return this.updatePinVisibility()};c.prototype.getExplodeActive=function(){return this._explodeActive};c.prototype.setIsolateActive=function(b){this._isolateActive=b};c.prototype.getIsolateActive=function(){return this._isolateActive};c.prototype.getActiveItem=function(){return this._activeItem};c.prototype.setActiveItem=
function(b){this._activeItem=b};c.prototype.getActiveItemHandle=function(){return this._activeItemHandle};c.prototype.setActiveItemHandle=function(b){this._activeItemHandle=b};c.prototype.selectPin=function(b){this._activeItem&&this._activeItem.hide();b=b.getNodeId();return null!==b&&(b=this._getNoteTextFromNodeId(b),null!==b)?(b.restore(),!0):!1};c.prototype.checkPinInstance=function(b){return null!==this._getNoteTextFromNodeId(b)};c.prototype._getNoteTextFromNodeId=function(b){for(var a=0,c=this._noteTextList;a<
c.length;a++){var d=c[a];if(d.getSphereInstanceId()===b||d.getStemInstanceId()===b)return d}return null};c.prototype.findById=function(b){for(var a=0,c=this._noteTextList;a<c.length;a++)if(b===c[a].getUniqueId())return!0;return!1};c.prototype.loadData=function(b){for(var a=[],c=0;c<b.length;c++){var d=g.NoteText.fromJson(b[c],this._viewer,this).then(function(b){return null!==b});a.push(d)}return Promise.all(a)};c.prototype.exportMarkup=function(){for(var b=[],a=0,c=this._noteTextList;a<c.length;a++)b.push(c[a].toJson());
return b};c._globalPinSphereMeshData=null;c._globalPinStemMeshData=null;return c}(d.MarkupTypeManager);g.NoteTextManager=a})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._uniqueId=d.UUID.create();b._centerPt=d.Point3.zero();b._radiusPt=d.Point3.zero();b._circleShape=new h.Shape.Circle;b._previousDragPlanePosition=d.Point3.zero();b._circleShape.setFillOpacity(0);b._circleShape.setStrokeColor(d.Color.red());b._circleShape.setStrokeWidth(2);return b}__extends(c,a);c.prototype.setCenter=function(b){this._centerPt.assign(b)};c.prototype.getCenter=function(){return this._centerPt.copy()};
c.prototype.setRadiusPoint=function(b){this._radiusPt.assign(b)};c.prototype.getRadiusPoint=function(){return this._radiusPt.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var b=this._viewer.view,a=d.Point2.fromPoint3(b.projectPoint(this._centerPt));b=d.Point2.fromPoint3(b.projectPoint(this._radiusPt));b=d.Point2.distance(a,b);this._circleShape.set(a,b)};c.prototype.draw=function(){this._update();this._viewer.markupManager.getRenderer().drawCircle(this._circleShape)};
c.prototype.hit=function(b){return this.hitWithTolerance(b,0)};c.prototype.hitWithTolerance=function(b,a){this._update();a=this._circleShape.getStrokeWidth()+a;b=d.Point2.distance(this._circleShape.getCenter(),b)-this._circleShape.getRadius();return Math.abs(b)<=a};c.prototype.onSelect=function(){this._circleShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._circleShape.setStrokeWidth(2)};c.prototype.isValid=function(){return this._circleShape.getRadius()>c._validRadiusTolerance};c.prototype.onDragStart=
function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._previousDragPlanePosition.assign(b);return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&(a=d.Point3.subtract(b,this._previousDragPlanePosition),this._centerPt.add(a),this._radiusPt.add(a),this._previousDragPlanePosition.assign(b));return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,
centerPoint:this._centerPt.toJson(),radiusPoint:this._radiusPt.toJson(),className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._uniqueId=b.uniqueId;a.setCenter(d.Point3.fromJson(b.centerPoint));a.setRadiusPoint(d.Point3.fromJson(b.radiusPoint));return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlineCircle"};c._validRadiusTolerance=1;return c}(g.RedlineItem);
g.RedlineCircle=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._uniqueId=d.UUID.create();b._points=[];b._polylineShape=new h.Shape.Polyline;b._previousDragPlanePosition=d.Point3.zero();b._polylineShape.setStrokeWidth(2);b._polylineShape.setStrokeColor(d.Color.red());return b}__extends(c,a);c.prototype.addPoint=function(b){this._points.push(b.copy())};c.prototype.getPoints=function(){var b=[];this._points.forEach(function(a){b.push(a.copy())});return b};c.prototype._update=
function(){var b=this._viewer.view;this._polylineShape.clearPoints();for(var a=0,c=this._points;a<c.length;a++){var e=d.Point2.fromPoint3(b.projectPoint(c[a]));this._polylineShape.pushPoint(e)}};c.prototype.draw=function(){this._update();this.isValid()&&this._viewer.markupManager.getRenderer().drawPolyline(this._polylineShape)};c.prototype.hit=function(b){return this.hitWithTolerance(b,0)};c.prototype.hitWithTolerance=function(b,a){this._update();a=this._polylineShape.getStrokeWidth()+a;var c=this._polylineShape.getPoints();
if(1<c.length)for(var e=1;e<c.length;e++)if(d.Util.isPointOnLineSegment2d(b,c[e-1],c[e],a))return!0;return!1};c.prototype.onSelect=function(){this._polylineShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._polylineShape.setStrokeWidth(2)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlinePolyline"};c.prototype.isValid=function(){return 1<this._points.length};c.prototype.onDragStart=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,
a);null!==b&&this._previousDragPlanePosition.assign(b);return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);if(null!==b){a=d.Point3.subtract(b,this._previousDragPlanePosition);for(var c=0,e=this._points;c<e.length;c++)e[c].add(a);this._polylineShape.clearPoints();this._previousDragPlanePosition.assign(b)}return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._points;a<
c.length;a++)b.push(c[a].toJson());return{uniqueId:this._uniqueId,points:b}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,e){e=new c(e);e._uniqueId=a.uniqueId;var b=0;for(a=a.points;b<a.length;b++)e.addPoint(d.Point3.fromJson(a[b]));return e};c.construct=function(a,d){return c.fromJson(a,d)};return c}(g.RedlineItem);g.RedlinePolyline=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._uniqueId=d.UUID.create();b._point1=d.Point3.zero();b._point2=d.Point3.zero();b._rectangleShape=new h.Shape.Rectangle;b._previousDragPlanePosition=d.Point3.zero();b._rectangleShape.setFillOpacity(0);b._rectangleShape.setStrokeColor(d.Color.red());b._rectangleShape.setStrokeWidth(2);return b}__extends(c,a);c.prototype.setPoint1=function(a){this._point1.assign(a)};c.prototype.getPoint1=function(){return this._point1.copy()};
c.prototype.setPoint2=function(a){this._point2.assign(a)};c.prototype.getPoint2=function(){return this._point2.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var a=this._viewer.view,c=a.projectPoint(this._point1),e=a.projectPoint(this._point2);a=new d.Point2(Math.min(c.x,e.x),Math.min(c.y,e.y));c=new d.Point2(Math.max(c.x,e.x),Math.max(c.y,e.y));c=d.Point2.subtract(c,a);this._rectangleShape.setPosition(a);this._rectangleShape.setSize(c)};c.prototype.draw=
function(){this._update();this._viewer.markupManager.getRenderer().drawRectangle(this._rectangleShape)};c.prototype.hit=function(a){return this.hitWithTolerance(a,0)};c.prototype.hitWithTolerance=function(a,c){this._update();c=this._rectangleShape.getStrokeWidth()+c;var b=this._rectangleShape.getPosition(),e=this._rectangleShape.getSize(),f=new d.Point2(b.x+e.x,b.y),g=new d.Point2(b.x,b.y+e.y);e=new d.Point2(b.x+e.x,b.y+e.y);return d.Util.isPointOnLineSegment2d(a,b,f,c)||d.Util.isPointOnLineSegment2d(a,
f,e,c)||d.Util.isPointOnLineSegment2d(a,e,g,c)||d.Util.isPointOnLineSegment2d(a,g,b,c)?!0:!1};c.prototype.onSelect=function(){this._rectangleShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._rectangleShape.setStrokeWidth(2)};c.prototype.isValid=function(){var a=this._rectangleShape.getSize();return a.x>c._validSizeTolerance.x&&a.y>c._validSizeTolerance.y};c.prototype.onDragStart=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._previousDragPlanePosition.assign(a);
return!1};c.prototype.onDragMove=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(b=d.Point3.subtract(a,this._previousDragPlanePosition),this._point1.add(b),this._point2.add(b),this._previousDragPlanePosition.assign(a));return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),point1:this._point1.toJson(),point2:this._point2.toJson()}};c.prototype.forJson=
function(){return this.toJson()};c.fromJson=function(a,e){e=new c(e);e._uniqueId=a.uniqueId;e.setPoint1(d.Point3.fromJson(a.point1));e.setPoint2(d.Point3.fromJson(a.point2));return e};c.construct=function(a,d){return c.fromJson(a,d)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlineRectangle"};c._validSizeTolerance=new d.Point2(5,5);return c}(g.RedlineItem);g.RedlineRectangle=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(a,b){this._sizeChanged=!1;this._sizeUpdateCallback=a;this._textUpdateCallback=b;this._createTextBox()}a.prototype._createTextBox=function(){var c=this;this._currentSize=a._defaultSize.copy();this._textArea=document.createElement("textarea");this._textArea.style.position="absolute";this._textArea.style.width=a._defaultSize.x+"px";this._textArea.style.height=a._defaultSize.y+"px";this._textArea.style.zIndex="1";this._textArea.style.pointerEvents=
"none";this._textArea.style.resize="none";this._textArea.style.letterSpacing="1px";this.setBorderWidth(2);this._textArea.onmousemove=function(a){a.stopPropagation();a=new d.Point2(parseInt(c._textArea.style.width,10),parseInt(c._textArea.style.height,10));c.setSize(a)};this._textArea.onmouseup=function(a){a.stopPropagation();c._sizeChanged&&(c._sizeChanged=!1,c._sizeUpdateCallback(c._currentSize))};this._textArea.oninput=function(){c._textUpdateCallback(c._textArea.value)}};a.prototype.setPosition=
function(a){this._textArea.style.left=a.x+"px";this._textArea.style.top=a.y+"px"};a.prototype.setBorderWidth=function(a){this._textArea.style.outline=a+"px solid red"};a.prototype.setText=function(a){this._textArea.textContent=a};a.prototype.setSize=function(a){this._currentSize.equals(a)||(this._sizeChanged=!0,this._currentSize.assign(a),this._textArea.style.width=a.x+"px",this._textArea.style.height=a.y+"px")};a.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents=
"auto";this._textArea.style.resize="both"};a.prototype.blur=function(){this._textArea.blur();this._textArea.style.pointerEvents="none";this._textArea.style.resize="none"};a.prototype.getTextArea=function(){return this._textArea};a._defaultSize=new d.Point2(100,100);return a}();g.RedlineTextElement=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,e){void 0===e&&(e=c.defaultText);var f=a.call(this,b)||this;f._uniqueId=d.UUID.create();f._position=d.Point3.zero();f._size=new d.Point2(100,100);f._redlineElementId=null;f._previousDragPlanePosition=d.Point3.zero();f._text=e;f._redlineTextElement=new g.RedlineTextElement(function(a){f.setSize(a)},function(a){f.setText(a)});f._redlineTextElement.setText(f._text);f._callbacks={selectionArray:function(){f.onDeselect()}};f._viewer.setCallbacks(f._callbacks);
return f}__extends(c,a);c.prototype.setPosition=function(a){this._position.assign(a)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(a){this._size.assign(a);this._redlineTextElement.setSize(a);this._viewer.trigger("redlineUpdated",this)};c.prototype.getSize=function(){return this._size.copy()};c.prototype.setText=function(a){this._text=a;this._redlineTextElement.setText(a);this._viewer.trigger("redlineUpdated",this)};c.prototype.getText=function(){return this._text};
c.prototype.draw=function(){var a=d.Point2.fromPoint3(this._viewer.view.projectPoint(this._position));this._redlineTextElement.setPosition(a);null===this._redlineElementId&&(this._redlineElementId=this._viewer.markupManager.addMarkupElement(this._redlineTextElement.getTextArea()))};c.prototype.hit=function(a){return this.hitWithTolerance(a,0)};c.prototype.hitWithTolerance=function(a,c){var b=this._redlineTextElement.getTextArea(),e=new d.Point2(parseFloat(b.style.left||"0"),parseFloat(b.style.top||
"0"));b=new d.Point2(parseFloat(b.style.width||"0"),parseFloat(b.style.height||"0"));return d.Util.isPointInRect2d(a,e,b,c)};c.prototype.getClassName=function(){return c.className};c.prototype.onSelect=function(){this._redlineTextElement.setBorderWidth(4);this._redlineTextElement.focus()};c.prototype.onDeselect=function(){this._redlineTextElement.setBorderWidth(2);this._redlineTextElement.blur()};c.prototype.isValid=function(){return 0<this._text.length};c.prototype.remove=function(){this._redlineElementId&&
(this._viewer.markupManager.removeMarkupElement(this._redlineElementId),this._redlineElementId=null);null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);a.prototype.remove.call(this)};c.prototype.onDragStart=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._previousDragPlanePosition.assign(a);return!1};c.prototype.onDragMove=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,
b);if(null!==a){b=d.Point3.subtract(a,this._previousDragPlanePosition);var c=this.getPosition();c.add(b);this.setPosition(c);this._previousDragPlanePosition.assign(a)}return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),position:this._position.toJson(),size:this._size.toJson(),text:this._text}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,e){e=new c(e,a.text);e._uniqueId=
a.uniqueId;e.setPosition(d.Point3.fromJson(a.position));e.setSize(d.Point2.fromJson(a.size));return e};c.construct=function(a,d){return c.fromJson(a,d)};c.className="Communicator.Markup.Redline.RedlineText";c.defaultText="Type Here...";return c}(g.RedlineItem);g.RedlineText=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._moveSelectionAction=new d.Util.CurrentAction(!0);c._currentMoveHighlight=null;c._currentSelectHighlight=null;c._markup=null;c._measureManager=b;return c}__extends(e,a);e.prototype._unsetCurrentMoveHighlight=function(){null!==this._currentMoveHighlight&&(this._viewer.model.setNodesHighlighted([this._currentMoveHighlight.getNodeId()],!1),this._currentMoveHighlight=null)};e.prototype._unsetCurrentSelectionHighlight=
function(){null!==this._currentSelectHighlight&&(this._viewer.model.setNodesHighlighted([this._currentSelectHighlight.getNodeId()],!1),this._currentSelectHighlight=null)};e.prototype._performMoveSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(0!==e.overlayIndex()||!e.isNodeSelection())return this._unsetCurrentMoveHighlight(),
[2];g=e.getNodeId();if(null===g||c.getNodeType(g)!==d.NodeType.BodyInstance||this._markup&&(h=this._markup.getFirstNode(),null!==h&&g===h))return[2];null!==this._currentMoveHighlight?e.equals(this._currentMoveHighlight)?e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentMoveHighlight():(this._unsetCurrentMoveHighlight(),this._currentMoveHighlight=e,c.setNodesHighlighted([g],!0)):(this._currentMoveHighlight=e,c.setNodesHighlighted([g],!0));return[2]}})})};e.prototype._performUpSelection=
function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];this._markup&&1===this._markup._getStage()&&this._viewer.trigger("measurementBegin");if(this._markup&&1<this._markup._getStage())return g=this._markup,this._markup=null,g.finalize(),this._measureManager.finalizeMeasurement(g),[2];h=e.getNodeId();
if(null===h||c.getNodeType(h)!==d.NodeType.BodyInstance||this._markup&&!(1>=this._markup._getStage()))return[2];this._unsetCurrentMoveHighlight();if(this._markup)return[3,2];this._markup=new d.Markup.Measure.MeasureBodyBodyDistanceMarkup(this._viewer);this._markup.setUnitMultiplier(c.getNodeUnitMultiplier(h));this._markup.setFirstNode(h);e.isNodeSelection()&&(this._unsetCurrentSelectionHighlight(),this._currentSelectHighlight=e,this._viewer.model.setNodesHighlighted([h],!0));this._measureManager.addMeasurement(this._markup);
return[3,4];case 2:return this._unsetCurrentSelectionHighlight(),[4,this._markup.setSecondNode(h)];case 3:f.sent(),this._markup.adjust(a),f.label=4;case 4:return[2]}})})};e.prototype.onMouseMove=function(c){var b=this;a.prototype.onMouseMove.call(this,c);var d=c.getPosition();(!this._markup||1>=this._markup._getStage())&&this._moveSelectionAction.set(function(){return b._performMoveSelection(d)});this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(d)};
e.prototype._onMouseUpImpl=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];b=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(!(3>this._dragCount||b))return[2];c=a.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,
this._onMouseUpImpl(c)];case 1:return b.sent(),a.prototype.onMouseUp.call(this,c),[2]}})})};e.prototype.setDraggingEnabled=function(a){this._dragging=a};e.prototype.onKeyUp=function(a){};e.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&(null!==this._markup?(this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};e.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};e.prototype.onDeactivate=
function(){a.prototype.onDeactivate.call(this);this._unsetCurrentMoveHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup=null)};return e}(h.OperatorBase);h.MeasureBodyBodyDistanceOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._pickConfig=new d.PickConfig(d.SelectionMask.Line);c._moveSelectionAction=new d.Util.CurrentAction(!0);c._lengthMarkup=null;c._edgeMarkup=null;c._measureManager=b;c._pickConfig.restrictLinesAndPointsToSelectedFaceInstances=!1;return c}__extends(e,a);e.prototype.onActivate=function(){null===this._edgeMarkup&&(this._edgeMarkup=new d.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,null,new d.Matrix,1))};
e.prototype._unregisterEdgeMarkup=function(){if(null!==this._edgeMarkup){var a=this._edgeMarkup._getId();""!==a&&(this._viewer.markupManager.unregisterMarkup(a),this._edgeMarkup._setId(""))}};e.prototype._registerEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup._setId(this._viewer.markupManager.registerMarkup(this._edgeMarkup)))};e.prototype._resetEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup.reset())};e.prototype._performMoveSelection=
function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return c=this._viewer.view,[4,c.pickFromPoint(a,this._pickConfig)];case 1:return d=f.sent(),e=d.getNodeId(),g=d.getLineEntity(),(h=e&&g&&!g.isCappingGeometry()&&0===d.overlayIndex())?[4,this._viewer.model.isLineMeasurable(e,g.getLineId())]:[3,3];case 2:h=f.sent(),f.label=3;case 3:return h?(b.setLineGeometry(g.getPoints()),this._registerEdgeMarkup()):this._resetEdgeMarkup(),
[2]}})})};e.prototype._performUpSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h,m,p,q,r,t;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,this._pickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];if(this._lengthMarkup&&2===this._lengthMarkup._getStage())return g=this._lengthMarkup,this._lengthMarkup=null,g._nextStage(),this._measureManager.finalizeMeasurement(g),[2];if(this._lengthMarkup||
!e.isLineSelection())return[2];h=e.getNodeId();if(!h)return[2];m=e.getLineEntity();return[4,this._viewer.model.isLineMeasurable(h,m.getLineId())];case 2:p=f.sent();if(!p)return[2];q=c.getNodeUnitMultiplier(h);return[4,c.getEdgeProperty(h,m.getLineId())];case 3:r=f.sent();this._viewer.trigger("measurementBegin");if(!r)return[2];r instanceof d.SubentityProperties.LineElement||r instanceof d.SubentityProperties.OtherEdgeElement?(t=c.getNodeNetMatrix(h),this._lengthMarkup=new d.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,
r,t,q),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(m.getPoints()),this._lengthMarkup._nextStage(),this._lengthMarkup.adjust(a)):r instanceof d.SubentityProperties.CircleElement&&(t=c.getNodeNetMatrix(h),this._lengthMarkup=new d.Markup.Measure.MeasureCircleEdgeLengthMarkup(this._viewer,r,t,q),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(m.getPoints()),this._lengthMarkup._nextStage(),this._lengthMarkup.adjust(a));
2===this._lengthMarkup._getStage()&&this._viewer.trigger("measurementValueSet",this._lengthMarkup);return[2]}})})};e.prototype.onMouseMove=function(c){var b=this;a.prototype.onMouseMove.call(this,c);var d=this._edgeMarkup;if(null!==d){d.setMeasurementEdgeColor(this._viewer.measureManager.getMeasurementEdgeColor());var e=c.getPosition();this.isDragging()&&null===this._primaryTouchId?this._resetEdgeMarkup():(null===this._lengthMarkup&&this._moveSelectionAction.set(function(){return b._performMoveSelection(e,
d)}),this._viewer.markupManager.refreshMarkup(),null!==this._lengthMarkup&&0<this._lengthMarkup._getStage()&&this._lengthMarkup.adjust(e))}};e.prototype._onMouseUpImpl=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];b=null!==this._primaryTouchId&&null!==this._lengthMarkup;if(!(3>this._dragCount||b))return[2];c=a.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};
e.prototype.onMouseUp=function(c){this._onMouseUpImpl(c);a.prototype.onMouseUp.call(this,c)};e.prototype.setDraggingEnabled=function(a){this._dragging=a};e.prototype.onKeyUp=function(a){};e.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&(null!==this._lengthMarkup?(this._measureManager.removeMeasurement(this._lengthMarkup),this._lengthMarkup=null):this._measureManager.removeLastMeasurement(),null!==this._edgeMarkup&&this._resetEdgeMarkup())};e.prototype.setHandled=function(){return null!==
this._lengthMarkup};e.prototype.onDeactivate=function(){null!==this._lengthMarkup&&(this._measureManager.removeMeasurement(this._lengthMarkup),this._lengthMarkup=null);null!==this._edgeMarkup&&this._resetEdgeMarkup()};return e}(h.OperatorBase);h.MeasureEdgeLengthOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(a,c){return __awaiter(this,void 0,void 0,function(){var b,e,g,h;return __generator(this,function(f){switch(f.label){case 0:if(c.getSelectionType()===d.SelectionType.None)return[3,2];b=c.getNodeId();e=c.getFaceEntity();return[4,a.isFaceMeasurable(b,e.getCadFaceIndex())];case 1:g=f.sent();if(!g)return[2,!1];h=e.getCadFaceBits();return[2,0!==(h&2)];case 2:return[2,!1]}})})}var a=function(a){function c(b,c){b=a.call(this,b)||this;b._moveSelectionAction=new d.Util.CurrentAction(!0);
b._currentHighlight=null;b._markup=null;b._useAuthoredNormals=!0;b._measureManager=c;return b}__extends(c,a);c.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),this._currentHighlight=null)};c.prototype._performMoveSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,h,m,p,q,r;return __generator(this,function(f){switch(f.label){case 0:return b=
this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(0!==e.overlayIndex()||!e.isFaceSelection())return[2];h=e.getNodeId();m=e.getFaceEntity();if(c.getNodeType(e.getNodeId())!==d.NodeType.BodyInstance||this._markup&&(p=this._markup.getFirstSelection(),h===p.getNodeId()&&(q=p.getFaceEntity().getCadFaceIndex(),r=m.getCadFaceIndex(),q===r)))return[2];if(null===this._currentHighlight)return[3,5];if(e.equals(this._currentHighlight))return[3,3];this._unsetCurrentHighlight();
return[4,g(c,e)];case 2:return f.sent()&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow())),[3,4];case 3:e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentHighlight(),f.label=4;case 4:return[3,7];case 5:return null!==this._currentHighlight?[3,7]:[4,g(c,e)];case 6:f.sent()&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow())),f.label=7;case 7:return[2]}})})};c.prototype._performUpSelection=function(a){return __awaiter(this,
void 0,void 0,function(){var b,c,e,h,m,p,q;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:return e=f.sent(),e.overlayIndex()?[2]:this._markup&&1<this._markup._getStage()?(this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&(h=this._markup,this._markup=null,this._measureManager.finalizeMeasurement(h)),[2]):e.isFaceSelection()&&c.getNodeType(e.getNodeId())===
d.NodeType.BodyInstance&&(!this._markup||1>=this._markup._getStage())?[4,g(c,e)]:[2];case 2:if(!f.sent())return[2];m=e.getFaceEntity();return[4,c.getFaceProperty(e.getNodeId(),m.getCadFaceIndex())];case 3:p=f.sent();if(!(p instanceof d.SubentityProperties.PlaneElement))return[2];this._unsetCurrentHighlight();if(null!==this._markup)return[3,5];this._markup=new d.Markup.Measure.MeasureFaceFaceAngleMarkup(this._viewer);this._markup.setUseAuthoredNormals(this._useAuthoredNormals);return[4,this._markup.setFirstFace(e)];
case 4:return f.sent(),this._measureManager.addMeasurement(this._markup),[3,7];case 5:return[4,this._markup.setSecondFace(e)];case 6:(q=f.sent())&&this._markup.adjust(a),f.label=7;case 7:return[2]}})})};c.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,b);b=b.getPosition();(!this._markup||1>=this._markup._getStage())&&this._performMoveSelection(b);this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(b)};c.prototype._onMouseUpImpl=
function(a){var b=this;if(this.isActive()){var c=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(3>this._dragCount||c){var d=a.getPosition();this._moveSelectionAction.set(function(){return b._performUpSelection(d)})}}};c.prototype.onMouseUp=function(b){this._onMouseUpImpl(b);a.prototype.onMouseUp.call(this,b)};c.prototype.setDraggingEnabled=function(a){this._dragging=a};c.prototype.onKeyUp=function(a){};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&
(null!==this._markup?(this._markup.cleanup(),this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};c.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};c.prototype.onDeactivate=function(){this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};c.prototype.setUseAuthoredNormals=function(a){this._useAuthoredNormals=
a};c.prototype.getUseAuthoredNormals=function(){return this._useAuthoredNormals};return c}(h.OperatorBase);h.MeasureFaceFaceAngleOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._moveSelectionAction=new d.Util.CurrentAction(!0);c._currentHighlight=null;c._markup=null;c._measureManager=b;return c}__extends(e,a);e.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),this._currentHighlight=null)};e.prototype._performMoveSelection=function(a){return __awaiter(this,
void 0,void 0,function(){var b,c,e,g,h,m,p;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(0!==e.overlayIndex()||!e.isFaceSelection())return[2];g=e.getNodeId();h=e.getFaceEntity();if(c.getNodeType(g)!==d.NodeType.BodyInstance||this._markup&&(m=this._markup.getFirstSelection(),null!==m&&g===m.getNodeId()&&h.getCadFaceIndex()===m.getFaceEntity().getCadFaceIndex()))return[2];if(null===
this._currentHighlight)return[3,5];if(e.equals(this._currentHighlight))return[3,3];this._unsetCurrentHighlight();return[4,c.isFaceMeasurable(g,h.getCadFaceIndex())];case 2:if(p=f.sent())this._currentHighlight=e,c.setNodeFaceColor(g,h.getCadFaceIndex(),d.Color.yellow());return[3,4];case 3:e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentHighlight(),f.label=4;case 4:return[3,7];case 5:return[4,c.isFaceMeasurable(g,h.getCadFaceIndex())];case 6:if(p=f.sent())this._currentHighlight=e,c.setNodeFaceColor(g,
h.getCadFaceIndex(),d.Color.yellow());f.label=7;case 7:return[2]}})})};e.prototype._performUpSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h,m,p,q,r,t;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];if(this._markup&&1<this._markup._getStage())return this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&
(g=this._markup,this._markup=null,this._measureManager.finalizeMeasurement(g)),[2];if(!e.isFaceSelection())return[2];h=e.getNodeId();m=e.getFaceEntity();return[4,c.isFaceMeasurable(h,m.getCadFaceIndex())];case 2:return(p=f.sent())&&c.getNodeType(h)===d.NodeType.BodyInstance&&(!this._markup||1>=this._markup._getStage())?[4,c.getFaceProperty(h,m.getCadFaceIndex())]:[2];case 3:q=f.sent();if(!q)return[2];r=c.getNodeNetMatrix(h);this._unsetCurrentHighlight();return q instanceof d.SubentityProperties.PlaneElement||
q instanceof d.SubentityProperties.CylinderElement?[4,c.getNodesBounding([h])]:[3,7];case 4:t=f.sent();if(this._markup)return[3,5];this._markup=new d.Markup.Measure.MeasureFaceFaceDistanceMarkup(this._viewer);this._markup.setUnitMultiplier(c.getNodeUnitMultiplier(h));this._markup.setFirstFace(e,q,r,t);this._measureManager.addMeasurement(this._markup);return[3,7];case 5:return[4,this._markup.setSecondFace(a,e,q,r,t)];case 6:f.sent(),f.label=7;case 7:return[2]}})})};e.prototype.onMouseMove=function(c){var b=
this;a.prototype.onMouseMove.call(this,c);var d=c.getPosition();(!this._markup||1>=this._markup._getStage())&&this._moveSelectionAction.set(function(){return b._performMoveSelection(d)});this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(d)};e.prototype._onMouseUpImpl=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];b=null!==this._primaryTouchId&&
null!==this._markup&&1<this._markup._getStage();if(!(3>this._dragCount||b))return[2];c=a.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};e.prototype.onMouseUp=function(c){this._onMouseUpImpl(c);a.prototype.onMouseUp.call(this,c)};e.prototype.setDraggingEnabled=function(a){this._dragging=a};e.prototype.onKeyUp=function(a){};e.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&(null!==this._markup?(this._markup.cleanup(),this._measureManager.removeMeasurement(this._markup),
this._markup=null):this._measureManager.removeLastMeasurement())};e.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};e.prototype.onDeactivate=function(){a.prototype.onDeactivate.call(this);this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};return e}(h.OperatorBase);h.MeasureFaceFaceDistanceOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){var d=a.call(this,c)||this;d._markupItem=null;d._cameraInteractionActive=!1;d._measureManager=b;d._cursor=new h.Common.PointCursor(d._viewer);d._viewer.setCallbacks({beginInteraction:function(){d._onBeginInteraction()},endInteraction:function(){d._onEndInteraction()}});return d}__extends(e,a);e.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};e.prototype._onEndInteraction=function(){this._cameraInteractionActive=
!1};e.prototype._useSnapping=function(a){return this._cursor.snappingConfig.enabled&&!a.altDown()};e.prototype._addPoint=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,e;return __generator(this,function(f){switch(f.label){case 0:return[4,this._cursor.getSelectionCursorPoints(a,b,null)];case 1:c=f.sent();if(null===c||null===c.worldPosition)return[2];null===this._markupItem&&(this._markupItem=new d.Markup.Measure.MeasureLineLineAngleMarkup(this._viewer),this._measureManager.addMeasurement(this._markupItem),
this._viewer.trigger("measurementBegin"));this._markupItem.addPoint(c.worldPosition);this._markupItem._isFinalized()&&(e=this._markupItem,this._markupItem=null,this._measureManager.finalizeMeasurement(e));return[2]}})})};e.prototype._updateMarkupSelectionPosition=function(a,b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return null===this._markupItem?[2]:[4,this._cursor.getSelectionCursorPoints(a,b,null)];case 1:c=d.sent();if(null===
c)return[2];this._markupItem.setSelectionPosition(c.worldPosition);return[2]}})})};e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(e){switch(e.label){case 0:a.prototype.onMouseMove.call(this,c);if(this._cameraInteractionActive)return[2];b=c.getPosition();d=this._useSnapping(c);this._cursor.updateCursorSprite(b,d,null);return[4,this._updateMarkupSelectionPosition(b,d)];case 1:return e.sent(),this._viewer.markupManager.refreshMarkup(),
[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];b=c.getPosition();return this._ptFirst.equals(b)?[4,this._addPoint(b,this._useSnapping(c))]:[3,2];case 1:d.sent(),d.label=2;case 2:return a.prototype.onMouseUp.call(this,c),[2]}})})};e.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};e.prototype._clearMeasurement=function(){null!==
this._markupItem?(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null):this._measureManager.removeLastMeasurement()};e.prototype.setHandled=function(){return null!==this._markupItem&&1<this._markupItem._getStage()};e.prototype.onActivate=function(){this._cursor.onOperatorActivate()};e.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate();null!==this._markupItem&&(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null)};return e}(h.OperatorBase);
h.MeasureLineLineAngleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){var d=a.call(this,c)||this;d._measureMarkup=null;d._cameraInteractionActive=!1;d._viewer=c;d._measureManager=b;d._cursor=new h.Common.PointCursor(d._viewer);d._viewer.setCallbacks({beginInteraction:function(){d._onBeginInteraction()},endInteraction:function(){d._onEndInteraction()}});return d}__extends(e,a);e.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};e.prototype._onEndInteraction=
function(){this._cameraInteractionActive=!1};e.prototype._getStage=function(){return null===this._measureMarkup?0:this._measureMarkup._getStage()};e.prototype._draw=function(){var a=!1;2>this._getStage()&&(this._cursor.draw(),a=!0);null!==this._measureMarkup&&(this._measureMarkup.draw(),a=!0);a&&this._viewer.markupManager.refreshMarkup()};e.prototype._finalizeMeasurement=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,e,g;return __generator(this,function(f){switch(f.label){case 0:c=
this._measureMarkup;if(null===c)return console.assert(!1),[2];e=new d.PickConfig(b?d.SelectionMask.All:d.SelectionMask.Face);return[4,this._viewer.view.pickFromPoint(a,e)];case 1:g=f.sent();if(g.overlayIndex())return[2];c.finalize();this._measureMarkup=null;this._measureManager.finalizeMeasurement(c);return[2]}})})};e.prototype._getFirstPickPosition=function(){var a=null;null!==this._measureMarkup&&1<=this._getStage()&&(a=this._measureMarkup.getFirstPointPosition());return a};e.prototype._updateMeasurementPoints=
function(a,b){return __awaiter(this,void 0,void 0,function(){var c,e,g,h,m;return __generator(this,function(f){switch(f.label){case 0:return c=this._getStage(),console.assert(2>c),this._viewer.trigger("measurementBegin"),e=this._getFirstPickPosition(),[4,this._cursor.getSelectionCursorPoints(a,b,e)];case 1:g=f.sent();if(null===g||null===g.worldPosition)return this._cursor.activateCursorSprite(!1),[2];this._cursor.activateCursorSprite(!0);null===this._measureMarkup&&(this._measureMarkup=new d.Markup.Measure.MeasurePointPointDistanceMarkup(this._viewer),
this._measureManager.addMeasurement(this._measureMarkup));h=g.worldPosition.copy();this._viewer.sheetManager.isDrawingSheetActive()&&(h.z=0);0===c?(this._measureMarkup.setFirstPointPosition(h),this._measureMarkup.setUnitMultiplier(g.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(g.selectionItem.getNodeId()):1)):1===c&&(m=this._getFirstPickPosition(),g.worldPosition.equalsWithTolerance(m,1E-7)||(this._measureMarkup.setSecondPointPosition(h),this._measureMarkup.adjust(g.screenPosition)));
return[2]}})})};e.prototype._useSnapping=function(a){return this._cursor.snappingConfig.enabled&&!a.altDown()};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);var b=this._getStage();if(2>b){if(!this._cameraInteractionActive){b=c.getPosition();var d=this._getFirstPickPosition();this._cursor.updateCursorSprite(b,this._useSnapping(c),d)}}else 2===b&&(this._measureMarkup.adjust(c.getPosition()),c.setHandled(!0));this._draw()};e.prototype.onMouseUp=function(c){return __awaiter(this,
void 0,void 0,function(){var b,d,e,g;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive())return[3,4];b=this._getStage();d=null!==this._primaryTouchId&&null!==this._measureMarkup&&1<b;if(!(3>this._dragCount||d))return[3,4];e=this._useSnapping(c);g=c.getPosition();return 1>=b?[4,this._updateMeasurementPoints(g,e)]:[3,2];case 1:return f.sent(),[3,4];case 2:return[4,this._finalizeMeasurement(g,e)];case 3:f.sent(),f.label=4;case 4:return a.prototype.onMouseUp.call(this,c),[2]}})})};
e.prototype.onKeyUp=function(a){};e.prototype._clearMeasurement=function(){null!==this._measureMarkup?(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null):this._measureManager.removeLastMeasurement()};e.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};e.prototype.setHandled=function(){return 1<this._getStage()};e.prototype.onActivate=function(){this._cursor.onOperatorActivate()};e.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate();
null!==this._measureMarkup&&(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null)};return e}(h.OperatorBase);h.MeasurePointPointDistanceOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(a){a[a.First=0]="First";a[a.Last=1]="Last";a[a.Midpoint=2]="Midpoint"})(g=h.MeasurePolygonAreaAnchor||(h.MeasurePolygonAreaAnchor={}));var a=function(a){function c(b,c){var e=a.call(this,b)||this;e._markupItem=null;e._cameraInteractionActive=!1;e._textShapeOffset=new d.Point2(10,-25);e._anchor=g.Last;e._dragPlane=null;e._measureManager=c;e._cursor=new h.Common.PointCursor(e._viewer);e._viewer.setCallbacks({beginInteraction:function(){e._onBeginInteraction()},
endInteraction:function(){e._onEndInteraction()}});return e}__extends(c,a);c.prototype.getMarkupItem=function(){return this._markupItem};c.prototype.setAnchor=function(a){this._anchor=a};c.prototype._useSnapping=function(a){return this._cursor.snappingConfig.enabled&&!a.altDown()};c.prototype._getLastSelectedPoint=function(){return this._markupItem?this._markupItem.getLast():null};c.prototype._createNewMarkupItem=function(a){this._markupItem=new d.Markup.Measure.MeasurePolygonAreaMarkup(this._viewer);
this._markupItem.setUnitMultiplier(a.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(a.selectionItem.getNodeId()):1);this._markupItem.setName("MeasurePolygonAreaMarkup");this._measureManager.addMeasurement(this._markupItem);this._markupItem.addPoint(a.worldPosition)};c.prototype._updateMarkupItem=function(a,c){if(null!==this._markupItem&&null!=c.worldPosition){var b=this._markupItem.getPoints(),e=d.Point2.fromPoint3(this._viewer.view.projectPoint(b[0]));d.Point2.distance(e,
a)<this._markupItem.pointRadius?2<b.length&&this._finalizeMeasurement():this._markupItem.addPoint(c.worldPosition)&&this._updateAnchor(a,c.worldPosition)}};c.prototype._updateMeasurementItem=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(e){switch(e.label){case 0:return b=this._getLastSelectedPoint(),[4,this._cursor.getSelectionCursorPoints(a,c,b)];case 1:d=e.sent();if(null===d||null===d.worldPosition)return this._cursor.activateCursorSprite(!1),
[2];this._cursor.activateCursorSprite(!0);null===this._markupItem?this._createNewMarkupItem(d):this._updateMarkupItem(a,d);return[2]}})})};c.prototype._isDraggingText=function(){return null!==this._dragPlane};c.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);if(!this._markupItem){var c=b.getPosition();this._pickExisting(c)&&(this._dragPlane=this._calculateSelectionPlane(this._markupItem.leaderPosition),b.setHandled(!0))}};c.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,
b);if(this._isDraggingText())this._dragMarkupText(b),b.setHandled(!0);else if(!this._cameraInteractionActive){var c=this._getLastSelectedPoint();this._cursor.updateCursorSprite(b.getPosition(),this._useSnapping(b),c);this._draw()}};c.prototype.onMouseUp=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive())return[2];c=b.getPosition();if(!this._isDraggingText())return[3,1];this._dragPlane=this._markupItem=
null;return[3,3];case 1:if(!this._ptFirst.equals(c))return[3,3];d=this._useSnapping(b);e=c;return[4,this._updateMeasurementItem(e,d)];case 2:f.sent(),f.label=3;case 3:return a.prototype.onMouseUp.call(this,b),[2]}})})};c.prototype.onDoubleClick=function(a){this._finalizeMeasurement()};c.prototype._dragMarkupText=function(a){null!==this._markupItem&&null!==this._dragPlane&&(a=this._viewer.view.raycastFromPoint(a.getPosition()),this._dragPlane.intersectsRay(a,this._markupItem.textPosition),this._draw())};
c.prototype._finalizeMeasurement=function(){if(this._markupItem)if(this._markupItem.isValid()){var a=this._markupItem;this._markupItem=null;a.finalize();this._measureManager.finalizeMeasurement(a)}else this._clearMeasurement()};c.prototype._updateAnchor=function(a,c){if(this._markupItem){var b=this._markupItem.getPoints();if(1!==b.length)switch(this._anchor){case g.Last:this._calculateAnchorPos(a,c);break;case g.First:if(2!==b.length)break;c=this._viewer.view.projectPoint(b[0]);this._calculateAnchorPos(d.Point2.fromPoint3(c),
b[0]);break;case g.Midpoint:a=void 0;c=this._markupItem.getMeasurementValue()/2;for(var e=0,f=1;f<b.length;f++){var h=d.Point3.subtract(b[f],b[f-1]),p=h.length(),q=e+p;if(q>c){h.scale((c-e)/p);a=d.Point3.add(b[f-1],h);break}e=q}c=this._viewer.view.projectPoint(a);this._calculateAnchorPos(d.Point2.fromPoint3(c),a)}}};c.prototype._calculateSelectionPlane=function(a){var b=this._viewer.view.getCamera();b=d.Point3.subtract(b.getPosition(),a);b.normalize();return d.Plane.createFromPointAndNormal(a,b)};
c.prototype._calculateAnchorPos=function(a,c){var b=this._viewer.view.getCamera();d.Point3.subtract(b.getPosition(),c).normalize();b=this._calculateSelectionPlane(c);if(a=this._viewer.view.raycastFromPoint(d.Point2.add(a,this._textShapeOffset)))b.intersectsRay(a,this._markupItem.textPosition),this._markupItem.leaderPosition.assign(c)};c.prototype._clearMeasurement=function(){null!==this._markupItem?(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null):this._measureManager.removeLastMeasurement()};
c.prototype._draw=function(){this._viewer.markupManager.refreshMarkup()};c.prototype._pickExisting=function(a){return(a=this._viewer.markupManager.pickMarkupItem(a))&&"Communicator.Markup.Measure.MeasurePolygonAreaMarkup"===a.getClassName()?(this._markupItem=a,!0):!1};c.prototype.onActivate=function(){this._cursor.onOperatorActivate()};c.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate()};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};
c.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};c.prototype._onEndInteraction=function(){this._cameraInteractionActive=!1};return c}(h.OperatorBase);h.MeasurePolygonAreaOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(a){a[a.First=0]="First";a[a.Last=1]="Last";a[a.Midpoint=2]="Midpoint"})(g=h.MeasurePolylineDistanceAnchor||(h.MeasurePolylineDistanceAnchor={}));var a=function(a){function c(b,c){var e=a.call(this,b)||this;e._markupItem=null;e._cameraInteractionActive=!1;e._textShapeOffset=new d.Point2(10,-25);e._anchor=g.Last;e._dragPlane=null;e._measureManager=c;e._cursor=new h.Common.PointCursor(e._viewer);e._viewer.setCallbacks({beginInteraction:function(){e._onBeginInteraction()},
endInteraction:function(){e._onEndInteraction()}});return e}__extends(c,a);c.prototype.getMarkupItem=function(){return this._markupItem};c.prototype.setAnchor=function(a){this._anchor=a};c.prototype._useSnapping=function(a){return this._cursor.snappingConfig.enabled&&!a.altDown()};c.prototype._getLastSelectedPoint=function(){return this._markupItem?this._markupItem.getlast():null};c.prototype._createNewMarkupItem=function(a){this._markupItem=new d.Markup.Measure.MeasurePolylineDistanceMarkup(this._viewer);
this._markupItem.setUnitMultiplier(a.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(a.selectionItem.getNodeId()):1);this._markupItem.setName("MeasurePolylineDistanceMarkup");this._measureManager.addMeasurement(this._markupItem);this._markupItem.addPoint(a.worldPosition)};c.prototype._updateMarkupItem=function(a,c){if(null!==this._markupItem&&null!=c.worldPosition){var b=this._markupItem.getPoints(),e=d.Point2.fromPoint3(this._viewer.view.projectPoint(b[0]));d.Point2.distance(e,
a)<this._markupItem.pointRadius?2<b.length&&(this._markupItem.isLoop=!0,this._finalizeMeasurement()):(this._markupItem.addPoint(c.worldPosition),this._updateAnchor(a,c.worldPosition))}};c.prototype._updateMeasurementItem=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(e){switch(e.label){case 0:return b=this._getLastSelectedPoint(),[4,this._cursor.getSelectionCursorPoints(a,c,b)];case 1:d=e.sent();if(null===d||null===d.worldPosition)return this._cursor.activateCursorSprite(!1),
[2];this._cursor.activateCursorSprite(!0);null===this._markupItem?this._createNewMarkupItem(d):this._updateMarkupItem(a,d);return[2]}})})};c.prototype._isDraggingText=function(){return null!==this._dragPlane};c.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);if(!this._markupItem){var c=b.getPosition();this._pickExisting(c)&&(this._dragPlane=this._calculateSelectionPlane(this._markupItem.leaderPosition),b.setHandled(!0))}};c.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,
b);if(this._isDraggingText())this._dragMarkupText(b),b.setHandled(!0);else if(!this._cameraInteractionActive){var c=this._getLastSelectedPoint();this._cursor.updateCursorSprite(b.getPosition(),this._useSnapping(b),c);this._draw()}};c.prototype.onMouseUp=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive())return[2];c=b.getPosition();if(!this._isDraggingText())return[3,1];this._dragPlane=this._markupItem=
null;return[3,3];case 1:if(!this._ptFirst.equals(c))return[3,3];d=this._useSnapping(b);e=c;return[4,this._updateMeasurementItem(e,d)];case 2:f.sent(),f.label=3;case 3:return a.prototype.onMouseUp.call(this,b),[2]}})})};c.prototype.onDoubleClick=function(a){this._finalizeMeasurement()};c.prototype._dragMarkupText=function(a){null!==this._markupItem&&null!==this._dragPlane&&(a=this._viewer.view.raycastFromPoint(a.getPosition()),this._dragPlane.intersectsRay(a,this._markupItem.textPosition),this._draw())};
c.prototype._finalizeMeasurement=function(){if(this._markupItem)if(this._markupItem.isValid()){var a=this._markupItem;this._markupItem=null;a.finalize();this._measureManager.finalizeMeasurement(a)}else this._clearMeasurement()};c.prototype._updateAnchor=function(a,c){if(this._markupItem){var b=this._markupItem.getPoints();if(1!==b.length)switch(this._anchor){case g.Last:this._calculateAnchorPos(a,c);break;case g.First:if(2!==b.length)break;c=this._viewer.view.projectPoint(b[0]);this._calculateAnchorPos(d.Point2.fromPoint3(c),
b[0]);break;case g.Midpoint:a=void 0;c=this._markupItem.getMeasurementValue()/2;for(var e=0,f=1;f<b.length;f++){var h=d.Point3.subtract(b[f],b[f-1]),p=h.length(),q=e+p;if(q>c){h.scale((c-e)/p);a=d.Point3.add(b[f-1],h);break}e=q}c=this._viewer.view.projectPoint(a);this._calculateAnchorPos(d.Point2.fromPoint3(c),a)}}};c.prototype._calculateSelectionPlane=function(a){var b=this._viewer.view.getCamera();b=d.Point3.subtract(b.getPosition(),a);b.normalize();return d.Plane.createFromPointAndNormal(a,b)};
c.prototype._calculateAnchorPos=function(a,c){var b=this._viewer.view.getCamera();d.Point3.subtract(b.getPosition(),c).normalize();b=this._calculateSelectionPlane(c);if(a=this._viewer.view.raycastFromPoint(d.Point2.add(a,this._textShapeOffset)))b.intersectsRay(a,this._markupItem.textPosition),this._markupItem.leaderPosition.assign(c)};c.prototype._clearMeasurement=function(){null!==this._markupItem?(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null):this._measureManager.removeLastMeasurement()};
c.prototype._draw=function(){this._viewer.markupManager.refreshMarkup()};c.prototype._pickExisting=function(a){return(a=this._viewer.markupManager.pickMarkupItem(a))&&"Communicator.Markup.Measure.MeasurePolylineDistanceMarkup"===a.getClassName()?(this._markupItem=a,!0):!1};c.prototype.onActivate=function(){this._cursor.onOperatorActivate()};c.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate()};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};
c.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};c.prototype._onEndInteraction=function(){this._cameraInteractionActive=!1};return c}(h.OperatorBase);h.MeasurePolylineDistanceOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(a,b){var c=new d.Point4(b.x,b.y,b.z,1);b=new d.Point4(0,0,0,0);a.view.getFullCameraMatrix().transform4(c,b);c=1/b.w;b=new d.Point2(b.x*c,b.y*c);c=a.view.getCanvasSize();a=c.x;c=c.y;b.x=.5*a*(b.x+1);b.y=.5*c*(b.y+1);b.x=Math.max(0,Math.min(b.x,a));b.y=c-Math.max(0,Math.min(b.y,c));return b}g.worldPointToScreenPoint=a;var e=function(){return function(a,b,c){this.worldPosition=a;this.screenPosition=b;this.selectionItem=c}}();g.SelectionPoints=e;var c=
function(a){function b(b){var c=a.call(this,b)||this;c._cursorSprite=new d.Markup.Shape.Circle;c._name="CursorMarkup";var e=b.measureManager.getMeasurementColor();c._cursorSprite.setFillColor(e);c._cursorSprite.setStrokeColor(e);c._cursorSprite.setRadius(0);c._markupId=b.markupManager.registerMarkup(c);return c}__extends(b,a);b.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawCircle(this._cursorSprite)};b.prototype.enable=function(a){this._cursorSprite.setRadius(a?2.5:0)};b.prototype.isEnabled=
function(){return 0<this._cursorSprite.getRadius()};b.prototype.setPosition=function(a){this._cursorSprite.setCenter(a)};b.prototype.destroy=function(){this._viewer.markupManager.unregisterMarkup(this._markupId)};return b}(d.Markup.Measure.MeasureMarkup),b=function(){function b(a){this._cursorMarkup=null;this._updateCursorSpriteAction=new d.Util.CurrentAction(!0);this._viewer=a;this.snappingConfig={enabled:!0,preferVertices:!0}}b.prototype.getSelectionCursorPoints=function(b,c,f){return __awaiter(this,
void 0,void 0,function(){var g,h,k,l,n,u,w,v;return __generator(this,function(m){switch(m.label){case 0:return g=new d.PickConfig(c?d.SelectionMask.All:d.SelectionMask.Face),c&&(g.enableProximityFaces=!0,g.restrictLinesAndPointsToSelectedFaceInstances=!1),[4,this._viewer.view.pickFromPoint(b,g)];case 1:h=m.sent();if(0!==h.overlayIndex())return[2,null];k=h.getPosition();l=b;this.snappingConfig.enabled&&(n=h.getLineEntity(),u=h.getPointEntity(),w=h.getFaceEntity(),n||u||w)&&(v=null,null!==n?v=this._getLineSnapPoint(n,
c,f):null!==u?v=u.getPosition():null!==w&&w.isProximityFace()&&(v=w.getPosition()),null!==v&&(k=v,l=a(this._viewer,k)));return[2,new e(k,l,h)]}})})};b.prototype.updateCursorSprite=function(a,b,c){var d=this;this._updateCursorSpriteAction.set(function(){return d._updateCursorSpriteImpl(a,b,c)})};b.prototype._updateCursorSpriteImpl=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return null===this._cursorMarkup?[3,3]:b?
[4,this.getSelectionCursorPoints(a,b,c)]:[3,2];case 1:return d=e.sent(),null!==d?(this._cursorMarkup.setPosition(d.screenPosition),this.activateCursorSprite(!0)):this.activateCursorSprite(!1),[3,3];case 2:this._cursorMarkup.setPosition(a),e.label=3;case 3:return[2]}})})};b.prototype.draw=function(){null!==this._cursorMarkup&&this._cursorMarkup.draw()};b.prototype.activateCursorSprite=function(a){null!==this._cursorMarkup&&this._cursorMarkup.enable(a)};b.prototype._getLineSnapPoint=function(b,c,e){var f=
this.snappingConfig.preferVertices?b.getBestVertex():null;if(null!==f)return f;f=b.getPosition();if(!c||null==e)return f;b=b.getPoints();a:{for(c=0;c<b.length-1;c++)if(d.Util.isPointOnLineSegment(b[c],b[c+1],f,1E-10)){var g=c;break a}g=0}c=b[g];b=b[g+1];if(void 0===c||void 0===b)return f;e=d.Util.closestPointFromPointToSegment(c,b,e);b=a(this._viewer,e);c=a(this._viewer,f);b=d.Point2.subtract(b,c).squaredLength();c=this._viewer.selectionManager.getPickTolerance();return b<=c*c?e:f};b.prototype._clearCursorMarkup=
function(){null!==this._cursorMarkup&&(this._cursorMarkup.destroy(),this._cursorMarkup=null)};b.prototype.onOperatorActivate=function(){this._clearCursorMarkup();this._cursorMarkup=new c(this._viewer);this._viewer.sheetManager.isDrawingSheetActive()&&this._viewer.sheetManager.setBackgroundSelectionEnabled(!0)};b.prototype.onOperatorDeactivate=function(){this._clearCursorMarkup();this._viewer.sheetManager.isDrawingSheetActive()&&this._viewer.sheetManager.setBackgroundSelectionEnabled(!1)};return b}();
g.PointCursor=b})(h.Common||(h.Common={}))})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){var h=function(g){function a(a){var c=g.call(this,a)||this;c._activeRedlineItem=null;c._newRedlineItem=null;c._viewer=a;return c}__extends(a,g);a.prototype.createRedlineItem=function(a){a;return null};a.prototype.updateRedlineItem=function(a){a};a.prototype.finalizeRedlineItem=function(a){a;return null};a.prototype.onMouseDown=function(a){g.prototype.onMouseDown.call(this,a);this.isActive()&&(a.getButton()!==d.Button.Left&&null===this._primaryTouchId||this._redlineOperatorStart(),a.setHandled(!0))};
a.prototype.onMouseMove=function(a){g.prototype.onMouseMove.call(this,a);this.isActive()&&(this._redlineOperatorMove(),a.setHandled(!0))};a.prototype.onMouseUp=function(a){this.isActive()&&(a.getButton()!==d.Button.Left&&null===this._primaryTouchId||this._redlineOperatorEnd(),a.setHandled(!0));g.prototype.onMouseUp.call(this,a)};a.prototype.onMousewheel=function(a){a.setHandled(!0)};a.prototype.setDraggingEnabled=function(a){this._dragging=a};a.prototype.setHandled=function(){return!0};a.prototype._isRedlineItem=
function(a){return Object.getPrototypeOf(a)instanceof d.Markup.Redline.RedlineItem};a.prototype.onKeyUp=function(a){a=a.getKeyCode();if(a===d.KeyCode.Backspace||a===d.KeyCode.Delete){a=this._viewer.markupManager;var c=a.getSelectedMarkup(),b=a.getActiveMarkupView();null!==c&&this._isRedlineItem(c)&&null!==b&&(b.removeMarkup(c),a.selectMarkup(null))}};a.prototype._removeRedlineTextIfInvalid=function(a){if(!a.isValid()){var c=this._viewer.markupManager.getActiveMarkupView();null!==c&&(c.removeMarkup(a),
this._viewer.trigger("redlineDeleted",a));a.remove()}};a.prototype._redlineOperatorStart=function(){var a=this._viewer.markupManager,c=a.pickMarkupItem(this._ptFirst),b=a.getSelectedMarkup();if(c)this._activeRedlineItem=c,this._dragging&&this._activeRedlineItem.onDragStart(this._ptFirst)&&a.refreshMarkup();else{if(null!=b)b.onDeselect();a.selectMarkup(null);this._markupIsTextArea(b)?this._removeRedlineTextIfInvalid(b):this._newRedlineItem=this.createRedlineItem(this._ptFirst)}};a.prototype._redlineOperatorMove=
function(){this._activeRedlineItem?this._dragging&&this._activeRedlineItem.onDragMove(this._ptCurrent)&&this._viewer.markupManager.refreshMarkup():this.updateRedlineItem(this._ptCurrent)};a.prototype._redlineOperatorEnd=function(){var a=this._viewer.markupManager;this._activeRedlineItem?this._ptFirst.equals(this._ptCurrent)?a.selectMarkup(this._activeRedlineItem):(this._viewer.trigger("redlineUpdated",this._activeRedlineItem),this._dragging&&this._activeRedlineItem.onDragEnd(this._ptCurrent)&&a.refreshMarkup()):
this._newRedlineItem&&(a=this.finalizeRedlineItem(this._ptCurrent))&&this._attachNewMarkupToView(a);this._newRedlineItem=this._activeRedlineItem=null};a.prototype._attachNewMarkupToView=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,e,g,h,n,m,p,q;return __generator(this,function(f){switch(f.label){case 0:c=this._viewer;b=c.model;e=c.markupManager;g=e.getActiveMarkupView();h=!1;if(null!==g)return[3,3];n=b.getAbsoluteRootNode();return[4,b.getVisibilityState(n)];case 1:return m=f.sent(),
[4,b.getNodeColorMap(b.getAbsoluteRootNode(),d.ElementType.Faces)];case 2:p=f.sent(),q=e.createMarkupView(void 0,!1,m,p,null),g=e.getMarkupView(q),h=!0,f.label=3;case 3:return null!==g&&(g.addMarkupItem(a),e.selectMarkup(a)),h&&null!==g&&this._viewer.trigger("viewCreated",g),this._viewer.trigger("redlineCreated",a),[2]}})})};a.prototype._markupIsTextArea=function(a){return a?a.getClassName()===d.Markup.Redline.RedlineText.className:!1};return a}(d.Operator.OperatorBase);d.RedlineOperator=h})(Communicator||
(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._redlineCircle=null;c._previewHandle=null;c._centerSet=!1;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){var b=this._viewer.view;this._redlineCircle=new d.Markup.Redline.RedlineCircle(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineCircle);a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(this._centerSet=!0,this._redlineCircle.setCenter(a),this._redlineCircle.setRadiusPoint(a));
return this._redlineCircle};e.prototype.updateRedlineItem=function(a){var b=this._viewer.view;this._redlineCircle&&(a=b.getCamera().getCameraPlaneIntersectionPoint(a,b),null!==a&&(this._centerSet||(this._centerSet=!0,this._redlineCircle.setCenter(a)),this._redlineCircle.setRadiusPoint(a),this._viewer.markupManager.refreshMarkup()))};e.prototype.finalizeRedlineItem=function(a){a=this._viewer.markupManager;var b=null;this._redlineCircle&&(this._redlineCircle.isValid()&&(b=this._redlineCircle),this._redlineCircle=
null,null!==this._previewHandle&&(a.unregisterMarkup(this._previewHandle),this._previewHandle=null),a.refreshMarkup());return b};return e}(d.RedlineOperator);h.RedlineCircleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._redlinePolyline=null;c._previewHandle=null;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){var b=this._viewer.view;this._redlinePolyline=new d.Markup.Redline.RedlinePolyline(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlinePolyline);a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._redlinePolyline.addPoint(a);return this._redlinePolyline};
e.prototype.updateRedlineItem=function(a){if(this._redlinePolyline){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(this._redlinePolyline.addPoint(a),this._viewer.markupManager.refreshMarkup())}};e.prototype.finalizeRedlineItem=function(a){a=this._viewer.markupManager;var b=null;this._redlinePolyline&&(this._redlinePolyline.isValid()&&(b=this._redlinePolyline),this._redlinePolyline=null,null!==this._previewHandle&&(a.unregisterMarkup(this._previewHandle),this._previewHandle=
null),a.refreshMarkup());return b};return e}(d.RedlineOperator);h.RedlinePolylineOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._redlineRectangle=null;c._previewHandle=null;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);this._redlineRectangle=new d.Markup.Redline.RedlineRectangle(this._viewer);null!==a&&(this._redlineRectangle.setPoint1(a),this._redlineRectangle.setPoint2(a));this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineRectangle);
return this._redlineRectangle};e.prototype.updateRedlineItem=function(a){if(this._redlineRectangle){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._redlineRectangle.setPoint2(a);this._viewer.markupManager.refreshMarkup()}};e.prototype.finalizeRedlineItem=function(a){a=null;if(this._redlineRectangle&&this._previewHandle){var b=this._viewer.markupManager;this._redlineRectangle.isValid()&&(a=this._redlineRectangle);b.unregisterMarkup(this._previewHandle);
this._redlineRectangle=this._previewHandle=null;b.refreshMarkup()}return a};return e}(d.RedlineOperator);h.RedlineRectangleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._redlineText=null;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){return this._redlineText=new d.Markup.Redline.RedlineText(this._viewer)};e.prototype.finalizeRedlineItem=function(a){if(null===this._redlineText)return null;var b=this._viewer.view,c=this._redlineText;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&c.setPosition(a);this._redlineText=null;return c};return e}(d.RedlineOperator);
h.RedlineTextOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));

/*! promise-polyfill 2.1.0 */
!function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void j(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(d){f.call(this,d)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;b>a;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var j="function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&k(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})},c._setImmediateFn=function(a){j=a},"undefined"!=typeof module&&module.exports?module.exports=c:a.Promise||(a.Promise=c)}(this);
/*!
 * Bowser - a browser detector
 * https://github.com/ded/bowser
 * MIT License | (c) Dustin Diaz 2015
 */
!function(e,t,n){e[t]=n()}(this,"bowser",function(){function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}function r(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}var i=n(/(ipod|iphone|ipad)/i).toLowerCase(),s=/like android/i.test(t),o=!s&&/android/i.test(t),u=/nexus\s*[0-6]\s*/i.test(t),a=!u&&/nexus\s*[0-9]+/i.test(t),f=/CrOS/.test(t),l=/silk/i.test(t),c=/sailfish/i.test(t),h=/tizen/i.test(t),p=/(web|hpw)os/i.test(t),d=/windows phone/i.test(t),v=/SamsungBrowser/i.test(t),m=!d&&/windows/i.test(t),g=!i&&!l&&/macintosh/i.test(t),y=!o&&!c&&!h&&!p&&/linux/i.test(t),b=n(/edge\/(\d+(\.\d+)?)/i),w=n(/version\/(\d+(\.\d+)?)/i),E=/tablet/i.test(t),S=!E&&/[^-]mobi/i.test(t),x=/xbox/i.test(t),T;/opera/i.test(t)?T={name:"Opera",opera:e,version:w||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr|opios/i.test(t)?T={name:"Opera",opera:e,version:n(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||w}:/SamsungBrowser/i.test(t)?T={name:"Samsung Internet for Android",samsungBrowser:e,version:w||n(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?T={name:"Opera Coast",coast:e,version:w||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?T={name:"Yandex Browser",yandexbrowser:e,version:w||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?T={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?T={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?T={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?T={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?T={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?T={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:d?(T={name:"Windows Phone",windowsphone:e},b?(T.msedge=e,T.version=b):(T.msie=e,T.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?T={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:f?T={name:"Chrome",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?T={name:"Microsoft Edge",msedge:e,version:b}:/vivaldi/i.test(t)?T={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||w}:c?T={name:"Sailfish",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?T={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(T={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(T.firefoxos=e)):l?T={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?T={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?T={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?T={name:"BlackBerry",blackberry:e,version:w||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:p?(T={name:"WebOS",webos:e,version:w||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(T.touchpad=e)):/bada/i.test(t)?T={name:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:h?T={name:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||w}:/qupzilla/i.test(t)?T={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||w}:/chromium/i.test(t)?T={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||w}:/chrome|crios|crmo/i.test(t)?T={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?T={name:"Android",version:w}:/safari|applewebkit/i.test(t)?(T={name:"Safari",safari:e},w&&(T.version=w)):i?(T={name:i=="iphone"?"iPhone":i=="ipad"?"iPad":"iPod"},w&&(T.version=w)):/googlebot/i.test(t)?T={name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||w}:T={name:n(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!T.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(T.name=T.name||"Blink",T.blink=e):(T.name=T.name||"Webkit",T.webkit=e),!T.version&&w&&(T.version=w)):!T.opera&&/gecko\//i.test(t)&&(T.name=T.name||"Gecko",T.gecko=e,T.version=T.version||n(/gecko\/(\d+(\.\d+)?)/i)),!T.windowsphone&&!T.msedge&&(o||T.silk)?T.android=e:!T.windowsphone&&!T.msedge&&i?(T[i]=e,T.ios=e):g?T.mac=e:x?T.xbox=e:m?T.windows=e:y&&(T.linux=e);var N="";T.windowsphone?N=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i?(N=n(/os (\d+([_\s]\d+)*) like mac os x/i),N=N.replace(/[_\s]/g,".")):o?N=n(/android[ \/-](\d+(\.\d+)*)/i):T.webos?N=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):T.blackberry?N=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):T.bada?N=n(/bada\/(\d+(\.\d+)*)/i):T.tizen&&(N=n(/tizen[\/\s](\d+(\.\d+)*)/i)),N&&(T.osversion=N);var C=N.split(".")[0];if(E||a||i=="ipad"||o&&(C==3||C>=4&&!S)||T.silk)T.tablet=e;else if(S||i=="iphone"||i=="ipod"||o||u||T.blackberry||T.webos||T.bada)T.mobile=e;return T.msedge||T.msie&&T.version>=10||T.yandexbrowser&&T.version>=15||T.vivaldi&&T.version>=1||T.chrome&&T.version>=20||T.samsungBrowser&&T.version>=4||T.firefox&&T.version>=20||T.safari&&T.version>=6||T.opera&&T.version>=10||T.ios&&T.osversion&&T.osversion.split(".")[0]>=6||T.blackberry&&T.version>=10.1||T.chromium&&T.version>=20?T.a=e:T.msie&&T.version<10||T.chrome&&T.version<20||T.firefox&&T.version<20||T.safari&&T.version<6||T.opera&&T.version<10||T.ios&&T.osversion&&T.osversion.split(".")[0]<6||T.chromium&&T.version<20?T.c=e:T.x=e,T}function r(e){return e.split(".").length}function i(e,t){var n=[],r;if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function s(e){var t=Math.max(r(e[0]),r(e[1])),n=i(e,function(e){var n=t-r(e);return e+=(new Array(n+1)).join(".0"),i(e.split("."),function(e){return(new Array(20-e.length)).join("0")+e}).reverse()});while(--t>=0){if(n[0][t]>n[1][t])return 1;if(n[0][t]!==n[1][t])return-1;if(t===0)return 0}}function o(e,r,i){var o=n;typeof r=="string"&&(i=r,r=void 0),r===void 0&&(r=!1),i&&(o=t(i));var u=""+o.version;for(var a in e)if(e.hasOwnProperty(a)&&o[a]){if(typeof e[a]!="string")throw new Error("Browser version in the minVersion map should be a string: "+a+": "+String(e));return s([u,e[a]])<0}return r}function u(e,t,n){return!o(e,t,n)}var e=!0,n=t(typeof navigator!="undefined"?navigator.userAgent||"":"");return n.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if(typeof r=="string"&&r in n)return!0}return!1},n.isUnsupportedBrowser=o,n.compareVersions=s,n.check=u,n._detect=t,n})
var _SC = (function () {
	var createInstanceImpl = function () {
		var Module = this;

function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function da(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}}function ha(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}
var ma=ha(this),na="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function sa(a,b){if(b)a:{var c=ma;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&na(c,a,{configurable:!0,writable:!0,value:b})}}
sa("Promise",function(a){function b(k){this.si=0;this.Ei=void 0;this.gi=[];this.ck=!1;var m=this.Ui();try{k(m.resolve,m.reject)}catch(p){m.reject(p)}}function c(){this.gi=null}function d(k){return k instanceof b?k:new b(function(m){m(k)})}if(a)return a;c.prototype.si=function(k){if(null==this.gi){this.gi=[];var m=this;this.Ei(function(){m.Vi()})}this.gi.push(k)};var e=ma.setTimeout;c.prototype.Ei=function(k){e(k,0)};c.prototype.Vi=function(){for(;this.gi&&this.gi.length;){var k=this.gi;this.gi=[];
for(var m=0;m<k.length;++m){var p=k[m];k[m]=null;try{p()}catch(u){this.Ui(u)}}}this.gi=null};c.prototype.Ui=function(k){this.Ei(function(){throw k;})};b.prototype.Ui=function(){function k(u){return function(v){p||(p=!0,u.call(m,v))}}var m=this,p=!1;return{resolve:k(this.Pk),reject:k(this.Vi)}};b.prototype.Pk=function(k){if(k===this)this.Vi(new TypeError("A Promise cannot resolve to itself"));else if(k instanceof b)this.Sk(k);else{a:switch(typeof k){case "object":var m=null!=k;break a;case "function":m=
!0;break a;default:m=!1}m?this.Nk(k):this.bk(k)}};b.prototype.Nk=function(k){var m=void 0;try{m=k.then}catch(p){this.Vi(p);return}"function"==typeof m?this.Xk(m,k):this.bk(k)};b.prototype.Vi=function(k){this.ek(2,k)};b.prototype.bk=function(k){this.ek(1,k)};b.prototype.ek=function(k,m){if(0!=this.si)throw Error("Cannot settle("+k+", "+m+"): Promise already settled in state"+this.si);this.si=k;this.Ei=m;2===this.si&&this.Rk();this.Kk()};b.prototype.Rk=function(){var k=this;e(function(){if(k.Mk()){var m=
ma.console;"undefined"!==typeof m&&m.error(k.Ei)}},1)};b.prototype.Mk=function(){if(this.ck)return!1;var k=ma.CustomEvent,m=ma.Event,p=ma.dispatchEvent;if("undefined"===typeof p)return!0;"function"===typeof k?k=new k("unhandledrejection",{cancelable:!0}):"function"===typeof m?k=new m("unhandledrejection",{cancelable:!0}):(k=ma.document.createEvent("CustomEvent"),k.initCustomEvent("unhandledrejection",!1,!0,k));k.promise=this;k.reason=this.Ei;return p(k)};b.prototype.Kk=function(){if(null!=this.gi){for(var k=
0;k<this.gi.length;++k)f.si(this.gi[k]);this.gi=null}};var f=new c;b.prototype.Sk=function(k){var m=this.Ui();k.cj(m.resolve,m.reject)};b.prototype.Xk=function(k,m){var p=this.Ui();try{k.call(m,p.resolve,p.reject)}catch(u){p.reject(u)}};b.prototype.then=function(k,m){function p(D,q){return"function"==typeof D?function(y){try{u(D(y))}catch(F){v(F)}}:q}var u,v,C=new b(function(D,q){u=D;v=q});this.cj(p(k,u),p(m,v));return C};b.prototype.catch=function(k){return this.then(void 0,k)};b.prototype.cj=function(k,
m){function p(){switch(u.si){case 1:k(u.Ei);break;case 2:m(u.Ei);break;default:throw Error("Unexpected state: "+u.si);}}var u=this;null==this.gi?f.si(p):this.gi.push(p);this.ck=!0};b.resolve=d;b.reject=function(k){return new b(function(m,p){p(k)})};b.race=function(k){return new b(function(m,p){for(var u=da(k),v=u.next();!v.done;v=u.next())d(v.value).cj(m,p)})};b.all=function(k){var m=da(k),p=m.next();return p.done?d([]):new b(function(u,v){function C(y){return function(F){D[y]=F;q--;0==q&&u(D)}}var D=
[],q=0;do D.push(void 0),q++,d(p.value).cj(C(D.length-1),v),p=m.next();while(!p.done)})};return b});var va="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a};sa("Object.assign",function(a){return a||va});
function wa(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""}sa("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=wa(this,b,"startsWith"),e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var k=0;k<f&&c<e;)if(d[c++]!=b[k++])return!1;return k>=f}});
sa("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,k){this.gi=f;na(this,"description",{configurable:!0,writable:!0,value:k})}if(a)return a;c.prototype.toString=function(){return this.gi};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b});
sa("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=ma[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&na(d.prototype,a,{configurable:!0,writable:!0,value:function(){return Aa(aa(this))}})}return a});function Aa(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
function Ea(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}sa("Array.prototype.keys",function(a){return a?a:function(){return Ea(this,function(b){return b})}});sa("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}});
sa("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}});sa("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==wa(this,b,"includes").indexOf(b,c||0)}});sa("Array.prototype.values",function(a){return a?a:function(){return Ea(this,function(b,c){return c})}});
sa("Math.fround",function(a){if(a)return a;if("function"!==typeof Float32Array)return function(c){return c};var b=new Float32Array(1);return function(c){b[0]=c;return b[0]}});sa("Math.clz32",function(a){return a?a:function(b){b=Number(b)>>>0;if(0===b)return 32;var c=0;0===(b&4294901760)&&(b<<=16,c+=16);0===(b&4278190080)&&(b<<=8,c+=8);0===(b&4026531840)&&(b<<=4,c+=4);0===(b&3221225472)&&(b<<=2,c+=2);0===(b&2147483648)&&c++;return c}});var g;g||(g=typeof Module !== 'undefined' ? Module : {});
"undefined"==typeof Object.assign&&(Object.assign=function(a,b){for(var c=1;c<arguments.length;c++)if(b=arguments[c])for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a});g.$$setReady=function(){g.pk();g.$$onReady.apply(window,arguments);g.$$onReady=void 0;g.onAbort=void 0};
g.pk=function(){function a(G){if(!G)return 0;var A=g.$$es.allocateUint8Buffer(8*G.length);if(A)Fa.set(G,A>>3);else throw Error("Out of memory.");return A}function b(G){if(!G)return 0;var A=g.$$es.allocateUint8Buffer(4*G.length);if(A)h.set(G,A>>2);else throw Error("Out of memory.");return A}function c(G){if(!G)return 0;var A=g.$$es.allocateUint8Buffer(G.length);if(A)t.set(G,A);else throw Error("Out of memory.");return A}function d(G){g.$$es.deallocateUint8Buffer(G)}function e(G){return function(){return m(G,
arguments)}}function f(G,A,U){function K(xa){return function(){D();R&&y.callRecord.push(xa+" "+v(arguments));return k(this,g[G][xa],arguments)}}function ja(){D();this.$$memory=new Uint8Array(g[G]["sizeof_"+A]());k(this,g[G][W+"create"],arguments)}var W=A+"_";ja.prototype={$$stackify:!0};ja.copy=function(xa){D();var Ba=Object.create(ja.prototype);Ba.$$memory=new Uint8Array(t.subarray(xa,xa+g[G]["sizeof_"+A]()));return Ba};ja.clone=function(xa){var Ba=Object.create(ja.prototype);Ba.$$memory=new Uint8Array(xa.$$memory);
return Ba};ja.assign=function(xa,Ba){xa.$$memory.set(Ba.$$memory)};for(var ta=0;ta<U.length;ta++)ja.prototype[U[ta]]=K(W+U[ta]);return y[A]=ja}function k(G,A,U){U=Array.prototype.slice.call(U);U.unshift(G);return m(A,U)}function m(G,A){for(var U=!1,K=0;K<A.length;++K)if(A[K].$$stackify){U=!0;break}if(!U)return G.apply(g,A);U=Ga();try{var ja=Array.prototype.slice.call(A);for(K=0;K<A.length;K++)if(A[K].$$stackify){var W=Ka(A[K].$$memory.length);t.set(A[K].$$memory,W);ja[K]=W}var ta=G.apply(g,ja);for(K=
0;K<A.length;K++)A[K].$$stackify&&A[K].$$memory.set(t.subarray(ja[K],ja[K]+A[K].$$memory.length))}finally{La(U)}return ta}function p(G){this.value=G}function u(){y.suspendDrawing();g.hi("webgl_context_lost")}function v(){return JSON.stringify(arguments,C)}function C(G,A){return null!==A&&"object"===typeof A&&A.$$memory?"stackified":A}function D(){if(y!==g.$$facade)throw new ReferenceError("member called after shutdown");}var q="$$cs";g.$$es.initializeLibrary();var y=g.$$facade,F=g.Pj?new g.Pj:void 0;
g.tj=F;y.isValid=function(){return y===g.$$facade};var R=!1;y.callRecord=[];y.startRecording=function(){R=!0};y.stopRecording=function(){R=!1};y.logCallRecord=function(){for(var G=y.callRecord,A=0;A<G.length;++A)console.log(G[A])};y.shutDown=function(){D();R&&y.callRecord.push("shutDown");"$$cs"===q&&g.canvas.removeEventListener("webglcontextlost",u);g.$$es.shutDownLibrary();F&&F.gl();y.container.innerHTML="";g.$$facade=void 0;g.tj=void 0;g.$$available=!0;g.$$wrapper.innerHTML=""};y.ByMeshInstance=
new p(0);y.ByGroup=new p(1);y.ByExpandedGroup=new p(2);(function(){function G(n,r){K([H.Scs]);if(!n)throw new W("InvalidConfig","Invalid load configuration");var w,x,z=new Promise(function(X,ca){w=X;x=ca});ua=H.Scs;var L=new XMLHttpRequest;L.open("GET",r);L.responseType="arraybuffer";L.onload=function(){try{A(n,new Uint8Array(this.response)).then(function(X){w(X)},function(X){x(X)})}catch(X){}};"function"===typeof n.XHRonprogress&&(L.onprogress=n.XHRonprogress);"function"===typeof n.XHRonerror&&(L.onerror=
n.XHRonerror);if("function"===typeof n.XHRonloadend){var fa=n.XHRonloadend;L.onloadend=function(X){fa(X,L.status,r)}}L.send();return z}function A(n,r){K([H.Scs]);if(!n)throw new W("InvalidConfig","Invalid load configuration");if(r.constructor!==Uint8Array)throw new W("InvalidConfig","'buffer' must be a Uint8Array");if(0>=r.byteLength)throw new W("EmptyBuffer","'buffer' has a length of 0");var w=g.$$es.allocateUint8Buffer(r.byteLength);t.set(r,w);try{return U(n,w,r.byteLength)}catch(x){throw g.$$es.deallocateUint8Buffer(w),
x;}}function U(n,r,w){K([H.Scs]);var x=n.attachScope,z=n.attachMeasurementUnit,L=n.attachInvisibly,fa=n.resolveOnFullyLoaded,X=n.inclusionMatrix;n=0;if(X){if(X.constructor!==Array&&X.constructor!==Float64Array)throw new TypeError("'inclusionMatrix' is not an Array or Float64Array.");if(12!==X.length)throw new TypeError("'inclusionMatrix' needs to have exactly 12 elements.");n=a(X);if(!n)throw Error("Internal logic error.");}ua=H.Scs;var ca,za;X=new Promise(function(qa,ya){ca=qa;za=function(Ha){try{ja(Ha),
ya(null)}catch(Ia){ya(Ia)}}});try{g.$$es.attachScsBuffer(x,r,w,n,z,L,fa,ca,za)}catch(qa){za(qa)}finally{d(n)}return X}function K(n){if(ua!==H.Uninitialized){if(void 0!==n)for(var r=0;r<n.length;++r)if(ua===n[r])return;throw new W("AlreadyCalled","load() already called with an incompatible session type");}}function ja(n){switch(n){case g.LoadResult.WebGLMissing:throw new W("WebGLError","WebGL initialization failed");case g.LoadResult.SessionAlreadyStarted:throw new W("AlreadyCalled","load() already called");
}}function W(n,r){this.code=n;this.message=r;this.stack=Error().stack}function ta(n){var r=JSON.parse(Ma(n,0));if("rpc"in r){if(n=r.rpc,r=n.length/2,r===Math.floor(r)){for(var w=new Uint8Array(r),x=0;x<r;++x)w[x]=parseInt(n.substr(x+x,2),16);n=w;r=(new DataView(n.buffer)).getUint32(0,!0);w=n[4];n=n.subarray(5);x=c(n);g[q].notifyRpcClientResult(r,w,x,n.length)}}else if("event"in r)switch(n=r.event,r=r.data,n){case "camera_set":Qb=Cb(r);g.hi(n);break;default:Array.isArray(r)?(r.unshift(n),g.hi.apply(g,
r)):g.hi(n,r)}}function xa(n){var r=c(n);g.$$es.parseMetaData(Rb,r,n.length)}function Ba(n){n=Ma(n,0);g.hi("post_draw_json",n)}function Cb(n){var r=new Ca;r.reset.apply(r,n);return r}function Sb(n){function r(pa,O,ea,la){if(0>la||la>=O.elementCount)throw new RangeError("invalid element index");var Da={vertexCount:fa[pa][3*la+1],bits:fa[pa][3*la+2],iterate:function(hb){return x(pa,O,ea,la,this,hb)}};"undefined"!==typeof Symbol&&"undefined"!==typeof Symbol.iterator&&(Da[Symbol.iterator]=w);return Da}
function w(){return this.iterate(!0)}function x(pa,O,ea,la,Da,hb){function we(){var ra={position:void 0,normal:void 0,UV:void 0,RGBA:void 0};++Wa;for(var ka=0;ka<ib.length;++ka)ib[ka](ra);return ra}if("number"===typeof la)var Nc=ea+fa[pa][3*la],Oc=Da.vertexCount;else Nc=ea,Oc=O.vertexCount;var Ad=Nc+Oc,Wa=Nc,ib=[];ca?ib.push(function(ra){var ka=[z[Ja],z[Ja+1],z[Ja+2]];ra.position=[ca[0]*ka[0]+ca[4]*ka[1]+ca[8]*ka[2]+ca[12],ca[1]*ka[0]+ca[5]*ka[1]+ca[9]*ka[2]+ca[13],ca[2]*ka[0]+ca[6]*ka[1]+ca[10]*
ka[2]+ca[14]]}):ib.push(function(ra){ra.position=[z[Ja],z[Ja+1],z[Ja+2]]});O.hasNormals&&ib.push(function(ra){var ka=Ja+za;ra.normal=[z[ka],z[ka+1],z[ka+2]]});O.hasUVs&&ib.push(function(ra){var ka=Ja+qa;ra.UV=[z[ka],z[ka+1]]});if(O.hasRGBAs){var Pc=new Uint8Array(z.buffer);ib.push(function(ra){var ka=Ja+ya<<2;ra.RGBA=[Pc[ka],Pc[ka+1],Pc[ka+2],Pc[ka+3]]})}if(L){var Ja=L[Wa]*X;ib.push(function(){Ja=L[Wa]*X})}else Ja=Wa*X,ib.push(function(){Ja+=X});return{done:function(){return Wa>=Ad},next:hb?function(){return Wa<
Ad?{value:we(),done:!1}:{done:!0}}:function(){if(Wa<Ad)return we()},goTo:function(ra){0>ra?ra=0:ra>=Oc&&(ra=Oc);Wa=Nc+ra;Ja=L?L[Wa]*X:Wa*X}}}var z=n.vertices,L=n.indices,fa=n.elements,X=n.stride,ca=n.duplicateMatrix,za=n.normalOffset,qa=n.UVOffset,ya=n.RGBA32Offset,Ha=n.faceVertexCount,Ia=Ha+n.lineVertexCount,Xa={faces:{vertexCount:n.faceVertexCount,hasNormals:n.faceNormals?!0:!1,hasUVs:n.faceUVs?!0:!1,hasRGBAs:n.faceRGBA32s?!0:!1,elementCount:fa[0]?fa[0].length/3:0,iterate:function(pa){return x(0,
this,0,void 0,void 0,pa)},element:function(pa){return r(0,this,0,pa)}},lines:{vertexCount:n.lineVertexCount,hasNormals:n.lineNormals?!0:!1,hasUVs:n.lineUVs?!0:!1,hasRGBAs:n.lineRGBA32s?!0:!1,elementCount:fa[1]?fa[1].length/3:0,iterate:function(pa){return x(1,this,Ha,void 0,void 0,pa)},element:function(pa){return r(1,this,Ha,pa)}},points:{vertexCount:n.pointVertexCount,hasNormals:n.pointNormals?!0:!1,hasUVs:n.pointUVs?!0:!1,hasRGBAs:n.pointRGBA32s?!0:!1,elementCount:fa[2]?fa[2].length/3:0,iterate:function(pa){return x(2,
this,Ia,void 0,void 0,pa)},element:function(pa){return r(2,this,Ia,pa)}}};"undefined"!==typeof Symbol&&"undefined"!==typeof Symbol.iterator&&(Xa.faces[Symbol.iterator]=w,Xa.lines[Symbol.iterator]=w,Xa.points[Symbol.iterator]=w);n=n.forward;for(var sb in n)n.hasOwnProperty(sb)&&(Xa[sb]=n[sb]);return Xa}function Rb(n,r,w){var x=Ya[n];x||(x=Ya[n]={});x[r]=w;g.hi("meta_data",n,r,w)}function oa(n,r){if("$$cs"===q)return Z.getMetaData(n);Za(n);for(var w=[],x=0;x<n.length;x+=2){var z=n[x],L=n[x+1],fa=Ya[z];
void 0===(fa?fa[L]:void 0)&&w.push(z,L)}if(0===w.length){r=[];for(x=0;x<n.length;x+=2)z=n[x],L=n[x+1],r.push(Ya[z][L]);return Promise.resolve(r)}return r?(x=new S("getMetaData",w),Promise.reject(x)):Z.requestMetaData(w).then(function(){D();return oa(n,!0)})}function Ra(){"$$cs"===q&&g.$$es.disconnectNetwork()}function l(n,r,w){if("function"===typeof w)jb(n,r,w);else{w=w||0;var x="string"===typeof n?n+"_"+r:r,z;g.$$es[x]?z=g.$$es[x]:z=function(){return g[q][x].apply(g,arguments)};var L=z;w&1&&(L=function(O){return 0==
O?g.$$cs[x].apply(g,arguments):z.apply(g,arguments)});var fa=L;w&2&&(fa=function(O){"number"===typeof O&&(O=[O]);var ea=b(O);if(!ea)throw new TypeError("`keys' is not an Array or Uint32Array");var la=Array.prototype.slice.call(arguments,1);la.unshift(ea,O.length);return L.apply(g,la)});var X=fa;w&4&&(X=function(O){Za(O);var ea=b(O);if(!ea)throw new TypeError("`ids' is not an Array or Uint32Array.");var la=Array.prototype.slice.call(arguments,1);la.unshift(ea,O.length>>1);return fa.apply(g,la)});var ca=
X;w&8&&(ca=function(O){4===O.length&&"number"===typeof O[0]&&(O=[O]);var ea=O,la=g.$$es.allocateUint8Buffer(32*ea.length);if(la)for(var Da=0;Da<ea.length;++Da){var hb=ea[Da];if(4!==hb.length)throw Error("Planes are expected be exactly 4 numbers.");Fa.set(hb,(la>>3)+4*Da)}ea=Array.prototype.slice.call(arguments,1);ea.unshift(la,O.length);return X.apply(g,ea)});var za=ca;w&16&&(za=function(O){3===O.length&&"number"===typeof O[0]&&(O=[O]);var ea=O,la=g.$$es.allocateUint8Buffer(24*ea.length);if(la)for(var Da=
0;Da<ea.length;++Da){var hb=ea[Da];if(3!==hb.length)throw Error("Points are expected be exactly 3 components.");Fa.set(hb,(la>>3)+3*Da)}ea=Array.prototype.slice.call(arguments,1);ea.unshift(la,O.length);return ca.apply(g,ea)});var qa=za;w&32&&(qa=e(ca));var ya=qa;w&64&&(ya=function(){console.log("WARNING: Using deprecated function `"+("string"===typeof n?n+"."+r:r)+"'");return qa.apply(g,arguments)});var Ha=ya;w&128&&(Ha=function(){var O=arguments,ea=O[O.length-1];ea.constructor===p?O[O.length-1]=
ea.value:(O=Array.prototype.slice.call(O),O.push(0));return ya.apply(g,O)});var Ia=Ha;w&256&&(Ia=function(){var O=Array.prototype.slice.call(arguments);return new Promise(function(ea,la){O.push(ea);O.push(Y(x,la));Ha.apply(g,O)})});var Xa=Ia;w&512&&(Xa=w&256?function(){return Ia.apply(g,arguments).then(function(O){D();return Ca.copy(O)})}:function(){return Ca.copy(Ia.apply(g,arguments))});var sb=Xa;w&1024&&(sb=w&256?function(){return Xa.apply(g,arguments).then(Db)}:function(){return Db(Xa.apply(g,
arguments))});var pa=sb;w&2048&&(pa=w&256?function(){return sb.apply(g,arguments).then(Eb)}:function(){return Eb(sb.apply(g,arguments))});jb(n,r,function(){D();R&&y.callRecord.push(r+" "+v(arguments));return pa.apply(g,arguments)})}}function jb(n,r,w){var x="function"===typeof w?function(){D();R&&y.callRecord.push(r+" "+v(arguments));return w.apply(g,arguments)}:w;null===n?y[r]=x:"string"===typeof n?y[n][r]=x:n[r]=x}function Eb(n){for(var r=0;r<n.length;++r)0>n[r][0]&&(n[r]=null);return n}function Db(n){for(var r=
0;r<n.length;++r)0>n[r]&&(n[r]=null);return n}function Y(n,r){return function(w){w=new S(n,w);r(w)}}function S(n,r){this.scFunction=n;this.data=r}function Za(n){if(0!==(n.length&1))throw new TypeError("`ids.length' must be divisible by two. (An Id is a pair of keys.)");}y.CreateImageError=g.CreateImageError;y.CreateMeshInstanceErrorType=g.CreateMeshInstanceErrorType;y.CuttingSectionError=g.CuttingSectionError;y.MeshDataGetDataError=g.MeshDataGetDataError;y.MeshDataReplaceError=g.MeshDataReplaceError;
y.SetMatrixErrorType=g.SetMatrixErrorType;y.SetTextureErrorType=g.SetTextureErrorType;var Ca=f("$$es","Camera","reset viewMatrix projectionMatrix fullMatrix projection setProjection upVector setUpVector position setPosition target setTarget nearLimit setNearLimit fieldWidth fieldHeight setField setField setFieldByAngles setFieldByAngles dolly pan roll zoom orbit axisOrbit relativeOrbit unproject".split(" "));S.prototype.toString=function(){return this.scFunction+": "+this.data};var Z={},Ya={},Qc=
new Uint8Array(0),Qb=new Ca;l(null,"addCuttingSection",264);l(null,"addLight",256);l(null,"advanceVolumeSelection",256);l(null,"attachModels",function(n,r,w,x){for(var z=[],L=[],fa=0;fa<r.length;++fa){var X=r[fa];if(2!==X.length)throw new TypeError("Expecting [name, matrix] pair.");var ca=X[0];if("string"!==typeof ca)throw new TypeError("Name is not a string.");X=X[1];if(X.constructor!==Array&&X.constructor!==Float64Array)throw new TypeError("Matrix is not an Array or Float64Array.");if(12!==X.length)throw new TypeError("Inclusion matrix needs to have exactly 12 elements.");
ca=unescape(encodeURIComponent(ca));for(var za=0;za<ca.length;++za)z.push(ca.charCodeAt(za));z.push(0);Array.prototype.push.apply(L,X)}var qa=0,ya=0;qa=c(z);if(!qa)throw d(qa),d(ya),Error("Internal logic error.");ya=a(L);if(!ya)throw d(qa),d(ya),Error("Internal logic error.");return new Promise(function(Ha,Ia){g[q].attachModels(qa,z.length,ya,L.length,n,w,x,Ha,Y("attachModels",Ia))})});l(null,"attachScsModelByKey",function(n,r,w,x,z){var L=[];if(r.constructor!==Array&&r.constructor!==Float64Array)throw new TypeError("Matrix is not an Array or Float64Array.");
if(12!==r.length)throw new TypeError("Inclusion matrix needs to have exactly 12 elements.");Array.prototype.push.apply(L,r);r=a(L);if(!r)throw d(r),Error("Internal logic error.");return g.$$es.attachScsModelByKey(r,L.length,n,w,x,z)});l(null,"beginConvexPolyhedronSelection",264);l(null,"beginRayDrillSelection",256);l(null,"beginScreenAreaSelection",256);l(null,"beginSphereSelection",256);l(null,"clearLights");l(null,"createFloorplanMesh",388);l(null,"cuttingSectionLimits");l(null,"demandMeshInstances",
132);l(null,"detachInclusions",258);l(null,"disableCapping");l(null,"disconnectNetwork",Ra);l(null,"enableCapping");l(null,"endComparison");l(null,"endVolumeSelection");l(null,"explode");l(null,"exportToSvg",256);l(null,"beginExportToSvg",256);l(null,"advanceExportToSvg",256);l(null,"flushMetaDataCache",function(){"$$ss"===q&&(Ya={})});l(null,"getAmbientOcclusionEnabled",256);l(null,"getAmbientOcclusionRadius",256);l(null,"getBackFacesVisible",256);l(null,"getBackgroundGradient",256);l(null,"getCamera",
function(){return"$$ss"===q?Ca.clone(Qb):Z.getCamera()});l(null,"getCameraPromise",768);l(null,"getCappedInstances",256);l(null,"getCuttingSections",258);l(null,"getDefaultDepthRange",256);l(null,"getElementCount",256);l(null,"getEyeDomeLightingBlurEdgeDistance",256);l(null,"getEyeDomeLightingBlurInterval",256);l(null,"getEyeDomeLightingBlurSamples",256);l(null,"getEyeDomeLightingEnabled",256);l(null,"getEyeDomeLightingOpacity",256);l(null,"getEyeDomeLightingShadingEdgeDistance",256);l(null,"getFacesVisible",
256);l(null,"getFaceWindingFlipped",256);l(null,"getFrontFacesVisible",256);l(null,"getInteractiveDrawLimitIncreaseEnabled",256);l(null,"getLightKeys",256);l(null,"getLight",256);l(null,"getLinesVisible",256);l(null,"getLooseBounding",256);l(null,"getMetaData",oa);l(null,"getMinFrameRate",256);l(null,"getNetworkVersion");l(null,"getPointShape",256);l(null,"getPointSize",256);l(null,"getPointSizeUnit",256);l(null,"getPointsVisible",256);l(null,"getStatistics",256);l(null,"getStreamedBounding",256);
l(null,"getStreamVersion");l(null,"getTriangleCount",256);l(null,"markAllMeshInstancesInteresting");l(null,"markCameraAsEmpty");l(null,"meshInstanceKeyInfo",257);l(null,"metaDataKeyInfo",257);l(null,"modelKeysFromInclusionKeys",258);l(null,"onResize",function(){var n=y.allowHighDpi?window.devicePixelRatio||1:1,r=y.container,w=r.clientWidth,x=r.clientHeight;r=w*n;n*=x;if("$$ss"===q)F.Zk(r,n,w,x);else{var z=g.$$es.maxFrameBufferSize();if(0>=z)r=w,n=x;else{if(r>z||n>z)r=w,n=x;if(r>z||n>z)r>n?(n=n/r*
z,r=z):(r=r/n*z,n=z)}}g.$$cs.setScreenDimensions(r,n,w,x);"$$cs"===q&&(w=g.canvas,w.width=r,w.height=n,y.queueRedraw())});l(null,"pauseCapping");l(null,"primaryModelKey",256);l(null,"queueRedraw");l(null,"registerBimInstances",4);l(null,"removeAllCuttingSections");l(null,"removeCuttingSections",258);l(null,"removeLight");l(null,"replaceCuttingSection",264);l(null,"requestGroups",260);l(null,"requestImages",260);l(null,"requestMeshInstances",260);l(null,"requestMeshInstancesByGroup",260);l(null,"resetExplode");
l(null,"resetToEmpty",function(n,r){var w=b(r);if(!w)throw new TypeError("`meshKeys' is not an Array or Uint32Array");return Z.resetToEmpty(n,w,r.length)});l(null,"resumeCapping");l(null,"resumeDrawing");l(null,"screenSelectByRay",256);l(null,"serverSideRendering",function(){return"$$ss"===q});l(null,"setAmbientLightColor");l(null,"setAmbientOcclusionBias");l(null,"setAmbientOcclusionBlurInterval");l(null,"setAmbientOcclusionBlurSamples");l(null,"setAmbientOcclusionContrast");l(null,"setAmbientOcclusionEdgeDistance");
l(null,"setAmbientOcclusionEnabled");l(null,"setAmbientOcclusionIntensity");l(null,"setAmbientOcclusionNoiseSize");l(null,"setAmbientOcclusionOpacity");l(null,"setAmbientOcclusionRadius");l(null,"setAmbientOcclusionSamples");l(null,"setAntiAliasingMode");l(null,"setBackFacesVisible");l(null,"setBackgroundColor");l(null,"setBackgroundGradient");l(null,"setBloomBlurInterval");l(null,"setBloomBlurSamples");l(null,"setBloomEnabled");l(null,"setBloomIntensity");l(null,"setBloomIntensityScale");l(null,
"setBloomLayerCount");l(null,"setBloomThreshold");l(null,"setBloomThresholdRampWidth");l(null,"setBoundingPreviewUnderdrawColor");l(null,"setBoundingPreviewTestedColor");l(null,"setBoundingPreviewEjectedColor");l(null,"setBoundingPreviewColor");l(null,"setBoundingPreviewUnderdraw",16);l(null,"setBoundingPreviewTested",16);l(null,"setBoundingPreviewEjected",16);l(null,"setBoundingDebugLevel");l(null,"setCamera",function(n){Ca.assign(Qb,n);Z.setCamera(n)});l(null,"setCappingIdleHookEnabled",256);l(null,
"setClumpingEnabled");l(null,"setComparisonColors");l(null,"setCurrentView");l(null,"setDefaultDepthRange");l(null,"setDefaultGloss");l(null,"setDefaultMirror");l(null,"setDefaultSpecularMix");l(null,"setDefaultSphereMap");l(null,"setDisplayIncompleteFrames");l(null,"setDrawIdleDelay");l(null,"setDrawMode");l(null,"setDrawStrategy");l(null,"setEyeDomeLightingBlurEdgeDistance");l(null,"setEyeDomeLightingBlurInterval");l(null,"setEyeDomeLightingBlurSamples");l(null,"setEyeDomeLightingEnabled");l(null,
"setEyeDomeLightingOpacity");l(null,"setEyeDomeLightingShadingEdgeDistance");l(null,"setFacesVisible");l(null,"setFaceWindingFlipped");l(null,"setFixedDrawLimit");l(null,"setFrontFacesVisible");l(null,"setGoochBaseColorProminence");l(null,"setGoochBlue");l(null,"setGoochLuminanceShiftStrength");l(null,"setGoochYellow");l(null,"setGroundPlane");l(null,"setGroundPlaneWithPosition");l(null,"setHardEdgeColor");l(null,"setHardEdgeOpacity");l(null,"setHardEdgesEnabled");l(null,"setHardEdgeThreshold");l(null,
"setHardEdgeThresholdRampWidth");l(null,"setHiddenLineHiddenLineColor");l(null,"setHiddenLineHighlightedElementFillColor");l(null,"setHiddenLineHighlightedElementOutlineColor");l(null,"setHiddenLineHighlightedInstanceFillColor");l(null,"setHiddenLineHighlightedInstanceOutlineColor");l(null,"setHiddenLineVisibleLineColor");l(null,"setHighlightColorizeCompression");l(null,"setHighlightedElementColor");l(null,"setHighlightedElementFilter");l(null,"setHighlightedElementOutlineColor");l(null,"setHighlightedInstanceColor");
l(null,"setHighlightedInstanceFilter");l(null,"setHighlightedInstanceOutlineColor");l(null,"setHighlightMode");l(null,"setImageBasedLightingEnabled");l(null,"setImageBasedLightingEnvironment",function(n){var r=c(n);if(!r)throw new TypeError("`data' is not an Array or Uint8Array");return g[q].setImageBasedLightingEnvironment(r,n.length)});l(null,"setImageBasedLightingEnvironmentToDefault");l(null,"setImageBasedLightingIntensity");l(null,"setImageBasedLightingMatrix");l(null,"setInstancingEnabled");
l(null,"setInteractiveDrawLimitIncreaseEnabled");l(null,"setInteractiveDrawLimitIncreaseInterval");l(null,"setLightingEnabled");l(null,"setLineJitterEnabled");l(null,"setLineJitterFrequency");l(null,"setLineJitterInstanceCount");l(null,"setLineJitterRadius");l(null,"setLinesVisible");l(null,"setMeshLevel");l(null,"setMetallicRoughnessMaterialOverride");l(null,"setMinDrawLimit");l(null,"setMinFrameRate");l(null,"setMinIncrementalFrameRate");l(null,"setMinInteractiveFrameRate");l(null,"setPointShape");
l(null,"setPointSize");l(null,"setPointsVisible");l(null,"setPointVisibilityTest",16);l(null,"setPostInputDelay");l(null,"setSilhouetteColor");l(null,"setSilhouetteEnabled");l(null,"setSilhouetteOpacity");l(null,"setSilhouetteThreshold");l(null,"setSilhouetteThresholdRampWidth");l(null,"setSimpleReflectionAttenuation");l(null,"setSimpleReflectionBlurInterval");l(null,"setSimpleReflectionBlurSamples");l(null,"setSimpleReflectionEnabled");l(null,"setSimpleReflectionFadeAngle");l(null,"setSimpleReflectionOpacity");
l(null,"setSimpleShadowBlurInterval");l(null,"setSimpleShadowBlurSamples");l(null,"setSimpleShadowColor");l(null,"setSimpleShadowEnabled");l(null,"setSimpleShadowInteractiveUpdateEnabled");l(null,"setSimpleShadowOpacity");l(null,"setSimpleShadowResolution");l(null,"setSmaaQuality");l(null,"setSsrQuality",function(n){F.el(n)});l(null,"setStreamCutoffScale");l(null,"setStreamIdleMarker",256);l(null,"setToonBandCount");l(null,"setToonSpecularFactor");l(null,"setTransparencyMode");l(null,"setUnhighlightedColor");
l(null,"setUnhighlightedFilter");l(null,"setVisibilityByAttachment");l(null,"setXRayMaterial");l(null,"setXRayOpacity");l(null,"setXRayTransparencyMode");l(null,"startComparison",function(n,r){Za(n);Za(r);var w=b(n);if(!w)throw new TypeError("`instanceSet1' is not an Array or Uint32Array.");var x=b(r);if(!x)throw new TypeError("`instanceSet2' is not an Array or Uint32Array.");return g[q].startComparison(w,n.length>>1,x,r.length>>1)});l(null,"startExplode",4);l(null,"suspendDrawing");l(null,"testPointVisibility",
272);l(null,"throttleLoad");l(null,"triangulatePolygon",function(n,r){if(3>n.length)throw new TypeError("'polygonPoints' does not describe a polygon.");var w;if(n)if(w=g.$$es.allocateUint8Buffer(4*n.length))B.set(n,w>>2);else throw Error("Out of memory.");else w=0;if(!w)throw Error("Internal logic error.");return g.$$es.triangulatePolygon(w,n.length,r)});l(null,"truncateMetaData",function(n){if("$$cs"===q)return Z.truncateMetaData(n);for(var r=0;r<n.length;r+=2){var w=n[r+1],x=Ya[n[r]];x&&(x[w]=Qc)}});
l(null,"unsetAllColors");l(null,"unsetAllHighlighted");l(null,"unsetAllOpacity");l(null,"unsetAllXRay");l(null,"unsetCurrentView");l(null,"unsetXRayMaterial");l(null,"updateLight");l(null,"waitForImageDecoding",256);l(null,"worldSelectByRay",256);l(null,"_loseWebGlContext",function(){var n=g.Ti.getExtension("WEBGL_lose_context");return null!==n?(n.loseContext(),!0):!1});l(Z,"getCamera",512);l(Z,"getMetaData",260);l(Z,"MeshData_getData",256);l(Z,"MeshInstance_setLinePattern",132);l(Z,"requestMetaData",
260);l(Z,"resetToEmpty",258);l(Z,"setCamera",32);l(Z,"truncateMetaData",260);l(null,"Debug_log",function(n){n=unescape(encodeURIComponent(n));for(var r=[],w=0;w<n.length;++w)r.push(n.charCodeAt(w));r.push(0);var x=c(r);if(!x)throw Error("Internal logic error.");return new Promise(function(z,L){g[q].debug_log(x,r.length,z,L)})});l(null,"Debug_stateFailure",256);l(null,"Debug_sync",256);y.Image={};l("Image","create",function(n,r,w,x,z,L,fa,X,ca,za){var qa=c(r);if(!qa)throw Error("Internal logic error.");
var ya=c(fa);return new Promise(function(Ha,Ia){g[q].Image_create(qa,r.length,ya,fa?fa.length:0,n,w,x?x:0,z?z:0,L?L:0,X||!1,ca?ca:0,za?za:0,Ha,Y("Image_create",Ia))})});l("Image","destroy",260);y.Matrix={};l("Matrix","create",256);l("Matrix","destroy",260);l("Matrix","getElements",260);l("Matrix","setElements",260);y.MeshData={};l("MeshData","create",function(n){return new Promise(function(r,w){var x=n._marshal();g[q].MeshData_create(x.bits,x.totalFaceVertices,x.totalLineVertices,x.totalPointVertices,
x.floatDataPtr,x.floatDataPtrLen,x.faceElementInfosPtr,ba*n._faceElements.length,x.lineElementInfosPtr,ba*n._lineElements.length,x.pointElementInfosPtr,ba*n._pointElements.length,r,Y("MeshData_create",w))})});l("MeshData","destroy",260);l("MeshData","getData",function(n){return Z.MeshData_getData(n).then(Sb)});l("MeshData","lineElementSegments",256);l("MeshData","linesToIncidentFaces",258);l("MeshData","replace",function(n,r){return new Promise(function(w,x){var z=r._marshal();g[q].MeshData_replace(n[0],
n[1],z.bits,z.totalFaceVertices,z.totalLineVertices,z.totalPointVertices,z.floatDataPtr,z.floatDataPtrLen,z.faceElementInfosPtr,ba*r._faceElements.length,z.lineElementInfosPtr,ba*r._lineElements.length,z.pointElementInfosPtr,ba*r._pointElements.length,w,Y("MeshData_replace",x))})});y.MeshInstance={};l("MeshInstance","clearAllElementHighlight",132);l("MeshInstance","clearAllElementVisible",132);l("MeshInstance","clearAllElementXRay",132);l("MeshInstance","clearElementColors",132);l("MeshInstance",
"clearElementHighlight",132);l("MeshInstance","clearElementVisible",132);l("MeshInstance","clearElementXRay",132);l("MeshInstance","computeMinimalBodyBodyDistance",256);l("MeshInstance","computeMinimalFaceFaceDistance",256);l("MeshInstance","computeMinimalFaceLineDistance",256);l("MeshInstance","computeMinimalFaceRayDistance",256);l("MeshInstance","create",256);l("MeshInstance","destroy",388);l("MeshInstance","discardAnonymousMatrix",388);l("MeshInstance","getAlwaysDraw",388);l("MeshInstance","getCappingMeshData",
388);l("MeshInstance","getColor",2436);l("MeshInstance","getCullingVector",388);l("MeshInstance","getDoNotCut",388);l("MeshInstance","getDoNotExplode",388);l("MeshInstance","getDoNotLight",388);l("MeshInstance","getDoNotOutlineHighlight",388);l("MeshInstance","getDoNotSelect",388);l("MeshInstance","getDoNotUseVertexColors",388);l("MeshInstance","getDrawnWorldSpaceBounding",260);l("MeshInstance","getEffectiveColor",388);l("MeshInstance","getEffectiveElementColor",388);l("MeshInstance","getEffectiveOpacity",
388);l("MeshInstance","getElementColor",2436);l("MeshInstance","getElementHighlighted",388);l("MeshInstance","getElementVisible",388);l("MeshInstance","getElementXRay",388);l("MeshInstance","getExcludeBounding",388);l("MeshInstance","getFaceElementBounding",258);l("MeshInstance","getFacesVisible",388);l("MeshInstance","getHighlighted",388);l("MeshInstance","getLayerCount");l("MeshInstance","getLineElementBounding",258);l("MeshInstance","getLinesVisible",388);l("MeshInstance","getMatrix",388);l("MeshInstance",
"getMeshData",388);l("MeshInstance","getMetallicRoughness",388);l("MeshInstance","getObjectSpaceBounding",388);l("MeshInstance","getOpacity",1412);l("MeshInstance","getOverrideSceneVisibility",388);l("MeshInstance","getPointElementBounding",258);l("MeshInstance","getPointsVisible",388);l("MeshInstance","getScreenOriented",388);l("MeshInstance","getSuppressCameraScale",388);l("MeshInstance","getWorldSpaceBounding",260);l("MeshInstance","hasDepthRange",388);l("MeshInstance","hasTransparency",388);l("MeshInstance",
"linesToIncidentFaces",258);l("MeshInstance","matrixPreMultiply",388);l("MeshInstance","reifyAnonymousMatrix",388);l("MeshInstance","setAlwaysDraw",132);l("MeshInstance","setAmbientColor",132);l("MeshInstance","setAmbientMix",132);l("MeshInstance","setAnonymousMatrix",388);l("MeshInstance","setAnonymousMatrices",function(n,r){var w=0,x=0;if(n.constructor!==Array&&n.constructor!==Uint32Array)throw new TypeError("Incs Buffer is not an Array or Uint32Array.");if(r.constructor!==Array&&r.constructor!==
Float64Array)throw new TypeError("Matrices Buffer is not an Array or Float64Array.");w=b(n);if(!w)throw d(w),d(x),Error("Internal logic error.");x=a(r);if(!x)throw d(w),d(x),Error("Internal logic error.");return new Promise(function(z,L){g[q].MeshInstance_setAnonymousMatrices(w,n.length>>1,x,r.length,z,Y("MeshInstance_setAnonymousMatrices",L),0)})});l("MeshInstance","setColor",132);l("MeshInstance","setCullingVector",132);l("MeshInstance","setDepthRange",132);l("MeshInstance","setDoNotCut",132);l("MeshInstance",
"setDoNotExplode",132);l("MeshInstance","setDoNotLight",132);l("MeshInstance","setDoNotOutlineHighlight",132);l("MeshInstance","setDoNotSelect",132);l("MeshInstance","setDoNotReset",132);l("MeshInstance","setDoNotUseVertexColors",132);l("MeshInstance","setDoNotXRay",132);l("MeshInstance","setElementColor",132);l("MeshInstance","setElementHighlighted",132);l("MeshInstance","setElementVisible",132);l("MeshInstance","setElementXRay",132);l("MeshInstance","setExcludeBounding",132);l("MeshInstance","setFacesVisible",
132);l("MeshInstance","setHighlighted",132);l("MeshInstance","setLinePattern",function(n,r,w,x){var z=c(r);if(!z)throw new TypeError("`pattern' is not an Array or Uint8Array");return Z.MeshInstance_setLinePattern(n,z,r.length,w,x)});l("MeshInstance","setLinesVisible",132);l("MeshInstance","setMatrix",388);l("MeshInstance","setMeshLevel",132);l("MeshInstance","setMetallicRoughness",132);l("MeshInstance","unsetMetallicRoughness",132);l("MeshInstance","setOpacity",132);l("MeshInstance","setOverlayIndex",
132);l("MeshInstance","setOverrideSceneVisibility",132);l("MeshInstance","setPointsVisible",132);l("MeshInstance","setScreenOriented",132);l("MeshInstance","setScreenSpace",132);l("MeshInstance","setScreenSpaceStretched",132);l("MeshInstance","setStreamCutoffScale",132);l("MeshInstance","setSuppressCameraScale",132);l("MeshInstance","setTexture",388);l("MeshInstance","setVisible",132);l("MeshInstance","setXRay",132);l("MeshInstance","synchronizeVisibilities",4);l("MeshInstance","unsetColor",132);
l("MeshInstance","unsetCullingVector",132);l("MeshInstance","unsetDepthRange",132);l("MeshInstance","unsetElementColor",132);l("MeshInstance","unsetLinePattern",132);l("MeshInstance","unsetMatrix",388);l("MeshInstance","unsetOpacity",132);l("MeshInstance","unsetTexture",132);l("MeshInstance","setEmissiveColor",132);l("MeshInstance","unsetEmissiveColor",132);l("MeshInstance","setSpecularColor",132);l("MeshInstance","unsetSpecularColor",132);l("MeshInstance","setSpecularIntensity",132);l("MeshInstance",
"unsetSpecularIntensity",132);y.Overlay={};l("Overlay","destroy");l("Overlay","maxIndex");l("Overlay","setCamera",32);l("Overlay","setViewport");l("Overlay","setVisible");var hc={open_model_failed:Ra,session_started:function(){"$$cs"===q&&(g.canvas.addEventListener("webglcontextlost",u,!1),y.onResize())},post_draw_json:function(n,r){try{var w=JSON.parse(r)}catch(x){console.assert(!1,"malformed JSON from post_draw",x);return}g.hi("post_draw",w.stats,Cb(w.camera),w.visiblePoints);"high"===w.quality&&
(g.hi("draw_complete"),g.hi("draw_idle"))}},ia={session_started:function(){"$$ss"===q&&(y.resumeDrawing(),g[q].Debug_notifyLoggedRpcExecutionIsAllowed())}},Q={};g.hi=function(n){if(n in hc){var r=hc[n];r.apply(this,arguments)}var w=Q[n];try{if(void 0!==w)for(var x=0;x<w.length;x++)r=w[x],"function"===typeof r&&r.apply(this,arguments)}catch(z){console.log("Unhandled exception in "+n+" event handler:"),console.log(z)}n in ia&&(r=ia[n],r.apply(this,arguments))};y.setEventHandler=function(n,r){Q.hasOwnProperty(n)||
(Q[n]=[]);Q[n].push(r)};y.unsetEventHandler=function(n,r){n=Q[n];if(void 0!==n)for(var w=0;w<n.length;)n[w]===r?n.splice(w,1):++w};W.prototype=Object.create(Error.prototype);W.prototype.constructor=W;var H={Uninitialized:0,Network:1,Scs:2};y.SessionType=H;var ua=H.Uninitialized;y.load=function(n){D();R&&y.callRecord.push("load "+v(n));if(!n)throw new W("InvalidConfig","Invalid load configuration");var r=n.uri;if(1!==!!r+!!n.buffer+!!n.empty)throw new W("InvalidConfig","Must specify exactly one of 'uri', 'buffer', or 'empty'.");
if(r){if("string"!==typeof r)throw new W("InvalidConfig","'uri' must be a string");var w=da(r.split("://"));var x=w.next().value;var z=w.next().value;w=w.next().value;if(z){if(w)throw new W("InvalidConfig","Invalid URI");}else x="http";if("ws"===x||"wss"===x){K();if(!n)throw new W("InvalidConfig","Invalid load configuration");n.model&&"string"===typeof n.model||(n.model="");x=n.sessionToken;void 0===x&&(x="");if("string"!==typeof x)throw new W("InvalidConfig","'sessionToken' must be a string");z=
n.limitMiB;void 0===z&&(z=0);if("number"!==typeof z)throw new W("InvalidConfig","'limitMiB' must be a number");w=n.meshLevel;void 0===w&&(w=0);if("number"!==typeof w)throw new W("InvalidConfig","'meshLevel' must be a number");var L=n.streamCutoffScale;void 0===L&&(L=-1);if("number"!==typeof L)throw new W("InvalidConfig","'streamCutoffScale' must be a number");if(ua!==H.Uninitialized)throw new W("AlreadyCalled","load() already called for a non-streaming session");ua=H.Network;n.serverSideRendering?
(g.canvas.style.display="none",q="$$ss",F.Aj(g.$$wrapper),y.onResize(),F.cl(ta),F.dl(xa),F.bl(Ba),F.al(g.hi),F.connect(n)):(q="$$cs",ja(g.$$es.loadNetwork(r,unescape(encodeURIComponent(n.model)),unescape(encodeURIComponent(x)),!!n.streamCulled,!!n.streamMetaDataOnIdle,!!n.streamNoLimit,!!n.streamInstancesOnDemand,!!n.streamAggressiveCompression,!!n.streamModelBoundingPreviews,!!n.streamInstanceBoundingPreviews,!!n.streamOnlyInterestingBoundingPreviews,!!n.streamEjectedBoundingPreviews,z,w,L)))}else"http"!==
x&&"https"!==x||G(n,r)}else n.buffer?A(n,n.buffer):(n=!!n.streamInstancesOnDemand,K([H.Scs]),ua=H.Scs,n=g.$$es.loadEmptyScs(n),ja(n));return ua};y.attachScsBuffer=function(n,r,w,x,z,L){n={attachScope:n,inclusionMatrix:w,attachMeasurementUnit:x,attachInvisibly:z,resolveOnFullyLoaded:L};return null===r||0===r.length?U(n,0,0):A(n,r)};y.feedScsBuffer=function(n,r){K([H.Scs]);if(0===n)throw new W("InvalidConfig","'attachScope' should not be 0");var w=0,x=0;if(null!==r){if(r.constructor!==Uint8Array)throw new W("InvalidConfig",
"'buffer' must be a Uint8Array");if(0>=r.byteLength)throw new W("EmptyBuffer","'buffer' has a length of 0");w=r.byteLength;x=g.$$es.allocateUint8Buffer(r.byteLength);t.set(r,x)}g.$$es.feedScsBuffer(n,x,w)}})();var ba=3,M=4*ba;y.MeshDataBuilder=function(){this._faceElements=[];this._lineElements=[];this._pointElements=[];this.formatBits=0};y.MeshDataBuilder.FormatBits={ClockwiseWinding:1,CounterClockwiseWinding:2,TwoSided:4,Manifold:65536};y.MeshDataBuilder.prototype={constructor:y.MeshDataBuilder,
_getOptional:function(G,A){return void 0===G?null:G[A]?G[A]:null},_optionalGuard:function(G,A,U){if(U){if((U=this[U][0])&&!U[G])throw Error("Cannot define "+A+" for some but not all vertices.");}else this._optionalGuard(G,A,"_faceElements"),this._optionalGuard(G,A,"_lineElements"),this._optionalGuard(G,A,"_pointElements")},addFace:function(G,A){var U=this._faceElements,K=this._getOptional(A,"normals"),ja=this._getOptional(A,"uvs"),W=this._getOptional(A,"rgba32s");A=this._getOptional(A,"bits")||0;
if(0!==G.length%9)throw Error("Illegal triangles: 'vertexData.length' must be divisible by 9 (i.e. 3 numbers per vertex and 3 vertices per triangle).");if(K){if(K.length!==G.length)throw Error("Cannot define normals for some but not all vertices.");this._optionalGuard("normals","normals","_faceElements")}if(ja){if(3*ja.length!==2*G.length)throw Error("Cannot define UV parameters for some but not all vertices.");this._optionalGuard("uvs","UV parameters","_faceElements")}if(W){if(3*W.length!==4*G.length)throw Error("Cannot define RGBA32s for some but not all vertices.");
this._optionalGuard("rgba32s","RGBA32s");if(0==(this.formatBits&32768))for(var ta=3;ta<W.length;ta+=4)if(255!=W[ta]){this.formatBits|=32768;break}}U.push({vertexData:G,normals:K,uvs:ja,rgba32s:W,bits:A})},addPolyline:function(G,A){var U=this._lineElements,K=this._getOptional(A,"rgba32s");A=this._getOptional(A,"bits")||0;if(0!==G.length%3)throw Error("vertexData array must be divisible by 3 (i.e. 3 numbers per vertex).");if(6>G.length&&0<G.length)throw Error("Illegal polyline: '0 < vertexData.length < 6'.");
if(K){if(3*K.length!==4*G.length)throw Error("Cannot define RGBA32s for some but not all vertices.");this._optionalGuard("rgba32s","RGBA32s")}U.push({vertexData:G,rgba32s:K,bits:A})},addPoints:function(G,A){var U=this._pointElements,K=this._getOptional(A,"rgba32s");A=this._getOptional(A,"bits")||0;if(0!==G.length%3)throw Error("vertexData array must be divisible by 3 (i.e. 3 numbers per vertex).");if(K){if(3*K.length!==4*G.length)throw Error("Cannot define RGBA32s for some but not all vertices.");
this._optionalGuard("rgba32s","RGBA32s")}U.push({vertexData:G,rgba32s:K,bits:A})},_marshal:function(){var G=this._faceElements,A=this._lineElements,U=this._pointElements,K=!1,ja=!1,W=!1,ta=!1,xa=!1,Ba=!1,Cb=!1,Sb=!1,Rb=!1,oa=G[0],Ra=A[0],l=U[0];oa&&(K=!!oa.normals,ja=!!oa.uvs,W=!!oa.rgba32s);Ra&&(ta=!!Ra.normals,xa=!!Ra.uvs,Ba=!!Ra.rgba32s);l&&(Cb=!!l.normals,Sb=!!l.uvs,Rb=!!l.rgba32s);var jb=3;oa=this.formatBits;if(Ra=K||ta||Cb)jb+=3,oa|=4096,K&&(oa|=8),ta&&(oa|=64),Cb&&(oa|=512);if(l=ja||xa||Sb)jb+=
2,oa|=8192,ja&&(oa|=16),xa&&(oa|=128),Sb&&(oa|=1024);var Eb=W||Ba||Rb;Eb&&(jb+=1,oa|=16384,W&&(oa|=32),Ba&&(oa|=256),Rb&&(oa|=2048));for(var Db=0,Y=0;Y<G.length;++Y){var S=G[Y];Db+=S.vertexData.length}Db/=3;var Za=0,Ca=0;for(Y=0;Y<A.length;++Y){S=A[Y];var Z=S.vertexData;Z.length&&(Za+=Z.length,++Ca)}Za=2*(Za/3-Ca);for(Y=Ca=0;Y<U.length;++Y)S=U[Y],Ca+=S.vertexData.length;Ca/=3;jb*=Db+Za+Ca;Y=g.$$es.allocateUint8Buffer;var Ya=Y(4*jb),Qc=G.length?Y(M*G.length):0,Qb=A.length?Y(M*A.length):0,hc=U.length?
Y(M*U.length):0,ia=t.subarray(Ya),Q=B.subarray(Ya>>2),H=0,ua=0;for(Y=0;Y<G.length;++Y){S=G[Y];Z=S.vertexData;var n=S.normals,r=S.uvs,w=S.rgba32s,x=Z.length/3,z=h.subarray((Qc>>2)+ba*Y);z[0]=ua;z[1]=x;z[2]=S.bits;ua+=x;var L=0;for(x=S=0;x<Z.length;x+=3)Q[H]=Z[x],Q[H+1]=Z[x+1],Q[H+2]=Z[x+2],H+=3,Ra&&(K?(Q[H]=n[x],Q[H+1]=n[x+1],Q[H+2]=n[x+2]):(Q[H]=0,Q[H+1]=0,Q[H+2]=0),H+=3),l&&(ja?(Q[H]=r[L],Q[H+1]=r[L+1],L+=2):(Q[H]=0,Q[H+1]=0),H+=2),Eb&&(z=H<<2,W?(ia[z++]=w[S++],ia[z++]=w[S++],ia[z++]=w[S++],ia[z++]=
w[S++]):(ia[z++]=0,ia[z++]=0,ia[z++]=0,ia[z++]=0),++H)}for(Y=ua=0;Y<A.length;++Y)for(S=A[Y],Z=S.vertexData,n=S.normals,r=S.uvs,w=S.rgba32s,x=Z.length/3,0<x&&(x=2*x-2),z=h.subarray((Qb>>2)+ba*Y),z[0]=ua,z[1]=x,z[2]=S.bits,ua+=x,S=4,x=3;x<Z.length;x+=3)for(S-=4,G=-3;0>=G;G+=3)K=x+G,Q[H]=Z[K],Q[H+1]=Z[K+1],Q[H+2]=Z[K+2],H+=3,Ra&&(ta?(Q[H]=n[K],Q[H+1]=n[K+1],Q[H+2]=n[K+2]):(Q[H]=0,Q[H+1]=0,Q[H+2]=0),H+=3),l&&(xa?(K=K/3*2,Q[H]=r[K],Q[H+1]=r[K+1]):(Q[H]=0,Q[H+1]=0),H+=2),Eb&&(z=H<<2,Ba?(ia[z++]=w[S++],
ia[z++]=w[S++],ia[z++]=w[S++],ia[z++]=w[S++]):(ia[z++]=0,ia[z++]=0,ia[z++]=0,ia[z++]=0),++H);for(Y=ua=0;Y<U.length;++Y)for(S=U[Y],Z=S.vertexData,n=S.normals,r=S.uvs,w=S.rgba32s,x=Z.length/3,z=h.subarray((hc>>2)+ba*Y),z[0]=ua,z[1]=x,z[2]=S.bits,ua+=x,x=S=L=0;x<Z.length;x+=3)Q[H]=Z[x],Q[H+1]=Z[x+1],Q[H+2]=Z[x+2],H+=3,Ra&&(Cb?(Q[H]=n[x],Q[H+1]=n[x+1],Q[H+2]=n[x+2]):(Q[H]=0,Q[H+1]=0,Q[H+2]=0),H+=3),l&&(Sb?(Q[H]=r[L],Q[H+1]=r[L+1],L+=2):(Q[H]=0,Q[H+1]=0),H+=2),Eb&&(z=H<<2,Rb?(ia[z++]=w[S++],ia[z++]=w[S++],
ia[z++]=w[S++],ia[z++]=w[S++]):(ia[z++]=0,ia[z++]=0,ia[z++]=0,ia[z++]=0),++H);return{totalFaceVertices:Db,totalLineVertices:Za,totalPointVertices:Ca,faceElementInfosPtr:Qc,lineElementInfosPtr:Qb,pointElementInfosPtr:hc,floatDataPtr:Ya,floatDataPtrLen:jb,bits:oa}}}};
g.Pj=function(){var a={Uj:null,aj:null,connection:null,jj:null,mj:null,gj:null,fj:null,ej:1280,dj:800,lj:1280,kj:800,Si:1,lk:{command:"SERVER_SETTINGS"},Aj:function(c){this.Uj=c;b.Aj()},gl:function(){this.dk=!0;delete this.jj;delete this.mj;delete this.gj;delete this.fj;this.connection&&this.connection.close()},tk:function(c){a.aj!==c&&(a.aj&&(a.aj.style.display="none"),a.aj=c,a.aj.style.display="")},connected:function(){return a.connection&&a.connection.readyState===WebSocket.OPEN},Jj:function(){a.connected()&&
a.connection.send(JSON.stringify({command:"SERVER_SIDE_CLIENT_INFO",width:a.ej*a.Si,height:a.dj*a.Si,layoutWidth:a.lj,layoutHeight:a.kj,encoding:"jpeg"}))},Zk:function(c,d,e,f){0>=c||0>=d||0>=e||0>=f||a.ej===c&&a.dj===d&&a.lj===e&&a.kj===f||(a.ej=c,a.dj=d,a.lj=e,a.kj=f,a.connected()&&(void 0!==a.Ij&&window.clearTimeout(a.Ij),a.Ij=setTimeout(function(){a.dk||(a.Ij=void 0,a.Jj())},500)))},Yk:function(c){a.connected()&&a.connection.send(c)},cl:function(c){a.jj=c},dl:function(c){a.mj=c},bl:function(c){a.gj=
c},al:function(c){a.fj=c},Qk:function(c){a.gj&&a.gj(c)},el:function(c){var d={command:"SERVER_SETTINGS"},e;for(e in c)if(c.hasOwnProperty(e)){if("scaleHigh"===e){var f=c[e];if("number"!==typeof f)continue;f=Math.min(1,f);0>=f&&(f=1);a.Si!==f&&(a.Si=f,a.Jj())}"jpegQualityHigh"!==e&&"jpegQualityLow"!==e&&"jpegChromaSamplesHigh"!==e&&"jpegChromaSamplesLow"!==e&&"scaleLow"!==e||"number"!==typeof c[e]||(d[e]=a.lk[e]=c[e])}a.connected()&&a.connection.send(JSON.stringify(d))},connect:function(c){var d=g.$$es.getNetworkVersion();
a.connection=new WebSocket(c.uri,["binary"]);a.connection.binaryType="arraybuffer";var e=!1;a.connection.onclose=function(){g.hi("websocket_connection_closed")};a.connection.onopen=function(){e=!0;a.connection.send(JSON.stringify({command:"SERVER_SIDE_RENDER",width:a.ej*a.Si,height:a.dj*a.Si,layoutWidth:a.lj,layoutHeight:a.kj,model:c.model,networkVersion:d,streamCulled:!!c.streamCulled,streamKeyedDataOnIdle:!!c.streamMetaDataOnIdle,streamNoLimit:!!c.streamNoLimit,streamInstancesOnDemand:!!c.streamInstancesOnDemand,
streamBoundingPreviews:!!c.streamBoundingPreviews,streamModelBoundingPreviews:!!c.streamModelBoundingPreviews,streamInstanceBoundingPreviews:!!c.streamInstanceBoundingPreviews,streamOnlyInterestingBoundingPreviews:!!c.streamOnlyInterestingBoundingPreviews,streamEjectedBoundingPreviews:!!c.streamEjectedBoundingPreviews,limitMiB:c.limitMiB,meshLevel:c.meshLevel,streamCutoffScale:c.streamCutoffScale,sessionToken:c.sessionToken}));a.Jj();a.connection.send(JSON.stringify(a.lk))};a.connection.onerror=function(){a.fj&&
a.fj(e?"socket_error":"socket_open_failed")};a.connection.onmessage=function(f){if(!a.dk&&f.data instanceof ArrayBuffer){var k=new Uint8Array(f.data);f=k[0];if(123===f)a.jj&&a.jj(k);else if(68===f)a.mj&&a.mj(k.subarray(1));else{a.connection.send('{"command":"ACK"}');var m=[k[1],k[2]],p=k[4]<<24|k[5]<<16|k[6]<<8|k[7],u=new Uint8Array(k.subarray(8,8+p));k=k.subarray(8+p);0===f&&b.Ck(k,m,u)}}}}},b={canvas:null,Sj:null,Aj:function(){},createElement:function(){this.canvas||(this.canvas=document.createElement("canvas"),
this.canvas.setAttribute("style","display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;"),this.Sj=this.canvas.getContext("2d"),a.Uj.appendChild(this.canvas))},drawImage:function(c,d){var e=c.width-d[0];d=c.height-d[1];this.canvas.width!==e&&(this.canvas.width=e);this.canvas.height!==d&&(this.canvas.height=d);this.Sj.drawImage(c,0,0)},wk:function(c,d,e){var f=document.createElement("img");this.Lk=f;f.onload=function(){f===b.Lk&&(b.drawImage(f,d),a.tk(b.canvas),a.Qk(e));URL.revokeObjectURL(c)};
f.onerror=function(){URL.revokeObjectURL(c)};f.src=c;return f},Ck:function(c,d,e){12>=c.byteLength||(this.createElement(),this.wk(URL.createObjectURL(new Blob([c],{type:"image/jpeg"})),d,e))}};return a};var Na=Object.assign({},g),Oa="./this.program";function Pa(a,b){throw b;}var Qa="object"==typeof window,Sa="function"==typeof importScripts,Ta="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,Ua="",Va,$a,ab;
if(Ta){Ua=Sa?require("path").dirname(Ua)+"/":__dirname+"/";var fs,bb;"function"===typeof require&&(fs=require("fs"),bb=require("path"));Va=function(a,b){a=bb.normalize(a);return fs.readFileSync(a,b?void 0:"utf8")};ab=function(a){a=Va(a,!0);a.buffer||(a=new Uint8Array(a));return a};$a=function(a,b,c){a=bb.normalize(a);fs.readFile(a,function(d,e){d?c(d):b(e.buffer)})};1<process.argv.length&&(Oa=process.argv[1].replace(/\\/g,"/"));process.argv.slice(2);"undefined"!=typeof module&&(module.exports=g);
process.on("uncaughtException",function(a){if(!(a instanceof cb))throw a;});process.on("unhandledRejection",function(a){throw a;});Pa=function(a,b){if(noExitRuntime)throw process.exitCode=a,b;b instanceof cb||db("exiting due to exception: "+b);process.exit(a)};g.inspect=function(){return"[Emscripten Module object]"}}else if(Qa||Sa)Sa?Ua=self.location.href:"undefined"!=typeof document&&document.currentScript&&(Ua=document.currentScript.src),Ua=0!==Ua.indexOf("blob:")?Ua.substr(0,Ua.replace(/[?#].*/,
"").lastIndexOf("/")+1):"",Va=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send(null);return b.responseText},Sa&&(ab=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.responseType="arraybuffer";b.send(null);return new Uint8Array(b.response)}),$a=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){200==d.status||0==d.status&&d.response?b(d.response):c()};d.onerror=c;d.send(null)};
var eb=g.print||console.log.bind(console),db=g.printErr||console.warn.bind(console);Object.assign(g,Na);Na=null;g.thisProgram&&(Oa=g.thisProgram);g.quit&&(Pa=g.quit);var fb;g.wasmBinary&&(fb=g.wasmBinary);var noExitRuntime=g.noExitRuntime||!0;"object"!=typeof WebAssembly&&gb("no native wasm support detected");var kb,lb=!1,mb="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;
function Ma(a,b,c){var d=b+c;for(c=b;a[c]&&!(c>=d);)++c;if(16<c-b&&a.buffer&&mb)return mb.decode(a.subarray(b,c));for(d="";b<c;){var e=a[b++];if(e&128){var f=a[b++]&63;if(192==(e&224))d+=String.fromCharCode((e&31)<<6|f);else{var k=a[b++]&63;e=224==(e&240)?(e&15)<<12|f<<6|k:(e&7)<<18|f<<12|k<<6|a[b++]&63;65536>e?d+=String.fromCharCode(e):(e-=65536,d+=String.fromCharCode(55296|e>>10,56320|e&1023))}}else d+=String.fromCharCode(e)}return d}function nb(a,b){return a?Ma(t,a,b):""}
function ob(a,b,c,d){if(!(0<d))return 0;var e=c;d=c+d-1;for(var f=0;f<a.length;++f){var k=a.charCodeAt(f);if(55296<=k&&57343>=k){var m=a.charCodeAt(++f);k=65536+((k&1023)<<10)|m&1023}if(127>=k){if(c>=d)break;b[c++]=k}else{if(2047>=k){if(c+1>=d)break;b[c++]=192|k>>6}else{if(65535>=k){if(c+2>=d)break;b[c++]=224|k>>12}else{if(c+3>=d)break;b[c++]=240|k>>18;b[c++]=128|k>>12&63}b[c++]=128|k>>6&63}b[c++]=128|k&63}}b[c]=0;return c-e}
function pb(a){for(var b=0,c=0;c<a.length;++c){var d=a.charCodeAt(c);127>=d?b++:2047>=d?b+=2:55296<=d&&57343>=d?(b+=4,++c):b+=3}return b}var qb,rb,t,tb,ub,E,h,B,Fa;function vb(){var a=kb.buffer;qb=a;g.HEAP8=rb=new Int8Array(a);g.HEAP16=tb=new Int16Array(a);g.HEAP32=E=new Int32Array(a);g.HEAPU8=t=new Uint8Array(a);g.HEAPU16=ub=new Uint16Array(a);g.HEAPU32=h=new Uint32Array(a);g.HEAPF32=B=new Float32Array(a);g.HEAPF64=Fa=new Float64Array(a)}var wb,xb=[],yb=[],zb=[],Ab=[];
function Bb(){var a=g.preRun.shift();xb.unshift(a)}Math.imul||(Math.imul=function(a,b){var c=a&65535,d=b&65535;return c*d+((a>>>16)*d+c*(b>>>16)<<16)|0});if(!Math.fround){var Fb=new Float32Array(1);Math.fround=function(a){Fb[0]=a;return Fb[0]}}Math.clz32||(Math.clz32=function(a){var b=32,c=a>>16;c&&(b-=16,a=c);if(c=a>>8)b-=8,a=c;if(c=a>>4)b-=4,a=c;if(c=a>>2)b-=2,a=c;return a>>1?b-2:b-a});Math.trunc||(Math.trunc=function(a){return 0>a?Math.ceil(a):Math.floor(a)});var Gb=0,Hb=null,Ib=null;
function Jb(){Gb++;g.monitorRunDependencies&&g.monitorRunDependencies(Gb)}function Kb(){Gb--;g.monitorRunDependencies&&g.monitorRunDependencies(Gb);if(0==Gb&&(null!==Hb&&(clearInterval(Hb),Hb=null),Ib)){var a=Ib;Ib=null;a()}}function gb(a){if(g.onAbort)g.onAbort(a);a="Aborted("+a+")";db(a);lb=!0;throw new WebAssembly.RuntimeError(a+". Build with -sASSERTIONS for more info.");}function Lb(){return Mb.startsWith("data:application/octet-stream;base64,")}var Mb;Mb="engine-asmjs-unwrapped.wasm";
if(!Lb()){var Nb=Mb;Mb=g.locateFile?g.locateFile(Nb,Ua):Ua+Nb}function Ob(){var a=Mb;try{if(a==Mb&&fb)return new Uint8Array(fb);if(ab)return ab(a);throw"both async and sync fetching of the wasm failed";}catch(b){gb(b)}}
function Pb(){if(!fb&&(Qa||Sa)){if("function"==typeof fetch&&!Mb.startsWith("file://"))return fetch(Mb,{credentials:"same-origin"}).then(function(a){if(!a.ok)throw"failed to load wasm binary file at '"+Mb+"'";return a.arrayBuffer()}).catch(function(){return Ob()});if($a)return new Promise(function(a,b){$a(Mb,function(c){a(new Uint8Array(c))},b)})}return Promise.resolve().then(function(){return Ob()})}
var Tb,Ub,Vb={726336:function(){console.log("RPC parsing failed")},726375:function(a,b){g.$$facade&&(Fa[a>>3]=g.$$facade.container.clientWidth,Fa[b>>3]=g.$$facade.container.clientHeight)},726536:function(){try{var a=window.bowser;return a&&a.windows&&(a.webkit||a.blink||a.gecko)?1:0}catch(b){return 1}},726709:function(){try{var a=window.bowser;if(!(a&&a.windows&&(a.chrome&&0<=a.compareVersions([a.version,"55"])&&0>a.compareVersions([a.version,"57"])||a.firefox&&0<=a.compareVersions([a.version,"51"])&&
0>a.compareVersions([a.version,"58"]))))return 0}catch(e){return 0}try{var b=g.Ti,c=b.getExtension("WEBGL_debug_renderer_info");if(c){var d=b.getParameter(c.UNMASKED_RENDERER_WEBGL);if(!(d&&0<=d.indexOf("ANGLE")&&(0<=d.indexOf("AMD")||0<=d.indexOf("Radeon"))&&0<=d.indexOf("Direct3D11")))return 0}}catch(e){}return 1}};function cb(a){this.name="ExitStatus";this.message="Program terminated with exit("+a+")";this.status=a}function Wb(a){for(;0<a.length;)a.shift()(g)}var Xb=[],Yb=[];
function Zb(a,b){for(var c=0,d=a.length-1;0<=d;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c;c--)a.unshift("..");return a}function $b(a){var b="/"===a.charAt(0),c="/"===a.substr(-1);(a=Zb(a.split("/").filter(function(d){return!!d}),!b).join("/"))||b||(a=".");a&&c&&(a+="/");return(b?"/":"")+a}
function ac(a){var b=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(a).slice(1);a=b[0];b=b[1];if(!a&&!b)return".";b&&(b=b.substr(0,b.length-1));return a+b}function bc(a){if("/"===a)return"/";a=$b(a);a=a.replace(/\/$/,"");var b=a.lastIndexOf("/");return-1===b?a:a.substr(b+1)}
function cc(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var a=new Uint8Array(1);return function(){crypto.getRandomValues(a);return a[0]}}if(Ta)try{var b=require("crypto");return function(){return b.randomBytes(1)[0]}}catch(c){}return function(){return gb("randomDevice")}}
function dc(){for(var a="",b=!1,c=arguments.length-1;-1<=c&&!b;c--){b=0<=c?arguments[c]:"/";if("string"!=typeof b)throw new TypeError("Arguments to path.resolve must be strings");if(!b)return"";a=b+"/"+a;b="/"===b.charAt(0)}a=Zb(a.split("/").filter(function(d){return!!d}),!b).join("/");return(b?"/":"")+a||"."}function ec(a,b){var c=Array(pb(a)+1);a=ob(a,c,0,c.length);b&&(c.length=a);return c}var fc=[];function gc(a,b){fc[a]={input:[],output:[],Ri:b};ic(a,jc)}
var jc={open:function(a){var b=fc[a.node.rdev];if(!b)throw new I(43);a.tty=b;a.seekable=!1},close:function(a){a.tty.Ri.fsync(a.tty)},fsync:function(a){a.tty.Ri.fsync(a.tty)},read:function(a,b,c,d){if(!a.tty||!a.tty.Ri.ak)throw new I(60);for(var e=0,f=0;f<d;f++){try{var k=a.tty.Ri.ak(a.tty)}catch(m){throw new I(29);}if(void 0===k&&0===e)throw new I(6);if(null===k||void 0===k)break;e++;b[c+f]=k}e&&(a.node.timestamp=Date.now());return e},write:function(a,b,c,d){if(!a.tty||!a.tty.Ri.Fj)throw new I(60);
try{for(var e=0;e<d;e++)a.tty.Ri.Fj(a.tty,b[c+e])}catch(f){throw new I(29);}d&&(a.node.timestamp=Date.now());return e}},kc={ak:function(a){if(!a.input.length){var b=null;if(Ta){var c=Buffer.alloc(256),d=0;try{d=fs.readSync(process.stdin.fd,c,0,256,-1)}catch(e){if(e.toString().includes("EOF"))d=0;else throw e;}0<d?b=c.slice(0,d).toString("utf-8"):b=null}else"undefined"!=typeof window&&"function"==typeof window.prompt?(b=window.prompt("Input: "),null!==b&&(b+="\n")):"function"==typeof readline&&(b=
readline(),null!==b&&(b+="\n"));if(!b)return null;a.input=ec(b,!0)}return a.input.shift()},Fj:function(a,b){null===b||10===b?(eb(Ma(a.output,0)),a.output=[]):0!=b&&a.output.push(b)},fsync:function(a){a.output&&0<a.output.length&&(eb(Ma(a.output,0)),a.output=[])}},lc={Fj:function(a,b){null===b||10===b?(db(Ma(a.output,0)),a.output=[]):0!=b&&a.output.push(b)},fsync:function(a){a.output&&0<a.output.length&&(db(Ma(a.output,0)),a.output=[])}},J={wi:null,Bi:function(){return J.createNode(null,"/",16895,
0)},createNode:function(a,b,c,d){if(24576===(c&61440)||4096===(c&61440))throw new I(63);J.wi||(J.wi={dir:{node:{Gi:J.ei.Gi,ri:J.ei.ri,lookup:J.ei.lookup,nj:J.ei.nj,rename:J.ei.rename,unlink:J.ei.unlink,rmdir:J.ei.rmdir,readdir:J.ei.readdir,symlink:J.ei.symlink},stream:{Ii:J.fi.Ii}},file:{node:{Gi:J.ei.Gi,ri:J.ei.ri},stream:{Ii:J.fi.Ii,read:J.fi.read,write:J.fi.write,Qj:J.fi.Qj,Ej:J.fi.Ej,ik:J.fi.ik}},link:{node:{Gi:J.ei.Gi,ri:J.ei.ri,readlink:J.ei.readlink},stream:{}},Tj:{node:{Gi:J.ei.Gi,ri:J.ei.ri},
stream:mc}});c=nc(a,b,c,d);16384===(c.mode&61440)?(c.ei=J.wi.dir.node,c.fi=J.wi.dir.stream,c.di={}):32768===(c.mode&61440)?(c.ei=J.wi.file.node,c.fi=J.wi.file.stream,c.ji=0,c.di=null):40960===(c.mode&61440)?(c.ei=J.wi.link.node,c.fi=J.wi.link.stream):8192===(c.mode&61440)&&(c.ei=J.wi.Tj.node,c.fi=J.wi.Tj.stream);c.timestamp=Date.now();a&&(a.di[b]=c,a.timestamp=c.timestamp);return c},vl:function(a){return a.di?a.di.subarray?a.di.subarray(0,a.ji):new Uint8Array(a.di):new Uint8Array(0)},Yj:function(a,
b){var c=a.di?a.di.length:0;c>=b||(b=Math.max(b,c*(1048576>c?2:1.125)>>>0),0!=c&&(b=Math.max(b,256)),c=a.di,a.di=new Uint8Array(b),0<a.ji&&a.di.set(c.subarray(0,a.ji),0))},Wk:function(a,b){if(a.ji!=b)if(0==b)a.di=null,a.ji=0;else{var c=a.di;a.di=new Uint8Array(b);c&&a.di.set(c.subarray(0,Math.min(b,a.ji)));a.ji=b}},ei:{Gi:function(a){var b={};b.dev=8192===(a.mode&61440)?a.id:1;b.ino=a.id;b.mode=a.mode;b.nlink=1;b.uid=0;b.gid=0;b.rdev=a.rdev;16384===(a.mode&61440)?b.size=4096:32768===(a.mode&61440)?
b.size=a.ji:40960===(a.mode&61440)?b.size=a.link.length:b.size=0;b.atime=new Date(a.timestamp);b.mtime=new Date(a.timestamp);b.ctime=new Date(a.timestamp);b.uk=4096;b.blocks=Math.ceil(b.size/b.uk);return b},ri:function(a,b){void 0!==b.mode&&(a.mode=b.mode);void 0!==b.timestamp&&(a.timestamp=b.timestamp);void 0!==b.size&&J.Wk(a,b.size)},lookup:function(){throw oc[44];},nj:function(a,b,c,d){return J.createNode(a,b,c,d)},rename:function(a,b,c){if(16384===(a.mode&61440)){try{var d=pc(b,c)}catch(f){}if(d)for(var e in d.di)throw new I(55);
}delete a.parent.di[a.name];a.parent.timestamp=Date.now();a.name=c;b.di[c]=a;b.timestamp=a.parent.timestamp;a.parent=b},unlink:function(a,b){delete a.di[b];a.timestamp=Date.now()},rmdir:function(a,b){var c=pc(a,b),d;for(d in c.di)throw new I(55);delete a.di[b];a.timestamp=Date.now()},readdir:function(a){var b=[".",".."],c;for(c in a.di)a.di.hasOwnProperty(c)&&b.push(c);return b},symlink:function(a,b,c){a=J.createNode(a,b,41471,0);a.link=c;return a},readlink:function(a){if(40960!==(a.mode&61440))throw new I(28);
return a.link}},fi:{read:function(a,b,c,d,e){var f=a.node.di;if(e>=a.node.ji)return 0;a=Math.min(a.node.ji-e,d);if(8<a&&f.subarray)b.set(f.subarray(e,e+a),c);else for(d=0;d<a;d++)b[c+d]=f[e+d];return a},write:function(a,b,c,d,e,f){b.buffer===rb.buffer&&(f=!1);if(!d)return 0;a=a.node;a.timestamp=Date.now();if(b.subarray&&(!a.di||a.di.subarray)){if(f)return a.di=b.subarray(c,c+d),a.ji=d;if(0===a.ji&&0===e)return a.di=b.slice(c,c+d),a.ji=d;if(e+d<=a.ji)return a.di.set(b.subarray(c,c+d),e),d}J.Yj(a,e+
d);if(a.di.subarray&&b.subarray)a.di.set(b.subarray(c,c+d),e);else for(f=0;f<d;f++)a.di[e+f]=b[c+f];a.ji=Math.max(a.ji,e+d);return d},Ii:function(a,b,c){1===c?b+=a.position:2===c&&32768===(a.node.mode&61440)&&(b+=a.node.ji);if(0>b)throw new I(28);return b},Qj:function(a,b,c){J.Yj(a.node,b+c);a.node.ji=Math.max(a.node.ji,b+c)},Ej:function(a,b,c,d,e){if(32768!==(a.node.mode&61440))throw new I(43);a=a.node.di;if(e&2||a.buffer!==qb){if(0<c||c+b<a.length)a.subarray?a=a.subarray(c,c+b):a=Array.prototype.slice.call(a,
c,c+b);c=!0;gb();b=void 0;if(!b)throw new I(48);rb.set(a,b)}else c=!1,b=a.byteOffset;return{ii:b,nl:c}},ik:function(a,b,c,d){J.fi.write(a,b,0,d,c,!1);return 0}}};function qc(a,b,c){var d="al "+a;$a(a,function(e){e||gb('Loading data file "'+a+'" failed (no arrayBuffer).');b(new Uint8Array(e));d&&Kb(d)},function(){if(c)c();else throw'Loading data file "'+a+'" failed.';});d&&Jb(d)}var rc=null,sc={},tc=[],uc=1,vc=null,wc=!0,I=null,oc={};
function xc(a,b){b=void 0===b?{}:b;a=dc("/",a);if(!a)return{path:"",node:null};b=Object.assign({$j:!0,Gj:0},b);if(8<b.Gj)throw new I(32);a=Zb(a.split("/").filter(function(k){return!!k}),!1);for(var c=rc,d="/",e=0;e<a.length;e++){var f=e===a.length-1;if(f&&b.parent)break;c=pc(c,a[e]);d=$b(d+"/"+a[e]);c.Xi&&(!f||f&&b.$j)&&(c=c.Xi.root);if(!f||b.wj)for(f=0;40960===(c.mode&61440);)if(c=yc(d),d=dc(ac(d),c),c=xc(d,{Gj:b.Gj+1}).node,40<f++)throw new I(32);}return{path:d,node:c}}
function zc(a){for(var b;;){if(a===a.parent)return a=a.Bi.hk,b?"/"!==a[a.length-1]?a+"/"+b:a+b:a;b=b?a.name+"/"+b:a.name;a=a.parent}}function Ac(a,b){for(var c=0,d=0;d<b.length;d++)c=(c<<5)-c+b.charCodeAt(d)|0;return(a+c>>>0)%vc.length}function pc(a,b){var c;if(c=(c=Bc(a,"x"))?c:a.ei.lookup?0:2)throw new I(c,a);for(c=vc[Ac(a.id,b)];c;c=c.Qi){var d=c.name;if(c.parent.id===a.id&&d===b)return c}return a.ei.lookup(a,b)}
function nc(a,b,c,d){a=new Cc(a,b,c,d);b=Ac(a.parent.id,a.name);a.Qi=vc[b];return vc[b]=a}var Dc={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090};function Ec(a){var b=["r","w","rw"][a&3];a&512&&(b+="w");return b}function Bc(a,b){if(wc)return 0;if(!b.includes("r")||a.mode&292){if(b.includes("w")&&!(a.mode&146)||b.includes("x")&&!(a.mode&73))return 2}else return 2;return 0}function Fc(a,b){try{return pc(a,b),20}catch(c){}return Bc(a,"wx")}
function Gc(a){var b=void 0;b=void 0===b?4096:b;for(a=void 0===a?0:a;a<=b;a++)if(!tc[a])return a;throw new I(33);}
function Hc(a,b){Ic||(Ic=function(){this.gi={}},Ic.prototype={},Object.defineProperties(Ic.prototype,{object:{get:function(){return this.node},set:function(c){this.node=c}},flags:{get:function(){return this.gi.flags},set:function(c){this.gi.flags=c}},position:{get:function(){return this.gi.position},set:function(c){this.gi.position=c}}}));a=Object.assign(new Ic,a);b=Gc(b);a.fd=b;return tc[b]=a}
var mc={open:function(a){a.fi=sc[a.node.rdev].fi;a.fi.open&&a.fi.open(a)},Ii:function(){throw new I(70);}};function ic(a,b){sc[a]={fi:b}}function Jc(a,b){var c="/"===b,d=!b;if(c&&rc)throw new I(10);if(!c&&!d){var e=xc(b,{$j:!1});b=e.path;e=e.node;if(e.Xi)throw new I(10);if(16384!==(e.mode&61440))throw new I(54);}b={type:a,Bl:{},hk:b,Ok:[]};a=a.Bi(b);a.Bi=b;b.root=a;c?rc=a:e&&(e.Xi=b,e.Bi&&e.Bi.Ok.push(b))}
function Kc(a,b,c){var d=xc(a,{parent:!0}).node;a=bc(a);if(!a||"."===a||".."===a)throw new I(28);var e=Fc(d,a);if(e)throw new I(e);if(!d.ei.nj)throw new I(63);return d.ei.nj(d,a,b,c)}function Lc(a){return Kc(a,16895,0)}function Mc(a,b,c){"undefined"==typeof c&&(c=b,b=438);return Kc(a,b|8192,c)}function Rc(a,b){if(!dc(a))throw new I(44);var c=xc(b,{parent:!0}).node;if(!c)throw new I(44);b=bc(b);var d=Fc(c,b);if(d)throw new I(d);if(!c.ei.symlink)throw new I(63);c.ei.symlink(c,b,a)}
function Sc(a){var b=xc(a,{parent:!0}).node;if(!b)throw new I(44);var c=bc(a);a=pc(b,c);a:{try{var d=pc(b,c)}catch(f){d=f.Fi;break a}var e=Bc(b,"wx");d=e?e:16384===(d.mode&61440)?31:0}if(d)throw new I(d);if(!b.ei.unlink)throw new I(63);if(a.Xi)throw new I(10);b.ei.unlink(b,c);b=Ac(a.parent.id,a.name);if(vc[b]===a)vc[b]=a.Qi;else for(b=vc[b];b;){if(b.Qi===a){b.Qi=a.Qi;break}b=b.Qi}}
function yc(a){a=xc(a).node;if(!a)throw new I(44);if(!a.ei.readlink)throw new I(28);return dc(zc(a.parent),a.ei.readlink(a))}function Tc(a,b){a="string"==typeof a?xc(a,{wj:!0}).node:a;if(!a.ei.ri)throw new I(63);a.ei.ri(a,{mode:b&4095|a.mode&-4096,timestamp:Date.now()})}
function Uc(a,b,c){if(""===a)throw new I(44);if("string"==typeof b){var d=Dc[b];if("undefined"==typeof d)throw Error("Unknown file open mode: "+b);b=d}c=b&64?("undefined"==typeof c?438:c)&4095|32768:0;if("object"==typeof a)var e=a;else{a=$b(a);try{e=xc(a,{wj:!(b&131072)}).node}catch(f){}}d=!1;if(b&64)if(e){if(b&128)throw new I(20);}else e=Kc(a,c,0),d=!0;if(!e)throw new I(44);8192===(e.mode&61440)&&(b&=-513);if(b&65536&&16384!==(e.mode&61440))throw new I(54);if(!d&&(c=e?40960===(e.mode&61440)?32:16384===
(e.mode&61440)&&("r"!==Ec(b)||b&512)?31:Bc(e,Ec(b)):44))throw new I(c);if(b&512&&!d){c=e;c="string"==typeof c?xc(c,{wj:!0}).node:c;if(!c.ei.ri)throw new I(63);if(16384===(c.mode&61440))throw new I(31);if(32768!==(c.mode&61440))throw new I(28);if(d=Bc(c,"w"))throw new I(d);c.ei.ri(c,{size:0,timestamp:Date.now()})}b&=-131713;e=Hc({node:e,path:zc(e),flags:b,seekable:!0,position:0,fi:e.fi,ll:[],error:!1});e.fi.open&&e.fi.open(e);!g.logReadFiles||b&1||(Vc||(Vc={}),a in Vc||(Vc[a]=1));return e}
function Wc(a){if(null===a.fd)throw new I(8);a.xj&&(a.xj=null);try{a.fi.close&&a.fi.close(a)}catch(b){throw b;}finally{tc[a.fd]=null}a.fd=null}function Xc(a,b,c){if(null===a.fd)throw new I(8);if(!a.seekable||!a.fi.Ii)throw new I(70);if(0!=c&&1!=c&&2!=c)throw new I(28);a.position=a.fi.Ii(a,b,c);a.ll=[]}
function Yc(a,b,c,d,e,f){if(0>d||0>e)throw new I(28);if(null===a.fd)throw new I(8);if(0===(a.flags&2097155))throw new I(8);if(16384===(a.node.mode&61440))throw new I(31);if(!a.fi.write)throw new I(28);a.seekable&&a.flags&1024&&Xc(a,0,2);var k="undefined"!=typeof e;if(!k)e=a.position;else if(!a.seekable)throw new I(70);b=a.fi.write(a,b,c,d,e,f);k||(a.position+=b);return b}
function Zc(){I||(I=function(a,b){this.node=b;this.$k=function(c){this.Fi=c};this.$k(a);this.message="FS error"},I.prototype=Error(),I.prototype.constructor=I,[44].forEach(function(a){oc[a]=new I(a);oc[a].stack="<generic error, no stack>"}))}var $c;function ad(a,b){var c=0;a&&(c|=365);b&&(c|=146);return c}function bd(a,b){a="string"==typeof a?a:zc(a);for(b=b.split("/").reverse();b.length;){var c=b.pop();if(c){var d=$b(a+"/"+c);try{Lc(d)}catch(e){}a=d}}return d}
function cd(a,b,c,d){a=$b(("string"==typeof a?a:zc(a))+"/"+b);c=ad(c,d);return Kc(a,(void 0!==c?c:438)&4095|32768,0)}function dd(a,b,c,d,e,f){var k=b;a&&(a="string"==typeof a?a:zc(a),k=b?$b(a+"/"+b):a);a=ad(d,e);k=Kc(k,(void 0!==a?a:438)&4095|32768,0);if(c){if("string"==typeof c){b=Array(c.length);d=0;for(e=c.length;d<e;++d)b[d]=c.charCodeAt(d);c=b}Tc(k,a|146);b=Uc(k,577);Yc(b,c,0,c.length,0,f);Wc(b);Tc(k,a)}return k}
function ed(a,b,c,d){a=$b(("string"==typeof a?a:zc(a))+"/"+b);b=ad(!!c,!!d);ed.gk||(ed.gk=64);var e=ed.gk++<<8|0;ic(e,{open:function(f){f.seekable=!1},close:function(){d&&d.buffer&&d.buffer.length&&d(10)},read:function(f,k,m,p){for(var u=0,v=0;v<p;v++){try{var C=c()}catch(D){throw new I(29);}if(void 0===C&&0===u)throw new I(6);if(null===C||void 0===C)break;u++;k[m+v]=C}u&&(f.node.timestamp=Date.now());return u},write:function(f,k,m,p){for(var u=0;u<p;u++)try{d(k[m+u])}catch(v){throw new I(29);}p&&
(f.node.timestamp=Date.now());return u}});return Mc(a,b,e)}function fd(a){if(!(a.Hk||a.Ik||a.link||a.di)){if("undefined"!=typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(Va)try{a.di=ec(Va(a.url),!0),a.ji=a.di.length}catch(b){throw new I(29);}else throw Error("Cannot load without read() or XMLHttpRequest.");}}
function gd(a,b,c,d,e){function f(){this.Cj=!1;this.gi=[]}f.prototype.get=function(v){if(!(v>this.length-1||0>v)){var C=v%this.chunkSize;return this.Pi(v/this.chunkSize|0)[C]}};f.prototype.si=function(v){this.Pi=v};f.prototype.Rj=function(){var v=new XMLHttpRequest;v.open("HEAD",c,!1);v.send(null);if(!(200<=v.status&&300>v.status||304===v.status))throw Error("Couldn't load "+c+". Status: "+v.status);var C=Number(v.getResponseHeader("Content-length")),D,q=(D=v.getResponseHeader("Accept-Ranges"))&&
"bytes"===D;v=(D=v.getResponseHeader("Content-Encoding"))&&"gzip"===D;var y=1048576;q||(y=C);var F=this;F.si(function(R){var ba=R*y,M=(R+1)*y-1;M=Math.min(M,C-1);if("undefined"==typeof F.gi[R]){var G=F.gi;if(ba>M)throw Error("invalid range ("+ba+", "+M+") or no bytes requested!");if(M>C-1)throw Error("only "+C+" bytes available! programmer error!");var A=new XMLHttpRequest;A.open("GET",c,!1);C!==y&&A.setRequestHeader("Range","bytes="+ba+"-"+M);A.responseType="arraybuffer";A.overrideMimeType&&A.overrideMimeType("text/plain; charset=x-user-defined");
A.send(null);if(!(200<=A.status&&300>A.status||304===A.status))throw Error("Couldn't load "+c+". Status: "+A.status);ba=void 0!==A.response?new Uint8Array(A.response||[]):ec(A.responseText||"",!0);G[R]=ba}if("undefined"==typeof F.gi[R])throw Error("doXHR failed!");return F.gi[R]});if(v||!C)y=C=1,y=C=this.Pi(0).length,eb("LazyFiles on gzip forces download of the whole file when length is accessed");this.sk=C;this.rk=y;this.Cj=!0};if("undefined"!=typeof XMLHttpRequest){if(!Sa)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";
var k=new f;Object.defineProperties(k,{length:{get:function(){this.Cj||this.Rj();return this.sk}},chunkSize:{get:function(){this.Cj||this.Rj();return this.rk}}});var m=void 0}else m=c,k=void 0;var p=cd(a,b,d,e);k?p.di=k:m&&(p.di=null,p.url=m);Object.defineProperties(p,{ji:{get:function(){return this.di.length}}});var u={};Object.keys(p.fi).forEach(function(v){var C=p.fi[v];u[v]=function(){fd(p);return C.apply(null,arguments)}});u.read=function(v,C,D,q,y){fd(p);v=v.node.di;if(y>=v.length)C=0;else{q=
Math.min(v.length-y,q);if(v.slice)for(var F=0;F<q;F++)C[D+F]=v[y+F];else for(F=0;F<q;F++)C[D+F]=v.get(y+F);C=q}return C};u.Ej=function(){fd(p);gb();throw new I(48);};p.fi=u;return p}function hd(a,b,c,d,e,f,k,m,p,u){function v(q){function y(F){u&&u();m||dd(a,b,F,d,e,p);f&&f();Kb(D)}jd(q,C,y,function(){k&&k();Kb(D)})||y(q)}var C=b?dc($b(a+"/"+b)):a,D="cp "+C;Jb(D);"string"==typeof c?qc(c,function(q){return v(q)},k):v(c)}var kd={},Ic,Vc,ld=void 0;function md(){ld+=4;return E[ld-4>>2]}
function nd(a){a=tc[a];if(!a)throw new I(8);return a}var od={};function pd(a){for(;a.length;){var b=a.pop();a.pop()(b)}}function qd(a){return this.fromWireType(E[a>>2])}var rd={},sd={},td={};function ud(a){if(void 0===a)return"_unknown";a=a.replace(/[^a-zA-Z0-9_]/g,"$");var b=a.charCodeAt(0);return 48<=b&&57>=b?"_"+a:a}function vd(a,b){a=ud(a);return(new Function("body","return function "+a+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n'))(b)}
function wd(a){var b=Error,c=vd(a,function(d){this.name=a;this.message=d;d=Error(d).stack;void 0!==d&&(this.stack=this.toString()+"\n"+d.replace(/^Error(:[^\n]*)?\n/,""))});c.prototype=Object.create(b.prototype);c.prototype.constructor=c;c.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message};return c}var xd=void 0;function yd(a){throw new xd(a);}
function zd(a,b,c){function d(m){m=c(m);m.length!==a.length&&yd("Mismatched type converter count");for(var p=0;p<a.length;++p)Bd(a[p],m[p])}a.forEach(function(m){td[m]=b});var e=Array(b.length),f=[],k=0;b.forEach(function(m,p){sd.hasOwnProperty(m)?e[p]=sd[m]:(f.push(m),rd.hasOwnProperty(m)||(rd[m]=[]),rd[m].push(function(){e[p]=sd[m];++k;k===f.length&&d(e)}))});0===f.length&&d(e)}var Cd={};
function Dd(a){switch(a){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+a);}}var Ed=void 0;function Fd(a){for(var b="";t[a];)b+=Ed[t[a++]];return b}var Gd=void 0;function Hd(a){throw new Gd(a);}
function Bd(a,b,c){c=void 0===c?{}:c;if(!("argPackAdvance"in b))throw new TypeError("registerType registeredInstance requires argPackAdvance");var d=b.name;a||Hd('type "'+d+'" must have a positive integer typeid pointer');if(sd.hasOwnProperty(a)){if(c.Ek)return;Hd("Cannot register type '"+d+"' twice")}sd[a]=b;delete td[a];rd.hasOwnProperty(a)&&(b=rd[a],delete rd[a],b.forEach(function(e){return e()}))}function Id(a){Hd(a.ci.li.ki.name+" instance already deleted")}var Jd=!1;function Kd(){}
function Ld(a){--a.count.value;0===a.count.value&&(a.oi?a.ui.ti(a.oi):a.li.ki.ti(a.ii))}function Md(a,b,c){if(b===c)return a;if(void 0===c.vi)return null;a=Md(a,b,c.vi);return null===a?null:c.xk(a)}var Nd={},Od=[];function Pd(){for(;Od.length;){var a=Od.pop();a.ci.Oi=!1;a["delete"]()}}var Qd=void 0,Rd={};function Sd(a,b){for(void 0===b&&Hd("ptr should not be undefined");a.vi;)b=a.$i(b),a=a.vi;return Rd[b]}
function Td(a,b){b.li&&b.ii||yd("makeClassHandle requires ptr and ptrType");!!b.ui!==!!b.oi&&yd("Both smartPtrType and smartPtr must be specified");b.count={value:1};return Ud(Object.create(a,{ci:{value:b}}))}function Ud(a){if("undefined"===typeof FinalizationRegistry)return Ud=function(b){return b},a;Jd=new FinalizationRegistry(function(b){Ld(b.ci)});Ud=function(b){var c=b.ci;c.oi&&Jd.register(b,{ci:c},b);return b};Kd=function(b){Jd.unregister(b)};return Ud(a)}function Vd(){}
function Wd(a,b,c){if(void 0===a[b].Ci){var d=a[b];a[b]=function(){a[b].Ci.hasOwnProperty(arguments.length)||Hd("Function '"+c+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+a[b].Ci+")!");return a[b].Ci[arguments.length].apply(this,arguments)};a[b].Ci=[];a[b].Ci[d.uj]=d}}
function Xd(a,b){g.hasOwnProperty(a)?(Hd("Cannot register public name '"+a+"' twice"),Wd(g,a,a),g.hasOwnProperty(void 0)&&Hd("Cannot register multiple overloads of a function with the same number of arguments (undefined)!"),g[a].Ci[void 0]=b):g[a]=b}function Yd(a,b,c,d,e,f,k,m){this.name=a;this.constructor=b;this.Wi=c;this.ti=d;this.vi=e;this.Ak=f;this.$i=k;this.xk=m}
function Zd(a,b,c){for(;b!==c;)b.$i||Hd("Expected null or instance of "+c.name+", got an instance of "+b.name),a=b.$i(a),b=b.vi;return a}function $d(a,b){if(null===b)return this.Bj&&Hd("null is not a valid "+this.name),0;b.ci||Hd('Cannot pass "'+ae(b)+'" as a '+this.name);b.ci.ii||Hd("Cannot pass deleted object as a pointer of type "+this.name);return Zd(b.ci.ii,b.ci.li.ki,this.ki)}
function be(a,b){if(null===b){this.Bj&&Hd("null is not a valid "+this.name);if(this.ij){var c=this.Zi();null!==a&&a.push(this.ti,c);return c}return 0}b.ci||Hd('Cannot pass "'+ae(b)+'" as a '+this.name);b.ci.ii||Hd("Cannot pass deleted object as a pointer of type "+this.name);!this.hj&&b.ci.li.hj&&Hd("Cannot convert argument of type "+(b.ci.ui?b.ci.ui.name:b.ci.li.name)+" to parameter type "+this.name);c=Zd(b.ci.ii,b.ci.li.ki,this.ki);if(this.ij)switch(void 0===b.ci.oi&&Hd("Passing raw pointer to smart pointer is illegal"),
this.fl){case 0:b.ci.ui===this?c=b.ci.oi:Hd("Cannot convert argument of type "+(b.ci.ui?b.ci.ui.name:b.ci.li.name)+" to parameter type "+this.name);break;case 1:c=b.ci.oi;break;case 2:if(b.ci.ui===this)c=b.ci.oi;else{var d=b.clone();c=this.Vk(c,ce(function(){d["delete"]()}));null!==a&&a.push(this.ti,c)}break;default:Hd("Unsupporting sharing policy")}return c}
function de(a,b){if(null===b)return this.Bj&&Hd("null is not a valid "+this.name),0;b.ci||Hd('Cannot pass "'+ae(b)+'" as a '+this.name);b.ci.ii||Hd("Cannot pass deleted object as a pointer of type "+this.name);b.ci.li.hj&&Hd("Cannot convert argument of type "+b.ci.li.name+" to parameter type "+this.name);return Zd(b.ci.ii,b.ci.li.ki,this.ki)}
function ee(a,b,c,d){this.name=a;this.ki=b;this.Bj=c;this.hj=d;this.ij=!1;this.ti=this.Vk=this.Zi=this.kk=this.fl=this.Tk=void 0;void 0!==b.vi?this.toWireType=be:(this.toWireType=d?$d:de,this.pi=null)}function fe(a,b){g.hasOwnProperty(a)||yd("Replacing nonexistant public symbol");g[a]=b;g[a].uj=void 0}
function ge(a,b){var c=[];return function(){c.length=0;Object.assign(c,arguments);if(a.includes("j")){var d=g["dynCall_"+a];d=c&&c.length?d.apply(null,[b].concat(c)):d.call(null,b)}else d=wb.get(b).apply(null,c);return d}}function he(a,b){a=Fd(a);var c=a.includes("j")?ge(a,b):wb.get(b);"function"!=typeof c&&Hd("unknown function pointer with signature "+a+": "+b);return c}var ie=void 0;function je(a){a=ke(a);var b=Fd(a);le(a);return b}
function me(a,b){function c(f){e[f]||sd[f]||(td[f]?td[f].forEach(c):(d.push(f),e[f]=!0))}var d=[],e={};b.forEach(c);throw new ie(a+": "+d.map(je).join([", "]));}function ne(a){var b=Function;if(!(b instanceof Function))throw new TypeError("new_ called with constructor type "+typeof b+" which is not a function");var c=vd(b.name||"unknownFunctionName",function(){});c.prototype=b.prototype;c=new c;a=b.apply(c,a);return a instanceof Object?a:c}
function oe(a,b){for(var c=[],d=0;d<a;d++)c.push(h[b+4*d>>2]);return c}var pe=[],qe=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function re(a){4<a&&0===--qe[a].Hj&&(qe[a]=void 0,pe.push(a))}function se(a){a||Hd("Cannot use deleted val. handle = "+a);return qe[a].value}function ce(a){switch(a){case void 0:return 1;case null:return 2;case !0:return 3;case !1:return 4;default:var b=pe.length?pe.pop():qe.length;qe[b]={Hj:1,value:a};return b}}
function te(a,b,c){switch(b){case 0:return function(d){return this.fromWireType((c?rb:t)[d])};case 1:return function(d){return this.fromWireType((c?tb:ub)[d>>1])};case 2:return function(d){return this.fromWireType((c?E:h)[d>>2])};default:throw new TypeError("Unknown integer type: "+a);}}function ue(a,b){var c=sd[a];void 0===c&&Hd(b+" has unknown type "+je(a));return c}function ae(a){if(null===a)return"null";var b=typeof a;return"object"===b||"array"===b||"function"===b?a.toString():""+a}
function ve(a,b){switch(b){case 2:return function(c){return this.fromWireType(B[c>>2])};case 3:return function(c){return this.fromWireType(Fa[c>>3])};default:throw new TypeError("Unknown float type: "+a);}}
function xe(a,b,c){switch(b){case 0:return c?function(d){return rb[d]}:function(d){return t[d]};case 1:return c?function(d){return tb[d>>1]}:function(d){return ub[d>>1]};case 2:return c?function(d){return E[d>>2]}:function(d){return h[d>>2]};default:throw new TypeError("Unknown integer type: "+a);}}var ye="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;
function ze(a,b){var c=a>>1;for(var d=c+b/2;!(c>=d)&&ub[c];)++c;c<<=1;if(32<c-a&&ye)return ye.decode(t.subarray(a,c));c="";for(d=0;!(d>=b/2);++d){var e=tb[a+2*d>>1];if(0==e)break;c+=String.fromCharCode(e)}return c}function Ae(a,b,c){void 0===c&&(c=2147483647);if(2>c)return 0;c-=2;var d=b;c=c<2*a.length?c/2:a.length;for(var e=0;e<c;++e)tb[b>>1]=a.charCodeAt(e),b+=2;tb[b>>1]=0;return b-d}function Be(a){return 2*a.length}
function Ce(a,b){for(var c=0,d="";!(c>=b/4);){var e=E[a+4*c>>2];if(0==e)break;++c;65536<=e?(e-=65536,d+=String.fromCharCode(55296|e>>10,56320|e&1023)):d+=String.fromCharCode(e)}return d}function De(a,b,c){void 0===c&&(c=2147483647);if(4>c)return 0;var d=b;c=d+c-4;for(var e=0;e<a.length;++e){var f=a.charCodeAt(e);if(55296<=f&&57343>=f){var k=a.charCodeAt(++e);f=65536+((f&1023)<<10)|k&1023}E[b>>2]=f;b+=4;if(b+4>c)break}E[b>>2]=0;return b-d}
function Ee(a){for(var b=0,c=0;c<a.length;++c){var d=a.charCodeAt(c);55296<=d&&57343>=d&&++c;b+=4}return b}var Fe="object"==typeof performance&&performance&&"function"==typeof performance.now||Ta;function Ge(a,b){for(var c=Array(a),d=0;d<a;++d)c[d]=ue(h[b+4*d>>2],"parameter "+d);return c}var He={};function Ie(a){var b=He[a];return void 0===b?Fd(a):b}var Je=[];function Ke(){return"object"==typeof globalThis?globalThis:Function("return this")()}function Le(a){var b=Je.length;Je.push(a);return b}
var Me=[];
function Ne(a){for(var b="",c=0;c<a;++c)b+=(0!==c?", ":"")+"arg"+c;var d="return function emval_allocator_"+a+"(constructor, argTypes, args) {\n  var HEAPU32 = getMemory();\n";for(c=0;c<a;++c)d+="var argType"+c+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+c+"');\nvar arg"+c+" = argType"+c+".readValueFromPointer(args);\nargs += argType"+c+"['argPackAdvance'];\nargTypes += 4;\n";return(new Function("requireRegisteredType","Module","valueToHandle","getMemory",d+("var obj = new constructor("+b+
");\nreturn valueToHandle(obj);\n}\n")))(ue,g,ce,function(){return h})}var Oe={},Pe=[];
function Qe(a,b){Re=a;Se=b;if(Te)if(Ue||(Ue=!0),0==a)Ve=function(){var d=Math.max(0,We+b-Xe())|0;setTimeout(Ye,d)};else if(1==a)Ve=function(){Ze(Ye)};else if(2==a){if("undefined"==typeof setImmediate){var c=[];addEventListener("message",function(d){if("setimmediate"===d.data||"setimmediate"===d.data.target)d.stopPropagation(),c.shift()()},!0);setImmediate=function(d){c.push(d);Sa?(void 0===g.setImmediates&&(g.setImmediates=[]),g.setImmediates.push(d),postMessage({target:"setimmediate"})):postMessage("setimmediate",
"*")}}Ve=function(){setImmediate(Ye)}}}var Xe;Ta?Xe=function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E6}:"undefined"!=typeof performance&&performance.now?Xe=function(){return performance.now()}:Xe=Date.now;function $e(a){if(!noExitRuntime){if(g.onExit)g.onExit(a);lb=!0}Pa(a,new cb(a))}function af(a){a instanceof cb||"unwind"==a||Pa(1,a)}
function bf(a){!Te||gb("emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters.");Te=a;var b=cf;Ue=!1;Ye=function(){if(!lb)if(0<df.length){var c=Date.now(),d=df.shift();d.ul(d.ol);if(ef){var e=ef,f=0==e%1?e-1:Math.floor(e);ef=d.pl?f:(8*e+(f+.5))/9}eb('main loop blocker "'+d.name+'" took '+(Date.now()-c)+" ms");g.setStatus&&(c=g.statusMessage||"Please wait...",d=ef,e=
ff.tl,d?d<e?g.setStatus(c+" ("+(e-d)+"/"+e+")"):g.setStatus(c):g.setStatus(""));b<cf||setTimeout(Ye,0)}else b<cf||(gf=gf+1|0,1==Re&&1<Se&&0!=gf%Se?Ve():(0==Re&&(We=Xe()),lb||g.preMainLoop&&!1===g.preMainLoop()||(hf(a),g.postMainLoop&&g.postMainLoop()),b<cf||("object"==typeof SDL&&SDL.audio&&SDL.audio.Uk&&SDL.audio.Uk(),Ve())))}}function hf(a){if(!lb)try{a()}catch(b){af(b)}}function jf(a,b){setTimeout(function(){hf(a)},b)}function kf(a){lf||(lf={});lf[a]||(lf[a]=1,Ta&&(a="warning: "+a),db(a))}
var lf,Ue=!1,Ve=null,cf=0,Te=null,Re=0,Se=0,gf=0,df=[],ff={},We,Ye,ef,mf=!1,nf=!1,of=[];
function pf(){function a(){nf=document.pointerLockElement===g.canvas||document.mozPointerLockElement===g.canvas||document.webkitPointerLockElement===g.canvas||document.msPointerLockElement===g.canvas}g.preloadPlugins||(g.preloadPlugins=[]);if(!qf){qf=!0;try{rf=!0}catch(c){rf=!1,db("warning: no blob constructor, cannot create blobs with mimetypes")}sf="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:rf?null:db("warning: no BlobBuilder");tf="undefined"!=
typeof window?window.URL?window.URL:window.webkitURL:void 0;g.jk||"undefined"!=typeof tf||(db("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),g.jk=!0);g.preloadPlugins.push({canHandle:function(c){return!g.jk&&/\.(jpg|jpeg|png|bmp)$/i.test(c)},handle:function(c,d,e,f){var k=null;if(rf)try{k=new Blob([c],{type:uf(d)}),k.size!==c.length&&(k=new Blob([(new Uint8Array(c)).buffer],{type:uf(d)}))}catch(u){kf("Blob constructor present but fails: "+
u+"; falling back to blob builder")}k||(k=new sf,k.append((new Uint8Array(c)).buffer),k=k.getBlob());var m=tf.createObjectURL(k),p=new Image;p.onload=function(){p.complete||gb("Image "+d+" could not be decoded");var u=document.createElement("canvas");u.width=p.width;u.height=p.height;u.getContext("2d").drawImage(p,0,0);tf.revokeObjectURL(m);e&&e(c)};p.onerror=function(){eb("Image "+m+" could not be decoded");f&&f()};p.src=m}});g.preloadPlugins.push({canHandle:function(c){return!g.Al&&c.substr(-4)in
{".ogg":1,".wav":1,".mp3":1}},handle:function(c,d,e,f){function k(){p||(p=!0,e&&e(c))}function m(){p||(p=!0,new Audio,f&&f())}var p=!1;if(rf){try{var u=new Blob([c],{type:uf(d)})}catch(C){return m()}u=tf.createObjectURL(u);var v=new Audio;v.addEventListener("canplaythrough",function(){return k(v)},!1);v.onerror=function(){if(!p){db("warning: browser could not fully decode audio "+d+", trying slower base64 approach");for(var C="",D=0,q=0,y=0;y<c.length;y++)for(D=D<<8|c[y],q+=8;6<=q;){var F=D>>q-6&
63;q-=6;C+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[F]}2==q?(C+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(D&3)<<4],C+="=="):4==q&&(C+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(D&15)<<2],C+="=");v.src="data:audio/x-"+d.substr(-3)+";base64,"+C;k(v)}};v.src=u;jf(function(){k(v)},1E4)}else return m()}});var b=g.canvas;b&&(b.requestPointerLock=b.requestPointerLock||b.mozRequestPointerLock||b.webkitRequestPointerLock||b.msRequestPointerLock||
function(){},b.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},b.exitPointerLock=b.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",a,!1),document.addEventListener("mozpointerlockchange",a,!1),document.addEventListener("webkitpointerlockchange",a,!1),document.addEventListener("mspointerlockchange",a,!1),g.elementPointerLock&&b.addEventListener("click",function(c){!nf&&g.canvas.requestPointerLock&&
(g.canvas.requestPointerLock(),c.preventDefault())},!1))}}function jd(a,b,c,d){pf();var e=!1;g.preloadPlugins.forEach(function(f){!e&&f.canHandle(b)&&(f.handle(a,b,c,d),e=!0)});return e}
function vf(a,b,c,d){if(b&&g.Ti&&a==g.canvas)return g.Ti;var e;if(b){var f={antialias:!1,alpha:!1,Dj:"undefined"!=typeof WebGL2RenderingContext?2:1};if(d)for(var k in d)f[k]=d[k];if("undefined"!=typeof wf&&(e=xf(a,f)))var m=yf[e].Ni}else m=a.getContext("2d");if(!m)return null;c&&(b||"undefined"==typeof N||gb("cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),g.Ti=m,b&&zf(e),g.Gl=b,of.forEach(function(p){p()}),pf());return m}var Af=!1,Bf=void 0,Cf=void 0;
function Df(a,b){function c(){mf=!1;var f=d.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===f?(d.exitFullscreen=Ef,Bf&&d.requestPointerLock(),mf=!0,Cf?("undefined"!=typeof SDL&&(E[SDL.screen>>2]=h[SDL.screen>>2]|8388608),Ff(g.canvas),Gf()):Ff(d)):(f.parentNode.insertBefore(d,f),f.parentNode.removeChild(f),Cf?("undefined"!=typeof SDL&&(E[SDL.screen>>2]=h[SDL.screen>>2]&
-8388609),Ff(g.canvas),Gf()):Ff(d));if(g.onFullScreen)g.onFullScreen(mf);if(g.onFullscreen)g.onFullscreen(mf)}Bf=a;Cf=b;"undefined"==typeof Bf&&(Bf=!0);"undefined"==typeof Cf&&(Cf=!1);var d=g.canvas;Af||(Af=!0,document.addEventListener("fullscreenchange",c,!1),document.addEventListener("mozfullscreenchange",c,!1),document.addEventListener("webkitfullscreenchange",c,!1),document.addEventListener("MSFullscreenChange",c,!1));var e=document.createElement("div");d.parentNode.insertBefore(e,d);e.appendChild(d);
e.requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||(e.webkitRequestFullscreen?function(){return e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}:null)||(e.webkitRequestFullScreen?function(){return e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null);e.requestFullscreen()}
function Ef(){if(!mf)return!1;(document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]);return!0}var Hf=0;function If(a){var b=Date.now();if(0===Hf)Hf=b+1E3/60;else for(;b+2>=Hf;)Hf+=1E3/60;setTimeout(a,Math.max(Hf-b,0))}
function Ze(a){if("function"==typeof requestAnimationFrame)requestAnimationFrame(a);else{var b=If;"undefined"!=typeof window&&(b=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||b);b(a)}}function Jf(a){Ze(function(){hf(a)})}
function uf(a){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[a.substr(a.lastIndexOf(".")+1)]}var Kf=[];function Gf(){var a=g.canvas;Kf.forEach(function(b){b(a.width,a.height)})}
function Ff(a,b,c){b&&c?(a.ml=b,a.Dk=c):(b=a.ml,c=a.Dk);var d=b,e=c;g.forcedAspectRatio&&0<g.forcedAspectRatio&&(d/e<g.forcedAspectRatio?d=Math.round(e*g.forcedAspectRatio):e=Math.round(d/g.forcedAspectRatio));if((document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===a.parentNode&&"undefined"!=typeof screen){var f=Math.min(screen.width/d,screen.height/e);d=Math.round(d*f);e=Math.round(e*
f)}Cf?(a.width!=d&&(a.width=d),a.height!=e&&(a.height=e),"undefined"!=typeof a.style&&(a.style.removeProperty("width"),a.style.removeProperty("height"))):(a.width!=b&&(a.width=b),a.height!=c&&(a.height=c),"undefined"!=typeof a.style&&(d!=b||e!=c?(a.style.setProperty("width",d+"px","important"),a.style.setProperty("height",e+"px","important")):(a.style.removeProperty("width"),a.style.removeProperty("height"))))}var qf,rf,sf,tf;
function Lf(a){var b=a.getExtension("ANGLE_instanced_arrays");b&&(a.vertexAttribDivisor=function(c,d){b.vertexAttribDivisorANGLE(c,d)},a.drawArraysInstanced=function(c,d,e,f){b.drawArraysInstancedANGLE(c,d,e,f)},a.drawElementsInstanced=function(c,d,e,f,k){b.drawElementsInstancedANGLE(c,d,e,f,k)})}
function Mf(a){var b=a.getExtension("OES_vertex_array_object");b&&(a.createVertexArray=function(){return b.createVertexArrayOES()},a.deleteVertexArray=function(c){b.deleteVertexArrayOES(c)},a.bindVertexArray=function(c){b.bindVertexArrayOES(c)},a.isVertexArray=function(c){return b.isVertexArrayOES(c)})}function Nf(a){var b=a.getExtension("WEBGL_draw_buffers");b&&(a.drawBuffers=function(c,d){b.drawBuffersWEBGL(c,d)})}
var Of=1,Pf=[],Qf=[],Rf=[],Sf=[],Tf=[],Uf=[],Vf=[],yf=[],Wf={},Xf=[],Yf=[],Zf=[],$f=[],ag={},bg={},cg=4;function P(a){dg||(dg=a)}function eg(a){for(var b=Of++,c=a.length;c<b;c++)a[c]=null;return b}function fg(a,b,c){for(var d="",e=0;e<a;++e){var f=c?E[c+4*e>>2]:-1;d+=nb(E[b+4*e>>2],0>f?void 0:f)}return d}
function xf(a,b){function c(){var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(e)return e[2]|0}a.gi||(a.gi=a.getContext,a.getContext=function(e,f){f=a.gi(e,f);return"webgl"==e==f instanceof WebGLRenderingContext?f:null});var d=1<b.Dj?!(57>=c())&&a.getContext("webgl2",b):a.getContext("webgl",b)||a.getContext("experimental-webgl",b);return d?gg(d,b):0}
function gg(a,b){var c=eg(yf),d={wl:c,attributes:b,version:b.Dj,Ni:a};a.canvas&&(a.canvas.qk=d);yf[c]=d;("undefined"==typeof b.Xj||b.Xj)&&hg(d);return c}function zf(a){T=yf[a];g.Ti=N=T&&T.Ni;return!(a&&!N)}
function hg(a){a||(a=T);if(!a.Fk){a.Fk=!0;var b=a.Ni;Lf(b);Mf(b);Nf(b);b.ql=b.getExtension("WEBGL_draw_instanced_base_vertex_base_instance");b.xl=b.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance");2<=a.version&&(b.ni=b.getExtension("EXT_disjoint_timer_query_webgl2"));if(2>a.version||!b.ni)b.ni=b.getExtension("EXT_disjoint_timer_query");b.zl=b.getExtension("WEBGL_multi_draw");(b.getSupportedExtensions()||[]).forEach(function(c){c.includes("lose_context")||c.includes("debug")||b.getExtension(c)})}}
var wf={},dg,T,ig=[];function jg(a,b,c,d){N.drawElements(a,b,c,d)}function kg(a,b,c,d){for(var e=0;e<a;e++){var f=N[c](),k=f&&eg(d);f?(f.name=k,d[k]=f):P(1282);E[b+4*e>>2]=k}}function lg(a,b,c,d,e,f,k,m){b=Qf[b];if(a=N[a](b,c))d=m&&ob(a.name,t,m,d),e&&(E[e>>2]=d),f&&(E[f>>2]=a.size),k&&(E[k>>2]=a.type)}function mg(a,b){h[a>>2]=b;h[a+4>>2]=(b-h[a>>2])/4294967296}
function ng(a,b,c){if(b){var d=void 0;switch(a){case 36346:d=1;break;case 36344:0!=c&&1!=c&&P(1280);return;case 34814:case 36345:d=0;break;case 34466:var e=N.getParameter(34467);d=e?e.length:0;break;case 33309:if(2>T.version){P(1282);return}d=2*(N.getSupportedExtensions()||[]).length;break;case 33307:case 33308:if(2>T.version){P(1280);return}d=33307==a?3:0}if(void 0===d)switch(e=N.getParameter(a),typeof e){case "number":d=e;break;case "boolean":d=e?1:0;break;case "string":P(1280);return;case "object":if(null===
e)switch(a){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 36662:case 36663:case 35053:case 35055:case 36010:case 35097:case 35869:case 32874:case 36389:case 35983:case 35368:case 34068:d=0;break;default:P(1280);return}else{if(e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Array){for(a=0;a<e.length;++a)switch(c){case 0:E[b+4*a>>2]=e[a];break;case 2:B[b+4*a>>2]=e[a];break;case 4:rb[b+a>>0]=e[a]?1:0}return}try{d=e.name|0}catch(f){P(1280);
db("GL_INVALID_ENUM in glGet"+c+"v: Unknown object returned from WebGL getParameter("+a+")! (error: "+f+")");return}}break;default:P(1280);db("GL_INVALID_ENUM in glGet"+c+"v: Native code calling glGet"+c+"v("+a+") and it returns "+e+" of type "+typeof e+"!");return}switch(c){case 1:mg(b,d);break;case 0:E[b>>2]=d;break;case 2:B[b>>2]=d;break;case 4:rb[b>>0]=d?1:0}}else P(1281)}
function og(a,b,c,d){if(c){b=N.getIndexedParameter(a,b);switch(typeof b){case "boolean":a=b?1:0;break;case "number":a=b;break;case "object":if(null===b)switch(a){case 35983:case 35368:a=0;break;default:P(1280);return}else if(b instanceof WebGLBuffer)a=b.name|0;else{P(1280);return}break;default:P(1280);return}switch(d){case 1:mg(c,a);break;case 0:E[c>>2]=a;break;case 2:B[c>>2]=a;break;case 4:rb[c>>0]=a?1:0;break;default:throw"internal emscriptenWebGLGetIndexed() error, bad type: "+d;}}else P(1281)}
function pg(a){var b=pb(a)+1,c=qg(b);ob(a,t,c,b);return c}function rg(a){return"]"==a.slice(-1)&&a.lastIndexOf("[")}function sg(a){var b=a.Mi,c=a.sj,d;if(!b)for(a.Mi=b={},a.nk={},d=0;d<N.getProgramParameter(a,35718);++d){var e=N.getActiveUniform(a,d);var f=e.name;e=e.size;var k=rg(f);k=0<k?f.slice(0,k):f;var m=a.rj;a.rj+=e;c[k]=[e,m];for(f=0;f<e;++f)b[m]=f,a.nk[m++]=k}}
function V(a){var b=N.Vj;if(b){var c=b.Mi[a];"number"==typeof c&&(b.Mi[a]=c=N.getUniformLocation(b,b.nk[a]+(0<c?"["+c+"]":"")));return c}P(1282)}function tg(a,b,c,d){if(c)if(a=Qf[a],sg(a),a=N.getUniform(a,V(b)),"number"==typeof a||"boolean"==typeof a)switch(d){case 0:E[c>>2]=a;break;case 2:B[c>>2]=a}else for(b=0;b<a.length;b++)switch(d){case 0:E[c+4*b>>2]=a[b];break;case 2:B[c+4*b>>2]=a[b]}else P(1281)}
function ug(a,b,c,d){if(c)if(a=N.getVertexAttrib(a,b),34975==b)E[c>>2]=a&&a.name;else if("number"==typeof a||"boolean"==typeof a)switch(d){case 0:E[c>>2]=a;break;case 2:B[c>>2]=a;break;case 5:E[c>>2]=Math.fround(a)}else for(b=0;b<a.length;b++)switch(d){case 0:E[c+4*b>>2]=a[b];break;case 2:B[c+4*b>>2]=a[b];break;case 5:E[c+4*b>>2]=Math.fround(a[b])}else P(1281)}function vg(a){a-=5120;return 0==a?rb:1==a?t:2==a?tb:4==a?E:6==a?B:5==a||28922==a||28520==a||30779==a||30782==a?h:ub}
function wg(a){return 31-Math.clz32(a.BYTES_PER_ELEMENT)}function xg(a,b,c,d,e){a=vg(a);var f=wg(a),k=cg;return a.subarray(e>>f,e+d*(c*({5:3,6:4,8:2,29502:3,29504:4,26917:2,26918:2,29846:3,29847:4}[b-6402]||1)*(1<<f)+k-1&-k)>>f)}var yg=[],zg=[],Ag=[],Bg={},Cg=["default","low-power","high-performance"],Dg=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];
function Eg(a){try{if(!a)return window;"number"==typeof a&&(a=Dg[a]||nb(a));return"#window"===a?window:"#document"===a?document:"#screen"===a?screen:"#canvas"===a?g.canvas:"string"==typeof a?document.getElementById(a):a}catch(b){return null}}var Fg={};
function Gg(){if(!Hg){var a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:Oa||"./this.program"},b;for(b in Fg)void 0===Fg[b]?delete a[b]:a[b]=Fg[b];var c=[];for(b in a)c.push(b+"="+a[b]);Hg=c}return Hg}var Hg;
function Ig(a,b){a=new Uint8Array(a);var c=a.byteLength;g.fk+=c+24;if(327680>=c){var d=Ga();try{var e=Ka(c);t.subarray(e,e+c).set(a);b(e,c)}finally{La(d)}}else{e=qg(c);try{t.subarray(e,e+c).set(a),b(e,c)}finally{le(e)}}}
var Kg={connect:function(a,b,c){g.vj=b;g.oj=Jg("webSocketHandlerOnMessage",null,["number","number","number","number"]);g.Ji?g.Ji++:g.Ji=1;g.mk=!1;if(!g.worker){a=new Worker(URL.createObjectURL(new Blob(['var socket;self.onmessage = function (event) {\tif (event.data.constructor === ArrayBuffer) {\t\tsocket.send (event.data);\t} else if (event.data[0] === "connect") {\t\tsocket = new WebSocket (event.data[1]);\t\tsocket.binaryType = "arraybuffer";\t\tvar token = event.data[2];\t\tsocket.onclose = function (event) {\t\t\tself.postMessage (["close", token]);\t\t};\t\tsocket.onerror = function (event) {\t\t\tself.postMessage (["error", token]);\t\t};\t\tsocket.onopen = function (event) {\t\t\tself.postMessage (["open", token]);\t\t};\t\tsocket.onmessage = function (event) {\t\t\tself.postMessage (["data", event.data, token], [event.data]);\t\t};\t} else if (event.data[0] === "close") {\t\tsocket.close ();\t}}'],{type:"application/javascript"})));
g.worker=a;var d=function(e,f){g.oj(e,f,g.vj,2)};a.onmessage=function(e){g.$$facade&&("data"===e.data[0]?e.data[2]===g.Ji&&Ig(e.data[1],d):"open"===e.data[0]?e.data[1]===g.Ji&&(g.mk=!0,g.oj(0,0,g.vj,0)):"close"===e.data[0]?e.data[1]===g.Ji&&(g.oj(0,0,g.vj,3),g.hi("websocket_connection_closed")):"error"===e.data[0]&&e.data[1]===g.Ji&&g.hi(g.mk?"socket_error":"socket_open_failed"))}}g.worker.postMessage(["connect",nb(c),g.Ji])},Kj:function(a,b){g.worker&&(a=(new Uint8Array(t.subarray(a,a+b))).buffer,
g.worker.postMessage(a,[a]))},close:function(){g.worker&&g.worker.postMessage(["close"]);g.oj=function(){}}},Lg={connect:function(a,b,c){function d(m,p){f(m,p,b,2)}a=nb(c);var e=new WebSocket(a);g.Di=e;e.binaryType="arraybuffer";var f=Jg("webSocketHandlerOnMessage",null,["number","number","number","number"]),k=!1;e.onclose=function(){g.Di===e&&(f(0,0,b,3),g.hi("websocket_connection_closed"))};e.onerror=function(){g.Di===e&&g.hi(k?"socket_error":"socket_open_failed")};e.onopen=function(){g.Di===e&&
(k=!0,f(0,0,b,0))};e.onmessage=function(m){g.Di===e&&Ig(m.data,d)}},Kj:function(a,b){g.Di&&g.Di.send(t.subarray(a,a+b))},close:function(){g.Di&&g.Di.close();delete g.Di}};function Mg(a){return 0===a%4&&(0!==a%100||0===a%400)}var Ng=[31,29,31,30,31,30,31,31,30,31,30,31],Og=[31,28,31,30,31,30,31,31,30,31,30,31];
function Pg(a,b,c,d){function e(q,y,F){for(q="number"==typeof q?q.toString():q||"";q.length<y;)q=F[0]+q;return q}function f(q,y){return e(q,y,"0")}function k(q,y){function F(ba){return 0>ba?-1:0<ba?1:0}var R;0===(R=F(q.getFullYear()-y.getFullYear()))&&0===(R=F(q.getMonth()-y.getMonth()))&&(R=F(q.getDate()-y.getDate()));return R}function m(q){switch(q.getDay()){case 0:return new Date(q.getFullYear()-1,11,29);case 1:return q;case 2:return new Date(q.getFullYear(),0,3);case 3:return new Date(q.getFullYear(),
0,2);case 4:return new Date(q.getFullYear(),0,1);case 5:return new Date(q.getFullYear()-1,11,31);case 6:return new Date(q.getFullYear()-1,11,30)}}function p(q){var y=q.Ki;for(q=new Date((new Date(q.Li+1900,0,1)).getTime());0<y;){var F=q.getMonth(),R=(Mg(q.getFullYear())?Ng:Og)[F];if(y>R-q.getDate())y-=R-q.getDate()+1,q.setDate(1),11>F?q.setMonth(F+1):(q.setMonth(0),q.setFullYear(q.getFullYear()+1));else{q.setDate(q.getDate()+y);break}}F=new Date(q.getFullYear()+1,0,4);y=m(new Date(q.getFullYear(),
0,4));F=m(F);return 0>=k(y,q)?0>=k(F,q)?q.getFullYear()+1:q.getFullYear():q.getFullYear()-1}var u=E[d+40>>2];d={jl:E[d>>2],il:E[d+4>>2],pj:E[d+8>>2],Oj:E[d+12>>2],qj:E[d+16>>2],Li:E[d+20>>2],xi:E[d+24>>2],Ki:E[d+28>>2],El:E[d+32>>2],hl:E[d+36>>2],kl:u?nb(u):""};c=nb(c);u={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y",
"%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var v in u)c=c.replace(new RegExp(v,"g"),u[v]);var C="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),D="January February March April May June July August September October November December".split(" ");u={"%a":function(q){return C[q.xi].substring(0,3)},"%A":function(q){return C[q.xi]},"%b":function(q){return D[q.qj].substring(0,3)},
"%B":function(q){return D[q.qj]},"%C":function(q){return f((q.Li+1900)/100|0,2)},"%d":function(q){return f(q.Oj,2)},"%e":function(q){return e(q.Oj,2," ")},"%g":function(q){return p(q).toString().substring(2)},"%G":function(q){return p(q)},"%H":function(q){return f(q.pj,2)},"%I":function(q){q=q.pj;0==q?q=12:12<q&&(q-=12);return f(q,2)},"%j":function(q){for(var y=0,F=0;F<=q.qj-1;y+=(Mg(q.Li+1900)?Ng:Og)[F++]);return f(q.Oj+y,3)},"%m":function(q){return f(q.qj+1,2)},"%M":function(q){return f(q.il,2)},
"%n":function(){return"\n"},"%p":function(q){return 0<=q.pj&&12>q.pj?"AM":"PM"},"%S":function(q){return f(q.jl,2)},"%t":function(){return"\t"},"%u":function(q){return q.xi||7},"%U":function(q){return f(Math.floor((q.Ki+7-q.xi)/7),2)},"%V":function(q){var y=Math.floor((q.Ki+7-(q.xi+6)%7)/7);2>=(q.xi+371-q.Ki-2)%7&&y++;if(y)53==y&&(F=(q.xi+371-q.Ki)%7,4==F||3==F&&Mg(q.Li)||(y=1));else{y=52;var F=(q.xi+7-q.Ki-1)%7;(4==F||5==F&&Mg(q.Li%400-1))&&y++}return f(y,2)},"%w":function(q){return q.xi},"%W":function(q){return f(Math.floor((q.Ki+
7-(q.xi+6)%7)/7),2)},"%y":function(q){return(q.Li+1900).toString().substring(2)},"%Y":function(q){return q.Li+1900},"%z":function(q){q=q.hl;var y=0<=q;q=Math.abs(q)/60;return(y?"+":"-")+String("0000"+(q/60*100+q%60)).slice(-4)},"%Z":function(q){return q.kl},"%%":function(){return"%"}};c=c.replace(/%%/g,"\x00\x00");for(v in u)c.includes(v)&&(c=c.replace(new RegExp(v,"g"),u[v](d)));c=c.replace(/\0\0/g,"%");v=ec(c,!1);if(v.length>b)return 0;rb.set(v,a);return v.length-1}
function Qg(a,b,c,d){var e={string:function(u){var v=0;if(null!==u&&void 0!==u&&0!==u){var C=(u.length<<2)+1;v=Ka(C);ob(u,t,v,C)}return v},array:function(u){var v=Ka(u.length);rb.set(u,v);return v}};a=g["_"+a];var f=[],k=0;if(d)for(var m=0;m<d.length;m++){var p=e[c[m]];p?(0===k&&(k=Ga()),f[m]=p(d[m])):f[m]=d[m]}c=a.apply(null,f);return c=function(u){0!==k&&La(k);return"string"===b?nb(u):"boolean"===b?!!u:u}(c)}
function Jg(a,b,c,d){c=c||[];var e=c.every(function(f){return"number"===f||"boolean"===f});return"string"!==b&&e&&!d?g["_"+a]:function(){return Qg(a,b,c,arguments,d)}}function Cc(a,b,c,d){a||(a=this);this.parent=a;this.Bi=a.Bi;this.Xi=null;this.id=uc++;this.name=b;this.mode=c;this.ei={};this.fi={};this.rdev=d}
Object.defineProperties(Cc.prototype,{read:{get:function(){return 365===(this.mode&365)},set:function(a){a?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146===(this.mode&146)},set:function(a){a?this.mode|=146:this.mode&=-147}},Ik:{get:function(){return 16384===(this.mode&61440)}},Hk:{get:function(){return 8192===(this.mode&61440)}}});Zc();vc=Array(4096);Jc(J,"/");Lc("/tmp");Lc("/home");Lc("/home/web_user");
(function(){Lc("/dev");ic(259,{read:function(){return 0},write:function(b,c,d,e){return e}});Mc("/dev/null",259);gc(1280,kc);gc(1536,lc);Mc("/dev/tty",1280);Mc("/dev/tty1",1536);var a=cc();ed("/dev","random",a);ed("/dev","urandom",a);Lc("/dev/shm");Lc("/dev/shm/tmp")})();
(function(){Lc("/proc");var a=Lc("/proc/self");Lc("/proc/self/fd");Jc({Bi:function(){var b=nc(a,"fd",16895,73);b.ei={lookup:function(c,d){var e=tc[+d];if(!e)throw new I(8);c={parent:null,Bi:{hk:"fake"},ei:{readlink:function(){return e.path}}};return c.parent=c}};return b}},"/proc/self/fd")})();g.FS_createPath=bd;g.FS_createDataFile=dd;g.FS_createPreloadedFile=hd;g.FS_unlink=Sc;g.FS_createLazyFile=gd;g.FS_createDevice=ed;xd=g.InternalError=wd("InternalError");
for(var Rg=Array(256),Sg=0;256>Sg;++Sg)Rg[Sg]=String.fromCharCode(Sg);Ed=Rg;Gd=g.BindingError=wd("BindingError");Vd.prototype.isAliasOf=function(a){if(!(this instanceof Vd&&a instanceof Vd))return!1;var b=this.ci.li.ki,c=this.ci.ii,d=a.ci.li.ki;for(a=a.ci.ii;b.vi;)c=b.$i(c),b=b.vi;for(;d.vi;)a=d.$i(a),d=d.vi;return b===d&&c===a};
Vd.prototype.clone=function(){this.ci.ii||Id(this);if(this.ci.Yi)return this.ci.count.value+=1,this;var a=Ud,b=Object,c=b.create,d=Object.getPrototypeOf(this),e=this.ci;a=a(c.call(b,d,{ci:{value:{count:e.count,Oi:e.Oi,Yi:e.Yi,ii:e.ii,li:e.li,oi:e.oi,ui:e.ui}}}));a.ci.count.value+=1;a.ci.Oi=!1;return a};Vd.prototype["delete"]=function(){this.ci.ii||Id(this);this.ci.Oi&&!this.ci.Yi&&Hd("Object already scheduled for deletion");Kd(this);Ld(this.ci);this.ci.Yi||(this.ci.oi=void 0,this.ci.ii=void 0)};
Vd.prototype.isDeleted=function(){return!this.ci.ii};Vd.prototype.deleteLater=function(){this.ci.ii||Id(this);this.ci.Oi&&!this.ci.Yi&&Hd("Object already scheduled for deletion");Od.push(this);1===Od.length&&Qd&&Qd(Pd);this.ci.Oi=!0;return this};g.getInheritedInstanceCount=function(){return Object.keys(Rd).length};g.getLiveInheritedInstances=function(){var a=[],b;for(b in Rd)Rd.hasOwnProperty(b)&&a.push(Rd[b]);return a};g.flushPendingDeletes=Pd;g.setDelayFunction=function(a){Qd=a;Od.length&&Qd&&Qd(Pd)};
ee.prototype.Bk=function(a){this.kk&&(a=this.kk(a));return a};ee.prototype.Wj=function(a){this.ti&&this.ti(a)};ee.prototype.argPackAdvance=8;ee.prototype.readValueFromPointer=qd;ee.prototype.deleteObject=function(a){if(null!==a)a["delete"]()};
ee.prototype.fromWireType=function(a){function b(){return this.ij?Td(this.ki.Wi,{li:this.Tk,ii:c,ui:this,oi:a}):Td(this.ki.Wi,{li:this,ii:a})}var c=this.Bk(a);if(!c)return this.Wj(a),null;var d=Sd(this.ki,c);if(void 0!==d){if(0===d.ci.count.value)return d.ci.ii=c,d.ci.oi=a,d.clone();d=d.clone();this.Wj(a);return d}d=this.ki.Ak(c);d=Nd[d];if(!d)return b.call(this);d=this.hj?d.vk:d.pointerType;var e=Md(c,this.ki,d.ki);return null===e?b.call(this):this.ij?Td(d.ki.Wi,{li:d,ii:e,ui:this,oi:a}):Td(d.ki.Wi,
{li:d,ii:e})};ie=g.UnboundTypeError=wd("UnboundTypeError");g.count_emval_handles=function(){for(var a=0,b=5;b<qe.length;++b)void 0!==qe[b]&&++a;return a};g.get_first_emval=function(){for(var a=5;a<qe.length;++a)if(void 0!==qe[a])return qe[a];return null};g.requestFullscreen=function(a,b){Df(a,b)};g.requestAnimationFrame=function(a){Ze(a)};g.setCanvasSize=function(a,b,c){Ff(g.canvas,a,b);c||Gf()};g.pauseMainLoop=function(){Ve=null;cf++};
g.resumeMainLoop=function(){cf++;var a=Re,b=Se,c=Te;Te=null;bf(c);Qe(a,b);Ve()};g.getUserMedia=function(){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia);window.getUserMedia(void 0)};g.createContext=function(a,b,c,d){return vf(a,b,c,d)};for(var N,Tg=0;32>Tg;++Tg)ig.push(Array(Tg));var Ug=new Float32Array(288);for(Tg=0;288>Tg;++Tg)yg[Tg]=Ug.subarray(0,Tg+1);var Vg=new Int32Array(288);for(Tg=0;288>Tg;++Tg)zg[Tg]=Vg.subarray(0,Tg+1);
var Xg={Ka:function(a,b,c){Xb[a]=void 0;try{var d=[new Float32Array(b),new Uint16Array(c)]}catch(e){return 0}Xb[a]=d;return 1},Ja:function(a,b,c,d,e){Xb[a]=void 0;c>>=2;e>>=1;try{var f=[new Float32Array(B.subarray(c,c+b)),new Uint16Array(ub.subarray(e,e+d))]}catch(k){return 0}Xb[a]=f;return 1},La:function(a){Xb[a]=void 0},Na:function(){if(Yb.length)return Yb.pop();var a=Xb.length;Xb[a]=void 0;return a},Ma:function(a){Xb[a]=void 0;Yb.push(a)},Dh:function(a,b){if(!b)return 0;a=Xb[a];if(!a)return 0;
a=a[1];return a.length?(ub.set(a,b>>1),1):0},Eh:function(a,b){if(!b)return 0;a=Xb[a];if(!a)return 0;a=a[0];return a.length?(B.set(a,b>>2),1):0},Ha:function(a){return(a=Xb[a])?a[1].length:0},Bh:function(a,b){a=Xb[a];if(!a)return 0;a=a[1];return a.length?(N.bufferSubData(N.ELEMENT_ARRAY_BUFFER,b,a),1):0},zh:function(a,b,c,d){a=Xb[a];if(!a)return 0;a=a[1];try{var e=new Uint8Array(a.buffer,b,c)}catch(f){return 0}return e.length?(N.bufferSubData(N.ELEMENT_ARRAY_BUFFER,d,e),1):0},Ch:function(a,b){a=Xb[a];
if(!a)return 0;a=a[0];return a.length?(N.bufferSubData(N.ARRAY_BUFFER,b,a),1):0},Ah:function(a,b,c,d){a=Xb[a];if(!a)return 0;a=a[0];try{var e=new Uint8Array(a.buffer,b,c)}catch(f){return 0}return e.length?(N.bufferSubData(N.ARRAY_BUFFER,d,e),1):0},Ga:function(a,b,c,d){a=Xb[a];if(!a)return 0;a=a[0];return a.length&&b<a.length&&a.length-b>=c?(d>>=2,a.set(B.subarray(d,d+c),b),1):0},Ia:function(a){return(a=Xb[a])?a[0].length:0},Eb:function(a,b){0>a&&(a+=4294967296);0>b&&(b+=4294967296);g.hi("announce_model",
a,b)},Y:function(a,b,c){var d=g.$$facade;if(d){g.noExitRuntime=!0;var e=g.callAfterMap,f=++e.index,k=function(m){d===g.$$facade&&Qg("callFuncWrapper",null,["number","number","number"],[a,!m,b]);delete e.indexedWrappers[f]};e.indexedWrappers[f]=k;0<=c?jf(k,c):Jf(k)}},se:function(){for(var a=g.callAfterMap,b=a.indexedWrappers,c=Object.keys(b),d=0;d<c.length;++d)b[c[d]](!0);a.indexedWrappers={};a.index=0},wb:function(a,b){g.hi("capping_idle",!!a,b)},ob:function(a){0>a&&(a+=4294967296);g.hi("data_access_attached",
a)},nb:function(){g.hi("first_instance")},X:function(a){g.hi(nb(a))},fa:function(a,b){b=nb(b);try{var c=JSON.parse(b)}catch(d){c=b}g.hi(nb(a),c)},tb:function(a,b,c){0>a&&(a+=4294967296);0>b&&(b+=4294967296);0>c&&(c+=4294967296);g.hi("inclusion",a,b,c)},Oc:function(a,b,c,d){g.hi("meta_data",a,b,g.HEAPU8.subarray(c,c+d))},sb:function(a,b){0>a&&(a+=4294967296);b=nb(b);g.hi("missing_model",a,b)},Pb:function(a){g.hi("network_receive_data",a)},Dc:function(a){g.hi("post_draw_json","{"+nb(a)+"}")},pb:function(a,
b){0>a&&(a+=4294967296);0>b&&(b+=4294967296);g.hi("priority_meta_data_sent",a,b)},qb:function(a,b,c,d){0>a&&(a+=4294967296);0>b&&(b+=4294967296);0>c&&(c+=4294967296);0>d&&(d+=4294967296);g.hi("remap_inclusion",a,b,c,d)},rb:function(a,b,c){0>a&&(a+=4294967296);0>b&&(b+=4294967296);0>c&&(c+=4294967296);g.hi("remap_model",a,b,c)},h:function(a,b){g.tj&&(a=g.HEAP8.buffer.slice(a,b),g.tj.Yk(a))},ic:function(){g.hi("session_started")},Yd:function(){g.$$setReady()},l:function(a,b,c,d){gb("Assertion failed: "+
nb(a)+", at: "+[b?nb(b):"unknown filename",c,d?nb(d):"unknown function"])},ra:function(a,b,c){ld=c;try{var d=nd(a);switch(b){case 0:var e=md();return 0>e?-28:Hc(d,e).fd;case 1:case 2:return 0;case 3:return d.flags;case 4:return e=md(),d.flags|=e,0;case 5:return e=md(),tb[e+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return E[Wg()>>2]=28,-1;default:return-28}}catch(f){if("undefined"==typeof kd||!(f instanceof I))throw f;return-f.Fi}},Db:function(a,b,c){ld=c;try{var d=nd(a);switch(b){case 21509:case 21505:return d.tty?
0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return d.tty?0:-59;case 21519:if(!d.tty)return-59;var e=md();return E[e>>2]=0;case 21520:return d.tty?-28:-59;case 21531:a=e=md();if(!d.fi.Gk)throw new I(59);return d.fi.Gk(d,b,a);case 21523:return d.tty?0:-59;case 21524:return d.tty?0:-59;default:return-28}}catch(f){if("undefined"==typeof kd||!(f instanceof I))throw f;return-f.Fi}},Fb:function(a,b,c,d){ld=d;try{b=nb(b);var e=b;if("/"===e.charAt(0))b=e;else{var f=-100===a?"/":
nd(a).path;if(0==e.length)throw new I(44);b=$b(f+"/"+e)}var k=d?md():0;return Uc(b,c,k).fd}catch(m){if("undefined"==typeof kd||!(m instanceof I))throw m;return-m.Fi}},w:function(a){var b=od[a];delete od[a];var c=b.elements,d=c.length,e=c.map(function(m){return m.zj}).concat(c.map(function(m){return m.Mj})),f=b.Zi,k=b.ti;zd([a],e,function(m){c.forEach(function(p,u){var v=m[u],C=p.Pi,D=p.yj,q=m[u+d],y=p.Lj,F=p.Nj;p.read=function(R){return v.fromWireType(C(D,R))};p.write=function(R,ba){var M=[];y(F,
R,q.toWireType(M,ba));pd(M)}});return[{name:b.name,fromWireType:function(p){for(var u=Array(d),v=0;v<d;++v)u[v]=c[v].read(p);k(p);return u},toWireType:function(p,u){if(d!==u.length)throw new TypeError("Incorrect number of tuple elements for "+b.name+": expected="+d+", actual="+u.length);for(var v=f(),C=0;C<d;++C)c[C].write(v,u[C]);null!==p&&p.push(k,v);return v},argPackAdvance:8,readValueFromPointer:qd,pi:k}]})},J:function(a){var b=Cd[a];delete Cd[a];var c=b.Zi,d=b.ti,e=b.Zj,f=e.map(function(k){return k.zj}).concat(e.map(function(k){return k.Mj}));
zd([a],f,function(k){var m={};e.forEach(function(p,u){var v=k[u],C=p.Pi,D=p.yj,q=k[u+e.length],y=p.Lj,F=p.Nj;m[p.zk]={read:function(R){return v.fromWireType(C(D,R))},write:function(R,ba){var M=[];y(F,R,q.toWireType(M,ba));pd(M)}}});return[{name:b.name,fromWireType:function(p){var u={},v;for(v in m)u[v]=m[v].read(p);d(p);return u},toWireType:function(p,u){for(var v in m)if(!(v in u))throw new TypeError('Missing field:  "'+v+'"');var C=c();for(v in m)m[v].write(C,u[v]);null!==p&&p.push(d,C);return C},
argPackAdvance:8,readValueFromPointer:qd,pi:d}]})},vb:function(){},Tg:function(a,b,c,d,e){var f=Dd(c);b=Fd(b);Bd(a,{name:b,fromWireType:function(k){return!!k},toWireType:function(k,m){return m?d:e},argPackAdvance:8,readValueFromPointer:function(k){if(1===c)var m=rb;else if(2===c)m=tb;else if(4===c)m=E;else throw new TypeError("Unknown boolean type size: "+b);return this.fromWireType(m[k>>f])},pi:null})},ga:function(a,b,c,d,e,f,k,m,p,u,v,C,D){v=Fd(v);f=he(e,f);m&&(m=he(k,m));u&&(u=he(p,u));D=he(C,
D);var q=ud(v);Xd(q,function(){me("Cannot construct "+v+" due to unbound types",[d])});zd([a,b,c],d?[d]:[],function(y){y=y[0];if(d){var F=y.ki;var R=F.Wi}else R=Vd.prototype;y=vd(q,function(){if(Object.getPrototypeOf(this)!==ba)throw new Gd("Use 'new' to construct "+v);if(void 0===M.gi)throw new Gd(v+" has no accessible constructor");var A=M.gi[arguments.length];if(void 0===A)throw new Gd("Tried to invoke ctor of "+v+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(M.gi).toString()+
") parameters instead!");return A.apply(this,arguments)});var ba=Object.create(R,{constructor:{value:y}});y.prototype=ba;var M=new Yd(v,y,ba,D,F,f,m,u);F=new ee(v,M,!0,!1);R=new ee(v+"*",M,!1,!1);var G=new ee(v+" const*",M,!1,!0);Nd[a]={pointerType:R,vk:G};fe(q,y);return[F,R,G]})},b:function(a,b,c,d,e,f,k){var m=oe(c,d);b=Fd(b);f=he(e,f);zd([],[a],function(p){function u(){me("Cannot call "+v+" due to unbound types",m)}p=p[0];var v=p.name+"."+b;b.startsWith("@@")&&(b=Symbol[b.substring(2)]);var C=
p.ki.constructor;void 0===C[b]?(u.uj=c-1,C[b]=u):(Wd(C,b,v),C[b].Ci[c-1]=u);zd([],m,function(D){D=[D[0],null].concat(D.slice(1));var q=v,y=f,F=D.length;2>F&&Hd("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var R=null!==D[1]&&!1,ba=!1,M=1;M<D.length;++M)if(null!==D[M]&&void 0===D[M].pi){ba=!0;break}var G="void"!==D[0].name,A="",U="";for(M=0;M<F-2;++M)A+=(0!==M?", ":"")+"arg"+M,U+=(0!==M?", ":"")+"arg"+M+"Wired";q="return function "+ud(q)+"("+A+") {\nif (arguments.length !== "+
(F-2)+") {\nthrowBindingError('function "+q+" called with ' + arguments.length + ' arguments, expected "+(F-2)+" args!');\n}\n";ba&&(q+="var destructors = [];\n");var K=ba?"destructors":"null";A="throwBindingError invoker fn runDestructors retType classParam".split(" ");y=[Hd,y,k,pd,D[0],D[1]];R&&(q+="var thisWired = classParam.toWireType("+K+", this);\n");for(M=0;M<F-2;++M)q+="var arg"+M+"Wired = argType"+M+".toWireType("+K+", arg"+M+"); // "+D[M+2].name+"\n",A.push("argType"+M),y.push(D[M+2]);R&&
(U="thisWired"+(0<U.length?", ":"")+U);q+=(G?"var rv = ":"")+"invoker(fn"+(0<U.length?", ":"")+U+");\n";if(ba)q+="runDestructors(destructors);\n";else for(M=R?1:2;M<D.length;++M)F=1===M?"thisWired":"arg"+(M-2)+"Wired",null!==D[M].pi&&(q+=F+"_dtor("+F+"); // "+D[M].name+"\n",A.push(F+"_dtor"),y.push(D[M].pi));G&&(q+="var ret = retType.fromWireType(rv);\nreturn ret;\n");A.push(q+"}\n");D=ne(A).apply(null,y);void 0===C[b].Ci?(D.uj=c-1,C[b]=D):C[b].Ci[c-1]=D;return[]});return[]})},Sg:function(a,b){b=
Fd(b);Bd(a,{name:b,fromWireType:function(c){var d=se(c);re(c);return d},toWireType:function(c,d){return ce(d)},argPackAdvance:8,readValueFromPointer:qd,pi:null})},M:function(a,b,c,d){function e(){}c=Dd(c);b=Fd(b);e.values={};Bd(a,{name:b,constructor:e,fromWireType:function(f){return this.constructor.values[f]},toWireType:function(f,k){return k.value},argPackAdvance:8,readValueFromPointer:te(b,c,d),pi:null});Xd(b,e)},y:function(a,b,c){var d=ue(a,"enum");b=Fd(b);a=d.constructor;d=Object.create(d.constructor.prototype,
{value:{value:c},constructor:{value:vd(d.name+"_"+b,function(){})}});a.values[c]=d;a[b]=d},ua:function(a,b,c){c=Dd(c);b=Fd(b);Bd(a,{name:b,fromWireType:function(d){return d},toWireType:function(d,e){return e},argPackAdvance:8,readValueFromPointer:ve(b,c),pi:null})},P:function(a,b,c,d,e){function f(m){return m}b=Fd(b);-1===e&&(e=4294967295);e=Dd(c);if(0===d){var k=32-8*c;f=function(m){return m<<k>>>k}}c=b.includes("unsigned")?function(m,p){return p>>>0}:function(m,p){return p};Bd(a,{name:b,fromWireType:f,
toWireType:c,argPackAdvance:8,readValueFromPointer:xe(b,e,0!==d),pi:null})},D:function(a,b,c){function d(f){f>>=2;var k=h;return new e(qb,k[f+1],k[f])}var e=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][b];c=Fd(c);Bd(a,{name:c,fromWireType:d,argPackAdvance:8,readValueFromPointer:d},{Ek:!0})},ta:function(a,b){b=Fd(b);var c="std::string"===b;Bd(a,{name:b,fromWireType:function(d){var e=h[d>>2],f=d+4;if(c)for(var k=f,m=0;m<=e;++m){var p=f+m;if(m==e||0==
t[p]){k=nb(k,p-k);if(void 0===u)var u=k;else u+=String.fromCharCode(0),u+=k;k=p+1}}else{u=Array(e);for(m=0;m<e;++m)u[m]=String.fromCharCode(t[f+m]);u=u.join("")}le(d);return u},toWireType:function(d,e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var f="string"==typeof e;f||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int8Array||Hd("Cannot pass non-string to std::string");var k=c&&f?pb(e):e.length;var m=qg(4+k+1),p=m+4;h[m>>2]=k;if(c&&f)ob(e,t,p,k+1);else if(f)for(f=0;f<
k;++f){var u=e.charCodeAt(f);255<u&&(le(p),Hd("String has UTF-16 code units that do not fit in 8 bits"));t[p+f]=u}else for(f=0;f<k;++f)t[p+f]=e[f];null!==d&&d.push(le,m);return m},argPackAdvance:8,readValueFromPointer:qd,pi:function(d){le(d)}})},ha:function(a,b,c){c=Fd(c);if(2===b){var d=ze;var e=Ae;var f=Be;var k=function(){return ub};var m=1}else 4===b&&(d=Ce,e=De,f=Ee,k=function(){return h},m=2);Bd(a,{name:c,fromWireType:function(p){for(var u=h[p>>2],v=k(),C,D=p+4,q=0;q<=u;++q){var y=p+4+q*b;if(q==
u||0==v[y>>m])D=d(D,y-D),void 0===C?C=D:(C+=String.fromCharCode(0),C+=D),D=y+b}le(p);return C},toWireType:function(p,u){"string"!=typeof u&&Hd("Cannot pass non-string to C++ string type "+c);var v=f(u),C=qg(4+v+b);h[C>>2]=v>>m;e(u,C+4,v+b);null!==p&&p.push(le,C);return C},argPackAdvance:8,readValueFromPointer:qd,pi:function(p){le(p)}})},x:function(a,b,c,d,e,f){od[a]={name:Fd(b),Zi:he(c,d),ti:he(e,f),elements:[]}},i:function(a,b,c,d,e,f,k,m,p){od[a].elements.push({zj:b,Pi:he(c,d),yj:e,Mj:f,Lj:he(k,
m),Nj:p})},K:function(a,b,c,d,e,f){Cd[a]={name:Fd(b),Zi:he(c,d),ti:he(e,f),Zj:[]}},t:function(a,b,c,d,e,f,k,m,p,u){Cd[a].Zj.push({zk:Fd(b),zj:c,Pi:he(d,e),yj:f,Mj:k,Lj:he(m,p),Nj:u})},Ug:function(a,b){b=Fd(b);Bd(a,{Jk:!0,name:b,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},Vg:function(a){do{var b=h[a>>2];a+=4;var c=h[a>>2];a+=4;var d=h[a>>2];a+=4;b=nb(b);bd("/",ac(b),!0,!0);dd(b,null,rb.subarray(d,d+c),!0,!0,!0)}while(h[a>>2])},Ab:function(){return Fe},p:function(a,b,c){a=
se(a);b=ue(b,"emval::as");var d=[],e=ce(d);h[c>>2]=e;return b.toWireType(d,a)},j:function(a,b,c,d){a=se(a);c=Ge(b,c);for(var e=Array(b),f=0;f<b;++f){var k=c[f];e[f]=k.readValueFromPointer(d);d+=k.argPackAdvance}a=a.apply(void 0,e);return ce(a)},Q:function(a,b,c,d,e){a=Je[a];b=se(b);c=Ie(c);var f=[];h[d>>2]=ce(f);return a(b,c,f,e)},a:re,L:function(a){if(0===a)return ce(Ke());a=Ie(a);return ce(Ke()[a])},R:function(a,b){var c=Ge(a,b),d=c[0];b=d.name+"_$"+c.slice(1).map(function(v){return v.name}).join("_")+
"$";var e=Me[b];if(void 0!==e)return e;e=["retType"];for(var f=[d],k="",m=0;m<a-1;++m)k+=(0!==m?", ":"")+"arg"+m,e.push("argType"+m),f.push(c[1+m]);var p="return function "+ud("methodCaller_"+b)+"(handle, name, destructors, args) {\n",u=0;for(m=0;m<a-1;++m)p+="    var arg"+m+" = argType"+m+".readValueFromPointer(args"+(u?"+"+u:"")+");\n",u+=c[m+1].argPackAdvance;p+="    var rv = handle[name]("+k+");\n";for(m=0;m<a-1;++m)c[m+1].deleteObject&&(p+="    argType"+m+".deleteObject(arg"+m+");\n");d.Jk||
(p+="    return retType.toWireType(destructors, rv);\n");e.push(p+"};\n");a=ne(e).apply(null,f);e=Le(a);return Me[b]=e},_:function(a){a=Ie(a);return ce(g[a])},o:function(a,b){a=se(a);b=se(b);return ce(a[b])},d:function(a){4<a&&(qe[a].Hj+=1)},S:function(a,b,c,d){a=se(a);var e=Oe[b];e||(e=Ne(b),Oe[b]=e);return e(a,c,d)},v:function(){return ce([])},f:function(a){return ce(Ie(a))},B:function(){return ce({})},m:function(a){var b=se(a);pd(b);re(a)},g:function(a,b,c){a=se(a);b=se(b);c=se(c);a[b]=c},e:function(a,
b){a=ue(a,"_emval_take_value");a=a.readValueFromPointer(b);return ce(a)},c:function(){gb("")},ba:function(a,b,c){Pe.length=0;var d;for(c>>=2;d=t[b++];)c+=105!=d&c,Pe.push(105==d?E[c]:Fa[c++>>1]),++c;return Vb[a].apply(null,Pe)},he:function(a,b,c){var d=g.canvas;E[a>>2]=d.width;E[b>>2]=d.height;E[c>>2]=mf?1:0},A:Xe,yg:function(a){N.activeTexture(a)},xg:function(a,b){N.attachShader(Qf[a],Uf[b])},zd:function(a,b){N.beginQuery(a,Xf[b])},Og:function(a,b){N.ni.beginQueryEXT(a,Xf[b])},fd:function(a){N.beginTransformFeedback(a)},
wg:function(a,b,c){N.bindAttribLocation(Qf[a],b,nb(c))},vg:function(a,b){35051==a?N.Hi=b:35052==a&&(N.mi=b);N.bindBuffer(a,Pf[b])},cd:function(a,b,c){N.bindBufferBase(a,b,Pf[c])},dd:function(a,b,c,d,e){N.bindBufferRange(a,b,Pf[c],d,e)},ug:function(a,b){N.bindFramebuffer(a,Rf[b])},tg:function(a,b){N.bindRenderbuffer(a,Sf[b])},gc:function(a,b){N.bindSampler(a,Yf[b])},sg:function(a,b){N.bindTexture(a,Tf[b])},_b:function(a,b){N.bindTransformFeedback(a,Zf[b])},ld:function(a){N.bindVertexArray(Vf[a])},
Gg:function(a){N.bindVertexArray(Vf[a])},rg:function(a,b,c,d){N.blendColor(a,b,c,d)},qg:function(a){N.blendEquation(a)},pg:function(a,b){N.blendEquationSeparate(a,b)},og:function(a,b){N.blendFunc(a,b)},ng:function(a,b,c,d){N.blendFuncSeparate(a,b,c,d)},od:function(a,b,c,d,e,f,k,m,p,u){N.blitFramebuffer(a,b,c,d,e,f,k,m,p,u)},mg:function(a,b,c,d){2<=T.version?c&&b?N.bufferData(a,t,d,c,b):N.bufferData(a,b,d):N.bufferData(a,c?t.subarray(c,c+b):b,d)},lg:function(a,b,c,d){2<=T.version?c&&N.bufferSubData(a,
b,t,d,c):N.bufferSubData(a,b,t.subarray(d,d+c))},kg:function(a){return N.checkFramebufferStatus(a)},jg:function(a){N.clear(a)},Fc:function(a,b,c,d){N.clearBufferfi(a,b,c,d)},Gc:function(a,b,c){N.clearBufferfv(a,b,B,c>>2)},Ic:function(a,b,c){N.clearBufferiv(a,b,E,c>>2)},Hc:function(a,b,c){N.clearBufferuiv(a,b,h,c>>2)},ig:function(a,b,c,d){N.clearColor(a,b,c,d)},hg:function(a){N.clearDepth(a)},gg:function(a){N.clearStencil(a)},qc:function(a,b,c,d){return N.clientWaitSync($f[a],b,(c>>>0)+4294967296*
d)},fg:function(a,b,c,d){N.colorMask(!!a,!!b,!!c,!!d)},eg:function(a){N.compileShader(Uf[a])},dg:function(a,b,c,d,e,f,k,m){2<=T.version?N.mi||!k?N.compressedTexImage2D(a,b,c,d,e,f,k,m):N.compressedTexImage2D(a,b,c,d,e,f,t,m,k):N.compressedTexImage2D(a,b,c,d,e,f,m?t.subarray(m,m+k):null)},Fd:function(a,b,c,d,e,f,k,m,p){N.mi?N.compressedTexImage3D(a,b,c,d,e,f,k,m,p):N.compressedTexImage3D(a,b,c,d,e,f,k,t,p,m)},cg:function(a,b,c,d,e,f,k,m,p){2<=T.version?N.mi||!m?N.compressedTexSubImage2D(a,b,c,d,e,
f,k,m,p):N.compressedTexSubImage2D(a,b,c,d,e,f,k,t,p,m):N.compressedTexSubImage2D(a,b,c,d,e,f,k,p?t.subarray(p,p+m):null)},Ed:function(a,b,c,d,e,f,k,m,p,u,v){N.mi?N.compressedTexSubImage3D(a,b,c,d,e,f,k,m,p,u,v):N.compressedTexSubImage3D(a,b,c,d,e,f,k,m,p,t,v,u)},Cc:function(a,b,c,d,e){N.copyBufferSubData(a,b,c,d,e)},bg:function(a,b,c,d,e,f,k,m){N.copyTexImage2D(a,b,c,d,e,f,k,m)},ag:function(a,b,c,d,e,f,k,m){N.copyTexSubImage2D(a,b,c,d,e,f,k,m)},Gd:function(a,b,c,d,e,f,k,m,p){N.copyTexSubImage3D(a,
b,c,d,e,f,k,m,p)},$f:function(){var a=eg(Qf),b=N.createProgram();b.name=a;b.Ai=b.yi=b.zi=0;b.rj=1;Qf[a]=b;return a},_f:function(a){var b=eg(Uf);Uf[b]=N.createShader(a);return b},Zf:function(a){N.cullFace(a)},Yf:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Pf[d];e&&(N.deleteBuffer(e),e.name=0,Pf[d]=null,d==N.Hi&&(N.Hi=0),d==N.mi&&(N.mi=0))}},Xf:function(a,b){for(var c=0;c<a;++c){var d=E[b+4*c>>2],e=Rf[d];e&&(N.deleteFramebuffer(e),e.name=0,Rf[d]=null)}},Wf:function(a){if(a){var b=Qf[a];b?
(N.deleteProgram(b),b.name=0,Qf[a]=null):P(1281)}},Bd:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Xf[d];e&&(N.deleteQuery(e),Xf[d]=null)}},Qg:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Xf[d];e&&(N.ni.deleteQueryEXT(e),Xf[d]=null)}},Vf:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Sf[d];e&&(N.deleteRenderbuffer(e),e.name=0,Sf[d]=null)}},jc:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Yf[d];e&&(N.deleteSampler(e),e.name=0,Yf[d]=null)}},Uf:function(a){if(a){var b=
Uf[a];b?(N.deleteShader(b),Uf[a]=null):P(1281)}},rc:function(a){if(a){var b=$f[a];b?(N.deleteSync(b),b.name=0,$f[a]=null):P(1281)}},Tf:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Tf[d];e&&(N.deleteTexture(e),e.name=0,Tf[d]=null)}},Zb:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Zf[d];e&&(N.deleteTransformFeedback(e),e.name=0,Zf[d]=null)}},kd:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2];N.deleteVertexArray(Vf[d]);Vf[d]=null}},Fg:function(a,b){for(var c=0;c<a;c++){var d=
E[b+4*c>>2];N.deleteVertexArray(Vf[d]);Vf[d]=null}},Sf:function(a){N.depthFunc(a)},Rf:function(a){N.depthMask(!!a)},Qf:function(a,b){N.depthRange(a,b)},Pf:function(a,b){N.detachShader(Qf[a],Uf[b])},Of:function(a){N.disable(a)},Nf:function(a){N.disableVertexAttribArray(a)},Mf:function(a,b,c){N.drawArrays(a,b,c)},vc:function(a,b,c,d){N.drawArraysInstanced(a,b,c,d)},Bg:function(a,b,c,d){N.drawArraysInstanced(a,b,c,d)},Ib:function(a,b,c,d){N.drawArraysInstanced(a,b,c,d)},Nd:function(a,b,c,d){N.drawArraysInstanced(a,
b,c,d)},Jb:function(a,b,c,d){N.drawArraysInstanced(a,b,c,d)},vd:function(a,b){for(var c=ig[a],d=0;d<a;d++)c[d]=E[b+4*d>>2];N.drawBuffers(c)},Ld:function(a,b){for(var c=ig[a],d=0;d<a;d++)c[d]=E[b+4*d>>2];N.drawBuffers(c)},Cg:function(a,b){for(var c=ig[a],d=0;d<a;d++)c[d]=E[b+4*d>>2];N.drawBuffers(c)},Lf:function(a,b,c,d){N.drawElements(a,b,c,d)},uc:function(a,b,c,d,e){N.drawElementsInstanced(a,b,c,d,e)},Ag:function(a,b,c,d,e){N.drawElementsInstanced(a,b,c,d,e)},Gb:function(a,b,c,d,e){N.drawElementsInstanced(a,
b,c,d,e)},Hb:function(a,b,c,d,e){N.drawElementsInstanced(a,b,c,d,e)},Md:function(a,b,c,d,e){N.drawElementsInstanced(a,b,c,d,e)},Jd:function(a,b,c,d,e,f){jg(a,d,e,f)},Kf:function(a){N.enable(a)},Jf:function(a){N.enableVertexAttribArray(a)},yd:function(a){N.endQuery(a)},Ng:function(a){N.ni.endQueryEXT(a)},ed:function(){N.endTransformFeedback()},tc:function(a,b){return(a=N.fenceSync(a,b))?(b=eg($f),a.name=b,$f[b]=a,b):0},If:function(){N.finish()},Hf:function(){N.flush()},Gf:function(a,b,c,d){N.framebufferRenderbuffer(a,
b,c,Sf[d])},Ff:function(a,b,c,d,e){N.framebufferTexture2D(a,b,c,Tf[d],e)},md:function(a,b,c,d,e){N.framebufferTextureLayer(a,b,Tf[c],d,e)},Ef:function(a){N.frontFace(a)},Df:function(a,b){kg(a,b,"createBuffer",Pf)},Bf:function(a,b){kg(a,b,"createFramebuffer",Rf)},Cd:function(a,b){kg(a,b,"createQuery",Xf)},Rg:function(a,b){for(var c=0;c<a;c++){var d=N.ni.createQueryEXT();if(!d){for(P(1282);c<a;)E[b+4*c++>>2]=0;break}var e=eg(Xf);d.name=e;Xf[e]=d;E[b+4*c>>2]=e}},Af:function(a,b){kg(a,b,"createRenderbuffer",
Sf)},kc:function(a,b){kg(a,b,"createSampler",Yf)},zf:function(a,b){kg(a,b,"createTexture",Tf)},Yb:function(a,b){kg(a,b,"createTransformFeedback",Zf)},jd:function(a,b){kg(a,b,"createVertexArray",Vf)},Eg:function(a,b){kg(a,b,"createVertexArray",Vf)},Cf:function(a){N.generateMipmap(a)},yf:function(a,b,c,d,e,f,k){lg("getActiveAttrib",a,b,c,d,e,f,k)},xf:function(a,b,c,d,e,f,k){lg("getActiveUniform",a,b,c,d,e,f,k)},xc:function(a,b,c,d,e){a=Qf[a];if(a=N.getActiveUniformBlockName(a,b))e&&0<c?(c=ob(a,t,e,
c),d&&(E[d>>2]=c)):d&&(E[d>>2]=0)},yc:function(a,b,c,d){if(d)if(a=Qf[a],35393==c)c=N.getActiveUniformBlockName(a,b),E[d>>2]=c.length+1;else{if(a=N.getActiveUniformBlockParameter(a,b,c),null!==a)if(35395==c)for(c=0;c<a.length;c++)E[d+4*c>>2]=a[c];else E[d>>2]=a}else P(1281)},Ac:function(a,b,c,d,e){if(e)if(0<b&&0==c)P(1281);else{a=Qf[a];for(var f=[],k=0;k<b;k++)f.push(E[c+4*k>>2]);if(a=N.getActiveUniforms(a,f,d))for(b=a.length,k=0;k<b;k++)E[e+4*k>>2]=a[k]}else P(1281)},wf:function(a,b,c,d){a=N.getAttachedShaders(Qf[a]);
var e=a.length;e>b&&(e=b);E[c>>2]=e;for(b=0;b<e;++b)E[d+4*b>>2]=Uf.indexOf(a[b])},vf:function(a,b){return N.getAttribLocation(Qf[a],nb(b))},uf:function(a,b){ng(a,b,4)},lc:function(a,b,c){c?mg(c,N.getBufferParameter(a,b)):P(1281)},tf:function(a,b,c){c?E[c>>2]=N.getBufferParameter(a,b):P(1281)},sf:function(){var a=N.getError()||dg;dg=0;return a},rf:function(a,b){ng(a,b,2)},Sc:function(a,b){return N.getFragDataLocation(Qf[a],nb(b))},qf:function(a,b,c,d){a=N.getFramebufferAttachmentParameter(a,b,c);if(a instanceof
WebGLRenderbuffer||a instanceof WebGLTexture)a=a.name|0;E[d>>2]=a},mc:function(a,b,c){og(a,b,c,1)},oc:function(a,b){ng(a,b,1)},gd:function(a,b,c){og(a,b,c,0)},pf:function(a,b){ng(a,b,0)},Mb:function(a,b,c,d,e){if(0>d)P(1281);else if(e){if(a=N.getInternalformatParameter(a,b,c),null!==a)for(b=0;b<a.length&&b<d;++b)E[e+4*b>>2]=a[b]}else P(1281)},Ub:function(){P(1282)},nf:function(a,b,c,d){a=N.getProgramInfoLog(Qf[a]);null===a&&(a="(unknown error)");b=0<b&&d?ob(a,t,d,b):0;c&&(E[c>>2]=b)},of:function(a,
b,c){if(c)if(a>=Of)P(1281);else if(a=Qf[a],35716==b)a=N.getProgramInfoLog(a),null===a&&(a="(unknown error)"),E[c>>2]=a.length+1;else if(35719==b){if(!a.Ai)for(b=0;b<N.getProgramParameter(a,35718);++b)a.Ai=Math.max(a.Ai,N.getActiveUniform(a,b).name.length+1);E[c>>2]=a.Ai}else if(35722==b){if(!a.yi)for(b=0;b<N.getProgramParameter(a,35721);++b)a.yi=Math.max(a.yi,N.getActiveAttrib(a,b).name.length+1);E[c>>2]=a.yi}else if(35381==b){if(!a.zi)for(b=0;b<N.getProgramParameter(a,35382);++b)a.zi=Math.max(a.zi,
N.getActiveUniformBlockName(a,b).length+1);E[c>>2]=a.zi}else E[c>>2]=N.getProgramParameter(a,b);else P(1281)},Ig:function(a,b,c){if(c){a=Xf[a];b=2>T.version?N.ni.getQueryObjectEXT(a,b):N.getQueryParameter(a,b);var d;"boolean"==typeof b?d=b?1:0:d=b;mg(c,d)}else P(1281)},Kg:function(a,b,c){if(c){a=N.ni.getQueryObjectEXT(Xf[a],b);var d;"boolean"==typeof a?d=a?1:0:d=a;E[c>>2]=d}else P(1281)},Hg:function(a,b,c){if(c){a=Xf[a];b=2>T.version?N.ni.getQueryObjectEXT(a,b):N.getQueryParameter(a,b);var d;"boolean"==
typeof b?d=b?1:0:d=b;mg(c,d)}else P(1281)},wd:function(a,b,c){if(c){a=N.getQueryParameter(Xf[a],b);var d;"boolean"==typeof a?d=a?1:0:d=a;E[c>>2]=d}else P(1281)},Jg:function(a,b,c){if(c){a=N.ni.getQueryObjectEXT(Xf[a],b);var d;"boolean"==typeof a?d=a?1:0:d=a;E[c>>2]=d}else P(1281)},xd:function(a,b,c){c?E[c>>2]=N.getQuery(a,b):P(1281)},Lg:function(a,b,c){c?E[c>>2]=N.ni.getQueryEXT(a,b):P(1281)},mf:function(a,b,c){c?E[c>>2]=N.getRenderbufferParameter(a,b):P(1281)},ac:function(a,b,c){c?B[c>>2]=N.getSamplerParameter(Yf[a],
b):P(1281)},bc:function(a,b,c){c?E[c>>2]=N.getSamplerParameter(Yf[a],b):P(1281)},kf:function(a,b,c,d){a=N.getShaderInfoLog(Uf[a]);null===a&&(a="(unknown error)");b=0<b&&d?ob(a,t,d,b):0;c&&(E[c>>2]=b)},jf:function(a,b,c,d){a=N.getShaderPrecisionFormat(a,b);E[c>>2]=a.rangeMin;E[c+4>>2]=a.rangeMax;E[d>>2]=a.precision},hf:function(a,b,c,d){if(a=N.getShaderSource(Uf[a]))b=0<b&&d?ob(a,t,d,b):0,c&&(E[c>>2]=b)},lf:function(a,b,c){c?35716==b?(a=N.getShaderInfoLog(Uf[a]),null===a&&(a="(unknown error)"),E[c>>
2]=a?a.length+1:0):35720==b?(a=N.getShaderSource(Uf[a]),E[c>>2]=a?a.length+1:0):E[c>>2]=N.getShaderParameter(Uf[a],b):P(1281)},gf:function(a){var b=ag[a];if(!b){switch(a){case 7939:b=N.getSupportedExtensions()||[];b=b.concat(b.map(function(d){return"GL_"+d}));b=pg(b.join(" "));break;case 7936:case 7937:case 37445:case 37446:(b=N.getParameter(a))||P(1280);b=b&&pg(b);break;case 7938:b=N.getParameter(7938);b=2<=T.version?"OpenGL ES 3.0 ("+b+")":"OpenGL ES 2.0 ("+b+")";b=pg(b);break;case 35724:b=N.getParameter(35724);
var c=b.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==c&&(3==c[1].length&&(c[1]+="0"),b="OpenGL ES GLSL ES "+c[1]+" ("+b+")");b=pg(b);break;default:P(1280)}ag[a]=b}return b},Ec:function(a,b){if(2>T.version)return P(1282),0;var c=bg[a];if(c)return 0>b||b>=c.length?(P(1281),0):c[b];switch(a){case 7939:return c=N.getSupportedExtensions()||[],c=c.concat(c.map(function(d){return"GL_"+d})),c=c.map(function(d){return pg(d)}),c=bg[a]=c,0>b||b>=c.length?(P(1281),0):c[b];default:return P(1280),
0}},nc:function(a,b,c,d,e){0>c?P(1281):e?(a=N.getSyncParameter($f[a],b),null!==a&&(E[e>>2]=a,d&&(E[d>>2]=1))):P(1281)},ff:function(a,b,c){c?B[c>>2]=N.getTexParameter(a,b):P(1281)},ef:function(a,b,c){c?E[c>>2]=N.getTexParameter(a,b):P(1281)},ad:function(a,b,c,d,e,f,k){a=Qf[a];if(a=N.getTransformFeedbackVarying(a,b))k&&0<c?(c=ob(a.name,t,k,c),d&&(E[d>>2]=c)):d&&(E[d>>2]=0),e&&(E[e>>2]=a.size),f&&(E[f>>2]=a.type)},zc:function(a,b){return N.getUniformBlockIndex(Qf[a],nb(b))},Bc:function(a,b,c,d){if(d)if(0<
b&&(0==c||0==d))P(1281);else{a=Qf[a];for(var e=[],f=0;f<b;f++)e.push(nb(E[c+4*f>>2]));if(a=N.getUniformIndices(a,e))for(b=a.length,f=0;f<b;f++)E[d+4*f>>2]=a[f]}else P(1281)},bf:function(a,b){b=nb(b);if(a=Qf[a]){sg(a);var c=a.Mi,d=0,e=b,f=rg(b);0<f&&(d=parseInt(b.slice(f+1))>>>0,e=b.slice(0,f));if((e=a.sj[e])&&d<e[0]&&(d+=e[1],c[d]=c[d]||N.getUniformLocation(a,b)))return d}else P(1281);return-1},df:function(a,b,c){tg(a,b,c,2)},cf:function(a,b,c){tg(a,b,c,0)},Tc:function(a,b,c){tg(a,b,c,0)},_c:function(a,
b,c){ug(a,b,c,0)},Yc:function(a,b,c){ug(a,b,c,0)},_e:function(a,b,c){c?E[c>>2]=N.getVertexAttribOffset(a,b):P(1281)},af:function(a,b,c){ug(a,b,c,2)},$e:function(a,b,c){ug(a,b,c,5)},Ze:function(a,b){N.hint(a,b)},Rb:function(a,b,c){for(var d=ig[b],e=0;e<b;e++)d[e]=E[c+4*e>>2];N.invalidateFramebuffer(a,d)},Qb:function(a,b,c,d,e,f,k){for(var m=ig[b],p=0;p<b;p++)m[p]=E[c+4*p>>2];N.invalidateSubFramebuffer(a,m,d,e,f,k)},Ye:function(a){return(a=Pf[a])?N.isBuffer(a):0},Xe:function(a){return N.isEnabled(a)},
We:function(a){return(a=Rf[a])?N.isFramebuffer(a):0},Ve:function(a){return(a=Qf[a])?N.isProgram(a):0},Ad:function(a){return(a=Xf[a])?N.isQuery(a):0},Pg:function(a){return(a=Xf[a])?N.ni.isQueryEXT(a):0},Ue:function(a){return(a=Sf[a])?N.isRenderbuffer(a):0},hc:function(a){return(a=Yf[a])?N.isSampler(a):0},Te:function(a){return(a=Uf[a])?N.isShader(a):0},sc:function(a){return N.isSync($f[a])},Se:function(a){return(a=Tf[a])?N.isTexture(a):0},Xb:function(a){return N.isTransformFeedback(Zf[a])},hd:function(a){return(a=
Vf[a])?N.isVertexArray(a):0},Dg:function(a){return(a=Vf[a])?N.isVertexArray(a):0},Re:function(a){N.lineWidth(a)},Qe:function(a){a=Qf[a];N.linkProgram(a);a.Mi=0;a.sj={}},Wb:function(){N.pauseTransformFeedback()},Pe:function(a,b){3317==a&&(cg=b);N.pixelStorei(a,b)},Oe:function(a,b){N.polygonOffset(a,b)},Tb:function(){P(1280)},Sb:function(){P(1280)},Mg:function(a,b){N.ni.queryCounterEXT(Xf[a],b)},Kd:function(a){N.readBuffer(a)},Ne:function(a,b,c,d,e,f,k){if(2<=T.version)if(N.Hi)N.readPixels(a,b,c,d,
e,f,k);else{var m=vg(f);N.readPixels(a,b,c,d,e,f,m,k>>wg(m))}else(k=xg(f,e,c,d,k))?N.readPixels(a,b,c,d,e,f,k):P(1280)},Me:function(){},Le:function(a,b,c,d){N.renderbufferStorage(a,b,c,d)},nd:function(a,b,c,d,e){N.renderbufferStorageMultisample(a,b,c,d,e)},Vb:function(){N.resumeTransformFeedback()},Ke:function(a,b){N.sampleCoverage(a,!!b)},dc:function(a,b,c){N.samplerParameterf(Yf[a],b,c)},cc:function(a,b,c){N.samplerParameterf(Yf[a],b,B[c>>2])},fc:function(a,b,c){N.samplerParameteri(Yf[a],b,c)},
ec:function(a,b,c){N.samplerParameteri(Yf[a],b,E[c>>2])},Je:function(a,b,c,d){N.scissor(a,b,c,d)},Ie:function(){P(1280)},He:function(a,b,c,d){b=fg(b,c,d);N.shaderSource(Uf[a],b)},Ge:function(a,b,c){N.stencilFunc(a,b,c)},Fe:function(a,b,c,d){N.stencilFuncSeparate(a,b,c,d)},Ee:function(a){N.stencilMask(a)},De:function(a,b){N.stencilMaskSeparate(a,b)},Ce:function(a,b,c){N.stencilOp(a,b,c)},Be:function(a,b,c,d){N.stencilOpSeparate(a,b,c,d)},Ae:function(a,b,c,d,e,f,k,m,p){if(2<=T.version)if(N.mi)N.texImage2D(a,
b,c,d,e,f,k,m,p);else if(p){var u=vg(m);N.texImage2D(a,b,c,d,e,f,k,m,u,p>>wg(u))}else N.texImage2D(a,b,c,d,e,f,k,m,null);else N.texImage2D(a,b,c,d,e,f,k,m,p?xg(m,k,d,e,p):null)},Id:function(a,b,c,d,e,f,k,m,p,u){if(N.mi)N.texImage3D(a,b,c,d,e,f,k,m,p,u);else if(u){var v=vg(p);N.texImage3D(a,b,c,d,e,f,k,m,p,v,u>>wg(v))}else N.texImage3D(a,b,c,d,e,f,k,m,p,null)},ze:function(a,b,c){N.texParameterf(a,b,c)},ye:function(a,b,c){N.texParameterf(a,b,B[c>>2])},xe:function(a,b,c){N.texParameteri(a,b,c)},we:function(a,
b,c){N.texParameteri(a,b,E[c>>2])},Ob:function(a,b,c,d,e){N.texStorage2D(a,b,c,d,e)},Nb:function(a,b,c,d,e,f){N.texStorage3D(a,b,c,d,e,f)},ve:function(a,b,c,d,e,f,k,m,p){if(2<=T.version)if(N.mi)N.texSubImage2D(a,b,c,d,e,f,k,m,p);else if(p){var u=vg(m);N.texSubImage2D(a,b,c,d,e,f,k,m,u,p>>wg(u))}else N.texSubImage2D(a,b,c,d,e,f,k,m,null);else u=null,p&&(u=xg(m,k,e,f,p)),N.texSubImage2D(a,b,c,d,e,f,k,m,u)},Hd:function(a,b,c,d,e,f,k,m,p,u,v){if(N.mi)N.texSubImage3D(a,b,c,d,e,f,k,m,p,u,v);else if(v){var C=
vg(u);N.texSubImage3D(a,b,c,d,e,f,k,m,p,u,C,v>>wg(C))}else N.texSubImage3D(a,b,c,d,e,f,k,m,p,u,null)},bd:function(a,b,c,d){a=Qf[a];for(var e=[],f=0;f<b;f++)e.push(nb(E[c+4*f>>2]));N.transformFeedbackVaryings(a,e,d)},ue:function(a,b){N.uniform1f(V(a),b)},te:function(a,b,c){if(2<=T.version)b&&N.uniform1fv(V(a),B,c>>2,b);else{if(288>=b)for(var d=yg[b-1],e=0;e<b;++e)d[e]=B[c+4*e>>2];else d=B.subarray(c>>2,c+4*b>>2);N.uniform1fv(V(a),d)}},re:function(a,b){N.uniform1i(V(a),b)},qe:function(a,b,c){if(2<=
T.version)b&&N.uniform1iv(V(a),E,c>>2,b);else{if(288>=b)for(var d=zg[b-1],e=0;e<b;++e)d[e]=E[c+4*e>>2];else d=E.subarray(c>>2,c+4*b>>2);N.uniform1iv(V(a),d)}},Rc:function(a,b){N.uniform1ui(V(a),b)},Mc:function(a,b,c){b&&N.uniform1uiv(V(a),h,c>>2,b)},pe:function(a,b,c){N.uniform2f(V(a),b,c)},oe:function(a,b,c){if(2<=T.version)b&&N.uniform2fv(V(a),B,c>>2,2*b);else{if(144>=b)for(var d=yg[2*b-1],e=0;e<2*b;e+=2)d[e]=B[c+4*e>>2],d[e+1]=B[c+(4*e+4)>>2];else d=B.subarray(c>>2,c+8*b>>2);N.uniform2fv(V(a),
d)}},ne:function(a,b,c){N.uniform2i(V(a),b,c)},me:function(a,b,c){if(2<=T.version)b&&N.uniform2iv(V(a),E,c>>2,2*b);else{if(144>=b)for(var d=zg[2*b-1],e=0;e<2*b;e+=2)d[e]=E[c+4*e>>2],d[e+1]=E[c+(4*e+4)>>2];else d=E.subarray(c>>2,c+8*b>>2);N.uniform2iv(V(a),d)}},Qc:function(a,b,c){N.uniform2ui(V(a),b,c)},Lc:function(a,b,c){b&&N.uniform2uiv(V(a),h,c>>2,2*b)},le:function(a,b,c,d){N.uniform3f(V(a),b,c,d)},ke:function(a,b,c){if(2<=T.version)b&&N.uniform3fv(V(a),B,c>>2,3*b);else{if(96>=b)for(var d=yg[3*
b-1],e=0;e<3*b;e+=3)d[e]=B[c+4*e>>2],d[e+1]=B[c+(4*e+4)>>2],d[e+2]=B[c+(4*e+8)>>2];else d=B.subarray(c>>2,c+12*b>>2);N.uniform3fv(V(a),d)}},je:function(a,b,c,d){N.uniform3i(V(a),b,c,d)},ie:function(a,b,c){if(2<=T.version)b&&N.uniform3iv(V(a),E,c>>2,3*b);else{if(96>=b)for(var d=zg[3*b-1],e=0;e<3*b;e+=3)d[e]=E[c+4*e>>2],d[e+1]=E[c+(4*e+4)>>2],d[e+2]=E[c+(4*e+8)>>2];else d=E.subarray(c>>2,c+12*b>>2);N.uniform3iv(V(a),d)}},Pc:function(a,b,c,d){N.uniform3ui(V(a),b,c,d)},Kc:function(a,b,c){b&&N.uniform3uiv(V(a),
h,c>>2,3*b)},ge:function(a,b,c,d,e){N.uniform4f(V(a),b,c,d,e)},fe:function(a,b,c){if(2<=T.version)b&&N.uniform4fv(V(a),B,c>>2,4*b);else{if(72>=b){var d=yg[4*b-1],e=B;c>>=2;for(var f=0;f<4*b;f+=4){var k=c+f;d[f]=e[k];d[f+1]=e[k+1];d[f+2]=e[k+2];d[f+3]=e[k+3]}}else d=B.subarray(c>>2,c+16*b>>2);N.uniform4fv(V(a),d)}},ee:function(a,b,c,d,e){N.uniform4i(V(a),b,c,d,e)},de:function(a,b,c){if(2<=T.version)b&&N.uniform4iv(V(a),E,c>>2,4*b);else{if(72>=b)for(var d=zg[4*b-1],e=0;e<4*b;e+=4)d[e]=E[c+4*e>>2],d[e+
1]=E[c+(4*e+4)>>2],d[e+2]=E[c+(4*e+8)>>2],d[e+3]=E[c+(4*e+12)>>2];else d=E.subarray(c>>2,c+16*b>>2);N.uniform4iv(V(a),d)}},Nc:function(a,b,c,d,e){N.uniform4ui(V(a),b,c,d,e)},Jc:function(a,b,c){b&&N.uniform4uiv(V(a),h,c>>2,4*b)},wc:function(a,b,c){a=Qf[a];N.uniformBlockBinding(a,b,c)},ce:function(a,b,c,d){if(2<=T.version)b&&N.uniformMatrix2fv(V(a),!!c,B,d>>2,4*b);else{if(72>=b)for(var e=yg[4*b-1],f=0;f<4*b;f+=4)e[f]=B[d+4*f>>2],e[f+1]=B[d+(4*f+4)>>2],e[f+2]=B[d+(4*f+8)>>2],e[f+3]=B[d+(4*f+12)>>2];
else e=B.subarray(d>>2,d+16*b>>2);N.uniformMatrix2fv(V(a),!!c,e)}},ud:function(a,b,c,d){b&&N.uniformMatrix2x3fv(V(a),!!c,B,d>>2,6*b)},sd:function(a,b,c,d){b&&N.uniformMatrix2x4fv(V(a),!!c,B,d>>2,8*b)},be:function(a,b,c,d){if(2<=T.version)b&&N.uniformMatrix3fv(V(a),!!c,B,d>>2,9*b);else{if(32>=b)for(var e=yg[9*b-1],f=0;f<9*b;f+=9)e[f]=B[d+4*f>>2],e[f+1]=B[d+(4*f+4)>>2],e[f+2]=B[d+(4*f+8)>>2],e[f+3]=B[d+(4*f+12)>>2],e[f+4]=B[d+(4*f+16)>>2],e[f+5]=B[d+(4*f+20)>>2],e[f+6]=B[d+(4*f+24)>>2],e[f+7]=B[d+(4*
f+28)>>2],e[f+8]=B[d+(4*f+32)>>2];else e=B.subarray(d>>2,d+36*b>>2);N.uniformMatrix3fv(V(a),!!c,e)}},td:function(a,b,c,d){b&&N.uniformMatrix3x2fv(V(a),!!c,B,d>>2,6*b)},qd:function(a,b,c,d){b&&N.uniformMatrix3x4fv(V(a),!!c,B,d>>2,12*b)},ae:function(a,b,c,d){if(2<=T.version)b&&N.uniformMatrix4fv(V(a),!!c,B,d>>2,16*b);else{if(18>=b){var e=yg[16*b-1],f=B;d>>=2;for(var k=0;k<16*b;k+=16){var m=d+k;e[k]=f[m];e[k+1]=f[m+1];e[k+2]=f[m+2];e[k+3]=f[m+3];e[k+4]=f[m+4];e[k+5]=f[m+5];e[k+6]=f[m+6];e[k+7]=f[m+7];
e[k+8]=f[m+8];e[k+9]=f[m+9];e[k+10]=f[m+10];e[k+11]=f[m+11];e[k+12]=f[m+12];e[k+13]=f[m+13];e[k+14]=f[m+14];e[k+15]=f[m+15]}}else e=B.subarray(d>>2,d+64*b>>2);N.uniformMatrix4fv(V(a),!!c,e)}},rd:function(a,b,c,d){b&&N.uniformMatrix4x2fv(V(a),!!c,B,d>>2,8*b)},pd:function(a,b,c,d){b&&N.uniformMatrix4x3fv(V(a),!!c,B,d>>2,12*b)},$d:function(a){a=Qf[a];N.useProgram(a);N.Vj=a},_d:function(a){N.validateProgram(Qf[a])},Zd:function(a,b){N.vertexAttrib1f(a,b)},Xd:function(a,b){N.vertexAttrib1f(a,B[b>>2])},
Wd:function(a,b,c){N.vertexAttrib2f(a,b,c)},Vd:function(a,b){N.vertexAttrib2f(a,B[b>>2],B[b+4>>2])},Ud:function(a,b,c,d){N.vertexAttrib3f(a,b,c,d)},Td:function(a,b){N.vertexAttrib3f(a,B[b>>2],B[b+4>>2],B[b+8>>2])},Sd:function(a,b,c,d,e){N.vertexAttrib4f(a,b,c,d,e)},Rd:function(a,b){N.vertexAttrib4f(a,B[b>>2],B[b+4>>2],B[b+8>>2],B[b+12>>2])},$b:function(a,b){N.vertexAttribDivisor(a,b)},zg:function(a,b){N.vertexAttribDivisor(a,b)},Kb:function(a,b){N.vertexAttribDivisor(a,b)},Od:function(a,b){N.vertexAttribDivisor(a,
b)},Lb:function(a,b){N.vertexAttribDivisor(a,b)},Xc:function(a,b,c,d,e){N.vertexAttribI4i(a,b,c,d,e)},Vc:function(a,b){N.vertexAttribI4i(a,E[b>>2],E[b+4>>2],E[b+8>>2],E[b+12>>2])},Wc:function(a,b,c,d,e){N.vertexAttribI4ui(a,b,c,d,e)},Uc:function(a,b){N.vertexAttribI4ui(a,h[b>>2],h[b+4>>2],h[b+8>>2],h[b+12>>2])},$c:function(a,b,c,d,e){N.vertexAttribIPointer(a,b,c,d,e)},Qd:function(a,b,c,d,e,f){N.vertexAttribPointer(a,b,c,!!d,e,f)},Pd:function(a,b,c,d){N.viewport(a,b,c,d)},pc:function(a,b,c,d){N.waitSync($f[a],
b,(c>>>0)+4294967296*d)},Bb:function(a){var b=t.length;a>>>=0;if(2147483648<a)return!1;for(var c=1;4>=c;c*=2){var d=b*(1+.2/c);d=Math.min(d,a+100663296);var e=Math;d=Math.max(a,d);e=e.min.call(e,2147483648,d+(65536-d%65536)%65536);a:{try{kb.grow(e-qb.byteLength+65535>>>16);vb();var f=1;break a}catch(k){}f=void 0}if(f)return!0}return!1},sa:function(a,b){b>>=2;b={alpha:!!E[b],depth:!!E[b+1],stencil:!!E[b+2],antialias:!!E[b+3],premultipliedAlpha:!!E[b+4],preserveDrawingBuffer:!!E[b+5],powerPreference:Cg[E[b+
6]],failIfMajorPerformanceCaveat:!!E[b+7],Dj:E[b+8],yl:E[b+9],Xj:E[b+10],yk:E[b+11],Cl:E[b+12],Dl:E[b+13]};"number"==typeof a&&(a=nb(a));a=a&&"#canvas"!==a?"undefined"!=typeof wf&&Wf[a]?Wf[a]:Eg(a):"undefined"!=typeof wf&&Wf.canvas?Wf.canvas:g.canvas;return!a||b.yk?0:xf(a,b)},Zc:function(a){T==a&&(T=0);T===yf[a]&&(T=null);if("object"==typeof Bg)for(var b=yf[a].Ni.canvas,c=0;c<Ag.length;++c)if(Ag[c].target==b){var d=c--,e=Ag[d];e.target.removeEventListener(e.sl,e.rl,e.Fl);Ag.splice(d,1)}yf[a]&&yf[a].Ni.canvas&&
(yf[a].Ni.canvas.qk=void 0);yf[a]=null},Dd:function(a){a>>=2;for(var b=0;14>b;++b)E[a+b]=0;E[a]=E[a+1]=E[a+3]=E[a+4]=E[a+8]=E[a+10]=1},id:function(a){return zf(a)?0:-5},yb:function(a,b){var c=0;Gg().forEach(function(d,e){var f=b+c;e=h[a+4*e>>2]=f;for(f=0;f<d.length;++f)rb[e++>>0]=d.charCodeAt(f);rb[e>>0]=0;c+=d.length+1});return 0},zb:function(a,b){var c=Gg();h[a>>2]=c.length;var d=0;c.forEach(function(e){d+=e.length+1});h[b>>2]=d;return 0},ia:$e,pa:function(a){try{var b=nd(a);Wc(b);return 0}catch(c){if("undefined"==
typeof kd||!(c instanceof I))throw c;return c.Fi}},Cb:function(a,b,c,d){try{a:{var e=nd(a);a=b;for(var f=b=0;f<c;f++){var k=h[a>>2],m=h[a+4>>2];a+=8;var p=e,u=k,v=m,C=void 0,D=rb;if(0>v||0>C)throw new I(28);if(null===p.fd)throw new I(8);if(1===(p.flags&2097155))throw new I(8);if(16384===(p.node.mode&61440))throw new I(31);if(!p.fi.read)throw new I(28);var q="undefined"!=typeof C;if(!q)C=p.position;else if(!p.seekable)throw new I(70);var y=p.fi.read(p,D,u,v,C);q||(p.position+=y);var F=y;if(0>F){var R=
-1;break a}b+=F;if(F<m)break}R=b}h[d>>2]=R;return 0}catch(ba){if("undefined"==typeof kd||!(ba instanceof I))throw ba;return ba.Fi}},ub:function(a,b,c,d,e){try{b=c+2097152>>>0<4194305-!!b?(b>>>0)+4294967296*c:NaN;if(isNaN(b))return 61;var f=nd(a);Xc(f,b,d);Ub=[f.position>>>0,(Tb=f.position,1<=+Math.abs(Tb)?0<Tb?(Math.min(+Math.floor(Tb/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Tb-+(~~Tb>>>0))/4294967296)>>>0:0)];E[e>>2]=Ub[0];E[e+4>>2]=Ub[1];f.xj&&0===b&&0===d&&(f.xj=null);return 0}catch(k){if("undefined"==
typeof kd||!(k instanceof I))throw k;return k.Fi}},qa:function(a,b,c,d){try{a:{var e=nd(a);a=b;for(var f=b=0;f<c;f++){var k=h[a>>2],m=h[a+4>>2];a+=8;var p=Yc(e,rb,k,m);if(0>p){var u=-1;break a}b+=p}u=b}h[d>>2]=u;return 0}catch(v){if("undefined"==typeof kd||!(v instanceof I))throw v;return v.Fi}},ea:function(a){N.activeTexture(a)},la:function(a,b){N.attachShader(Qf[a],Uf[b])},_g:function(a,b){N.beginQuery(a,Xf[b])},aa:function(a,b){35051==a?N.Hi=b:35052==a&&(N.mi=b);N.bindBuffer(a,Pf[b])},da:function(a,
b){N.bindFramebuffer(a,Rf[b])},eb:function(a,b){N.bindRenderbuffer(a,Sf[b])},ib:function(a,b){N.bindTexture(a,Tf[b])},Wa:function(a,b){N.blendFunc(a,b)},Xa:function(a,b,c,d){N.blendFuncSeparate(a,b,c,d)},xh:function(a,b,c,d){2<=T.version?c&&b?N.bufferData(a,t,d,c,b):N.bufferData(a,b,d):N.bufferData(a,c?t.subarray(c,c+b):b,d)},wh:function(a,b,c,d){2<=T.version?c&&N.bufferSubData(a,b,t,d,c):N.bufferSubData(a,b,t.subarray(d,d+c))},s:function(a){N.clear(a)},Za:function(a,b,c,d){N.clearColor(a,b,c,d)},
Ya:function(a){N.clearStencil(a)},ab:function(a,b,c,d){N.colorMask(!!a,!!b,!!c,!!d)},oh:function(a){N.compileShader(Uf[a])},Fa:function(){var a=eg(Qf),b=N.createProgram();b.name=a;b.Ai=b.yi=b.zi=0;b.rj=1;Qf[a]=b;return a},qh:function(a){var b=eg(Uf);Uf[b]=N.createShader(a);return b},gb:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Pf[d];e&&(N.deleteBuffer(e),e.name=0,Pf[d]=null,d==N.Hi&&(N.Hi=0),d==N.mi&&(N.mi=0))}},cb:function(a,b){for(var c=0;c<a;++c){var d=E[b+4*c>>2],e=Rf[d];e&&(N.deleteFramebuffer(e),
e.name=0,Rf[d]=null)}},nh:function(a){if(a){var b=Qf[a];b?(N.deleteProgram(b),b.name=0,Qf[a]=null):P(1281)}},$g:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Xf[d];e&&(N.deleteQuery(e),Xf[d]=null)}},db:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Sf[d];e&&(N.deleteRenderbuffer(e),e.name=0,Sf[d]=null)}},rh:function(a){if(a){var b=Uf[a];b?(N.deleteShader(b),Uf[a]=null):P(1281)}},hb:function(a,b){for(var c=0;c<a;c++){var d=E[b+4*c>>2],e=Tf[d];e&&(N.deleteTexture(e),e.name=0,Tf[d]=
null)}},Va:function(a){N.depthFunc(a)},$a:function(a){N.depthMask(!!a)},Ua:function(a,b){N.depthRange(a,b)},Oa:function(a){N.disable(a)},I:function(a){N.disableVertexAttribArray(a)},U:function(a,b,c){N.drawArrays(a,b,c)},ya:function(a,b,c,d){N.drawArraysInstanced(a,b,c,d)},fh:function(a,b){for(var c=ig[a],d=0;d<a;d++)c[d]=E[b+4*d>>2];N.drawBuffers(c)},Da:jg,za:function(a,b,c,d,e){N.drawElementsInstanced(a,b,c,d,e)},Pa:function(a){N.enable(a)},E:function(a){N.enableVertexAttribArray(a)},Zg:function(a){N.endQuery(a)},
ih:function(){N.finish()},Ba:function(a,b,c,d){N.framebufferRenderbuffer(a,b,c,Sf[d])},eh:function(a,b,c,d,e){N.framebufferTexture2D(a,b,c,Tf[d],e)},_a:function(a){N.frontFace(a)},yh:function(a,b){kg(a,b,"createBuffer",Pf)},Ca:function(a,b){kg(a,b,"createFramebuffer",Rf)},ah:function(a,b){kg(a,b,"createQuery",Xf)},hh:function(a,b){kg(a,b,"createRenderbuffer",Sf)},th:function(a,b){kg(a,b,"createTexture",Tf)},vh:function(a){N.generateMipmap(a)},kh:function(a,b,c,d,e,f,k){lg("getActiveAttrib",a,b,c,
d,e,f,k)},jh:function(a,b,c,d,e,f,k){lg("getActiveUniform",a,b,c,d,e,f,k)},mh:function(a,b){return N.getAttribLocation(Qf[a],nb(b))},kb:function(a,b){ng(a,b,4)},mb:function(){var a=N.getError()||dg;dg=0;return a},W:function(a,b){ng(a,b,2)},n:function(a,b){ng(a,b,0)},$:function(a,b,c){if(c)if(a>=Of)P(1281);else if(a=Qf[a],35716==b)a=N.getProgramInfoLog(a),null===a&&(a="(unknown error)"),E[c>>2]=a.length+1;else if(35719==b){if(!a.Ai)for(b=0;b<N.getProgramParameter(a,35718);++b)a.Ai=Math.max(a.Ai,N.getActiveUniform(a,
b).name.length+1);E[c>>2]=a.Ai}else if(35722==b){if(!a.yi)for(b=0;b<N.getProgramParameter(a,35721);++b)a.yi=Math.max(a.yi,N.getActiveAttrib(a,b).name.length+1);E[c>>2]=a.yi}else if(35381==b){if(!a.zi)for(b=0;b<N.getProgramParameter(a,35382);++b)a.zi=Math.max(a.zi,N.getActiveUniformBlockName(a,b).length+1);E[c>>2]=a.zi}else E[c>>2]=N.getProgramParameter(a,b);else P(1281)},wa:function(a,b,c){if(c){a=N.getQueryParameter(Xf[a],b);var d;"boolean"==typeof a?d=a?1:0:d=a;E[c>>2]=d}else P(1281)},lb:function(a,
b,c,d){a=N.getShaderPrecisionFormat(a,b);E[c>>2]=a.rangeMin;E[c+4>>2]=a.rangeMax;E[d>>2]=a.precision},oa:function(a){var b=ag[a];if(!b){switch(a){case 7939:b=N.getSupportedExtensions()||[];b=b.concat(b.map(function(d){return"GL_"+d}));b=pg(b.join(" "));break;case 7936:case 7937:case 37445:case 37446:(b=N.getParameter(a))||P(1280);b=b&&pg(b);break;case 7938:b=N.getParameter(7938);b=2<=T.version?"OpenGL ES 3.0 ("+b+")":"OpenGL ES 2.0 ("+b+")";b=pg(b);break;case 35724:b=N.getParameter(35724);var c=b.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);
null!==c&&(3==c[1].length&&(c[1]+="0"),b="OpenGL ES GLSL ES "+c[1]+" ("+b+")");b=pg(b);break;default:P(1280)}ag[a]=b}return b},lh:function(a,b){b=nb(b);if(a=Qf[a]){sg(a);var c=a.Mi,d=0,e=b,f=rg(b);0<f&&(d=parseInt(b.slice(f+1))>>>0,e=b.slice(0,f));if((e=a.sj[e])&&d<e[0]&&(d+=e[1],c[d]=c[d]||N.getUniformLocation(a,b)))return d}else P(1281);return-1},O:function(a){return N.isEnabled(a)},Ea:function(a){a=Qf[a];N.linkProgram(a);a.Mi=0;a.sj={}},bb:function(a,b){3317==a&&(cg=b);N.pixelStorei(a,b)},Ta:function(a,
b){N.polygonOffset(a,b)},dh:function(a,b,c,d,e,f,k){if(2<=T.version)if(N.Hi)N.readPixels(a,b,c,d,e,f,k);else{var m=vg(f);N.readPixels(a,b,c,d,e,f,m,k>>wg(m))}else(k=xg(f,e,c,d,k))?N.readPixels(a,b,c,d,e,f,k):P(1280)},gh:function(a,b,c,d){N.renderbufferStorage(a,b,c,d)},Sa:function(a,b,c,d){N.scissor(a,b,c,d)},ph:function(a,b,c,d){b=fg(b,c,d);N.shaderSource(Uf[a],b)},ca:function(a,b,c){N.stencilFunc(a,b,c)},V:function(a,b,c,d){N.stencilFuncSeparate(a,b,c,d)},Ra:function(a){N.stencilMask(a)},na:function(a,
b){N.stencilMaskSeparate(a,b)},Qa:function(a,b,c){N.stencilOp(a,b,c)},ma:function(a,b,c,d){N.stencilOpSeparate(a,b,c,d)},Z:function(a,b,c,d,e,f,k,m,p){if(2<=T.version)if(N.mi)N.texImage2D(a,b,c,d,e,f,k,m,p);else if(p){var u=vg(m);N.texImage2D(a,b,c,d,e,f,k,m,u,p>>wg(u))}else N.texImage2D(a,b,c,d,e,f,k,m,null);else N.texImage2D(a,b,c,d,e,f,k,m,p?xg(m,k,d,e,p):null)},uh:function(a,b,c){N.texParameterf(a,b,c)},F:function(a,b,c){N.texParameteri(a,b,c)},q:function(a,b){N.uniform1f(V(a),b)},N:function(a,
b,c){if(2<=T.version)b&&N.uniform1fv(V(a),B,c>>2,b);else{if(288>=b)for(var d=yg[b-1],e=0;e<b;++e)d[e]=B[c+4*e>>2];else d=B.subarray(c>>2,c+4*b>>2);N.uniform1fv(V(a),d)}},k:function(a,b){N.uniform1i(V(a),b)},z:function(a,b,c){N.uniform2f(V(a),b,c)},Aa:function(a,b,c){if(2<=T.version)b&&N.uniform2fv(V(a),B,c>>2,2*b);else{if(144>=b)for(var d=yg[2*b-1],e=0;e<2*b;e+=2)d[e]=B[c+4*e>>2],d[e+1]=B[c+(4*e+4)>>2];else d=B.subarray(c>>2,c+8*b>>2);N.uniform2fv(V(a),d)}},ch:function(a,b,c){N.uniform2i(V(a),b,c)},
ja:function(a,b,c,d){N.uniform3f(V(a),b,c,d)},H:function(a,b,c){if(2<=T.version)b&&N.uniform3fv(V(a),B,c>>2,3*b);else{if(96>=b)for(var d=yg[3*b-1],e=0;e<3*b;e+=3)d[e]=B[c+4*e>>2],d[e+1]=B[c+(4*e+4)>>2],d[e+2]=B[c+(4*e+8)>>2];else d=B.subarray(c>>2,c+12*b>>2);N.uniform3fv(V(a),d)}},T:function(a,b,c,d,e){N.uniform4f(V(a),b,c,d,e)},r:function(a,b,c){if(2<=T.version)b&&N.uniform4fv(V(a),B,c>>2,4*b);else{if(72>=b){var d=yg[4*b-1],e=B;c>>=2;for(var f=0;f<4*b;f+=4){var k=c+f;d[f]=e[k];d[f+1]=e[k+1];d[f+
2]=e[k+2];d[f+3]=e[k+3]}}else d=B.subarray(c>>2,c+16*b>>2);N.uniform4fv(V(a),d)}},ka:function(a,b,c,d){if(2<=T.version)b&&N.uniformMatrix3fv(V(a),!!c,B,d>>2,9*b);else{if(32>=b)for(var e=yg[9*b-1],f=0;f<9*b;f+=9)e[f]=B[d+4*f>>2],e[f+1]=B[d+(4*f+4)>>2],e[f+2]=B[d+(4*f+8)>>2],e[f+3]=B[d+(4*f+12)>>2],e[f+4]=B[d+(4*f+16)>>2],e[f+5]=B[d+(4*f+20)>>2],e[f+6]=B[d+(4*f+24)>>2],e[f+7]=B[d+(4*f+28)>>2],e[f+8]=B[d+(4*f+32)>>2];else e=B.subarray(d>>2,d+36*b>>2);N.uniformMatrix3fv(V(a),!!c,e)}},u:function(a,b,c,
d){if(2<=T.version)b&&N.uniformMatrix4fv(V(a),!!c,B,d>>2,16*b);else{if(18>=b){var e=yg[16*b-1],f=B;d>>=2;for(var k=0;k<16*b;k+=16){var m=d+k;e[k]=f[m];e[k+1]=f[m+1];e[k+2]=f[m+2];e[k+3]=f[m+3];e[k+4]=f[m+4];e[k+5]=f[m+5];e[k+6]=f[m+6];e[k+7]=f[m+7];e[k+8]=f[m+8];e[k+9]=f[m+9];e[k+10]=f[m+10];e[k+11]=f[m+11];e[k+12]=f[m+12];e[k+13]=f[m+13];e[k+14]=f[m+14];e[k+15]=f[m+15]}}else e=B.subarray(d>>2,d+64*b>>2);N.uniformMatrix4fv(V(a),!!c,e)}},fb:function(a){a=Qf[a];N.useProgram(a);N.Vj=a},xa:function(a,
b){N.vertexAttrib1f(a,b)},bh:function(a,b,c,d,e){N.vertexAttrib4f(a,b,c,d,e)},G:function(a,b){N.vertexAttribDivisor(a,b)},C:function(a,b,c,d,e,f){N.vertexAttribPointer(a,b,c,!!d,e,f)},jb:function(a,b,c,d){N.viewport(a,b,c,d)},sh:function(a,b,c,d,e){pf();a=t.subarray(a,a+b);b=null;c=["image/jpeg","image/png","image/gif","image/bmp","image/svg+xml"][c];var f=[N.LUMINANCE,N.LUMINANCE_ALPHA,N.RGB,N.RGBA][d-1];void 0===f&&(f=N.RGBA);if(rf)try{b=new Blob([a],{type:c}),b.size!==a.length&&(b=new Blob([(new Uint8Array(a)).buffer],
{type:c}))}catch(D){}b||(c=new sf,c.append((new Uint8Array(a)).buffer),b=c.getBlob());var k=Jg("wrapperTexturePreLoad","number",["number","number","number","number"]),m=Jg("wrapperTexturePostLoad",null,["number","number","number"]),p=Jg("wrapperTextureOnError",null,["number","number"]),u=tf.createObjectURL(b),v=document.createElement("img"),C=g.$$facade;v.onload=function(){if(C===g.$$facade){var D=1;k&&(D=k(e,v.width,v.height,d));var q=0;if(D)try{N.texImage2D(N.TEXTURE_2D,0,f,f,N.UNSIGNED_BYTE,v),
q=1}catch(y){}m&&m(0,e,q)}else m&&m(1,e,0);tf.revokeObjectURL(u)};v.onerror=function(){C===g.$$facade?p&&p(0,e):p&&p(1,e);tf.revokeObjectURL(u)};v.src=u},va:function(){return g.bj?Kg.close.apply(Kg,arguments):Lg.close.apply(Lg,arguments)},Yg:function(){window.addEventListener("beforeunload",function(){g.bj?Kg.close():Lg.close()})},Xg:function(a,b,c){g.fk=0;self.bowser.chrome&&0>self.bowser.compareVersions([self.bowser.version,"68"])&&(g.bj=!0);return g.bj?Kg.connect.apply(Kg,arguments):Lg.connect.apply(Lg,
arguments)},Wg:function(a,b){return g.bj?Kg.Kj.apply(Kg,arguments):Lg.Kj.apply(Lg,arguments)},xb:function(a,b,c,d){return Pg(a,b,c,d)}};
(function(){function a(e){g.asm=e.exports;kb=g.asm.Fh;vb();wb=g.asm.Hh;yb.unshift(g.asm.Gh);Kb("wasm-instantiate")}function b(e){a(e.instance)}function c(e){return Pb().then(function(f){return WebAssembly.instantiate(f,d)}).then(function(f){return f}).then(e,function(f){db("failed to asynchronously prepare wasm: "+f);gb(f)})}var d={a:Xg};Jb("wasm-instantiate");if(g.instantiateWasm)try{return g.instantiateWasm(d,a)}catch(e){return db("Module.instantiateWasm callback failed with error: "+e),!1}(function(){return fb||
"function"!=typeof WebAssembly.instantiateStreaming||Lb()||Mb.startsWith("file://")||Ta||"function"!=typeof fetch?c(b):fetch(Mb,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,d).then(b,function(f){db("wasm streaming compile failed: "+f);db("falling back to ArrayBuffer instantiation");return c(b)})})})();return{}})();g.___wasm_call_ctors=function(){return(g.___wasm_call_ctors=g.asm.Gh).apply(null,arguments)};
g._callFuncWrapper=function(){return(g._callFuncWrapper=g.asm.Ih).apply(null,arguments)};g._main=function(){return(g._main=g.asm.Jh).apply(null,arguments)};g._wrapperTexturePreLoad=function(){return(g._wrapperTexturePreLoad=g.asm.Kh).apply(null,arguments)};g._wrapperTexturePostLoad=function(){return(g._wrapperTexturePostLoad=g.asm.Lh).apply(null,arguments)};g._wrapperTextureOnError=function(){return(g._wrapperTextureOnError=g.asm.Mh).apply(null,arguments)};
var le=g._free=function(){return(le=g._free=g.asm.Nh).apply(null,arguments)},Wg=g.___errno_location=function(){return(Wg=g.___errno_location=g.asm.Oh).apply(null,arguments)},qg=g._malloc=function(){return(qg=g._malloc=g.asm.Ph).apply(null,arguments)};g._webSocketHandlerOnMessage=function(){return(g._webSocketHandlerOnMessage=g.asm.Qh).apply(null,arguments)};var ke=g.___getTypeName=function(){return(ke=g.___getTypeName=g.asm.Rh).apply(null,arguments)};
g.__embind_initialize_bindings=function(){return(g.__embind_initialize_bindings=g.asm.Sh).apply(null,arguments)};var Ga=g.stackSave=function(){return(Ga=g.stackSave=g.asm.Th).apply(null,arguments)},La=g.stackRestore=function(){return(La=g.stackRestore=g.asm.Uh).apply(null,arguments)},Ka=g.stackAlloc=function(){return(Ka=g.stackAlloc=g.asm.Vh).apply(null,arguments)};g.dynCall_viiijiiiiiiiiiii=function(){return(g.dynCall_viiijiiiiiiiiiii=g.asm.Wh).apply(null,arguments)};
g.dynCall_iij=function(){return(g.dynCall_iij=g.asm.Xh).apply(null,arguments)};g.dynCall_iiiiiijii=function(){return(g.dynCall_iiiiiijii=g.asm.Yh).apply(null,arguments)};g.dynCall_jiji=function(){return(g.dynCall_jiji=g.asm.Zh).apply(null,arguments)};g.dynCall_viijii=function(){return(g.dynCall_viijii=g.asm._h).apply(null,arguments)};g.dynCall_iiiiij=function(){return(g.dynCall_iiiiij=g.asm.$h).apply(null,arguments)};g.dynCall_iiiiijj=function(){return(g.dynCall_iiiiijj=g.asm.ai).apply(null,arguments)};
g.dynCall_iiiiiijj=function(){return(g.dynCall_iiiiiijj=g.asm.bi).apply(null,arguments)};g.___emscripten_embedded_file_data=658824;g.addRunDependency=Jb;g.removeRunDependency=Kb;g.FS_createPath=bd;g.FS_createDataFile=dd;g.FS_createPreloadedFile=hd;g.FS_createLazyFile=gd;g.FS_createDevice=ed;g.FS_unlink=Sc;g.ccall=Qg;g.cwrap=Jg;var Yg;Ib=function Zg(){Yg||$g();Yg||(Ib=Zg)};
function $g(){function a(){if(!Yg&&(Yg=!0,g.calledRun=!0,!lb)){g.noFSInit||$c||($c=!0,Zc(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?ed("/dev","stdin",g.stdin):Rc("/dev/tty","/dev/stdin"),g.stdout?ed("/dev","stdout",null,g.stdout):Rc("/dev/tty","/dev/stdout"),g.stderr?ed("/dev","stderr",null,g.stderr):Rc("/dev/tty1","/dev/stderr"),Uc("/dev/stdin",0),Uc("/dev/stdout",1),Uc("/dev/stderr",1));wc=!1;Wb(yb);Wb(zb);if(g.onRuntimeInitialized)g.onRuntimeInitialized();if(ah){var b=g._main;
try{var c=b(0,0);$e(c,!0)}catch(d){af(d)}}if(g.postRun)for("function"==typeof g.postRun&&(g.postRun=[g.postRun]);g.postRun.length;)b=g.postRun.shift(),Ab.unshift(b);Wb(Ab)}}if(!(0<Gb)){if(g.preRun)for("function"==typeof g.preRun&&(g.preRun=[g.preRun]);g.preRun.length;)Bb();Wb(xb);0<Gb||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1);a()},1)):a())}}if(g.preInit)for("function"==typeof g.preInit&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();
var ah=!0;g.noInitialRun&&(ah=!1);$g();
	};

	var catchExceptions = function (name, func) {
		return function () {
			try {
				func.apply(this, arguments);
			} catch (e) {
				console.log("Unhandled exception in " + name + "():");
				console.log(e);
			}
		};
	};

	var getElement = function (id) {
		if (typeof id !== "string")
			return id;
		return document.getElementById (id);
	};

	var core_pool = [];

	var getAvailableCore = function () {
		for (var i = 0; i < core_pool.length; ++i) {
			if (core_pool[i].$$available) {
				return core_pool[i];
			}
		}
		return null;
	};

	var enginePath;
	if (_SC) {
		enginePath = _SC._enginePath;
	}

	// used by Emscripten to find .wasm file
	var locateFile = function (path) {
		if (enginePath) {
			return enginePath + "/" + path;
		}
		return path;
	};

	var createInstance = function (args) {
		var facade;
		if (args.isWrapper) {
			// populate same instance object returned from engine-loader.js
			facade = args.base;
			args = args.args;
		} else {
			facade = {};
		}

		var container = getElement (args.container);
		if (! container)
			throw new TypeError ("'container' argument is missing or invalid");
		facade.container = container;

		var core = getAvailableCore ();
		var core_is_new = ! core;

		// provides reference point for absolute position
		var sub_container = document.createElement ("div");
		sub_container.setAttribute ("style", "position: relative; overflow: hidden; width: 100%; height: 100%; padding: 0; margin: 0; border: 0;");

		if (core_is_new) {
			core = {
				$$available: false,
				locateFile: locateFile,
			};
			core_pool.push (core);

			core.callAfterMap = {
				index: 0,
				indexedWrappers: {},
			};

			// wraps canvas and SSR elements
			var wrapper = document.createElement ("div");
			wrapper.setAttribute ("style", "position: absolute; overflow: hidden; width: 100%; height: 100%; padding: 0; margin: 0; border: 0;");

			var canvas = document.createElement ("canvas");
			canvas.setAttribute ("style", "position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 0; margin: 0; border: 0;");

			core.canvas = canvas;
			core.$$wrapper = wrapper;
		} else {
			core.$$available = false;
		}

		core.canvas.style.display = "";
		core.$$wrapper.appendChild (core.canvas);

		// facade will only call core functions if it matches core.$$facade
		core.$$facade = facade;
		core.$$onReady = catchExceptions("onReady", function () {
			var onReady = args.onReady ? args.onReady : args.on_ready;
			if (typeof onReady === "function") {
				onReady(facade);
			}
		});
		if (typeof args.onError === "function") {
			// XXX after abort() is called, this core cannot be reused
			core.onAbort = catchExceptions("onError", function (message) {
				// avoid presenting cryptic Emscripten errors as our own
				args.onError("fatal error: see console");
			});
		}

		// sits on top of wrapper, preventing wrapper and children from receiving input events
		var event_blocker = document.createElement ("div");
		event_blocker.setAttribute ("style", "position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 0; margin: 0; border: 0;");
		event_blocker.onmousedown = function (e) { e.preventDefault (); }; // prevent cursor change on drag
		event_blocker.oncontextmenu = function (e) { e.preventDefault (); };

		sub_container.appendChild (core.$$wrapper);
		sub_container.appendChild (event_blocker);
		container.innerHTML = "";
		container.appendChild (sub_container);

		if (core_is_new) {
			createInstanceImpl.call (core);
		} else {
			setTimeout (function () { core.$$setReady (); });
		}

		return facade;
	};

	// process deferred calls to createInstance() from engine-loader.js
	(function () {
		if (typeof _SC !== "undefined" && Array.isArray (_SC._deferredInstances))
			for (var i = 0; i < _SC._deferredInstances.length; i++)
				createInstance (_SC._deferredInstances[i]);
	})();

	return {
		createInstance: createInstance
	};
})();

(function(m,r,R,S,E,L){function Ka(a,b,c,d,e){return ha(a,a,c,d,b,a.defaultView.pageXOffset,a.defaultView.pageYOffset).then(function(f){q("Document cloned");var g="data-html2canvas-node"+e,h="["+g+"='"+e+"']";a.querySelector(h).removeAttribute(g);var g=f.contentWindow,k=g.document.querySelector(h);return("function"===typeof b.onclone?Promise.resolve(b.onclone(g.document)):Promise.resolve(!0)).then(function(){return ia(k,f,b,c,d)})})}function ia(a,b,c,d,e){var f=b.contentWindow,g=new T(f.document),
h=new u(c,g),k=U(a);d="view"===c.type?d:La(f.document);e="view"===c.type?e:Ma(f.document);var F=new c.renderer(d,e,h,c,r);return(new n(a,F,g,h,c)).ready.then(function(){q("Finished rendering");var d;d="view"===c.type?ja(F.canvas,{width:F.canvas.width,height:F.canvas.height,top:0,left:0,x:0,y:0}):a===f.document.body||a===f.document.documentElement||null!=c.canvas?F.canvas:ja(F.canvas,{width:null!=c.width?c.width:k.width,height:null!=c.height?c.height:k.height,top:k.top,left:k.left,x:f.pageXOffset,
y:f.pageYOffset});c.removeContainer&&(b.parentNode.removeChild(b),q("Cleaned up container"));return d})}function ja(a,b){var c=r.createElement("canvas"),d=Math.min(a.width-1,Math.max(0,b.left)),e=Math.min(a.width,Math.max(1,b.left+b.width)),f=Math.min(a.height-1,Math.max(0,b.top)),g=Math.min(a.height,Math.max(1,b.top+b.height));c.width=b.width;c.height=b.height;q("Cropping canvas at:","left:",b.left,"top:",b.top,"width:",e-d,"height:",g-f);q("Resulting crop with width",b.width,"and height",b.height,
" with x",d,"and y",f);c.getContext("2d").drawImage(a,d,f,e-d,g-f,b.x,b.y,e-d,g-f);return c}function La(a){return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function Ma(a){return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}
function ka(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}function la(a,b){for(var c=3===a.nodeType?r.createTextNode(a.nodeValue):a.cloneNode(!1),d=a.firstChild;d;)!0!==b&&1===d.nodeType&&"SCRIPT"===d.nodeName||c.appendChild(la(d,b)),d=d.nextSibling;return c}function ha(a,b,c,d,e,f,g){Na(a);var h=r.documentMode&&9>=r.documentMode?la(a.documentElement,e.javascriptEnabled):a.documentElement.cloneNode(!0),k=b.createElement("iframe");k.className="html2canvas-container";
k.style.visibility="hidden";k.style.position="fixed";k.style.left="-10000px";k.style.top="0px";k.style.border="0";k.width=c;k.height=d;k.scrolling="no";b.body.appendChild(k);return new Promise(function(b){var c=k.contentWindow.document;ma(a.documentElement,h,"textarea");ma(a.documentElement,h,"select");k.contentWindow.onload=k.onload=function(){var d=setInterval(function(){0<c.body.childNodes.length&&(Oa(a,c),clearInterval(d),"view"===e.type&&k.contentWindow.scrollTo(f,g),b(k))},50)};c.open();c.write("<!DOCTYPE html><html></html>");
!a.defaultView||f===a.defaultView.pageXOffset&&g===a.defaultView.pageYOffset||a.defaultView.scrollTo(f,g);c.replaceChild(!0===e.javascriptEnabled?c.adoptNode(h):na(c.adoptNode(h)),c.documentElement);c.close()})}function ma(a,b,c){a=a.getElementsByTagName(c);b=b.getElementsByTagName(c);c=a.length;for(var d=0;d<c;d++)b[d].value=a[d].value}function oa(a,b,c,d,e,f){return(new Pa(a,b,m.document)).then(Qa(a)).then(function(a){return ha(a,c,d,e,f,0,0)})}function Qa(a){return function(b){var c=new DOMParser,
d;try{d=c.parseFromString(b,"text/html")}catch(e){q("DOMParser not supported, falling back to createHTMLDocument");d=r.implementation.createHTMLDocument("");try{d.open(),d.write(b),d.close()}catch(f){q("createHTMLDocument write not supported, falling back to document.body.innerHTML"),d.body.innerHTML=b}}b=d.querySelector("base");b&&b.href.host||(b=d.createElement("base"),b.href=a,d.head.insertBefore(b,d.head.firstChild));return d}}function Na(a){[].slice.call(a.querySelectorAll("canvas"),0).forEach(function(a){a.setAttribute("data-html2canvas-canvas-clone",
"canvas-"+Ra++)})}function Oa(a,b){[].slice.call(a.querySelectorAll("[data-html2canvas-canvas-clone]"),0).forEach(function(a){try{var d=b.querySelector('[data-html2canvas-canvas-clone="'+a.getAttribute("data-html2canvas-canvas-clone")+'"]');d&&(d.width=a.width,d.height=a.height,d.getContext("2d").putImageData(a.getContext("2d").getImageData(0,0,a.width,a.height),0,0))}catch(e){q("Unable to copy canvas content from",a,e)}a.removeAttribute("data-html2canvas-canvas-clone")})}function na(a){[].slice.call(a.childNodes,
0).filter(Sa).forEach(function(b){"SCRIPT"===b.tagName?a.removeChild(b):na(b)});return a}function Sa(a){return a.nodeType===Node.ELEMENT_NODE}function Ta(a){var b=r.createElement("a");b.href=a;b.href=b.href;return b}function t(a){this.b=this.g=this.r=0;this.a=null;this.fromArray(a)||this.namedColor(a)||this.rgb(a)||this.rgba(a)||this.hex6(a)||this.hex3(a)}function M(a){this.src=a;q("DummyImageContainer for",a);if(!this.promise||!this.image){q("Initiating DummyImageContainer");M.prototype.image=new Image;
var b=this.image;M.prototype.promise=new Promise(function(a,d){b.onload=a;b.onerror=d;b.src=ka();!0===b.complete&&a(b)})}}function Ua(a,b){var c=r.createElement("div"),d=r.createElement("img"),e=r.createElement("span"),f;c.style.visibility="hidden";c.style.fontFamily=a;c.style.fontSize=b;c.style.margin=0;c.style.padding=0;r.body.appendChild(c);d.src=ka();d.width=1;d.height=1;d.style.margin=0;d.style.padding=0;d.style.verticalAlign="baseline";e.style.fontFamily=a;e.style.fontSize=b;e.style.margin=
0;e.style.padding=0;e.appendChild(r.createTextNode("Hidden Text"));c.appendChild(e);c.appendChild(d);f=d.offsetTop-e.offsetTop+1;c.removeChild(e);c.appendChild(r.createTextNode("Hidden Text"));c.style.lineHeight="normal";d.style.verticalAlign="super";d=d.offsetTop-c.offsetTop+1;r.body.removeChild(c);this.baseline=f;this.lineWidth=1;this.middle=d}function pa(){this.data={}}function qa(a,b,c){this.image=null;this.src=a;var d=this,e=U(a);this.promise=(b?new Promise(function(b){"about:blank"===a.contentWindow.document.URL||
null==a.contentWindow.document.documentElement?a.contentWindow.onload=a.onload=function(){b(a)}:b(a)}):this.proxyLoad(c.proxy,e,c)).then(function(a){return html2canvas(a.contentWindow.document.documentElement,{type:"view",width:a.width,height:a.height,proxy:c.proxy,javascriptEnabled:c.javascriptEnabled,removeContainer:c.removeContainer,allowTaint:c.allowTaint,imageTimeout:c.imageTimeout/2})}).then(function(a){return d.image=a})}function N(a){this.src=a.value;this.colorStops=[];this.type=null;this.y1=
this.x1=this.y0=this.x0=.5;this.promise=Promise.resolve(!0)}function ba(a,b){this.src=a;this.image=new Image;var c=this;this.tainted=null;this.promise=new Promise(function(d,e){c.image.onload=d;c.image.onerror=e;b&&(c.image.crossOrigin="anonymous");c.image.src=a;!0===c.image.complete&&d(c.image)})}function u(a,b){this.link=null;this.options=a;this.support=b;this.origin=this.getOrigin(m.location.href)}function V(a){N.apply(this,arguments);this.type=this.TYPES.LINEAR;var b=null===a.args[0].match(this.stepRegExp);
b?a.args[0].split(" ").reverse().forEach(function(a){switch(a){case "left":this.x0=0;this.x1=1;break;case "top":this.y0=0;this.y1=1;break;case "right":this.x0=1;this.x1=0;break;case "bottom":this.y0=1;this.y1=0;break;case "to":a=this.y0;var b=this.x0;this.y0=this.y1;this.x0=this.x1;this.x1=b;this.y1=a}},this):(this.y0=0,this.y1=1);this.colorStops=a.args.slice(b?1:0).map(function(a){a=a.match(this.stepRegExp);return{color:new t(a[1]),stop:"%"===a[3]?a[2]/100:null}},this);null===this.colorStops[0].stop&&
(this.colorStops[0].stop=0);null===this.colorStops[this.colorStops.length-1].stop&&(this.colorStops[this.colorStops.length-1].stop=1);this.colorStops.forEach(function(a,b){null===a.stop&&this.colorStops.slice(b).some(function(e,f){return null!==e.stop?(a.stop=(e.stop-this.colorStops[b-1].stop)/(f+1)+this.colorStops[b-1].stop,!0):!1},this)},this)}function q(){m.html2canvas.logging&&m.console&&m.console.log&&Function.prototype.bind.call(m.console.log,m.console).apply(m.console,[Date.now()-m.html2canvas.start+
"ms","html2canvas:"].concat([].slice.call(arguments,0)))}function l(a,b){this.node=a;this.parent=b;this.borders=this.bounds=this.stack=null;this.clip=[];this.backgroundClip=[];this.computedStyles=this.visible=this.offsetBounds=null;this.colors={};this.styles={};this.transformMatrix=this.transformData=this.backgroundImages=null;this.isPseudoElement=!1;this.opacity=null}function Va(a){if(a&&"matrix"===a[1])return a[2].split(",").map(function(a){return parseFloat(a.trim())})}function W(a){return-1!==
a.toString().indexOf("%")}function ra(a){var b,c,d,e,f,g=[],h=0,k=0,l,m,q=function(){b&&('"'===c.substr(0,1)&&(c=c.substr(1,c.length-2)),c&&m.push(c),"-"===b.substr(0,1)&&0<(e=b.indexOf("-",1)+1)&&(d=b.substr(0,e),b=b.substr(e)),g.push({prefix:d,method:b.toLowerCase(),value:f,args:m,image:null}));m=[];b=d=c=f=""};m=[];b=d=c=f="";a.split("").forEach(function(a){if(!(0===h&&-1<" \r\n\t".indexOf(a))){switch(a){case '"':l?l===a&&(l=null):l=a;break;case "(":if(!l){if(0===h){h=1;f+=a;return}k++}break;case ")":if(!l&&
1===h){if(0===k){h=0;f+=a;q();return}k--}break;case ",":if(!l){if(0===h){q();return}if(1===h&&0===k&&!b.match(/^url$/i)){m.push(c);c="";f+=a;return}}}f+=a;0===h?b+=a:c+=a}});q();return g}function Wa(a){return a.replace("px","")}function Xa(a){return parseFloat(a)}function U(a){if(a.getBoundingClientRect){var b=a.getBoundingClientRect(),c=null==a.offsetWidth?b.width:a.offsetWidth;return{top:b.top,bottom:b.bottom||b.top+b.height,right:b.left+c,left:b.left,width:c,height:null==a.offsetHeight?b.height:
a.offsetHeight}}return{}}function ca(a){var b=a.offsetParent?ca(a.offsetParent):{top:0,left:0};return{top:a.offsetTop+b.top,bottom:a.offsetTop+a.offsetHeight+b.top,right:a.offsetLeft+b.left+a.offsetWidth,left:a.offsetLeft+b.left,width:a.offsetWidth,height:a.offsetHeight}}function n(a,b,c,d,e){q("Starting NodeParser");this.renderer=b;this.options=e;this.range=null;this.support=c;this.renderQueue=[];this.stack=new G(!0,1,a.ownerDocument,null);c=new l(a,null);e.background&&b.rectangle(0,0,b.width,b.height,
new t(e.background));if(a===a.ownerDocument.documentElement){var f=new l(c.color("backgroundColor").isTransparent()?a.ownerDocument.body:a.ownerDocument.documentElement,null);b.rectangle(0,0,b.width,b.height,f.color("backgroundColor"))}c.visibile=c.isElementVisible();this.createPseudoHideStyles(a.ownerDocument);this.disableAnimations(a.ownerDocument);this.nodes=[].concat.apply([],[c].concat(this.getChildren(c)).filter(function(a){return a.visible=a.isElementVisible()}).map(this.getPseudoElements,
this));this.fontMetrics=new pa;q("Fetched nodes, total:",this.nodes.length);q("Calculate overflow clips");this.calculateOverflowClips();q("Start fetching images");this.images=d.fetch(this.nodes.filter(O));this.ready=this.images.ready.then(X(function(){q("Images loaded, starting parsing");q("Creating stacking contexts");this.createStackingContexts();q("Sorting stacking contexts");this.sortStackingContexts(this.stack);this.parse(this.stack);q("Render queue created with "+this.renderQueue.length+" items");
return new Promise(X(function(a){e.async?"function"===typeof e.async?e.async.call(this,this.renderQueue,a):0<this.renderQueue.length?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,a)):a():(this.renderQueue.forEach(this.paint,this),a())},this))},this))}function Ya(a){return a.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})}function sa(){}function ta(a,b,c,d){return a.map(function(e,f){if(0<e.width){var g=b.left,h=b.top,k=b.width,l=b.height-a[2].width;switch(f){case 0:l=
a[0].width;e.args=Y({c1:[g,h],c2:[g+k,h],c3:[g+k-a[1].width,h+l],c4:[g+a[3].width,h+l]},d[0],d[1],c.topLeftOuter,c.topLeftInner,c.topRightOuter,c.topRightInner);break;case 1:g=b.left+b.width-a[1].width;k=a[1].width;e.args=Y({c1:[g+k,h],c2:[g+k,h+l+a[2].width],c3:[g,h+l],c4:[g,h+a[0].width]},d[1],d[2],c.topRightOuter,c.topRightInner,c.bottomRightOuter,c.bottomRightInner);break;case 2:h=h+b.height-a[2].width;l=a[2].width;e.args=Y({c1:[g+k,h+l],c2:[g,h+l],c3:[g+a[3].width,h],c4:[g+k-a[3].width,h]},d[2],
d[3],c.bottomRightOuter,c.bottomRightInner,c.bottomLeftOuter,c.bottomLeftInner);break;case 3:k=a[3].width,e.args=Y({c1:[g,h+l+a[2].width],c2:[g,h],c3:[g+k,h+a[0].width],c4:[g+k,h+l]},d[3],d[0],c.bottomLeftOuter,c.bottomLeftInner,c.topLeftOuter,c.topLeftInner)}}return e})}function C(a,b,c,d){var e=(Math.sqrt(2)-1)/3*4,f=c*e,e=d*e;c=a+c;d=b+d;return{topLeft:H({x:a,y:d},{x:a,y:d-e},{x:c-f,y:b},{x:c,y:b}),topRight:H({x:a,y:b},{x:a+f,y:b},{x:c,y:d-e},{x:c,y:d}),bottomRight:H({x:c,y:b},{x:c,y:b+e},{x:a+
f,y:d},{x:a,y:d}),bottomLeft:H({x:c,y:d},{x:c-f,y:d},{x:a,y:b+e},{x:a,y:b})}}function ua(a,b,c){var d=a.left,e=a.top,f=a.width;a=a.height;var g=b[0][0],h=b[0][1],k=b[1][0],l=b[1][1],m=b[2][0],q=b[2][1],r=b[3][0];b=b[3][1];var n=f-k,t=a-q,p=f-m,u=a-b;return{topLeftOuter:C(d,e,g,h).topLeft.subdivide(.5),topLeftInner:C(d+c[3].width,e+c[0].width,Math.max(0,g-c[3].width),Math.max(0,h-c[0].width)).topLeft.subdivide(.5),topRightOuter:C(d+n,e,k,l).topRight.subdivide(.5),topRightInner:C(d+Math.min(n,f+c[3].width),
e+c[0].width,n>f+c[3].width?0:k-c[3].width,l-c[0].width).topRight.subdivide(.5),bottomRightOuter:C(d+p,e+t,m,q).bottomRight.subdivide(.5),bottomRightInner:C(d+Math.min(p,f-c[3].width),e+Math.min(t,a+c[0].width),Math.max(0,m-c[1].width),q-c[2].width).bottomRight.subdivide(.5),bottomLeftOuter:C(d,e+u,r,b).bottomLeft.subdivide(.5),bottomLeftInner:C(d+c[3].width,e+u,Math.max(0,r-c[3].width),b-c[2].width).bottomLeft.subdivide(.5)}}function H(a,b,c,d){var e=function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+
(b.y-a.y)*c}};return{start:a,startControl:b,endControl:c,end:d,subdivide:function(f){var g=e(a,b,f),h=e(b,c,f),k=e(c,d,f),l=e(g,h,f),h=e(h,k,f);f=e(l,h,f);return[H(a,g,l,f),H(f,h,k,d)]},curveTo:function(a){a.push(["bezierCurve",b.x,b.y,c.x,c.y,d.x,d.y])},curveToReversed:function(d){d.push(["bezierCurve",c.x,c.y,b.x,b.y,a.x,a.y])}}}function Y(a,b,c,d,e,f,g){var h=[];0<b[0]||0<b[1]?(h.push(["line",d[1].start.x,d[1].start.y]),d[1].curveTo(h)):h.push(["line",a.c1[0],a.c1[1]]);0<c[0]||0<c[1]?(h.push(["line",
f[0].start.x,f[0].start.y]),f[0].curveTo(h),h.push(["line",g[0].end.x,g[0].end.y]),g[0].curveToReversed(h)):(h.push(["line",a.c2[0],a.c2[1]]),h.push(["line",a.c3[0],a.c3[1]]));0<b[0]||0<b[1]?(h.push(["line",e[1].end.x,e[1].end.y]),e[1].curveToReversed(h)):h.push(["line",a.c4[0],a.c4[1]]);return h}function D(a,b,c,d,e,f,g){0<b[0]||0<b[1]?(a.push(["line",d[0].start.x,d[0].start.y]),d[0].curveTo(a),d[1].curveTo(a)):a.push(["line",f,g]);(0<c[0]||0<c[1])&&a.push(["line",e[0].start.x,e[0].start.y])}function Za(a){return 0>
a.cssInt("zIndex")}function $a(a){return 0<a.cssInt("zIndex")}function va(a){return 0===a.cssInt("zIndex")}function wa(a){return-1!==["inline","inline-block","inline-table"].indexOf(a.css("display"))}function ab(a){return 0<a.node.data.trim().length}function bb(a){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(b){b=a.css("border"+b+"Radius").split(" ");1>=b.length&&(b[1]=b[0]);return b.map(cb)})}function db(a){return a.nodeType===Node.TEXT_NODE||a.nodeType===Node.ELEMENT_NODE}
function P(a){return"static"!==a.css("position")}function da(a){return"none"!==a.css("float")}function Q(a){var b=this;return function(){return!a.apply(b,arguments)}}function O(a){return a.node.nodeType===Node.ELEMENT_NODE}function ea(a){return a.node.nodeType===Node.TEXT_NODE}function eb(a){return function(b,c){return b.cssInt("zIndex")+a.indexOf(b)/a.length-(c.cssInt("zIndex")+a.indexOf(c)/a.length)}}function X(a,b){return function(){return a.apply(b,arguments)}}function cb(a){return parseInt(a,
10)}function fb(a){return a.width}function gb(a){return a.node.nodeType!==Node.ELEMENT_NODE||-1==="SCRIPT HEAD TITLE OBJECT BR OPTION".split(" ").indexOf(a.node.nodeName)}function hb(a){for(var b=[],c=0,d=!1,e;a.length;)-1!==[32,13,10,9,45].indexOf(a[c])===d?(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)),d=!d,c=0):c++,c>=a.length&&(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)));return b}function Pa(a,b,c){if(!b)return Promise.reject("No proxy configured");
var d=xa(ya);a=za(b,a,d);return ya?Aa(a):Ba(c,a,d).then(function(a){return Ca(a.content)})}function ib(a,b,c){var d=xa(Da);a=za(b,a,d);return Da?Promise.resolve(a):Ba(c,a,d).then(function(a){return"data:"+a.type+";base64,"+a.content})}function Ba(a,b,c){return new Promise(function(d,e){var f=a.createElement("script"),g=function(){delete m.html2canvas.proxy[c];a.body.removeChild(f)};m.html2canvas.proxy[c]=function(a){g();d(a)};f.src=b;f.onerror=function(a){g();e(a)};a.body.appendChild(f)})}function xa(a){var val=new Uint32Array(1);(window.crypto||window.msCrypto).getRandomValues(val);return a?
"":"html2canvas_"+Date.now()+"_"+ ++jb+"_"+Math.round(1E5*(val[0]/0xFFFFFFFF))}function za(a,b,c){return a+"?url="+encodeURIComponent(b)+(c.length?"&callback=html2canvas.proxy."+c:"")}function kb(a,b){r.createElement("script");var c=r.createElement("a");c.href=a;this.src=a=c.href;this.image=new Image;var d=this;this.promise=new Promise(function(c,f){d.image.crossOrigin="Anonymous";d.image.onload=c;d.image.onerror=f;(new ib(a,b,r)).then(function(a){d.image.src=a})["catch"](f)})}function v(a,b,c){l.call(this,
a,b);this.isPseudoElement=!0;this.before=":before"===c}function x(a,b,c,d,e){this.width=a;this.height=b;this.images=c;this.options=d;this.document=e}function G(a,b,c,d){l.call(this,c,d);this.ownStacking=a;this.contexts=[];this.children=[];this.opacity=(this.parent?this.parent.stack.opacity:1)*b}function T(a){this.rangeBounds=this.testRangeBounds(a);this.cors=this.testCORS();this.svg=this.testSVG()}function A(a){this.src=a;this.image=null;var b=this;this.promise=this.hasFabric().then(function(){return b.isInline(a)?
Promise.resolve(b.inlineFormatting(a)):Aa(a)}).then(function(a){return new Promise(function(d){html2canvas.fabric.loadSVGFromString(a,b.createCanvas.call(b,d))})})}function Ca(a){var b=a.length,c,d,e,f,g,h,k="";for(c=0;c<b;c+=4)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c]),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+1]),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+2]),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+
3]),d=d<<2|e>>4,e=(e&15)<<4|f>>2,h=(f&3)<<6|g,k=64===f?k+String.fromCharCode(d):64===g||-1===g?k+String.fromCharCode(d,e):k+String.fromCharCode(d,e,h);return k}function Ea(a,b){this.src=a;this.image=null;var c=this;this.promise=b?new Promise(function(b,e){c.image=new Image;c.image.onload=b;c.image.onerror=e;c.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(a);!0===c.image.complete&&b(c.image)}):this.hasFabric().then(function(){return new Promise(function(b){html2canvas.fabric.parseSVGDocument(a,
c.createCanvas.call(c,b))})})}function I(a,b){l.call(this,a,b)}function lb(a,b,c){if(0<a.length)return b+c.toUpperCase()}function Fa(a){N.apply(this,arguments);this.type="linear"===a.args[0]?this.TYPES.LINEAR:this.TYPES.RADIAL}function Aa(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a);d.onload=function(){200===d.status?b(d.responseText):c(Error(d.statusText))};d.onerror=function(){c(Error("Network Error"))};d.send()})}function p(a,b){x.apply(this,arguments);this.canvas=
this.options.canvas||this.document.createElement("canvas");this.options.canvas||(this.canvas.width=a,this.canvas.height=b);this.ctx=this.canvas.getContext("2d");this.taintCtx=this.document.createElement("canvas").getContext("2d");this.ctx.textBaseline="bottom";this.variables={};q("Initialized CanvasRenderer with size",a,"x",b)}function mb(a){return 0<a.length}(function(){function a(a,b){J[K]=a;J[K+1]=b;K+=2;2===K&&Ga()}function b(a){return"function"===typeof a}function c(){return function(){process.nextTick(g)}}
function d(){var a=0,b=new Ha(g),c=r.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function e(){var a=new MessageChannel;a.port1.onmessage=g;return function(){a.port2.postMessage(0)}}function f(){return function(){setTimeout(g,1)}}function g(){for(var a=0;a<K;a+=2)(0,J[a])(J[a+1]),J[a]=void 0,J[a+1]=void 0;K=0}function h(){}function k(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function l(b,c,d){a(function(a){var b=!1,e=k(d,c,function(d){b||(b=!0,c!==d?n(a,
d):p(a,d))},function(c){b||(b=!0,w(a,c))});!b&&e&&(b=!0,w(a,e))},b)}function q(a,b){1===b.a?p(a,b.b):2===a.a?w(a,b.b):u(b,void 0,function(b){n(a,b)},function(b){w(a,b)})}function n(a,c){if(a===c)w(a,new TypeError("You cannot resolve a promise with itself"));else if("function"===typeof c||"object"===typeof c&&null!==c)if(c.constructor===a.constructor)q(a,c);else{var d;try{d=c.then}catch(e){Z.error=e,d=Z}d===Z?w(a,Z.error):void 0===d?p(a,c):b(d)?l(a,c,d):p(a,c)}else p(a,c)}function t(a){a.f&&a.f(a.b);
v(a)}function p(b,c){void 0===b.a&&(b.b=c,b.a=1,0!==b.e.length&&a(v,b))}function w(b,c){void 0===b.a&&(b.a=2,b.b=c,a(t,b))}function u(b,c,d,e){var f=b.e,g=f.length;b.f=null;f[g]=c;f[g+1]=d;f[g+2]=e;0===g&&b.a&&a(v,b)}function v(a){var b=a.e,c=a.a;if(0!==b.length){for(var d,e,f=a.b,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?z(c,d,e,f):e(f);a.e.length=0}}function x(){this.error=null}function z(a,c,d,e){var f=b(d),g,h,k,l;if(f){try{g=d(e)}catch(B){fa.error=B,g=fa}g===fa?(l=!0,h=g.error,g=null):k=!0;if(c===
g){w(c,new TypeError("A promises callback cannot return that same promise."));return}}else g=e,k=!0;void 0===c.a&&(f&&k?n(c,g):l?w(c,h):1===a?p(c,g):2===a&&w(c,g))}function A(a,b){try{b(function(b){n(a,b)},function(b){w(a,b)})}catch(c){w(a,c)}}function y(a,b,c,d){this.n=a;this.c=new a(h,d);this.i=c;this.o(b)?(this.m=b,this.d=this.length=b.length,this.l(),0===this.length?p(this.c,this.b):(this.length=this.length||0,this.k(),0===this.d&&p(this.c,this.b))):w(this.c,this.p())}function B(a){nb++;this.b=
this.a=void 0;this.e=[];if(h!==a){if(!b(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof B))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");A(this,a)}}var Ia=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},K=0,aa="undefined"!==typeof m?m:{},Ha=aa.MutationObserver||aa.WebKitMutationObserver,
aa="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,J=Array(1E3),Ga;Ga="undefined"!==typeof process&&"[object process]"==={}.toString.call(process)?c():Ha?d():aa?e():f();var Z=new x,fa=new x;y.prototype.o=function(a){return Ia(a)};y.prototype.p=function(){return Error("Array Methods must be provided an Array")};y.prototype.l=function(){this.b=Array(this.length)};y.prototype.k=function(){for(var a=this.length,b=this.c,c=this.m,d=0;void 0===
b.a&&d<a;d++)this.j(c[d],d)};y.prototype.j=function(a,b){var c=this.n;"object"===typeof a&&null!==a?a.constructor===c&&void 0!==a.a?(a.f=null,this.g(a.a,b,a.b)):this.q(c.resolve(a),b):(this.d--,this.b[b]=this.h(a))};y.prototype.g=function(a,b,c){var d=this.c;void 0===d.a&&(this.d--,this.i&&2===a?w(d,c):this.b[b]=this.h(c));0===this.d&&p(d,this.b)};y.prototype.h=function(a){return a};y.prototype.q=function(a,b){var c=this;u(a,void 0,function(a){c.g(1,b,a)},function(a){c.g(2,b,a)})};var nb=0;B.all=
function(a,b){return(new y(this,a,!0,b)).c};B.race=function(a,b){function c(a){n(e,a)}function d(a){w(e,a)}var e=new this(h,b);if(!Ia(a))return w(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;void 0===e.a&&g<f;g++)u(this.resolve(a[g]),void 0,c,d);return e};B.resolve=function(a,b){if(a&&"object"===typeof a&&a.constructor===this)return a;var c=new this(h,b);n(c,a);return c};B.reject=function(a,b){var c=new this(h,b);w(c,a);return c};B.prototype={constructor:B,then:function(b,
c){var d=this.a;if(1===d&&!b||2===d&&!c)return this;var e=new this.constructor(h),f=this.b;if(d){var g=arguments[d-1];a(function(){z(d,e,g,f)})}else u(this,e,b,c);return e},"catch":function(a){return this.then(null,a)}};var ga={Promise:B,polyfill:function(){var a;a="undefined"!==typeof S?S:"undefined"!==typeof m&&m.document?m:self;"Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var c;new a.Promise(function(a){c=a});return b(c)}()||(a.Promise=
B)}};"function"===typeof E&&E.amd?E(function(){return ga}):"undefined"!==typeof module&&module.exports?module.exports=ga:"undefined"!==typeof this&&(this.ES6Promise=ga)}).call(m);m&&m.ES6Promise.polyfill();if("undefined"===typeof r||"function"!==typeof Object.create||"function"!==typeof r.createElement("canvas").getContext)(m||module.exports).html2canvas=function(){return Promise.reject("No canvas support")};else{(function(a){function b(a){throw RangeError(v[a]);}function c(a,b){for(var c=a.length,
d=[];c--;)d[c]=b(a[c]);return d}function d(a,b){var d=a.split("@"),e="";1<d.length&&(e=d[0]+"@",a=d[1]);d=a.split(u);d=c(d,b).join(".");return e+d}function e(a){for(var b=[],c=0,d=a.length,e,f;c<d;)e=a.charCodeAt(c++),55296<=e&&56319>=e&&c<d?(f=a.charCodeAt(c++),56320==(f&64512)?b.push(((e&1023)<<10)+(f&1023)+65536):(b.push(e),c--)):b.push(e);return b}function f(a){return c(a,function(a){var b="";65535<a&&(a-=65536,b+=x(a>>>10&1023|55296),a=56320|a&1023);return b+=x(a)}).join("")}function g(a,b){return a+
22+75*(26>a)-((0!=b)<<5)}function h(a,b,c){var d=0;a=c?z(a/700):a>>1;for(a+=z(a/b);455<a;d+=36)a=z(a/35);return z(d+36*a/(a+38))}function k(a){var c=[],d=a.length,e,g=0,k=128,l=72,m,n,q,p,r;m=a.lastIndexOf("-");0>m&&(m=0);for(n=0;n<m;++n)128<=a.charCodeAt(n)&&b("not-basic"),c.push(a.charCodeAt(n));for(m=0<m?m+1:0;m<d;){n=g;e=1;for(q=36;;q+=36){m>=d&&b("invalid-input");p=a.charCodeAt(m++);p=10>p-48?p-22:26>p-65?p-65:26>p-97?p-97:36;(36<=p||p>z((2147483647-g)/e))&&b("overflow");g+=p*e;r=q<=l?1:q>=l+
26?26:q-l;if(p<r)break;p=36-r;e>z(2147483647/p)&&b("overflow");e*=p}e=c.length+1;l=h(g-n,e,0==n);z(g/e)>2147483647-k&&b("overflow");k+=z(g/e);g%=e;c.splice(g++,0,k)}return f(c)}function l(a){var c,d,f,k,p,m,n,q,r,t=[],u,v,w;a=e(a);u=a.length;c=128;d=0;p=72;for(m=0;m<u;++m)r=a[m],128>r&&t.push(x(r));for((f=k=t.length)&&t.push("-");f<u;){n=2147483647;for(m=0;m<u;++m)r=a[m],r>=c&&r<n&&(n=r);v=f+1;n-c>z((2147483647-d)/v)&&b("overflow");d+=(n-c)*v;c=n;for(m=0;m<u;++m)if(r=a[m],r<c&&2147483647<++d&&b("overflow"),
r==c){q=d;for(n=36;;n+=36){r=n<=p?1:n>=p+26?26:n-p;if(q<r)break;w=q-r;q=36-r;t.push(x(g(r+w%q,0)));q=z(w/q)}t.push(x(g(q,0)));p=h(d,v,f==k);d=0;++f}++d;++c}return t.join("")}var m="object"==typeof R&&R&&!R.nodeType&&R,q="object"==typeof module&&module&&!module.nodeType&&module,n="object"==typeof S&&S;if(n.global===n||n.window===n||n.self===n)a=n;var p,r=/^xn--/,t=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)",
"invalid-input":"Invalid input"},z=Math.floor,x=String.fromCharCode,y;p={version:"1.3.1",ucs2:{decode:e,encode:f},decode:k,encode:l,toASCII:function(a){return d(a,function(a){return t.test(a)?"xn--"+l(a):a})},toUnicode:function(a){return d(a,function(a){return r.test(a)?k(a.slice(4).toLowerCase()):a})}};if("function"==typeof E&&"object"==typeof E.amd&&E.amd)E("punycode",function(){return p});else if(m&&q)if(module.exports==m)q.exports=p;else for(y in p)p.hasOwnProperty(y)&&(m[y]=p[y]);else a.punycode=
p})(this);var Ra=0,ob=0;m.html2canvas=function(a,b){var c=ob++;b=b||{};b.logging&&(m.html2canvas.logging=!0,m.html2canvas.start=Date.now());b.async="undefined"===typeof b.async?!0:b.async;b.allowTaint="undefined"===typeof b.allowTaint?!1:b.allowTaint;b.removeContainer="undefined"===typeof b.removeContainer?!0:b.removeContainer;b.javascriptEnabled="undefined"===typeof b.javascriptEnabled?!1:b.javascriptEnabled;b.imageTimeout="undefined"===typeof b.imageTimeout?1E4:b.imageTimeout;b.renderer="function"===
typeof b.renderer?b.renderer:p;b.strict=!!b.strict;if("string"===typeof a){if("string"!==typeof b.proxy)return Promise.reject("Proxy must be used when rendering url");var d=null!=b.width?b.width:m.innerWidth,e=null!=b.height?b.height:m.innerHeight;return oa(Ta(a),b.proxy,r,d,e,b).then(function(a){return ia(a.contentWindow.document.documentElement,a,b,d,e)})}var f=(a===L?[r.documentElement]:a.length?a:[a])[0];f.setAttribute("data-html2canvas-node"+c,c);return Ka(f.ownerDocument,b,f.ownerDocument.defaultView.innerWidth,
f.ownerDocument.defaultView.innerHeight,c).then(function(a){"function"===typeof b.onrendered&&(q("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),b.onrendered(a));return a})};m.html2canvas.punycode=this.punycode;m.html2canvas.proxy={};t.prototype.darken=function(a){a=1-a;return new t([Math.round(this.r*a),Math.round(this.g*a),Math.round(this.b*a),this.a])};t.prototype.isTransparent=function(){return 0===this.a};t.prototype.isBlack=function(){return 0===this.r&&
0===this.g&&0===this.b};t.prototype.fromArray=function(a){Array.isArray(a)&&(this.r=Math.min(a[0],255),this.g=Math.min(a[1],255),this.b=Math.min(a[2],255),3<a.length&&(this.a=a[3]));return Array.isArray(a)};var pb=/^#([a-f0-9]{3})$/i;t.prototype.hex3=function(a){null!==(a=a.match(pb))&&(this.r=parseInt(a[1][0]+a[1][0],16),this.g=parseInt(a[1][1]+a[1][1],16),this.b=parseInt(a[1][2]+a[1][2],16));return null!==a};var qb=/^#([a-f0-9]{6})$/i;t.prototype.hex6=function(a){null!==(a=a.match(qb))&&(this.r=
parseInt(a[1].substring(0,2),16),this.g=parseInt(a[1].substring(2,4),16),this.b=parseInt(a[1].substring(4,6),16));return null!==a};var rb=/^rgb\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3})\)$/;t.prototype.rgb=function(a){null!==(a=a.match(rb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]));return null!==a};var sb=/^rgba\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3}) *, *(\d+\.?\d*)\)$/;t.prototype.rgba=function(a){null!==(a=a.match(sb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]),
this.a=Number(a[4]));return null!==a};t.prototype.toString=function(){return null!==this.a&&1!==this.a?"rgba("+[this.r,this.g,this.b,this.a].join()+")":"rgb("+[this.r,this.g,this.b].join()+")"};t.prototype.namedColor=function(a){var b=tb[a.toLowerCase()];if(b)this.r=b[0],this.g=b[1],this.b=b[2];else if("transparent"===a.toLowerCase())return this.r=this.g=this.b=this.a=0,!0;return!!b};t.prototype.isColor=!0;var tb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,
255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],
darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],
fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,
250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,
179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,
239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,
255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};pa.prototype.getMetrics=function(a,b){this.data[a+"-"+b]===L&&(this.data[a+"-"+b]=new Ua(a,b));return this.data[a+"-"+b]};qa.prototype.proxyLoad=function(a,b,c){var d=this.src;return oa(d.src,a,d.ownerDocument,b.width,b.height,c)};N.prototype.TYPES=
{LINEAR:1,RADIAL:2};u.prototype.findImages=function(a){var b=[];a.reduce(function(a,b){switch(b.node.nodeName){case "IMG":return a.concat([{args:[b.node.src],method:"url"}]);case "svg":case "IFRAME":return a.concat([{args:[b.node],method:b.node.nodeName}])}return a},[]).forEach(this.addImage(b,this.loadImage),this);return b};u.prototype.findBackgroundImage=function(a,b){b.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(a,this.loadImage),this);return a};u.prototype.addImage=
function(a,b){return function(c){c.args.forEach(function(d){this.imageExists(a,d)||(a.splice(0,0,b.call(this,c)),q("Added image #"+a.length,"string"===typeof d?d.substring(0,100):d))},this)}};u.prototype.hasImageBackground=function(a){return"none"!==a.method};u.prototype.loadImage=function(a){return"url"===a.method?(a=a.args[0],!this.isSVG(a)||this.support.svg||this.options.allowTaint?a.match(/data:image\/.*;base64,/i)?new ba(a.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,""),!1):this.isSameOrigin(a)||!0===
this.options.allowTaint||this.isSVG(a)?new ba(a,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new ba(a,!0):this.options.proxy?new kb(a,this.options.proxy):new M(a):new A(a)):"linear-gradient"===a.method?new V(a):"gradient"===a.method?new Fa(a):"svg"===a.method?new Ea(a.args[0],this.support.svg):"IFRAME"===a.method?new qa(a.args[0],this.isSameOrigin(a.args[0].src),this.options):new M(a)};u.prototype.isSVG=function(a){return"svg"===a.substring(a.length-3).toLowerCase()||A.prototype.isInline(a)};
u.prototype.imageExists=function(a,b){return a.some(function(a){return a.src===b})};u.prototype.isSameOrigin=function(a){return this.getOrigin(a)===this.origin};u.prototype.getOrigin=function(a){var b=this.link||(this.link=r.createElement("a"));b.href=a;b.href=b.href;return b.protocol+b.hostname+b.port};u.prototype.getPromise=function(a){return this.timeout(a,this.options.imageTimeout)["catch"](function(){return(new M(a.src)).promise.then(function(b){a.image=b})})};u.prototype.get=function(a){var b=
null;return this.images.some(function(c){return(b=c).src===a})?b:null};u.prototype.fetch=function(a){this.images=a.reduce(X(this.findBackgroundImage,this),this.findImages(a));this.images.forEach(function(a,c){a.promise.then(function(){q("Succesfully loaded image #"+(c+1),a)},function(d){q("Failed loading image #"+(c+1),a,d)})});this.ready=Promise.all(this.images.map(this.getPromise,this));q("Finished searching images");return this};u.prototype.timeout=function(a,b){var c,d=Promise.race([a.promise,
new Promise(function(d,f){c=setTimeout(function(){q("Timed out loading image",a);f(a)},b)})]).then(function(a){clearTimeout(c);return a});d["catch"](function(){clearTimeout(c)});return d};V.prototype=Object.create(N.prototype);V.prototype.stepRegExp=/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/;l.prototype.cloneTo=function(a){a.visible=this.visible;a.borders=this.borders;a.bounds=this.bounds;a.clip=this.clip;a.backgroundClip=this.backgroundClip;a.computedStyles=
this.computedStyles;a.styles=this.styles;a.backgroundImages=this.backgroundImages;a.opacity=this.opacity};l.prototype.getOpacity=function(){return null===this.opacity?this.opacity=this.cssFloat("opacity"):this.opacity};l.prototype.assignStack=function(a){this.stack=a;a.children.push(this)};l.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:"none"!==this.css("display")&&"hidden"!==this.css("visibility")&&!this.node.hasAttribute("data-html2canvas-ignore")&&
("INPUT"!==this.node.nodeName||"hidden"!==this.node.getAttribute("type"))};l.prototype.css=function(a){this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null));return this.styles[a]||(this.styles[a]=this.computedStyles[a])};l.prototype.prefixedCss=function(a){var b=["webkit","moz","ms","o"],c=this.css(a);c===L&&b.some(function(b){c=this.css(b+a.substr(0,1).toUpperCase()+a.substr(1));return c!==L},this);return c===
L?null:c};l.prototype.computedStyle=function(a){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,a)};l.prototype.cssInt=function(a){a=parseInt(this.css(a),10);return isNaN(a)?0:a};l.prototype.color=function(a){return this.colors[a]||(this.colors[a]=new t(this.css(a)))};l.prototype.cssFloat=function(a){a=parseFloat(this.css(a));return isNaN(a)?0:a};l.prototype.fontWeight=function(){var a=this.css("fontWeight");switch(parseInt(a,10)){case 401:a="bold";break;case 400:a="normal"}return a};
l.prototype.parseClip=function(){var a=this.css("clip").match(this.CLIP);return a?{top:parseInt(a[1],10),right:parseInt(a[2],10),bottom:parseInt(a[3],10),left:parseInt(a[4],10)}:null};l.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=ra(this.css("backgroundImage")))};l.prototype.cssList=function(a,b){var c=(this.css(a)||"").split(","),c=c[b||0]||c[0]||"auto",c=c.trim().split(" ");1===c.length&&(c=[c[0],c[0]]);return c};l.prototype.parseBackgroundSize=
function(a,b,c){c=this.cssList("backgroundSize",c);var d;if(W(c[0]))d=a.width*parseFloat(c[0])/100;else{if(/contain|cover/.test(c[0]))return b=b.width/b.height,a.width/a.height<b^"contain"===c[0]?{width:a.height*b,height:a.height}:{width:a.width,height:a.width/b};d=parseInt(c[0],10)}a="auto"===c[0]&&"auto"===c[1]?b.height:"auto"===c[1]?d/b.width*b.height:W(c[1])?a.height*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(d=a/b.height*b.width);return{width:d,height:a}};l.prototype.parseBackgroundPosition=
function(a,b,c,d){c=this.cssList("backgroundPosition",c);var e;e=W(c[0])?(a.width-(d||b).width)*(parseFloat(c[0])/100):parseInt(c[0],10);a="auto"===c[1]?e/b.width*b.height:W(c[1])?(a.height-(d||b).height)*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(e=a/b.height*b.width);return{left:e,top:a}};l.prototype.parseBackgroundRepeat=function(a){return this.cssList("backgroundRepeat",a)[0]};l.prototype.parseTextShadows=function(){var a=this.css("textShadow"),b=[];if(a&&"none"!==a)for(var a=a.match(this.TEXT_SHADOW_PROPERTY),
c=0;a&&c<a.length;c++){var d=a[c].match(this.TEXT_SHADOW_VALUES);b.push({color:new t(d[0]),offsetX:d[1]?parseFloat(d[1].replace("px","")):0,offsetY:d[2]?parseFloat(d[2].replace("px","")):0,blur:d[3]?d[3].replace("px",""):0})}return b};l.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var a=this.parseBounds(),b=this.prefixedCss("transformOrigin").split(" ").map(Wa).map(Xa);b[0]+=a.left;b[1]+=a.top;this.transformData={origin:b,matrix:this.parseTransformMatrix()}}else this.transformData=
{origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData};l.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var a=this.prefixedCss("transform");this.transformMatrix=(a=a?Va(a.match(this.MATRIX_PROPERTY)):null)?a:[1,0,0,1,0,0]}return this.transformMatrix};l.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?ca(this.node):U(this.node))};l.prototype.hasTransform=function(){return"1,0,0,1,0,0"!==this.parseTransformMatrix().join(",")||this.parent&&
this.parent.hasTransform()};l.prototype.getValue=function(){var a=this.node.value||"";"SELECT"===this.node.tagName?(a=this.node,a=(a=a.options[a.selectedIndex||0])?a.text||"":""):"password"===this.node.type&&(a=Array(a.length+1).join("\u2022"));return 0===a.length?this.node.placeholder||"":a};l.prototype.MATRIX_PROPERTY=/(matrix)\((.+)\)/;l.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;l.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;l.prototype.CLIP=
/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/;n.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(a){if(O(a)){!0===a.isPseudoElement&&a.appendToDOM();a.borders=this.parseBorders(a);var b="hidden"===a.css("overflow")?[a.borders.clip]:[],c=a.parseClip();c&&-1!==["absolute","fixed"].indexOf(a.css("position"))&&b.push([["rect",a.bounds.left+c.left,a.bounds.top+c.top,c.right-c.left,c.bottom-c.top]]);a.clip=a.parent&&a.parent.clip.length?a.parent.clip.concat(b):b;a.backgroundClip=
"hidden"!==a.css("overflow")?a.clip.concat([a.borders.clip]):a.clip;!0===a.isPseudoElement&&a.cleanDOM()}else ea(a)&&(a.clip=a.parent&&a.parent.clip.length?a.parent.clip:[]);!0!==a.isPseudoElement&&(a.bounds=null)},this)};n.prototype.asyncRenderer=function(a,b,c){c=c||Date.now();this.paint(a[this.renderIndex++]);a.length===this.renderIndex?b():c+20>Date.now()?this.asyncRenderer(a,b,c):setTimeout(X(function(){this.asyncRenderer(a,b)},this),0)};n.prototype.createPseudoHideStyles=function(a){this.createStyles(a,
"."+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }.'+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')};n.prototype.disableAnimations=function(a){this.createStyles(a,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")};
n.prototype.createStyles=function(a,b){var c=a.createElement("style");c.innerHTML=b;a.body.appendChild(c)};n.prototype.getPseudoElements=function(a){var b=[[a]];if(a.node.nodeType===Node.ELEMENT_NODE){var c=this.getPseudoElement(a,":before");a=this.getPseudoElement(a,":after");c&&b.push(c);a&&b.push(a)}return[].concat.apply([],b)};n.prototype.getPseudoElement=function(a,b){var c=a.computedStyle(b);if(!c||!c.content||"none"===c.content||"-moz-alt-content"===c.content||"none"===c.display)return null;
var d,e=c.content,f=e.substr(0,1);d=f===e.substr(e.length-1)&&f.match(/'|"/)?e.substr(1,e.length-2):e;for(var g="url"===d.substr(0,3),e=r.createElement(g?"img":"html2canvaspseudoelement"),f=new v(e,a,b),h=c.length-1;0<=h;h--){var k=Ya(c.item(h));e.style[k]=c[k]}e.className=v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;if(g)return e.src=ra(d)[0].args[0],[f];c=r.createTextNode(d);e.appendChild(c);return[f,new I(c,f)]};n.prototype.getChildren=function(a){return[].concat.apply([],
[].filter.call(a.node.childNodes,db).map(function(b){var c=[b.nodeType===Node.TEXT_NODE?new I(b,a):new l(b,a)].filter(gb);return b.nodeType===Node.ELEMENT_NODE&&c.length&&"TEXTAREA"!==b.tagName?c[0].isElementVisible()?c.concat(this.getChildren(c[0])):[]:c},this))};n.prototype.newStackingContext=function(a,b){var c=new G(b,a.getOpacity(),a.node,a.parent);a.cloneTo(c);(b?c.getParentStack(this):c.parent.stack).contexts.push(c);a.stack=c};n.prototype.createStackingContexts=function(){this.nodes.forEach(function(a){var b;
if(b=O(a))(b=this.isRootElement(a)||1>a.getOpacity())||(b=a.css("position"),b="auto"!==(-1!==["absolute","relative","fixed"].indexOf(b)?a.css("zIndex"):"auto")),b=b||this.isBodyWithTransparentRoot(a)||a.hasTransform();b?this.newStackingContext(a,!0):O(a)&&(P(a)&&va(a)||-1!==["inline-block","inline-table"].indexOf(a.css("display"))||da(a))?this.newStackingContext(a,!1):a.assignStack(a.parent.stack)},this)};n.prototype.isBodyWithTransparentRoot=function(a){return"BODY"===a.node.nodeName&&a.parent.color("backgroundColor").isTransparent()};
n.prototype.isRootElement=function(a){return null===a.parent};n.prototype.sortStackingContexts=function(a){a.contexts.sort(eb(a.contexts.slice(0)));a.contexts.forEach(this.sortStackingContexts,this)};n.prototype.parseTextBounds=function(a){return function(b,c,d){if("none"!==a.parent.css("textDecoration").substr(0,4)||0!==b.trim().length){if(this.support.rangeBounds&&!a.parent.hasTransform())return c=d.slice(0,c).join("").length,this.getRangeBounds(a.node,c,b.length);if(a.node&&"string"===typeof a.node.data)return b=
a.node.splitText(b.length),c=this.getWrapperBounds(a.node,a.parent.hasTransform()),a.node=b,c}else if(!this.support.rangeBounds||a.parent.hasTransform())a.node=a.node.splitText(b.length);return{}}};n.prototype.getWrapperBounds=function(a,b){var c=a.ownerDocument.createElement("html2canvaswrapper"),d=a.parentNode,e=a.cloneNode(!0);c.appendChild(a.cloneNode(!0));d.replaceChild(c,a);var f=b?ca(c):U(c);d.replaceChild(e,c);return f};n.prototype.getRangeBounds=function(a,b,c){var d=this.range||(this.range=
a.ownerDocument.createRange());d.setStart(a,b);d.setEnd(a,b+c);return d.getBoundingClientRect()};n.prototype.parse=function(a){var b=a.contexts.filter(Za),c=a.children.filter(O),d=c.filter(Q(da)),e=d.filter(Q(P)).filter(Q(wa)),c=c.filter(Q(P)).filter(da),f=d.filter(Q(P)).filter(wa),d=a.contexts.concat(d.filter(P)).filter(va),g=a.children.filter(ea).filter(ab);a=a.contexts.filter($a);b.concat(e).concat(c).concat(f).concat(d).concat(g).concat(a).forEach(function(a){this.renderQueue.push(a);a instanceof
G&&(this.parse(a),this.renderQueue.push(new sa))},this)};n.prototype.paint=function(a){try{a instanceof sa?this.renderer.ctx.restore():ea(a)?(!0===a.parent.isPseudoElement&&a.parent.appendToDOM(),this.paintText(a),!0===a.parent.isPseudoElement&&a.parent.cleanDOM()):this.paintNode(a)}catch(b){if(q(b),this.options.strict)throw b;}};n.prototype.paintNode=function(a){a instanceof G&&(this.renderer.setOpacity(a.opacity),this.renderer.ctx.save(),a.hasTransform()&&this.renderer.setTransform(a.parseTransform()));
"INPUT"===a.node.nodeName&&"checkbox"===a.node.type?this.paintCheckbox(a):"INPUT"===a.node.nodeName&&"radio"===a.node.type?this.paintRadio(a):this.paintElement(a)};n.prototype.paintElement=function(a){var b=a.parseBounds();this.renderer.clip(a.backgroundClip,function(){this.renderer.renderBackground(a,b,a.borders.borders.map(fb))},this);this.renderer.clip(a.clip,function(){this.renderer.renderBorders(a.borders.borders)},this);this.renderer.clip(a.backgroundClip,function(){switch(a.node.nodeName){case "svg":case "IFRAME":var c=
this.images.get(a.node);c?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <"+a.node.nodeName+">",a.node);break;case "IMG":(c=this.images.get(a.node.src))?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <img>",a.node.src);break;case "CANVAS":this.renderer.renderImage(a,b,a.borders,{image:a.node});break;case "SELECT":case "INPUT":case "TEXTAREA":this.paintFormValue(a)}},this)};n.prototype.paintCheckbox=function(a){var b=a.parseBounds(),c=Math.min(b.width,b.height),d={width:c-
1,height:c-1,top:b.top,left:b.left},b=[3,3],e=[b,b,b,b],f=[1,1,1,1].map(function(a){return{color:new t("#A5A5A5"),width:a}}),g=ua(d,e,f);this.renderer.clip(a.backgroundClip,function(){this.renderer.rectangle(d.left+1,d.top+1,d.width-2,d.height-2,new t("#DEDEDE"));this.renderer.renderBorders(ta(f,d,g,e));a.node.checked&&(this.renderer.font(new t("#424242"),"normal","normal","bold",c-3+"px","arial"),this.renderer.text("\u2714",d.left+c/6,d.top+c-1))},this)};n.prototype.paintRadio=function(a){var b=
a.parseBounds(),c=Math.min(b.width,b.height)-2;this.renderer.clip(a.backgroundClip,function(){this.renderer.circleStroke(b.left+1,b.top+1,c,new t("#DEDEDE"),1,new t("#A5A5A5"));a.node.checked&&this.renderer.circle(Math.ceil(b.left+c/4)+1,Math.ceil(b.top+c/4)+1,Math.floor(c/2),new t("#424242"))},this)};n.prototype.paintFormValue=function(a){var b=a.getValue();if(0<b.length){var c=a.node.ownerDocument,d=c.createElement("html2canvaswrapper");"lineHeight textAlign fontFamily fontWeight fontSize color paddingLeft paddingTop paddingRight paddingBottom width height borderLeftStyle borderTopStyle borderLeftWidth borderTopWidth boxSizing whiteSpace wordWrap".split(" ").forEach(function(b){try{d.style[b]=
a.css(b)}catch(c){q("html2canvas: Parse: Exception caught in renderFormValue: "+c.message)}});var e=a.parseBounds();d.style.position="fixed";d.style.left=e.left+"px";d.style.top=e.top+"px";d.textContent=b;c.body.appendChild(d);this.paintText(new I(d.firstChild,a));c.body.removeChild(d)}};n.prototype.paintText=function(a){a.applyTextTransform();var b=m.html2canvas.punycode.ucs2.decode(a.node.data),c=this.options.letterRendering&&!/^(normal|none|0px)$/.test(a.parent.css("letterSpacing"))||/[^\u0000-\u00ff]/.test(a.node.data)?
b.map(function(a){return m.html2canvas.punycode.ucs2.encode([a])}):hb(b),b=a.parent.fontWeight(),d=a.parent.css("fontSize"),e=a.parent.css("fontFamily"),f=a.parent.parseTextShadows();this.renderer.font(a.parent.color("color"),a.parent.css("fontStyle"),a.parent.css("fontVariant"),b,d,e);f.length?this.renderer.fontShadow(f[0].color,f[0].offsetX,f[0].offsetY,f[0].blur):this.renderer.clearShadow();this.renderer.clip(a.parent.clip,function(){c.map(this.parseTextBounds(a),this).forEach(function(b,f){b&&
(this.renderer.text(c[f],b.left,b.bottom),this.renderTextDecoration(a.parent,b,this.fontMetrics.getMetrics(e,d)))},this)},this)};n.prototype.renderTextDecoration=function(a,b,c){switch(a.css("textDecoration").split(" ")[0]){case "underline":this.renderer.rectangle(b.left,Math.round(b.top+c.baseline+c.lineWidth),b.width,1,a.color("color"));break;case "overline":this.renderer.rectangle(b.left,Math.round(b.top),b.width,1,a.color("color"));break;case "line-through":this.renderer.rectangle(b.left,Math.ceil(b.top+
c.middle+c.lineWidth),b.width,1,a.color("color"))}};var Ja={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};n.prototype.parseBorders=function(a){var b=a.parseBounds(),c=bb(a),d=["Top","Right","Bottom","Left"].map(function(b,c){var d=a.css("border"+b+"Style"),e=a.color("border"+b+"Color");"inset"===d&&e.isBlack()&&(e=new t([255,255,255,e.a]));d=Ja[d]?Ja[d][c]:null;return{width:a.cssInt("border"+b+"Width"),color:d?e[d[0]](d[1]):e,args:null}}),e=ua(b,c,d);return{clip:this.parseBackgroundClip(a,
e,d,c,b),borders:ta(d,b,e,c)}};n.prototype.parseBackgroundClip=function(a,b,c,d,e){var f=[];switch(a.css("backgroundClip")){case "content-box":case "padding-box":D(f,d[0],d[1],b.topLeftInner,b.topRightInner,e.left+c[3].width,e.top+c[0].width);D(f,d[1],d[2],b.topRightInner,b.bottomRightInner,e.left+e.width-c[1].width,e.top+c[0].width);D(f,d[2],d[3],b.bottomRightInner,b.bottomLeftInner,e.left+e.width-c[1].width,e.top+e.height-c[2].width);D(f,d[3],d[0],b.bottomLeftInner,b.topLeftInner,e.left+c[3].width,
e.top+e.height-c[2].width);break;default:D(f,d[0],d[1],b.topLeftOuter,b.topRightOuter,e.left,e.top),D(f,d[1],d[2],b.topRightOuter,b.bottomRightOuter,e.left+e.width,e.top),D(f,d[2],d[3],b.bottomRightOuter,b.bottomLeftOuter,e.left+e.width,e.top+e.height),D(f,d[3],d[0],b.bottomLeftOuter,b.topLeftOuter,e.left,e.top+e.height)}return f};var jb=0,ya="withCredentials"in new XMLHttpRequest,Da="crossOrigin"in new Image;v.prototype.cloneTo=function(a){v.prototype.cloneTo.call(this,a);a.isPseudoElement=!0;a.before=
this.before};v.prototype=Object.create(l.prototype);v.prototype.appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node);this.parent.node.className+=" "+this.getHideClass()};v.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node);this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")};v.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+
(this.before?"BEFORE":"AFTER")]};v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before";v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after";x.prototype.renderImage=function(a,b,c,d){var e=a.cssInt("paddingLeft"),f=a.cssInt("paddingTop"),g=a.cssInt("paddingRight");a=a.cssInt("paddingBottom");c=c.borders;g=b.width-(c[1].width+c[3].width+e+g);a=b.height-(c[0].width+c[2].width+f+a);this.drawImage(d,0,0,d.image.width||g,d.image.height||a,b.left+
e+c[3].width,b.top+f+c[0].width,g,a)};x.prototype.renderBackground=function(a,b,c){0<b.height&&0<b.width&&(this.renderBackgroundColor(a,b),this.renderBackgroundImage(a,b,c))};x.prototype.renderBackgroundColor=function(a,b){var c=a.color("backgroundColor");c.isTransparent()||this.rectangle(b.left,b.top,b.width,b.height,c)};x.prototype.renderBorders=function(a){a.forEach(this.renderBorder,this)};x.prototype.renderBorder=function(a){a.color.isTransparent()||null===a.args||this.drawShape(a.args,a.color)};
x.prototype.renderBackgroundImage=function(a,b,c){a.parseBackgroundImages().reverse().forEach(function(d,e,f){switch(d.method){case "url":var g=this.images.get(d.args[0]);g?this.renderBackgroundRepeating(a,b,g,f.length-(e+1),c):q("Error loading background-image",d.args[0]);break;case "linear-gradient":case "gradient":(e=this.images.get(d.value))?this.renderBackgroundGradient(e,b,c):q("Error loading background-image",d.args[0]);break;case "none":break;default:q("Unknown background-image type",d.args[0])}},
this)};x.prototype.renderBackgroundRepeating=function(a,b,c,d,e){var f=a.parseBackgroundSize(b,c.image,d),g=a.parseBackgroundPosition(b,c.image,d,f);switch(a.parseBackgroundRepeat(d)){case "repeat-x":case "repeat no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+e[3],b.top+g.top+e[0],99999,f.height,e);break;case "repeat-y":case "no-repeat repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+e[3],b.top+e[0],f.width,99999,e);break;case "no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+
e[3],b.top+g.top+e[0],f.width,f.height,e);break;default:this.renderBackgroundRepeat(c,g,f,{top:b.top,left:b.left},e[3],e[0])}};G.prototype=Object.create(l.prototype);G.prototype.getParentStack=function(a){var b=this.parent?this.parent.stack:null;return b?b.ownStacking?b:b.getParentStack(a):a.stack};T.prototype.testRangeBounds=function(a){var b,c,d=!1;a.createRange&&(b=a.createRange(),b.getBoundingClientRect&&(c=a.createElement("boundtest"),c.style.height="123px",c.style.display="block",a.body.appendChild(c),
b.selectNode(c),b=b.getBoundingClientRect(),b=b.height,123===b&&(d=!0),a.body.removeChild(c)));return d};T.prototype.testCORS=function(){return"undefined"!==typeof(new Image).crossOrigin};T.prototype.testSVG=function(){var a=new Image,b=r.createElement("canvas"),c=b.getContext("2d");a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{c.drawImage(a,0,0),b.toDataURL()}catch(d){return!1}return!0};A.prototype.hasFabric=function(){return html2canvas.fabric?Promise.resolve():Promise.reject(Error("html2canvas.svg.js is not loaded, cannot render svg"))};
A.prototype.inlineFormatting=function(a){return/^data:image\/svg\+xml;base64,/.test(a)?this.decode64(this.removeContentType(a)):this.removeContentType(a)};A.prototype.removeContentType=function(a){return a.replace(/^data:image\/svg\+xml(;base64)?,/,"")};A.prototype.isInline=function(a){return/^data:image\/svg\+xml/i.test(a)};A.prototype.createCanvas=function(a){var b=this;return function(c,d){var e=new html2canvas.fabric.StaticCanvas("c");b.image=e.lowerCanvasEl;e.setWidth(d.width).setHeight(d.height).add(html2canvas.fabric.util.groupSVGElements(c,
d)).renderAll();a(e.lowerCanvasEl)}};A.prototype.decode64=function(a){return"function"===typeof m.atob?m.atob(a):Ca(a)};Ea.prototype=Object.create(A.prototype);I.prototype=Object.create(l.prototype);I.prototype.applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))};I.prototype.transform=function(a){var b=this.node.data;switch(a){case "lowercase":return b.toLowerCase();case "capitalize":return b.replace(/(^|\s|:|-|\(|\))([a-z])/g,lb);case "uppercase":return b.toUpperCase();
default:return b}};Fa.prototype=Object.create(N.prototype);p.prototype=Object.create(x.prototype);p.prototype.setFillStyle=function(a){this.ctx.fillStyle="object"===typeof a&&a.isColor?a.toString():a;return this.ctx};p.prototype.rectangle=function(a,b,c,d,e){this.setFillStyle(e).fillRect(a,b,c,d)};p.prototype.circle=function(a,b,c,d){this.setFillStyle(d);this.ctx.beginPath();this.ctx.arc(a+c/2,b+c/2,c/2,0,2*Math.PI,!0);this.ctx.closePath();this.ctx.fill()};p.prototype.circleStroke=function(a,b,c,
d,e,f){this.circle(a,b,c,d);this.ctx.strokeStyle=f.toString();this.ctx.stroke()};p.prototype.drawShape=function(a,b){this.shape(a);this.setFillStyle(b).fill()};p.prototype.taints=function(a){if(null===a.tainted){this.taintCtx.drawImage(a.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),a.tainted=!1}catch(b){this.taintCtx=r.createElement("canvas").getContext("2d"),a.tainted=!0}}return a.tainted};p.prototype.drawImage=function(a,b,c,d,e,f,g,h,k){this.taints(a)&&!this.options.allowTaint||this.ctx.drawImage(a.image,
b,c,d,e,f,g,h,k)};p.prototype.clip=function(a,b,c){this.ctx.save();a.filter(mb).forEach(function(a){this.shape(a).clip()},this);b.call(c);this.ctx.restore()};p.prototype.shape=function(a){this.ctx.beginPath();a.forEach(function(a,c){"rect"===a[0]?this.ctx.rect.apply(this.ctx,a.slice(1)):this.ctx[0===c?"moveTo":a[0]+"To"].apply(this.ctx,a.slice(1))},this);this.ctx.closePath();return this.ctx};p.prototype.font=function(a,b,c,d,e,f){this.setFillStyle(a).font=[b,c,d,e,f].join(" ").split(",")[0]};p.prototype.fontShadow=
function(a,b,c,d){this.setVariable("shadowColor",a.toString()).setVariable("shadowOffsetY",b).setVariable("shadowOffsetX",c).setVariable("shadowBlur",d)};p.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")};p.prototype.setOpacity=function(a){this.ctx.globalAlpha=a};p.prototype.setTransform=function(a){this.ctx.translate(a.origin[0],a.origin[1]);this.ctx.transform.apply(this.ctx,a.matrix);this.ctx.translate(-a.origin[0],-a.origin[1])};p.prototype.setVariable=function(a,
b){this.variables[a]!==b&&(this.variables[a]=this.ctx[a]=b);return this};p.prototype.text=function(a,b,c){this.ctx.fillText(a,b,c)};p.prototype.backgroundRepeatShape=function(a,b,c,d,e,f,g,h,k){this.clip([[["line",Math.round(e),Math.round(f)],["line",Math.round(e+g),Math.round(f)],["line",Math.round(e+g),Math.round(h+f)],["line",Math.round(e),Math.round(h+f)]]],function(){this.renderBackgroundRepeat(a,b,c,d,k[3],k[0])},this)};p.prototype.renderBackgroundRepeat=function(a,b,c,d,e,f){e=Math.round(d.left+
b.left+e);b=Math.round(d.top+b.top+f);this.setFillStyle(this.ctx.createPattern(this.resizeImage(a,c),"repeat"));this.ctx.translate(e,b);this.ctx.fill();this.ctx.translate(-e,-b)};p.prototype.renderBackgroundGradient=function(a,b){if(a instanceof V){var c=this.ctx.createLinearGradient(b.left+b.width*a.x0,b.top+b.height*a.y0,b.left+b.width*a.x1,b.top+b.height*a.y1);a.colorStops.forEach(function(a){c.addColorStop(a.stop,a.color.toString())});this.rectangle(b.left,b.top,b.width,b.height,c)}};p.prototype.resizeImage=
function(a,b){var c=a.image;if(c.width===b.width&&c.height===b.height)return c;var d=r.createElement("canvas");d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(c,0,0,c.width,c.height,0,0,b.width,b.height);return d}}}).call({},"undefined"!==typeof window?window:void 0,"undefined"!==typeof document?document:void 0);

/*
 Use it if you like it
*/
(function(A){function E(K){this.ok=!1;"#"==K.charAt(0)&&(K=K.substr(1,6));K=K.replace(/ /g,"");K=K.toLowerCase();var A={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",
darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",
gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",
lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",
oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",
slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},O;for(O in A)K==O&&(K=A[O]);var L=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,
example:["#00ff00","336699"],process:function(u){return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(u){return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)]}}];for(O=0;O<L.length;O++){var W=L[O].process,M=L[O].re.exec(K);M&&(channels=W(M),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=0>this.r||isNaN(this.r)?0:255<this.r?255:this.r;this.g=0>this.g||isNaN(this.g)?0:
255<this.g?255:this.g;this.b=0>this.b||isNaN(this.b)?0:255<this.b?255:this.b;this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var u=this.r.toString(16),B=this.g.toString(16),p=this.b.toString(16);1==u.length&&(u="0"+u);1==B.length&&(B="0"+B);1==p.length&&(p="0"+p);return"#"+u+B+p};this.getHelpXML=function(){for(var u=[],B=0;B<L.length;B++)for(var p=L[B].example,C=0;C<p.length;C++)u[u.length]=p[C];for(var w in A)u[u.length]=w;p=document.createElement("ul");
p.setAttribute("id","rgbcolor-examples");for(B=0;B<u.length;B++)try{var h=document.createElement("li"),a=new E(u[B]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+a.toHex()+"; color:"+a.toHex();l.appendChild(document.createTextNode("test"));var c=document.createTextNode(" "+u[B]+" -> "+a.toRGB()+" -> "+a.toHex());h.appendChild(l);h.appendChild(c);p.appendChild(h)}catch(b){}return p}}"undefined"!==typeof define&&define.amd?define(function(){return E}):
"undefined"!==typeof module&&module.exports&&(module.exports=E);A.RGBColor=E})("undefined"!==typeof window?window:this);
(function(A){function E(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(A){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(K){throw alert("Cannot access local image"),Error("unable to access local image data: "+K);}}}catch(A){throw alert("Cannot access image"),Error("unable to access image data: "+A);}for(var a=h.data,l=h.width*h.height*4,c=0;c<l;c+=4){var b=
a[c+3]/255;a[c]*=b;a[c+1]*=b;a[c+2]*=b}var a=h.data,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N,P,S,y,I,J,t,E;e=w+w+1;var R=p-1,l=C-1,c=w+1,b=c*(c+1)/2,Q=new X,x=Q;for(k=1;k<e;k++)if(x=x.next=new X,k==c)var T=x;x.next=Q;n=g=0;var U=O[w],V=L[w];for(d=0;d<C;d++){D=N=P=S=m=v=z=H=0;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;for(k=1;k<c;k++)f=g+((R<k?R:k)<<2),m+=(x.r=y=a[f])*(E=c-k),v+=(x.g=I=a[f+1])*E,z+=(x.b=J=a[f+2])*
E,H+=(x.a=t=a[f+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next;k=Q;x=T;for(e=0;e<p;e++)a[g]=m*U>>V,a[g+1]=v*U>>V,a[g+2]=z*U>>V,a[g+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=n+((f=e+w+1)<R?f:R)<<2,D+=k.r=a[f],N+=k.g=a[f+1],P+=k.b=a[f+2],S+=k.a=a[f+3],m+=D,v+=N,z+=P,H+=S,k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=4;n+=p}for(e=0;e<p;e++){N=P=S=D=v=z=H=m=0;g=e<<2;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<
c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;f=p;for(k=1;k<=w;k++)g=f+e<<2,m+=(x.r=y=a[g])*(E=c-k),v+=(x.g=I=a[g+1])*E,z+=(x.b=J=a[g+2])*E,H+=(x.a=t=a[g+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next,k<l&&(f+=p);g=e;k=Q;x=T;for(d=0;d<C;d++)f=g<<2,a[f]=m*U>>V,a[f+1]=v*U>>V,a[f+2]=z*U>>V,a[f+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=e+((f=d+c)<l?f:l)*p<<2,m+=D+=k.r=a[f],v+=N+=k.g=a[f+1],z+=P+=k.b=a[f+2],H+=S+=k.a=a[f+3],k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=p}p=
h.data;C=h.width*h.height*4;for(w=0;w<C;w+=4)T=p[w+3],0!=T&&(T=255/T,p[w]*=T,p[w+1]*=T,p[w+2]*=T);M.putImageData(h,u,B)}}function K(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(x){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(E){throw alert("Cannot access local image"),Error("unable to access local image data: "+E);}}}catch(x){throw alert("Cannot access image"),
Error("unable to access image data: "+x);}var a=h.data,l,c,b,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N;l=w+w+1;var P=p-1,A=C-1,y=w+1,I=y*(y+1)/2,J=new X,t=J;for(b=1;b<l;b++)if(t=t.next=new X,b==y)var K=t;t.next=J;k=d=0;var R=O[w],Q=L[w];for(c=0;c<C;c++){H=q=F=f=g=n=0;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;for(b=1;b<y;b++)e=d+((P<b?P:b)<<2),f+=(t.r=r=a[e])*(N=y-b),g+=(t.g=G=a[e+1])*N,n+=(t.b=D=a[e+2])*N,H+=r,q+=G,F+=D,t=t.next;b=J;t=K;for(l=
0;l<p;l++)a[d]=f*R>>Q,a[d+1]=g*R>>Q,a[d+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=k+((e=l+w+1)<P?e:P)<<2,H+=b.r=a[e],q+=b.g=a[e+1],F+=b.b=a[e+2],f+=H,g+=q,n+=F,b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=4;k+=p}for(l=0;l<p;l++){q=F=H=g=n=f=0;d=l<<2;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;e=p;for(b=1;b<=w;b++)d=e+l<<2,f+=(t.r=r=a[d])*(N=y-b),g+=(t.g=G=a[d+1])*N,n+=(t.b=D=a[d+2])*N,H+=r,q+=G,F+=D,t=t.next,
b<A&&(e+=p);d=l;b=J;t=K;for(c=0;c<C;c++)e=d<<2,a[e]=f*R>>Q,a[e+1]=g*R>>Q,a[e+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=l+((e=c+y)<A?e:A)*p<<2,f+=H+=b.r=a[e],g+=q+=b.g=a[e+1],n+=F+=b.b=a[e+2],b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=p}M.putImageData(h,u,B)}}function X(){this.a=this.b=this.g=this.r=0;this.next=null}var O=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,
345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,
309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],L=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,
20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,
24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],W={image:function(A,u,B,p){A=document.getElementById(A);var C=A.naturalWidth,w=A.naturalHeight,h=document.getElementById(u);h.style.width=C+"px";h.style.height=w+"px";h.width=C;h.height=w;h=h.getContext("2d");h.clearRect(0,0,C,w);h.drawImage(A,0,0);isNaN(B)||1>B||(p?E(u,0,0,C,w,B):K(u,0,0,C,w,B))},canvasRGBA:E,canvasRGB:K};"undefined"!==typeof define&&define.amd?define(function(){return W}):
"undefined"!==typeof module&&module.exports&&(module.exports=W);A.stackBlur=W})("undefined"!==typeof window?window:this);
(function(A,E){A.canvg=E(A.RGBColor,A.stackBlur)})("undefined"!==typeof window?window:this,function(A,E){function K(h){var a=[0,0,0],l=function(c,b){var e=h.match(c);null!=e&&(a[b]+=e.length,h=h.replace(c," "))};h=h.replace(/:not\(([^\)]*)\)/g,"     $1 ");h=h.replace(/{[\s\S]*/gm," ");l(W,1);l(M,0);l(u,1);l(B,2);l(p,1);l(C,1);h=h.replace(/[\*\s\+>~]/g," ");h=h.replace(/[#\.]/g," ");l(w,2);return a.join("")}function X(h){var a={opts:h,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3E4,log:function(a){}};1==a.opts.log&&
"undefined"!=typeof console&&(a.log=function(a){console.log(a)});a.init=function(c){var b=0;a.UniqueId=function(){b++;return"canvg"+b};a.Definitions={};a.Styles={};a.StylesSpecificity={};a.Animations=[];a.Images=[];a.ctx=c;a.ViewPort=new function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};
this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}};a.init();a.ImagesLoaded=function(){for(var c=0;c<a.Images.length;c++)if(!a.Images[c].loaded)return!1;return!0};a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};a.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm,
" ")};a.ajax=function(a){var b;b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",a,!1);b.send(null);return b.responseText};a.parseXml=function(a){if("undefined"!=typeof Windows&&"undefined"!=typeof Windows.Data&&"undefined"!=typeof Windows.Data.Xml){var b=new Windows.Data.Xml.Dom.XmlDocument,e=new Windows.Data.Xml.Dom.XmlLoadSettings;e.prohibitDtd=!1;b.loadXml(a,e);return b}if(window.DOMParser)return(new DOMParser).parseFromString(a,"text/xml");a=a.replace(/<!DOCTYPE svg[^>]*>/,
"");b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b};a.Property=function(a,b){this.name=a;this.value=b};a.Property.prototype.getValue=function(){return this.value};a.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value};a.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);(this.value+"").match(/%$/)&&(a/=100);return a};a.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:
a};a.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a};a.Property.prototype.addOpacity=function(c){var b=this.value;if(null!=c.value&&""!=c.value&&"string"==typeof this.value){var e=new A(this.value);e.ok&&(b="rgba("+e.r+", "+e.g+", "+e.b+", "+c.numValue()+")")}return new a.Property(this.name,b)};a.Property.prototype.getDefinition=function(){var c=this.value.match(/#([^\)'"]+)/);c&&(c=c[1]);c||(c=this.value);return a.Definitions[c]};a.Property.prototype.isUrlDefinition=
function(){return 0==this.value.indexOf("url(")};a.Property.prototype.getFillStyleDefinition=function(c,b){var e=this.getDefinition();if(null!=e&&e.createGradient)return e.createGradient(a.ctx,c,b);if(null!=e&&e.createPattern){if(e.getHrefAttribute().hasValue()){var d=e.attribute("patternTransform"),e=e.getHrefAttribute().getDefinition();d.hasValue()&&(e.attribute("patternTransform",!0).value=d.value)}return e.createPattern(a.ctx,c)}return null};a.Property.prototype.getDPI=function(a){return 96};
a.Property.prototype.getEM=function(c){var b=12,e=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);e.hasValue()&&(b=e.toPixels(c));return b};a.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")};a.Property.prototype.toPixels=function(c,b){if(!this.hasValue())return 0;var e=this.value+"";if(e.match(/em$/))return this.numValue()*this.getEM(c);if(e.match(/ex$/))return this.numValue()*this.getEM(c)/2;if(e.match(/px$/))return this.numValue();if(e.match(/pt$/))return this.numValue()*
this.getDPI(c)*(1/72);if(e.match(/pc$/))return 15*this.numValue();if(e.match(/cm$/))return this.numValue()*this.getDPI(c)/2.54;if(e.match(/mm$/))return this.numValue()*this.getDPI(c)/25.4;if(e.match(/in$/))return this.numValue()*this.getDPI(c);if(e.match(/%$/))return this.numValue()*a.ViewPort.ComputeSize(c);e=this.numValue();return b&&1>e?e*a.ViewPort.ComputeSize(c):e};a.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";if(a.match(/s$/))return 1E3*this.numValue();
a.match(/ms$/);return this.numValue()};a.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var l={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",
mathematical:"alphabetic"};a.Property.prototype.toTextBaseline=function(){return this.hasValue()?l[this.value]:null};a.Font=new function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(b,e,d,c,f,g){g=null!=g?this.Parse(g):this.CreateFont("","","","","",a.ctx.font);return{fontFamily:f||g.fontFamily,fontSize:c||g.fontSize,fontStyle:b||g.fontStyle,fontWeight:d||
g.fontWeight,fontVariant:e||g.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var c=this;this.Parse=function(b){var e={};b=a.trim(a.compressSpaces(b||"")).split(" ");for(var d=!1,k=!1,f=!1,g=!1,n="",m=0;m<b.length;m++)k||-1==c.Styles.indexOf(b[m])?g||-1==c.Variants.indexOf(b[m])?f||-1==c.Weights.indexOf(b[m])?d?"inherit"!=b[m]&&(n+=b[m]):("inherit"!=b[m]&&(e.fontSize=b[m].split("/")[0]),k=g=f=d=!0):("inherit"!=b[m]&&
(e.fontWeight=b[m]),k=g=f=!0):("inherit"!=b[m]&&(e.fontVariant=b[m]),k=g=!0):("inherit"!=b[m]&&(e.fontStyle=b[m]),k=!0);""!=n&&(e.fontFamily=n);return e}};a.ToNumberArray=function(c){c=a.trim(a.compressSpaces((c||"").replace(/,/g," "))).split(" ");for(var b=0;b<c.length;b++)c[b]=parseFloat(c[b]);return c};a.Point=function(a,b){this.x=a;this.y=b};a.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)};a.Point.prototype.applyTransform=function(a){var b=this.x*a[1]+this.y*a[3]+
a[5];this.x=this.x*a[0]+this.y*a[2]+a[4];this.y=b};a.CreatePoint=function(c){c=a.ToNumberArray(c);return new a.Point(c[0],c[1])};a.CreatePath=function(c){c=a.ToNumberArray(c);for(var b=[],e=0;e<c.length;e+=2)b.push(new a.Point(c[e],c[e+1]));return b};a.BoundingBox=function(a,b,e,d){this.y2=this.x2=this.y1=this.x1=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=
function(a,b){if(null!=a){if(isNaN(this.x1)||isNaN(this.x2))this.x2=this.x1=a;a<this.x1&&(this.x1=a);a>this.x2&&(this.x2=a)}if(null!=b){if(isNaN(this.y1)||isNaN(this.y2))this.y2=this.y1=b;b<this.y1&&(this.y1=b);b>this.y2&&(this.y2=b)}};this.addX=function(a){this.addPoint(a,null)};this.addY=function(a){this.addPoint(null,a)};this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1);this.addPoint(a.x2,a.y2)};this.addQuadraticCurve=function(a,b,e,d,c,v){e=a+2/3*(e-a);d=b+2/3*(d-b);this.addBezierCurve(a,
b,e,e+1/3*(c-a),d,d+1/3*(v-b),c,v)};this.addBezierCurve=function(a,b,e,d,c,v,z,h){var q=[a,b],F=[e,d],r=[c,v],l=[z,h];this.addPoint(q[0],q[1]);this.addPoint(l[0],l[1]);for(i=0;1>=i;i++)a=function(a){return Math.pow(1-a,3)*q[i]+3*Math.pow(1-a,2)*a*F[i]+3*(1-a)*Math.pow(a,2)*r[i]+Math.pow(a,3)*l[i]},b=6*q[i]-12*F[i]+6*r[i],e=-3*q[i]+9*F[i]-9*r[i]+3*l[i],d=3*F[i]-3*q[i],0==e?0!=b&&(b=-d/b,0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))):(d=Math.pow(b,2)-4*d*e,0>d||(c=(-b+Math.sqrt(d))/(2*e),
0<c&&1>c&&(0==i&&this.addX(a(c)),1==i&&this.addY(a(c))),b=(-b-Math.sqrt(d))/(2*e),0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))))};this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2};this.addPoint(a,b);this.addPoint(e,d)};a.Transform=function(c){var b=this;this.Type={};this.Type.translate=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)};this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)};
this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(b){b=a.ToNumberArray(b);this.angle=new a.Property("angle",b[0]);this.cx=b[1]||0;this.cy=b[2]||0;this.apply=function(a){a.translate(this.cx,this.cy);a.rotate(this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.unapply=function(a){a.translate(this.cx,this.cy);a.rotate(-1*this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.applyToPoint=function(a){var b=this.angle.toRadians();
a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]);a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(b){this.m=a.ToNumberArray(b);
this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(a){var b=this.m[0],e=this.m[2],d=this.m[4],c=this.m[1],f=this.m[3],g=this.m[5],k=1/(b*(1*f-0*g)-e*(1*c-0*g)+d*(0*c-0*f));a.transform(k*(1*f-0*g),k*(0*g-1*c),k*(0*d-1*e),k*(1*b-0*d),k*(e*g-d*f),k*(d*c-b*g))};this.applyToPoint=function(a){a.applyTransform(this.m)}};this.Type.SkewBase=function(e){this.base=b.Type.matrix;this.base(e);this.angle=new a.Property("angle",e)};this.Type.SkewBase.prototype=
new this.Type.matrix;this.Type.skewX=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)};this.unapply=function(a){for(var b=
this.transforms.length-1;0<=b;b--)this.transforms[b].unapply(a)};this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};c=a.trim(a.compressSpaces(c)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var e=0;e<c.length;e++){var d=a.trim(c[e].split("(")[0]),k=c[e].split("(")[1].replace(")",""),f=this.Type[d];"undefined"!=typeof f&&(k=new f(k),k.type=d,this.transforms.push(k))}};a.AspectRatio=function(c,b,e,d,k,
f,g,n,m,v){b=a.compressSpaces(b);b=b.replace(/^defer\s/,"");var z=b.split(" ")[0]||"xMidYMid";b=b.split(" ")[1]||"meet";var h=e/d,q=k/f,l=Math.min(h,q),r=Math.max(h,q);"meet"==b&&(d*=l,f*=l);"slice"==b&&(d*=r,f*=r);m=new a.Property("refX",m);v=new a.Property("refY",v);m.hasValue()&&v.hasValue()?c.translate(-l*m.toPixels("x"),-l*v.toPixels("y")):(z.match(/^xMid/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e/2-d/2,0),z.match(/YMid$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k/2-f/
2),z.match(/^xMax/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e-d,0),z.match(/YMax$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k-f));"none"==z?c.scale(h,q):"meet"==b?c.scale(l,l):"slice"==b&&c.scale(r,r);c.translate(null==g?0:-g,null==n?0:-n)};a.Element={};a.EmptyProperty=new a.Property("EMPTY","");a.Element.ElementBase=function(c){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(b,e){var d=this.attributes[b];if(null!=d)return d;
1==e&&(d=new a.Property(b,""),this.attributes[b]=d);return d||a.EmptyProperty};this.getHrefAttribute=function(){for(var b in this.attributes)if("href"==b||b.match(/:href$/))return this.attributes[b];return a.EmptyProperty};this.style=function(b,e,d){var c=this.styles[b];if(null!=c)return c;var f=this.attribute(b);if(null!=f&&f.hasValue())return this.styles[b]=f;if(1!=d&&(d=this.parent,null!=d&&(d=d.style(b),null!=d&&d.hasValue())))return d;1==e&&(c=new a.Property(b,""),this.styles[b]=c);return c||
a.EmptyProperty};this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){a.save();if(this.style("mask").hasValue()){var b=this.style("mask").getDefinition();null!=b&&b.apply(a,this)}else this.style("filter").hasValue()?(b=this.style("filter").getDefinition(),null!=b&&b.apply(a,this)):(this.setContext(a),this.renderChildren(a),this.clearContext(a));a.restore()}};this.setContext=function(a){};this.clearContext=function(a){};this.renderChildren=function(a){for(var b=
0;b<this.children.length;b++)this.children[b].render(a)};this.addChild=function(b,e){var d=b;e&&(d=a.CreateElement(b));d.parent=this;"title"!=d.type&&this.children.push(d)};this.addStylesFromStyleDefinition=function(){for(var b in a.Styles)if("@"!=b[0]&&L(c,b)){var e=a.Styles[b],d=a.StylesSpecificity[b];if(null!=e)for(var f in e){var k=this.stylesSpecificity[f];"undefined"==typeof k&&(k="000");d>k&&(this.styles[f]=e[f],this.stylesSpecificity[f]=d)}}};var b=/^[A-Z-]+$/,e=function(a){return b.test(a)?
a.toLowerCase():a};if(null!=c&&1==c.nodeType){for(var d=0;d<c.attributes.length;d++){var k=c.attributes[d],f=e(k.nodeName);this.attributes[f]=new a.Property(f,k.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue())for(e=this.attribute("style").value.split(";"),d=0;d<e.length;d++)""!=a.trim(e[d])&&(f=e[d].split(":"),k=a.trim(f[0]),f=a.trim(f[1]),this.styles[k]=new a.Property(k,f));this.attribute("id").hasValue()&&null==a.Definitions[this.attribute("id").value]&&(a.Definitions[this.attribute("id").value]=
this);for(d=0;d<c.childNodes.length;d++)e=c.childNodes[d],1==e.nodeType&&this.addChild(e,!0),!this.captureTextNodes||3!=e.nodeType&&4!=e.nodeType||""!=a.compressSpaces(e.value||e.text||e.textContent||"")&&this.addChild(new a.Element.tspan(e),!1)}};a.Element.RenderedElementBase=function(c){this.base=a.Element.ElementBase;this.base(c);this.setContext=function(b){if(this.style("fill").isUrlDefinition()){var e=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=e&&(b.fillStyle=
e)}else this.style("fill").hasValue()&&(e=this.style("fill"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.fillStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("fill-opacity").hasValue()&&(e=new a.Property("fill",b.fillStyle),e=e.addOpacity(this.style("fill-opacity")),b.fillStyle=e.value);this.style("stroke").isUrlDefinition()?(e=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")),null!=e&&(b.strokeStyle=e)):this.style("stroke").hasValue()&&
(e=this.style("stroke"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.strokeStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("stroke-opacity").hasValue()&&(e=new a.Property("stroke",b.strokeStyle),e=e.addOpacity(this.style("stroke-opacity")),b.strokeStyle=e.value);this.style("stroke-width").hasValue()&&(e=this.style("stroke-width").toPixels(),b.lineWidth=0==e?.001:e);this.style("stroke-linecap").hasValue()&&(b.lineCap=this.style("stroke-linecap").value);
this.style("stroke-linejoin").hasValue()&&(b.lineJoin=this.style("stroke-linejoin").value);this.style("stroke-miterlimit").hasValue()&&(b.miterLimit=this.style("stroke-miterlimit").value);this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value&&(e=a.ToNumberArray(this.style("stroke-dasharray").value),"undefined"!=typeof b.setLineDash?b.setLineDash(e):"undefined"!=typeof b.webkitLineDash?b.webkitLineDash=e:"undefined"==typeof b.mozDash||1==e.length&&0==e[0]||(b.mozDash=
e),e=this.style("stroke-dashoffset").numValueOrDefault(1),"undefined"!=typeof b.lineDashOffset?b.lineDashOffset=e:"undefined"!=typeof b.webkitLineDashOffset?b.webkitLineDashOffset=e:"undefined"!=typeof b.mozDashOffset&&(b.mozDashOffset=e));"undefined"!=typeof b.font&&(b.font=a.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString());
this.style("transform",!1,!0).hasValue()&&(new a.Transform(this.style("transform",!1,!0).value)).apply(b);this.style("clip-path",!1,!0).hasValue()&&(e=this.style("clip-path",!1,!0).getDefinition(),null!=e&&e.apply(b));this.style("opacity").hasValue()&&(b.globalAlpha=this.style("opacity").numValue())}};a.Element.RenderedElementBase.prototype=new a.Element.ElementBase;a.Element.PathElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.path=function(b){null!=b&&b.beginPath();
return new a.BoundingBox};this.renderChildren=function(b){this.path(b);a.Mouse.checkPath(this,b);""!=b.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?b.fill(this.style("fill-rule").value):b.fill());""!=b.strokeStyle&&b.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()){var d=this.style("marker-start").getDefinition();d.render(b,e[0][0],e[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var d=this.style("marker-mid").getDefinition(),
c=1;c<e.length-1;c++)d.render(b,e[c][0],e[c][1]);this.style("marker-end").isUrlDefinition()&&(d=this.style("marker-end").getDefinition(),d.render(b,e[e.length-1][0],e[e.length-1][1]))}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};a.Element.PathElementBase.prototype=new a.Element.RenderedElementBase;a.Element.svg=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseClearContext=this.clearContext;this.clearContext=function(b){this.baseClearContext(b);
a.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(b){b.strokeStyle="rgba(0,0,0,0)";b.lineCap="butt";b.lineJoin="miter";b.miterLimit=4;"undefined"!=typeof b.font&&"undefined"!=typeof window.getComputedStyle&&(b.font=window.getComputedStyle(b.canvas).getPropertyValue("font"));this.baseSetContext(b);this.attribute("x").hasValue()||(this.attribute("x",!0).value=0);this.attribute("y").hasValue()||(this.attribute("y",!0).value=0);b.translate(this.attribute("x").toPixels("x"),
this.attribute("y").toPixels("y"));var e=a.ViewPort.width(),d=a.ViewPort.height();this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%");this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%");if("undefined"==typeof this.root){var e=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y"),c=0,f=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(c=-this.attribute("refX").toPixels("x"),f=-this.attribute("refY").toPixels("y"));
"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(b.beginPath(),b.moveTo(c,f),b.lineTo(e,f),b.lineTo(e,d),b.lineTo(c,d),b.closePath(),b.clip())}a.ViewPort.SetCurrent(e,d);if(this.attribute("viewBox").hasValue()){var c=a.ToNumberArray(this.attribute("viewBox").value),f=c[0],g=c[1],e=c[2],d=c[3];a.AspectRatio(b,this.attribute("preserveAspectRatio").value,a.ViewPort.width(),e,a.ViewPort.height(),d,f,g,this.attribute("refX").value,this.attribute("refY").value);a.ViewPort.RemoveCurrent();
a.ViewPort.SetCurrent(c[2],c[3])}}};a.Element.svg.prototype=new a.Element.RenderedElementBase;a.Element.rect=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),c=this.attribute("width").toPixels("x"),f=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),n=this.attribute("ry").toPixels("y");this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(n=g);this.attribute("ry").hasValue()&&
!this.attribute("rx").hasValue()&&(g=n);g=Math.min(g,c/2);n=Math.min(n,f/2);null!=b&&(b.beginPath(),b.moveTo(e+g,d),b.lineTo(e+c-g,d),b.quadraticCurveTo(e+c,d,e+c,d+n),b.lineTo(e+c,d+f-n),b.quadraticCurveTo(e+c,d+f,e+c-g,d+f),b.lineTo(e+g,d+f),b.quadraticCurveTo(e,d+f,e,d+f-n),b.lineTo(e,d+n),b.quadraticCurveTo(e,d,e+g,d),b.closePath());return new a.BoundingBox(e,d,e+c,d+f)}};a.Element.rect.prototype=new a.Element.PathElementBase;a.Element.circle=function(c){this.base=a.Element.PathElementBase;this.base(c);
this.path=function(b){var e=this.attribute("cx").toPixels("x"),d=this.attribute("cy").toPixels("y"),c=this.attribute("r").toPixels();null!=b&&(b.beginPath(),b.arc(e,d,c,0,2*Math.PI,!0),b.closePath());return new a.BoundingBox(e-c,d-c,e+c,d+c)}};a.Element.circle.prototype=new a.Element.PathElementBase;a.Element.ellipse=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=(Math.sqrt(2)-1)/3*4,d=this.attribute("rx").toPixels("x"),c=this.attribute("ry").toPixels("y"),
f=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");null!=b&&(b.beginPath(),b.moveTo(f,g-c),b.bezierCurveTo(f+e*d,g-c,f+d,g-e*c,f+d,g),b.bezierCurveTo(f+d,g+e*c,f+e*d,g+c,f,g+c),b.bezierCurveTo(f-e*d,g+c,f-d,g+e*c,f-d,g),b.bezierCurveTo(f-d,g-e*c,f-e*d,g-c,f,g-c),b.closePath());return new a.BoundingBox(f-d,g-c,f+d,g+c)}};a.Element.ellipse.prototype=new a.Element.PathElementBase;a.Element.line=function(c){this.base=a.Element.PathElementBase;this.base(c);this.getPoints=function(){return[new a.Point(this.attribute("x1").toPixels("x"),
this.attribute("y1").toPixels("y")),new a.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(b){var e=this.getPoints();null!=b&&(b.beginPath(),b.moveTo(e[0].x,e[0].y),b.lineTo(e[1].x,e[1].y));return new a.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)};this.getMarkers=function(){var a=this.getPoints(),e=a[0].angleTo(a[1]);return[[a[0],e],[a[1],e]]}};a.Element.line.prototype=new a.Element.PathElementBase;a.Element.polyline=function(c){this.base=a.Element.PathElementBase;
this.base(c);this.points=a.CreatePath(this.attribute("points").value);this.path=function(b){var e=new a.BoundingBox(this.points[0].x,this.points[0].y);null!=b&&(b.beginPath(),b.moveTo(this.points[0].x,this.points[0].y));for(var d=1;d<this.points.length;d++)e.addPoint(this.points[d].x,this.points[d].y),null!=b&&b.lineTo(this.points[d].x,this.points[d].y);return e};this.getMarkers=function(){for(var a=[],e=0;e<this.points.length-1;e++)a.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);
0<a.length&&a.push([this.points[this.points.length-1],a[a.length-1][1]]);return a}};a.Element.polyline.prototype=new a.Element.PathElementBase;a.Element.polygon=function(c){this.base=a.Element.polyline;this.base(c);this.basePath=this.path;this.path=function(a){var e=this.basePath(a);null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath());return e}};a.Element.polygon.prototype=new a.Element.polyline;a.Element.path=function(c){this.base=a.Element.PathElementBase;this.base(c);c=this.attribute("d").value;
c=c.replace(/,/gm," ");for(var b=0;2>b;b++)c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");c=c.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");c=c.replace(/([0-9])([+\-])/gm,"$1 $2");for(b=0;2>b;b++)c=c.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");c=c.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");c=a.compressSpaces(c);c=a.trim(c);this.PathParser=new function(b){this.tokens=b.split(" ");this.reset=function(){this.i=-1;this.previousCommand=this.command="";this.start=new a.Point(0,
0);this.control=new a.Point(0,0);this.current=new a.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)};this.isRelativeCommand=function(){switch(this.command){case "m":case "l":case "h":case "v":case "c":case "s":case "q":case "t":case "a":case "z":return!0}return!1};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};
this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var b=new a.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(b)};this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a};this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a};this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&
"t"!=this.previousCommand.toLowerCase()?this.current:new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)};this.makeAbsolute=function(a){this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y);return a};this.addMarker=function(a,b,e){null!=e&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(e));this.addMarkerAngle(a,null==b?null:b.angleTo(a))};this.addMarkerAngle=function(a,
b){this.points.push(a);this.angles.push(b)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(c);this.path=function(b){var d=this.PathParser;d.reset();var c=new a.BoundingBox;for(null!=b&&b.beginPath();!d.isEnd();)switch(d.nextCommand(),d.command){case "M":case "m":var f=d.getAsCurrentPoint();
d.addMarker(f);c.addPoint(f.x,f.y);null!=b&&b.moveTo(f.x,f.y);for(d.start=d.current;!d.isCommandOrEnd();)f=d.getAsCurrentPoint(),d.addMarker(f,d.start),c.addPoint(f.x,f.y),null!=b&&b.lineTo(f.x,f.y);break;case "L":case "l":for(;!d.isCommandOrEnd();){var g=d.current,f=d.getAsCurrentPoint();d.addMarker(f,g);c.addPoint(f.x,f.y);null!=b&&b.lineTo(f.x,f.y)}break;case "H":case "h":for(;!d.isCommandOrEnd();)f=new a.Point((d.isRelativeCommand()?d.current.x:0)+d.getScalar(),d.current.y),d.addMarker(f,d.current),
d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "V":case "v":for(;!d.isCommandOrEnd();)f=new a.Point(d.current.x,(d.isRelativeCommand()?d.current.y:0)+d.getScalar()),d.addMarker(f,d.current),d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "C":case "c":for(;!d.isCommandOrEnd();){var n=d.current,g=d.getPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint();d.addMarker(f,m,g);c.addBezierCurve(n.x,
n.y,g.x,g.y,m.x,m.y,f.x,f.y);null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y)}break;case "S":case "s":for(;!d.isCommandOrEnd();)n=d.current,g=d.getReflectedControlPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,g),c.addBezierCurve(n.x,n.y,g.x,g.y,m.x,m.y,f.x,f.y),null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y);break;case "Q":case "q":for(;!d.isCommandOrEnd();)n=d.current,m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,
f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "T":case "t":for(;!d.isCommandOrEnd();)n=d.current,m=d.getReflectedControlPoint(),d.control=m,f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "A":case "a":for(;!d.isCommandOrEnd();){var n=d.current,v=d.getScalar(),h=d.getScalar(),g=d.getScalar()*(Math.PI/180),l=d.getScalar(),m=d.getScalar(),f=d.getAsCurrentPoint(),q=new a.Point(Math.cos(g)*
(n.x-f.x)/2+Math.sin(g)*(n.y-f.y)/2,-Math.sin(g)*(n.x-f.x)/2+Math.cos(g)*(n.y-f.y)/2),p=Math.pow(q.x,2)/Math.pow(v,2)+Math.pow(q.y,2)/Math.pow(h,2);1<p&&(v*=Math.sqrt(p),h*=Math.sqrt(p));l=(l==m?-1:1)*Math.sqrt((Math.pow(v,2)*Math.pow(h,2)-Math.pow(v,2)*Math.pow(q.y,2)-Math.pow(h,2)*Math.pow(q.x,2))/(Math.pow(v,2)*Math.pow(q.y,2)+Math.pow(h,2)*Math.pow(q.x,2)));isNaN(l)&&(l=0);var r=new a.Point(l*v*q.y/h,l*-h*q.x/v),n=new a.Point((n.x+f.x)/2+Math.cos(g)*r.x-Math.sin(g)*r.y,(n.y+f.y)/2+Math.sin(g)*
r.x+Math.cos(g)*r.y),u=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))*Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)))},w=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(u(a,b))},l=w([1,0],[(q.x-r.x)/v,(q.y-r.y)/h]),p=[(q.x-r.x)/v,(q.y-r.y)/h],r=[(-q.x-r.x)/v,(-q.y-r.y)/h],q=w(p,r);-1>=u(p,r)&&(q=Math.PI);1<=u(p,r)&&(q=0);p=1-m?1:-1;r=l+q/2*p;w=new a.Point(n.x+v*Math.cos(r),n.y+h*Math.sin(r));d.addMarkerAngle(w,r-p*Math.PI/2);d.addMarkerAngle(f,r-p*Math.PI);
c.addPoint(f.x,f.y);null!=b&&(u=v>h?v:h,f=v>h?1:v/h,v=v>h?h/v:1,b.translate(n.x,n.y),b.rotate(g),b.scale(f,v),b.arc(0,0,u,l,l+q,1-m),b.scale(1/f,1/v),b.rotate(-g),b.translate(-n.x,-n.y))}break;case "Z":case "z":null!=b&&b.closePath(),d.current=d.start}return c};this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],f=0;f<a.length;f++)c.push([a[f],b[f]]);return c}};a.Element.path.prototype=new a.Element.PathElementBase;a.Element.pattern=function(c){this.base=
a.Element.ElementBase;this.base(c);this.createPattern=function(b,e){var d=this.attribute("width").toPixels("x",!0),c=this.attribute("height").toPixels("y",!0),f=new a.Element.svg;f.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);f.attributes.width=new a.Property("width",d+"px");f.attributes.height=new a.Property("height",c+"px");f.attributes.transform=new a.Property("transform",this.attribute("patternTransform").value);f.children=this.children;var g=document.createElement("canvas");
g.width=d;g.height=c;d=g.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&d.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(c=-1;1>=c;c++)for(var n=-1;1>=n;n++)d.save(),f.attributes.x=new a.Property("x",c*g.width),f.attributes.y=new a.Property("y",n*g.height),f.render(d),d.restore();return b.createPattern(g,"repeat")}};a.Element.pattern.prototype=new a.Element.ElementBase;a.Element.marker=function(c){this.base=a.Element.ElementBase;
this.base(c);this.baseRender=this.render;this.render=function(b,e,d){b.translate(e.x,e.y);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(d);"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(b.lineWidth,b.lineWidth);b.save();var c=new a.Element.svg;c.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);c.attributes.refX=new a.Property("refX",this.attribute("refX").value);c.attributes.refY=new a.Property("refY",this.attribute("refY").value);
c.attributes.width=new a.Property("width",this.attribute("markerWidth").value);c.attributes.height=new a.Property("height",this.attribute("markerHeight").value);c.attributes.fill=new a.Property("fill",this.attribute("fill").valueOrDefault("black"));c.attributes.stroke=new a.Property("stroke",this.attribute("stroke").valueOrDefault("none"));c.children=this.children;var f=0,g=0;this.attribute("refX").hasValue()&&(f=-parseFloat(this.attribute("refX").value));this.attribute("refY").hasValue()&&(g=-parseFloat(this.attribute("refY").value));
b.translate(f,g);c.render(b);b.restore();"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(1/b.lineWidth,1/b.lineWidth);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(-d);b.translate(-e.x,-e.y)}};a.Element.marker.prototype=new a.Element.ElementBase;a.Element.defs=function(c){this.base=a.Element.ElementBase;this.base(c);this.render=function(a){}};a.Element.defs.prototype=new a.Element.ElementBase;a.Element.GradientBase=function(c){this.base=a.Element.ElementBase;
this.base(c);this.stops=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"stop"==b.type&&this.stops.push(b)}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(a){for(var b=0;b<this.attributesToInherit.length;b++){var c=this.attributesToInherit[b];!this.attribute(c).hasValue()&&a.attribute(c).hasValue()&&(this.attribute(c,!0).value=
a.attribute(c).value)}};this.createGradient=function(b,d,c){var f=this;this.getHrefAttribute().hasValue()&&(f=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(f));var g=function(b){return c.hasValue()?(new a.Property("color",b)).addOpacity(c).value:b};b=this.getGradient(b,d);if(null==b)return g(f.stops[f.stops.length-1].color);for(d=0;d<f.stops.length;d++)b.addColorStop(f.stops[d].offset,g(f.stops[d].color));return this.attribute("gradientTransform").hasValue()?(f=a.ViewPort.viewPorts[0],
g=new a.Element.rect,g.attributes.x=new a.Property("x",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.y=new a.Property("y",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.width=new a.Property("width",a.MAX_VIRTUAL_PIXELS),g.attributes.height=new a.Property("height",a.MAX_VIRTUAL_PIXELS),d=new a.Element.g,d.attributes.transform=new a.Property("transform",this.attribute("gradientTransform").value),d.children=[g],g=new a.Element.svg,g.attributes.x=new a.Property("x",0),g.attributes.y=new a.Property("y",0),g.attributes.width=
new a.Property("width",f.width),g.attributes.height=new a.Property("height",f.height),g.children=[d],d=document.createElement("canvas"),d.width=f.width,d.height=f.height,f=d.getContext("2d"),f.fillStyle=b,g.render(f),f.createPattern(d,"no-repeat")):b}};a.Element.GradientBase.prototype=new a.Element.ElementBase;a.Element.linearGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");
this.attributesToInherit.push("y2");this.getGradient=function(a,e){var c="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var k="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),
f="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),g="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),c="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return k==g&&f==c?null:a.createLinearGradient(k,f,g,c)}};a.Element.linearGradient.prototype=new a.Element.GradientBase;
a.Element.radialGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(a,c){var d=c.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%");this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%");this.attribute("r").hasValue()||(this.attribute("r",
!0).value="50%");var k="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),f="objectBoundingBox"==this.gradientUnits()?d.y()+d.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),g=k,n=f;this.attribute("fx").hasValue()&&(g="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"));this.attribute("fy").hasValue()&&(n="objectBoundingBox"==
this.gradientUnits()?d.y()+d.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));d="objectBoundingBox"==this.gradientUnits()?(d.width()+d.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(g,n,0,k,f,d)}};a.Element.radialGradient.prototype=new a.Element.GradientBase;a.Element.stop=function(c){this.base=a.Element.ElementBase;this.base(c);this.offset=this.attribute("offset").numValue();0>this.offset&&(this.offset=0);1<this.offset&&
(this.offset=1);c=this.style("stop-color",!0);""===c.value&&(c.value="#000");this.style("stop-opacity").hasValue()&&(c=c.addOpacity(this.style("stop-opacity")));this.color=c.value};a.Element.stop.prototype=new a.Element.ElementBase;a.Element.AnimateBase=function(c){this.base=a.Element.ElementBase;this.base(c);a.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var a=
this.attribute("attributeType").value,c=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(c,!0):this.parent.attribute(c,!0)};this.initialValue=null;this.initialUnits="";this.removed=!1;this.calcValue=function(){return""};this.update=function(a){null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits());if(this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=
0;else if("freeze"==this.attribute("fill").valueOrDefault("remove")&&!this.frozen)this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;else if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0;return!1}this.duration+=a;a=!1;this.begin<this.duration&&(a=this.calcValue(),this.attribute("type").hasValue()&&
(a=this.attribute("type").value+"("+a+")"),this.getProperty().value=a,a=!0);return a};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");this.values.hasValue()&&(this.values.value=this.values.value.split(";"));this.progress=function(){var b={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var c=b.progress*(this.values.value.length-1),d=Math.floor(c),k=Math.ceil(c);b.from=new a.Property("from",parseFloat(this.values.value[d]));
b.to=new a.Property("to",parseFloat(this.values.value[k]));b.progress=(c-d)/(k-d)}else b.from=this.from,b.to=this.to;return b}};a.Element.AnimateBase.prototype=new a.Element.ElementBase;a.Element.animate=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){var a=this.progress();return a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress+this.initialUnits}};a.Element.animate.prototype=new a.Element.AnimateBase;a.Element.animateColor=function(c){this.base=a.Element.AnimateBase;
this.base(c);this.calcValue=function(){var a=this.progress(),c=new A(a.from.value),d=new A(a.to.value);if(c.ok&&d.ok){var k=c.g+(d.g-c.g)*a.progress,f=c.b+(d.b-c.b)*a.progress;return"rgb("+parseInt(c.r+(d.r-c.r)*a.progress,10)+","+parseInt(k,10)+","+parseInt(f,10)+")"}return this.attribute("from").value}};a.Element.animateColor.prototype=new a.Element.AnimateBase;a.Element.animateTransform=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){for(var b=this.progress(),
c=a.ToNumberArray(b.from.value),d=a.ToNumberArray(b.to.value),k="",f=0;f<c.length;f++)k+=c[f]+(d[f]-c[f])*b.progress+" ";return k}};a.Element.animateTransform.prototype=new a.Element.animate;a.Element.font=function(c){this.base=a.Element.ElementBase;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isArabic=this.isRTL=!1;this.missingGlyph=this.fontFace=null;this.glyphs=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"font-face"==b.type?(this.fontFace=b,b.style("font-family").hasValue()&&
(a.Definitions[b.style("font-family").value]=this)):"missing-glyph"==b.type?this.missingGlyph=b:"glyph"==b.type&&(""!=b.arabicForm?(this.isArabic=this.isRTL=!0,"undefined"==typeof this.glyphs[b.unicode]&&(this.glyphs[b.unicode]=[]),this.glyphs[b.unicode][b.arabicForm]=b):this.glyphs[b.unicode]=b)}};a.Element.font.prototype=new a.Element.ElementBase;a.Element.fontface=function(c){this.base=a.Element.ElementBase;this.base(c);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;
this.unitsPerEm=this.attribute("units-per-em").numValue()};a.Element.fontface.prototype=new a.Element.ElementBase;a.Element.missingglyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=0};a.Element.missingglyph.prototype=new a.Element.path;a.Element.glyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};a.Element.glyph.prototype=
new a.Element.path;a.Element.text=function(c){this.captureTextNodes=!0;this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);var c=this.style("dominant-baseline").toTextBaseline();null==c&&(c=this.style("alignment-baseline").toTextBaseline());null!=c&&(a.textBaseline=c)};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);
return new a.BoundingBox(b,c-d,b+Math.floor(2*d/3)*this.children[0].getText().length,c)};this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x"));this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y"));this.x+=this.getAnchorDelta(a,this,0);for(var c=0;c<this.children.length;c++)this.renderChild(a,this,this,c)};this.getAnchorDelta=function(a,c,
d){var k=this.style("text-anchor").valueOrDefault("start");if("start"!=k){for(var f=0,g=d;g<c.children.length;g++){var n=c.children[g];if(g>d&&n.attribute("x").hasValue())break;f+=n.measureTextRecursive(a)}return-1*("end"==k?f:f/2)}return 0};this.renderChild=function(a,c,d,k){var f=d.children[k];f.attribute("x").hasValue()?(f.x=f.attribute("x").toPixels("x")+c.getAnchorDelta(a,d,k),f.attribute("dx").hasValue()&&(f.x+=f.attribute("dx").toPixels("x"))):(f.attribute("dx").hasValue()&&(c.x+=f.attribute("dx").toPixels("x")),
f.x=c.x);c.x=f.x+f.measureText(a);f.attribute("y").hasValue()?(f.y=f.attribute("y").toPixels("y"),f.attribute("dy").hasValue()&&(f.y+=f.attribute("dy").toPixels("y"))):(f.attribute("dy").hasValue()&&(c.y+=f.attribute("dy").toPixels("y")),f.y=c.y);c.y=f.y;f.render(a);for(k=0;k<f.children.length;k++)c.renderChild(a,c,f,k)}};a.Element.text.prototype=new a.Element.RenderedElementBase;a.Element.TextElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getGlyph=function(a,c,
d){var k=c[d],f=null;if(a.isArabic){var g="isolated";(0==d||" "==c[d-1])&&d<c.length-2&&" "!=c[d+1]&&(g="terminal");0<d&&" "!=c[d-1]&&d<c.length-2&&" "!=c[d+1]&&(g="medial");0<d&&" "!=c[d-1]&&(d==c.length-1||" "==c[d+1])&&(g="initial");"undefined"!=typeof a.glyphs[k]&&(f=a.glyphs[k][g],null==f&&"glyph"==a.glyphs[k].type&&(f=a.glyphs[k]))}else f=a.glyphs[k];null==f&&(f=a.missingGlyph);return f};this.renderChildren=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){var d=
this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),k=this.parent.style("font-style").valueOrDefault(a.Font.Parse(a.ctx.font).fontStyle),f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=a.ToNumberArray(this.parent.attribute("dx").value),n=0;n<f.length;n++){var m=this.getGlyph(c,f,n),h=d/c.fontFace.unitsPerEm;b.translate(this.x,this.y);b.scale(h,-h);var l=b.lineWidth;b.lineWidth=b.lineWidth*c.fontFace.unitsPerEm/d;"italic"==k&&b.transform(1,0,.4,
1,0,0);m.render(b);"italic"==k&&b.transform(1,0,-.4,1,0,0);b.lineWidth=l;b.scale(1/h,-1/h);b.translate(-this.x,-this.y);this.x+=d*(m.horizAdvX||c.horizAdvX)/c.fontFace.unitsPerEm;"undefined"==typeof g[n]||isNaN(g[n])||(this.x+=g[n])}}else""!=b.fillStyle&&b.fillText(a.compressSpaces(this.getText()),this.x,this.y),""!=b.strokeStyle&&b.strokeText(a.compressSpaces(this.getText()),this.x,this.y)};this.getText=function(){};this.measureTextRecursive=function(a){for(var c=this.measureText(a),d=0;d<this.children.length;d++)c+=
this.children[d].measureTextRecursive(a);return c};this.measureText=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){b=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);var d=0,k=this.getText();c.isRTL&&(k=k.split("").reverse().join(""));for(var f=a.ToNumberArray(this.parent.attribute("dx").value),g=0;g<k.length;g++){var n=this.getGlyph(c,k,g),d=d+(n.horizAdvX||c.horizAdvX)*b/c.fontFace.unitsPerEm;"undefined"==typeof f[g]||isNaN(f[g])||
(d+=f[g])}return d}c=a.compressSpaces(this.getText());if(!b.measureText)return 10*c.length;b.save();this.setContext(b);c=b.measureText(c).width;b.restore();return c}};a.Element.TextElementBase.prototype=new a.Element.RenderedElementBase;a.Element.tspan=function(c){this.captureTextNodes=!0;this.base=a.Element.TextElementBase;this.base(c);this.text=a.compressSpaces(c.value||c.text||c.textContent||"");this.getText=function(){return 0<this.children.length?"":this.text}};a.Element.tspan.prototype=new a.Element.TextElementBase;
a.Element.tref=function(c){this.base=a.Element.TextElementBase;this.base(c);this.getText=function(){var a=this.getHrefAttribute().getDefinition();if(null!=a)return a.children[0].getText()}};a.Element.tref.prototype=new a.Element.TextElementBase;a.Element.a=function(c){this.base=a.Element.TextElementBase;this.base(c);this.hasText=0<c.childNodes.length;for(var b=0;b<c.childNodes.length;b++)3!=c.childNodes[b].nodeType&&(this.hasText=!1);this.text=this.hasText?c.childNodes[0].value:"";this.getText=function(){return this.text};
this.baseRenderChildren=this.renderChildren;this.renderChildren=function(b){if(this.hasText){this.baseRenderChildren(b);var c=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);a.Mouse.checkBoundingBox(this,new a.BoundingBox(this.x,this.y-c.toPixels("y"),this.x+this.measureText(b),this.y))}else 0<this.children.length&&(c=new a.Element.g,c.children=this.children,c.parent=this,c.render(b))};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){a.ctx.canvas.style.cursor=
"pointer"}};a.Element.a.prototype=new a.Element.TextElementBase;a.Element.image=function(c){this.base=a.Element.RenderedElementBase;this.base(c);var b=this.getHrefAttribute().value;if(""!=b){var e=b.match(/\.svg$/);a.Images.push(this);this.loaded=!1;if(e)this.img=a.ajax(b),this.loaded=!0;else{this.img=document.createElement("img");1==a.opts.useCORS&&(this.img.crossOrigin="Anonymous");var d=this;this.img.onload=function(){d.loaded=!0};this.img.onerror=function(){a.log('ERROR: image "'+b+'" not found');
d.loaded=!0};this.img.src=b}this.renderChildren=function(b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),m=this.attribute("height").toPixels("y");0!=n&&0!=m&&(b.save(),e?b.drawSvg(this.img,c,d,n,m):(b.translate(c,d),a.AspectRatio(b,this.attribute("preserveAspectRatio").value,n,this.img.width,m,this.img.height,0,0),b.drawImage(this.img,0,0)),b.restore())};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=
this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y");return new a.BoundingBox(b,c,b+d,c+e)}}};a.Element.image.prototype=new a.Element.RenderedElementBase;a.Element.g=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getBoundingBox=function(){for(var b=new a.BoundingBox,c=0;c<this.children.length;c++)b.addBoundingBox(this.children[c].getBoundingBox());return b}};a.Element.g.prototype=new a.Element.RenderedElementBase;
a.Element.symbol=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.render=function(a){}};a.Element.symbol.prototype=new a.Element.RenderedElementBase;a.Element.style=function(c){this.base=a.Element.ElementBase;this.base(c);for(var b="",e=0;e<c.childNodes.length;e++)b+=c.childNodes[e].data;b=b.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");b=a.compressSpaces(b);c=b.split("}");for(e=0;e<c.length;e++)if(""!=a.trim(c[e]))for(var d=c[e].split("{"),b=d[0].split(","),
d=d[1].split(";"),k=0;k<b.length;k++){var f=a.trim(b[k]);if(""!=f){for(var g=a.Styles[f]||{},n=0;n<d.length;n++){var m=d[n].indexOf(":"),h=d[n].substr(0,m),m=d[n].substr(m+1,d[n].length-m);null!=h&&null!=m&&(g[a.trim(h)]=new a.Property(a.trim(h),a.trim(m)))}a.Styles[f]=g;a.StylesSpecificity[f]=K(f);if("@font-face"==f)for(f=g["font-family"].value.replace(/"/g,""),g=g.src.value.split(","),n=0;n<g.length;n++)if(0<g[n].indexOf('format("svg")'))for(h=g[n].indexOf("url"),m=g[n].indexOf(")",h),h=g[n].substr(h+
5,m-h-6),h=a.parseXml(a.ajax(h)).getElementsByTagName("font"),m=0;m<h.length;m++){var l=a.CreateElement(h[m]);a.Definitions[f]=l}}}};a.Element.style.prototype=new a.Element.ElementBase;a.Element.use=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0);this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))};
var b=this.getHrefAttribute().getDefinition();this.path=function(a){null!=b&&b.path(a)};this.getBoundingBox=function(){if(null!=b)return b.getBoundingBox()};this.renderChildren=function(c){if(null!=b){var d=b;"symbol"==b.type&&(d=new a.Element.svg,d.type="svg",d.attributes.viewBox=new a.Property("viewBox",b.attribute("viewBox").value),d.attributes.preserveAspectRatio=new a.Property("preserveAspectRatio",b.attribute("preserveAspectRatio").value),d.attributes.overflow=new a.Property("overflow",b.attribute("overflow").value),
d.children=b.children);"svg"==d.type&&(this.attribute("width").hasValue()&&(d.attributes.width=new a.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(d.attributes.height=new a.Property("height",this.attribute("height").value)));var k=d.parent;d.parent=null;d.render(c);d.parent=k}}};a.Element.use.prototype=new a.Element.RenderedElementBase;a.Element.mask=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b,c){var d=this.attribute("x").toPixels("x"),
k=this.attribute("y").toPixels("y"),f=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==f&&0==g){g=new a.BoundingBox;for(d=0;d<this.children.length;d++)g.addBoundingBox(this.children[d].getBoundingBox());d=Math.floor(g.x1);k=Math.floor(g.y1);f=Math.floor(g.width());g=Math.floor(g.height())}var n=c.attribute("mask").value;c.attribute("mask").value="";var m=document.createElement("canvas");m.width=d+f;m.height=k+g;var h=m.getContext("2d");this.renderChildren(h);var l=
document.createElement("canvas");l.width=d+f;l.height=k+g;var p=l.getContext("2d");c.render(p);p.globalCompositeOperation="destination-in";p.fillStyle=h.createPattern(m,"no-repeat");p.fillRect(0,0,d+f,k+g);b.fillStyle=p.createPattern(l,"no-repeat");b.fillRect(0,0,d+f,k+g);c.attribute("mask").value=n};this.render=function(a){}};a.Element.mask.prototype=new a.Element.ElementBase;a.Element.clipPath=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b){var c=CanvasRenderingContext2D.prototype.beginPath;
CanvasRenderingContext2D.prototype.beginPath=function(){};var d=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};c.call(b);for(var k=0;k<this.children.length;k++){var f=this.children[k];if("undefined"!=typeof f.path){var g=null;f.style("transform",!1,!0).hasValue()&&(g=new a.Transform(f.style("transform",!1,!0).value),g.apply(b));f.path(b);CanvasRenderingContext2D.prototype.closePath=d;g&&g.unapply(b)}}d.call(b);b.clip();CanvasRenderingContext2D.prototype.beginPath=
c;CanvasRenderingContext2D.prototype.closePath=d};this.render=function(a){}};a.Element.clipPath.prototype=new a.Element.ElementBase;a.Element.filter=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c){var d=c.getBoundingBox(),k=Math.floor(d.x1),f=Math.floor(d.y1),g=Math.floor(d.width()),d=Math.floor(d.height()),n=c.style("filter").value;c.style("filter").value="";for(var m=0,h=0,l=0;l<this.children.length;l++)var p=this.children[l].extraFilterDistance||0,m=Math.max(m,
p),h=Math.max(h,p);p=document.createElement("canvas");p.width=g+2*m;p.height=d+2*h;var q=p.getContext("2d");q.translate(-k+m,-f+h);c.render(q);for(l=0;l<this.children.length;l++)"function"==typeof this.children[l].apply&&this.children[l].apply(q,0,0,g+2*m,d+2*h);a.drawImage(p,0,0,g+2*m,d+2*h,k-m,f-h,g+2*m,d+2*h);c.style("filter",!0).value=n};this.render=function(a){}};a.Element.filter.prototype=new a.Element.ElementBase;a.Element.feMorphology=function(c){this.base=a.Element.ElementBase;this.base(c);
this.apply=function(a,c,d,k,f){}};a.Element.feMorphology.prototype=new a.Element.ElementBase;a.Element.feComposite=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c,d,k,f){}};a.Element.feComposite.prototype=new a.Element.ElementBase;a.Element.feColorMatrix=function(c){function b(a,b){var c=e[a];return c*(0>c?b-255:b)}this.base=a.Element.ElementBase;this.base(c);var e=a.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case "saturate":c=
e[0];e=[.213+.787*c,.715-.715*c,.072-.072*c,0,0,.213-.213*c,.715+.285*c,.072-.072*c,0,0,.213-.213*c,.715-.715*c,.072+.928*c,0,0,0,0,0,1,0,0,0,0,0,1];break;case "hueRotate":var d=e[0]*Math.PI/180;c=function(a,b,c){return a+Math.cos(d)*b+Math.sin(d)*c};e=[c(.213,.787,-.213),c(.715,-.715,-.715),c(.072,-.072,.928),0,0,c(.213,-.213,.143),c(.715,.285,.14),c(.072,-.072,-.283),0,0,c(.213,-.213,-.787),c(.715,-.715,.715),c(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case "luminanceToAlpha":e=[0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(a,c,d,e,h){var l=a.getImageData(0,0,e,h);for(d=0;d<h;d++)for(c=0;c<e;c++){var p=l.data[d*e*4+4*c+0],u=l.data[d*e*4+4*c+1],q=l.data[d*e*4+4*c+2],w=l.data[d*e*4+4*c+3],r=b(0,p)+b(1,u)+b(2,q)+b(3,w)+b(4,1);l.data[d*e*4+4*c+0]=r;r=b(5,p)+b(6,u)+b(7,q)+b(8,w)+b(9,1);l.data[d*e*4+4*c+1]=r;r=b(10,p)+b(11,u)+b(12,q)+b(13,w)+b(14,1);l.data[d*e*4+4*c+2]=r;p=b(15,p)+b(16,u)+b(17,q)+b(18,w)+b(19,1);l.data[d*e*4+4*c+3]=p}a.clearRect(0,0,
e,h);a.putImageData(l,0,0)}};a.Element.feColorMatrix.prototype=new a.Element.ElementBase;a.Element.feGaussianBlur=function(c){this.base=a.Element.ElementBase;this.base(c);this.extraFilterDistance=this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.apply=function(b,c,d,k,f){"undefined"==typeof E.canvasRGBA?a.log("ERROR: StackBlur.js must be included for blur to work"):(b.canvas.id=a.UniqueId(),b.canvas.style.display="none",document.body.appendChild(b.canvas),E.canvasRGBA(b.canvas.id,
c,d,k,f,this.blurRadius),document.body.removeChild(b.canvas))}};a.Element.feGaussianBlur.prototype=new a.Element.ElementBase;a.Element.title=function(a){};a.Element.title.prototype=new a.Element.ElementBase;a.Element.desc=function(a){};a.Element.desc.prototype=new a.Element.ElementBase;a.Element.MISSING=function(c){a.log("ERROR: Element '"+c.nodeName+"' not yet implemented.")};a.Element.MISSING.prototype=new a.Element.ElementBase;a.CreateElement=function(c){var b=c.nodeName.replace(/^[^:]+:/,""),
b=b.replace(/\-/g,""),b="undefined"!=typeof a.Element[b]?new a.Element[b](c):new a.Element.MISSING(c);b.type=c.nodeName;return b};a.load=function(c,b){a.loadXml(c,a.ajax(b))};a.loadXml=function(c,b){a.loadXmlDoc(c,a.parseXml(b))};a.loadXmlDoc=function(c,b){a.init(c);var e=function(a){for(var b=c.canvas;b;)a.x-=b.offsetLeft,a.y-=b.offsetTop,b=b.offsetParent;window.scrollX&&(a.x+=window.scrollX);window.scrollY&&(a.y+=window.scrollY);return a};1!=a.opts.ignoreMouse&&(c.canvas.onclick=function(b){b=e(new a.Point(null!=
b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onclick(b.x,b.y)},c.canvas.onmousemove=function(b){b=e(new a.Point(null!=b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onmousemove(b.x,b.y)});var d=a.CreateElement(b.documentElement);d.root=!0;d.addStylesFromStyleDefinition();var k=!0,f=function(){a.ViewPort.Clear();c.canvas.parentNode&&a.ViewPort.SetCurrent(c.canvas.parentNode.clientWidth,c.canvas.parentNode.clientHeight);1!=a.opts.ignoreDimensions&&(d.style("width").hasValue()&&
(c.canvas.width=d.style("width").toPixels("x"),c.canvas.style.width=c.canvas.width+"px"),d.style("height").hasValue()&&(c.canvas.height=d.style("height").toPixels("y"),c.canvas.style.height=c.canvas.height+"px"));var e=c.canvas.clientWidth||c.canvas.width,f=c.canvas.clientHeight||c.canvas.height;1==a.opts.ignoreDimensions&&d.style("width").hasValue()&&d.style("height").hasValue()&&(e=d.style("width").toPixels("x"),f=d.style("height").toPixels("y"));a.ViewPort.SetCurrent(e,f);null!=a.opts.offsetX&&
(d.attribute("x",!0).value=a.opts.offsetX);null!=a.opts.offsetY&&(d.attribute("y",!0).value=a.opts.offsetY);if(null!=a.opts.scaleWidth||null!=a.opts.scaleHeight){var g=null,h=null,l=a.ToNumberArray(d.attribute("viewBox").value);null!=a.opts.scaleWidth&&(d.attribute("width").hasValue()?g=d.attribute("width").toPixels("x")/a.opts.scaleWidth:isNaN(l[2])||(g=l[2]/a.opts.scaleWidth));null!=a.opts.scaleHeight&&(d.attribute("height").hasValue()?h=d.attribute("height").toPixels("y")/a.opts.scaleHeight:isNaN(l[3])||
(h=l[3]/a.opts.scaleHeight));null==g&&(g=h);null==h&&(h=g);d.attribute("width",!0).value=a.opts.scaleWidth;d.attribute("height",!0).value=a.opts.scaleHeight;d.style("transform",!0,!0).value+=" scale("+1/g+","+1/h+")"}1!=a.opts.ignoreClear&&c.clearRect(0,0,e,f);d.render(c);k&&(k=!1,"function"==typeof a.opts.renderCallback&&a.opts.renderCallback(b))},g=!0;a.ImagesLoaded()&&(g=!1,f());a.intervalID=setInterval(function(){var b=!1;g&&a.ImagesLoaded()&&(g=!1,b=!0);1!=a.opts.ignoreMouse&&(b|=a.Mouse.hasEvents());
if(1!=a.opts.ignoreAnimation)for(var c=0;c<a.Animations.length;c++)b|=a.Animations[c].update(1E3/a.FRAMERATE);"function"==typeof a.opts.forceRedraw&&1==a.opts.forceRedraw()&&(b=!0);b&&(f(),a.Mouse.runEvents())},1E3/a.FRAMERATE)};a.stop=function(){a.intervalID&&clearInterval(a.intervalID)};a.Mouse=new function(){this.events=[];this.hasEvents=function(){return 0!=this.events.length};this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){if(a.onclick)a.onclick()}})};this.onmousemove=
function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){if(a.onmousemove)a.onmousemove()}})};this.eventElements=[];this.checkPath=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[e]=a)}};this.checkBoundingBox=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInBox(d.x,d.y)&&(this.eventElements[e]=a)}};this.runEvents=function(){a.ctx.canvas.style.cursor="";for(var c=
0;c<this.events.length;c++)for(var b=this.events[c],e=this.eventElements[c];e;)b.run(e),e=e.parent;this.events=[];this.eventElements=[]}};return a}var O=function(h,a,l){if(null==h&&null==a&&null==l)for(a=document.querySelectorAll("svg"),h=0;h<a.length;h++){l=a[h];var c=document.createElement("canvas");c.width=l.clientWidth;c.height=l.clientHeight;l.parentNode.insertBefore(c,l);l.parentNode.removeChild(l);var b=document.createElement("div");b.appendChild(l);O(c,b.innerHTML)}else{"string"==typeof h&&
(h=document.getElementById(h));null!=h.svg&&h.svg.stop();l=X(l||{});if(1!=h.childNodes.length||"OBJECT"!=h.childNodes[0].nodeName)h.svg=l;h=h.getContext("2d");"undefined"!=typeof a.documentElement?l.loadXmlDoc(h,a):"<"==a.substr(0,1)?l.loadXml(h,a):l.load(h,a)}},L;if("undefined"!=typeof Element.prototype.matches)L=function(h,a){return h.matches(a)};else if("undefined"!=typeof Element.prototype.webkitMatchesSelector)L=function(h,a){return h.webkitMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.mozMatchesSelector)L=
function(h,a){return h.mozMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.msMatchesSelector)L=function(h,a){return h.msMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.oMatchesSelector)L=function(h,a){return h.oMatchesSelector(a)};else{if("function"===typeof jQuery||"function"===typeof Zepto)L=function(h,a){return $(h).is(a)};"undefined"===typeof L&&(L=Sizzle.matchesSelector)}var W=/(\[[^\]]+\])/g,M=/(#[^\s\+>~\.\[:]+)/g,u=/(\.[^\s\+>~\.\[:]+)/g,B=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,
p=/(:[\w-]+\([^\)]*\))/gi,C=/(:[^\s\+>~\.\[:]+)/g,w=/([^\s\+>~\.\[:]+)/g;"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(h,a,l,c,b,e){a={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:a,offsetY:l,scaleWidth:c,scaleHeight:b};for(var d in e)e.hasOwnProperty(d)&&(a[d]=e[d]);O(this.canvas,h,a)});return O});

/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}}(function(){return function s(a,o,h){function u(r,e){if(!o[r]){if(!a[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[r]={exports:{}};a[r][0].call(i.exports,function(e){var t=a[r][1][e];return u(t||e)},i,i.exports,s,a,o,h)}return o[r].exports}for(var l="function"==typeof require&&require,e=0;e<h.length;e++)u(h[e]);return u}({1:[function(e,t,r){"use strict";var d=e("./utils"),c=e("./support"),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,n,i,s,a,o,h=[],u=0,l=e.length,f=l,c="string"!==d.getTypeOf(e);u<e.length;)f=l-u,n=c?(t=e[u++],r=u<l?e[u++]:0,u<l?e[u++]:0):(t=e.charCodeAt(u++),r=u<l?e.charCodeAt(u++):0,u<l?e.charCodeAt(u++):0),i=t>>2,s=(3&t)<<4|r>>4,a=1<f?(15&r)<<2|n>>6:64,o=2<f?63&n:64,h.push(p.charAt(i)+p.charAt(s)+p.charAt(a)+p.charAt(o));return h.join("")},r.decode=function(e){var t,r,n,i,s,a,o=0,h=0,u="data:";if(e.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var l,f=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===p.charAt(64)&&f--,e.charAt(e.length-2)===p.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(l=c.uint8array?new Uint8Array(0|f):new Array(0|f);o<e.length;)t=p.indexOf(e.charAt(o++))<<2|(i=p.indexOf(e.charAt(o++)))>>4,r=(15&i)<<4|(s=p.indexOf(e.charAt(o++)))>>2,n=(3&s)<<6|(a=p.indexOf(e.charAt(o++))),l[h++]=t,64!==s&&(l[h++]=r),64!==a&&(l[h++]=n);return l}},{"./support":30,"./utils":32}],2:[function(e,t,r){"use strict";var n=e("./external"),i=e("./stream/DataWorker"),s=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");function o(e,t,r,n,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=n,this.compressedContent=i}o.prototype={getContentWorker:function(){var e=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(e,t,r){return e.pipe(new s).pipe(new a("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},t.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){"use strict";var n=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){"use strict";var n=e("./utils");var o=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==n.getTypeOf(e)?function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){"use strict";var n=null;n="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:n}},{lie:37}],7:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),s=e("./utils"),a=e("./stream/GenericWorker"),o=n?"uint8array":"array";function h(e,t){a.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic="\b\0",s.inherits(h,a),h.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,e.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},r.compressWorker=function(e){return new h("Deflate",e)},r.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){"use strict";function A(e,t){var r,n="";for(r=0;r<t;r++)n+=String.fromCharCode(255&e),e>>>=8;return n}function n(e,t,r,n,i,s){var a,o,h=e.file,u=e.compression,l=s!==O.utf8encode,f=I.transformTo("string",s(h.name)),c=I.transformTo("string",O.utf8encode(h.name)),d=h.comment,p=I.transformTo("string",s(d)),m=I.transformTo("string",O.utf8encode(d)),_=c.length!==h.name.length,g=m.length!==d.length,b="",v="",y="",w=h.dir,k=h.date,x={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(x.crc32=e.crc32,x.compressedSize=e.compressedSize,x.uncompressedSize=e.uncompressedSize);var S=0;t&&(S|=8),l||!_&&!g||(S|=2048);var z=0,C=0;w&&(z|=16),"UNIX"===i?(C=798,z|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(h.unixPermissions,w)):(C=20,z|=function(e){return 63&(e||0)}(h.dosPermissions)),a=k.getUTCHours(),a<<=6,a|=k.getUTCMinutes(),a<<=5,a|=k.getUTCSeconds()/2,o=k.getUTCFullYear()-1980,o<<=4,o|=k.getUTCMonth()+1,o<<=5,o|=k.getUTCDate(),_&&(v=A(1,1)+A(B(f),4)+c,b+="up"+A(v.length,2)+v),g&&(y=A(1,1)+A(B(p),4)+m,b+="uc"+A(y.length,2)+y);var E="";return E+="\n\0",E+=A(S,2),E+=u.magic,E+=A(a,2),E+=A(o,2),E+=A(x.crc32,4),E+=A(x.compressedSize,4),E+=A(x.uncompressedSize,4),E+=A(f.length,2),E+=A(b.length,2),{fileRecord:R.LOCAL_FILE_HEADER+E+f+b,dirRecord:R.CENTRAL_FILE_HEADER+A(C,2)+E+A(p.length,2)+"\0\0\0\0"+A(z,4)+A(n,4)+f+b+p}}var I=e("../utils"),i=e("../stream/GenericWorker"),O=e("../utf8"),B=e("../crc32"),R=e("../signature");function s(e,t,r,n){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}I.inherits(s,i),s.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-n-1))/r:100}}))},s.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=n(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},s.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=n(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return R.DATA_DESCRIPTOR+A(e.crc32,4)+A(e.compressedSize,4)+A(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},s.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,n=function(e,t,r,n,i){var s=I.transformTo("string",i(n));return R.CENTRAL_DIRECTORY_END+"\0\0\0\0"+A(e,2)+A(e,2)+A(t,4)+A(r,4)+A(s.length,2)+s}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},s.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},s.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},s.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},s.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=s},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){"use strict";var u=e("../compressions"),n=e("./ZipFileWorker");r.generateWorker=function(e,a,t){var o=new n(a.streamFiles,t,a.platform,a.encodeFileName),h=0;try{e.forEach(function(e,t){h++;var r=function(e,t){var r=e||t,n=u[r];if(!n)throw new Error(r+" is not a valid compression method !");return n}(t.options.compression,a.compression),n=t.options.compressionOptions||a.compressionOptions||{},i=t.dir,s=t.date;t._compressWorker(r,n).withStreamInfo("file",{name:e,dir:i,date:s,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(o)}),o.entriesCount=h}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(n.prototype=e("./object")).loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.10.1",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e("./external"),t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){"use strict";var u=e("./utils"),i=e("./external"),n=e("./utf8"),s=e("./zipEntries"),a=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function f(n){return new i.Promise(function(e,t){var r=n.decompressed.getContentWorker().pipe(new a);r.on("error",function(e){t(e)}).on("end",function(){r.streamInfo.crc32!==n.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}t.exports=function(e,o){var h=this;return o=u.extend(o||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),l.isNode&&l.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):u.prepareContent("the loaded zip file",e,!0,o.optimizedBinaryString,o.base64).then(function(e){var t=new s(o);return t.load(e),t}).then(function(e){var t=[i.Promise.resolve(e)],r=e.files;if(o.checkCRC32)for(var n=0;n<r.length;n++)t.push(f(r[n]));return i.Promise.all(t)}).then(function(e){for(var t=e.shift(),r=t.files,n=0;n<r.length;n++){var i=r[n],s=i.fileNameStr,a=u.resolve(i.fileNameStr);h.file(a,i.decompressed,{binary:!0,optimizedBinaryString:!0,date:i.date,dir:i.dir,comment:i.fileCommentStr.length?i.fileCommentStr:null,unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions,createFolders:o.createFolders}),i.dir||(h.file(a).unsafeOriginalName=s)}return t.zipComment.length&&(h.comment=t.zipComment),h})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../stream/GenericWorker");function s(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}n.inherits(s,i),s.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){"use strict";var i=e("readable-stream").Readable;function n(e,t,r){i.call(this,t),this._helper=e;var n=this;e.on("data",function(e,t){n.push(e)||n._helper.pause(),r&&r(t)}).on("error",function(e){n.emit("error",e)}).on("end",function(){n.push(null)})}e("../utils").inherits(n,i),n.prototype._read=function(){this._helper.resume()},t.exports=n},{"../utils":32,"readable-stream":16}],14:[function(e,t,r){"use strict";t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,r){"use strict";function s(e,t,r){var n,i=u.getTypeOf(t),s=u.extend(r||{},f);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(e=g(e)),s.createFolders&&(n=_(e))&&b.call(this,n,!0);var a="string"===i&&!1===s.binary&&!1===s.base64;r&&void 0!==r.binary||(s.binary=!a),(t instanceof c&&0===t.uncompressedSize||s.dir||!t||0===t.length)&&(s.base64=!1,s.binary=!0,t="",s.compression="STORE",i="string");var o=null;o=t instanceof c||t instanceof l?t:p.isNode&&p.isStream(t)?new m(e,t):u.prepareContent(e,t,s.binary,s.optimizedBinaryString,s.base64);var h=new d(e,o,s);this.files[e]=h}var i=e("./utf8"),u=e("./utils"),l=e("./stream/GenericWorker"),a=e("./stream/StreamHelper"),f=e("./defaults"),c=e("./compressedObject"),d=e("./zipObject"),o=e("./generate"),p=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),_=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},b=function(e,t){return t=void 0!==t?t:f.createFolders,e=g(e),this.files[e]||s.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function h(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var n={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,n;for(t in this.files)n=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,n)},filter:function(r){var n=[];return this.forEach(function(e,t){r(e,t)&&n.push(t)}),n},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,s.call(this,e,t,r),this;if(h(e)){var n=e;return this.filter(function(e,t){return!t.dir&&n.test(e)})}var i=this.files[this.root+e];return i&&!i.dir?i:null},folder:function(r){if(!r)return this;if(h(r))return this.filter(function(e,t){return t.dir&&r.test(e)});var e=this.root+r,t=b.call(this,e),n=this.clone();return n.root=t.name,n},remove:function(r){r=this.root+r;var e=this.files[r];if(e||("/"!==r.slice(-1)&&(r+="/"),e=this.files[r]),e&&!e.dir)delete this.files[r];else for(var t=this.filter(function(e,t){return t.name.slice(0,r.length)===r}),n=0;n<t.length;n++)delete this.files[t[n].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=u.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");u.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var n=r.comment||this.comment||"";t=o.generateWorker(this,r,n)}catch(e){(t=new l("error")).error(e)}return new a(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=n},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){"use strict";t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===t&&this.data[s+1]===r&&this.data[s+2]===n&&this.data[s+3]===i)return s-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&r===s[1]&&n===s[2]&&i===s[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){"use strict";var n=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,r){"use strict";var n=e("./Uint8ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){"use strict";var n=e("./ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../support"),s=e("./ArrayReader"),a=e("./StringReader"),o=e("./NodeBufferReader"),h=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new o(e):i.uint8array?new h(n.transformTo("uint8array",e)):new s(n.transformTo("array",e)):new a(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../utils");function s(e){n.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(s,n),s.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../crc32");function s(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,n),s.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function s(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}n.inherits(s,i),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function s(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}n.inherits(s,i),s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){"use strict";function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=n},{}],29:[function(e,t,r){"use strict";var h=e("../utils"),i=e("./ConvertWorker"),s=e("./GenericWorker"),u=e("../base64"),n=e("../support"),a=e("../external"),o=null;if(n.nodestream)try{o=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function l(e,o){return new a.Promise(function(t,r){var n=[],i=e._internalType,s=e._outputType,a=e._mimeType;e.on("data",function(e,t){n.push(e),o&&o(t)}).on("error",function(e){n=[],r(e)}).on("end",function(){try{var e=function(e,t,r){switch(e){case"blob":return h.newBlob(h.transformTo("arraybuffer",t),r);case"base64":return u.encode(t);default:return h.transformTo(e,t)}}(s,function(e,t){var r,n=0,i=null,s=0;for(r=0;r<t.length;r++)s+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(s),r=0;r<t.length;r++)i.set(t[r],n),n+=t[r].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(i,n),a);t(e)}catch(e){r(e)}n=[]}).resume()})}function f(e,t,r){var n=t;switch(t){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=t,this._mimeType=r,h.checkSupport(n),this._worker=e.pipe(new i(n)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}f.prototype={accumulate:function(e){return l(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,function(e){t.call(r,e.data,e.meta)}):this._worker.on(e,function(){h.delay(t,arguments,r)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(h.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new o(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer="undefined"!=typeof Buffer,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=0===new Blob([n],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),r.blob=0===i.getBlob("application/zip").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch(e){r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,s){"use strict";for(var o=e("./utils"),h=e("./support"),r=e("./nodejsUtils"),n=e("./stream/GenericWorker"),u=new Array(256),i=0;i<256;i++)u[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;u[254]=u[254]=1;function a(){n.call(this,"utf-8 decode"),this.leftOver=null}function l(){n.call(this,"utf-8 encode")}s.utf8encode=function(e){return h.nodebuffer?r.newBufferFrom(e,"utf-8"):function(e){var t,r,n,i,s,a=e.length,o=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=h.uint8array?new Uint8Array(o):new Array(o),i=s=0;s<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t}(e)},s.utf8decode=function(e){return h.nodebuffer?o.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,n,i,s=e.length,a=new Array(2*s);for(t=r=0;t<s;)if((n=e[t++])<128)a[r++]=n;else if(4<(i=u[n]))a[r++]=65533,t+=i-1;else{for(n&=2===i?31:3===i?15:7;1<i&&t<s;)n=n<<6|63&e[t++],i--;1<i?a[r++]=65533:n<65536?a[r++]=n:(n-=65536,a[r++]=55296|n>>10&1023,a[r++]=56320|1023&n)}return a.length!==r&&(a.subarray?a=a.subarray(0,r):a.length=r),o.applyFromCharCode(a)}(e=o.transformTo(h.uint8array?"uint8array":"array",e))},o.inherits(a,n),a.prototype.processChunk=function(e){var t=o.transformTo(h.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(h.uint8array){var r=t;(t=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var n=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+u[e[r]]>t?r:t}(t),i=t;n!==t.length&&(h.uint8array?(i=t.subarray(0,n),this.leftOver=t.subarray(n,t.length)):(i=t.slice(0,n),this.leftOver=t.slice(n,t.length))),this.push({data:s.utf8decode(i),meta:e.meta})},a.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=a,o.inherits(l,n),l.prototype.processChunk=function(e){this.push({data:s.utf8encode(e.data),meta:e.meta})},s.Utf8EncodeWorker=l},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,a){"use strict";var o=e("./support"),h=e("./base64"),r=e("./nodejsUtils"),u=e("./external");function n(e){return e}function l(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}e("setimmediate"),a.newBlob=function(t,r){a.checkSupport("blob");try{return new Blob([t],{type:r})}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(r)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var i={stringifyByChunk:function(e,t,r){var n=[],i=0,s=e.length;if(s<=r)return String.fromCharCode.apply(null,e);for(;i<s;)"array"===t||"nodebuffer"===t?n.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+r,s)))):n.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+r,s)))),i+=r;return n.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&1===String.fromCharCode.apply(null,r.allocBuffer(1)).length}catch(e){return!1}}()}};function s(e){var t=65536,r=a.getTypeOf(e),n=!0;if("uint8array"===r?n=i.applyCanBeUsed.uint8array:"nodebuffer"===r&&(n=i.applyCanBeUsed.nodebuffer),n)for(;1<t;)try{return i.stringifyByChunk(e,r,t)}catch(e){t=Math.floor(t/2)}return i.stringifyByChar(e)}function f(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}a.applyFromCharCode=s;var c={};c.string={string:n,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return c.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,r.allocBuffer(e.length))}},c.array={string:s,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(e)}},c.arraybuffer={string:function(e){return s(new Uint8Array(e))},array:function(e){return f(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(new Uint8Array(e))}},c.uint8array={string:s,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return r.newBufferFrom(e)}},c.nodebuffer={string:s,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return c.nodebuffer.uint8array(e).buffer},uint8array:function(e){return f(e,new Uint8Array(e.length))},nodebuffer:n},a.transformTo=function(e,t){if(t=t||"",!e)return t;a.checkSupport(e);var r=a.getTypeOf(t);return c[r][e](t)},a.resolve=function(e){for(var t=e.split("/"),r=[],n=0;n<t.length;n++){var i=t[n];"."===i||""===i&&0!==n&&n!==t.length-1||(".."===i?r.pop():r.push(i))}return r.join("/")},a.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":o.nodebuffer&&r.isBuffer(e)?"nodebuffer":o.uint8array&&e instanceof Uint8Array?"uint8array":o.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(e){if(!o[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)n+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return n},a.delay=function(e,t,r){setImmediate(function(){e.apply(r||null,t||[])})},a.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},a.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},a.prepareContent=function(r,e,n,i,s){return u.Promise.resolve(e).then(function(n){return o.blob&&(n instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(n)))&&"undefined"!=typeof FileReader?new u.Promise(function(t,r){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){r(e.target.error)},e.readAsArrayBuffer(n)}):n}).then(function(e){var t=a.getTypeOf(e);return t?("arraybuffer"===t?e=a.transformTo("uint8array",e):"string"===t&&(s?e=h.decode(e):n&&!0!==i&&(e=function(e){return l(e,o.uint8array?new Uint8Array(e.length):new Array(e.length))}(e))),e):u.Promise.reject(new Error("Can't read the data of '"+r+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),i=e("./utils"),s=e("./signature"),a=e("./zipEntry"),o=e("./support");function h(e){this.files=[],this.loadOptions=e}h.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4)===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?"uint8array":"array",r=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=t-r;if(0<n)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),s=e("./utils"),i=e("./compressedObject"),a=e("./crc32"),o=e("./utf8"),h=e("./compressions"),u=e("./support");function l(e,t){this.options=e,this.loadOptions=t}l.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in h)if(Object.prototype.hasOwnProperty.call(h,t)&&h[t].magic===e)return h[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),r=e.readInt(2),n=e.readData(r),this.extraFields[t]={id:t,length:r,value:n};e.setIndex(i)},handleUTF8:function(){var e=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=s.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var i=s.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(i)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:a(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:a(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null}},t.exports=l},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){"use strict";function n(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var s=e("./stream/StreamHelper"),i=e("./stream/DataWorker"),a=e("./utf8"),o=e("./compressedObject"),h=e("./stream/GenericWorker");n.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var n="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var i=!this._dataBinary;i&&!n&&(t=t.pipe(new a.Utf8EncodeWorker)),!i&&n&&(t=t.pipe(new a.Utf8DecodeWorker))}catch(e){(t=new h("error")).error(e)}return new s(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof h?this._data:new i(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<u.length;f++)n.prototype[u[f]]=l;t.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,l,t){(function(t){"use strict";var r,n,e=t.MutationObserver||t.WebKitMutationObserver;if(e){var i=0,s=new e(u),a=t.document.createTextNode("");s.observe(a,{characterData:!0}),r=function(){a.data=i=++i%2}}else if(t.setImmediate||void 0===t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var o=new t.MessageChannel;o.port1.onmessage=u,r=function(){o.port2.postMessage(0)}}var h=[];function u(){var e,t;n=!0;for(var r=h.length;r;){for(t=h,h=[],e=-1;++e<r;)t[e]();r=h.length}n=!1}l.exports=function(e){1!==h.push(e)||n||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,r){"use strict";var i=e("immediate");function u(){}var l={},s=["REJECTED"],a=["FULFILLED"],n=["PENDING"];function o(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=n,this.queue=[],this.outcome=void 0,e!==u&&d(this,e)}function h(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function f(t,r,n){i(function(){var e;try{e=r(n)}catch(e){return l.reject(t,e)}e===t?l.reject(t,new TypeError("Cannot resolve promise with itself")):l.resolve(t,e)})}function c(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(t,e){var r=!1;function n(e){r||(r=!0,l.reject(t,e))}function i(e){r||(r=!0,l.resolve(t,e))}var s=p(function(){e(i,n)});"error"===s.status&&n(s.value)}function p(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=o).prototype.finally=function(t){if("function"!=typeof t)return this;var r=this.constructor;return this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})})},o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var r=new this.constructor(u);this.state!==n?f(r,this.state===a?e:t,this.outcome):this.queue.push(new h(r,e,t));return r},h.prototype.callFulfilled=function(e){l.resolve(this.promise,e)},h.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},h.prototype.callRejected=function(e){l.reject(this.promise,e)},h.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},l.resolve=function(e,t){var r=p(c,t);if("error"===r.status)return l.reject(e,r.value);var n=r.value;if(n)d(e,n);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},l.reject=function(e,t){e.state=s,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},o.resolve=function(e){if(e instanceof this)return e;return l.resolve(new this(u),e)},o.reject=function(e){var t=new this(u);return l.reject(t,e)},o.all=function(e){var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var s=new Array(n),a=0,t=-1,o=new this(u);for(;++t<n;)h(e[t],t);return o;function h(e,t){r.resolve(e).then(function(e){s[t]=e,++a!==n||i||(i=!0,l.resolve(o,s))},function(e){i||(i=!0,l.reject(o,e))})}},o.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);var i=-1,s=new this(u);for(;++i<r;)a=e[i],t.resolve(a).then(function(e){n||(n=!0,l.resolve(s,e))},function(e){n||(n=!0,l.reject(s,e))});var a;return s}},{immediate:36}],38:[function(e,t,r){"use strict";var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){"use strict";var a=e("./zlib/deflate"),o=e("./utils/common"),h=e("./utils/strings"),i=e("./zlib/messages"),s=e("./zlib/zstream"),u=Object.prototype.toString,l=0,f=-1,c=0,d=8;function p(e){if(!(this instanceof p))return new p(e);this.options=o.assign({level:f,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==l)throw new Error(i[r]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?h.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=a.deflateSetDictionary(this.strm,n))!==l)throw new Error(i[r]);this._dict_set=!0}}function n(e,t){var r=new p(t);if(r.push(e,!0),r.err)throw r.msg||i[r.err];return r.result}p.prototype.push=function(e,t){var r,n,i=this.strm,s=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=h.string2buf(e):"[object ArrayBuffer]"===u.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new o.Buf8(s),i.next_out=0,i.avail_out=s),1!==(r=a.deflate(i,n))&&r!==l)return this.onEnd(r),!(this.ended=!0);0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(h.buf2binstring(o.shrinkBuf(i.output,i.next_out))):this.onData(o.shrinkBuf(i.output,i.next_out)))}while((0<i.avail_in||0===i.avail_out)&&1!==r);return 4===n?(r=a.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===l):2!==n||(this.onEnd(l),!(i.avail_out=0))},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=p,r.deflate=n,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){"use strict";var c=e("./zlib/inflate"),d=e("./utils/common"),p=e("./utils/strings"),m=e("./zlib/constants"),n=e("./zlib/messages"),i=e("./zlib/zstream"),s=e("./zlib/gzheader"),_=Object.prototype.toString;function a(e){if(!(this instanceof a))return new a(e);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var r=c.inflateInit2(this.strm,t.windowBits);if(r!==m.Z_OK)throw new Error(n[r]);this.header=new s,c.inflateGetHeader(this.strm,this.header)}function o(e,t){var r=new a(t);if(r.push(e,!0),r.err)throw r.msg||n[r.err];return r.result}a.prototype.push=function(e,t){var r,n,i,s,a,o,h=this.strm,u=this.options.chunkSize,l=this.options.dictionary,f=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?m.Z_FINISH:m.Z_NO_FLUSH,"string"==typeof e?h.input=p.binstring2buf(e):"[object ArrayBuffer]"===_.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new d.Buf8(u),h.next_out=0,h.avail_out=u),(r=c.inflate(h,m.Z_NO_FLUSH))===m.Z_NEED_DICT&&l&&(o="string"==typeof l?p.string2buf(l):"[object ArrayBuffer]"===_.call(l)?new Uint8Array(l):l,r=c.inflateSetDictionary(this.strm,o)),r===m.Z_BUF_ERROR&&!0===f&&(r=m.Z_OK,f=!1),r!==m.Z_STREAM_END&&r!==m.Z_OK)return this.onEnd(r),!(this.ended=!0);h.next_out&&(0!==h.avail_out&&r!==m.Z_STREAM_END&&(0!==h.avail_in||n!==m.Z_FINISH&&n!==m.Z_SYNC_FLUSH)||("string"===this.options.to?(i=p.utf8border(h.output,h.next_out),s=h.next_out-i,a=p.buf2string(h.output,i),h.next_out=s,h.avail_out=u-s,s&&d.arraySet(h.output,h.output,i,s,0),this.onData(a)):this.onData(d.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(f=!0)}while((0<h.avail_in||0===h.avail_out)&&r!==m.Z_STREAM_END);return r===m.Z_STREAM_END&&(n=m.Z_FINISH),n===m.Z_FINISH?(r=c.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===m.Z_OK):n!==m.Z_SYNC_FLUSH||(this.onEnd(m.Z_OK),!(h.avail_out=0))},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===m.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=a,r.inflate=o,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},r.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){var t,r,n,i,s,a;for(t=n=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),t=i=0,r=e.length;t<r;t++)s=e[t],a.set(s,i),i+=s.length;return a}},s={arraySet:function(e,t,r,n,i){for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)},{}],42:[function(e,t,r){"use strict";var h=e("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var u=new h.Buf8(256),n=0;n<256;n++)u[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function l(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&i))return String.fromCharCode.apply(null,h.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}u[254]=u[254]=1,r.string2buf=function(e){var t,r,n,i,s,a=e.length,o=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new h.Buf8(o),i=s=0;s<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t},r.buf2binstring=function(e){return l(e,e.length)},r.binstring2buf=function(e){for(var t=new h.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,i,s,a=t||e.length,o=new Array(2*a);for(r=n=0;r<a;)if((i=e[r++])<128)o[n++]=i;else if(4<(s=u[i]))o[n++]=65533,r+=s-1;else{for(i&=2===s?31:3===s?15:7;1<s&&r<a;)i=i<<6|63&e[r++],s--;1<s?o[n++]=65533:i<65536?o[n++]=i:(i-=65536,o[n++]=55296|i>>10&1023,o[n++]=56320|1023&i)}return l(o,n)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+u[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,s=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(i=i+t[n++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16|0}},{}],44:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){"use strict";var o=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}},{}],46:[function(e,t,r){"use strict";var h,c=e("../utils/common"),u=e("./trees"),d=e("./adler32"),p=e("./crc32"),n=e("./messages"),l=0,f=4,m=0,_=-2,g=-1,b=4,i=2,v=8,y=9,s=286,a=30,o=19,w=2*s+1,k=15,x=3,S=258,z=S+x+1,C=42,E=113,A=1,I=2,O=3,B=4;function R(e,t){return e.msg=n[t],t}function T(e){return(e<<1)-(4<e?9:0)}function D(e){for(var t=e.length;0<=--t;)e[t]=0}function F(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(c.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function N(e,t){u._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,F(e.strm)}function U(e,t){e.pending_buf[e.pending++]=t}function P(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function L(e,t){var r,n,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,h=e.strstart>e.w_size-z?e.strstart-(e.w_size-z):0,u=e.window,l=e.w_mask,f=e.prev,c=e.strstart+S,d=u[s+a-1],p=u[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(u[(r=t)+a]===p&&u[r+a-1]===d&&u[r]===u[s]&&u[++r]===u[s+1]){s+=2,r++;do{}while(u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&s<c);if(n=S-(c-s),s=c-S,a<n){if(e.match_start=t,o<=(a=n))break;d=u[s+a-1],p=u[s+a]}}}while((t=f[t&l])>h&&0!=--i);return a<=e.lookahead?a:e.lookahead}function j(e){var t,r,n,i,s,a,o,h,u,l,f=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-z)){for(c.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=r=e.hash_size;n=e.head[--t],e.head[t]=f<=n?n-f:0,--r;);for(t=r=f;n=e.prev[--t],e.prev[t]=f<=n?n-f:0,--r;);i+=f}if(0===e.strm.avail_in)break;if(a=e.strm,o=e.window,h=e.strstart+e.lookahead,u=i,l=void 0,l=a.avail_in,u<l&&(l=u),r=0===l?0:(a.avail_in-=l,c.arraySet(o,a.input,a.next_in,l,h),1===a.state.wrap?a.adler=d(a.adler,o,l,h):2===a.state.wrap&&(a.adler=p(a.adler,o,l,h)),a.next_in+=l,a.total_in+=l,l),e.lookahead+=r,e.lookahead+e.insert>=x)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+x-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<x)););}while(e.lookahead<z&&0!==e.strm.avail_in)}function Z(e,t){for(var r,n;;){if(e.lookahead<z){if(j(e),e.lookahead<z&&t===l)return A;if(0===e.lookahead)break}if(r=0,e.lookahead>=x&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-z&&(e.match_length=L(e,r)),e.match_length>=x)if(n=u._tr_tally(e,e.strstart-e.match_start,e.match_length-x),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=x){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=e.strstart<x-1?e.strstart:x-1,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}function W(e,t){for(var r,n,i;;){if(e.lookahead<z){if(j(e),e.lookahead<z&&t===l)return A;if(0===e.lookahead)break}if(r=0,e.lookahead>=x&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=x-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-z&&(e.match_length=L(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===x&&4096<e.strstart-e.match_start)&&(e.match_length=x-1)),e.prev_length>=x&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-x,n=u._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-x),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=x-1,e.strstart++,n&&(N(e,!1),0===e.strm.avail_out))return A}else if(e.match_available){if((n=u._tr_tally(e,0,e.window[e.strstart-1]))&&N(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return A}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=u._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<x-1?e.strstart:x-1,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}function M(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new c.Buf16(2*w),this.dyn_dtree=new c.Buf16(2*(2*a+1)),this.bl_tree=new c.Buf16(2*(2*o+1)),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new c.Buf16(k+1),this.heap=new c.Buf16(2*s+1),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new c.Buf16(2*s+1),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function G(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=i,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?C:E,e.adler=2===t.wrap?0:1,t.last_flush=l,u._tr_init(t),m):R(e,_)}function K(e){var t=G(e);return t===m&&function(e){e.window_size=2*e.w_size,D(e.head),e.max_lazy_match=h[e.level].max_lazy,e.good_match=h[e.level].good_length,e.nice_match=h[e.level].nice_length,e.max_chain_length=h[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=x-1,e.match_available=0,e.ins_h=0}(e.state),t}function Y(e,t,r,n,i,s){if(!e)return _;var a=1;if(t===g&&(t=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||y<i||r!==v||n<8||15<n||t<0||9<t||s<0||b<s)return R(e,_);8===n&&(n=9);var o=new H;return(e.state=o).strm=e,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+x-1)/x),o.window=new c.Buf8(2*o.w_size),o.head=new c.Buf16(o.hash_size),o.prev=new c.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new c.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=s,o.method=r,K(e)}h=[new M(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(j(e),0===e.lookahead&&t===l)return A;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,N(e,!1),0===e.strm.avail_out))return A;if(e.strstart-e.block_start>=e.w_size-z&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=0,t===f?(N(e,!0),0===e.strm.avail_out?O:B):(e.strstart>e.block_start&&(N(e,!1),e.strm.avail_out),A)}),new M(4,4,8,4,Z),new M(4,5,16,8,Z),new M(4,6,32,32,Z),new M(4,4,16,16,W),new M(8,16,32,32,W),new M(8,16,128,128,W),new M(8,32,128,256,W),new M(32,128,258,1024,W),new M(32,258,258,4096,W)],r.deflateInit=function(e,t){return Y(e,t,v,15,8,0)},r.deflateInit2=Y,r.deflateReset=K,r.deflateResetKeep=G,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?_:(e.state.gzhead=t,m):_},r.deflate=function(e,t){var r,n,i,s;if(!e||!e.state||5<t||t<0)return e?R(e,_):_;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==f)return R(e,0===e.avail_out?-5:_);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===C)if(2===n.wrap)e.adler=0,U(n,31),U(n,139),U(n,8),n.gzhead?(U(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),U(n,255&n.gzhead.time),U(n,n.gzhead.time>>8&255),U(n,n.gzhead.time>>16&255),U(n,n.gzhead.time>>24&255),U(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),U(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(U(n,255&n.gzhead.extra.length),U(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=p(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(U(n,0),U(n,0),U(n,0),U(n,0),U(n,0),U(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),U(n,3),n.status=E);else{var a=v+(n.w_bits-8<<4)<<8;a|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=E,P(n,a),0!==n.strstart&&(P(n,e.adler>>>16),P(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),F(e),i=n.pending,n.pending!==n.pending_buf_size));)U(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),F(e),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,U(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),F(e),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,U(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&F(e),n.pending+2<=n.pending_buf_size&&(U(n,255&e.adler),U(n,e.adler>>8&255),e.adler=0,n.status=E)):n.status=E),0!==n.pending){if(F(e),0===e.avail_out)return n.last_flush=-1,m}else if(0===e.avail_in&&T(t)<=T(r)&&t!==f)return R(e,-5);if(666===n.status&&0!==e.avail_in)return R(e,-5);if(0!==e.avail_in||0!==n.lookahead||t!==l&&666!==n.status){var o=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(j(e),0===e.lookahead)){if(t===l)return A;break}if(e.match_length=0,r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=0,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}(n,t):3===n.strategy?function(e,t){for(var r,n,i,s,a=e.window;;){if(e.lookahead<=S){if(j(e),e.lookahead<=S&&t===l)return A;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=x&&0<e.strstart&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){s=e.strstart+S;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<s);e.match_length=S-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=x?(r=u._tr_tally(e,1,e.match_length-x),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=0,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}(n,t):h[n.level].func(n,t);if(o!==O&&o!==B||(n.status=666),o===A||o===O)return 0===e.avail_out&&(n.last_flush=-1),m;if(o===I&&(1===t?u._tr_align(n):5!==t&&(u._tr_stored_block(n,0,0,!1),3===t&&(D(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),F(e),0===e.avail_out))return n.last_flush=-1,m}return t!==f?m:n.wrap<=0?1:(2===n.wrap?(U(n,255&e.adler),U(n,e.adler>>8&255),U(n,e.adler>>16&255),U(n,e.adler>>24&255),U(n,255&e.total_in),U(n,e.total_in>>8&255),U(n,e.total_in>>16&255),U(n,e.total_in>>24&255)):(P(n,e.adler>>>16),P(n,65535&e.adler)),F(e),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?m:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==C&&69!==t&&73!==t&&91!==t&&103!==t&&t!==E&&666!==t?R(e,_):(e.state=null,t===E?R(e,-3):m):_},r.deflateSetDictionary=function(e,t){var r,n,i,s,a,o,h,u,l=t.length;if(!e||!e.state)return _;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==C||r.lookahead)return _;for(1===s&&(e.adler=d(e.adler,t,l,0)),r.wrap=0,l>=r.w_size&&(0===s&&(D(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new c.Buf8(r.w_size),c.arraySet(u,t,l-r.w_size,r.w_size,0),t=u,l=r.w_size),a=e.avail_in,o=e.next_in,h=e.input,e.avail_in=l,e.next_in=0,e.input=t,j(r);r.lookahead>=x;){for(n=r.strstart,i=r.lookahead-(x-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+x-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--i;);r.strstart=n,r.lookahead=x-1,j(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=x-1,r.match_available=0,e.next_in=o,e.input=h,e.avail_in=a,r.wrap=s,m},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,i,s,a,o,h,u,l,f,c,d,p,m,_,g,b,v,y,w,k,x,S,z,C;r=e.state,n=e.next_in,z=e.input,i=n+(e.avail_in-5),s=e.next_out,C=e.output,a=s-(t-e.avail_out),o=s+(e.avail_out-257),h=r.dmax,u=r.wsize,l=r.whave,f=r.wnext,c=r.window,d=r.hold,p=r.bits,m=r.lencode,_=r.distcode,g=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;e:do{p<15&&(d+=z[n++]<<p,p+=8,d+=z[n++]<<p,p+=8),v=m[d&g];t:for(;;){if(d>>>=y=v>>>24,p-=y,0===(y=v>>>16&255))C[s++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=m[(65535&v)+(d&(1<<y)-1)];continue t}if(32&y){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}w=65535&v,(y&=15)&&(p<y&&(d+=z[n++]<<p,p+=8),w+=d&(1<<y)-1,d>>>=y,p-=y),p<15&&(d+=z[n++]<<p,p+=8,d+=z[n++]<<p,p+=8),v=_[d&b];r:for(;;){if(d>>>=y=v>>>24,p-=y,!(16&(y=v>>>16&255))){if(0==(64&y)){v=_[(65535&v)+(d&(1<<y)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(k=65535&v,p<(y&=15)&&(d+=z[n++]<<p,(p+=8)<y&&(d+=z[n++]<<p,p+=8)),h<(k+=d&(1<<y)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(d>>>=y,p-=y,(y=s-a)<k){if(l<(y=k-y)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(S=c,(x=0)===f){if(x+=u-y,y<w){for(w-=y;C[s++]=c[x++],--y;);x=s-k,S=C}}else if(f<y){if(x+=u+f-y,(y-=f)<w){for(w-=y;C[s++]=c[x++],--y;);if(x=0,f<w){for(w-=y=f;C[s++]=c[x++],--y;);x=s-k,S=C}}}else if(x+=f-y,y<w){for(w-=y;C[s++]=c[x++],--y;);x=s-k,S=C}for(;2<w;)C[s++]=S[x++],C[s++]=S[x++],C[s++]=S[x++],w-=3;w&&(C[s++]=S[x++],1<w&&(C[s++]=S[x++]))}else{for(x=s-k;C[s++]=C[x++],C[s++]=C[x++],C[s++]=C[x++],2<(w-=3););w&&(C[s++]=C[x++],1<w&&(C[s++]=C[x++]))}break}}break}}while(n<i&&s<o);n-=w=p>>3,d&=(1<<(p-=w<<3))-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<o?o-s+257:257-(s-o),r.hold=d,r.bits=p}},{}],49:[function(e,t,r){"use strict";var I=e("../utils/common"),O=e("./adler32"),B=e("./crc32"),R=e("./inffast"),T=e("./inftrees"),D=1,F=2,N=0,U=-2,P=1,n=852,i=592;function L(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new I.Buf16(320),this.work=new I.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=P,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new I.Buf32(n),t.distcode=t.distdyn=new I.Buf32(i),t.sane=1,t.back=-1,N):U}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):U}function h(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?U:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):U}function u(e,t){var r,n;return e?(n=new s,(e.state=n).window=null,(r=h(e,t))!==N&&(e.state=null),r):U}var l,f,c=!0;function j(e){if(c){var t;for(l=new I.Buf32(512),f=new I.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(T(D,e.lens,0,288,l,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;T(F,e.lens,0,32,f,0,e.work,{bits:5}),c=!1}e.lencode=l,e.lenbits=9,e.distcode=f,e.distbits=5}function Z(e,t,r,n){var i,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new I.Buf8(s.wsize)),n>=s.wsize?(I.arraySet(s.window,t,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(n<(i=s.wsize-s.wnext)&&(i=n),I.arraySet(s.window,t,r-n,i,s.wnext),(n-=i)?(I.arraySet(s.window,t,r-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}r.inflateReset=o,r.inflateReset2=h,r.inflateResetKeep=a,r.inflateInit=function(e){return u(e,15)},r.inflateInit2=u,r.inflate=function(e,t){var r,n,i,s,a,o,h,u,l,f,c,d,p,m,_,g,b,v,y,w,k,x,S,z,C=0,E=new I.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return U;12===(r=e.state).mode&&(r.mode=13),a=e.next_out,i=e.output,h=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,f=o,c=h,x=N;e:for(;;)switch(r.mode){case P:if(0===r.wrap){r.mode=13;break}for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(2&r.wrap&&35615===u){E[r.check=0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0),l=u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&u)){e.msg="unknown compression method",r.mode=30;break}if(l-=4,k=8+(15&(u>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<k,e.adler=r.check=1,r.mode=512&u?10:12,l=u=0;break;case 2:for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(r.flags=u,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0,r.mode=3;case 3:for(;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.time=u),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,E[2]=u>>>16&255,E[3]=u>>>24&255,r.check=B(r.check,E,4,0)),l=u=0,r.mode=4;case 4:for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0,r.mode=5;case 5:if(1024&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(o<(d=r.length)&&(d=o),d&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),I.arraySet(r.head.extra,n,s,d,k)),512&r.flags&&(r.check=B(r.check,n,d,s)),o-=d,s+=d,r.length-=d),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break e;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=B(r.check,n,d,s)),o-=d,s+=d,k)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break e;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=B(r.check,n,d,s)),o-=d,s+=d,k)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}l=u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}e.adler=r.check=L(u),l=u=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=o,r.hold=u,r.bits=l,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){u>>>=7&l,l-=7&l,r.mode=27;break}for(;l<3;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}switch(r.last=1&u,l-=1,3&(u>>>=1)){case 0:r.mode=14;break;case 1:if(j(r),r.mode=20,6!==t)break;u>>>=2,l-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&u,l=u=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(d=r.length){if(o<d&&(d=o),h<d&&(d=h),0===d)break e;I.arraySet(i,n,s,d,a),o-=d,s+=d,h-=d,a+=d,r.length-=d;break}r.mode=12;break;case 17:for(;l<14;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.lens[A[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,S={bits:r.lenbits},x=T(0,r.lens,0,19,r.lencode,0,r.work,S),r.lenbits=S.bits,x){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;g=(C=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(b<16)u>>>=_,l-=_,r.lens[r.have++]=b;else{if(16===b){for(z=_+2;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(u>>>=_,l-=_,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}k=r.lens[r.have-1],d=3+(3&u),u>>>=2,l-=2}else if(17===b){for(z=_+3;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}l-=_,k=0,d=3+(7&(u>>>=_)),u>>>=3,l-=3}else{for(z=_+7;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}l-=_,k=0,d=11+(127&(u>>>=_)),u>>>=7,l-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;d--;)r.lens[r.have++]=k}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,S={bits:r.lenbits},x=T(D,r.lens,0,r.nlen,r.lencode,0,r.work,S),r.lenbits=S.bits,x){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,S={bits:r.distbits},x=T(F,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,S),r.distbits=S.bits,x){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=o&&258<=h){e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=o,r.hold=u,r.bits=l,R(e,c),a=e.next_out,i=e.output,h=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;g=(C=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(g&&0==(240&g)){for(v=_,y=g,w=b;g=(C=r.lencode[w+((u&(1<<v+y)-1)>>v)])>>>16&255,b=65535&C,!(v+(_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}u>>>=v,l-=v,r.back+=v}if(u>>>=_,l-=_,r.back+=_,r.length=b,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=12;break}if(64&g){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(z=r.extra;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;g=(C=r.distcode[u&(1<<r.distbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(0==(240&g)){for(v=_,y=g,w=b;g=(C=r.distcode[w+((u&(1<<v+y)-1)>>v)])>>>16&255,b=65535&C,!(v+(_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}u>>>=v,l-=v,r.back+=v}if(u>>>=_,l-=_,r.back+=_,64&g){e.msg="invalid distance code",r.mode=30;break}r.offset=b,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(z=r.extra;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===h)break e;if(d=c-h,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}p=d>r.wnext?(d-=r.wnext,r.wsize-d):r.wnext-d,d>r.length&&(d=r.length),m=r.window}else m=i,p=a-r.offset,d=r.length;for(h<d&&(d=h),h-=d,r.length-=d;i[a++]=m[p++],--d;);0===r.length&&(r.mode=21);break;case 26:if(0===h)break e;i[a++]=r.length,h--,r.mode=21;break;case 27:if(r.wrap){for(;l<32;){if(0===o)break e;o--,u|=n[s++]<<l,l+=8}if(c-=h,e.total_out+=c,r.total+=c,c&&(e.adler=r.check=r.flags?B(r.check,i,c,a-c):O(r.check,i,c,a-c)),c=h,(r.flags?u:L(u))!==r.check){e.msg="incorrect data check",r.mode=30;break}l=u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}l=u=0}r.mode=29;case 29:x=1;break e;case 30:x=-3;break e;case 31:return-4;case 32:default:return U}return e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=o,r.hold=u,r.bits=l,(r.wsize||c!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&Z(e,e.output,e.next_out,c-e.avail_out)?(r.mode=31,-4):(f-=e.avail_in,c-=e.avail_out,e.total_in+=f,e.total_out+=c,r.total+=c,r.wrap&&c&&(e.adler=r.check=r.flags?B(r.check,i,c,e.next_out-c):O(r.check,i,c,e.next_out-c)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==f&&0===c||4===t)&&x===N&&(x=-5),x)},r.inflateEnd=function(e){if(!e||!e.state)return U;var t=e.state;return t.window&&(t.window=null),e.state=null,N},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?U:((r.head=t).done=!1,N):U},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?U:11===r.mode&&O(1,t,n,0)!==r.check?-3:Z(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,N):U},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){"use strict";var D=e("../utils/common"),F=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],U=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],P=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,n,i,s,a,o){var h,u,l,f,c,d,p,m,_,g=o.bits,b=0,v=0,y=0,w=0,k=0,x=0,S=0,z=0,C=0,E=0,A=null,I=0,O=new D.Buf16(16),B=new D.Buf16(16),R=null,T=0;for(b=0;b<=15;b++)O[b]=0;for(v=0;v<n;v++)O[t[r+v]]++;for(k=g,w=15;1<=w&&0===O[w];w--);if(w<k&&(k=w),0===w)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(y=1;y<w&&0===O[y];y++);for(k<y&&(k=y),b=z=1;b<=15;b++)if(z<<=1,(z-=O[b])<0)return-1;if(0<z&&(0===e||1!==w))return-1;for(B[1]=0,b=1;b<15;b++)B[b+1]=B[b]+O[b];for(v=0;v<n;v++)0!==t[r+v]&&(a[B[t[r+v]]++]=v);if(d=0===e?(A=R=a,19):1===e?(A=F,I-=257,R=N,T-=257,256):(A=U,R=P,-1),b=y,c=s,S=v=E=0,l=-1,f=(C=1<<(x=k))-1,1===e&&852<C||2===e&&592<C)return 1;for(;;){for(p=b-S,_=a[v]<d?(m=0,a[v]):a[v]>d?(m=R[T+a[v]],A[I+a[v]]):(m=96,0),h=1<<b-S,y=u=1<<x;i[c+(E>>S)+(u-=h)]=p<<24|m<<16|_|0,0!==u;);for(h=1<<b-1;E&h;)h>>=1;if(0!==h?(E&=h-1,E+=h):E=0,v++,0==--O[b]){if(b===w)break;b=t[r+a[v]]}if(k<b&&(E&f)!==l){for(0===S&&(S=k),c+=y,z=1<<(x=b-S);x+S<w&&!((z-=O[x+S])<=0);)x++,z<<=1;if(C+=1<<x,1===e&&852<C||2===e&&592<C)return 1;i[l=E&f]=k<<24|x<<16|c-s|0}}return 0!==E&&(i[c+E]=b-S<<24|64<<16|0),o.bits=k,0}},{"../utils/common":41}],51:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){"use strict";var i=e("../utils/common"),o=0,h=1;function n(e){for(var t=e.length;0<=--t;)e[t]=0}var s=0,a=29,u=256,l=u+1+a,f=30,c=19,_=2*l+1,g=15,d=16,p=7,m=256,b=16,v=17,y=18,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=new Array(2*(l+2));n(z);var C=new Array(2*f);n(C);var E=new Array(512);n(E);var A=new Array(256);n(A);var I=new Array(a);n(I);var O,B,R,T=new Array(f);function D(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function F(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function N(e){return e<256?E[e]:E[256+(e>>>7)]}function U(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function P(e,t,r){e.bi_valid>d-r?(e.bi_buf|=t<<e.bi_valid&65535,U(e,e.bi_buf),e.bi_buf=t>>d-e.bi_valid,e.bi_valid+=r-d):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function L(e,t,r){P(e,r[2*t],r[2*t+1])}function j(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function Z(e,t,r){var n,i,s=new Array(g+1),a=0;for(n=1;n<=g;n++)s[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=j(s[o]++,o))}}function W(e){var t;for(t=0;t<l;t++)e.dyn_ltree[2*t]=0;for(t=0;t<f;t++)e.dyn_dtree[2*t]=0;for(t=0;t<c;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*m]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function M(e){8<e.bi_valid?U(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function H(e,t,r,n){var i=2*t,s=2*r;return e[i]<e[s]||e[i]===e[s]&&n[t]<=n[r]}function G(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&H(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!H(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function K(e,t,r){var n,i,s,a,o=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],i=e.pending_buf[e.l_buf+o],o++,0===n?L(e,i,t):(L(e,(s=A[i])+u+1,t),0!==(a=w[s])&&P(e,i-=I[s],a),L(e,s=N(--n),r),0!==(a=k[s])&&P(e,n-=T[s],a)),o<e.last_lit;);L(e,m,t)}function Y(e,t){var r,n,i,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,h=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=_,r=0;r<h;r++)0!==s[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=a[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;1<=r;r--)G(e,s,r);for(i=h;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],G(e,s,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,s[2*i]=s[2*r]+s[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,s[2*r+1]=s[2*n+1]=i,e.heap[1]=i++,G(e,s,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,s,a,o,h=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,c=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(s=0;s<=g;s++)e.bl_count[s]=0;for(h[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<_;r++)p<(s=h[2*h[2*(n=e.heap[r])+1]+1]+1)&&(s=p,m++),h[2*n+1]=s,u<n||(e.bl_count[s]++,a=0,d<=n&&(a=c[n-d]),o=h[2*n],e.opt_len+=o*(s+a),f&&(e.static_len+=o*(l[2*n+1]+a)));if(0!==m){do{for(s=p-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[p]--,m-=2}while(0<m);for(s=p;0!==s;s--)for(n=e.bl_count[s];0!==n;)u<(i=e.heap[--r])||(h[2*i+1]!==s&&(e.opt_len+=(s-h[2*i+1])*h[2*i],h[2*i+1]=s),n--)}}(e,t),Z(s,u,e.bl_count)}function X(e,t,r){var n,i,s=-1,a=t[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++o<h&&i===a||(o<u?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[2*b]++):o<=10?e.bl_tree[2*v]++:e.bl_tree[2*y]++,s=i,u=(o=0)===a?(h=138,3):i===a?(h=6,3):(h=7,4))}function V(e,t,r){var n,i,s=-1,a=t[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++o<h&&i===a)){if(o<u)for(;L(e,i,e.bl_tree),0!=--o;);else 0!==i?(i!==s&&(L(e,i,e.bl_tree),o--),L(e,b,e.bl_tree),P(e,o-3,2)):o<=10?(L(e,v,e.bl_tree),P(e,o-3,3)):(L(e,y,e.bl_tree),P(e,o-11,7));s=i,u=(o=0)===a?(h=138,3):i===a?(h=6,3):(h=7,4)}}n(T);var q=!1;function J(e,t,r,n){P(e,(s<<1)+(n?1:0),3),function(e,t,r,n){M(e),n&&(U(e,r),U(e,~r)),i.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}r._tr_init=function(e){q||(function(){var e,t,r,n,i,s=new Array(g+1);for(n=r=0;n<a-1;n++)for(I[n]=r,e=0;e<1<<w[n];e++)A[r++]=n;for(A[r-1]=n,n=i=0;n<16;n++)for(T[n]=i,e=0;e<1<<k[n];e++)E[i++]=n;for(i>>=7;n<f;n++)for(T[n]=i<<7,e=0;e<1<<k[n]-7;e++)E[256+i++]=n;for(t=0;t<=g;t++)s[t]=0;for(e=0;e<=143;)z[2*e+1]=8,e++,s[8]++;for(;e<=255;)z[2*e+1]=9,e++,s[9]++;for(;e<=279;)z[2*e+1]=7,e++,s[7]++;for(;e<=287;)z[2*e+1]=8,e++,s[8]++;for(Z(z,l+1,s),e=0;e<f;e++)C[2*e+1]=5,C[2*e]=j(e,5);O=new D(z,w,u+1,l,g),B=new D(C,k,0,f,g),R=new D(new Array(0),x,0,c,p)}(),q=!0),e.l_desc=new F(e.dyn_ltree,O),e.d_desc=new F(e.dyn_dtree,B),e.bl_desc=new F(e.bl_tree,R),e.bi_buf=0,e.bi_valid=0,W(e)},r._tr_stored_block=J,r._tr_flush_block=function(e,t,r,n){var i,s,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return h;for(t=32;t<u;t++)if(0!==e.dyn_ltree[2*t])return h;return o}(e)),Y(e,e.l_desc),Y(e,e.d_desc),a=function(e){var t;for(X(e,e.dyn_ltree,e.l_desc.max_code),X(e,e.dyn_dtree,e.d_desc.max_code),Y(e,e.bl_desc),t=c-1;3<=t&&0===e.bl_tree[2*S[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==t?J(e,t,r,n):4===e.strategy||s===i?(P(e,2+(n?1:0),3),K(e,z,C)):(P(e,4+(n?1:0),3),function(e,t,r,n){var i;for(P(e,t-257,5),P(e,r-1,5),P(e,n-4,4),i=0;i<n;i++)P(e,e.bl_tree[2*S[i]+1],3);V(e,e.dyn_ltree,t-1),V(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),K(e,e.dyn_ltree,e.dyn_dtree)),W(e),n&&M(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(A[r]+u+1)]++,e.dyn_dtree[2*N(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){P(e,2,3),L(e,m,z),function(e){16===e.bi_valid?(U(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,r){(function(e){!function(r,n){"use strict";if(!r.setImmediate){var i,s,t,a,o=1,h={},u=!1,l=r.document,e=Object.getPrototypeOf&&Object.getPrototypeOf(r);e=e&&e.setTimeout?e:r,i="[object process]"==={}.toString.call(r.process)?function(e){process.nextTick(function(){c(e)})}:function(){if(r.postMessage&&!r.importScripts){var e=!0,t=r.onmessage;return r.onmessage=function(){e=!1},r.postMessage("","*"),r.onmessage=t,e}}()?(a="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",d,!1):r.attachEvent("onmessage",d),function(e){r.postMessage(a+e,"*")}):r.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){c(e.data)},function(e){t.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(s=l.documentElement,function(e){var t=l.createElement("script");t.onreadystatechange=function(){c(e),t.onreadystatechange=null,s.removeChild(t),t=null},s.appendChild(t)}):function(e){setTimeout(c,0,e)},e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var n={callback:e,args:t};return h[o]=n,i(o),o++},e.clearImmediate=f}function f(e){delete h[e]}function c(e){if(u)setTimeout(c,0,e);else{var t=h[e];if(t){u=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{f(e),u=!1}}}}function d(e){e.source===r&&"string"==typeof e.data&&0===e.data.indexOf(a)&&c(+e.data.slice(a.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)});
/*!

JSZipUtils - A collection of cross-browser utilities to go along with JSZip.
<http://stuk.github.io/jszip-utils>

(c) 2014 Stuart Knightley, David Duponchel
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip-utils/master/LICENSE.markdown.

*/
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.JSZipUtils=a():"undefined"!=typeof global?global.JSZipUtils=a():"undefined"!=typeof self&&(self.JSZipUtils=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(){try{return new window.XMLHttpRequest}catch(a){}}function d(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}var e={};e._getBinaryFromXHR=function(a){return a.response||a.responseText};var f=window.ActiveXObject?function(){return c()||d()}:c;e.getBinaryContent=function(a,b){try{var c=f();c.open("GET",a,!0),"responseType"in c&&(c.responseType="arraybuffer"),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),c.onreadystatechange=function(){var d,f;if(4===c.readyState)if(200===c.status||0===c.status){d=null,f=null;try{d=e._getBinaryFromXHR(c)}catch(g){f=new Error(g)}b(f,d)}else b(new Error("Ajax error for "+a+" : "+this.status+" "+this.statusText),null)},c.send()}catch(d){b(new Error(d),null)}},b.exports=e},{}]},{},[1])(1)});
/**
* @license 3DconnexionJS
*
* Copyright (c) 2013-2020 3Dconnexion. All rights reserved.
* License:
*   This file is licensed under the terms of the "3Dconnexion
*   Software Development Kit" license agreement:
*   http://www.3dconnexion.com/service/software-developer/licence-agreement.html
*   All rights not expressly granted by 3Dconnexion are reserved.
*
* $Revision: 17564 $
*/
var when,CryptoJS,AUTOBAHNJS_VERSION,global;_3Dconnexion=function(n){"use strict";this.version="0.6.1";this.client=n;this.session=null;this.defport=8181;this.connected=!1;this.connexion=null;this._3dcontroller=null;this.viewport=null;this.host="127.51.68.120";this.nlRpcUri=null;this.nlResourceUri=null;this._EVENT_TYPEID_RPC=0;this.V3DK_FIT=31;this.V3DK_MENU=30;this.fnUpdate={motion:this.onMotion.bind(this),"events.keyPress":this.onKeyPress.bind(this),"events.keyRelease":this.onKeyRelease.bind(this)};this.clientFnRead={"view.affine":n.getViewMatrix,"view.constructionPlane":n.getConstructionPlane,"view.extents":n.getViewExtents,"view.fov":n.getFov,"view.frustum":n.getViewFrustum,"view.perspective":n.getPerspective,"view.target":n.getViewTarget,"view.rotatable":n.getViewRotatable,"model.extents":n.getModelExtents,"pivot.position":n.getPivotPosition,"hit.lookat":n.getLookAt,"selection.affine":n.getSelectionAffine,"selection.empty":n.getSelectionEmpty,"selection.extents":n.getSelectionExtents,"pointer.position":n.getPointerPosition,coordinateSystem:n.getCoordinateSystem,"views.front":n.getFrontView,"frame.timingSource":n.getFrameTimingSource,"frame.time":n.getFrameTime};this.clientFnUpdate={motion:n.setMoving,transaction:n.setTransaction,"view.affine":n.setViewMatrix,"view.extents":n.setViewExtents,"view.fov":n.setFov,"view.target":n.setTarget,"commands.activeCommand":n.setActiveCommand,"pivot.position":n.setPivotPosition,"pivot.visible":n.setPivotVisible,"hit.lookfrom":n.setLookFrom,"hit.direction":n.setLookDirection,"hit.aperture":n.setLookAperture,"hit.selectionOnly":n.setSelectionOnly,"selection.affine":n.setSelectionAffine,"events.keyPress":n.setKeyPress,"events.keyRelease":n.setKeyRelease,"settings.changed":n.setSettingsChanged};this.debug=!1;window.hasOwnProperty("_3DCONNEXION_DEBUG")&&(this.debug=window._3DCONNEXION_DEBUG);this.blur=this.blur.bind(this);this.focus=this.focus.bind(this)};typeof module=="object"&&(module.exports=_3Dconnexion);_3Dconnexion.prototype={constructor:_3Dconnexion};Object.freeze(_3Dconnexion.nlOptions={none:0,rowMajorOrder:2});_3Dconnexion.prototype.connect=function(){"use strict";var n=this,e=this.client,u=1,t=new XMLHttpRequest,f,r,i;if(!e.onConnect)throw"onConnect handler required!";i="https://"+n.host+":"+n.defport+"/3dconnexion/nlproxy";t.onreadystatechange=function(){if(t.readyState===4&&t.status===200){n.debug&&console.log(t.responseText);n.nlRpcUri="wss://"+n.host+"/3dconnexion#";n.nlResourceUri="wss://"+n.host+"/3dconnexion";try{f=JSON.parse(t.responseText).port;r="wss://"+n.host+":"+f;n.debug&&console.log("Connecting to "+r+" ...");window.hasOwnProperty("AUTOBAHN_DEBUG")&&window.AUTOBAHN_DEBUG&&window.ab.debug(!0,!0,!0);window.ab.connect(r,function(t){n.session=t;n.connected=!0;n.debug&&console.log("Connected!");t.prefix("3dx_rpc",n.nlRpcUri);t.prefix("3dconnexion",n.nlResourceUri);t.prefix("self",window.location.href);n.client.onConnect()},function(t,i){if(n.client.onDisconnect!==undefined)n.client.onDisconnect(i);n.delete3dmouse();n.connected=!1;n.session=null;n.debug&&console.log("Socket closed!",i)},{maxRetries:3,retryDelay:500})}catch(i){console.error(i)}}};t.onerror=function(){n.debug&&console.log("_3Dconnexion.connect: No response from local 3dmouse server "+i)};t.ontimeout=function(){n.debug&&console.log("_3Dconnexion.connect: Timeout querying local 3dmouse server "+i)};try{t.open("GET",i,!0);t.setRequestHeader("Accept","application/json; charset=utf-8");t.msCaching="disabled";t.timeout=0;t.send()}catch(o){u=0;console.error(o.toString())}return u};_3Dconnexion.prototype.create3dmouse=function(n,t,i){"use strict";i=typeof i!="undefined"?i:_3Dconnexion.nlOptions.none;var r=this;r.viewport=n;r.debug&&console.log("create3dmouse "+r.viewport.id);r.viewport.addEventListener("focus",r.focus);r.viewport.addEventListener("blur",r.blur);r.session.call("3dx_rpc:create","3dconnexion:3dmouse",r.version).then(function(n){r.connexion=n.connexion;var u={version:parseFloat(r.version),name:t,rowMajorOrder:(i&_3Dconnexion.nlOptions.rowMajorOrder)!=0};r.session.call("3dx_rpc:create","3dconnexion:3dcontroller",r.connexion,u).then(function(n){r._3dcontroller=n.instance;r.session.subscribe("3dconnexion:3dcontroller/"+r._3dcontroller,r.onEvent.bind(r));document.hasFocus()&&(document.activeElement===document.body||document.activeElement===null?(r.viewport.focus(),window===r.viewport&&r.focus()):r.viewport.contains(document.activeElement)&&(r.focus(),r.debug&&console.log("self.viewport has focus")));r.client.on3dmouseCreated&&r.client.on3dmouseCreated()},function(n){console.log("3dx_rpc:create 3dconnexion:3dcontroller "+n)})},function(n){console.log("3dx_rpc:create "+n)})};_3Dconnexion.prototype.blur=function(){"use strict";var n=this;n.debug&&console.log("blur on ");n.session&&n._3dcontroller&&n.update3dcontroller({focus:!1})};_3Dconnexion.prototype.focus=function(){"use strict";var n=this;n.debug&&console.log("focus on ");n.session&&n._3dcontroller&&n.update3dcontroller({focus:!0})};_3Dconnexion.prototype.onKeyPress=function(n){"use strict";var t=this;t.debug&&console.log("onKeyPress "+n)};_3Dconnexion.prototype.onKeyRelease=function(n){"use strict";var t=this;t.debug&&console.log("onKeyRelease "+n)};_3Dconnexion.prototype.onMotion=function(n){"use strict";var t=this;n===!0?t.client.onStartMotion!==undefined&&t.client.onStartMotion():t.client.onStopMotion!==undefined&&t.client.onStopMotion()};_3Dconnexion.prototype.onEvent=function(n,t){"use strict";var i=this,f=null,r=null,u=null;if(i.debug&&(console.log(n),console.log(t)),t[0]===window.ab._MESSAGE_TYPEID_CALL){if(t[2]==="self:read")if(r=i.clientFnRead[t[4]],r!==undefined)f=r.bind(i.client)();else{u=[window.ab._MESSAGE_TYPEID_CALL_ERROR,t[1],t[2]+"#generic",t[4]+" unknown property"];i.session._send(u);return}else if(t[2]==="self:update")if(r=i.fnUpdate[t[4]],r!==undefined)f=r(t[5]);else if(r=i.clientFnUpdate[t[4]],r!==undefined)f=r.bind(i.client)(t[5]);else{u=[window.ab._MESSAGE_TYPEID_CALL_ERROR,t[1],t[2]+"#generic",t[4]+" unknown property"];i.session._send(u);return}else{u=[window.ab._MESSAGE_TYPEID_CALL_ERROR,t[1],t[2]+"#generic","unknown procedure"];i.session._send(u);return}u=[window.ab._MESSAGE_TYPEID_CALL_RESULT,t[1],f];i.session._send(u)}};_3Dconnexion.prototype.read3dcontroller=function(n,t){"use strict";var i=this;i.debug&&console.log("read3dcontroller "+i._3dcontroller);try{i.session.call("3dx_rpc:read","3dconnexion:3dcontroller/"+i._3dcontroller,n).then(function(n){t&&t(n)},function(t){console.log("3dx_rpc:read 3dconnexion:3dcontroller/"+i._3dcontroller+" "+n+" "+t)})}catch(r){console.error(r)}};_3Dconnexion.prototype.update3dcontroller=function(n){"use strict";var t=this;t.debug&&console.log("update3dmouse "+t._3dcontroller);try{if(!t._3dcontroller)throw"exception 3dx_rpc:update: 3dcontroller not initialized";t.session.call("3dx_rpc:update","3dconnexion:3dcontroller/"+t._3dcontroller,n).then(function(){return},function(n){console.log("3dx_rpc:update 3dconnexion:3dcontroller/"+t._3dcontroller+" "+n)})}catch(i){console.error(i)}};_3Dconnexion.prototype.delete3dmouse=function(){"use strict";var n=this,t=n.connexion;n.debug&&console.log("delete3dmouse ");n.connexion=null;n._3dcontroller=null;n.viewport!==null&&(n.viewport.removeEventListener("focus",n.focus),n.viewport.removeEventListener("blur",n.blur));n.session&&n.session.call("3dx_rpc:delete","3dconnexion:3dmouse/"+t).then(function(){n.debug&&console.log("deleted connexion "+t)},function(n){console.log("3dx_rpc:delete "+t+" "+n)})};Object.freeze(_3Dconnexion.SiActionNodeType_t={SI_ACTIONSET_NODE:0,SI_CATEGORY_NODE:1,SI_ACTION_NODE:2});_3Dconnexion.ActionNode=function(n,t,i){return this.id=n,this.label=t||n,this.type=i,this};_3Dconnexion.ActionNode.prototype={constructor:_3Dconnexion.ActionNode,id:{value:null,enumerable:!0},label:{value:null,writable:!0,enumerable:!0},type:{value:null,enumerable:!0}};_3Dconnexion.Action=function(n,t,i){return _3Dconnexion.ActionNode.call(this,n,t,_3Dconnexion.SiActionNodeType_t.SI_ACTION_NODE),this.description=i||"",this};_3Dconnexion.Action.prototype=Object.create(_3Dconnexion.ActionNode.prototype,{constructor:{value:_3Dconnexion.Action},description:{value:"",writable:!0,enumerable:!0}});_3Dconnexion.ActionTreeNode=function(){return this.nodes=[],this};_3Dconnexion.ActionTreeNode.prototype=Object.create(_3Dconnexion.ActionNode.prototype,{constructor:{value:_3Dconnexion.ActionTreeNode},nodes:{value:null,writable:!0,enumerable:!0},push:{value:function(n){return this.nodes.push(n),n}}});_3Dconnexion.ActionSet=function(n,t){return _3Dconnexion.ActionNode.call(this,n,t,_3Dconnexion.SiActionNodeType_t.SI_ACTIONSET_NODE),_3Dconnexion.ActionTreeNode.call(this),this};_3Dconnexion.ActionSet.prototype=Object.create(_3Dconnexion.ActionTreeNode.prototype,{constructor:{value:_3Dconnexion.ActionSet}});_3Dconnexion.Category=function(n,t){return _3Dconnexion.ActionNode.call(this,n,t,_3Dconnexion.SiActionNodeType_t.SI_CATEGORY_NODE),_3Dconnexion.ActionTreeNode.call(this),this};_3Dconnexion.Category.prototype=Object.create(_3Dconnexion.ActionTreeNode.prototype,{constructor:{value:_3Dconnexion.Category}});_3Dconnexion.ActionTree=function(){return this.nodes=[],this};_3Dconnexion.ActionTree.prototype=Object.create(null,{constructor:{value:_3Dconnexion.ActionTree},nodes:{value:null,writable:!0,enumerable:!0},push:{value:function(n){return this.nodes.push(n),n}}});_3Dconnexion.ImageItem=function(){};Object.freeze(_3Dconnexion.SiImageType_t={e_none:0,e_image_file:1,e_resource_file:2,e_image:3});_3Dconnexion.ImageItem.prototype={constructor:_3Dconnexion.ImageItem,id:{value:"",writable:!0},type:{value:"e_none",enumerable:!0}};_3Dconnexion.ImageItem.fromImage=function(n,t){var i=new _3Dconnexion.ImageItem;return Object.defineProperties(i,{id:{value:t||"",writable:!0,enumerable:!0},type:{value:_3Dconnexion.SiImageType_t.e_image,enumerable:!0},index:{value:0,writable:!0,enumerable:!0},data:{value:_3Dconnexion.ImageItem.base64FromArrayBuffer(n),enumerable:!0},status:{value:200}})};_3Dconnexion.ImageItem.fromURL=function(n,t){var r=new _3Dconnexion.ImageItem,i;return Object.defineProperties(r,{id:{value:t||"",writable:!0,enumerable:!0},type:{value:_3Dconnexion.SiImageType_t.e_image,enumerable:!0},index:{value:0,writable:!0,enumerable:!0},buffer:{value:null,writable:!0},data:{get:function(){return this.buffer},set:function(n){r.buffer=n;r.onload()},enumerable:!0},status:{value:100,writable:!0},onload:{value:function(){},writable:!0}}),i=new XMLHttpRequest,i.overrideMimeType("text/plain; charset=x-user-defined"),i.open("GET",n,!0),i.responseType="arraybuffer",i.onload=function(){if(r.status=i.status,i.status===200&&i.response!==null){r.data=_3Dconnexion.ImageItem.base64FromArrayBuffer(i.response);return}r.status=404;r.data=null},i.onerror=function(){r.status=i.status;r.data=null},i.send(null),r};_3Dconnexion.ImageItem.base64FromArrayBuffer=function(n){for(var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=new Uint8Array(n),e=t.length%3,f=t.length-e,i="",r=0;r<f;r+=3)i+=u[t[r]>>2],i+=u[(t[r]&3)<<4|t[r+1]>>4],i+=u[(t[r+1]&15)<<2|t[r+2]>>6],i+=u[t[r+2]&63];return e!==0&&(i+=u[t[f]>>2],e===2?(i+=u[(t[f]&3)<<4|t[f+1]>>4],i+=u[(t[f+1]&15)<<2],i+="="):(i+=u[(t[f]&3)<<4],i+="==")),i};_3Dconnexion.ImageCache=function(){this.images=[];this.outstanding_requests=0};_3Dconnexion.ImageCache.prototype={constructor:_3Dconnexion.ImageCache,images:{value:null,writable:!0,enumerable:!0},outstanding_requests:{value:0,writable:!0},push:function(n){var t=this;if(n.status===100)++t.outstanding_requests,n.onload=function(){var n=this,i;n.onload=function(){};n.status!==200&&(i=t.images.indexOf(n),i>-1&&t.images.splice(i,1));--t.outstanding_requests;t.outstanding_requests===0&&t.onload()}.bind(n);else if(n.data===null)return;t.images.push(n)},onload:function(){}};
/** @license AutobahnJS - http://autobahn.ws
 *
 * Copyright (C) 2011-2014 Tavendo GmbH.
 * Licensed under the MIT License.
 * See license text at http://www.opensource.org/licenses/mit-license.php
 *
 * AutobahnJS includes code from:
 *
 * when - http://cujojs.com
 *
 * (c) copyright B Cavalier & J Hann
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Crypto-JS - http://code.google.com/p/crypto-js/
 *
 * (c) 2009-2012 by Jeff Mott. All rights reserved.
 * Licensed under the New BSD License at:
 * http://code.google.com/p/crypto-js/wiki/License
 * 
 * console-normalizer - https://github.com/Zenovations/console-normalizer
 *
 * (c) 2012 by Zenovations.
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 * 
 */
(function(n){n||(n=window.console={log:function(){},info:function(){},warn:function(){},error:function(){}});Function.prototype.bind||(Function.prototype.bind=function(n){var t=this,i=Array.prototype.slice.call(arguments,1);return function(){return t.apply(n,Array.prototype.concat.apply(i,arguments))}});typeof n.log=="object"&&(n.log=Function.prototype.call.bind(n.log,n),n.info=Function.prototype.call.bind(n.info,n),n.warn=Function.prototype.call.bind(n.warn,n),n.error=Function.prototype.call.bind(n.error,n));"group"in n||(n.group=function(t){n.info("\n--- "+t+" ---\n")});"groupEnd"in n||(n.groupEnd=function(){n.log("\n")});"time"in n||function(){var t={};n.time=function(n){t[n]=(new Date).getTime()};n.timeEnd=function(i){var r=(new Date).getTime(),u=i in t?r-t[i]:0;n.info(i+": "+u+"ms")}}()})(window.console);
/** @license MIT License (c) copyright 2011-2013 original author or authors */
when=function(n){"use strict";function t(n,t,i,r){return at(n).then(t,i,r)}function e(n){return new f(n,h.PromiseStatus&&h.PromiseStatus())}function f(n,t){function c(){return f?f.inspect():ii()}function l(n,t,r,u,e){function o(i){i._when(n,t,r,u,e)}i?i.push(o):y(function(){o(f)})}function o(n){if(i){var r=i;i=u;y(function(){f=pt(e,n);t&&bt(f,t);w(r,f)})}}function s(n){o(new r(n))}function a(n){if(i){var t=i;y(function(){w(t,new b(n))})}}var e,f,i=[];e=this;this._status=t;this.inspect=c;this._when=l;try{n(o,s,a)}catch(h){s(h)}}function at(n){return n instanceof f?n:o(n)}function o(n){return e(function(t){t(n)})}function vt(n){return t(n,function(n){return new r(n)})}function yt(){function f(u,f,e){n.resolve=n.resolver.resolve=function(n){return t?o(n):(t=!0,u(n),i)};n.reject=n.resolver.reject=function(n){return t?o(new r(n)):(t=!0,f(n),i)};n.notify=n.resolver.notify=function(n){return e(n),n}}var n,i,t;return n={promise:u,resolve:u,reject:u,notify:u,resolver:{resolve:u,reject:u,notify:u}},n.promise=i=e(f),n}function w(n,t){for(var i=0;i<n.length;i++)n[i](t)}function pt(n,t){if(t===n)return new r(new TypeError);if(t instanceof f)return t;try{var i=t===Object(t)&&t.then;return typeof i=="function"?wt(i,t):new c(t)}catch(u){return new r(u)}}function wt(n,t){return e(function(i,r){d(n,t,i,r)})}function c(n){this.value=n}function r(n){this.value=n}function b(n){this.value=n}function bt(n,t){function i(){t.fulfilled()}function r(n){t.rejected(n)}n.then(i,r)}function rt(n){return n&&typeof n.then=="function"}function ut(n,i,r,u,f){return t(n,function(n){function o(r,u,f){function y(n){c(n)}function w(n){h(n)}var o,v,s,a,h,c,l,e;if(l=n.length>>>0,o=Math.max(0,Math.min(i,l)),s=[],v=l-o+1,a=[],o)for(c=function(n){a.push(n);--v||(h=c=p,u(a))},h=function(n){s.push(n);--o||(h=c=p,r(s))},e=0;e<l;++e)e in n&&t(n[e],w,y,f);else r(s)}return e(o).then(r,u,f)})}function kt(n,t,i,r){function u(n){return t?t(n[0]):n[0]}return ut(n,1,u,i,r)}function ft(n,t,i,r){return l(n,p).then(t,i,r)}function dt(){return l(arguments,p)}function gt(n){return l(n,et,ot)}function ni(n,t){return l(n,t)}function l(n,i,r){return t(n,function(n){function u(u,f,e){function l(n,o){t(n,i,r).then(function(n){s[o]=n;--h||u(s)},f,e)}var s,c,h,o;if(h=c=n.length>>>0,s=[],!h){u(s);return}for(o=0;o<c;o++)o in n?l(n[o],o):--h}return new f(u)})}function ti(n,i){var r=d(k,arguments,1);return t(n,function(n){var u;return u=n.length,r[0]=function(n,r,f){return t(n,function(n){return t(r,function(t){return i(n,t,f,u)})})},st.apply(n,r)})}function et(n){return{state:"fulfilled",value:n}}function ot(n){return{state:"rejected",reason:n}}function ii(){return{state:"pending"}}function y(n){v.push(n)===1&&s(lt)}function lt(){w(v);v=[]}function p(n){return n}function ri(n){typeof h.reportUnhandled=="function"?h.reportUnhandled():y(function(){throw n;});throw n;}t.promise=e;t.resolve=o;t.reject=vt;t.defer=yt;t.join=dt;t.all=ft;t.map=ni;t.reduce=ti;t.settle=gt;t.any=kt;t.some=ut;t.isPromise=rt;t.isPromiseLike=rt;i=f.prototype;i.then=function(n,t,i){var r=this;return new f(function(u,f,e){r._when(u,e,n,t,i)},this._status&&this._status.observed())};i["catch"]=i.otherwise=function(n){return this.then(u,n)};i["finally"]=i.ensure=function(n){function t(){return o(n())}return typeof n=="function"?this.then(t,t)["yield"](this):this};i.done=function(n,t){this.then(n,t)["catch"](ri)};i["yield"]=function(n){return this.then(function(){return n})};i.tap=function(n){return this.then(n)["yield"](this)};i.spread=function(n){return this.then(function(t){return ft(t,function(t){return n.apply(u,t)})})};i.always=function(n,t){return this.then(n,n,t)};a=Object.create||function(n){function t(){}return t.prototype=n,new t};c.prototype=a(i);c.prototype.inspect=function(){return et(this.value)};c.prototype._when=function(n,t,i){try{n(typeof i=="function"?i(this.value):this.value)}catch(u){n(new r(u))}};r.prototype=a(i);r.prototype.inspect=function(){return ot(this.value)};r.prototype._when=function(n,t,i,u){try{n(typeof u=="function"?u(this.value):this)}catch(f){n(new r(f))}};b.prototype=a(i);b.prototype._when=function(n,t,i,r,u){try{t(typeof u=="function"?u(this.value):this.value)}catch(f){t(f)}};var i,a,st,k,d,s,v,g,nt,tt,h,ht,it,ct,u;if(it=n,v=[],h=typeof console!="undefined"?console:t,typeof process=="object"&&process.nextTick)s=process.nextTick;else if(ct=typeof MutationObserver=="function"&&MutationObserver||typeof WebKitMutationObserver=="function"&&WebKitMutationObserver)s=function(n,t,i){var r=n.createElement("div");return new t(i).observe(r,{attributes:!0}),function(){r.setAttribute("x","x")}}(document,ct,lt);else try{s=it("vertx").runOnLoop||it("vertx").runOnContext}catch(ui){ht=setTimeout;s=function(n){ht(n,0)}}return g=Function.prototype,nt=g.call,d=g.bind?nt.bind(nt):function(n,t){return n.apply(t,k.call(arguments,2))},tt=[],k=tt.slice,st=tt.reduce||function(n){var i,u,r,f,t;if(t=0,i=Object(this),f=i.length>>>0,u=arguments,u.length<=1)for(;;){if(t in i){r=i[t++];break}if(++t>=f)throw new TypeError;}else r=u[1];for(;t<f;++t)t in i&&(r=n(r,i[t],t,i));return r},t}();CryptoJS=CryptoJS||function(n,t){var u={},f=u.lib={},i=f.Base=function(){function n(){}return{extend:function(t){n.prototype=this;var i=new n;return t&&i.mixIn(t),i.hasOwnProperty("init")||(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var n=this.extend();return n.init.apply(n,arguments),n},init:function(){},mixIn:function(n){for(var t in n)n.hasOwnProperty(t)&&(this[t]=n[t]);n.hasOwnProperty("toString")&&(this.toString=n.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),r=f.WordArray=i.extend({init:function(n,i){n=this.words=n||[];this.sigBytes=i!=t?i:n.length*4},toString:function(n){return(n||h).stringify(this)},concat:function(n){var i=this.words,r=n.words,u=this.sigBytes,f=n.sigBytes,e,t;if(this.clamp(),u%4)for(t=0;t<f;t++)e=r[t>>>2]>>>24-t%4*8&255,i[u+t>>>2]|=e<<24-(u+t)%4*8;else if(r.length>65535)for(t=0;t<f;t+=4)i[u+t>>>2]=r[t>>>2];else i.push.apply(i,r);return this.sigBytes+=f,this},clamp:function(){var i=this.words,t=this.sigBytes;i[t>>>2]&=4294967295<<32-t%4*8;i.length=n.ceil(t/4)},clone:function(){var n=i.clone.call(this);return n.words=this.words.slice(0),n},random:function(t){for(var i=[],u=0;u<t;u+=4)i.push(n.random()*4294967296|0);return new r.init(i,t)}}),e=u.enc={},h=e.Hex={stringify:function(n){for(var r,u=n.words,f=n.sigBytes,i=[],t=0;t<f;t++)r=u[t>>>2]>>>24-t%4*8&255,i.push((r>>>4).toString(16)),i.push((r&15).toString(16));return i.join("")},parse:function(n){for(var i=n.length,u=[],t=0;t<i;t+=2)u[t>>>3]|=parseInt(n.substr(t,2),16)<<24-t%8*4;return new r.init(u,i/2)}},o=e.Latin1={stringify:function(n){for(var r,u=n.words,f=n.sigBytes,i=[],t=0;t<f;t++)r=u[t>>>2]>>>24-t%4*8&255,i.push(String.fromCharCode(r));return i.join("")},parse:function(n){for(var i=n.length,u=[],t=0;t<i;t++)u[t>>>2]|=(n.charCodeAt(t)&255)<<24-t%4*8;return new r.init(u,i)}},c=e.Utf8={stringify:function(n){try{return decodeURIComponent(escape(o.stringify(n)))}catch(t){throw new Error("Malformed UTF-8 data");}},parse:function(n){return o.parse(unescape(encodeURIComponent(n)))}},s=f.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new r.init;this._nDataBytes=0},_append:function(n){typeof n=="string"&&(n=c.parse(n));this._data.concat(n);this._nDataBytes+=n.sigBytes},_process:function(t){var e=this._data,h=e.words,c=e.sigBytes,o=this.blockSize,a=o*4,u=c/a,i,s,f,l;if(u=t?n.ceil(u):n.max((u|0)-this._minBufferSize,0),i=u*o,s=n.min(i*4,c),i){for(f=0;f<i;f+=o)this._doProcessBlock(h,f);l=h.splice(0,i);e.sigBytes-=s}return new r.init(l,s)},clone:function(){var n=i.clone.call(this);return n._data=this._data.clone(),n},_minBufferSize:0}),a=f.Hasher=s.extend({cfg:i.extend(),init:function(n){this.cfg=this.cfg.extend(n);this.reset()},reset:function(){s.reset.call(this);this._doReset()},update:function(n){return this._append(n),this._process(),this},finalize:function(n){n&&this._append(n);return this._doFinalize()},blockSize:16,_createHelper:function(n){return function(t,i){return new n.init(i).finalize(t)}},_createHmacHelper:function(n){return function(t,i){return new l.HMAC.init(n,i).finalize(t)}}}),l=u.algo={};return u}(Math),function(){var n=CryptoJS,t=n.lib,i=t.WordArray,r=n.enc,u=r.Base64={stringify:function(n){var u=n.words,e=n.sigBytes,o=this._map,i,t,r,f;for(n.clamp(),i=[],t=0;t<e;t+=3){var s=u[t>>>2]>>>24-t%4*8&255,h=u[t+1>>>2]>>>24-(t+1)%4*8&255,c=u[t+2>>>2]>>>24-(t+2)%4*8&255,l=s<<16|h<<8|c;for(r=0;r<4&&t+r*.75<e;r++)i.push(o.charAt(l>>>6*(3-r)&63))}if(f=o.charAt(64),f)while(i.length%4)i.push(f);return i.join("")},parse:function(n){var o=n.length,u=this._map,s=u.charAt(64),f,e,r,t,h,c;for(s&&(f=n.indexOf(s),f!=-1&&(o=f)),e=[],r=0,t=0;t<o;t++)t%4&&(h=u.indexOf(n.charAt(t-1))<<t%4*2,c=u.indexOf(n.charAt(t))>>>6-t%4*2,e[r>>>2]|=(h|c)<<24-r%4*8,r++);return i.create(e,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(){var n=CryptoJS,t=n.lib,i=t.Base,r=n.enc,u=r.Utf8,f=n.algo,e=f.HMAC=i.extend({init:function(n,t){var r,f,i;n=this._hasher=new n.init;typeof t=="string"&&(t=u.parse(t));r=n.blockSize;f=r*4;t.sigBytes>f&&(t=n.finalize(t));t.clamp();var e=this._oKey=t.clone(),o=this._iKey=t.clone(),s=e.words,h=o.words;for(i=0;i<r;i++)s[i]^=1549556828,h[i]^=909522486;e.sigBytes=o.sigBytes=f;this.reset()},reset:function(){var n=this._hasher;n.reset();n.update(this._iKey)},update:function(n){return this._hasher.update(n),this},finalize:function(n){var t=this._hasher,i=t.finalize(n);return t.reset(),t.finalize(this._oKey.clone().concat(i))}})}(),function(n){var i=CryptoJS,f=i.lib,s=f.WordArray,r=f.Hasher,h=i.algo,e=[],o=[],t,u;(function(){function u(t){for(var r=n.sqrt(t),i=2;i<=r;i++)if(!(t%i))return!1;return!0}function r(n){return(n-(n|0))*4294967296|0}for(var i=2,t=0;t<64;)u(i)&&(t<8&&(e[t]=r(n.pow(i,1/2))),o[t]=r(n.pow(i,1/3)),t++),i++})();t=[];u=h.SHA256=r.extend({_doReset:function(){this._hash=new s.init(e.slice(0))},_doProcessBlock:function(n,i){for(var r=this._hash.words,f=r[0],s=r[1],h=r[2],y=r[3],e=r[4],a=r[5],v=r[6],p=r[7],u=0;u<64;u++){if(u<16)t[u]=n[i+u]|0;else{var c=t[u-15],b=(c<<25|c>>>7)^(c<<14|c>>>18)^c>>>3,l=t[u-2],k=(l<<15|l>>>17)^(l<<13|l>>>19)^l>>>10;t[u]=b+t[u-7]+k+t[u-16]}var d=e&a^~e&v,g=f&s^f&h^s&h,nt=(f<<30|f>>>2)^(f<<19|f>>>13)^(f<<10|f>>>22),tt=(e<<26|e>>>6)^(e<<21|e>>>11)^(e<<7|e>>>25),w=p+tt+d+o[u]+t[u],it=nt+g;p=v;v=a;a=e;e=y+w|0;y=h;h=s;s=f;f=w+it|0}r[0]=r[0]+f|0;r[1]=r[1]+s|0;r[2]=r[2]+h|0;r[3]=r[3]+y|0;r[4]=r[4]+e|0;r[5]=r[5]+a|0;r[6]=r[6]+v|0;r[7]=r[7]+p|0},_doFinalize:function(){var r=this._data,t=r.words,u=this._nDataBytes*8,i=r.sigBytes*8;return t[i>>>5]|=128<<24-i%32,t[(i+64>>>9<<4)+14]=n.floor(u/4294967296),t[(i+64>>>9<<4)+15]=u,r.sigBytes=t.length*4,this._process(),this._hash},clone:function(){var n=r.clone.call(this);return n._hash=this._hash.clone(),n}});i.SHA256=r._createHelper(u);i.HmacSHA256=r._createHmacHelper(u)}(Math),function(){var n=CryptoJS,i=n.lib,r=i.Base,u=i.WordArray,t=n.algo,f=t.SHA1,e=t.HMAC,o=t.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:f,iterations:1}),init:function(n){this.cfg=this.cfg.extend(n)},compute:function(n,t){for(var s=this.cfg,r=e.create(s.hasher,n),f=u.create(),l=u.create([1]),p=f.words,w=l.words,a=s.keySize,b=s.iterations,o,c,y,i;p.length<a;){o=r.update(t).finalize(l);r.reset();var v=o.words,k=v.length,h=o;for(c=1;c<b;c++)for(h=r.finalize(h),r.reset(),y=h.words,i=0;i<k;i++)v[i]^=y[i];f.concat(o);w[0]++}return f.sigBytes=a*4,f}});n.PBKDF2=function(n,t,i){return o.create(i).compute(n,t)}}();
/** @license MIT License (c) 2011-2013 Copyright Tavendo GmbH. */
AUTOBAHNJS_VERSION="0.8.2.1";global=this,function(n,t){n.ab=t(n,n.when)}(global,function(n,t){"use strict";var i={};return i._version=AUTOBAHNJS_VERSION,function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var u,r,t,i;if(this===null)throw new TypeError;if((u=new Object(this),r=u.length>>>0,r===0)||(t=0,arguments.length>0&&(t=Number(arguments[1]),t!==t?t=0:t!==0&&t!==Infinity&&t!==-Infinity&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=r))return-1;for(i=t>=0?t:Math.max(r-Math.abs(t),0);i<r;i++)if(i in u&&u[i]===n)return i;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(n,t){var u,i,r,f,e;if(this===null)throw new TypeError(" this is null or not defined");if(r=new Object(this),f=r.length>>>0,{}.toString.call(n)!=="[object Function]")throw new TypeError(n+" is not a function");for(t&&(u=t),i=0;i<f;)i in r&&(e=r[i],n.call(u,e,i,r)),i++})}(),i._sliceUserAgent=function(n,t,i){var s=[],r=navigator.userAgent,h=r.indexOf(n),f=r.indexOf(t,h),e,o,u;for(f<0&&(f=r.length),e=r.slice(h,f).split(i),o=e[1].split("."),u=0;u<o.length;++u)s.push(parseInt(o[u],10));return{name:e[0],version:s}},i.getBrowser=function(){var n=navigator.userAgent;return n.indexOf("Chrome")>-1?i._sliceUserAgent("Chrome"," ","/"):n.indexOf("Safari")>-1?i._sliceUserAgent("Safari"," ","/"):n.indexOf("Firefox")>-1?i._sliceUserAgent("Firefox"," ","/"):n.indexOf("MSIE")>-1?i._sliceUserAgent("MSIE",";"," "):null},i.getServerUrl=function(t,i){if(n.location.protocol==="file:")return i?i:"ws://127.0.0.1/ws";var r=n.location.protocol==="https:"?"wss://":"ws://",u=n.location.port!==""?":"+n.location.port:"",f=t?t:"ws";return r+n.location.hostname+u+"/"+f},i.browserNotSupportedMessage="Browser does not support WebSockets (RFC6455)",i.deriveKey=function(n,t){if(t&&t.salt){var i=t.salt,r=t.keylen||32,u=t.iterations||1e4,f=CryptoJS.PBKDF2(n,i,{keySize:r/4,iterations:u,hasher:CryptoJS.algo.SHA256});return f.toString(CryptoJS.enc.Base64)}return n},i._idchars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i._idlen=16,i._subprotocol="wamp",i._newid=function(){for(var n="",t=0;t<i._idlen;t+=1)n+=i._idchars.charAt(Math.floor(Math.random()*i._idchars.length));return n},i._newidFast=function(){return Math.random().toString(36)},i.log=function(){if(arguments.length>1){console.group("Log Item");for(var n=0;n<arguments.length;n+=1)console.log(arguments[n]);console.groupEnd()}else console.log(arguments[0])},i._debugrpc=!1,i._debugpubsub=!1,i._debugws=!1,i._debugconnect=!1,i.debug=function(t,r,u){if("console"in n)i._debugrpc=t,i._debugpubsub=t,i._debugws=r,i._debugconnect=u;else throw"browser does not support console object";},i.version=function(){return i._version},i.PrefixMap=function(){var n=this;n._index={};n._rindex={}},i.PrefixMap.prototype.get=function(n){var t=this;return t._index[n]},i.PrefixMap.prototype.set=function(n,t){var i=this;i._index[n]=t;i._rindex[t]=n},i.PrefixMap.prototype.setDefault=function(n){var t=this;t._index[""]=n;t._rindex[n]=""},i.PrefixMap.prototype.remove=function(n){var t=this,i=t._index[n];i&&(delete t._index[n],delete t._rindex[i])},i.PrefixMap.prototype.resolve=function(n,t){var u=this,i=n.indexOf(":"),r;return i>=0&&(r=n.substring(0,i),u._index[r])?u._index[r]+n.substring(i+1):t===!0?n:null},i.PrefixMap.prototype.shrink=function(n,t){for(var u,r,f=this,i=n.length;i>0;i-=1)if(u=n.substring(0,i),r=f._rindex[u],r)return r+":"+n.substring(i);return t===!0?n:null},i._MESSAGE_TYPEID_WELCOME=0,i._MESSAGE_TYPEID_PREFIX=1,i._MESSAGE_TYPEID_CALL=2,i._MESSAGE_TYPEID_CALL_RESULT=3,i._MESSAGE_TYPEID_CALL_ERROR=4,i._MESSAGE_TYPEID_SUBSCRIBE=5,i._MESSAGE_TYPEID_UNSUBSCRIBE=6,i._MESSAGE_TYPEID_PUBLISH=7,i._MESSAGE_TYPEID_EVENT=8,i.CONNECTION_CLOSED=0,i.CONNECTION_LOST=1,i.CONNECTION_RETRIES_EXCEEDED=2,i.CONNECTION_UNREACHABLE=3,i.CONNECTION_UNSUPPORTED=4,i.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT=5,i.CONNECTION_LOST_SCHEDULED_RECONNECT=6,i.Deferred=t.defer,i._construct=function(t,i){return"WebSocket"in n?i?new WebSocket(t,i):new WebSocket(t):"MozWebSocket"in n?i?new MozWebSocket(t,i):new MozWebSocket(t):null},i.Session=function(n,t,r,u){var f=this;if(f._wsuri=n,f._options=u,f._websocket_onopen=t,f._websocket_onclose=r,f._websocket=null,f._websocket_connected=!1,f._session_id=null,f._wamp_version=null,f._server=null,f._calls={},f._subscriptions={},f._prefixes=new i.PrefixMap,f._txcnt=0,f._rxcnt=0,f._websocket=f._options&&f._options.skipSubprotocolAnnounce?i._construct(f._wsuri):i._construct(f._wsuri,[i._subprotocol]),!f._websocket){if(r!==undefined){r(i.CONNECTION_UNSUPPORTED);return}throw i.browserNotSupportedMessage;}f._websocket.onmessage=function(n){var t,r,h,e,c,s,v,y,p,w;if(i._debugws&&(f._rxcnt+=1,console.group("WS Receive"),console.info(f._wsuri+"  ["+f._session_id+"]"),console.log(f._rxcnt),console.log(n.data),console.groupEnd()),t=JSON.parse(n.data),t[1]in f._calls){if(t[0]===i._MESSAGE_TYPEID_CALL_RESULT){if(r=f._calls[t[1]],h=t[2],i._debugrpc&&r._ab_callobj!==undefined){for(console.group("WAMP Call",r._ab_callobj[2]),console.timeEnd(r._ab_tid),console.group("Arguments"),e=3;e<r._ab_callobj.length;e+=1)if(c=r._ab_callobj[e],c!==undefined)console.log(c);else break;console.groupEnd();console.group("Result");console.log(h);console.groupEnd();console.groupEnd()}r.resolve(h)}else if(t[0]===i._MESSAGE_TYPEID_CALL_ERROR){var u=f._calls[t[1]],l=t[2],a=t[3],o=t[4];if(i._debugrpc&&u._ab_callobj!==undefined){for(console.group("WAMP Call",u._ab_callobj[2]),console.timeEnd(u._ab_tid),console.group("Arguments"),s=3;s<u._ab_callobj.length;s+=1)if(v=u._ab_callobj[s],v!==undefined)console.log(v);else break;console.groupEnd();console.group("Error");console.log(l);console.log(a);o!==undefined&&console.log(o);console.groupEnd();console.groupEnd()}o!==undefined?u.reject({uri:l,desc:a,detail:o}):u.reject({uri:l,desc:a})}delete f._calls[t[1]]}else if(t[0]===i._MESSAGE_TYPEID_EVENT)y=f._prefixes.resolve(t[1],!0),y in f._subscriptions&&(p=t[1],w=t[2],i._debugpubsub&&(console.group("WAMP Event"),console.info(f._wsuri+"  ["+f._session_id+"]"),console.log(p),console.log(w),console.groupEnd()),f._subscriptions[y].forEach(function(n){n(p,w)}));else if(t[0]===i._MESSAGE_TYPEID_WELCOME)if(f._session_id===null)f._session_id=t[1],f._wamp_version=t[2],f._server=t[3],(i._debugrpc||i._debugpubsub)&&(console.group("WAMP Welcome"),console.info(f._wsuri+"  ["+f._session_id+"]"),console.log(f._wamp_version),console.log(f._server),console.groupEnd()),f._websocket_onopen!==null&&f._websocket_onopen();else throw"protocol error (welcome message received more than once)";};f._websocket.onopen=function(){if(f._websocket.protocol!==i._subprotocol)if(typeof f._websocket.protocol=="undefined")i._debugws&&(console.group("WS Warning"),console.info(f._wsuri),console.log("WebSocket object has no protocol attribute: WAMP subprotocol check skipped!"),console.groupEnd());else if(f._options&&f._options.skipSubprotocolCheck)i._debugws&&(console.group("WS Warning"),console.info(f._wsuri),console.log("Server does not speak WAMP, but subprotocol check disabled by option!"),console.log(f._websocket.protocol),console.groupEnd());else{f._websocket.close(1e3,"server does not speak WAMP");throw"server does not speak WAMP (but '"+f._websocket.protocol+"' !)";}i._debugws&&(console.group("WAMP Connect"),console.info(f._wsuri),console.log(f._websocket.protocol),console.groupEnd());f._websocket_connected=!0};f._websocket.onerror=function(){};f._websocket.onclose=function(n){i._debugws&&(f._websocket_connected?console.log("Autobahn connection to "+f._wsuri+" lost (code "+n.code+", reason '"+n.reason+"', wasClean "+n.wasClean+")."):console.log("Autobahn could not connect to "+f._wsuri+" (code "+n.code+", reason '"+n.reason+"', wasClean "+n.wasClean+")."));f._websocket_onclose!==undefined&&(f._websocket_connected?n.wasClean?f._websocket_onclose(i.CONNECTION_CLOSED,"WS-"+n.code+": "+n.reason):f._websocket_onclose(i.CONNECTION_LOST):f._websocket_onclose(i.CONNECTION_UNREACHABLE));f._websocket_connected=!1;f._wsuri=null;f._websocket_onopen=null;f._websocket_onclose=null;f._websocket=null};f.log=function(){f._options&&"sessionIdent"in f._options?console.group("WAMP Session '"+f._options.sessionIdent+"' ["+f._session_id+"]"):console.group("WAMP Session ["+f._session_id+"]");for(var n=0;n<arguments.length;++n)console.log(arguments[n]);console.groupEnd()}},i.Session.prototype._send=function(t){var r=this,u;if(!r._websocket_connected)throw"Autobahn not connected";switch(!0){case n.Prototype&&typeof top.root.__prototype_deleted=="undefined":case typeof t.toJSON=="function":u=t.toJSON();break;default:u=JSON.stringify(t)}r._websocket.send(u);r._txcnt+=1;i._debugws&&(console.group("WS Send"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(r._txcnt),console.log(u),console.groupEnd())},i.Session.prototype.close=function(){var n=this;n._websocket_connected&&n._websocket.close()},i.Session.prototype.sessionid=function(){var n=this;return n._session_id},i.Session.prototype.wsuri=function(){var n=this;return n._wsuri},i.Session.prototype.shrink=function(n,t){var i=this;return t===undefined&&(t=!0),i._prefixes.shrink(n,t)},i.Session.prototype.resolve=function(n,t){var i=this;return t===undefined&&(t=!0),i._prefixes.resolve(n,t)},i.Session.prototype.prefix=function(n,t){var r=this,u;r._prefixes.set(n,t);(i._debugrpc||i._debugpubsub)&&(console.group("WAMP Prefix"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(n),console.log(t),console.groupEnd());u=[i._MESSAGE_TYPEID_PREFIX,n,t];r._send(u)},i.Session.prototype.call=function(){for(var t=this,n=new i.Deferred,r,e,u,f;;)if(r=i._newidFast(),!(r in t._calls))break;for(t._calls[r]=n,e=t._prefixes.shrink(arguments[0],!0),u=[i._MESSAGE_TYPEID_CALL,r,e],f=1;f<arguments.length;f+=1)u.push(arguments[f]);return t._send(u),i._debugrpc&&(n._ab_callobj=u,n._ab_tid=t._wsuri+"  ["+t._session_id+"]["+r+"]",console.time(n._ab_tid),console.info()),n.promise.then?n.promise:n},i.Session.prototype.subscribe=function(n,t){var r=this,u=r._prefixes.resolve(n,!0),f,e;if(u in r._subscriptions||(i._debugpubsub&&(console.group("WAMP Subscribe"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(n),console.log(t),console.groupEnd()),f=[i._MESSAGE_TYPEID_SUBSCRIBE,n],r._send(f),r._subscriptions[u]=[]),e=r._subscriptions[u].indexOf(t),e===-1)r._subscriptions[u].push(t);else throw"callback "+t+" already subscribed for topic "+u;},i.Session.prototype.unsubscribe=function(n,t){var r=this,u=r._prefixes.resolve(n,!0),f,e,o;if(u in r._subscriptions){if(t!==undefined)if(e=r._subscriptions[u].indexOf(t),e!==-1)f=t,r._subscriptions[u].splice(e,1);else throw"no callback "+t+" subscribed on topic "+u;else f=r._subscriptions[u].slice(),r._subscriptions[u]=[];r._subscriptions[u].length===0&&(delete r._subscriptions[u],i._debugpubsub&&(console.group("WAMP Unsubscribe"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(n),console.log(f),console.groupEnd()),o=[i._MESSAGE_TYPEID_UNSUBSCRIBE,n],r._send(o))}else throw"not subscribed to topic "+u;},i.Session.prototype.publish=function(){var o=this,t=arguments[0],r=arguments[1],f=null,n=null,e=null,u=null;if(arguments.length>3){if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";if(!(arguments[3]instanceof Array))throw"invalid argument type(s)";n=arguments[2];e=arguments[3];u=[i._MESSAGE_TYPEID_PUBLISH,t,r,n,e]}else if(arguments.length>2)if(typeof arguments[2]=="boolean")f=arguments[2],u=[i._MESSAGE_TYPEID_PUBLISH,t,r,f];else if(arguments[2]instanceof Array)n=arguments[2],u=[i._MESSAGE_TYPEID_PUBLISH,t,r,n];else throw"invalid argument type(s)";else u=[i._MESSAGE_TYPEID_PUBLISH,t,r];i._debugpubsub&&(console.group("WAMP Publish"),console.info(o._wsuri+"  ["+o._session_id+"]"),console.log(t),console.log(r),f!==null?console.log(f):n!==null&&(console.log(n),e!==null&&console.log(e)),console.groupEnd());o._send(u)},i.Session.prototype.authreq=function(n,t){return this.call("http://api.wamp.ws/procedure#authreq",n,t)},i.Session.prototype.authsign=function(n,t){return t||(t=""),CryptoJS.HmacSHA256(n,t).toString(CryptoJS.enc.Base64)},i.Session.prototype.auth=function(n){return this.call("http://api.wamp.ws/procedure#auth",n)},i._connect=function(t){var r=new i.Session(t.wsuri,function(){t.connects+=1;t.retryCount=0;t.onConnect(r)},function(r,u){var f=null;switch(r){case i.CONNECTION_CLOSED:t.onHangup(r,"Connection was closed properly ["+u+"]");break;case i.CONNECTION_UNSUPPORTED:t.onHangup(r,"Browser does not support WebSocket.");break;case i.CONNECTION_UNREACHABLE:if(t.retryCount+=1,t.connects===0)t.onHangup(r,"Connection could not be established.");else if(t.retryCount<=t.options.maxRetries)if(f=t.onHangup(i.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT,"Connection unreachable - scheduled reconnect to occur in "+t.options.retryDelay/1e3+" second(s) - attempt "+t.retryCount+" of "+t.options.maxRetries+".",{delay:t.options.retryDelay,retries:t.retryCount,maxretries:t.options.maxRetries}),f){i._debugconnect&&console.log("Connection unreachable - retrying stopped by app");t.onHangup(i.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.")}else i._debugconnect&&console.log("Connection unreachable - retrying ("+t.retryCount+") .."),n.setTimeout(function(){i._connect(t)},t.options.retryDelay);else t.onHangup(i.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.");break;case i.CONNECTION_LOST:if(t.retryCount+=1,t.retryCount<=t.options.maxRetries)if(f=t.onHangup(i.CONNECTION_LOST_SCHEDULED_RECONNECT,"Connection lost - scheduled "+t.retryCount+"th reconnect to occur in "+t.options.retryDelay/1e3+" second(s).",{delay:t.options.retryDelay,retries:t.retryCount,maxretries:t.options.maxRetries}),f){i._debugconnect&&console.log("Connection lost - retrying stopped by app");t.onHangup(i.CONNECTION_RETRIES_EXCEEDED,"Connection lost.")}else i._debugconnect&&console.log("Connection lost - retrying ("+t.retryCount+") .."),n.setTimeout(function(){i._connect(t)},t.options.retryDelay);else t.onHangup(i.CONNECTION_RETRIES_EXCEEDED,"Connection lost.");break;default:throw"unhandled close code in ab._connect";}},t.options)},i.connect=function(n,t,r,u){var f={};if(f.wsuri=n,f.options=u?u:{},f.options.retryDelay===undefined&&(f.options.retryDelay=5e3),f.options.maxRetries===undefined&&(f.options.maxRetries=10),f.options.skipSubprotocolCheck===undefined&&(f.options.skipSubprotocolCheck=!1),f.options.skipSubprotocolAnnounce===undefined&&(f.options.skipSubprotocolAnnounce=!1),t)f.onConnect=t;else throw"onConnect handler required!";f.onHangup=r?r:function(n,t,r){i._debugconnect&&console.log(n,t,r)};f.connects=0;f.retryCount=0;i._connect(f)},i.launch=function(n,t,r){i.connect(n.wsuri,function(r){n.appkey&&n.appkey!==""?r.authreq(n.appkey,n.appextra).then(function(u){var f=null,e;typeof n.appsecret=="function"?f=n.appsecret(u):(e=i.deriveKey(n.appsecret,JSON.parse(u).authextra),f=r.authsign(u,e));r.auth(f).then(function(){t?t(r):i._debugconnect&&r.log("Session opened.")},r.log)},r.log):r.authreq().then(function(){r.auth().then(function(){t?t(r):i._debugconnect&&r.log("Session opened.")},r.log)},r.log)},function(n,t,u){r?r(n,t,u):i._debugconnect&&i.log("Session closed.",n,t,u)},n.sessionConfig)},i});ab._UA_FIREFOX=new RegExp(".*Firefox/([0-9+]*).*");ab._UA_CHROME=new RegExp(".*Chrome/([0-9+]*).*");ab._UA_CHROMEFRAME=new RegExp(".*chromeframe/([0-9]*).*");ab._UA_WEBKIT=new RegExp(".*AppleWebKit/([0-9+.]*)w*.*");ab._UA_WEBOS=new RegExp(".*webOS/([0-9+.]*)w*.*");ab._matchRegex=function(n,t){var i=t.exec(n);return i?i[1]:i};ab.lookupWsSupport=function(){var n=navigator.userAgent,t;return n.indexOf("MSIE")>-1?n.indexOf("MSIE 10")>-1?[!0,!0,!0]:n.indexOf("chromeframe")>-1?(t=parseInt(ab._matchRegex(n,ab._UA_CHROMEFRAME)),t>=14)?[!0,!1,!0]:[!1,!1,!1]:n.indexOf("MSIE 8")>-1||n.indexOf("MSIE 9")>-1?[!0,!0,!0]:[!1,!1,!1]:n.indexOf("Firefox")>-1?(t=parseInt(ab._matchRegex(n,ab._UA_FIREFOX)),t)?t>=7?[!0,!1,!0]:t>=3?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!0]:n.indexOf("Safari")>-1&&n.indexOf("Chrome")==-1?(t=ab._matchRegex(n,ab._UA_WEBKIT),t)?n.indexOf("Windows")>-1&&t=="534+"?[!0,!1,!0]:n.indexOf("Macintosh")>-1&&(t=t.replace("+","").split("."),parseInt(t[0])==535&&parseInt(t[1])>=24||parseInt(t[0])>535)?[!0,!1,!0]:n.indexOf("webOS")>-1?(t=ab._matchRegex(n,ab._UA_WEBOS).split("."),parseInt(t[0])==2)?[!1,!0,!0]:[!1,!1,!1]:[!0,!0,!0]:[!1,!1,!1]:n.indexOf("Chrome")>-1?(t=parseInt(ab._matchRegex(n,ab._UA_CHROME)),t)?t>=14?[!0,!1,!0]:t>=4?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!1]:n.indexOf("Android")>-1?n.indexOf("Firefox")>-1?[!0,!1,!0]:n.indexOf("CrMo")>-1?[!0,!1,!0]:n.indexOf("Opera")>-1?[!1,!1,!0]:n.indexOf("CrMo")>-1?[!0,!0,!0]:[!1,!1,!1]:n.indexOf("iPhone")>-1||n.indexOf("iPad")>-1||n.indexOf("iPod")>-1?[!1,!1,!0]:[!1,!1,!1]};